"object"==typeof Visualforce&&(Visualforce.remoting.timeout=12e4);var teasp={logic:{},action:{},data:{},dialog:{},helper:{},view:{},manager:null,message:null,viewPoint:null,sequence:{marker:0,toolTip:0,jobWork:1,dialog:1},dialogStack:[],prefixPt:"",prefixBar:"",controlClass:"RtkPotalCtl",permitPushTime:!0,ts1OptimizeOnBrowser:!1,ts1OptimizeWidth:null,timestamp:function(e,t){t=t||new Date,e=t.getFullYear()+"/"+(
t.getMonth()+1)+"/"+t.getDate()+" "+t.getHours()+":"+t.getMinutes()+":"+t.getSeconds()+"."+t.getMilliseconds()+" "+(e||"");return globalTimeLog.push(e.substring(0,100)),console.log(e),t},decode:function(e,t){try{if(e){if(1==t)return dojo.fromJson(e);if(2==t)return parseInt(e,10)}return e}catch(e){console.log(e.message),console.log(e.stack)}},jsondecode:function(e){return teasp.decode(e,1)},eval:function(e){if(e)try{
dojo.eval(e)}catch(e){console.log(e.message),console.log(e.stack)}},getHref:function(e){return"/apex/"+(teasp.prefixBar||"")+(e||"")},ts1OptimizeOptionValue:{OptimizedTs1:"1",PcVerWithoutGraph:"2"},resolved:{4652:1,4666:1,4795:1,4932:1,5259:1,5385:1,5446:1,5476:1,5844:1,5909:1,5974:1,6089:1,6381:1,6664:1,6670:1,6905:1,6983:1,6980:1,6717:1,7010:1,7540:1,7866:1,7990:1,8150:1,8159:1,8161:1,8178:1,8540:1,8538:1,8771:1,
8957:1,9046:1,9050:1,9185:1,9203:1,9353:1,9358:1,9429:1,9471:1,9523:1,9887:1,SECOM:1,"V5-1028":1,"V5-3293":1,"V5-4865":1}},globalLoadRes=null,globalTimeLog=[],globalPageUrl={},DATE_FORM_S={formatLength:"medium",selector:"date"},is_array=(teasp.provide=function(e){for(var t=e.split("."),a=1;a<t.length;a++){var o=t[a];teasp[o]||(teasp[o]={})}},teasp.setPageUrl=function(e,t){globalPageUrl[e]=t},
teasp.getPageUrl=function(e){return globalPageUrl[e]||null},teasp.isSforce=function(){return"object"==typeof sforce&&sforce.one},teasp.isSforce1=function(){return"object"==typeof sforce&&sforce.one&&0<=navigator.userAgent.indexOf("Salesforce")},teasp.locationHref=function(e,t,a){"object"==typeof sforce&&sforce.one&&!a?sforce.one.navigateToURL(e):t?t.href=e:location.href=e},teasp.downloadHref=function(e){
location.href=e},teasp.postScript=function(){"object"==typeof sforce&&sforce.one&&0<=navigator.userAgent.indexOf("Salesforce")&&(window.onkeydown=function(){window.focus()})},teasp.COOKIE_KEY="TeamSpiritConfig",teasp.getCookie=function(e){var t=dojo.cookie(teasp.COOKIE_KEY);return(t&&dojo.fromJson(t)||{})[e]||null},teasp.setCookie=function(e,t){var a=dojo.cookie(teasp.COOKIE_KEY),a=a&&dojo.fromJson(a)||{};a[e]=t,
dojo.cookie(teasp.COOKIE_KEY,dojo.toJson(a),{expires:365,secure:!0})},teasp.STORAGE_KEY="TeamSpiritConfig",teasp.getLocalStorage=function(e){var t=localStorage.getItem(teasp.STORAGE_KEY);return(t&&dojo.fromJson(t)||{})[e]||null},teasp.setLocalStorage=function(e,t){var a=localStorage.getItem(teasp.STORAGE_KEY),a=a&&dojo.fromJson(a)||{};a[e]=t,localStorage.setItem(teasp.STORAGE_KEY,dojo.toJson(a))},
teasp.dojoRequire=function(){require(["dojo/parser","dojo/window","dojo/cookie","dojo/string","dojo/Deferred","dojo/date/locale","dojo/store/Memory","dojo/data/ItemFileReadStore","dojo/data/ItemFileWriteStore","dijit/Calendar","dijit/Dialog","dijit/ProgressBar","dijit/form/ComboBox","dijit/form/DropDownButton","dijit/form/HorizontalRule","dijit/form/HorizontalSlider","dijit/form/NumberSpinner","dijit/form/Select",
"dijit/form/Slider","dijit/layout/ContentPane","dijit/layout/TabContainer","dijit/Menu","dijit/MenuItem","dijit/MenuSeparator","dijit/PopupMenuItem","dijit/ProgressBar","dijit/Tooltip","dijit/TooltipDialog","dojox/layout/ResizeHandle"])},teasp.isNarrow=function(e){return(teasp.isSforce1()||teasp.ts1OptimizeOnBrowser)&&teasp.isTs1Optimize()&&window.innerWidth<(e||teasp.ts1OptimizeWidth||768)},
teasp.isDisplayingPcVersionOnTs1=function(){return teasp.isSforce1()&&teasp.ts1OptimizeOption==teasp.ts1OptimizeOptionValue.PcVerWithoutGraph},teasp.isOnlyNarrow=function(e){return window.innerWidth<(e||teasp.ts1OptimizeWidth||768)},teasp.setTs1OptimizeOnBrowser=function(e){teasp.ts1OptimizeOnBrowser=e},teasp.setTs1OptimizeWidth=function(e){teasp.ts1OptimizeWidth=e},teasp.setTs1OptimizeOption=function(e){
teasp.ts1OptimizeOption=e},teasp.isTs1Optimize=function(){return teasp.ts1OptimizeOption==teasp.ts1OptimizeOptionValue.OptimizedTs1},teasp.isShowGraph=function(){return!teasp.isSforce1()},teasp.isEnglish=function(){return teasp.message&&"en_US"==teasp.message.getLanguageLocaleKey()},teasp.isAndroid=function(){return/Android/i.test(navigator.userAgent)},teasp.isMobile=function(){return/(Android|iPhone|iPad)/i.test(
navigator.userAgent)},teasp.setDeviceWidth=function(){var e;teasp.ts1OptimizeOnBrowser&&teasp.isMobile()&&((e=document.createElement("meta")).setAttribute("name","viewport"),e.setAttribute("content","width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no"),document.getElementsByTagName("head")[0].appendChild(e))},teasp.adjustMarginTop=function(e,t){var a,e=dojo.byId(e);e&&0<(a=e.offsetTop
)&&dojo.style(e,"margin-top",-1*a+(t||0)+"px")},teasp.backyard=function(o){var e=dojo.byId(o.areaId),s=dojo.create("input",{type:"text",id:o.id,maxLength:30,style:"display:none;"},e);dojo.connect(s,"onkeypress",function(e){var t,a;13==e.keyCode?1<(a=(t=s.value.trim()).split(/=/)).length&&a[0].length&&a[1].length?teasp.locationHref((/^(support|check)$/.test(a[0])?o.page2:"view"==a[0]&&"3"==a[1]?o.page3:o.page1)+"?"+t
):dojo.style(s,"display","none"):27==e.keyCode&&dojo.style(s,"display","none")}),dojo.connect(e,"ondblclick",function(e){"none"==dojo.style(s,"display")&&e.shiftKey&&e.altKey?(s.value="",dojo.style(s,"display",""),s.focus()):dojo.style(s,"display","none")}),dojo.connect(e,"onclick",function(){dojo.style(s,"display","none")})},Array.prototype.contains||(Array.prototype.contains=function(e){for(var t in this)if(
this.hasOwnProperty(t)&&this[t]===e)return!0;return!1}),String.prototype.entitize=function(){var e=""+this;return e=(e=(e=(e=(e=(e=(e=e.replace(/&/g,"&amp;")).replace(/</g,"&lt;")).replace(/>/g,"&gt;")).replace(/\"/g,"&quot;")).replace(/{/g,"&#123;")).replace(/}/g,"&#125;")).replace(/\'/g,"&#039;")},String.prototype.getExtent=function(e){for(var t=e,e=(t.innerHTML=this,t.offsetWidth),a=t.offsetHeight;t.firstChild;
)t.removeChild(t.firstChild);return{width:e,height:a}},String.prototype.truncateTailInWidth=function(e,t){if(0===this.length)return"";if(this.getExtent(t).width<=e)return this;for(var a=this.length-1;1<=a;--a){var o=this.slice(0,a)+"...";if(o.getExtent(t).width<=e)return o}return""},function(e){return e&&"object"==typeof e&&"number"==typeof e.length&&"function"==typeof e.splice&&!e.propertyIsEnumerable("length")}),
console=console||{debug:function(){},log:function(){}},checkTimes=(console.debug||(console.debug=function(){}),console.log||(console.log=function(e){}),teasp.constant={LEVEL_TRACE:6,LEVEL_DEBUG:5,LEVEL_INFO:4,LEVEL_WARN:3,LEVEL_ERROR:2,LEVEL_FATAL:1,LEVEL_OFF:0,REST_FIX:21,REST_FREE:22,REST_PAY:23,REST_UNPAY:24,AWAY:30,TIMEOUT_CAUSE:/Error parsing json response/i,STATUS_NOTADMIT:"未確定",STATUS_NOTREQUEST:"未申請",
STATUS_CANCEL1:"確定取消",STATUS_CANCEL2:"申請取消",STATUS_REJECT:"却下",STATUS_REJECTDONE:"却下済み",STATUS_WAIT:"承認待ち",STATUS_ADMIT:"確定済み",STATUS_APPROVE:"承認済み",STATUS_APPROVING:"承認中",STATUS_PAYD:"精算済み",STATUS_REASSIGNED:"再割当済み",STATUS_REQUESTED:"申請済み",STATUS_CANCEL_WAIT:"取消伝票承認待ち",STATUS_CANCEL_APPROVE:"取消伝票承認済み",STATUS_JOURNAL:"仕訳済み",EXP_PRE_FORM1:"出張・交通費",EXP_PRE_FORM2:"会議・交際費",EXP_PRE_FORM3:"一般経費",EXP_PRE_FORM4:"仮払申請",
EXP_FORM0:"expApply",CU_INT_SIZE_MAX:12,CU_DEC_POINT_MAX:6,CU_DEC_POINT_MIN:2,CU_INT_DISP_SIZE_MAX:17,CU_DEC_DISP_SIZE_MAX:21,CU_DEC_MIN_VALUE:1e-6,CU_TOTAL_LOWER_LIMIT:0,CU_TOTAL_UPPER_LIMIT:9999999999999,COUNT_LIMIT:1e4,QUERY_MAX:2e3,DIVERGE_REASON_MAX:255,IC_INPUTS:["spice"],statusJEmap:null,DATE_F:"YYYY-MM-DD",DATETIME_F:"YYYY-MM-DD HH:mm:ss",SHORTSIDE_LOWERLIMIT:1654,LONGSIDE_LOWERLIMIT:2338,
BITSPERSAMPLE_LOWERLIMIT:8,COLORTYPE_LIMIT:"Color",HOLIDAY_TYPE_PAID:"1",HOLIDAY_TYPE_FREE:"2",HOLIDAY_TYPE_DAIQ:"3",RANGE_ALL:"1",RANGE_AM:"2",RANGE_PM:"3",RANGE_TIME:"4",LEAVEMANAGE_VER2:2,getStatusJEmap:function(){return teasp.constant.statusJEmap||(teasp.constant.statusJEmap={},teasp.constant.statusJEmap[teasp.constant.STATUS_NOTADMIT]=teasp.message.getLabel("notFix_label"),
teasp.constant.statusJEmap[teasp.constant.STATUS_NOTREQUEST]=teasp.message.getLabel("tm10003560"),teasp.constant.statusJEmap[teasp.constant.STATUS_CANCEL1]=teasp.message.getLabel("cancelFix_btn_title"),teasp.constant.statusJEmap[teasp.constant.STATUS_CANCEL2]=teasp.message.getLabel("tm10003500"),teasp.constant.statusJEmap[teasp.constant.STATUS_REJECT]=teasp.message.getLabel("tm10003490"),
teasp.constant.statusJEmap[teasp.constant.STATUS_REJECTDONE]=teasp.message.getLabel("rejected_label"),teasp.constant.statusJEmap[teasp.constant.STATUS_WAIT]=teasp.message.getLabel("waitApproval_label"),teasp.constant.statusJEmap[teasp.constant.STATUS_ADMIT]=teasp.message.getLabel("fixed_label"),teasp.constant.statusJEmap[teasp.constant.STATUS_APPROVE]=teasp.message.getLabel("tm10003480"),
teasp.constant.statusJEmap[teasp.constant.STATUS_APPROVING]=teasp.message.getLabel("whileApproving_label"),teasp.constant.statusJEmap[teasp.constant.STATUS_PAYD]=teasp.message.getLabel("reimbursement_label"),teasp.constant.statusJEmap[teasp.constant.STATUS_REASSIGNED]=teasp.message.getLabel("tm10003520"),teasp.constant.statusJEmap[teasp.constant.STATUS_REQUESTED]=teasp.message.getLabel("tm10003470"),
teasp.constant.statusJEmap[teasp.constant.STATUS_CANCEL_WAIT]=teasp.message.getLabel("tf10006200"),teasp.constant.statusJEmap[teasp.constant.STATUS_CANCEL_APPROVE]=teasp.message.getLabel("tf10006210"),teasp.constant.statusJEmap[teasp.constant.STATUS_JOURNAL]=teasp.message.getLabel("tf10006220")),teasp.constant.statusJEmap},getDisplayStatus:function(e){return teasp.constant.getStatusJEmap()[e]||e},
getReverseStatus:function(e){var t,a=teasp.constant.getStatusJEmap();for(t in a)if(a.hasOwnProperty(t)&&a[t]==e)return t;return e},getExpPreFormName:function(e){switch(e){case teasp.constant.EXP_PRE_FORM1:return"tf10001410";case teasp.constant.EXP_PRE_FORM2:return"tf10000600";case teasp.constant.EXP_PRE_FORM3:return"tf10001420";case teasp.constant.EXP_PRE_FORM4:return"tf10006120"}return e},
getDefaultExpPreApplyConfig:function(){return{expenseTypes:[],requireChargeJob:null,requireChargeDept:null,expApply:{startFromList:!1,hiddenApplyBtn:!1,useTitle:!1,useExpenseType:!1,usePayMethod:!1,useApplyDate:!1,usePayDate:!1,useProvisional:!1,useChargeJob:!1,useChargeDept:!1,useExtraItem1:!1,useExtraItem2:!1,useAttachment:!1},"出張・交通費":{msgId:"tf10001410",view:"Form1",order:10,removed:!1,instant:!1,
useExpenseType:!1,usePayMethod:!1,useApplyDate:!1,useProvisional:!1,useChargeDept:!1,useExtraItem1:!1,useExtraItem2:!1,dptArvFlagsOptional:!1,useOverseaTravel:!0,useOneDayTrip:!0,useJtbSect:!1,useAllowanceSect:!0,useCouponTicketSect:!0,useTicketArrangeSect:!0,useProvisionalSect:!0,useFreeInputSect:!0,useAttachment:!1},"会議・交際費":{msgId:"tf10000600",view:"Form2",order:20,removed:!1,instant:!1,useExpenseType:!1,
usePayMethod:!1,useApplyDate:!1,useProvisional:!1,useChargeDept:!1,useExtraItem1:!1,useExtraItem2:!1,useProvisionalSect:!0,useAttachment:!1},"一般経費":{msgId:"tf10001420",view:"Form3",order:30,removed:!1,instant:!1,useExpenseType:!1,usePayMethod:!1,useApplyDate:!1,useProvisional:!1,useChargeDept:!1,useExtraItem1:!1,useExtraItem2:!1,useProvisionalSect:!0,useAttachment:!1},"仮払申請":{msgId:"tf10006120",view:"Form4",order:40,
removed:!0,instant:!1,useExpenseType:!1,usePayMethod:!1,useChargeDept:!1,useExtraItem1:!1,useExtraItem2:!1,useAttachment:!1}}},getExpPreApplyConfig:function(e){var t=teasp.constant.getDefaultExpPreApplyConfig();if(e)for(var a in e)e.hasOwnProperty(a)&&(t[a]&&"object"==typeof t[a]?t[a]=dojo.mixin(t[a],e[a]):t[a]=e[a]);return t["出張・交通費"].useChargeJob=!1,t}},teasp.provide("teasp.logic.Message"),
teasp.logic.Message=function(e,t){this.labels={},this.languageLocaleKey="ja",this.mergeLabels(e),this.mergeLabels(t)},teasp.logic.Message.prototype.getLanguageLocaleKey=function(){return this.languageLocaleKey},teasp.logic.Message.prototype.setLanguageLocaleKey=function(e){teasp.util.init(),this.languageLocaleKey=e},teasp.logic.Message.prototype.isJp=function(){return"ja"==this.languageLocaleKey},
teasp.logic.Message.prototype.mergeLabels=function(e,t){if(e){for(var a in e)e.hasOwnProperty(a)&&("object"==typeof e[a]?(this.labels[a]||(this.labels[a]={}),this.mergeLabels(e[a],this.labels[a])):t?t[a]=e[a]:this.labels[a]=e[a]);var o=this.getLabel("zv00000010");o&&(DATE_FORM_S={datePattern:o,selector:"date"})}},teasp.logic.Message.prototype.getLabel=function(){var e="",t=arguments;t[0]&&(e=this.labels[t[0]]||"");
for(var a=1;a<t.length;a++)e=e.replace(RegExp("\\{"+(a-1)+"\\}","g"),t[a]);return e},teasp.logic.Message.prototype.mixLabel=function(e){var t="";0<e.length&&(t=this.labels[e[0]]||"");for(var a=1;a<e.length;a++)t=t.replace(RegExp("\\{"+(a-1)+"\\}","g"),this.labels[e[a]]||"");return t},teasp.logic.Message.prototype.getLabel2=function(e,t){for(var a=this.labels[e]||"",o=0;o<t.length;o++)a=a.replace(RegExp("\\{"+o+"\\}",
"g"),t[o]);return a},teasp.logic.Message.prototype.format=function(){var e=arguments,t="";0<e.length&&(t=e[0]||"");for(var a=1;a<e.length;a++)t=t.replace(RegExp("\\{"+(a-1)+"\\}","g"),e[a]||"");return t},teasp.logic.Message.prototype.setLabelHtml=function(e,t){var a=dojo.byId(e);null!=a&&(a.innerHTML=teasp.message.getLabel(t=null==t?e:t))},teasp.logic.Message.prototype.setLabelTitle=function(e,t){var a=dojo.byId(e);
null!=a&&(a.title=teasp.message.getLabel(t=null==t?e:t))},teasp.logic.Message.prototype.setLabelEx=function(){var e,t=arguments,a=dojo.byId(t[0]);a&&("string"==typeof t[1]?a.innerHTML=teasp.message.getLabel(t[1]):1!=(e="number"==typeof t[1]?2:1)&&t[1]?a.title=is_array(t[e])?teasp.message.getLabel.apply(this,t[e]):teasp.message.getLabel(t[e]):a.innerHTML=is_array(t[e])?teasp.message.getLabel.apply(this,t[e]
):teasp.message.getLabel(t[e]))},teasp.logic.Message.convertArgs=function(e){if(!e||"object"!=typeof e)return[];if(dojo.isArray(e))return e;var t,a=[];for(t in e)e.hasOwnProperty(t)&&(a[parseInt(t,10)]=e[t]);return a},teasp.logic.Message.prototype.getErrorMessage=function(e){return"object"==typeof e?(e=e.error&&"object"==typeof e.error?e.error:e).messageId?teasp.message.getLabel2(e.messageId,
teasp.logic.Message.convertArgs(e.args)):e.message||e.name||"Error":e||"Error"},teasp.logic.Message.prototype.alertError=function(e){teasp.tsAlert(this.getErrorMessage(e))},teasp.message=new teasp.logic.Message,teasp.provide("teasp.util"),teasp.util=function(){},teasp.util.FIVE_RATE_LAST_DATE="2014-03-31",teasp.util.EIGHT_RATE=8,teasp.util.filtValue=function(e,t){return e||t||""},teasp.util.limitChars=function(e,t,a
){e.value.length>t&&(a&&alert(a),e.value=e.value.substr(0,t)),e.focus()},teasp.util.strToDate=function(e){var t,a,o,e=(e||"").trim();return""==e?{date:null,dater:null,datef:null,failed:1,tmpl:teasp.message.getLabel("tm00000050")}:(a=/^(\d{4})[\D](\d{1,2})[\D](\d{1,2})$/.exec(e))?(t=parseInt(a[1],10),o=parseInt(a[2],10),a=parseInt(a[3],10),(o=teasp.util.date.parseDate(t+"-"+o+"-"+a))&&1900<=t&&t<3e3?{date:o,
dater:teasp.util.date.formatDate(o,"SLA"),datef:teasp.util.date.formatDate(o),failed:0,tmpl:null}:{date:null,dater:null,datef:null,failed:3,tmpl:teasp.message.getLabel("tm00000060")}):(o=teasp.util.date.parseDate(e))?{date:o,dater:teasp.util.date.formatDate(o,"SLA"),datef:teasp.util.date.formatDate(o),failed:0,tmpl:null}:{date:null,dater:null,datef:null,failed:2,tmpl:teasp.message.getLabel("tm00000071")}},
teasp.util.searchYearMonthDate=function(e,t,a,o){var s,i,n,r;return"string"==typeof e&&(e=parseInt(e,10)),"string"==typeof t&&(t=parseInt(t,10)),"string"==typeof o&&(o=teasp.util.date.parseDate(o)),a?(s=Math.floor(a/100),i=a%100,2==t&&1<e&&0==--i&&(i=12,s--),n=new Date(s,i-1,e),r=teasp.util.date.addDays(teasp.util.date.addMonths(n,1),-1),{yearMonth:a,startDate:teasp.util.date.formatDate(n),
endDate:teasp.util.date.formatDate(r)}):(s=o.getFullYear(),i=o.getMonth()+1,2!=t&&o.getDate()<e?0==--i&&(i=12,s--):2==t&&1<e&&e<=o.getDate()&&12<++i&&(i=1,s++),a=100*s+i,s=o.getFullYear(),i=o.getMonth()+1,o.getDate()<e&&0==--i&&(i=12,s--),n=new Date(s,i-1,e),r=teasp.util.date.addDays(teasp.util.date.addMonths(n,1),-1),{yearMonth:a,startDate:teasp.util.date.formatDate(n),endDate:teasp.util.date.formatDate(r)})},
teasp.util.extractTimes=function(e){e=e||[];if("string"!=typeof e)return e;for(var t,a,o,s=0<e.indexOf(":")?e.split(":"):e.split(","),i=[],n={},r=0;r<s.length;r++)(t=/(\d{4}|\-\-\-\-)(\d{4}|\-\-\-\-)(\d{2})/.exec(s[r]))?((a={from:t[1],to:t[2],type:parseInt(t[3],10)}).from="----"!=a.from?parseInt(a.from,10):null,a.to="----"!=a.to?parseInt(a.to,10):null,a.from>a.to&&(a.to=null),a.from==a.to&&(a.from=null),(
o=21==a.type||22==a.type?(a.from||"")+":"+(a.to||""):null)&&n[o]||i.push(a),o&&(n[o]=1)):(t=/(\d+)-(\d+)/.exec(s[r]))&&i.push({from:parseInt(t[1],10),to:parseInt(t[2],10),type:teasp.constant.REST_FIX});return i},teasp.util.getStartDayOfWeek=function(e,t){var e="string"==typeof e?parseInt(e,10):e,t="string"==typeof t?teasp.util.date.parseDate(t):t,a=t.getDay();return teasp.util.date.addDays(t,e==a?-1:e-a-(a<e?7:0))},
teasp.util.getStartMonthOfPeriod=function(e,t,a,o){for(var s,e="string"==typeof e?parseInt(e,10):e,i=Math.floor(o/100),n=((l=o%100)<e&&i--,100*(i+1)+e),r=100*i+e,l=e;r<n&&(12<(l+=a)&&(i++,l%=12),s=100*i+l,!(r<=o&&o<s));)r=s;return r},teasp.util.getObjectByValue=function(e,t,a){for(var o=0;o<e.length;o++){var s=e[o];if(s[t]==a)return s}return null},teasp.util.setDialogPosition=function(e,t,a){
var o=document.body.getBoundingClientRect(),s=window.getWindowWidth(),i=window.getWindowHeight(),n=(1100<s&&(s=1100),1250<i&&(i=1250),window.devicePixelRatio&&(s/=window.devicePixelRatio,i/=window.devicePixelRatio),-1*o.left),o=-1*o.top,n=n+(s-t||1)/2,s=(o=!o&&0<window.getScrollY()?window.getScrollY():o)+(i-a||1)/2,r=n<0?0:n,l=s<0?0:s;e._position=dojo.hitch(e,function(){var e=this.domNode.style;e.left=r+"px",
e.top=l+"px"})},teasp.util.equalId=function(e,t){return e&&t&&"string"==typeof e&&"string"==typeof t&&15<=e.length&&15<=t.length?e.substring(0,15)==t.substring(0,15):e==t},teasp.util.createCommuterSimpleRoute=function(e){var t={value:"",name:""};if(!e)return t.name=teasp.message.getLabel("tm00000080"),t;for(var a=teasp.message.getLabel("tm10001520",e.stationFrom.name,e.stationTo.name),o="",s=e.stationVia||[],
i=0;i<s.length;i++)""!=o&&(o+=teasp.message.getLabel("tm10001540")),o+=s[i].name;return""!=o&&(a+=teasp.message.getLabel("tm10001530",o)),t.value=t.name=a,t},teasp.util.deleteHasSameJobId=function(e,t){if(0==e.length)return e;for(var a=e.length-1;0<a;){for(var o=a-1;0<=o;o--){var s=!0;if(t&&(s=e[a].process==e[o].process),e[a].jobId==e[o].jobId&&s){e.splice(a,1);break}}a--}return e},teasp.util.splitByLength=function(e
,t){for(var a=[],o=e;0<o.length;){for(var s=t,i=o.substring(0,s),n=s<o.length?o.substring(s,s+2):null;/\r\n$/.test(i)||/ $/.test(i)||/\r$/.test(i)||n&&(/^\r/.test(n)||/^ /.test(n));){var r=o.substring(0,++s);if(i==r)break;n=s<o.length?o.substring(s,s+2):null,i=r}a.push(o.substring(0,s)),o=o.substring(s)}return a},teasp.util.showErrorArea=function(e,t,a){var e=e?"string"==typeof e?e:teasp.message.getErrorMessage(e
):null,o=t?dojo.byId(t):null;if(o&&!a){for(;o.firstChild;)dojo.destroy(o.firstChild);dojo.style(o,{padding:"4px 16px",margin:"2px",width:"100%"}),dojo.toggleClass(o,"disp_table",!0),dojo.toggleClass(o,"disp_none",!1)}e?o?(a?o.innerHTML=e:dojo.create("div",{style:{color:"red"},innerHTML:e},o),dojo.toggleClass(o,"disp_table",!0),dojo.toggleClass(o,"disp_none",!1)):teasp.tsAlert(e):o&&(dojo.toggleClass(o,"disp_table",!1
),dojo.toggleClass(o,"disp_none",!0))},teasp.util.extend=function(e){for(var t=e||{},a=0,o=0,s=arguments.length;a<s;a++)for(o in arguments[a])t[o]=arguments[a][o];return t},teasp.util.excludeNameSpace=function(e){if(teasp.prefixBar)if(is_array(e))for(var t=0;t<e.length;t++)teasp.util.excludeNameSpace(e[t]);else for(var a in e){var o;e.hasOwnProperty(a)&&(a.substring(0,teasp.prefixBar.length)==teasp.prefixBar?(
e[o=a.substring(teasp.prefixBar.length)]=dojo.clone(e[a]),delete e[a],"object"==typeof e[o]&&teasp.util.excludeNameSpace(e[o])):"object"==typeof e[a]&&teasp.util.excludeNameSpace(e[a]))}},teasp.util.parseNumsText=function(e){var t=[];if(!e)return t;for(var a=e.split(/,/),o=0;o<a.length;o++)/\d+/.test(a[o])&&t.push(parseInt(a[o],10));return t},teasp.util.parseNumText=function(e,t){return/^\d+$/.test(e)?parseInt(e,10
):t},teasp.util.levelingDepts=function(e,t){for(var a,o={},s=e.length-1;0<=s;s--){var i=e[s];t&&(i.startDate&&t<i.startDate||i.endDate&&i.endDate<t)&&(i.hidden=!0,i.past=i.endDate&&i.endDate<t,i.future=i.startDate&&t<i.startDate),(o[i.id]=i).deptCode=i.deptCode||i.code||""}for(s=0;s<e.length;s++)(i=e[s]).parentId&&((a=o[i.parentId])&&!a.hidden||(i.hidden=!0,a?(i.past=a.past,i.future=a.future):i.past=!0));e=e.sort(
function(e,t){return e.deptCode<t.deptCode?-1:e.deptCode>t.deptCode?1:0});function p(e,t,a,o){for(var s=t?t.id:null,i=0;i<e.length;i++){var n=e[i];if(n.parentId===s){t&&(t.parentFlag=!0,n.parentMap=t.parentMap?dojo.clone(t.parentMap):{},n.parentMap[t.id]=t.level,t.hidden&&(n.hidden=!0,n.past=t.past,n.future=t.future)),n.level=t?t.level+1:1;for(var r="",l=1;l<n.level;l++)r+="&nbsp;&nbsp;";
n.displayName=r+n.deptCode+"-"+n.name,n.order=a.order++,p(e,n,a,o)}}}return p(e,null,{order:1},t),e.sort(function(e,t){return(e.order||0)-(t.order||0)})},teasp.util.insertHelpIcon=function(e,t){var a=teasp.message.getLabel(e+"Help"),o={key:e};if(a){var s=dojo.byId(e+"Label");if(s&&"DIV"==s.nodeName){dojo.style(s,"float","left");var i=dojo.create("div",{id:e+"Help",className:"pp_base pp_icon_help "+(t&&t.className||""
),style:{float:"left",marginLeft:"4px",marginTop:"2px"}},s,"after");dojo.create("div",{style:{clear:"both"},className:t&&t.className||""},i,"after"),o.handle1=dojo.connect(s,"onmouseover",function(){dojo.toggleClass(i,"pp_icon_help_on",!0),dojo.toggleClass(i,"pp_icon_help",!1)}),o.handle2=dojo.connect(s,"onmouseout",function(){dojo.toggleClass(i,"pp_icon_help_on",!1),dojo.toggleClass(i,"pp_icon_help",!0)});try{
o.tooltip=new dijit.Tooltip({connectId:[e+"Label",e+"Help"],label:a,position:["below"]})}catch(e){console.log(e.message)}}}return o},teasp.util.HelpIcon=function(e){var t=e.id,a=e.message,o=e.className||"";const s=e.eventTarget||[],i=dojo.create("div",{id:t,className:"pp_base pp_icon_help "+o});this.node=i,s.forEach(function(e){dojo.connect(e,"onmouseover",function(){dojo.toggleClass(i,"pp_icon_help_on",!0),
dojo.toggleClass(i,"pp_icon_help",!1)}),dojo.connect(e,"onmouseout",function(){dojo.toggleClass(i,"pp_icon_help_on",!1),dojo.toggleClass(i,"pp_icon_help",!0)})});try{var n=s.map(function(e){return e.id});n&&new dijit.Tooltip({connectId:n,label:a,position:["below"]})}catch(e){console.log(e.message)}},teasp.util.destroyHelpIcon=function(e){var t;e&&(e.handle1&&(dojo.disconnect(e.handle1),e.handle1=null),e.handle2&&(
dojo.disconnect(e.handle2),e.handle2=null),e.tooltip&&(e.tooltip.destroy(!0),e.tooltip=null),e.key&&(t=dojo.byId(e.key+"Label"))&&"DIV"==t.nodeName&&(dojo.style(t,"float",null),dojo.query("#"+e.key+"Label ~ div").forEach(function(e){dojo.destroy(e)})))},teasp.util.init=function(){dojo.connect(dojo.doc,"onkeypress",function(e){
void 0===e.target.size&&void 0===e.target.rows&&e.keyCode==dojo.keys.BACKSPACE&&e.preventDefault()}),teasp.util.init=function(){}},teasp.util.setWindowTitle=function(e){if(e)try{var t=document.getElementsByTagName("title");t&&0<t.length&&(t[0].innerHTML=e)}catch(e){}},teasp.util.getPageBox=function(e,t,a,o,s){var i=[],n=1,r=a+o+s;if(e<=r+2)for(;n<=e;)i.push(n++);else{for(;n<=a;)i.push(n++);if((e==r+3||a-1<t)&&t<a+o+1
)for(;n<=a+o+1;)i.push(n++);else if(i.push(null),(e==r+3||t<=e-(s-2))&&e-(o+s)<t)for(n=e-(o+s);n<=e;)i.push(n++);else for(var r=t,t=((t<=a-1||e-(a-1)<t)&&(r=Math.ceil(e/2)),Math.floor(o/2)),l=(n=r-t)+o-1;n<=l;)i.push(n++);if(n<e)for(i.push(null),n=e-(s-1);n<=e;)i.push(n++)}return i},teasp.util.getYearMonthJp=function(e){e=""+e;return teasp.util.date.formatMonth("zv00000021",e.substring(0,4),e.substring(4))},
teasp.util.monthlyPulldown={},teasp.util.monthlyPulldown.create=function(e,t,a,o,s){for(a=""+a;e.firstChild;)dojo.destroy(e.firstChild);var i=dojo.clone(t);o&&null!==a&&(i.contains(a)||i.push(a),i=i.sort(function(e,t){return""!=e&&(""==t||e<t)?1:-1}));for(var n=0;n<i.length;n++){var r=i[n];""==r?dojo.create("option",{value:"",innerHTML:"----------"},e):dojo.create("option",{value:""+r,
innerHTML:teasp.util.getYearMonthJp(r)},e)}s&&dojo.create("option",{value:"*",innerHTML:teasp.message.getLabel("tk10005450")},e),e.value=a},teasp.util.monthlyPulldown.changed=function(t,a,o){try{if("*"==t.value)t.value=a,teasp.manager.dialogOpen("MonthInput",{yearMonth:a},null,this,function(e){o(e.yearMonth)});else{if(""==t.value)return;o(parseInt(t.value,10))}}catch(e){return void(t.value=a)}},
teasp.util.isOldDate=function(e,t,a){var o=teasp.util.getLastFixMonth(e,t,a),s=teasp.util.date.formatDate(teasp.util.date.addMonths(teasp.util.date.getToday(),-12));return function(e){return e<=s||teasp.util.searchYearMonthDate(t,a,null,e).yearMonth<=o}},teasp.util.getLastFixMonth=function(e,t,a){for(var o=teasp.util.searchYearMonthDate(t,a,null,teasp.util.date.getToday()).yearMonth,s=(e=e.sort(function(e,t){
return t-e}),null),i=0;i<e.length;i++){var n=e[i];if(n<o){s=n;break}}return s},teasp.util.entitize=function(e,t){return(e="string"==typeof e?(e=(e=(e=(e=(e=(e=e.replace(/&/g,"&amp;")).replace(/</g,"&lt;")).replace(/>/g,"&gt;")).replace(/\"/g,"&quot;")).replace(/{/g,"&#123;")).replace(/}/g,"&#125;")).replace(/\'/g,"&#039;"):e)||t},teasp.util.entitizf=function(e){return teasp.util.entitize(e,"")},
teasp.util.entitizg=function(e){return teasp.util.entitize(e,"&nbsp;")},teasp.util.revetize=function(e,t){return(e="string"==typeof e?(e=(e=(e=(e=(e=(e=e.replace(/&amp;/g,"&")).replace(/&lt;/g,"<")).replace(/&gt;/g,">")).replace(/&quot;/g,'"')).replace(/&#123;/g,"{")).replace(/&#125;/g,"}")).replace(/&#039;/g,"'"):e)||t},teasp.util.isIE=function(){var e;return dojo.isIE||(e=/(msie\s|trident.*rv:)([\w.]+)/.exec(
navigator.userAgent.toLowerCase()))&&(dojo.isIE=+e[2]),dojo.isIE},teasp.util.getAncestorByTagName=function(e,t){for(var a=null,o=e;null!=o&&"BODY"!=o.tagName;){if(o.tagName==t){a=o;break}o=o.parentNode}return a},teasp.util.fadeInOut=function(t,a){require(["dojo/_base/fx"],dojo.hitch(this,function(e){(t?e.fadeIn(a):e.fadeOut(a)).play()}))},teasp.util.compareSpans=function(e,t){for(var a=dojo.clone(t||[]),
o=0;o<e.length;o++){for(var s=e[o],i=!1,n=0;n<a.length;n++){var r=a[n];if(s.from==r.from&&s.to==r.to){a.splice(n,1),i=!0;break}}if(!i)return!0}return 0<a.length},teasp.util.sortSpans=function(e){return e.sort(function(e,t){e="number"==typeof e.from?e.from:e.to,t="number"==typeof t.from?t.from:t.to;return"number"==typeof e&&"number"==typeof t?e-t:"number"==typeof e?-1:"number"==typeof t?1:0})},
teasp.util.convertSpanStrings=function(e){for(var t=[],a=0;a<e.length;a++){var o=e[a];t.push(["number"==typeof o.from?teasp.util.time.timeValue(o.from):"","number"==typeof o.to?teasp.util.time.timeValue(o.to):""].join("-"))}return t},teasp.util.dspVal=function(e,t){return"number"==typeof e?""+e:e||(void 0===t?null:t)},teasp.util.convertStr=function(e){if(!e)return"";var e=e.replace(/[！-～]/g,function(e){
return String.fromCharCode(e.charCodeAt(0)-65248)}),t=(e=e.replace(/”/g,'"').replace(/’/g,"'").replace(/‘/g,"`").replace(/￥/g,"\\").replace(/¥/g,"\\").replace(/〜/g,"~").replace(/　/g," ").toUpperCase()).replace(/^\s+|\s+$/g,"");return t||e},teasp.util.getConfigByDate=function(e,t){for(var a=e||[],o=0;o<a.length;o++){var s=a[o];if((!s.startDate||s.startDate<=t)&&(!s.endDate||t<=s.endDate))return s}return null},
teasp.util.getBaseTimeForStock=function(e){return e?e.config?e.config.BaseTimeForStock__c||null:e.baseTimeForStock||null:null},teasp.util.getFutureConfigs=function(e,t){for(var a=e||[],o=[],s=0;s<a.length;s++){var i=a[s];i.startDate&&t<i.startDate&&o.push(i)}return o},teasp.provide("teasp.util.currency"),teasp.util.currency=function(){},teasp.util.currency.calcRoundDecimal=function(e,t){var a=e*Math.pow(10,7);
return Math.round(a)?teasp.util.currency.formatDecimal(e,t).num:0},teasp.util.currency.complexNumber="0123456789０１２３４５６７８９.．",teasp.util.currency.complexMinus="-－",teasp.util.currency.money2number=function(e,t){if(!e)return 0;for(var a=null,o=!1,s=0;s<e.length;s++){var i=e.substring(s,s+1),n=teasp.util.currency.complexNumber.indexOf(i);if(n<0&&t&&null===a&&0<=teasp.util.currency.complexMinus.indexOf(i))o=!0;else if(
0<=n&&n<20)a=(null!==a?10*a:0)+(10<=n?n-10:n);else if(0<n)break}return a*(o?-1:1)},teasp.util.currency.string2number=function(e,t){var a={minus:!1,num:0,str:"",sn1:"",sn2:""};if(!e)return a;for(var o=null,s=null,i=0;i<e.length;i++){var n=e.substring(i,i+1),r=teasp.util.currency.complexNumber.indexOf(n);if(r<0&&t&&null===o&&0<=teasp.util.currency.complexMinus.indexOf(n))a.minus=!0;else if(0<=r&&r<20)null===s?o=(
null!==o?o:"")+(10<=r?r-10:r):s+=10<=r?r-10:r;else if(0<r){if(null!==s)break;null===o&&(o="0"),s=""}}return a.str=(o=o||"0")+(s?"."+s:""),a.sn1=o,!(a.sn2=s)||/^0+$/.test(s)?a.num=parseInt(a.sn1,10):a.num=parseFloat(a.str),a.minus&&(a.num*=-1),a},teasp.util.currency.inputSupportMoney=function(e,t,a,o){o=teasp.util.currency.money2number(e.value,o);return e.value=teasp.util.currency.addFigure(o,!0,t,a),o},
teasp.util.currency.onblurMoney=function(e){teasp.util.currency.inputSupportMoney(e.target)},teasp.util.currency.onkeypressMoney=function(e){""===e.keyChar&&13===e.keyCode&&(teasp.util.currency.inputSupportMoney(e.target),e.preventDefault(),e.stopPropagation())},teasp.util.currency.addFigure=function(e,t,a,o){if("number"==typeof e)e=""+e;else if(!e)return"";for(var s=e.replace(/,/g,"");s!=(s=s.replace(
/^(-?\d+)(\d{3})/,"$1,$2")););return o&&"0"==s?"":(t?teasp.message.getLabel(a?"cunit_html":"cunit_text"):"")+s},teasp.util.currency.formatMoney=function(e,t,a){if("number"==typeof e)e=""+e;else if(!e)return"";for(var o=e.replace(/,/g,"");o!=(o=o.replace(/^(-?\d+)(\d{3})/,"$1,$2")););return a&&"0"==o?"":"#,##0"==t?teasp.message.getLabel("cunit_text")+o:"&#165;#,##0"==t?teasp.message.getLabel("cunit_html"
)+o:"#,##0円"==t?o+teasp.message.getLabel("cunit_jps"):o},teasp.util.currency.formatDecimal=function(e,t,a,o){var s=null,i=null==t?2:t,t=null==a?6:a;if(""===e)return{num:0,n:0,absn:0,str:"",org:"",sn1:"",sn2:"",empty:!0};for(var a=teasp.util.currency.string2number("number"==typeof e?""+e:e,o),s=(a.minus?"-":"")+a.str,e=teasp.util.currency.addFigure((a.minus?"-":"")+a.sn1),o=a.sn1,n=a.sn2||"0",r=/^(\d+?)0*$/.exec(n)[1]
,n="0"==r?"":r;n.length<i;)n+="0";r.length>t&&(n=r=t<=0?"":r.substring(0,t));t=parseFloat(o+"."+(n||"0"))*(a.minus?-1:1);return 0==t&&(a.minus=!1,e=o=s="0"),{minus:a.minus,num:s,n:t,absn:Math.abs(t),str:e+(0<n.length?"."+n:""),org:(a.minus?"-":"")+o+(0<n.length?"."+n:""),sn1:o,sn2:n}},teasp.provide("teasp.util.date"),teasp.util.date=function(){},teasp.util.date.weekJp=[],teasp.util.date.sfTimeZoneOffset=-540,
teasp.util.date.getToday=function(e){var t=new Date;return e&&1!=e||t.setMinutes(t.getMinutes()+t.getTimezoneOffset()-(e?0:teasp.util.date.sfTimeZoneOffset)),t},teasp.util.date.getCurrentTime=function(e){e=e||new Date;return e.getFullYear()+"/"+(e.getMonth()+1)+"/"+e.getDate()+" "+e.getHours()+":"+e.getMinutes()+":"+e.getSeconds()+"."+e.getMilliseconds()},teasp.util.date.longToDate=function(e,t){var a=new Date;
return a.setTime(e),t&&1!=t||a.setMinutes(a.getMinutes()+a.getTimezoneOffset()-(t?0:teasp.util.date.sfTimeZoneOffset)),a},teasp.util.date.getWeekJp=function(e){return(!teasp.util.date.weekJp||teasp.util.date.weekJp.length<=0)&&(teasp.util.date.weekJp=[teasp.message.getLabel("tm00000100"),teasp.message.getLabel("tm00000101"),teasp.message.getLabel("tm00000102"),teasp.message.getLabel("tm00000103"),
teasp.message.getLabel("tm00000104"),teasp.message.getLabel("tm00000105"),teasp.message.getLabel("tm00000106")]),teasp.util.date.weekJp[e]},teasp.util.date.parseDate=function(e){var t,a,o,s,i,n,r,l;return(t=/\d{8}/.exec(e))?(i=parseInt(e.substring(0,4),10),n=parseInt(e.substring(4,6),10),l=parseInt(e.substring(6),10),new Date(i,n-1,l)):(t=/^(\d+)[\-](\d+)[\-](\d+)\s*(.*)$/.exec(e))?(i=parseInt(t[1],10),n=parseInt(
t[2],10),l=parseInt(t[3],10),(s=t[4])&&(t=/^(\d+):(\d+):?(\d*)$/.exec(s))?(a=parseInt(t[1],10),o=parseInt(t[2],10),s=parseInt(t[3],10),r=!1,24<=a&&(a-=24,r=!0),s=new Date(i,n-1,l,a,o,s||0),r?teasp.util.date.addDays(s,1,!0):s):new Date(i,n-1,l)):e?(r=!1,(t=/(.+) (\d{2}):(\d{2})$/.exec(e))&&(e=t[1],r=!0,a=parseInt(t[2],10),o=parseInt(t[3],10)),(l=dojo.date.locale.parse(e,DATE_FORM_S))?r?new Date(l.getFullYear(),
l.getMonth(),l.getDate(),a,o,0):l:null):null},teasp.util.date.parseDate2=function(e,t){var e=teasp.util.date.parseDate(e),a=Math.floor(t/1440);return 0<a&&(e=teasp.util.date.addDays(e,a),t-=1440*a),new Date(e.getFullYear(),e.getMonth()-1,e.getDate(),Math.floor(t/60),t%60,0)},teasp.util.date.formatDate=function(e,t,a){if(!e)return"";try{var o,s=e;return"string"==typeof e?s=teasp.util.date.parseDate(e
):"number"==typeof e&&(s=teasp.util.date.longToDate(e,void 0===a?1:a)),"M/d"===t?s.getMonth()+1+"/"+s.getDate():"+M/d"===t?"ja"==dojo.locale?s.getFullYear()==teasp.util.date.getToday().getFullYear()?s.getMonth()+1+"/"+s.getDate():s.getFullYear()+"/"+(s.getMonth()+1)+"/"+s.getDate():s.getFullYear()==teasp.util.date.getToday().getFullYear()?dojo.date.locale.format(s,{selector:"date",datePattern:"MMM d"}
):dojo.date.locale.format(s,{selector:"date",datePattern:"MMM d, y"}):"M/d+"===t?"ja"==dojo.locale?dojo.date.locale.format(s,{selector:"date",datePattern:"M/d (EEE)"}):dojo.date.locale.format(s,{selector:"date",datePattern:"MMM d (EEE)"}):"yyyyMMdd"===t?s.getFullYear()+(s.getMonth()<9?"0":"")+(s.getMonth()+1)+(s.getDate()<10?"0":"")+s.getDate():"SLA"===t?"ja"==dojo.locale?s.getFullYear()+"/"+(s.getMonth()<9?"0":"")+(
s.getMonth()+1)+"/"+(s.getDate()<10?"0":"")+s.getDate():dojo.date.locale.format(s,DATE_FORM_S):"JP1"===t?dojo.date.locale.format(s,{selector:"date",formatLength:"full"}):"JP2"===t?dojo.date.locale.format(s,{selector:"date",datePattern:teasp.message.getLabel("tm10001550")}):"JPW"===t?1<(o=dojo.date.locale.format(s,{selector:"date",datePattern:"EEE"})).length?o.substring(0,1):o:s.getFullYear()+"-"+(s.getMonth(
)<9?"0":"")+(s.getMonth()+1)+"-"+(s.getDate()<10?"0":"")+s.getDate()}catch(e){}return"???"},teasp.util.date.formatDateTime=function(e,t,a){"string"==typeof e?e=teasp.util.date.parseDate(e):"number"==typeof e?e=teasp.util.date.longToDate(e):a||(e=new Date(e)).setMinutes(e.getMinutes()-teasp.util.date.sfTimeZoneOffset);var a=e.getMonth()+1,o=e.getDate(),s=e.getHours(),i=e.getMinutes(),n=e.getSeconds();
return"SLA-HM"===t||"SLA-HMS"===t?teasp.util.date.formatDate(e,"SLA")+" "+(s<10?"0":"")+s+":"+(i<10?"0":"")+i+("SLA-HMS"===t?":"+(n<10?"0":"")+n:""):"SLA-HMK"===t?teasp.util.date.formatDate(e,"SLA")+"("+(s<10?"0":"")+s+":"+(i<10?"0":"")+i+")":"HM"===t?(s<10?"0":"")+s+":"+(i<10?"0":"")+i:"N14"===t?e.getFullYear()+(a<10?"0":"")+a+(o<10?"0":"")+o+(s<10?"0":"")+s+(i<10?"0":"")+i+(n<10?"0":"")+n:e.getFullYear()+"-"+(
a<10?"0":"")+a+"-"+(o<10?"0":"")+o+" "+(s<10?"0":"")+s+":"+(i<10?"0":"")+i+":"+(n<10?"0":"")+n},teasp.util.date.getTzDateTime=function(e){return(e=new Date(e)).setMinutes(e.getMinutes()-teasp.util.date.sfTimeZoneOffset),e},teasp.util.date.formatDateTimeTz=function(e,t){var t=t||0,a=Math.floor(t/36e5),o=Math.floor(t/6e4),s=Math.floor(t/1e3),t=t%1e3,i=teasp.util.date.sfTimeZoneOffset,e=teasp.util.date.formatDate(e
)+"T"+(a<10?"0":"")+a+":"+(o<10?"0":"")+o+":"+(s<10?"0":"")+s+"."+(t<100?t<10?"00":"0":"")+t+(i?i<0?"+":"-":"Z");return i&&(i=Math.abs(i),e+=((a=Math.floor(i/60))<10?"0":"")+a+":"+((o=i%60)<10?"0":"")+o),e},teasp.util.date.formatTime=function(e){var t=e.getHours(),a=e.getMinutes(),o=e.getSeconds();return(t<10?"0":"")+t+":"+(a<10?"0":"")+a+":"+(o<10?"0":"")+o+"."+e.getMilliseconds()},
teasp.util.date.formatDateRange=function(e,t,a){e="string"==typeof e?teasp.util.date.parseDate(e):new Date(e),t="string"==typeof t?teasp.util.date.parseDate(t):new Date(t);return t&&0!==teasp.util.date.compareDate(e,t)?teasp.message.getLabel("tm10003590",teasp.util.date.formatDate(e,a),teasp.util.date.formatDate(t,a)):teasp.util.date.formatDate(e,a)},teasp.util.date.compareDate=function(e,t){
e="string"==typeof e?teasp.util.date.parseDate(e):new Date(e),t="string"==typeof t?teasp.util.date.parseDate(t):new Date(t);return 1e4*e.getFullYear()+100*(e.getMonth()+1)+e.getDate()-(1e4*t.getFullYear()+100*(t.getMonth()+1)+t.getDate())},teasp.util.date.addDays=function(e,t,a){var o=e,s="string"==typeof e,e=("string"==typeof e&&(o=teasp.util.date.parseDate(e)),a||o.setHours(10),new Date);return e.setTime(o.getTime(
)+864e5*t),s?teasp.util.date.formatDate(e):e},teasp.util.date.addMonths=function(e,t){var a=e,o="string"==typeof e,e=("string"==typeof e&&(a=teasp.util.date.parseDate(e)),teasp.util.date.computeMonth(a.getFullYear(),a.getMonth()+1,a.getDate(),t));return o?teasp.util.date.formatDate(e):e},teasp.util.date.getMonthEndDay=function(e,t){return new Date(e,t,0).getDate()},teasp.util.date.computeMonth=function(e,t,a,o){t+=o,
o=teasp.util.date.getMonthEndDay(e,t);return new Date(e,t-1,o<a?o:a)},teasp.util.date.daysInRange=function(e,t){e="string"==typeof e?teasp.util.date.parseDate(e):new Date(e),t=("string"==typeof t?teasp.util.date.parseDate(t):new Date(t))-e;return Math.round(t/864e5+(t<0?-1:1))},teasp.util.date.getDateList=function(e,t){for(var e="string"==typeof e?teasp.util.date.parseDate(e):new Date(e),
a="string"==typeof t?teasp.util.date.parseDate(t):new Date(t),o=[],s=e;teasp.util.date.compareDate(s,a)<=0;)o.push(teasp.util.date.formatDate(s)),s=teasp.util.date.addDays(s,1);return o},teasp.util.date.maxDate=function(e,t){return!e&&t||e&&t&&teasp.util.date.compareDate(e,t)<0?t:e},teasp.util.date.minDate=function(e,t){return!e&&t||e&&t&&teasp.util.date.compareDate(t,e)<0?t:e},teasp.util.date.addYearMonth=function(e
,t){var a=Math.floor(e/100),e=e%100;return 12<(e+=t)?(a+=Math.floor(e/12),e%=12):e<1&&(t=-1*e,a-=Math.floor(t/12)+1,e=12-t%12),0==e&&(a--,e=12),100*a+e},teasp.util.date.getWeekJpByNumArray=function(e){for(var t=[],a=0;a<e.length;a++)t.push(teasp.util.date.getWeekJp(e[a]));return t.join(",")},teasp.util.date.excludeNums=function(e,t){if(!t||t.length<=0)return e;for(var a=e.length-1;0<=a;a--){var o=e[a];t.contains(o
)&&e.splice(a,1)}return e},teasp.util.date.getWeekByDate=function(e,t){if("string"==typeof e&&(e=teasp.util.date.parseDate(e)),t<0||6<t)return[];for(var a=teasp.util.date.addDays(e,-6),o=[];o.length<7;)(a.getDay()==t||0<o.length)&&o.push(teasp.util.date.formatDate(a)),a=teasp.util.date.addDays(a,1);return o},teasp.util.date.divideDateList=function(e,t){if(!e||!e.length)return[];var a,o=null,s=null,i=(
100<=t?o=t-100:s=t,e=e.sort(function(e,t){return e<t?-1:e==t?0:1}),teasp.util.date.parseDate(e[0])),n=teasp.util.date.parseDate(e[e.length-1]),r=[],l=null;for(l=null!==o?(a=i.getDay(),i=teasp.util.date.addDays(i,o-a-(a<o?7:0),!0),function(e){return teasp.util.date.addDays(e,7,!0)}):(s<(a=i.getDate())?i=teasp.util.date.addDays(i,s-a,!0):a<s&&(i=teasp.util.date.addMonths(teasp.util.date.addDays(i,s-a,!0),-1)),function(
e){return teasp.util.date.addMonths(e,1)});i<=n;){for(var p=l(i),d={mind:teasp.util.date.formatDate(i),maxd:teasp.util.date.formatDate(p),lst:[]},c=0;c<e.length;c++){var m=e[c];d.mind<=m&&m<d.maxd&&d.lst.push(e[c])}0<d.lst.length&&(d.sd=d.lst[0],d.ed=d.lst[d.lst.length-1],r.push(d)),i=p}return r},teasp.util.date.formatMonth=function(e,t,a,o){"string"==typeof t&&(t=parseInt(t,10)),"string"==typeof a&&(a=parseInt(a,10)
);t=new Date(t,a-1,1);return dojo.date.locale.format(t,{datePattern:teasp.message.getLabel(e||"zv00000021"),selector:"date"})+teasp.util.date.dispSubNo(o)},teasp.util.date.dispSubNo=function(e){return e?"("+(e+1)+")":""},teasp.util.date.dateRangeOfYear=function(e,t,a,o,s){e="string"==typeof e?parseInt(e,10):e,a="string"==typeof a?parseInt(a,10):a,t="string"==typeof t?parseInt(t,10):t,o="string"==typeof o?parseInt(o,
10):o,s="string"==typeof s?parseInt(s,10):s,2==o&&(e=1<e?e-1:12),2==t&&(s=1<s?s-1:12),o=new Date(s,e-1,a),t=teasp.util.date.addDays(teasp.util.date.addMonths(o,12),-1,!0);return{sd:teasp.util.date.formatDate(o),ed:teasp.util.date.formatDate(t)}},teasp.util.date.convDateTimeZone=function(e){var t=-1*teasp.util.date.sfTimeZoneOffset,a=Math.floor(t/60),o=t%60,a=(a<10?"0":"")+a+":"+(o<10?"0":"")+o;return moment(e
).format("YYYY-MM-DD")+"T00:00:00"+(0==t?"Z":(0<t?"+":"-")+a)},teasp.util.date.joinEx=function(e,t){if(!e||!e.length)return"";e=e.sort(function(e,t){return e<t?-1:1});for(var a=[],o=null,s="YYYY-MM-DD",i=0;i<e.length;i++){var n,r=e[i];o&&moment(o,s).add(1,"d").format(s)==r?(l=(n=a[a.length-1]).indexOf(":"),a[a.length-1]=(l<0?n:n.substring(0,l))+":"+r):a.push(r),o=r}for(var l,p,d,i=0;i<a.length;i++)(l=(r=a[i]
).indexOf(":"))<0?a[i]=moment(r,s).format("M/D"):(p=moment(r.substring(0,l),s),d=moment(r.substring(l+1),s),p.month()==d.month()?a[i]=p.format("M/D")+"-"+d.format("D"):a[i]=p.format("M/D")+"-"+d.format("M/D"));return a.join(t||", ")},teasp.provide("teasp.util.time"),teasp.util.time=function(){},teasp.util.time.zenkakuNumber="０１２３４５６７８９",teasp.util.time.timeform={form:"h:mm",round:1},
teasp.util.time.setTimeFormat=function(e){teasp.util.time.timeform=e},teasp.util.time.zenNum2han=function(e){var t,a,o="";if(e)for(t=0;t<e.length;t++)(a=e.substring(t,t+1)).match(/\d/)?o+=a:"."===a||"．"===a?o+=".":":"===a||"："===a?o+=":":0<=(a=teasp.util.time.zenkakuNumber.indexOf(a))&&(o+=a);return o},teasp.util.time.supportTime=function(e,t,a,o){var s,i,n,r="",t=t||teasp.util.time.timeform,
e=teasp.util.time.zenNum2han(e);if(/^\d{5,}$/.test(e)&&(e=e.substring(0,4)),(n=/^(\d{3,4})$/.exec(e))&&(s=parseInt(n[1],10),p=Math.floor(s/100),s=s%100,e="h:mm"===t.form?(60<s&&(p++,s%=60),p+":"+(s<10?"0"+s:s)):p+"."+s),n=/^(\d*)(:|\.)?(\d*)$/.exec(e))if(p=n[1],e=n[2],n=n[3],i=p?parseInt(p,10):0,l=n?parseInt(n,10):0,!p||48<i)r="";else{"."===e&&(l=Math.round(60*parseFloat("0."+(n||l))));var l,p=!1;if(60<=(l=!(
p=l<60&&o&&o.split(",").contains(""+(60*i+l))?!0:p)&&1<t.round&&a?1===(e=t[a])?t.round*Math.floor(l/t.round):2===e?t.round*Math.ceil(l/t.round):t.round*Math.round(l/t.round):l)&&(l-=60*(s=Math.floor(l/60)),48<(i+=s)))return"";r="h:mm"===t.form?i+":"+(l<10?"0"+l:l):i+"."+((l=Math.round(100*l/60))<10?"0"+l:l)}return r},teasp.util.time.supportTimeL=function(e,t,a){var o,s,i,n,r,l="",t=t||teasp.util.time.timeform,
e=teasp.util.time.zenNum2han(e);return/^\d{6,}$/.test(e)&&(e=e.substring(0,5)),(r=/^(\d{4,5})$/.exec(e))&&(o=parseInt(r[1],10),s=Math.floor(o/100),o=o%100,e="h:mm"===t.form?(60<o&&(s++,o%=60),s+":"+(o<10?"0"+o:o)):s+"."+o),(r=/^(\d*)(:|\.)?(\d*)$/.exec(e))&&(s=r[1],e=r[2],r=r[3],i=s?parseInt(s,10):0,n=r?parseInt(r,10):0,l=s?(60<=(n="."===e?Math.round(60*parseFloat("0."+(r||n))):n)&&(n-=60*(o=Math.floor(n/60)),i+=o),
"h:mm"===t.form?i+":"+(n<10?"0"+n:n):i+"."+((n=Math.round(100*n/60))<10?"0"+n:n)):""),l},teasp.util.time.inputSupportTime=function(e){var t;6===e.maxLength?e.value=teasp.util.time.supportTimeL(e.value):(t=null,dojo.hasClass(e,"roundBegin")?t="roundBegin":dojo.hasClass(e,"roundEnd")&&(t="roundEnd"),e.value=teasp.util.time.supportTime(e.value,null,t,dojo.attr(e,"fxtimes")))},teasp.util.time.onblurTime=function(e){
teasp.util.time.inputSupportTime(e.target)},teasp.util.time.onkeypressTime=function(e){13===e.keyCode?(teasp.util.time.inputSupportTime(e.target),e.preventDefault(),e.stopPropagation()):void 0===e.target.size&&void 0===e.target.rows&&e.keyCode==dojo.keys.BACKSPACE&&(e.preventDefault(),e.stopPropagation())},teasp.util.time.timeValue=function(e,t,a){t=t||"hh:mm";if(0===e)return a?"":"hh:mm"===t?"0:00":"0.00";if(!e
)return"";var a=e<0,o=(a&&(e=Math.abs(e)),Math.floor(e/60)),e=Math.round(e)%60;return"hh:mm"!==t?(a?"-":"")+o+"."+((e=Math.round(100*e/60))<10?"0":"")+e:(a?"-":"")+o+":"+(e<10?"0":"")+e},teasp.util.time.clock2minutes=function(e){var t;if(t=/(\d+)(:|\.)(\d+)/.exec(e))return":"===t[2]?60*parseInt(t[1],10)+parseInt(t[3],10):Math.round(60*parseFloat(e))},teasp.util.time.sliceTime=function(e,t){
return"number"!=typeof t.from||"number"!=typeof t.to?[{from:e.from,to:e.to,id:e.id}]:e.from<t.from&&e.to>t.to?[{from:e.from,to:t.from,id:e.id},{from:t.to,to:e.to,id:e.id}]:e.from<t.from&&e.to==t.to||e.from<t.from&&e.to<t.to&&e.to>t.from?[{from:e.from,to:t.from,id:e.id}]:e.from==t.from&&e.to>t.to||e.from>t.from&&e.from<t.to&&e.to>t.to?[{from:t.to,to:e.to,id:e.id}
]:e.from<t.from&&e.to<t.to&&e.to==t.from||e.from<t.from&&e.to<t.to&&e.to<t.from||e.from>t.from&&e.from==t.to&&e.to>t.to||e.from>t.from&&e.from>t.to?[{from:e.from,to:e.to,id:e.id}]:[]},teasp.util.time.sliceTimes=function(e,t){for(var a,o=[],s=0;s<e.length;s++){var i=teasp.util.time.sliceTime(e[s],t);if(o.length<=0)o=i;else for(a=0;a<i.length;a++)o.push(i[a])}return o},teasp.util.time.rangeTime=function(e,t){for(var a,
o=0,s=0;s<t.length;s++)"number"==typeof(a=t[s]).from&&"number"==typeof a.to&&(e.from<a.from&&a.to<e.to?o+=a.to-a.from:e.from>a.from&&e.to<a.to?o+=e.to-e.from:e.from<=a.from&&e.to<=a.to&&a.from<e.to?o+=e.to-a.from:e.from>=a.from&&e.to>=a.to&&e.from<a.to&&(o+=a.to-e.from));return o},teasp.util.time.margeTimeSpans=function(e){for(var t=(t=dojo.clone(e)).sort(function(e,t){
return e.from!=t.from?e.from-t.from:e.to!=t.to?e.to-t.to:0}),a=[],o=0;o<t.length;o++){var s=t[o];a.length<=0||a[a.length-1].to<s.from||a[a.length-1].from>s.to?a.push(s):a[a.length-1].to<s.to&&(a[a.length-1].to=s.to)}return a},teasp.util.time.excludeRanges=function(e,t){var a=e?dojo.clone(e):[];if(0<a.length)for(var o=0;o<t.length;o++)a=teasp.util.time.sliceTimes(a,t[o]);return a},
teasp.util.time.isValidRange=function(e,t){return"number"==typeof e&&"number"==typeof t&&e<t},teasp.util.time.isInputTime=function(e,t,a){return a?teasp.util.time.isValidRange(e,t):"number"==typeof e||"number"==typeof t},teasp.util.time.includeRanges=function(e,t,a){for(var a=a||2880,o=(t=t.sort(function(e,t){return e.from-t.from}),[]),s=0,i=0;i<t.length;i++){var n=t[i];s<n.from&&o.push({from:s,to:n.from}),s=n.to}
return 0<=s&&s<a&&o.push({from:s,to:a}),teasp.util.time.excludeRanges(e,o)},teasp.provide("teasp.action.contact"),teasp.action.contact=function(){},teasp.action.contact.remoteMethod=function(e,t,a,o){t="string"==typeof t?t:t.length?t.join(","):dojo.toJson(t);teasp.timestamp(e+" queryString = "+t);try{RtkPotalCtl[e](t,function(e,t){teasp.timestamp("recv-response"),t.status?("NG"==e.result&&(console.log(e),
e.error.message=teasp.message.getErrorMessage(e.error)),a(e)):(console.log(t),teasp.constant.TIMEOUT_CAUSE.test(t.message)&&(t.message=teasp.message.getLabel("tm00000011",t.message)),o(t))},{escape:!1})}catch(e){console.log(e.message),console.log(e),o(e)}},teasp.action.contact.remoteMethod2=function(e,t,a,o,s){var i=!1,t="string"==typeof t?t:is_array(t)&&0<t.length&&"string"==typeof t[0]?t.join(","):(i=t.keepNs,
dojo.toJson(t));console.log(e+" queryString = "+t);try{teasp.controlClass[e](t,function(e,t){try{t.status?"NG"!=e.result?(i||teasp.util.excludeNameSpace(e),o(e)):(console.log(t),s?s(e):teasp.util.showErrorArea(e.error,a)):(teasp.constant.TIMEOUT_CAUSE.test(t.message)&&(t.message=teasp.message.getLabel("tm00000011",t.message)),console.log(t),s?s(t):teasp.util.showErrorArea(t,a))}catch(e){console.log(e),s?s(e
):teasp.util.showErrorArea(e,a)}},{escape:!1})}catch(e){console.log(e),s?s(e):teasp.util.showErrorArea(e,a)}},teasp.action.contact.remoteMethods=function(t,e,a,o,s){var i,n=e&&e.errorAreaId||null,r=e&&e.nowait||!1,l=e&&e.contIfErr||!1,p=(r||teasp.manager.dialogOpen("BusyWait"),teasp.util.showErrorArea(null,n),0);(i=function(){teasp.action.contact.remoteMethod2(t[p].funcName,t[p].params,n,function(e){p+1<t.length?(
a.apply(s,[e,p]),p++,setTimeout(i,100)):(a.apply(s,[e,p]),r||teasp.manager.dialogClose("BusyWait"))},function(e){l||teasp.manager.dialogClose("BusyWait"),o?(o.apply(s,[e,p]),l&&(p+1<t.length?(p++,setTimeout(i,100)):teasp.manager.dialogClose("BusyWait"))):teasp.util.showErrorArea(e,n)})})()},teasp.provide("teasp.action.Manager"),teasp.action.Manager=function(){this.dialogs={},this.option={debugLev:0},
this.completeFlag=!0,this.shim=!1},teasp.manager=new teasp.action.Manager,teasp.action.Manager.prototype.dialogOpen=function(e,t,a,o,s){this.shim&&"BusyWait"==e?dojo.style("shim","display",""):(this.dialogs[e]||(this.dialogs[e]=new teasp.dialog[e]),this.dialogs[e].open(a,t,s,o))},teasp.action.Manager.prototype.dialogClose=function(e){this.shim&&"BusyWait"==e?dojo.style("shim","display","none"
):this.dialogs[e]&&this.dialogs[e].close()},teasp.action.Manager.prototype.dialogRemove=function(e){delete this.dialogs[e]},teasp.action.Manager.prototype.uiBlock=function(e,t){t.hideBusy?t.shim&&(dojo.style("shim","z-index",e?2001:48),dojo.style("shim","display",e?"":"none")):e?this.dialogOpen("BusyWait"):this.dialogClose("BusyWait")},teasp.action.Manager.prototype.completeCheckLoop=function(e,t){var a;
this.completeFlag||300<e.cnt?t():(e.cnt++,a=this,setTimeout(function(){a.completeCheckLoop(e,t)},100))},teasp.action.Manager.prototype.completeCheck=function(e){this.completeFlag?e():(console.log("wait!"),this.completeCheckLoop({cnt:0},e))},teasp.action.Manager.prototype.useShim=function(e){this.shim=e},teasp.action.Manager.prototype.tsConfirmAlert=function(e,t,a,o){this.dialogs.ConfirmAlert||(
this.dialogs.ConfirmAlert=new teasp.dialog.ConfirmAlert);e={type:e};"object"==typeof t?dojo.mixin(e,t):e.message=t,this.dialogs.ConfirmAlert.open(a&&a.pouch||null,e,o,a)},teasp.tsAlert=function(e,t,a){teasp.manager.tsConfirmAlert(0,e,t,a)},teasp.tsConfirm=function(e,t,a){teasp.manager.tsConfirmAlert(1,e,t,a)},teasp.tsConfirmA=function(e,t,a,o){teasp.manager.tsConfirmAlert(1,e,t,function(e){a&&e?a.apply(t
):o&&!e&&o.apply(t)})},teasp.tsConfirmClick=function(e,t,a){return teasp.tsConfirm(e,null,function(e){e&&(a&&dojo.style(a,"display","none"),t&&dojo.byId(t).click())}),!1},teasp.provide("teasp.dialog.Base"),teasp.dialog.Base=function(){this.inited=!1,this.dialog=null,this.id=null,this.args={},this.callback=null,this.thisObject=null,this.bodyId="bodyCell",this.pouch=null,this.title="",this.duration=1,this.content=null,
this.widthHint=null,this.heightHint=null,this.okLink=null,this.cancelLink=null,this.closeLink=null},teasp.dialog.Hack=function(e){this.title=e&&e.title||null,this.id=e&&e.id||null,this.duration=e&&e.duration||null,this.content=null,this.id||(this.id="Dialog"+teasp.sequence.dialog++);var t,e=dojo.byId(this.id);e||(t=(t=dojo.byId("tsfDialog"))||dojo.byId("tsfArea").parentNode,e=dojo.create("div",{id:this.id,
className:"ver-dialog",style:"padding-bottom:80px;min-width:300px;"},t),this.content&&(dojo.byId(this.id).innerHTML=this.content)),this.domNode=e},teasp.dialog.Hack.prototype.attr=function(e,t){this[e]=t,"content"!=e||dojo.byId(this.id).innerHTML||(dojo.byId(this.id).innerHTML=this.content)},teasp.dialog.Hack.prototype.startup=function(){},teasp.dialog.Hack.prototype.show=function(){
teasp.dialogStack.length<=0&&teasp.dialogStack.push("tsfArea"),teasp.dialogStack.unshift(this.id),dojo.style(teasp.dialogStack[1],"display","none"),dojo.style(teasp.dialogStack[0],"display",""),document.body.scrollTop=0},teasp.dialog.Hack.prototype.destroy=function(){var e=dojo.byId(this.id);e&&dojo.destroy(e)},teasp.dialog.Hack.prototype.hide=function(){var e=teasp.dialogStack.shift();
e&&0<teasp.dialogStack.length&&dojo.byId(e)&&dojo.style(e,"display","none"),0<teasp.dialogStack.length&&(e=teasp.dialogStack[0],dojo.style(e,"display",""),"tsfArea"==e&&((e=dojo.byId("graphDiv"))&&(e.scrollLeft=140),(e=dojo.byId("timeGridView"))&&(e.scrollTop=280),teasp.viewPoint&&teasp.viewPoint.viewPostProcess&&teasp.viewPoint.viewPostProcess()))},teasp.dialog.Base.prototype._init=function(){var e,t;this.inited||(
require(["dijit/Dialog"]),this.free(),this.preInit(),this.inited=!0,t={title:this.title,id:this.id,duration:this.duration},this.dialog=new(this.noDialog()?teasp.dialog.Hack:dijit.Dialog)(t),this.dialog.attr("content",this.content),this.okLink&&dojo.byId(this.okLink.id)&&this.baseHandles.push(dojo.connect(dojo.byId(this.okLink.id),"onclick",this,this.okLink.callback)),this.cancelLink&&dojo.byId(this.cancelLink.id
)&&this.baseHandles.push(dojo.connect(dojo.byId(this.cancelLink.id),"onclick",this,this.cancelLink.callback)),this.closeLink&&dojo.byId(this.closeLink.id)&&this.baseHandles.push(dojo.connect(dojo.byId(this.closeLink.id),"onclick",this,this.closeLink.callback)),this.noDialog()&&(t=dojo.byId(this.id))&&((e=dojo.byId(this.id+"_title"))&&dojo.destroy(e),e=dojo.create("div",{id:this.id+"_title",
style:"margin-top:2px;margin-bottom:4px;position:relative;",className:"dijitDialogTitleBar"},t.firstChild,"before"),this.title&&(e.innerHTML=this.title),t=dojo.create("div",{className:"ts-status-img ts-ap_tab_rm",style:"right:2px;top:8px;position:absolute;width:16px;height:14px;"},e),this.baseHandles.push(dojo.connect(t,"onclick",this,this.close))),this.preStart(),this.dialog.startup(),this.postStart())},
teasp.dialog.Base.prototype.free=function(){if(this.baseHandles&&this.baseHandles.length)for(var e=0;e<this.baseHandles.length;e++)dojo.disconnect(this.baseHandles[e]),delete this.baseHandles[e];this.baseHandles=[]},teasp.dialog.Base.prototype.noDialog=function(){return this.pouch&&this.pouch.isNonDialogMode&&this.pouch.isNonDialogMode()&&dojo.byId("tsfArea")&&!this.nohack},teasp.dialog.Base.prototype.show=function(
){this.dialog.show()},teasp.dialog.Base.prototype.hide=function(){this.dialog.hide()},teasp.dialog.Base.prototype.open=function(e,t,a,o){this.pouch=e,this.args=t||{},this.callback=a,this.thisObject=o,this.nohack=this.args.nohack||this.nohack,this.ready(),this._init(),this.preShow()&&(this.show(),this.postShow())},teasp.dialog.Base.prototype.close=function(){this.hide()},teasp.dialog.Base.prototype.ready=function(){},
teasp.dialog.Base.prototype.preInit=function(){},teasp.dialog.Base.prototype.preStart=function(){},teasp.dialog.Base.prototype.postStart=function(){},teasp.dialog.Base.prototype.preShow=function(){return!0},teasp.dialog.Base.prototype.postShow=function(){},teasp.dialog.Base.prototype.ok=function(){return!0},teasp.dialog.Base.prototype.cancel=function(){return!0},teasp.dialog.Base.prototype.onfinishfunc=function(e){
this.callback&&this.callback.apply(this.thisObject||this,arguments)},teasp.provide("teasp.dialog.BusyWait"),teasp.dialog.BusyWait=function(){this.widthHint=140,this.heightHint=80,this.title=teasp.message.getLabel("tm00000040"),this.duration=1,this.content='<table border="0" cellpadding="0" cellspacing="0"><tr><td style="text-align:center;"><div class="busywait"></div></td></tr></table>',this.nohack=!0,
this.id="BusyWait"},teasp.dialog.BusyWait.prototype=new teasp.dialog.Base,teasp.dialog.BusyWait.prototype.preShow=function(){return dojo.query(".dijitDialogCloseIcon",this.dialog.id).forEach(function(e){e.style.display="none"}),!0},teasp.provide("teasp.dialog.BusyWait2"),teasp.dialog.BusyWait2=function(){this.title="",this.duration=0,
this.content='<table border="0" cellpadding="0" cellspacing="0" id="busyWaitTable"><tr><td><div class="busywait2"></div></td><td style="text-align:center;font-size:17px;color:#3B40FF;"><div id="busyWaitMessage" style="background-color:#ffffff;"></div></td></tr></table>',this.nohack=!0},teasp.dialog.BusyWait2.prototype=new teasp.dialog.Base,teasp.dialog.BusyWait2.prototype.preStart=function(){dojo.query(
".dijitDialogTitleBar",this.dialog.id)[0].style.display="none",dojo.style("busyWaitTable","background-color","transparent");var e=dojo.byId("busyWaitTable");dojo.style(e.parentNode,"background-color","transparent"),dojo.style(e.parentNode,"border","none"),dojo.style(e.parentNode.parentNode,"border","none"),dojo.style(e.parentNode.parentNode,"opacity","0"),dojo.addClass(e,"messageArea"),dojo.addClass(
this.dialog.domNode,"messageArea")},teasp.dialog.BusyWait2.prototype.preShow=function(){return this.args.nomove||(this.dialog._position=dojo.hitch(this.dialog,function(){var e=this.domNode.style;e.left="180px",e.top="50px"})),dojo.byId("busyWaitMessage").innerHTML=this.args.message||"www",!0},teasp.provide("teasp.dialog.Message"),teasp.dialog.Message=function(){this.title="",this.duration=10,
this.content='<table id="tsMessageTable"><tr><td style="text-align:center;"><div id="tsMessageMain" style="font-size:12px;color:#3B40FF;"></div><div id="tsMessageSub1" style="font-size:11px;color:#3B40FF;"></div><div id="tsMessageSub2" style="font-size:11px;color:#3B40FF;"></div></td><td style="padding-left:8px;"><input type="button" value="OK" class="std-button1" style="padding:1px 4px;" /></td></tr></table>',
this.nohack=!0},teasp.dialog.Message.prototype=new teasp.dialog.Base,teasp.dialog.Message.prototype.preStart=function(){dojo.query(".dijitDialogTitleBar",this.dialog.id)[0].style.display="none";var e=dojo.byId("tsMessageTable");dojo.style(e.parentNode,"border","none"),dojo.style(e.parentNode.parentNode,"border","none"),dojo.style(e.parentNode.parentNode,"opacity","0"),dojo.connect(dojo.query('input[type="button"]',
this.dialog.id)[0],"onclick",this,function(){this.hide(),this.onfinishfunc()})},teasp.dialog.Message.prototype.preShow=function(){return this.args.nomove||(this.dialog._position=dojo.hitch(this.dialog,function(){var e=this.domNode.style;e.left="180px",e.top="40px"})),dojo.byId("tsMessageMain").innerHTML=this.args.msg||"",dojo.byId("tsMessageSub1").innerHTML=this.args.sub1||"",dojo.byId("tsMessageSub2"
).innerHTML=this.args.sub2||"",!0},teasp.provide("teasp.dialog.Calendar"),teasp.dialog.Calendar=function(){this.id="dialogCalendar",this.title=teasp.message.getLabel("tm60001010"),this.duration=1,
this.content='<table border="0" cellpadding="0" cellspacing="0" style="font-size:12px;"><tr><td style="padding-left:4px;padding-right:4px;"><div id="_atk_cal"></div></td></tr><tr><td style="text-align:center;padding-top:0px;"><input type="button" class="pb_base pb_btn_cancel" id="_atk_cal_cancel" style="font-size:13px;padding:6px 16px;"/></td></tr></table>',this.cancelLink={id:"_atk_cal_cancel",callback:this.close},
this.calendar=null,this.busy=!1},teasp.dialog.Calendar.prototype=new teasp.dialog.Base,teasp.dialog.Calendar.prototype.preInit=function(){dojo.require("dijit.Calendar")},teasp.dialog.Calendar.prototype.preShow=function(){this.busy=!0,this.calendar&&this.calendar.destroy("_atk_cal"),this.calendar=new dijit.Calendar({isDisabledDate:this.args.isDisabledDateFunc},"_atk_cal"),dojo.connect(this.calendar,"onValueSelected",
this,this.selected),this.args.date&&this.calendar.setValue(this.args.date),this.calendar.startup(),this.dialog.startup();var a,o=this;return this.args.date&&(a=("object"==typeof this.args.date?this.args.date:teasp.util.date.parseDate(this.args.date)).getDate(),dojo.query(".dijitCalendarDateLabel","_atk_cal").forEach(function(e){var t;0<=e.parentNode.className.indexOf("dijitCalendarSelectedDate")&&(
e.textContent||e.innerText)==a&&dojo.connect(e.parentNode,"onclick",o,(t=o.args.date,function(){this.selected(t)}))})),!(this.busy=!1)},teasp.dialog.Calendar.prototype.selected=function(){this.busy||(this.dialog.hide(),this.onfinishfunc(arguments[0]))},teasp.provide("teasp.dialog.MonthInput"),teasp.dialog.MonthInput=function(){this.width=180,this.height=180,this.title=teasp.message.getLabel("tk10005450"),
this.id="MonthInputDialog",this.duration=1,
this.content='<table class="pane_table" style="width:160px;"><tr><td style="vertical-align:middle;text-align:center;padding:4px 0px;"><input dojoType="dijit.form.NumberSpinner" value="" constraints="{min:1900,max:2100,pattern:\'####\'}" id="MonthInputY" style="width:60px;border:1px solid #539AC7;font-family:verdana;font-size:13px;" /><span style="padding:0px 8px;font-size:13px;">/</span><input dojoType="dijit.form.NumberSpinner" value="" constraints="{min:1,max:12,pattern:\'00\'}" id="MonthInputM" style="width:42px;border:1px solid #539AC7;font-family:verdana;font-size:13px;" /></td></tr><tr><td style="text-align:center;padding:12px 0px 4px 0px;"><input type="button" id="MonthInputOk" value="OK" style="width:60px;margin-right:8px;padding:2px 4px;" /><input type="button" id="MonthInputCancel" value="Cancel" style="width:60px;margin-left:8px;padding:2px 4px;" /></td></tr></table>'
,this.okLink={id:"MonthInputOk",callback:this.ok},this.cancelLink={id:"MonthInputCancel",callback:this.hide}},teasp.dialog.MonthInput.prototype=new teasp.dialog.Base,teasp.dialog.MonthInput.prototype.preShow=function(){var e,t;return/(\d{6})/.test(this.args.yearMonth)?(t=""+this.args.yearMonth,dojo.byId("MonthInputY").value=t.substring(0,4),dojo.byId("MonthInputM").value=t.substring(4,6)):(e=(t=new Date).getFullYear(
),t=t.getMonth()+1,dojo.byId("MonthInputY").value=""+e,dojo.byId("MonthInputM").value=""+t),!0},teasp.dialog.MonthInput.prototype.ok=function(){var e;dijit.byId("MonthInputY").isValid()&&dijit.byId("MonthInputM").isValid()&&(e=100*parseInt(dojo.byId("MonthInputY").value,10)+parseInt(dojo.byId("MonthInputM").value,10),this.hide(),this.onfinishfunc({yearMonth:e}))},teasp.provide("teasp.dialog.UserSelect"),
teasp.dialog.UserSelect=function(e,t,a){this.thisObject=e,this.inited=!1,this.opend=!1,this.dialog=null,this.id="tooltipUserSelect",
this.content='<div id="userSelectBody"><div style="width:482px;"><div style="margin:0px 0px 4px 0px;"><table class="pane_table" style="width:100%;background-color:#eaf4fc;"><tr><td style="text-align:left;padding:2px 4px;" ><div id="userSelectTitle"></div></td><td style="text-align:right;padding:2px 4px;"><div id="userSelectClose"></div></td></tr></table></div><div style="float:left;margin-left:4px;margin-right:10px;padding-top:2px;" id="columnUserSelectName"></div><div style="float:left;padding-top:1px;margin-right:4px;"><input type="text" id="userSelectName" value="" class="inputran" style="width:100px;padding:1px 2px;" /></div><div style="float:left;"><input type="button" id="userSelectSearch" value="" style="padding:1px 8px;" /></div><div style="clear:both;"></div><div id="userSelectPageArea"><div id="userSelectPage" style="margin-left:10px;"></div></div><table class="stone_table" style="margin-top:4px;"><tr><td class="head" style="width:20px;"></td><td class="head" id="userSelectHeadUserName" style="width:100px;"><div style="margin:auto;" class="disp_table"><div style="margin:2px;" id="userSelectHead1"></div></div></td><td class="head" id="userSelectHeadProfile" style="width:120px;"><div style="margin:auto;" class="disp_table"><div style="margin:2px;" id="userSelectHead2"></div></div></td><td class="head" id="userSelectHeadTitle" style="width:100px;"><div style="margin:auto;" class="disp_table"><div style="margin:2px;" id="userSelectHead3"></div></div></td><td class="head" id="userSelectHeadManager" style="width:140px;"><div style="margin:auto;" class="disp_table"><div style="margin:2px;" id="userSelectHead4"></div></div></td></tr></table><div class="stone_div" id="userSelectDiv" style="width:480px;border:1px solid #cccccc;"></div></div><div id="userSelectErrorArea"></div><table border="0" cellpadding="0" cellspacing="0" style="width:466px;margin-top:4px;margin-bottom:2px;"><tr><td style="text-align:right;"><input type="button" id="userSelectOk" value="" style="width:74px;margin-right:24px;padding:2px 4px;" /></td><td style="text-align:left;"><input type="button" id="userSelectCancel" value="" style="width:74px;margin-left:24px;padding:2px 4px;" /></td></tr></table></div>'
,this.eventHandles=[],this.onSearch=t,this.onSelect=a,this.searchObj=null,this.targets=null,this.maxDivH=120,this.sortMap={1:"Name",2:"Profile.Name",3:"Title",4:"Manager.Name"},this._init()},teasp.dialog.UserSelect.prototype.getDialog=function(e){return e&&(this.targets=e),this.dialog},teasp.dialog.UserSelect.prototype._init=function(){var e;this.inited||(this.inited=!0,e={id:this.id,content:this.content,
onKeyPress:dojo.hitch(this,function(e){27===e.keyCode&&dijit.popup.close(this.dialog)})},this.dialog=new dijit.TooltipDialog(e),this.dialog.startup(),dojo.connect(this.dialog,"onOpen",this,function(){console.log("dialog-onOpen"),this.opened||(dojo.style("userSelectTitle","color","#555555"),dojo.style("userSelectTitle","font-weight","bold"),dojo.byId("userSelectTitle").innerHTML=teasp.message.getLabel("tk10000444"),(
e=dojo.byId("userSelectClose")).style.color="#A0A0A0",e.style.cursor="pointer",e.innerHTML="X",dojo.connect(e,"onclick",this,function(){dijit.popup.close(this.dialog)}),dojo.byId("userSelectOk").disabled=!0,dojo.byId("userSelectSearch").value=teasp.message.getLabel("search_btn_title"),dojo.byId("userSelectOk").value=teasp.message.getLabel("select_btn_title"),dojo.byId("userSelectCancel").value=teasp.message.getLabel(
"cancel_btn_title"),teasp.message.setLabelEx("columnUserSelectName","tk10000390"),teasp.message.setLabelEx("userSelectHead1","tk10000390"),teasp.message.setLabelEx("userSelectHead2","tk10000456"),teasp.message.setLabelEx("userSelectHead3","title_label"),teasp.message.setLabelEx("userSelectHead4","tk10000458"),dojo.connect(dojo.byId("userSelectSearch"),"onclick",this,function(){teasp.util.showErrorArea(null,
"userSelectErrorArea"),this.searchObj={action:"searchUserSimple",userName:dojo.byId("userSelectName").value,pageNo:1,rowMax:20},this.onSearch(this.searchObj,this.searchRes(),this.searchError())}),dojo.connect(dojo.byId("userSelectOk"),"onclick",this,function(){for(var e=dojo.byId("userSelectTbody"),t=0;t<e.rows.length;t++){var a=e.rows[t].cells[0].firstChild;a.checked&&(a={targets:this.targets,
userId:a.nextSibling.value,userName:a.nextSibling.nextSibling.value},this.onSelect(a),dijit.popup.close(this.dialog))}}),dojo.connect(dojo.byId("userSelectCancel"),"onclick",this,function(){dijit.popup.close(this.dialog)}),dojo.connect(dojo.byId("userSelectHeadUserName"),"onclick",this,this.clickHead(1)),dojo.connect(dojo.byId("userSelectHeadProfile"),"onclick",this,this.clickHead(2)),dojo.connect(dojo.byId(
"userSelectHeadTitle"),"onclick",this,this.clickHead(3)),dojo.connect(dojo.byId("userSelectHeadManager"),"onclick",this,this.clickHead(4))),teasp.util.showErrorArea(null,"userSelectErrorArea");var e=dojo.byId("userSelectDiv");e.clientHeight>this.maxDivH&&(dojo.toggleClass(e,"disp_block",!0),dojo.toggleClass(e,"disp_table",!1),dojo.style(e,"height",this.maxDivH+"px")),this.opened=!0}))},
teasp.dialog.UserSelect.prototype.searchRes=function(){var t=this;return function(e){t.refresh.apply(t,[e])}},teasp.dialog.UserSelect.prototype.searchError=function(){var t=this;return function(e){t.receiveError.apply(t,[e])}},teasp.dialog.UserSelect.prototype.refresh=function(e){for(var t=0;t<this.eventHandles.length;t++)dojo.disconnect(this.eventHandles[t]),delete this.eventHandles[t];this.eventHandles=[];for(
var a=e&&e.users||[],o=(dojo.byId("userSelectOk").disabled=!0,dojo.byId("userSelectName").value=e.userName||"",this.setPaging(dojo.byId("userSelectPage"),e),this.displaySort(e),dojo.byId("userSelectDiv"));o.firstChild;)dojo.destroy(o.firstChild);for(var e=dojo.create("table",{className:"stone_table"}),s=dojo.create("tbody",{id:"userSelectTbody"},e),t=0;t<a.length;t++){var i=a[t],n=dojo.create("tr",{
className:"sele "+(t%2==0?"even":"odd")},s),r=dojo.create("td",{style:{width:"22px",textAlign:"center",border:"none"}},n),l=dojo.create("input",{type:"radio",name:"userSelectRadio",id:"userSelectRadio"+(t+1)},r);this.eventHandles.push(dojo.connect(l,"onclick",this,function(e){dojo.byId("userSelectOk").disabled=!1,dojo.isIE<=7&&(e=(e=e||window.event).target||e.srcElement,this.checkSelectRadio(e.id))})),dojo.create(
"input",{type:"hidden",value:i.Id},r),dojo.create("input",{type:"hidden",value:i.Name},r),r=dojo.create("td",{width:"102px",style:{border:"none",textAlign:"left"}},n),dojo.create("div",{innerHTML:i.Name,style:{wordBreak:"break-all"}},r),r=dojo.create("td",{width:"122px",style:{border:"none",textAlign:"left"}},n),dojo.create("div",{innerHTML:i.Profile.Name,style:{wordBreak:"break-all"}},r),r=dojo.create("td",{
width:"102px",style:{border:"none",textAlign:"left"}},n),dojo.create("div",{innerHTML:i.Title||"",style:{wordBreak:"break-all"}},r),r=dojo.create("td",{width:"126px",style:{border:"none",textAlign:"left"}},n),dojo.create("div",{innerHTML:i.Manager&&i.Manager.Name||"",style:{wordBreak:"break-all"}},r),this.eventHandles.push(dojo.connect(n,"onclick",this,function(e){for(var t=(e=e||window.event
).target||e.srcElement;t&&"TR"!=t.nodeName;)t=t.parentNode;t&&"TR"==t.nodeName&&(t.cells[0].firstChild.checked=!0,dojo.byId("userSelectOk").disabled=!1,dojo.isIE<=7&&this.checkSelectRadio(t.cells[0].firstChild.id))}))}o.appendChild(e),this.adjustHeight()},teasp.dialog.UserSelect.prototype.checkSelectRadio=function(e){if(e){var t=dojo.byId("userSelectTbody");if(t&&"TBODY"==t.nodeName)for(var a=t.rows.length,
o=1;o<=a;o++){var s="userSelectRadio"+o;dojo.byId(s).checked=s==e}}},teasp.dialog.UserSelect.prototype.adjustHeight=function(){var e=dojo.byId("userSelectTbody"),t=0;if(dojo.isIE)for(var a=0;a<e.rows.length;a++){for(var o=0,s=0;s<e.rows[a].cells.length;s++){var i=e.rows[a].cells[s].clientHeight;o<i&&(o=i)}t+=o}else for(a=0;a<e.rows.length;a++)t+=e.rows[a].clientHeight;var n=dojo.byId("userSelectDiv");
dojo.toggleClass(n,"disp_table",t<this.maxDivH),dojo.toggleClass(n,"disp_block",t>=this.maxDivH),dojo.style(n,"height",(t<this.maxDivH?t:this.maxDivH)+"px")},teasp.dialog.UserSelect.prototype.search=function(e){var t=e,a=this;return function(){a.searchObj.pageNo=t,a.onSearch(a.searchObj,a.searchRes(),a.searchError())}},teasp.dialog.UserSelect.prototype.clickHead=function(e){var t=e,a=this;return function(){var e;
a.searchObj&&(e=a.sortMap[t],a.searchObj.sortKey==e?a.searchObj.sortOrder="desc"==a.searchObj.sortOrder?null:"desc":a.searchObj.sortOrder=null,a.searchObj.pageNo=1,a.searchObj.sortKey=e,a.onSearch(a.searchObj,a.searchRes(),a.searchError()))}},teasp.dialog.UserSelect.prototype.setPaging=function(e,t){for(;e.firstChild;)dojo.destroy(e.firstChild);for(var a=Math.ceil(t.cntAll/t.rowMax),o=dojo.create("div",{
className:"pageDiv",innerHTML:"&lt;"},e),s=(1<t.pageNo?(dojo.style(o,"color","blue"),dojo.style(o,"cursor","pointer"),this.eventHandles.push(dojo.connect(o,"onclick",this,this.search(t.pageNo-1)))):dojo.style(o,"color","gray"),teasp.util.getPageBox(a,t.pageNo,4,5,4)),i=0;i<s.length;i++){var n,r=s[i];null===r?dojo.create("div",{className:"pageDiv",innerHTML:"･･",style:{color:"gray"}},e):(n=dojo.create("div",{
className:"pageDiv",innerHTML:r},e),t.pageNo==r?dojo.style(n,"color","gray"):(dojo.style(n,"color","blue"),dojo.style(n,"cursor","pointer"),this.eventHandles.push(dojo.connect(n,"onclick",this,this.search(r)))))}var o=dojo.create("div",{className:"pageDiv",innerHTML:"&gt;"},e),a=(t.pageNo<a?(dojo.style(o,"color","blue"),dojo.style(o,"cursor","pointer"),this.eventHandles.push(dojo.connect(o,"onclick",this,this.search(
t.pageNo+1)))):dojo.style(o,"color","gray"),(t.pageNo-1)*t.rowMax+1),o=a+t.rowMax-1,l=(o>t.cntAll&&(o=t.cntAll),"");0<t.cntAll&&(l=t.cntAll<=t.rowMax?teasp.message.getLabel("tk10003230",t.cntAll):teasp.message.getLabel(t.cntAll==teasp.constant.COUNT_LIMIT?"tk10003241":"tk10003240",t.cntAll,a||1,o||1)),dojo.create("div",{className:"pageDiv",style:{width:"10px",height:"2px"}},e),dojo.create("div",{innerHTML:l,style:{
whiteSpace:"nowrap",float:"left"},className:"disp_table"},e),dojo.create("div",{style:{clear:"both"}},e)},teasp.dialog.UserSelect.prototype.displaySort=function(o){var s=this;dojo.query(".head","userSelectBody").forEach(function(e){var t,a;"TD"==e.nodeName&&e.firstChild&&(t=e.firstChild.firstChild)&&(a=t.nextSibling,s.sortMap[e.cellIndex]==o.sortKey?a?a.className="pp_base pp_ico_sort_"+(o.sortOrder?"desc":"asc"):(
dojo.style(t,"float","left"),a=dojo.create("div",{className:"pp_base pp_ico_sort_"+(o.sortOrder?"desc":"asc"),style:{float:"left",marginRight:"auto",marginTop:"4px"}},e.firstChild),dojo.create("div",{style:{clear:"both"}},e.firstChild)):a&&(a.nextSibling&&dojo.destroy(a.nextSibling),dojo.destroy(a),dojo.style(t,"float","none")))})},teasp.dialog.UserSelect.prototype.receiveError=function(e){teasp.util.showErrorArea(e,
"userSelectErrorArea")},teasp.provide("teasp.dialog.AnySelect"),teasp.dialog.AnySelect=function(e,t,a,o,s,i){this.thisObject=e,this.inited=!1,this.opend=!1,this.dialog=null,this.id="tooltipAnySelect",
this.content='<div id="anySelectBody"><div style="width:479px;"><div style="margin:0px 0px 4px 0px;"><table class="pane_table" style="width:100%;background-color:#eaf4fc;"><tr><td style="text-align:left;padding:2px 4px;" ><div id="anySelectTitle"></div></td><td style="text-align:right;padding:2px 4px;"><div id="anySelectClose"></div></td></tr></table></div><div style="float:left;margin-left:4px;margin-right:10px;padding-top:2px;" id="anySelectNameH"></div><div style="float:left;padding-top:1px;margin-right:4px;"><input type="text" id="anySelectName" value="" class="inputran" style="width:160px;padding:1px 2px;" /></div><div style="float:left;"><input type="button" id="anySelectSearch" value="" style="padding:1px 8px;" /></div><div style="clear:both;"></div><div id="anySelectPageArea"><div id="anySelectPage" style="margin-left:10px;"></div></div><table class="stone_table" style="margin-top:4px;"><tr><td class="head" style="width:20px;"></td><td class="head" id="anySelectHeadName" style="width:457px;"><div style="margin:auto;" class="disp_table"><div style="margin:2px;"></div></div></td></tr></table><div class="stone_div" id="anySelectDiv" style="width:477px;border:1px solid #cccccc;" class="disp_table"></div></div><div id="anySelectErrorArea"></div><table border="0" cellpadding="0" cellspacing="0" style="width:479px;margin-top:4px;margin-bottom:2px;"><tr><td style="text-align:right;"><input type="button" id="anySelectOk" value="" style="width:74px;margin-right:24px;padding:2px 4px;" /></td><td style="text-align:left;"><input type="button" id="anySelectCancel" value="" style="width:74px;margin-left:24px;padding:2px 4px;" /></td></tr></table></div>'
,this.eventHandles=[],this.onSearch=t,this.onSelect=a,this.objTitle=o,this.objName=s,this.condition=i,this.searchObj=null,this.targets=null,this.maxDivH=120,this.sortMap={1:"Name"},this._init()},teasp.dialog.AnySelect.prototype.getDialog=function(e){return e&&(this.targets=e),this.dialog},teasp.dialog.AnySelect.prototype._init=function(){var e;this.inited||(this.inited=!0,e={id:this.id,content:this.content,
onKeyPress:dojo.hitch(this,function(e){27===e.keyCode&&dijit.popup.close(this.dialog)})},this.dialog=new dijit.TooltipDialog(e),this.dialog.startup(),dojo.connect(this.dialog,"onOpen",this,function(){console.log("dialog-onOpen"),this.opened||(dojo.style("anySelectTitle","color","#555555"),dojo.style("anySelectTitle","font-weight","bold"),dojo.byId("anySelectTitle").innerHTML=teasp.message.getLabel("tk10004250",
this.objTitle),dojo.byId("anySelectNameH").innerHTML=this.objTitle,dojo.byId("anySelectHeadName").firstChild.firstChild.innerHTML=this.objTitle,(e=dojo.byId("anySelectClose")).style.color="#A0A0A0",e.style.cursor="pointer",e.innerHTML="X",dojo.connect(e,"onclick",this,function(){dijit.popup.close(this.dialog)}),dojo.byId("anySelectOk").disabled=!0,dojo.byId("anySelectSearch").value=teasp.message.getLabel(
"search_btn_title"),dojo.byId("anySelectOk").value=teasp.message.getLabel("select_btn_title"),dojo.byId("anySelectCancel").value=teasp.message.getLabel("cancel_btn_title"),dojo.connect(dojo.byId("anySelectSearch"),"onclick",this,function(){teasp.util.showErrorArea(null,"anySelectErrorArea"),this.searchObj={action:"searchAnySimple",name:dojo.byId("anySelectName").value,pageNo:1,rowMax:20,objName:this.objName,
condition:this.condition},this.onSearch(this.searchObj,this.searchRes(),this.searchError())}),dojo.connect(dojo.byId("anySelectOk"),"onclick",this,function(){for(var e=dojo.byId("anySelectTbody"),t=0;t<e.rows.length;t++){var a=e.rows[t].cells[0].firstChild;a.checked&&(a={targets:this.targets,id:a.nextSibling.value,name:a.nextSibling.nextSibling.value},this.onSelect(a),dijit.popup.close(this.dialog))}}),dojo.connect(
dojo.byId("anySelectCancel"),"onclick",this,function(){dijit.popup.close(this.dialog)}),dojo.connect(dojo.byId("anySelectHeadName"),"onclick",this,this.clickHead(1))),teasp.util.showErrorArea(null,"anySelectErrorArea");var e=dojo.byId("anySelectDiv");e.clientHeight>this.maxDivH&&(dojo.toggleClass(e,"disp_block",!0),dojo.toggleClass(e,"disp_table",!1),dojo.style(e,"height",this.maxDivH+"px")),this.opened=!0}))},
teasp.dialog.AnySelect.prototype.searchRes=function(){var t=this;return function(e){t.refresh.apply(t,[e])}},teasp.dialog.AnySelect.prototype.searchError=function(){var t=this;return function(e){t.receiveError.apply(t,[e])}},teasp.dialog.AnySelect.prototype.refresh=function(e){for(var t=0;t<this.eventHandles.length;t++)dojo.disconnect(this.eventHandles[t]),delete this.eventHandles[t];this.eventHandles=[];for(
var a=e&&e.objs||[],o=(dojo.byId("anySelectOk").disabled=!0,dojo.byId("anySelectName").value=e.name||"",this.setPaging(dojo.byId("anySelectPage"),e),this.displaySort(e),dojo.byId("anySelectDiv"));o.firstChild;)dojo.destroy(o.firstChild);for(var e=dojo.create("table",{className:"stone_table"}),s=dojo.create("tbody",{id:"anySelectTbody"},e),t=0;t<a.length;t++){var i=a[t],n=dojo.create("tr",{className:"sele "+(
t%2==0?"even":"odd")},s),r=dojo.create("td",{style:{width:"22px",textAlign:"center",border:"none"}},n),l=dojo.create("input",{type:"radio",name:"anySelectRadio",id:"anySelectRadio"+(t+1)},r);this.eventHandles.push(dojo.connect(l,"onclick",this,function(e){dojo.byId("anySelectOk").disabled=!1,dojo.isIE<=7&&(e=(e=e||window.event).target||e.srcElement,this.checkSelectRadio(e.id))})),dojo.create("input",{type:"hidden",
value:i.Id},r),dojo.create("input",{type:"hidden",value:i.Name},r),r=dojo.create("td",{width:"440px;",style:{textAlign:"left",border:"none"}},n),dojo.create("div",{innerHTML:i.Name,style:{wordBreak:"break-all"}},r),this.eventHandles.push(dojo.connect(n,"onclick",this,function(e){for(var t=(e=e||window.event).target||e.srcElement;t&&"TR"!=t.nodeName;)t=t.parentNode;t&&"TR"==t.nodeName&&(
t.cells[0].firstChild.checked=!0,dojo.byId("anySelectOk").disabled=!1,dojo.isIE<=7&&this.checkSelectRadio(t.cells[0].firstChild.id))}))}o.appendChild(e),this.adjustHeight()},teasp.dialog.AnySelect.prototype.checkSelectRadio=function(e){if(e){var t=dojo.byId("anySelectTbody");if(t&&"TBODY"==t.nodeName)for(var a=t.rows.length,o=1;o<=a;o++){var s="anySelectRadio"+o;dojo.byId(s).checked=s==e}}},
teasp.dialog.AnySelect.prototype.adjustHeight=function(){var e=dojo.byId("anySelectTbody"),t=0;if(dojo.isIE)for(var a=0;a<e.rows.length;a++){for(var o=0,s=0;s<e.rows[a].cells.length;s++){var i=e.rows[a].cells[s].clientHeight;o<i&&(o=i)}t+=o}else for(a=0;a<e.rows.length;a++)t+=e.rows[a].clientHeight;var n=dojo.byId("anySelectDiv");dojo.toggleClass(n,"disp_table",t<this.maxDivH),dojo.toggleClass(n,"disp_block",
t>=this.maxDivH),dojo.style(n,"height",(t<this.maxDivH?t:this.maxDivH)+"px")},teasp.dialog.AnySelect.prototype.search=function(e){var t=e,a=this;return function(){a.searchObj.pageNo=t,a.onSearch(a.searchObj,a.searchRes(),a.searchError())}},teasp.dialog.AnySelect.prototype.clickHead=function(e){var t=e,a=this;return function(){var e;a.searchObj&&(e=a.sortMap[t],
a.searchObj.sortKey==e?a.searchObj.sortOrder="desc"==a.searchObj.sortOrder?null:"desc":a.searchObj.sortOrder=null,a.searchObj.pageNo=1,a.searchObj.sortKey=e,a.onSearch(a.searchObj,a.searchRes(),a.searchError()))}},teasp.dialog.AnySelect.prototype.setPaging=function(e,t){for(;e.firstChild;)dojo.destroy(e.firstChild);for(var a=Math.ceil(t.cntAll/t.rowMax),o=dojo.create("div",{className:"pageDiv",innerHTML:"&lt;"},e),
s=(1<t.pageNo?(dojo.style(o,"color","blue"),dojo.style(o,"cursor","pointer"),this.eventHandles.push(dojo.connect(o,"onclick",this,this.search(t.pageNo-1)))):dojo.style(o,"color","gray"),teasp.util.getPageBox(a,t.pageNo,4,5,4)),i=0;i<s.length;i++){var n,r=s[i];null===r?dojo.create("div",{className:"pageDiv",innerHTML:"･･",style:{color:"gray"}},e):(n=dojo.create("div",{className:"pageDiv",innerHTML:r},e),
t.pageNo==r?dojo.style(n,"color","gray"):(dojo.style(n,"color","blue"),dojo.style(n,"cursor","pointer"),this.eventHandles.push(dojo.connect(n,"onclick",this,this.search(r)))))}var o=dojo.create("div",{className:"pageDiv",innerHTML:"&gt;"},e),a=(t.pageNo<a?(dojo.style(o,"color","blue"),dojo.style(o,"cursor","pointer"),this.eventHandles.push(dojo.connect(o,"onclick",this,this.search(t.pageNo+1)))):dojo.style(o,"color",
"gray"),(t.pageNo-1)*t.rowMax+1),o=a+t.rowMax-1,l=(o>t.cntAll&&(o=t.cntAll),"");0<t.cntAll&&(l=t.cntAll<=t.rowMax?teasp.message.getLabel("tk10003230",t.cntAll):teasp.message.getLabel(t.cntAll==teasp.constant.COUNT_LIMIT?"tk10003241":"tk10003240",t.cntAll,a||1,o||1)),dojo.create("div",{className:"pageDiv",style:{width:"10px",height:"2px"}},e),dojo.create("div",{innerHTML:l,style:{whiteSpace:"nowrap",float:"left"},
className:"disp_table"},e),dojo.create("div",{style:{clear:"both"}},e)},teasp.dialog.AnySelect.prototype.displaySort=function(o){var s=this;dojo.query(".head","anySelectBody").forEach(function(e){var t,a;"TD"==e.nodeName&&e.firstChild&&(t=e.firstChild.firstChild)&&(a=t.nextSibling,s.sortMap[e.cellIndex]==o.sortKey?a?a.className="pp_base pp_ico_sort_"+(o.sortOrder?"desc":"asc"):(dojo.style(t,"float","left"),
a=dojo.create("div",{className:"pp_base pp_ico_sort_"+(o.sortOrder?"desc":"asc"),style:{float:"left",marginRight:"auto",marginTop:"4px"}},e.firstChild),dojo.create("div",{style:{clear:"both"}},e.firstChild)):a&&(a.nextSibling&&dojo.destroy(a.nextSibling),dojo.destroy(a),dojo.style(t,"float","none")))})},teasp.dialog.AnySelect.prototype.receiveError=function(e){console.log(e),teasp.util.showErrorArea(e,
"anySelectErrorArea")},teasp.provide("teasp.dialog.VerSelect"),teasp.dialog.VerSelect=function(e,t,a,o){this.thisObject=e,this.inited=!1,this.opend=!1,this.dialog=null,this.id="tooltipVerSelect",
this.content='<div id="verSelectBody"><div><div style="margin:0px 0px 4px 0px;"><table class="pane_table" style="width:100%;background-color:#eaf4fc;"><tr><td style="text-align:left;padding:2px 4px;" ><div id="verSelectTitle"></div></td><td style="text-align:right;padding:2px 4px;"><div id="verSelectClose"></div></td></tr></table></div><div id="verSelectInputArea"></div><div id="verSelectPageArea"><div id="verSelectPage" style="margin-left:10px;"></div></div><table class="stone_table" style="margin-top:4px;"><tbody id="verSelectHead"></tbody></table><div class="stone_div" id="verSelectDiv" style="border:1px solid #cccccc;" class="disp_table"></div></div><div id="verSelectErrorArea"></div><table border="0" cellpadding="0" cellspacing="0" style="margin-top:4px;margin-bottom:2px;" id="verSelectButtonArea"><tr><td style="text-align:right;"><input type="button" id="verSelectOk" value="" style="width:74px;margin-right:24px;padding:2px 4px;" /></td><td style="text-align:left;"><input type="button" id="verSelectCancel" value="" style="width:74px;margin-left:24px;padding:2px 4px;" /></td></tr></table></div>'
,this.eventHandles=[],this.hidObj=t,this.onSearch=a,this.onSelect=o,this.searchObj=null,this.result=null,this.targets=null,this.maxDivH=120,this.sortList=[],this.HIDEKEYS=["Id","Name"],teasp.prefixBar="teamspirit__",this.srchData={title:teasp.message.getLabel("tm20001030"),searchFields:[{name:teasp.message.getLabel("tm20001020"),key:"jobCode",type:"text",size:70},{name:teasp.message.getLabel("tm20001030"),
key:"jobName",type:"text",size:120}],columns:[{name:teasp.message.getLabel("tm20001020"),key:"jobCode",apiKey:"JobCode__c",align:"left",size:180},{name:teasp.message.getLabel("tm20001030"),key:"jobName",apiKey:"Name",align:"left",size:340}],searchList:[{soqlFields:["Id","JobCode__c","Name","JobAssignClass__c","StartDate__c","EndDate__c"],soqlFrom:"AtkJob__c",soqlWhere1:"Active__c = true and AssignLimit__c = false",
soqlWhere2:"JobCode__c like '{0}%'",soqlWhere3:"Name like '%{0}%'",soqlWhere4:"(StartDate__c = null or StartDate__c <= {0}) and (EndDate__c = null or EndDate__c >= {0})",procSkip:function(){return!1},procWhere:dojo.hitch(this,function(e){var t=teasp.util.date.formatDate(teasp.util.date.getToday()),a=[],o=(a.push(e.soqlWhere1),dojo.byId("verSelectInput_jobCode"));return o&&o.value&&a.push(
teasp.dialog.VerSelect.getString(e.soqlWhere2,o.value)),(o=dojo.byId("verSelectInput_jobName"))&&o.value&&a.push(teasp.dialog.VerSelect.getString(e.soqlWhere3,o.value)),a.push(teasp.dialog.VerSelect.getString(e.soqlWhere4,t)),a.push(this.jobAssignClass?"(JobAssignClass__c like '%:"+this.jobAssignClass+":%' or JobAssignClass__c = null)":"JobAssignClass__c = null"),a.join(" and ")}),procList:dojo.hitch(this,function(e
){return teasp.util.excludeNameSpace(e),this.HIDEKEYS=["Id","Name","JobAssignClass__c","StartDate__c","EndDate__c"],e})},{soqlFields:["JobId__c","JobId__r.JobCode__c","JobId__r.Name","JobId__r.JobAssignClass__c","JobId__r.StartDate__c","JobId__r.EndDate__c"],soqlFrom:"AtkJobAssign__c",soqlWhere1:"EmpId__c = '{0}' and JobId__r.Active__c = true and JobId__r.AssignLimit__c = true",
soqlWhere2:"JobId__r.JobCode__c like '{0}%'",soqlWhere3:"JobId__r.Name like '%{0}%'",soqlWhere4:"(JobId__r.StartDate__c = null or JobId__r.StartDate__c <= {0}) and (JobId__r.EndDate__c = null or JobId__r.EndDate__c >= {0})",procSkip:function(){var e=dojo.byId("verSelectInput_empId");return!e||!e.value},procWhere:dojo.hitch(this,function(e){var t=teasp.util.date.formatDate(teasp.util.date.getToday()),a=[],o=dojo.byId(
"verSelectInput_empId");return o&&o.value&&a.push(teasp.dialog.VerSelect.getString(e.soqlWhere1,o.value)),(o=dojo.byId("verSelectInput_jobCode"))&&o.value&&a.push(teasp.dialog.VerSelect.getString(e.soqlWhere2,o.value)),(o=dojo.byId("verSelectInput_jobName"))&&o.value&&a.push(teasp.dialog.VerSelect.getString(e.soqlWhere3,o.value)),a.push(teasp.dialog.VerSelect.getString(e.soqlWhere4,t)),a.join(" and ")}),
procList:dojo.hitch(this,function(e){teasp.util.excludeNameSpace(e);for(var t=[],a=0;a<e.length;a++)t.push({Id:e[a].JobId__c,JobCode__c:e[a].JobId__r.JobCode__c,Name:e[a].JobId__r.Name,JobAssignClass__c:e[a].JobId__r.JobAssignClass__c,StartDate__c:e[a].JobId__r.StartDate__c,EndDate__c:e[a].JobId__r.EndDate__c});return this.HIDEKEYS=["Id","Name","JobAssignClass__c","StartDate__c","EndDate__c"],t})}],procList:function(
e){for(var t={},a=[],o=0;o<e.length;o++){var s=e[o];t[s.Id]||(t[s.Id]=1,a.push(s))}return a}},this._init()},teasp.dialog.VerSelect.prototype.setJobAssignClass=function(e){this.jobAssignClass=e},teasp.dialog.VerSelect.prototype.getDialog=function(e){return e&&(this.targets=e),this.dialog},teasp.dialog.VerSelect.prototype._init=function(){var e;this.inited||(this.inited=!0,e={id:this.id,content:this.content,
onKeyPress:dojo.hitch(this,function(e){27===e.keyCode&&dijit.popup.close(this.dialog)})},this.dialog=new dijit.TooltipDialog(e),this.dialog.startup(),dojo.connect(this.dialog,"onOpen",this,function(){if(console.log("dialog-onOpen"),!this.opened){dojo.style("verSelectTitle","color","#555555"),dojo.style("verSelectTitle","font-weight","bold"),dojo.byId("verSelectTitle").innerHTML=teasp.message.getLabel("tk10004250",
this.srchData.title);for(var e=dojo.byId("verSelectInputArea"),t=0;t<this.srchData.searchFields.length;t++){var a=this.srchData.searchFields[t],o=dojo.create("tr",null,dojo.create("tbody",null,dojo.create("table",{className:"pane_table",style:{float:"left"}},e))),s=dojo.create("td",null,o);dojo.create("div",{innerHTML:a.name,style:{padding:"1px 8px"}},s),s=dojo.create("td",null,o),dojo.create("input",{type:"text",
id:"verSelectInput_"+a.key,className:"inputran",style:{width:a.size+"px",padding:"1px 2px"}},s)}if(dojo.create("input",{type:"button",id:"verSelectSearch",style:{padding:"1px 8px",marginLeft:"8px"}},dojo.create("div",{style:{float:"left"}},e)),this.hidObj)for(var i in this.hidObj)this.hidObj.hasOwnProperty(i)&&dojo.create("input",{type:"hidden",id:"verSelectInput_"+i,value:this.hidObj[i]||""},e);dojo.create("div",{
style:{clear:"both"}},e);for(var n=dojo.byId("verSelectHead"),o=dojo.create("tr",null,n),s=dojo.create("td",{style:{width:"22px"},className:"head"},o),r=22,t=0;t<this.srchData.columns.length;t++){var l=(a=this.srchData.columns[t]).size;t==this.srchData.columns.length-1&&(l+=19),r+=l,s=dojo.create("td",{style:{width:l+"px"},className:"head",name:a.key},o),dojo.create("div",{innerHTML:a.name},dojo.create("div",{
className:"disp_table",style:{margin:"auto"}},s)),dojo.connect(s,"onclick",this,this.clickHead(a.key))}n.parentNode.style.width=r+"px",dojo.byId("verSelectButtonArea").style.width=r+"px";dojo.byId("verSelectBody").firstChild.style.width=r+"px";var p=dojo.byId("verSelectClose");p.style.color="#A0A0A0",p.style.cursor="pointer",p.innerHTML="X",dojo.connect(p,"onclick",this,function(){dijit.popup.close(this.dialog)}),
dojo.byId("verSelectOk").disabled=!0,dojo.byId("verSelectSearch").value=teasp.message.getLabel("search_btn_title"),dojo.byId("verSelectOk").value=teasp.message.getLabel("select_btn_title"),dojo.byId("verSelectCancel").value=teasp.message.getLabel("cancel_btn_title"),dojo.connect(dojo.byId("verSelectSearch"),"onclick",this,this.doSearch),dojo.connect(dojo.byId("verSelectOk"),"onclick",this,function(){n=dojo.byId(
"verSelectTbody");for(var e=0;e<n.rows.length;e++){var t=n.rows[e].cells[0].firstChild;if(t.checked){for(var t=t.nextSibling,a=t.nextSibling,o={targets:this.targets,id:t.value,name:a.value,values:[]},s=a.nextSibling;s;)o.values.push(s.value),s=s.nextSibling;this.onSelect(o),dijit.popup.close(this.dialog)}}}),dojo.connect(dojo.byId("verSelectCancel"),"onclick",this,function(){dijit.popup.close(this.dialog)})}
teasp.util.showErrorArea(null,"verSelectErrorArea"),(e=dojo.byId("verSelectDiv")).clientHeight>this.maxDivH&&(dojo.toggleClass(e,"disp_block",!0),dojo.toggleClass(e,"disp_table",!1),dojo.style(e,"height",this.maxDivH+"px")),this.opened=!0}))},teasp.dialog.VerSelect.prototype.doSearch=function(){teasp.util.showErrorArea(null,"verSelectErrorArea");function a(){var e=this.srchData.procList(o);this.result={
cntAll:e.length,rowMax:20,pageNo:1,objs:e},this.sortList=[],this.result.objs=teasp.dialog.VerSelect.doSort(this.result.objs,this.sortList,"JobCode__c"),this.refresh(this.result)}var o=[],s=0,i=function(){};(i=dojo.hitch(this,function(){var t=this;t.srchData.searchList[s].procSkip()?++s<t.srchData.searchList.length?setTimeout(i,100):a.apply(t):this.search(this.srchData.searchList[s],function(e){o=o.concat(
t.srchData.searchList[s].procList(e)),++s<t.srchData.searchList.length?setTimeout(i,100):a.apply(t)},function(e){console.log(teasp.message.getErrorMessage(e))})}))()},teasp.dialog.VerSelect.prototype.search=function(e,t,a){var o=[],s=0,i="select "+e.soqlFields.join(",")+" from "+e.soqlFrom,e=e.procWhere(e),n=(e&&(i=i+" where "+e),i+=" order by Id",function(){});(n=dojo.hitch(this,function(){this.onSearch({
action:"searchVerSimple",soql:i,limit:200,offset:s},function(e){o=o.concat(e.objs),200<=e.objs.length&&o.length<teasp.constant.COUNT_LIMIT?(s+=200,setTimeout(n,100)):t(o)},function(e){console.log(e),a?a(e):console.log(teasp.message.getErrorMessage(e))})}))()},teasp.dialog.VerSelect.prototype.refresh=function(e){for(var t=0;t<this.eventHandles.length;t++)dojo.disconnect(this.eventHandles[t]),
delete this.eventHandles[t];this.eventHandles=[];for(var a=e&&e.objs||[],o=(dojo.byId("verSelectOk").disabled=!0,this.setPaging(dojo.byId("verSelectPage"),e),this.displaySort(),dojo.byId("verSelectDiv"));o.firstChild;)dojo.destroy(o.firstChild);for(var s=39,i=o.scrollTop=0;i<this.srchData.columns.length;i++)s+=(g=this.srchData.columns[i]).size;o.style.width=s+"px";for(var n=dojo.create("table",{
className:"stone_table"}),r=dojo.create("tbody",{id:"verSelectTbody"},n),l=0,t=(e.pageNo-1)*e.rowMax;t<a.length&&!(++l>e.rowMax);t++){var p=a[t],d=dojo.create("tr",{className:"sele "+(t%2==0?"even":"odd")},r),c=dojo.create("td",{style:{width:"22px",textAlign:"center",border:"none"}},d),m=dojo.create("input",{type:"radio",name:"verSelectRadio",id:"verSelectRadio"+(t+1)},c);this.eventHandles.push(dojo.connect(m,
"onclick",this,function(e){dojo.byId("verSelectOk").disabled=!1,dojo.isIE<=7&&(e=(e=e||window.event).target||e.srcElement,this.checkSelectRadio(e.id))}));for(var h=0;h<this.HIDEKEYS.length;h++){var u=this.HIDEKEYS[h]||"";dojo.create("input",{type:"hidden",value:p[u]||""},c)}for(i=0;i<this.srchData.columns.length;i++){var g=this.srchData.columns[i],c=dojo.create("td",{style:{width:g.size+"px",borderLeft:"none",
borderRight:"none",textAlign:g.align}},d),y=teasp.dialog.VerSelect.getValue(p,g);dojo.create("div",{innerHTML:y},c)}this.eventHandles.push(dojo.connect(d,"onclick",this,function(e){for(var t=(e=e||window.event).target||e.srcElement;t&&"TR"!=t.nodeName;)t=t.parentNode;t&&"TR"==t.nodeName&&(t.cells[0].firstChild.checked=!0,dojo.byId("verSelectOk").disabled=!1,dojo.isIE<=7&&this.checkSelectRadio(t.cells[0].firstChild.id
))}))}o.appendChild(n),this.adjustHeight(),(o=dojo.byId("verSelectBody")).firstChild.style.width=s+"px"},teasp.dialog.VerSelect.getValue=function(e,t){var a=t.apiKeys||t.apiKey.split(".");t.apiKeys||(t.apiKeys=a);for(var o=0;o<a.length;o++){var s=a[o];if(!e[s])return null;e=e[s]}return e=e&&"date"==t.type?teasp.util.date.formatDate(teasp.logic.convert.valDate(e),"SLA"):e},teasp.dialog.VerSelect.doSort=function(e,a,t
){for(var o=!1,s=0;s<a.length;s++){var i=a[s];if(i.apiKey==t){o=!0,0==s?i.desc=!i.desc:((i=a.splice(s,1)[0]).desc=!1,a.unshift(i));break}}o||a.unshift({apiKey:t,desc:!1}),a=a.slice(0,2);return e.sort(function(e,t){return teasp.dialog.VerSelect.compareValue(e,t,a)})},teasp.dialog.VerSelect.compareValue=function(e,t,a){a=a[0],e=teasp.dialog.VerSelect.getValue(e,a),t=teasp.dialog.VerSelect.getValue(t,a);
return e==t?0:"number"==typeof e&&"number"==typeof t?(e-t)*(a.desc?-1:1):"string"==typeof e&&"string"==typeof t?(e<t?-1:1)*(a.desc?-1:1):0},teasp.dialog.VerSelect.getString=function(){for(var e=arguments,t=dojo.clone(e[0]),a=1;a<e.length;a++)t=t.replace(RegExp("\\{"+(a-1)+"\\}","g"),e[a]);return t},teasp.dialog.VerSelect.prototype.checkSelectRadio=function(e){if(e){var t=dojo.byId("verSelectTbody");if(
t&&"TBODY"==t.nodeName)for(var a=t.rows.length,o=1;o<=a;o++){var s="verSelectRadio"+o;dojo.byId(s).checked=s==e}}},teasp.dialog.VerSelect.prototype.adjustHeight=function(){var e=dojo.byId("verSelectTbody"),t=0;if(dojo.isIE)for(var a=0;a<e.rows.length;a++){for(var o=0,s=0;s<e.rows[a].cells.length;s++){var i=e.rows[a].cells[s].clientHeight;o<i&&(o=i)}t+=o}else for(a=0;a<e.rows.length;a++)t+=e.rows[a].clientHeight;
var n=dojo.byId("verSelectDiv");dojo.toggleClass(n,"disp_table",t<this.maxDivH),dojo.toggleClass(n,"disp_block",t>=this.maxDivH),dojo.style(n,"height",(t<this.maxDivH?t:this.maxDivH)+"px")},teasp.dialog.VerSelect.prototype.changePage=function(e){var t=e,a=this;return function(){a.result&&(a.result.pageNo=t,a.refresh(a.result))}},teasp.dialog.VerSelect.prototype.clickHead=function(o){var s=this;return function(){if(
s.result){for(var e=null,t=0;t<s.srchData.columns.length;t++){var a=s.srchData.columns[t];if(a.key==o){e=a.apiKey;break}}e&&(s.result.objs=teasp.dialog.VerSelect.doSort(s.result.objs,s.sortList,e),s.result.pageNo=1,s.refresh(s.result))}}},teasp.dialog.VerSelect.prototype.setPaging=function(e,t){for(;e.firstChild;)dojo.destroy(e.firstChild);for(var a=Math.ceil(t.cntAll/t.rowMax),o=dojo.create("div",{
className:"pageDiv",innerHTML:"&lt;"},e),s=(1<t.pageNo?(dojo.style(o,"color","blue"),dojo.style(o,"cursor","pointer"),this.eventHandles.push(dojo.connect(o,"onclick",this,this.changePage(t.pageNo-1)))):dojo.style(o,"color","gray"),teasp.util.getPageBox(a,t.pageNo,4,5,4)),i=0;i<s.length;i++){var n,r=s[i];null===r?dojo.create("div",{className:"pageDiv",innerHTML:"･･",style:{color:"gray"}},e):(n=dojo.create("div",{
className:"pageDiv",innerHTML:r},e),t.pageNo==r?dojo.style(n,"color","gray"):(dojo.style(n,"color","blue"),dojo.style(n,"cursor","pointer"),this.eventHandles.push(dojo.connect(n,"onclick",this,this.changePage(r)))))}var o=dojo.create("div",{className:"pageDiv",innerHTML:"&gt;"},e),a=(t.pageNo<a?(dojo.style(o,"color","blue"),dojo.style(o,"cursor","pointer"),this.eventHandles.push(dojo.connect(o,"onclick",this,
this.changePage(t.pageNo+1)))):dojo.style(o,"color","gray"),(t.pageNo-1)*t.rowMax+1),o=a+t.rowMax-1,l=(o>t.cntAll&&(o=t.cntAll),"");0<t.cntAll&&(l=t.cntAll<=t.rowMax?teasp.message.getLabel("tk10003230",t.cntAll):teasp.message.getLabel(t.cntAll==teasp.constant.COUNT_LIMIT?"tk10003241":"tk10003240",t.cntAll,a||1,o||1)),dojo.create("div",{className:"pageDiv",style:{width:"10px",height:"2px"}},e),dojo.create("div",{
innerHTML:l,style:{whiteSpace:"nowrap",float:"left"},className:"disp_table"},e),dojo.create("div",{style:{clear:"both"}},e)},teasp.dialog.VerSelect.prototype.displaySort=function(){for(var e=0<this.sortList.length?this.sortList[0]:null,t=e?e.apiKey:null,o=e?e.desc:null,s=-1,a=0;a<this.srchData.columns.length;a++){var i=this.srchData.columns[a];if(t&&i.apiKey==t){s=a+1;break}}dojo.query(".head","verSelectHead"
).forEach(function(e){var t,a;"TD"==e.nodeName&&e.firstChild&&(t=e.firstChild.firstChild)&&(a=t.nextSibling,e.cellIndex==s?a?a.className="pp_base pp_ico_sort_"+(o?"desc":"asc"):(dojo.style(t,"float","left"),a=dojo.create("div",{className:"pp_base pp_ico_sort_"+(o?"desc":"asc"),style:{float:"left",marginRight:"auto",marginTop:"4px"}},e.firstChild),dojo.create("div",{style:{clear:"both"}},e.firstChild)):a&&(
a.nextSibling&&dojo.destroy(a.nextSibling),dojo.destroy(a),dojo.style(t,"float","none")))})},teasp.dialog.VerSelect.prototype.receiveError=function(e){console.log(e),teasp.util.showErrorArea(e,"verSelectErrorArea")},teasp.provide("teasp.dialog.ConfirmAlert"),teasp.dialog.ConfirmAlert=function(){this.id="confirmAlertDialog",this.duration=1,
this.content='<table id="confirmAlertTable" class="ts-style"><tr><td class="message_area" style="padding-bottom:8px;"><div id="confirmAlertMessage" style="min-width:340px;max-width:800px;"></div></td></tr><tr class="ts-style-buttons"><td style="text-align:right;"><div><button id="confirmAlertOk">OK</button><button class="clarity" id="confirmAlertCancel">Cancel</button></div></td></tr></table>',this.okLink={
id:"confirmAlertOk",callback:this.ok},this.cancelLink={id:"confirmAlertCancel",callback:this.cancel}},teasp.dialog.ConfirmAlert.prototype=new teasp.dialog.Base,teasp.dialog.ConfirmAlert.prototype.preStart=function(){dojo.connect(this.dialog,"onCancel",this,this.cancel)},teasp.dialog.ConfirmAlert.prototype.preShow=function(){return this.dialog.maxRatio=1,dojo.byId("confirmAlertDialog_title"
).innerHTML=this.args.title||teasp.message.getLabel("em10002080"),dojo.byId("confirmAlertMessage").innerHTML=(this.args.message||"").replace(/\r?\n/g,"<br/>"),dojo.style("confirmAlertCancel","display",this.args.type?"":"none"),dojo.byId("confirmAlertOk").innerHTML=this.args.okLabel||teasp.message.getLabel("ok_btn_title"),dojo.byId("confirmAlertCancel").innerHTML=this.args.cancelLabel||teasp.message.getLabel(
"cancel_btn_title"),teasp.isNarrow()&&(dojo.style("confirmAlertTable","width","100%"),dojo.style("confirmAlertTable","border","1px solid #ccc")),!0},teasp.dialog.ConfirmAlert.prototype.cancel=function(){this.hide(),this.onfinishfunc(!1)},teasp.dialog.ConfirmAlert.prototype.ok=function(){this.hide(),this.onfinishfunc(!0)},teasp.provide("teasp.view.Base"),teasp.view.Base=function(){this.localObj={},teasp.data.Pouch&&(
this.pouch=new teasp.data.Pouch),this.viewParams=null,this.errorAreaId="error_area"},teasp.view.Base.prototype.readParams=function(e){this.viewParams=e||{};for(var t=location.search.split("&"),a=0;a<t.length;a++){var o=t[a],o=(o=0==a?o.substring(1):o).split("=");1<o.length&&(this.viewParams[o[0]]=o[1])}},teasp.view.Base.prototype._init=function(e){return!globalLoadRes||"NG"!=globalLoadRes.result||(e?e(globalLoadRes
):teasp.util.showErrorArea(globalLoadRes.error,this.errorAreaId),!1)},teasp.view.Base.prototype.isArgRead=function(){return"read"==this.viewParams.mode},teasp.view.Base.prototype.viewPlus=function(){var e;this.isArgRead()&&(e=dojo.create("div",{className:"reference-mark"+(teasp.isNarrow()?"-mobile":""),innerHTML:teasp.message.getLabel(teasp.isNarrow()?"tf10007321":"tf10007320"),title:teasp.message.getLabel(
"tf10007330")},dojo.byId("tsfArea")),dojo.connect(e,"onclick",function(){var e=(e=location.href).replace(/mode=read/,"mode=edit");teasp.locationHref(e),document.body.style.cursor="wait"}))},teasp.view.Base.prototype.viewPostProcess=function(){},teasp.provide("teasp.helper.EkitanRoutes"),teasp.helper.EkitanRoutes=function(e){this.routes=new Array;for(var t=0;t<e.length;t++)this.routes.push(
new teasp.helper.EkitanRoute(e[t]))},teasp.helper.EkitanRoutes.prototype.getRouteCount=function(){return this.routes.length},teasp.helper.EkitanRoutes.prototype.getRoutes=function(){return this.routes},teasp.helper.EkitanRoutes.prototype.getRoute=function(e){return e<this.routes.length?this.routes[e]:null},teasp.helper.EkitanRoutes.prototype.destroy=function(){dojo.forEach(this.routes,function(e){e.destroy()})},
teasp.helper.EkitanRoute=function(e){this.route=e,this.fare=e.fare,this.fareIc=e.fareIc,this.commuterCode=e.commuterCode,this.commuterFare=e.commuterFare,this.lines=new Array,this.groups=new teasp.helper.EkitanGroups,this.handles=new Array,e.lines[0].fareGroupId?this.buildNormal(e):this.buildLegacy(e),this.recalc()},teasp.helper.EkitanRoute.formatFare=function(e){return teasp.util.currency.formatMoney(e,"#,##0円")},
teasp.helper.EkitanRoute.prototype.buildNormal=function(e){for(var t=0;t<e.lines.length;t++){var a=new teasp.helper.EkitanLine(e.lines[t]);this.lines.push(a),this.groups.addGroup(t,a)}},teasp.helper.EkitanRoute.prototype.buildLegacy=function(e){for(var t=1,a=null,o=null,s=0;s<e.lines.length;s++){var i=new teasp.helper.EkitanLine(e.lines[s]);this.lines.push(i),null!==i.getFare()&&(a="f"+t++,i.setFareGroupId(a),
this.groups.addGroup(s,i)),o=i.getRailKind()}for(s=this.lines.length-1;0<=s;s--)null!==(i=this.lines[s]).getGroup()?a=i.getFareGroupId():(o!=i.getRailKind()&&(a="f"+t++),i.setFareGroupId(a),this.groups.addGroup(s,i)),o=i.getRailKind()},teasp.helper.EkitanRoute.prototype.createItems=function(){for(var e=new Array,t=0;t<this.lines.length;t++){var a=this.lines[t],o=a.getFare(t),
o=0<t&&!o?"":teasp.helper.EkitanRoute.formatFare(o);e.push({top:a.getFrom(),fare:o,css:"station",line:a}),e.push({top:teasp.message.getLabel("tm20009100",a.getLineName()),css:"way",charges:a.getCharges(),line:a}),(t<this.lines.length-1?this.lines[t+1]:null)||e.push({top:a.getTo(),css:"station",last:!0,line:a})}return e},teasp.helper.EkitanRoute.prototype.createSimpleText=function(){for(var e=new Array,
t=0;t<this.lines.length;t++){var a=this.lines[t];e.push(a.getFrom()),e.push(teasp.message.getLabel("tm20009110")),t>=this.lines.length-1&&e.push(a.getTo())}return e.join("")},teasp.helper.EkitanRoute.prototype.createSimpleText2=function(){for(var e=new Array,t=0;t<this.lines.length;t++){var a=this.lines[t];e.push(a.getFrom()),e.push("-("),e.push(a.getLineName()),e.push(")-"),t>=this.lines.length-1&&e.push(a.getTo())}
return e.join("")},teasp.helper.EkitanRoute.prototype.createText=function(e){for(var t=new Array,a=0;a<this.lines.length;a++){var o,s=this.lines[a],i=(t.push(s.getFrom()),s.getFare(a));e&&null!==i&&t.push("("+i+")"),t.push("--"),t.push(s.getLineName()),e&&s.getCharges().length&&(o=new Array,dojo.forEach(s.getCharges(),function(e){o.push(e.name+(e.use?"*":"")+":"+e.charge)}),t.push("["+o.join(",")+"]")),t.push("--"),
a>=this.lines.length-1&&t.push(s.getTo())}return"total:"+this.getFare()+" "+t.join("")},teasp.helper.EkitanRoute.prototype.createTable=function(e){for(var t=this.createItems(),a=dojo.create("table",{id:e.tableId||null,className:"ekitan_route"}),o=dojo.create("tbody",null,a),s=dojo.create("tr",null,o),i=dojo.create("tr",null,o),n=0;n<t.length;n++){var r,l=t[n],p=(dojo.create("td",{className:l.css,innerHTML:l.top},s),
dojo.create("td",{className:"under"},i));l.charges&&l.charges.length?e.readOnly?(r=l.line.getCurChargeObj(),dojo.create("span",{innerHTML:"（"+(r.name||"")+" "+teasp.helper.EkitanRoute.formatFare(r.charge)+")",style:"font-size:95%;color:red;"},p)):dojo.place(this.createSelect(l,e),p):l.fare?(p.innerHTML=l.fare,p.className+=" fare-"+l.line.getFareGroupId()):p.innerHTML=l.last?teasp.message.getLabel("tm20009120"
):teasp.message.getLabel("tm20009110")}return e.changedFare&&e.changedFare(teasp.helper.EkitanRoute.formatFare(this.getFare())),a},teasp.helper.EkitanRoute.prototype.createSelect=function(e,t){for(var a=dojo.create("select"),o=0;o<e.charges.length;o++){var s=e.charges[o];dojo.create("option",{innerHTML:s.name+" "+teasp.helper.EkitanRoute.formatFare(s.charge),value:s.name,selected:s.use},a)}return this.handles.push(
dojo.connect(a,"onchange",this,this.changeCharge(e.line,t))),a},teasp.helper.EkitanRoute.prototype.changeCharge=function(t,a){return dojo.hitch(this,function(e){t.changeCharge(e.target.value),this.recalc(),dojo.query(".fare-"+t.getFareGroupId(),a.tableId).forEach(function(e){e.innerHTML=teasp.helper.EkitanRoute.formatFare(t.getGroupFare())}),a.changedFare&&a.changedFare(teasp.helper.EkitanRoute.formatFare(
this.getFare()))})},teasp.helper.EkitanRoute.prototype.changeChargeSimple=function(e,t){this.lines[e].changeCharge(t),this.recalc()},teasp.helper.EkitanRoute.prototype.getChargeInfo=function(){for(var e={},t=0;t<this.lines.length;t++){var a=this.lines[t];a.getCharges().length&&(e[t]=a.getCharges())}return e},teasp.helper.EkitanRoute.prototype.destroy=function(){for(var e=0;e<this.handles.length;e++)dojo.disconnect(
this.handles[e]);this.handles=new Array},teasp.helper.EkitanRoute.prototype.recalc=function(){this.groups.recalc(),this.route.fare=this.getFare()},teasp.helper.EkitanRoute.prototype.getFare=function(){return this.groups.getFare()},teasp.helper.EkitanRoute.prototype.getFareEx=function(e){return e?(e=this.getFare(),teasp.helper.EkitanRoute.formatFare(2*e)+"<br/>"+teasp.message.getLabel("tm20001320",
teasp.helper.EkitanRoute.formatFare(e))):teasp.helper.EkitanRoute.formatFare(this.getFare())},teasp.helper.EkitanRoute.prototype.getCommuterCode=function(){return this.commuterCode},teasp.helper.EkitanRoute.prototype.getCommuterFare=function(e){return teasp.util.currency.formatMoney(this.commuterFare,e)},teasp.helper.EkitanRoute.prototype.getRouteObj=function(){return this.route},
teasp.helper.EkitanRoute.prototype.getLines=function(){return this.lines},teasp.helper.EkitanRoute.prototype.getLine=function(e){return e<this.lines.length?this.lines[e]:null},teasp.helper.EkitanLine=function(e){this.line=e,this.groupId=e.groupId,this.lineName=e.lineName,this.railKind=e.railKind,this.stationFrom=e.stationFrom,this.stationTo=e.stationTo,this.fareGroupId=e.fareGroupId||null,this.charges=e.charges||[],
this.fare="number"==typeof e.fare?e.fare:null,this.fareIc="number"==typeof e.fareIc?e.fareIc:null,this.kind=e.kind||null;for(var t=this.curCharge=0;t<this.charges.length;t++){var a=this.charges[t];a.use&&(this.curCharge=a.charge)}},teasp.helper.EkitanLine.prototype.getFrom=function(){return this.stationFrom},teasp.helper.EkitanLine.prototype.getTo=function(){return this.stationTo},
teasp.helper.EkitanLine.prototype.getRailKind=function(){return this.railKind},teasp.helper.EkitanLine.prototype.getLineName=function(){return this.lineName},teasp.helper.EkitanLine.prototype.getCharges=function(){return this.charges},teasp.helper.EkitanLine.prototype.getCharge=function(e){return this.charges[e]},teasp.helper.EkitanLine.prototype.getFareGroupId=function(){return this.fareGroupId},
teasp.helper.EkitanLine.prototype.setFareGroupId=function(e){this.fareGroupId=e},teasp.helper.EkitanLine.prototype.changeCharge=function(e){for(var t=0;t<this.charges.length;t++){var a=this.charges[t];a.name==e?(this.curCharge=a.charge,a.use=!0):a.use=!1}},teasp.helper.EkitanLine.prototype.getCurCharge=function(){return this.curCharge},teasp.helper.EkitanLine.prototype.getCurChargeObj=function(){for(
var e=0;e<this.charges.length;e++){var t=this.charges[e];if(t.use)return t}return{}},teasp.helper.EkitanLine.prototype.getFare=function(e){return void 0===e?this.fare:this.group.getFare(e)},teasp.helper.EkitanLine.prototype.setFare=function(e){this.fare=this.line.fare=e},teasp.helper.EkitanLine.prototype.getGroup=function(){return this.group||null},teasp.helper.EkitanLine.prototype.setGroup=function(e){this.group=e},
teasp.helper.EkitanLine.prototype.getGroupFare=function(){return this.group?this.group.getFare():this.fare},teasp.helper.EkitanGroups=function(){this.fare=0,this.map={},this.summaried=!1},teasp.helper.EkitanGroups.prototype.addGroup=function(e,t){var a=t.getFareGroupId(),o=this.map[a];o?o.add(e,t):o=this.map[a]=new teasp.helper.EkitanGroup(e,t),this.summaried=!1},teasp.helper.EkitanGroups.prototype.summary=function(
){for(var e in this.map)this.map[e].summary();this.summaried=!0},teasp.helper.EkitanGroups.prototype.recalc=function(){for(var e in this.summaried||this.summary(),this.fare=0,this.map){e=this.map[e];this.fare+=e.recalc()}return this.fare},teasp.helper.EkitanGroups.prototype.getFare=function(){return this.fare},teasp.helper.EkitanGroup=function(e,t){this.indexes=new Array,this.map={},this.fare=null,this.fareLine=null,
this.baseFare=0,this.fareGroupId=t.getFareGroupId(),this.add(e,t)},teasp.helper.EkitanGroup.prototype.add=function(e,t){this.indexes.push(e),null!==(this.map[e]=t).getFare()&&(this.fare=t.getFare(),this.fareLine||(this.fareLine=t)),t.setGroup(this)},teasp.helper.EkitanGroup.prototype.getFareGroupId=function(){return this.fareGroupId},teasp.helper.EkitanGroup.prototype.getFare=function(e){if(void 0===e
)return this.fare;for(var t=0;t<this.indexes.length;t++)if(this.indexes[t]==e&&0==t)return this.fare;return null},teasp.helper.EkitanGroup.prototype.summary=function(){this.indexes=this.indexes.sort(function(e,t){return e-t});var e,t=this.baseFare=0;for(e in this.map)t+=this.map[e].getCurCharge();this.baseFare=(this.fare||0)-t},teasp.helper.EkitanGroup.prototype.recalc=function(){var e,t=0;for(e in this.map
)t+=this.map[e].getCurCharge();return this.fare=this.baseFare+t,this.fareLine&&this.fareLine.setFare(this.fare),this.fare},teasp.constant=teasp.util.extend(teasp.constant,{STATUS_REJECTS:["却下","却下済み"],STATUS_CANCELS:["申請取消","確定取消"],STATUS_NOTADMITS:["未確定","未承認"],STATUS_APPROVES:["承認済み","確定済み"],STATUS_FIX:["承認済み","確定済み","承認待ち","承認中","精算済み"],STATUS_NEGATIVE:["却下","却下済み","申請取消","確定取消"],STATUS_EDITABLE:["未確定","未申請",
"確定取消","申請取消","却下"],STATUS_ALL:["未確定","未申請","確定取消","申請取消","却下","却下済み","承認待ち","確定済み","承認済み","精算済み"],APPROVER_TYPE_MONTH:"勤怠月次確定",APPROVER_TYPE_MONTHLY:"勤怠月次申請",APPROVER_TYPE_DAILY:"勤怠日次申請",APPROVER_TYPE_DAILYFIX:"勤怠日次確定",APPROVER_TYPE_JOB:"工数月次確定",APPROVER_TYPE_EXP:"経費申請",P_E:1,P_ME:3,P_MA:5,P_DM:9,P_D1:17,P_D2:33,P_SS:65,P_AD:129,P_AE:257,P_AR:512,P_AX:1024,P_AJ:2048,P_JL:4096,P_AP:8192,TARGET_EXP:1,
DAY_TYPE_NORMAL:0,DAY_TYPE_NORMAL_HOLIDAY:1,DAY_TYPE_LEGAL_HOLIDAY:2,DAY_TYPE_PUBLIC_HOLIDAY:3,DAY_TYPE_PLANNED_HOLIDAY:4,NORMAL_HOLIDAY_COLOR:"#DEEFFF",LEGAL_HOLIDAY_COLOR:"#EFCFBD",PRIVATE_HOLIDAY_COLOR:"#FFCFA5",APPLY_TYPE_HOLIDAY:"休暇申請",APPLY_TYPE_EXCHANGE:"振替申請",APPLY_TYPE_ZANGYO:"残業申請",APPLY_TYPE_EARLYSTART:"早朝勤務申請",APPLY_TYPE_KYUSHTU:"休日出勤申請",APPLY_TYPE_PATTERNS:"勤務時間変更申請",APPLY_TYPE_PATTERNL:"長期時間変更申請",
APPLY_TYPE_LATESTART:"遅刻申請",APPLY_TYPE_EARLYEND:"早退申請",APPLY_TYPE_MONTHLY:"勤務確定",APPLY_TYPE_DAILY:"日次確定",APPLY_TYPE_REVISETIME:"勤怠時刻修正申請",APPLY_TYPE_DIRECT:"直行・直帰申請",APPLY_TYPE_SHIFTCHANGE:"シフト振替申請",APPLY_TYPE_MONTHLYOVERTIME:"月次残業申請",APPLY_KEY_HOLIDAY:"holiday",APPLY_KEY_EXCHANGES:"exchangeS",APPLY_KEY_EXCHANGEE:"exchangeE",APPLY_KEY_ZANGYO:"zangyo",APPLY_KEY_EARLYSTART:"earlyStart",APPLY_KEY_KYUSHTU:"kyushtu",
APPLY_KEY_PATTERNS:"patternS",APPLY_KEY_PATTERNL:"patternL",APPLY_KEY_PATTERND:"patternD",APPLY_KEY_LATESTART:"lateStart",APPLY_KEY_EARLYEND:"earlyEnd",APPLY_KEY_MONTHLY:"monthly",APPLY_KEY_DAILY:"dailyFix",APPLY_KEY_EXPAPPLY:"expApply",APPLY_KEY_JOBAPPLY:"jobApply",APPLY_KEY_REVISETIME:"reviseTime",APPLY_KEY_SHIFT:"shiftSet",APPLY_KEY_SHIFTCHANGE:"shiftChange",APPLY_KEY_DIRECT:"direct",
APPLY_KEY_EXPPREAPPLY:"expPreApply",APPLY_KEY_COMMUTERPASS:"commuterPass",APPLY_KEY_MONTHLYOVERTIME:"monthlyOverTime",APPLY_KEY_HOLIDAY_ALL:"holidayAll",APPLY_KEY_HOLIDAY_AM:"holidayAm",APPLY_KEY_HOLIDAY_PM:"holidayPm",APPLY_KEY_HOLIDAY_TIME:"holidayTime",APPLY_CLIENT_DAILY:"daily",APPLY_CLIENT_MONTHLY:"monthly",APPLY_CLIENT_EMP_WORK:"empWork",APPLY_CLIENT_EMP_EXP:"empExp",APPLY_CLIENT_CHANGE_EMP:"changeEmp",
APPLY_CLIENT_REQUEST_LIST:"requestList",APPLY_CLIENT_CHANGE_HRM_EMP:"changeHRMEmp",APPLY_CLIENT_REQUEST_HRM_LIST:"requestHRMList",REASON_DUPL:1,REASON_RANGE_DUPL:2,REASON_NOHALF:3,REASON_NOTIME:4,REASON_60RULE:5,REASON_NG_HOLIDAY:6,REASON_NG_KYUSHTU:7,REASON_NG_EXCHANGE:8,REASON_NG_ZANGYO:9,REASON_NG_EARLYSTART:10,REASON_NG_LATESTART:11,REASON_NG_EARLYEND:12,REASON_NOT_EXCHANGE:13,REASON_NG_DAYTYPE1:14,
REASON_NG_SHIFTCHANGE1:15,HOLIDAY_TYPE_PAID:"1",HOLIDAY_TYPE_FREE:"2",HOLIDAY_TYPE_DAIQ:"3",RANGE_ALL:"1",RANGE_AM:"2",RANGE_PM:"3",RANGE_TIME:"4",RANGE_SHORT:"1",RANGE_LONG:"2",WORK_SYSTEM_FIX:"0",WORK_SYSTEM_FLEX:"1",WORK_SYSTEM_MUTATE:"2",WORK_SYSTEM_MANAGER:"3",C_REAL:"real",C_DISC:"disc",C_FREAL:"freal",C_FDISC:"fdisc",COPYTAG:"(copy)",STOCK_DAIQ:"代休",INPUT_VOLUME:0,INPUT_TIME:1,INPUT_VOLUME_FIX:2,
INPUT_FLAG_NORMAL:0,INPUT_FLAG_BULK:1,INPUT_FLAG_EXEMPT:2,GRAPH_AREA_WIDTH:960,AREA_W_MIN:790,AREA_W_MAX:960,AREA_W_MAX_EXP:930,AREA_W_MAX_JOB:930,AREA_W_MARGIN:100,AREA_W_ADJUST:30,getStepStatus:function(e){var t={started:teasp.message.getLabel("tm10003470"),approved:teasp.message.getLabel("tm10003480"),rejected:teasp.message.getLabel("tm10003490"),removed:teasp.message.getLabel("tm10003500"),
noresponse:teasp.message.getLabel("tm10003510"),reassigned:teasp.message.getLabel("tm10003520"),fault:teasp.message.getLabel("tm10003530"),held:teasp.message.getLabel("tm10003540"),pending:teasp.message.getLabel("tm10003550")};return teasp.constant.getStepStatus=function(e){return teasp.constant.STATUS_ALL.contains(e)?teasp.constant.getDisplayStatus(e):e&&t[e.toLowerCase()]||""},teasp.constant.getStepStatus(e)},
getStatusStyleSuffix:function(e){return teasp.constant.STATUS_REJECTS.contains(e)?"_ng":teasp.constant.STATUS_APPROVES.contains(e)?"_ok":"_up"},getEkitanAreas:function(e){var a=[{areaNo:-1,name:teasp.message.getLabel("tm20007010")},{areaNo:0,name:teasp.message.getLabel("tm20007020")},{areaNo:1,name:teasp.message.getLabel("tm20007030")},{areaNo:2,name:teasp.message.getLabel("tm20007040")},{areaNo:3,
name:teasp.message.getLabel("tm20007050")},{areaNo:4,name:teasp.message.getLabel("tm20007060")},{areaNo:5,name:teasp.message.getLabel("tm20007070")},{areaNo:6,name:teasp.message.getLabel("tm20007080")},{areaNo:7,name:teasp.message.getLabel("tm20007090")},{areaNo:8,name:teasp.message.getLabel("tm20007100")},{areaNo:9,name:teasp.message.getLabel("tm20007110")}];return teasp.constant.getEkitanAreas=function(e){if(
null==e)return a;for(var t=0;t<a.length;t++)if(a[t].areaNo==e)return a[t];return a[0]},teasp.constant.getEkitanAreas(e)},getPreferredAirLine:function(e){var a=[{no:0,name:teasp.message.getLabel("preferredAirLineNo_label")},{no:1,name:"JAL"},{no:2,name:"ANA"},{no:4,name:"SKY/ADO"}];return teasp.constant.getPreferredAirLine=function(e){if(null==e)return a;for(var t=0;t<a.length;t++)if(a[t].no==e)return a[t];return a[0]
},teasp.constant.getPreferredAirLine(e)},getRoutePreference:function(e){var a=[{no:0,name:teasp.message.getLabel("routeSortTime_label")},{no:1,name:teasp.message.getLabel("routeSortCost_label")},{no:2,name:teasp.message.getLabel("routeSortChange_label")},{no:3,name:teasp.message.getLabel("routeSortCommuter_label")}];return teasp.constant.getRoutePreference=function(e){if(null==e)return a;for(var t=0;t<a.length;t++
)if(a[t].no==e)return a[t];return a[0]},teasp.constant.getRoutePreference(e)},getExcludeCommuterRoute:function(e){var a=[{flag:!1,name:teasp.message.getLabel("excludeCommuterNo_label")},{flag:!0,name:teasp.message.getLabel("excludeCommuterYes_label")}];return teasp.constant.getExcludeCommuterRoute=function(e){if(null==e)return a;for(var t=0;t<a.length;t++)if(a[t].flag==e)return a[t];return a[0]},
teasp.constant.getExcludeCommuterRoute(e)},getDayTypeWord:function(e){return e==teasp.constant.DAY_TYPE_NORMAL_HOLIDAY?teasp.message.getLabel("fixHoliday_label"):e==teasp.constant.DAY_TYPE_LEGAL_HOLIDAY?teasp.message.getLabel("legalHoliday_label"):e==teasp.constant.DAY_TYPE_PUBLIC_HOLIDAY?teasp.message.getLabel("fixHoliday_label"):teasp.message.getLabel("tk10000260")},getInputFlagName:function(e){switch(e){
case teasp.constant.INPUT_FLAG_BULK:return teasp.message.getLabel("inputFlagBulk");case teasp.constant.INPUT_FLAG_EXEMPT:return teasp.message.getLabel("inputFlagExempt");default:return teasp.message.getLabel("inputFlagNormal")}}}),function(e,t,a,o,s,i){for(var n=dojo.clone(e),r=dojo.clone(t),l={message:"",startTime:(o="number"==typeof o?o:-1)<0?null:o,endTime:(s="number"==typeof s?s:-1)<0?null:s,timeTable:[],over:!1}
,p=[],d=0;d<n.length;d++)if((c=n[d]).type==teasp.constant.REST_FREE&&"number"==typeof c.from&&"number"==typeof c.to&&c.from<c.to)for(y=0;y<a.length;y++)if((m=a[y]).from<=c.from&&c.to<=m.to){c.type=teasp.constant.REST_FIX;break}for(d=0;d<n.length;d++){var c=n[d];if("number"==typeof c.from&&"number"==typeof c.to)for(c.type!=teasp.constant.REST_PAY&&p.push(c),y=0;y<n.length;y++){var m=n[y];if(
d!=y&&"number"==typeof m.from&&"number"==typeof m.to){var h=c.type==teasp.constant.REST_FIX?1:c.type==teasp.constant.REST_FREE?2:4,u=m.type==teasp.constant.REST_FIX?1:m.type==teasp.constant.REST_FREE?2:4;if(5!=(h|u)&&(c.from<=m.from&&m.from<c.to||c.from<m.to&&m.to<=c.to||m.from<c.from&&c.to<m.to))return l.message=teasp.message.getLabel(4<=(h|u)?"tm10001481":"tm10001480"),l}}}if(o<0&&s<0)for(d=0;d<n.length;d++){c=n[d]
if(c.type==teasp.constant.REST_PAY)if(teasp.util.time.rangeTime(c,p)<teasp.util.time.rangeTime(c,a)){for(var g=[],y=0;y<a.length;y++){m=a[y];(c.from<m.from&&m.from<c.to||c.from<m.to&&m.to<c.to||m.from<c.from&&c.to<m.to)&&g.push({from:(c.from<m.from?m:c).from,to:(c.to<m.to?c:m).to,type:teasp.constant.REST_FIX})}0<g.length&&(n=n.concat(g))}}var f=null;for(d=0;d<r.length;d++){if(
f&&"number"==typeof r[d].from&&"number"==typeof f.to&&r[d].from<f.to)return l.message=teasp.message.getLabel("tm10001500"),l;f=r[d]}var b=[],_=[];for(d=0;d<n.length;d++)if(n[d].type==teasp.constant.REST_FIX)b.push(n[d]);else if(n[d].type==teasp.constant.REST_FREE){if("number"==typeof(f=n[d]).from&&"number"==typeof f.to&&f.from>=f.to)return l.message=teasp.message.getLabel("tm10001490"),l;_.push(n[d])}for(
d=0;d<r.length;d++)if("number"==typeof(f=r[d]).from&&"number"==typeof f.to&&f.from>=f.to)return l.message=teasp.message.getLabel("tm10001510"),l;var v=[];for(d=0;d<_.length;d++)"number"==typeof(f=_[d]).from&&0<=o&&f.from<o&&(l.over=!0,i||(f.from=o)),"number"==typeof f.to&&0<=s&&s<f.to&&(l.over=!0,i||(f.to=s)),"number"==typeof f.from&&"number"!=typeof f.to?(f.to=null,v.push(f)
):"number"!=typeof f.from&&"number"==typeof f.to?(f.from=null,v.push(f)):"number"==typeof f.from&&"number"==typeof f.to&&f.from<f.to&&v.push(f);var T=[];for(d=0;d<r.length;d++)"number"==typeof(f=r[d]).from&&0<=o&&f.from<o&&(l.over=!0,i||(f.from=o)),"number"==typeof f.to&&0<=s&&s<f.to&&(l.over=!0,i||(f.to=s)),"number"==typeof f.from&&"number"!=typeof f.to?(f.to=null,T.push(f)
):"number"!=typeof f.from&&"number"==typeof f.to?(f.from=null,T.push(f)):"number"==typeof f.from&&"number"==typeof f.to&&f.from<f.to&&T.push(f);return l.timeTable=l.timeTable.concat(b),0<v.length&&(l.timeTable=l.timeTable.concat(v)),0<T.length&&(l.timeTable=l.timeTable.concat(T)),l.rests=b.concat(v),l});function getHolidays(e,t,a,o){function s(e){var t=e.getFullYear(),a=e.getMonth()+1,e=e.getDate();return t+"-"+(
a=a<10?"0"+a:a)+"-"+(e=e<10?"0"+e:e)}function i(){return h.getFullYear()}function n(e){return u===(36-e)%7}function r(e,t,a){d<=(e=g+(e-1)*p)&&e<=c&&(y.setTime(e),m[s(y)]={dayOfWeek:y.getDay(),title:t,org:a})}function l(e,t){var a=g+(e=(8-u)%7+7*(e-1))*p;return d<=a&&a<=c&&(y.setTime(a),m[s(y)]={dayOfWeek:y.getDay(),title:t}),1+e}for(var p=864e5,d=e.getTime(),c=t.getTime(),m={},h=teasp.util.date.getToday(),u=null,
g=null,y=teasp.util.date.getToday(),f={1:function(){r(1,teasp.message.getLabel("tm00000130"),n(1)),n(1)&&r(2,teasp.message.getLabel("tm00000120")),l(2,teasp.message.getLabel("tm00000140"))},2:function(){r(11,teasp.message.getLabel("tm00000150"),n(11)),n(11)&&r(12,teasp.message.getLabel("tm00000120")),2019<i()&&(r(23,teasp.message.getLabel("tm00000270"),n(23)),n(23)&&r(24,teasp.message.getLabel("tm00000120")))},
3:function(){var e=.242194*(i()-1980)-((i()-1980)/4|0),e=(2e3<i()&&(e+=(i()-2e3)/100|0),20.8431+e|0);r(e,teasp.message.getLabel("tm00000160"),n(e)),n(e)&&r(1+e,teasp.message.getLabel("tm00000120"))},4:function(){r(29,teasp.message.getLabel("tm00000170"),n(29)),n(29)&&r(30,teasp.message.getLabel("tm00000120")),2019==i()&&r(30,teasp.message.getLabel("tm00000110"))},5:function(){2019==i()&&(r(1,teasp.message.getLabel(
"tm00000900")),r(2,teasp.message.getLabel("tm00000110"))),(n(3)||n(4)||n(5))&&r(6,teasp.message.getLabel("tm00000120")),r(3,teasp.message.getLabel("tm00000180"),n(3)),r(4,teasp.message.getLabel("tm00000190"),n(4)),r(5,teasp.message.getLabel("tm00000200"),n(5))},6:function(){},7:function(){2020==i()?(r(23,teasp.message.getLabel("tm00000210")),r(24,teasp.message.getLabel("tm00000241"))):2021==i()?(r(22,
teasp.message.getLabel("tm00000210")),r(23,teasp.message.getLabel("tm00000241"))):l(3,teasp.message.getLabel("tm00000210"))},8:function(){2020==i()?r(10,teasp.message.getLabel("tm00000280")):2021==i()?(r(8,teasp.message.getLabel("tm00000280")),r(9,teasp.message.getLabel("tm00000120"))):2016<=i()&&(r(11,teasp.message.getLabel("tm00000280"),n(11)),n(11)&&r(12,teasp.message.getLabel("tm00000120")))},9:function(){
var e=l(3,teasp.message.getLabel("tm00000220")),t=.242194*(i()-1980)-((i()-1980)/4|0),t=(2e3<i()&&(t+=(i()-2e3)/100|0),23.2488+t|0);r(t,teasp.message.getLabel("tm00000230"),n(t)),n(t)&&r(1+t,teasp.message.getLabel("tm00000120")),e+2==t&&r(e+1,teasp.message.getLabel("tm00000110"))},10:function(){2021<i()?l(2,teasp.message.getLabel("tm00000241")):i()<2020&&l(2,teasp.message.getLabel("tm00000240")),2019==i()&&r(22,
teasp.message.getLabel("tm00000910"))},11:function(){r(3,teasp.message.getLabel("tm00000250"),n(3)),n(3)&&r(4,teasp.message.getLabel("tm00000120")),r(23,teasp.message.getLabel("tm00000260"),n(23)),n(23)&&r(24,teasp.message.getLabel("tm00000120"))},12:function(){i()<2019&&(r(23,teasp.message.getLabel("tm00000270"),n(23)),n(23)&&r(24,teasp.message.getLabel("tm00000120")))}},b=a,_=0;_<b.length;_++)for(var v=d+(
b[_]+7-e.getDay())%7*p;v<=c;v+=7*p)y.setTime(v),m[s(y)]={dayOfWeek:y.getDay()};for(h.setTime(d),h.setDate(1),g=h.getTime();g<=c;)u=h.getDay(),f[h.getMonth()+1](),h.setMonth(h.getMonth()+1),g=h.getTime();return m}function getHolidaysEx(e,t,a,o){for(var s=a||"0000000",i=[],n=[],r=0;r<s.length;r++){var l=s.substring(r,r+1);"0"!=l&&i.push(r),"2"==l&&n.push(r)}e.setHours(10),t.setHours(14);var p,d,c=getHolidays(e,t,i,!1);
for(p in c)c.hasOwnProperty(p)&&(d=c[p],n.contains(d.dayOfWeek)?d.dayType=teasp.constant.DAY_TYPE_LEGAL_HOLIDAY:i.contains(d.dayOfWeek)?d.dayType=teasp.constant.DAY_TYPE_NORMAL_HOLIDAY:o||d.org?d.dayType=teasp.constant.DAY_TYPE_NORMAL:d.dayType=teasp.constant.DAY_TYPE_PUBLIC_HOLIDAY);return c}teasp.provide("teasp.logic.EmpTime"),teasp.logic.EmpTime=function(e){this.todayKey=e.getToday(),this.pouch=e},
teasp.logic.EmpTime.prototype.mergeCalendar=function(){for(var e=this.pouch.getObj(),t=teasp.util.date.getDateList(e.params.startLdate,e.params.endLdate),a=(e.params.dateList&&0<e.params.dateList.length&&(t=(t=t.concat(e.params.dateList)).sort(function(e,t){return e<t?-1:t<e?1:0})),[]),o=0;o<t.length;o++){var s,i=t[o];e.days[i]?(e.days[i].date=i,a.push(e.days[i])):(a.push(s={date:i}),e.days[i]=s)}for(
o=0;o<a.length;o++){var n,r,l,p=a[o],d=0<o?a[o-1]:null,c=(p.dbDayType=p.dayType,this.getMonthByDate(e.empMonthMap,p.date));this.isFixedMonth(e,p.date)?(r=c&&c.config&&"number"==typeof c.config.defaultLegalHoliday,r=(this.pouch.isUseLegalHoliday()||r||teasp.util.time.isValidRange(p.startTime,p.endTime)||d&&"number"==typeof d.endTime&&!(d.endTime<=1440)||p.dayType!=teasp.constant.DAY_TYPE_LEGAL_HOLIDAY||((
l=e.cals[p.date])&&l.type&&l.type!=teasp.constant.DAY_TYPE_NORMAL?!l||l.type!=teasp.constant.DAY_TYPE_NORMAL_HOLIDAY&&l.type!=teasp.constant.DAY_TYPE_PUBLIC_HOLIDAY||(p.dayType=teasp.constant.DAY_TYPE_NORMAL_HOLIDAY):(r=c.fixHolidays[p.date])&&0!=r.dayType||1==p.dbOrgDayType||3==p.dbOrgDayType?p.dayType=teasp.constant.DAY_TYPE_NORMAL_HOLIDAY:(p.dayType=teasp.constant.DAY_TYPE_NORMAL,p.zanteiDayType=!0)),
p.holiday1&&p.holiday1.plannedHoliday&&(p.plannedHoliday=!0),p.dayType==teasp.constant.DAY_TYPE_LEGAL_HOLIDAY&&(teasp.util.time.isValidRange(p.startTime,p.endTime)?p.workFlag=!0:d&&"number"==typeof d.endTime&&1440<d.endTime&&0==p.dbOrgDayType&&(p.autoLH=!0)),c.fixHolidays[p.date]),c&&null!==c.config.defaultLegalHoliday&&p.dayType!=teasp.constant.DAY_TYPE_NORMAL&&(n=teasp.util.date.parseDate(p.date)).getDay(
)==c.config.defaultLegalHoliday&&(p.defaultLegalHolidayFlag=!0)):(this.clearDayElements(p),p.dayType=teasp.constant.DAY_TYPE_NORMAL,p.plannedHoliday=!1,n=teasp.util.date.parseDate(p.date),c&&(r=c.fixHolidays[p.date],p.dayType=r?r.dayType:teasp.constant.DAY_TYPE_NORMAL,null!==c.config.defaultLegalHoliday&&p.dayType!=teasp.constant.DAY_TYPE_NORMAL&&n.getDay()==c.config.defaultLegalHoliday&&(p.defaultLegalHolidayFlag=!0
),d=[],r&&r.title&&d.push("("+r.title+")"),(l=e.cals[p.date])&&(l.type&&(p.dayType="string"==typeof l.type?parseInt(l.type,10):l.type,p.plannedHoliday=l.plannedHoliday),l.pattern&&(p.pattern=l.pattern),l.event&&d.push(l.event)),(c=(c=this.pouch.getDeptIdByMonth(c))&&e.cals[c]&&e.cals[c][p.date]||null)&&c.event&&d.push(c.event),p.event=d.join(teasp.message.getLabel("tm10001470")),p.pattern||(
c=teasp.logic.EmpTime.getPatternByDate(e.empTypePatterns,n))&&(p.pattern=c.pattern),p.explicDayType=p.dayType))}return e},teasp.logic.EmpTime.prototype.clearDayElements=function(e){delete e.dayType,delete e.event,delete e.plannedHoliday,delete e.pattern,delete e.holiday1,delete e.holiday2,delete e.exchangeDate,delete e.rack,delete e.period,delete e.real,delete e.deco},
teasp.logic.EmpTime.prototype.isFixedMonth=function(e,t){for(var a=0;a<e.months.length;a++){var o=e.months[a];if(o.startDate<=t&&t<=o.endDate)return!!o.apply&&(teasp.constant.STATUS_APPROVES.contains(o.apply.status)||teasp.constant.STATUS_WAIT==o.apply.status)}return!1},teasp.logic.EmpTime.prototype.buildConfig=function(){for(var e=this.pouch.getObj(),t=e.common,a=e.targetEmp,o=0;o<e.configs.length;o++){
var s=e.configs[o];s.initialDateOfYear=a.configBase.initialDateOfYear,s.initialDateOfMonth=a.configBase.initialDateOfMonth,s.initialDayOfWeek=a.configBase.initialDayOfWeek,s.markOfYear=a.configBase.markOfYear,s.markOfMonth=a.configBase.markOfMonth,s.legalTimeOfDay=t.legalTimeOfDay}t.nightTimes||(t.nightTimes=this.getLoopSpans(t.nightStartTime,t.nightEndTime,1440,2880))},
teasp.logic.EmpTime.prototype.buildEmpMonth=function(){var e=this.pouch.getObj(),t=e.common,a=e.config,o=e.month,s=e.months,i=e.days,e=e.applys,n=[teasp.constant.C_REAL,teasp.constant.C_DISC];o.fixDays=0,o.workDays=0,o.workLegalHolidays=0,o.workHolidays=0,o.workPublicHolidays=0;for(var r=o.fixTime=0;r<n.length;r++)o[u=n[r]]={workRealTime:0,workWholeTime:0,workInFixedTime:0,workLegalTime:0,workLegalOverTime:0,
workLegalOutOverTime:0,workChargeTime:0,workChargeTime40H:0,workOverTime:0,workHolidayTime:0,workNightTime:0,amountTime:0,curAmountTime:0,curAmountDate:0,settlementTime:0,carryforwardTime:0,restTime:0,earlyCount:0,earlyLostTime:0,earlyTime:0,lateCount:0,lateLostTime:0,lateTime:0,lostTime:0,privateCount:0,privateInnerCount:0,privateInnerLostTime:0,privateInnerTime:0,privateOuterTime:0,paidHolidayCount:0,absentCount:0,
daiqHolidayCount:0,paidRestTime:0,paidHolyTime:0,holidayDeductionTime:0,plannedHolidayCount:0,preWorkLegalTimeOfWeek:0,preWorkLegalTimeOfPeriod:0,workAwayTime:0,workOffTime:0,totalWorkOverCount36:0,totalWorkOverTime36:0,workOver40perWeek:0,workOver45Time:0,workOver60Time:0,workOverTime36:0,legalWorkTime:0,nextMonthFistDayType:0,weekDayDayLegalFixTime:0,weekDayDayLegalExtTime:0,weekDayDayLegalOutTime:0,
weekDayNightLegalFixTime:0,weekDayNightLegalExtTime:0,weekDayNightLegalOutTime:0,weekEndDayLegalTime:0,weekEndDayLegalOutTime:0,weekEndNightLegalTime:0,weekEndNightLegalOutTime:0,holidayDayTime:0,holidayNightTime:0,workFixedDay:0,workFixedTime:0,workHolidayCount:0,workLegalHolidayCount:0,workPublicHolidayCount:0,workRealDay:0,minasiWorkWholeTime:0};var l=teasp.util.date.getDateList(o.startDate,o.endDate),
e=this.mergeEmpDays(t,a,i,e,o.startDate,o.endDate);o.paidHolyTime=e.paidHolyTime;for(r=0;r<l.length;r++){var p=i[l[r]];this.pouch.getEndDate()&&0<teasp.util.date.compareDate(l[r],this.pouch.getEndDate())||this.pouch.getEntryDate()&&teasp.util.date.compareDate(l[r],this.pouch.getEntryDate())<0||this.isFixDay(p)&&(o.fixDays++,o.fixTime+=p.rack.fixTime)}
a.workSystem==teasp.constant.WORK_SYSTEM_FLEX&&"1"==a.flexFixOption&&(o.fixTime=a.flexFixMonthTime),this.calculateEmpDays(s,i,t,e.dlst,this.getPeriodMap(s),teasp.constant.C_REAL),this.calculateEmpDays(s,i,t,e.dlst,this.getPeriodMap(s),teasp.constant.C_DISC),this.calculateEmpDays(s,i,t,e.dlst,this.getPeriodMap(s),teasp.constant.C_FREAL),this.calculateEmpDays(s,i,t,e.dlst,this.getPeriodMap(s),teasp.constant.C_FDISC),
a.workSystem==teasp.constant.WORK_SYSTEM_MANAGER&&this.recalcDiscForManager(s,i,t,e.dlst,this.getPeriodMap(s));for(var d=0,r=0;r<l.length;r++){p=i[l[r]];this.pouch.getEndDate()&&0<teasp.util.date.compareDate(l[r],this.pouch.getEndDate())||this.pouch.getEntryDate()&&teasp.util.date.compareDate(l[r],this.pouch.getEntryDate())<0||(d++,p.rack.worked&&(this.pouch.isCountZeroWorkTime()||0<(p.real.workRealTime||0))&&(
o.workDays++,p.dayType==teasp.constant.DAY_TYPE_LEGAL_HOLIDAY&&(!p.workFlag||0<p.rack.validApplys.kyushtu.length)?o.workLegalHolidays++:p.dayType==teasp.constant.DAY_TYPE_NORMAL_HOLIDAY?o.workHolidays++:p.dayType==teasp.constant.DAY_TYPE_PUBLIC_HOLIDAY&&o.workPublicHolidays++),this.correctDiscChargeTime(p,a.defaultPattern.useDiscretionary))}for(var c,m,h=0;h<n.length;h++){for(var u=n[h],g=0,y=0,f=this.pouch.getToday(
),r=0;r<l.length;r++){var b,_,p=i[l[r]];this.pouch.getEndDate()&&0<teasp.util.date.compareDate(l[r],this.pouch.getEndDate())||this.pouch.getEntryDate()&&teasp.util.date.compareDate(l[r],this.pouch.getEntryDate())<0||(a=(o=this.getMonthByDate(s,p.rack.key)).config,b=dojo.clone(p[u]),o[u].restTime+=b.restTime,o[u].workRealTime+=b.workRealTime,o[u].workWholeTime+=b.workWholeTime,o[u].workInFixedTime+=b.workInFixedTime,
o[u].workLegalTime+=b.workLegalTime,o[u].workLegalOverTime+=b.workLegalOverTime,o[u].workLegalOutOverTime+=b.workLegalOutOverTime,o[u].workChargeTime+=b.workChargeTime,o[u].workChargeTime40H+=b.workChargeTime40H,o[u].workOverTime+=b.workOverTime,o[u].workHolidayTime+=b.workHolidayTime,o[u].workNightTime+=b.workNightTime,o[u].workAwayTime+=b.awayTime,o[u].settlementTime+=b.settlementTime,teasp.util.date.compareDate(
l[r],f)<=0&&(p.dayType==teasp.constant.DAY_TYPE_NORMAL&&(p.pattern.useDiscretionary?g+=p.pattern.standardFixTime:g+=p.rack.fixTime),y+=b.workWholeTime-b.workHolidayTime,0==teasp.util.date.compareDate(l[r],f)&&!p.rack.worked||(o[u].curAmountTime=y-g,o.amountTimeDate=p.rack.key)),0<b.lateTime&&(o[u].lateCount++,o[u].lateTime+=b.lateTime,o[u].lateLostTime+=b.lateLostTime),0<b.earlyTime&&(o[u].earlyCount++,
o[u].earlyTime+=b.earlyTime,o[u].earlyLostTime+=b.earlyLostTime),0<b.privateInnerTime&&(o[u].privateInnerCount++,o[u].privateInnerTime+=b.privateInnerTime,o[u].privateInnerLostTime+=b.privateInnerLostTime),o[u].lostTime+=(b.lateLostTime||0)+(b.earlyLostTime||0)+(b.privateInnerLostTime||0),o[u].paidRestTime+=p.rack.paidRestTime,o[u].paidHolyTime+=p.rack.paidHolyTime,
o[u].holidayDeductionTime+=p.rack.holidayDeductionTime,p.rack.plannedHolidayReal?o[u].plannedHolidayCount++:(p.holiday1&&(_=p.holiday1.range==teasp.constant.RANGE_ALL?1:.5,p.holiday1.type==teasp.constant.HOLIDAY_TYPE_PAID?o[u].paidHolidayCount+=_:p.holiday1.type==teasp.constant.HOLIDAY_TYPE_DAIQ?o[u].daiqHolidayCount+=_:p.holiday1.type==teasp.constant.HOLIDAY_TYPE_FREE&&(o[u].absentCount+=_)),p.holiday2&&(
_=p.holiday2.range==teasp.constant.RANGE_ALL?1:.5,p.holiday2.type==teasp.constant.HOLIDAY_TYPE_PAID?o[u].paidHolidayCount+=_:p.holiday2.type==teasp.constant.HOLIDAY_TYPE_DAIQ?o[u].daiqHolidayCount+=_:p.holiday2.type==teasp.constant.HOLIDAY_TYPE_FREE&&(o[u].absentCount+=_))),o[u].weekDayDayLegalFixTime+=b.weekDayDayLegalFixTime,o[u].weekDayDayLegalExtTime+=b.weekDayDayLegalExtTime,
o[u].weekDayDayLegalOutTime+=b.weekDayDayLegalOutTime,o[u].weekDayNightLegalFixTime+=b.weekDayNightLegalFixTime,o[u].weekDayNightLegalExtTime+=b.weekDayNightLegalExtTime,o[u].weekDayNightLegalOutTime+=b.weekDayNightLegalOutTime,o[u].weekEndDayLegalTime+=b.weekEndDayLegalTime,o[u].weekEndDayLegalOutTime+=b.weekEndDayLegalOutTime,o[u].weekEndNightLegalTime+=b.weekEndNightLegalTime,
o[u].weekEndNightLegalOutTime+=b.weekEndNightLegalOutTime,o[u].holidayDayTime+=b.holidayDayTime,o[u].holidayNightTime+=b.holidayNightTime,a.workSystem==teasp.constant.WORK_SYSTEM_MANAGER&&u==teasp.constant.C_DISC&&(o[u].minasiWorkWholeTime+=b.minasiWorkWholeTime||0))}o[u].amountTime=o[u].workWholeTime-o[u].workHolidayTime-o.fixTime,o[u].carryforwardTime=o[u].amountTime-o[u].settlementTime,o[u].workFixedDay=o.fixDays,
o[u].workFixedTime=o.fixTime,o[u].workHolidayCount=o.workHolidays,o[u].workLegalHolidayCount=o.workLegalHolidays,o[u].workPublicHolidayCount=o.workPublicHolidays,o[u].workRealDay=o.workDays;var v=3<o.config.variablePeriod?2520:2700,T=Math.floor((1<o.config.variablePeriod?2400:o.config.legalTimeOfWeek)*d/7),j=Math.floor(2400*d/7);o[u].workOverTime36=o[u].workLegalOutOverTime+o[u].workChargeTime,
o[u].quartWorkOverTime36=o.quartWorkOverTime36+o[u].workOverTime36,o[u].totalWorkOverTime36=o.totalWorkOverTime36+o[u].workOverTime36,o[u].totalWorkOverCount36=o.totalWorkOverCount36+(o[u].workOverTime36>v?1:0),o[u].workOver40perWeek=o[u].workRealTime>j?o[u].workRealTime-j:0,3600<o[u].workOverTime36&&(o[u].workOver60Time=o[u].workOverTime36-3600),2700<o[u].workOverTime36&&(o[u].workOver45Time=o[u].workOverTime36-2700
),o[u].legalWorkTime=T,o[u].workOffTime=o[u].restTime}if(a.workSystem==teasp.constant.WORK_SYSTEM_FLEX&&1<a.variablePeriod)if(o.carryforwardToNext=(o.carryforwardFromPrev||0)+o.disc.amountTime-o.disc.settlementTime,this.pouch.isSettlementMonth(o))for(var E=o.periodInfo,h=(Math.max(o.carryforwardToNext+o.disc.settlementTime,0),0);h<n.length;h++){var u=n[h],L=E.realWorkTimeWoLHPrev-E.settlementTimePrev+(
o[u].workRealTime-o[u].workHolidayTime),k=(o[u].settlementTime,Math.max(L-o[u].settlementTime-Math.max(E.fixTimeOfPeriod,o.legalTimeOfPeriod),0)),L=Math.min(Math.max(L-o[u].settlementTime-o.legalTimeOfPeriod,0),Math.max(E.fixTimeOfPeriod-o.legalTimeOfPeriod,0));o[u].workLegalOverTime=Math.max(o.carryforwardToNext-k,0),o[u].workLegalOutOverTime=k+o[u].settlementTime,o[u].workChargeTime=L,
o[u].workOverTime=o[u].workLegalOverTime+o[u].workLegalOutOverTime,o[u].workOverTime36=o[u].workLegalOutOverTime+o[u].workChargeTime,o[u].quartWorkOverTime36=o.quartWorkOverTime36+o[u].workOverTime36,o[u].totalWorkOverTime36=o.totalWorkOverTime36+o[u].workOverTime36,o[u].totalWorkOverCount36=o.totalWorkOverCount36+(o[u].workOverTime36>v?1:0),o[u].workOver60Time=Math.max(o[u].workOverTime36-3600,0),
o[u].workOver45Time=Math.max(o[u].workOverTime36-2700,0)}else for(h=0;h<n.length;h++)o[u=n[h]].workLegalOverTime=0,o[u].workLegalOutOverTime=o[u].settlementTime,o[u].workChargeTime=0,o[u].workOverTime=o[u].workLegalOutOverTime,o[u].workOverTime36=o[u].workLegalOutOverTime+o[u].workChargeTime,o[u].quartWorkOverTime36=o.quartWorkOverTime36+o[u].workOverTime36,
o[u].totalWorkOverTime36=o.totalWorkOverTime36+o[u].workOverTime36,o[u].totalWorkOverCount36=o.totalWorkOverCount36+(o[u].workOverTime36>v?1:0),o[u].workOver60Time=Math.max(o[u].workOverTime36-3600,0),o[u].workOver45Time=Math.max(o[u].workOverTime36-2700,0);a.workSystem==teasp.constant.WORK_SYSTEM_MUTATE&&0!=a.variablePeriod&&(c=o.legalTimeOfPeriod,m=(this.pouch.getMonthValueByKey("preWorkLegalTimeOfPeriod")||0
)+this.pouch.getMonthSubValueByKey("workLegalTime")-this.pouch.getMonthSubValueByKey("workChargeTime40H"),o.overTimeInPeriod=Math.max(m-c,0)),this.decorateEmpDays(t,a,i,e),this.pouch.checkShiftChangeMonth()},teasp.logic.EmpTime.prototype.mergeEmpDays=function(e,t,a,o,s,i){var n,r=parseInt(t.initialDayOfWeek,10),l=this.getApplyDateMap(o),p=this.getHolidayExcludeMap(o),o=teasp.util.date.addDays(i,7),
d=teasp.logic.EmpTime.createWeekObjs(s,o,r,dojo.hitch(this.pouch,this.pouch.isAlive)),c=teasp.logic.EmpTime.getDateListByWeekObjs(d),m=a[teasp.util.date.formatDate(teasp.util.date.addDays(teasp.util.date.parseDate(c[0]),-1))],h=(this.pouch.setMonthlyOverTimeApplys(l[teasp.constant.APPLY_TYPE_MONTHLYOVERTIME]),0),u=[];for(n in a)u.push(n);for(var g,y,u=u.sort(function(e,t){return e<t?-1:1}),f=0;f<u.length;f++
)a[x=u[f]]&&(g=this.pouch.getEmpMonthByDate(x).config,b=this.mergeEmpDay(a,x,l[x]||[],u,g),c.contains(x)&&(b.rack.holidayExcludes=p[x]||[],T=teasp.logic.EmpTime.getWeekObj(d,b.rack.key),b.dayType==teasp.constant.DAY_TYPE_LEGAL_HOLIDAY?(T.legalHolidays++,7<=T.dkeys.length&&0):b.dayType!=teasp.constant.DAY_TYPE_NORMAL&&(T.lastHoliday=b.rack.key),b.dayType!=teasp.constant.DAY_TYPE_NORMAL&&(b.rack.isOrgHoliday=!0),
m&&1440<m.endTime&&!g.extendDayType&&(b.rack.legalWorked=!0),(b.rack.worked||b.rack.legalWorked||b.dayType==teasp.constant.DAY_TYPE_NORMAL)&&T.workOrFixDays++,m=b,s<=x&&x<=i&&(h+=b.rack.paidHolyTime||0)));if(null!==t.defaultLegalHoliday)for(f=0;f<d.length;f++){for(var b,_,v,T=d[f],j=null,E=null,L=[],k=0,D=!1,I=null,A=null,S=0;S<T.dkeys.length;S++){if((b=a[x=T.dkeys[S]]).dayType==teasp.constant.DAY_TYPE_LEGAL_HOLIDAY
){j=null,E=b;break}b.dayType!=teasp.constant.DAY_TYPE_NORMAL&&(L.push(b),!j&&b.defaultLegalHolidayFlag?j=b:(b.rack.worked||b.rack.legalWorked)&&k++)}if(0<L.length&&(L=L.sort(function(e,t){return e.defaultLegalHolidayFlag!=t.defaultLegalHolidayFlag?e.defaultLegalHolidayFlag?-1:1:e.dayType!=t.dayType?e.dayType==teasp.constant.DAY_TYPE_NORMAL_HOLIDAY?-1:1:teasp.util.date.compareDate(t.date,e.date)})),j){if((
j.rack.worked||j.rack.legalWorked)&&L.length>k)for(S=0;S<L.length;S++)if(!L[S].rack.worked&&!L[S].rack.legalWorked){j=L[S];break}this.isFixedMonth(this.pouch.getObj(),j.date)&&(D=!0,I=j.workFlag,A=j.dayType),j.dayType==teasp.constant.DAY_TYPE_NORMAL&&(j.workFlag=!0,j.autoLH=!0),j.dayType=teasp.constant.DAY_TYPE_LEGAL_HOLIDAY}if(!E&&!j&&t.autoLegalHoliday){if(0<L.length){if(L.length>k)for(S=0;S<L.length;S++)if(
!L[S].rack.worked&&!L[S].rack.legalWorked){j=L[S];break}if(!j){for(S=0;S<L.length;S++)if(L[S].defaultLegalHolidayFlag&&!this.isFixedMonth(this.pouch.getObj(),L[S].date)){j=L[S];break}j||this.isFixedMonth(this.pouch.getObj(),L[0].date)||(j=L[0])}j&&(this.isFixedMonth(this.pouch.getObj(),j.date)&&(D=!0,I=j.workFlag,A=j.dayType),j.dayType==teasp.constant.DAY_TYPE_NORMAL&&(j.workFlag=!0,j.autoLH=!0),
j.dayType=teasp.constant.DAY_TYPE_LEGAL_HOLIDAY)}7<=T.workOrFixDays&&!j&&((j=a[_=T.dkeys[6]])&&(this.isFixedMonth(this.pouch.getObj(),_)&&(D=!0,I=j.workFlag,A=j.dayType),v=j.dayType,j.dayType=teasp.constant.DAY_TYPE_LEGAL_HOLIDAY,j.workFlag=!0,j.autoLH=v==teasp.constant.DAY_TYPE_NORMAL))}D&&(j.workFlag=I,j.dayType=A)}else if(t.autoLegalHoliday)for(f=0;f<d.length;f++)(T=d[f]
).workOrFixDays<6||0<d[f].legalHolidays||!T.liveWeekAll||(y=T.dkeys[6],(b=a[y=T.lastHoliday&&!this.isFixedMonth(this.pouch.getObj(),T.lastHoliday)?T.lastHoliday:y])&&!this.isFixedMonth(this.pouch.getObj(),y)&&7<=T.workOrFixDays&&(b.legalHoliday=!0,teasp.util.time.isValidRange(b.startTime,b.endTime)?(b.dayType=teasp.constant.DAY_TYPE_LEGAL_HOLIDAY,b.workFlag=!0,b.autoLH=!0):b.rack.legalWorked&&(v=b.dayType,
b.dayType=teasp.constant.DAY_TYPE_LEGAL_HOLIDAY,b.autoLH=v==teasp.constant.DAY_TYPE_NORMAL)));for(var x,w,f=0;f<c.length;f++)a[x=c[f]]&&(w=a[teasp.util.date.formatDate(teasp.util.date.addDays(x,1))],a[x].rack.nextDayType=w?w.legalHoliday?teasp.constant.DAY_TYPE_LEGAL_HOLIDAY:w.dayType:teasp.constant.DAY_TYPE_NORMAL);return{dlst:c,paidHolyTime:h,startDate:s,endDate:i}},
teasp.logic.EmpTime.prototype.isNormalDay=function(e){return e.dayType==teasp.constant.DAY_TYPE_NORMAL||(e.workFlag||e.autoLH)&&(((e.rack||{}).validApplys||{}).kyushtu||[]).length<=0||this.pouch.isRegulateHoliday((e.rack||{}).key)},teasp.logic.EmpTime.prototype.isFixDay=function(e){return e.dayType==teasp.constant.DAY_TYPE_NORMAL||(e.workFlag||e.autoLH)&&(((e.rack||{}).validApplys||{}).kyushtu||[]).length<=0},
teasp.logic.EmpTime.isFixDay=function(e){return e.dayType==teasp.constant.DAY_TYPE_NORMAL||e.workFlag||e.autoLH},teasp.logic.EmpTime.prototype.isWorkDay=function(e){return e.dayType==teasp.constant.DAY_TYPE_NORMAL||e.workFlag||e.autoLH||0<(((e.rack||{}).validApplys||{}).kyushtu||[]).length},teasp.logic.EmpTime.prototype.calculateEmpDays=function(e,t,a,o,s,i){for(var n={},r=0;r<o.length;r++){var l,p,d,c,m=o[r],h=t[m];
h&&this.pouch.isAlive(m)&&(p=s[(l=this.getMonthByDate(e,m)).monthEx],d=l.config,(i!=teasp.constant.C_FREAL&&i!=teasp.constant.C_FDISC||d.workSystem==teasp.constant.WORK_SYSTEM_FLEX)&&(p.dbWorkLegalVal+=(h.workLegalTime||0)+(h.workLegalOverTime||0)-(h.workChargeTime||0),n.period&&n.period!=p&&!l.resetFlag&&(
d.workSystem==teasp.constant.WORK_SYSTEM_FIX&&n.config.workSystem==teasp.constant.WORK_SYSTEM_FIX?n.config.defaultPattern.useDiscretionary||d.defaultPattern.useDiscretionary?p.workLegalTime=n.period.dbWorkLegalVal:p.workLegalTime=n.period.workLegalTime:d.workSystem==teasp.constant.WORK_SYSTEM_MUTATE&&n.config.workSystem==teasp.constant.WORK_SYSTEM_MUTATE&&(p.workLegalTimeWeek=n.period.workLegalTimeWeek,
0==d.variablePeriod&&(p.workLegalTime=n.period.workLegalTime))),p.presetMonth.hasOwnProperty(m)&&(p.workTime=0,p.workLegalTime=p.presetMonth[m]),m==l.startDate&&d.workSystem==teasp.constant.WORK_SYSTEM_MUTATE&&0<d.variablePeriod&&l.periodInfo&&1==l.periodInfo.elapsedMonth&&(p.workLegalTimeWeek=0),c=this.pouch.getEntryDate(),(p.presetWeek.hasOwnProperty(h.rack.weekOfDay)||c&&m==c&&l.startDate<m)&&(
d.workSystem==teasp.constant.WORK_SYSTEM_MUTATE?(p.workLegalTimeWeek=0,p.legalTimeWeek=this.pouch.getLegalTimeWeek(l,h.date),0==d.variablePeriod&&(p.workLegalTime=0)):p.workLegalTime=0),h.period=dojo.clone(p),this.calculateEmpDay(h,p,d,a,i),n.period=p,n.config=d))}},teasp.logic.EmpTime.prototype.decorateEmpDays=function(e,t,a,o){for(var s=o.dlst,i=teasp.data.Pouch.getDaiqZan(this.pouch.getStocks(),s[s.length-1],s[0],
s[s.length-1],this.pouch.isOldDate()),n=this.pouch.isInputAccessControl(),r=(this.pouch.clearDiverges(),0),l=0;l<s.length;l++){var p=s[l],d=a[p];if(d){this.decorateEmpDay(e,t,d),r+=this.getDaiqCount(d);var c,m=this.getStockCount(d);if(m)for(var h in m)!m.hasOwnProperty(h)||(c=teasp.data.Pouch.getStockZan(this.pouch.getStocks(),h,p)).zan<0&&this.pouch.setStockLack(h,m[h],c.zan);
n&&o.startDate<=p&&p<=o.endDate&&this.pouch.getEmpDay(p).isDivergeNoReason()&&this.pouch.setDiverges({date:p})}}this.pouch.setDaiqLack(i.overSpend<0&&0<r)},teasp.logic.EmpTime.prototype.mergeEmpDay=function(e,t,a,o,s){var i=e[t];if(delete i.rack,delete i.period,delete i.real,delete i.disc,delete i.deco,delete i.legalHoliday,i.timeTable&&0<i.timeTable.length)for(var n=i.timeTable.length-1;0<=n;n--
)!i.timeTable[n].holidayId&&i.timeTable[n].type!=teasp.constant.REST_PAY&&i.timeTable[n].type!=teasp.constant.REST_UNPAY||i.timeTable.splice(n,1);i.rack={},i.rack.key=t,i.rack.key>this.todayKey?i.rack.todayDiff=1:i.rack.key<this.todayKey?i.rack.todayDiff=-1:i.rack.todayDiff=0,i.rack.flexFlag=s.workSystem==teasp.constant.WORK_SYSTEM_FLEX?2:0,i.dayType=i.dayType||teasp.constant.DAY_TYPE_NORMAL;for(
var r=teasp.util.date.parseDate(i.rack.key),r=(i.rack.weekOfDay=r.getDay(),i.plannedHoliday&&!this.isFixDay(i)&&(i.plannedHoliday=!1),i.dayFixed=this.pouch.isEmpMonthFixedByDate(t),"number"!=typeof i.startTime&&(i.startTime=null),"number"!=typeof i.endTime&&(i.endTime=null),i.timeTable=teasp.util.extractTimes(i.timeTable),[]),l=this.getValidApplys(a,r,t),p=(i.rack.allApplys=a.sort(function(e,t){
return e.applyTime<t.applyTime?-1:e.applyTime>t.applyTime?1:0}),i.rack.validApplys=l,i.rack.invalidApplys=r,i.rack.warningApplys=[],[]),n=0;n<i.rack.allApplys.length;n++){var d=i.rack.allApplys[n];teasp.logic.EmpTime.containApply(i.rack.validApplys,d)&&d.note&&p.push(d.note)}if(0<p.length&&(i.rack.applyNotes=p.join("\r\n")),i.applyId){for(var c=null,m=null,h=null,n=0;n<i.rack.allApplys.length;n++)(
d=i.rack.allApplys[n]).applyType!=teasp.constant.APPLY_TYPE_HOLIDAY||d.close||(d.holiday.range==teasp.constant.RANGE_ALL?c=d:d.holiday.range==teasp.constant.RANGE_AM?m=d:h=d);c?i.applyId.holidayApplyId1||(i.applyId.holidayApplyId1=c.id,i.applyId.holidayApplyId2=null):m?(i.applyId.holidayApplyId1&&i.applyId.holidayApplyId1==m.id||(i.applyId.holidayApplyId1=m.id),
h?i.applyId.holidayApplyId2&&i.applyId.holidayApplyId2==h.id||(i.applyId.holidayApplyId2=h.id):i.applyId.holidayApplyId2=null):h&&(i.applyId.holidayApplyId1&&i.applyId.holidayApplyId1==h.id||(i.applyId.holidayApplyId1=h.id),i.applyId.holidayApplyId2=null)}var a=null,o=(l.shiftSet&&(j=l.shiftSet,i.dayFixed&&!i.zanteiDayType||(j.pattern&&!i.dayFixed&&(i.pattern=j.pattern),null!==j.dayType&&(i.dayType=parseInt(j.dayType
,10))),i.rack.workPlace=j.workPlace,teasp.util.time.isValidRange(j.startTime,j.endTime)&&(a=j,i.rack.shiftStartTime=j.startTime,i.rack.shiftEndTime=j.endTime)),(l.exchangeS||l.exchangeE)&&(r=!this.pouch.isProhibitInputTimeUntilApproved(),g=l.exchangeS?{dkey1:l.exchangeS.startDate,dkey2:l.exchangeS.exchangeDate,valid:r||teasp.constant.STATUS_APPROVES.contains(l.exchangeS.status)}:null,r=l.exchangeE?{
dkey1:l.exchangeE.exchangeDate,dkey2:l.exchangeE.originalStartDate,valid:r||teasp.constant.STATUS_APPROVES.contains(l.exchangeE.status)}:null,(r=teasp.logic.EmpTime.exchangeDateInfo(this.pouch,e,t,o,r))&&r.valid&&(!i.dayFixed||i.zanteiDayType)&&(i.dayType=r.dayType),(o=(!(e=teasp.logic.EmpTime.exchangeDateInfo(this.pouch,e,t,o,g))||!e.valid)&&r||e)&&(i.exchangeDate=o.exchangeDate,i.dayFixed&&!i.zanteiDayType||(
i.dayType=o.dayType),void 0!==o.orgDayType&&(i.orgDayType=o.orgDayType),o.interim?i.interim=o.interim:e&&e.interim&&(i.interim=e.interim),l.exchangeS&&l.exchangeE||(g=i.exchangeDate,l.exchangeS&&l.exchangeS.exchangeDateReal&&l.exchangeS.exchangeDateReal!=i.exchangeDate&&(g=l.exchangeS.exchangeDateReal),r=this.pouch.getObj(),o=this.pouch.getEmpMonthByDate(t),e=this.pouch.getEmpMonthByDate(i.exchangeDate),
o=teasp.logic.EmpTime.getDayInfo(t,o,r.cals[t],r.empTypePatterns),t=teasp.logic.EmpTime.getDayInfo(g,e,r.cals[g],r.empTypePatterns),(o.dayType==teasp.constant.DAY_TYPE_NORMAL&&t.dayType==teasp.constant.DAY_TYPE_NORMAL||o.dayType!=teasp.constant.DAY_TYPE_NORMAL&&t.dayType!=teasp.constant.DAY_TYPE_NORMAL)&&i.rack.invalidApplys.push({apply:l.exchangeS,reason:teasp.constant.REASON_NG_EXCHANGE,keep:!0})))),(
l.patternS||l.patternL||l.patternD)&&(j=l.patternS||l.patternL,e=l.patternD,i.dayFixed&&!i.zanteiDayType||(j&&j.pattern&&!i.dayFixed&&(i.pattern=j.pattern),r=g=null,j&&(l.patternS&&l.patternS.dayType?r=l.patternS:l.patternL&&l.patternL.dayType&&(r=l.patternL),r&&(g=r.dayType)),null!==(g=e&&(!r||r.applyTime<e.applyTime)?e.dayType:g)&&(i.dayType=parseInt(g,10))),j&&teasp.util.time.isValidRange(j.startTime,j.endTime)&&(
(a=j).pattern&&j.pattern.useDiscretionary&&!j.pattern.workTimeChangesWithShift&&(i.dayType==teasp.constant.DAY_TYPE_NORMAL||this.pouch.isRegulateHoliday(i.rack.key))?i.notify={startTime:j.startTime,endTime:j.endTime}:s.workSystem==teasp.constant.WORK_SYSTEM_FLEX&&j.pattern&&j.pattern.disableCoreTime||(i.rack.shiftStartTime=j.startTime,i.rack.shiftEndTime=j.endTime))),i.dayType),r=(this.isFixDay(i
)&&!i.plannedHoliday?0<l.kyushtu.length&&(i.dayFixed?i.plannedHoliday=!0:(i.rack.invalidApplys.push({apply:l.kyushtu[0],reason:teasp.constant.REASON_NG_KYUSHTU,keep:!1}),l.kyushtu=[])):((l.holidayAll||l.holidayAm||l.holidayPm)&&(l.holidayAll&&!l.holidayAll.holiday.displayDaysOnCalendar&&(i.rack.invalidApplys.push({apply:l.holidayAll,reason:teasp.constant.REASON_NG_HOLIDAY,keep:!1}),l.holidayAll=null),
l.holidayAm&&!l.holidayAm.holiday.displayDaysOnCalendar&&(i.rack.invalidApplys.push({apply:l.holidayAm,reason:teasp.constant.REASON_NG_HOLIDAY,keep:!1}),l.holidayAm=null),l.holidayPm&&!l.holidayPm.holiday.displayDaysOnCalendar&&(i.rack.invalidApplys.push({apply:l.holidayPm,reason:teasp.constant.REASON_NG_HOLIDAY,keep:!1}),l.holidayPm=null)),i.plannedHoliday&&((t=l.exchangeS||l.exchangeE)&&i.rack.invalidApplys.push({
apply:t,reason:teasp.constant.REASON_NG_EARLYEND,keep:!1}),(j=(j=l.patternD)||(l.patternS&&l.patternS.dayType?l.patternS:l.patternL))&&"1"==j.dayType&&i.rack.warningApplys.push({apply:j,reason:teasp.constant.REASON_NG_DAYTYPE1,keep:!1})),l.kyushtu.length<=0&&(l.zangyo&&0<l.zangyo.length&&i.rack.warningApplys.push({apply:l.zangyo[0],reason:teasp.constant.REASON_NG_ZANGYO,keep:!1}),
l.earlyStart&&0<l.earlyStart.length&&i.rack.warningApplys.push({apply:l.earlyStart[0],reason:teasp.constant.REASON_NG_EARLYSTART,keep:!1}),l.lateStart&&i.rack.warningApplys.push({apply:l.lateStart,reason:teasp.constant.REASON_NG_LATESTART,keep:!1}),l.earlyEnd&&i.rack.warningApplys.push({apply:l.earlyEnd,reason:teasp.constant.REASON_NG_EARLYEND,keep:!1}))),null),e=(0<l.kyushtu.length&&(this.pouch.isRegulateHoliday(
i.rack.key)||i.plannedHoliday||!teasp.util.time.isValidRange(l.kyushtu[0].startTime,l.kyushtu[0].endTime)||(i.rack.shiftStartTime=l.kyushtu[0].startTime,i.rack.shiftEndTime=l.kyushtu[0].endTime,l.kyushtu[0].timeTable&&(r=teasp.util.extractTimes(l.kyushtu[0].timeTable))),i.rack.fixStartTime=i.rack.shiftStartTime,i.rack.fixEndTime=i.rack.shiftEndTime,teasp.constant.STATUS_APPROVES.contains(l.kyushtu[0].status
)||!this.pouch.isProhibitInputTimeUntilApproved()||i.interim||(i.interim={orgDayType:i.dayType,dayType:i.dayType})),i.pattern?2==i.rack.flexFlag&&(i.rack.flexFlag=1):i.pattern=s.defaultPattern,i.pattern=dojo.clone(i.pattern),s.workSystem==teasp.constant.WORK_SYSTEM_FLEX&&(i.rack.useCoreTime=!i.pattern.disableCoreTime&&(!!i.pattern.id||s.useCoreTime)),null),u=(
!i.pattern.useHalfHolidayRestTime||l.holidayAll||l.holidayAm&&l.holidayPm||!l.holidayAm&&!l.holidayPm||(e=l.holidayAm?i.pattern.amHolidayRestTimes:i.pattern.pmHolidayRestTimes),i.pattern.restTimes=r||e||teasp.util.extractTimes(i.pattern.restTimes),i.patternOrg=i.pattern,i.pattern=dojo.clone(i.patternOrg)),g=(s.workSystem==teasp.constant.WORK_SYSTEM_FLEX||s.workSystem==teasp.constant.WORK_SYSTEM_MUTATE?(
u.useDiscretionary=!1,i.notify&&(i.rack.shiftStartTime=i.notify.startTime,u.workTimeChangesWithShift?i.rack.shiftEndTime=i.notify.endTime:i.rack.shiftEndTime=teasp.logic.EmpTime.getReachTime(i.rack.shiftStartTime,u.restTimes,u.standardFixTime))):o!=teasp.constant.DAY_TYPE_NORMAL&&0<i.rack.validApplys.kyushtu.length&&!this.pouch.isRegulateHoliday(i.rack.key
)&&s.workSystem!=teasp.constant.WORK_SYSTEM_MANAGER?u.useDiscretionary=!1:s.workSystem==teasp.constant.WORK_SYSTEM_MANAGER&&(u.useDiscretionary=!0),i.notify&&"number"==typeof i.notify.startTime?i.notify.startTime:i.rack.shiftStartTime);if(u.enableRestTimeShift&&"number"==typeof g&&u.stdStartTime!=g){var y=g-u.stdStartTime;u.restTimes=teasp.util.extractTimes(u.restTimes);for(n=u.restTimes.length-1;0<=n;n--
)u.restTimes[n].from+=y,u.restTimes[n].to+=y,(u.restTimes[n].from<0||2880<=u.restTimes[n].from||u.restTimes[n].to<0||2880<=u.restTimes[n].to)&&u.restTimes.splice(n,1);if(u.useHalfHoliday&&(u.amHolidayStartTime+=y,u.amHolidayEndTime+=y,u.pmHolidayStartTime+=y,u.pmHolidayEndTime+=y,u.useHalfHolidayRestTime)){for(n=u.amHolidayRestTimes.length-1;0<=n;n--)u.amHolidayRestTimes[n].from+=y,u.amHolidayRestTimes[n].to+=y,(
u.amHolidayRestTimes[n].from<0||2880<=u.amHolidayRestTimes[n].from||u.amHolidayRestTimes[n].to<0||2880<=u.amHolidayRestTimes[n].to)&&u.amHolidayRestTimes.splice(n,1);for(n=u.pmHolidayRestTimes.length-1;0<=n;n--)u.pmHolidayRestTimes[n].from+=y,u.pmHolidayRestTimes[n].to+=y,(u.pmHolidayRestTimes[n].from<0||2880<=u.pmHolidayRestTimes[n].from||u.pmHolidayRestTimes[n].to<0||2880<=u.pmHolidayRestTimes[n].to
)&&u.pmHolidayRestTimes.splice(n,1)}i.notify&&(u.stdStartTime+=y,u.stdEndTime+=y)}t=teasp.logic.EmpTime.getFixTimeSpan(u.stdStartTime,u.restTimes,u.standardFixTime);if(this.isNormalDay(i)){if(teasp.util.time.isValidRange(i.rack.shiftStartTime,i.rack.shiftEndTime)?(i.rack.fixStartTime=i.rack.shiftStartTime,i.rack.fixEndTime=i.rack.shiftEndTime):(i.rack.fixStartTime=u.stdStartTime,i.rack.fixEndTime=u.stdEndTime),
u.useDiscretionary){s.workSystem!=teasp.constant.WORK_SYSTEM_MANAGER&&i.notify&&i.notify.startTime!=i.rack.fixStartTime&&(i.rack.fixStartTimeOrg=i.rack.fixStartTime,i.rack.fixEndTimeOrg=i.rack.fixEndTime,T=this.getRealTime(i.rack.fixStartTime,i.rack.fixEndTime,u.restTimes),i.rack.fixStartTime=i.notify.startTime,i.rack.fixEndTime=teasp.logic.EmpTime.getReachTime(i.rack.fixStartTime,u.restTimes,T));for(var f=[{
from:i.rack.fixStartTime,to:i.rack.fixEndTime}],n=0;n<u.restTimes.length;)f=teasp.util.time.sliceTimes(f,u.restTimes[n]),n++;var b=0,_=0;for(n=0;n<f.length;n++)if((b+=f[n].to-f[n].from)>=u.standardFixTime){_=f[n].to-(b-u.standardFixTime);break}i.rack.calcEndTime=_}}else!a&&this.pouch.isRegulateHoliday(i.rack.key)&&(i.rack.fixStartTime=u.stdStartTime,i.rack.fixEndTime=u.stdEndTime);
i.rack.startTimeEx="number"==typeof i.startTime?i.startTime:null,i.rack.endTimeEx="number"==typeof i.endTime?i.endTime:null,i.rack.paidHolyTime=0,i.rack.holidayDeductionTime=0,i.rack.paidHolySpans=[],i.rack.freeHolySpans=[],i.rack.holyTime=0,i.rack.holySpans=[],i.rack.excludeHalf=[],i.rack.tempHolyTime=0;var v,T,j=this.pouch.getEmpDay(i.date),r=(i.rack.flexHalfDayTime=j.isFlexHalfDayTimeDay(),i.dayFixed||(
i.holiday1=null,i.holiday2=null,l.holidayAll?i.holiday1=l.holidayAll.holiday:(l.holidayAm||l.holidayPm)&&(u.useHalfHoliday?l.holidayAm&&l.holidayPm?(i.holiday1=l.holidayAm.holiday,i.holiday2=l.holidayPm.holiday):l.holidayAm?i.holiday1=l.holidayAm.holiday:l.holidayPm&&(i.holiday1=l.holidayPm.holiday):(l.holidayAm&&(i.rack.invalidApplys.push({apply:l.holidayAm,reason:teasp.constant.REASON_NOHALF,keep:!1}),
l.holidayAm=null),l.holidayPm&&(i.rack.invalidApplys.push({apply:l.holidayPm,reason:teasp.constant.REASON_NOHALF,keep:!1}),l.holidayPm=null)))),i.holiday1&&i.holiday1.range==teasp.constant.RANGE_ALL?(i.rack.holyTime=u.standardFixTime,i.rack.holySpans.push({from:u.stdStartTime,to:t}),
i.holiday1.type==teasp.constant.HOLIDAY_TYPE_PAID||s.daiqReckontoWorked&&i.holiday1.type==teasp.constant.HOLIDAY_TYPE_DAIQ?o!=teasp.constant.DAY_TYPE_NORMAL&&i.holiday1.displayDaysOnCalendar||(i.rack.paidHolyTime=u.standardFixTime,i.rack.paidHolySpans.push({from:u.stdStartTime,to:t})):o!=teasp.constant.DAY_TYPE_NORMAL&&i.holiday1.displayDaysOnCalendar||(i.rack.freeHolyTime=u.standardFixTime,i.rack.freeHolySpans.push(
{from:u.stdStartTime,to:t})),i.rack.holidayJoin={flag:3,name:i.holiday1.name,type:i.holiday1.type,planned:i.holiday1.plannedHoliday||!1,displayDaysOnCalendar:i.holiday1.displayDaysOnCalendar}):i.holiday1&&i.holiday2&&i.holiday1.range==teasp.constant.RANGE_AM&&i.holiday2.range==teasp.constant.RANGE_PM?(i.rack.holyTime=u.standardFixTime,i.rack.flexHalfDayTime||i.rack.holySpans.push({from:u.stdStartTime,to:t}),(
i.holiday1.type==teasp.constant.HOLIDAY_TYPE_PAID||s.daiqReckontoWorked&&i.holiday1.type==teasp.constant.HOLIDAY_TYPE_DAIQ)&&(i.holiday2.type==teasp.constant.HOLIDAY_TYPE_PAID||s.daiqReckontoWorked&&i.holiday2.type==teasp.constant.HOLIDAY_TYPE_DAIQ)?(i.rack.paidHolyTime=u.standardFixTime,i.rack.flexHalfDayTime||i.rack.paidHolySpans.push({from:u.stdStartTime,to:t})
):i.holiday1.type==teasp.constant.HOLIDAY_TYPE_PAID||s.daiqReckontoWorked&&i.holiday1.type==teasp.constant.HOLIDAY_TYPE_DAIQ?i.rack.flexHalfDayTime?(i.rack.paidHolyTime=Math.ceil(u.standardFixTime/2),i.rack.freeHolyTime=Math.floor(u.standardFixTime/2)):(i.rack.paidHolyTime=this.getRealTime(u.amHolidayStartTime,u.amHolidayEndTime,u.restTimes),i.rack.paidHolySpans.push({from:u.amHolidayStartTime,to:u.amHolidayEndTime})
,i.rack.freeHolyTime=this.getRealTime(u.pmHolidayStartTime,u.pmHolidayEndTime,u.restTimes),i.rack.freeHolySpans.push({from:u.pmHolidayStartTime,to:u.pmHolidayEndTime})):i.holiday2.type==teasp.constant.HOLIDAY_TYPE_PAID||s.daiqReckontoWorked&&i.holiday2.type==teasp.constant.HOLIDAY_TYPE_DAIQ?i.rack.flexHalfDayTime?(i.rack.paidHolyTime=Math.ceil(u.standardFixTime/2),i.rack.freeHolyTime=Math.floor(u.standardFixTime/2)
):(i.rack.freeHolyTime=this.getRealTime(u.amHolidayStartTime,u.amHolidayEndTime,u.restTimes),i.rack.freeHolySpans.push({from:u.amHolidayStartTime,to:u.amHolidayEndTime}),i.rack.paidHolyTime=this.getRealTime(u.pmHolidayStartTime,u.pmHolidayEndTime,u.restTimes),i.rack.paidHolySpans.push({from:u.pmHolidayStartTime,to:u.pmHolidayEndTime})):(i.rack.freeHolyTime=u.standardFixTime,
i.rack.flexHalfDayTime||i.rack.freeHolySpans.push({from:u.stdStartTime,to:t})),i.rack.holidayJoin={flag:3,name:i.holiday1.name+teasp.message.getLabel("tm10001560")+i.holiday2.name,type:(i.holiday1.type<=i.holiday2.type?i.holiday1:i.holiday2).type}):i.holiday1&&(i.holiday1.range==teasp.constant.RANGE_AM?(v=this.getRealTime(u.amHolidayStartTime,u.amHolidayEndTime,u.restTimes),
i.rack.flexHalfDayTime?i.rack.holyTime=Math.ceil(u.standardFixTime/2):(i.rack.holyTime=v,i.rack.holySpans.push({from:u.amHolidayStartTime,to:u.amHolidayEndTime}),i.rack.excludeHalf.push({from:0,to:u.amHolidayEndTime})),i.holiday1.type==teasp.constant.HOLIDAY_TYPE_PAID||s.halfDaiqReckontoWorked&&i.holiday1.type==teasp.constant.HOLIDAY_TYPE_DAIQ?i.rack.flexHalfDayTime?i.rack.paidHolyTime=Math.ceil(u.standardFixTime/2
):(i.rack.paidHolyTime=v,i.rack.paidHolySpans.push({from:u.amHolidayStartTime,to:u.amHolidayEndTime})):i.rack.flexHalfDayTime?i.rack.freeHolyTime=Math.ceil(u.standardFixTime/2):(i.rack.freeHolyTime=v,i.rack.freeHolySpans.push({from:u.amHolidayStartTime,to:u.amHolidayEndTime})),(s.halfDaiqReckontoWorked||i.holiday1.type!=teasp.constant.HOLIDAY_TYPE_DAIQ)&&i.holiday1.type!=teasp.constant.HOLIDAY_TYPE_FREE||(
i.rack.tempHolyTime=v),i.rack.holidayJoin={flag:1,name:i.holiday1.name,type:i.holiday1.type},i.rack.fixStartTimeOrg&&(T=this.getRealTime(i.rack.fixStartTime,i.rack.fixEndTime,u.restTimes),i.rack.fixStartTime2=u.amHolidayEndTime+(i.rack.fixStartTime-i.rack.fixStartTimeOrg),i.rack.fixEndTime2=teasp.logic.EmpTime.getReachTime(i.rack.fixStartTime2,u.restTimes,T-v))):(v=this.getRealTime(u.pmHolidayStartTime,
u.pmHolidayEndTime,u.restTimes),i.rack.flexHalfDayTime?i.rack.holyTime=Math.ceil(u.standardFixTime/2):(i.rack.holyTime=v,i.rack.holySpans.push({from:u.pmHolidayStartTime,to:u.pmHolidayEndTime}),i.rack.excludeHalf.push({from:u.pmHolidayStartTime,to:2880})),
i.holiday1.type==teasp.constant.HOLIDAY_TYPE_PAID||s.halfDaiqReckontoWorked&&i.holiday1.type==teasp.constant.HOLIDAY_TYPE_DAIQ?i.rack.flexHalfDayTime?i.rack.paidHolyTime=Math.ceil(u.standardFixTime/2):(i.rack.paidHolyTime=v,i.rack.paidHolySpans.push({from:u.pmHolidayStartTime,to:u.pmHolidayEndTime})):i.rack.flexHalfDayTime?i.rack.freeHolyTime=Math.ceil(u.standardFixTime/2):(i.rack.freeHolyTime=v,
i.rack.freeHolySpans.push({from:u.pmHolidayStartTime,to:u.pmHolidayEndTime})),(s.halfDaiqReckontoWorked||i.holiday1.type!=teasp.constant.HOLIDAY_TYPE_DAIQ)&&i.holiday1.type!=teasp.constant.HOLIDAY_TYPE_FREE||(i.rack.tempHolyTime=v),i.rack.holidayJoin={flag:2,name:i.holiday1.name,type:i.holiday1.type},i.rack.fixStartTimeOrg&&(T=this.getRealTime(i.rack.fixStartTime,i.rack.fixEndTime,u.restTimes),
i.rack.fixStartTime2=i.rack.fixStartTime,i.rack.fixEndTime2=teasp.logic.EmpTime.getReachTime(i.rack.fixStartTime2,u.restTimes,T-v)))),i.rack.plannedHolidayReal=!1,i.plannedHoliday&&null===i.startTime&&null===i.endTime&&(i.rack.plannedHolidayReal=!0,i.rack.paidHolyTime=u.standardFixTime,i.rack.holyTime=u.standardFixTime),[]),E=((l.holidayAll||l.holidayAm&&l.holidayPm||i.rack.plannedHolidayReal)&&r.push({from:0,
to:2880,dayAll:!0}),i.rack.flexHalfDayTime||(l.holidayAm?r.push({from:0,to:u.amHolidayEndTime}):l.holidayPm&&r.push({from:u.pmHolidayStartTime,to:2880})),i.rack.excludes=r,this.readTimeTable(i),i.rack.paidRestTime=0,[]),L=[],k=[],D=dojo.clone(r);if(null===i.startTime&&null===i.endTime?dojo.forEach(u.restTimes,function(e){D.push(e)}):dojo.forEach(i.rack.fixRests.concat(i.rack.freeRests),function(e){
e.type=teasp.logic.EmpTime.isFixRest(e,i.pattern.restTimes)?teasp.constant.REST_FIX:teasp.constant.REST_FREE,D.push(e)}),this.isWorkDay(i))for(n=0;n<l.holidayTime.length;n++){var I=l.holidayTime[n],A={from:I.startTime,to:I.endTime,type:I.holiday.type==teasp.constant.HOLIDAY_TYPE_FREE?teasp.constant.REST_UNPAY:teasp.constant.REST_PAY,holidayId:I.holidayId},S=this.getRealTime(A.from,A.to,D);i.rack.holyTime+=S,
i.rack.holySpans.push({from:A.from,to:A.to}),I._spendTime=S,I.holiday.type==teasp.constant.HOLIDAY_TYPE_FREE?(s.workSystem!=teasp.constant.WORK_SYSTEM_FLEX&&(i.rack.paidHolyTime+=S),i.rack.holidayDeductionTime+=S,k.push(A)):(i.rack.paidHolyTime+=S,I.holiday.yuqSpend?i.rack.paidRestTime+=60*Math.ceil(S/60):I.holiday.managed?i.rack.paidRestTime+=30*Math.ceil(S/30):i.rack.paidRestTime+=S,i.rack.paidHolySpans.push({
from:A.from,to:A.to}),L.push(A)),E.push(A),i.timeTable.push(A),D.push(A)}i.rack.hourRests=E,i.rack.paidRests=L,i.rack.unpaidRests=k,i.rack.bdrStartTime=i.rack.fixStartTime,i.rack.bdrEndTime=i.rack.fixEndTime;e=this.isNormalDay(i);if(2==i.rack.flexFlag&&e&&i.rack.useCoreTime&&!i.pattern.id&&(i.rack.bdrStartTime=s.coreStartTime,i.rack.bdrEndTime=s.coreEndTime),i.notify&&(i.rack.bdrStartTime=i.notify.startTime,
i.rack.bdrEndTime=i.notify.endTime),i.rack.hotenLate=l.lateStart&&teasp.constant.STATUS_FIX.contains(l.lateStart.status)&&2==l.lateStart.treatDeduct&&!l.lateStart.ownReason,i.rack.hotenEarlyEnd=l.earlyEnd&&teasp.constant.STATUS_FIX.contains(l.earlyEnd.status)&&2==l.earlyEnd.treatDeduct&&!l.earlyEnd.ownReason,2!=i.rack.flexFlag||i.rack.useCoreTime||(i.rack.hotenLate=!1,i.rack.hotenEarlyEnd=!1),
i.rack.orgBdrStartTime=i.rack.bdrStartTime,i.rack.orgBdrEndTime=i.rack.bdrEndTime,teasp.util.time.isValidRange(i.rack.bdrStartTime,i.rack.bdrEndTime)){var x=[],w=[];for(n=0;n<D.length;n++)(M=D[n]).dayAll||M.type&&M.type!=teasp.constant.REST_PAY&&M.type!=teasp.constant.REST_UNPAY&&M.type!=teasp.constant.REST_FIX||(x.push(M),w.push(M));var M,O=u.restTimes||[];for(n=0;n<O.length;n++)x.push(O[n]),w.push(O[n]);for(
teasp.util.time.margeTimeSpans(x),teasp.util.time.margeTimeSpans(w),x=x.sort(function(e,t){return e.from-t.from}),w=w.sort(function(e,t){return t.to-e.to}),n=0;n<x.length;n++)(M=x[n]).from<=i.rack.bdrStartTime&&i.rack.bdrStartTime<M.to&&(i.rack.bdrStartTime=M.to);for(n=0;n<w.length;n++)(M=w[n]).from<i.rack.bdrEndTime&&i.rack.bdrEndTime<=M.to&&(i.rack.bdrEndTime=M.from)}var R,g=this.getRealTime(i.rack.fixStartTime,
i.rack.fixEndTime,u.restTimes);return this.isFixDay(i)?s.workSystem==teasp.constant.WORK_SYSTEM_FLEX||s.workSystem==teasp.constant.WORK_SYSTEM_MANAGER?i.rack.fixTime=u.standardFixTime:(i.rack.actFixTime=g,u.workTimeChangesWithShift?u.useDiscretionary||i.patternOrg&&i.patternOrg.useDiscretionary?((R=i.rack.actFixTime)<u.standardFixTime?i.rack.fixTime=R:i.rack.fixTime=u.standardFixTime,(
R=teasp.logic.EmpTime.getAdjustFixTime({from:i.rack.fixStartTime,to:i.rack.fixEndTime},u,i.rack.fixTime,this.pouch.getRestTimeCheck()))!=i.rack.fixTime&&(i.rack.fixTimeOrg=i.rack.fixTime),i.rack.fixTime=R):u.standardFixTime?((R=teasp.logic.EmpTime.getAdjustFixTime({from:i.rack.fixStartTime,to:i.rack.fixEndTime},u,i.rack.actFixTime,this.pouch.getRestTimeCheck()))!=i.rack.actFixTime&&(
i.rack.fixTimeOrg=i.rack.actFixTime),i.rack.fixTime=R,s.workSystem==teasp.constant.WORK_SYSTEM_FIX&&i.rack.fixTime>s.legalTimeOfDay&&(i.rack.fixTime=s.legalTimeOfDay)):i.rack.fixTime=0:i.rack.fixTime=u.standardFixTime):(this.pouch.isRegulateHoliday(i.rack.key)&&(i.rack.actFixTime=this.getRealTime(i.rack.fixStartTime,i.rack.fixEndTime,u.restTimes)),i.rack.fixTime=0),s.workSystem==teasp.constant.WORK_SYSTEM_FLEX&&(
i.rack.useCoreTime&&this.isNormalDay(i)?(O=dojo.clone(u.restTimes||[]),i.rack.holyTime&&(O=teasp.util.time.margeTimeSpans(O.concat(i.rack.holySpans))),u.id?i.rack.coreTime=this.getRealTime(i.rack.fixStartTime,i.rack.fixEndTime,O):i.rack.coreTime=this.getRealTime(s.coreStartTime,s.coreEndTime,O)):i.rack.coreTime=0),this.isWorkDay(i)?(i.rack.worked=teasp.util.time.isValidRange(i.startTime,i.endTime),
i.rack.worked||o!=teasp.constant.DAY_TYPE_NORMAL||!i.plannedHoliday||i.dayFixed||i.rack.paidHolySpans.push({from:i.pattern.stdStartTime,to:t}),this.isNormalDay(i)&&this.preHoten(i)):i.rack.worked=!1,i},teasp.logic.EmpTime.exchangeDateInfo=function(e,t,a,o,s){var i=t[a];if(s&&(i.rack.key!=s.dkey2||!o.contains(s.dkey1))){var n,o={dayType:i.dayType,valid:s.valid,exchangeDate:i.rack.key!=s.dkey2?s.dkey2:s.dkey1};if(
t[o.exchangeDate])return t=e.getObj(),a=e.getEmpMonthByDate(a),e=e.getEmpMonthByDate(o.exchangeDate),a=!(!a||!a.apply)&&teasp.constant.STATUS_FIX.contains(a.apply.status),n=!(!e||!e.apply)&&teasp.constant.STATUS_FIX.contains(e.apply.status),a&&n?o.dayType=i.dbDayType:(a=teasp.logic.EmpTime.getDayInfo(o.exchangeDate,e,t.cals[o.exchangeDate],t.empTypePatterns),s.valid?(o.orgDayType=o.dayType,o.dayType=a.dayType
):o.interim={orgDayType:i.dayType,dayType:a.dayType}),o}return null},teasp.logic.EmpTime.prototype.calculateEmpDay=function(e,t,a,H,o){var s={startTime:null,endTime:null,calcStartTime:null,calcEndTime:null,workSpan:[],blankSpan:[],skipSpan:[],workRealTime:0,workWholeTime:0,workInFixedTime:0,workLegalTime:0,workLegalOverTime:0,workLegalOutOverTime:0,settlementTime:0,workOverTime:0,workChargeTime:0,workDayChargeTime:0,
workChargeTime40H:0,workHolidayTime:0,workNightTime:0,workNightSpans:[],workInFixedSpan:null,workLegalSpan:null,workLegalOverSpan:[],workLegalOutOverSpan:[],workChargeSpan:[],workHolidaySpan:[],awaySpan:null,restTime:0,awayTime:0,lateTime:0,earlyTime:0,privateInnerTime:0,lateLostTime:0,earlyLostTime:0,privateInnerLostTime:0,weekDayDayLegalFixTime:0,weekDayDayLegalExtTime:0,weekDayDayLegalOutTime:0,
weekDayNightLegalFixTime:0,weekDayNightLegalExtTime:0,weekDayNightLegalOutTime:0,weekEndDayLegalTime:0,weekEndDayLegalOutTime:0,weekEndNightLegalTime:0,weekEndNightLegalOutTime:0,holidayDayTime:0,holidayNightTime:0,discReal:!1,lateFlag:-1,earlyFlag:-1,hotenWork:0,hotenRest:0},P=dojo.clone(H.nightTimes||[]),C=a.legalTimeOfDay,i=(a.workSystem==teasp.constant.WORK_SYSTEM_MUTATE&&a.legalTimeOfDay<e.rack.fixTime&&(
C=e.rack.fixTime),e.rack.excludes),n=(s.startTime=e.startTime,s.endTime=e.endTime,e.rack.bdrStartTime),r=e.rack.bdrEndTime,l=e.rack.orgBdrStartTime,p=e.rack.orgBdrEndTime,d=(2==e.rack.flexFlag&&(n<a.coreStartTime&&(n=a.coreStartTime),r>a.coreEndTime&&(r=a.coreEndTime)),null);if("number"==typeof n&&e.rack.flexFlag<2){for(var W=[{from:l,to:2880}],F=e.pattern.restTimes,c=0;c<F.length;)W=teasp.util.time.sliceTimes(W,F[c]
),c++;var m=0,Y=e.rack.fixTime||e.rack.actFixTime;for(c=0;c<W.length;c++)m+=(A=W[c]).to-A.from,null===d&&Y<=m&&(d=A.to-(m-Y));d<p&&!F.length&&a.deductWithFixedTime&&(d=p)}null===d&&(d=p);var q=n,B=("number"==typeof n&&e.rack.flexFlag<2&&"number"==typeof s.startTime&&"number"==typeof s.endTime&&p<d&&s.endTime<d&&((B=teasp.logic.EmpTime.getReachTimeReverse(Math.max(p,s.endTime),e.pattern.restTimes,
e.rack.fixTime||e.rack.actFixTime))<q&&(q=Math.max(B,s.startTime))),this.isFixDay(e)||this.pouch.isRegulateHoliday(e.rack.key)&&a.workSystem!=teasp.constant.WORK_SYSTEM_MANAGER),h=!e.pattern.useDiscretionary&&B&&(e.rack.flexFlag<2||e.rack.useCoreTime),V=("number"==typeof e.startTime&&(s.lateFlag=h&&n<e.startTime?1:0),"number"==typeof e.endTime&&(s.earlyFlag=h&&e.endTime<r?1:0),[]),K=[],h=e.rack.validApplys.lateStart,
U=e.rack.validApplys.earlyEnd,u=0<e.rack.validApplys.earlyStart.length?e.rack.validApplys.earlyStart[0]:null,g=0<e.rack.validApplys.zangyo.length?e.rack.validApplys.zangyo[0]:null,J=e.rack.freeRests.concat(e.rack.fixRests),y=(y=teasp.util.time.includeRanges(teasp.util.time.margeTimeSpans(J.concat(e.rack.hourRests)),[{from:n,to:d}])).concat(teasp.util.time.excludeRanges(e.pattern.restTimes,[{from:n,to:d}])),G=(
G=teasp.util.time.includeRanges(J,[{from:n,to:d}])).concat(teasp.util.time.excludeRanges(e.pattern.restTimes,[{from:n,to:d}])),f=teasp.util.time.margeTimeSpans(e.pattern.restTimes.concat(e.rack.hourRests)),z=teasp.util.time.margeTimeSpans(f.concat(e.rack.excludeHalf)),X=0;if((e.pattern.restTimes||[]).length<=0){var Z=p-l,Q=this.pouch.getRestTimeCheck();for(c=0;c<Q.length;c++)Q[c].check&&Q[c].workTime<Z&&(X=Math.max(X
,Q[c].restTime))}var b=null,_=("number"==typeof s.startTime&&s.startTime>n&&e.rack.hotenLate&&(s.startTimeOrg=s.startTime,de=n,(N=Math.min(h.endTime,r))<s.startTime&&(R=this.getRealTime(N,s.startTime,z),de=teasp.logic.EmpTime.slideTime(n,s.endTime,f,R,!1)),b=teasp.logic.EmpTime.complementTime(s.startTime,s.endTime,de,b,e.pattern.restTimes,y,G,X,!1),s.startTime=b.tm),
"number"==typeof s.endTime&&s.endTime<r&&e.rack.hotenEarlyEnd&&(s.endTimeOrg=s.endTime,Te=r,ce=Math.max(U.startTime,n),s.endTime<ce&&(Me=this.getRealTime(s.endTime,ce,z),Te=teasp.logic.EmpTime.slideTime(s.startTime,r,f,Me,!0)),b=teasp.logic.EmpTime.complementTime(s.startTime,s.endTime,Te,b,e.pattern.restTimes,y,G,X,!0),s.endTime=b.tm),(2&a.useEarlyWorkFlag&&e.rack.flexFlag?this.pouch.getEarlyWorkBorderTime(
e.rack.fixEndTime,a):a.earlyWorkBorderTime)||0),v=(2&a.useOverTimeFlag&&e.rack.flexFlag?this.pouch.getOverTimeBorderTime(e.rack.fixStartTime,a):a.overTimeBorderTime)||2880,T={bst:B&&2&a.useEarlyWorkFlag&&0<=_?_:-1,bet:B&&2&a.useOverTimeFlag&&0<=v?v:-1,st:null,et:null,xst:null,xet:null,zst:null,zet:null,stFlag:!1,etFlag:!1},_=(T.bst0=T.bst,T.bet0=T.bet,e.notify&&(T.bst<0||e.notify.startTime<T.bst)&&(
8&a.useEarlyWorkFlag||(T.bst=e.notify.startTime)),e.notify&&(T.bet<0||T.bet<e.notify.endTime)&&(8&a.useOverTimeFlag||(T.bet=e.notify.endTime)),T.zst=T.st=2&a.useEarlyWorkFlag?0<=T.bst?T.bst:l:0,T.zet=T.et=2&a.useOverTimeFlag?0<=T.bet?T.bet:p:2880,2&a.useEarlyWorkFlag&&u&&u.startTime<T.st&&(T.st=T.bst=u.startTime),2&a.useOverTimeFlag&&g&&T.et<g.endTime&&(T.et=T.bet=g.endTime),2==e.rack.flexFlag?(_=Math.min(
e.rack.fixStartTime,n),v=Math.max(e.rack.fixEndTime,r),_<T.st&&(T.st=T.bst=_),T.et<v&&(T.et=T.bet=v)):(n<T.st&&(T.st=T.bst=n),T.et<r&&(T.et=T.bet=r)),q<n&&T.st<n&&(n=Math.max(q,T.st)),e.notify?(T.zst>e.notify.startTime&&(T.zst=e.notify.startTime),T.zet<e.notify.endTime&&(T.zet=e.notify.endTime)):e.pattern.useDiscretionary&&o==teasp.constant.C_DISC?(T.zst=e.rack.fixStartTime,T.zet=e.rack.fixEndTime):(
T.zst>e.rack.fixStartTime&&(T.zst=e.rack.fixStartTime),T.zet<e.rack.fixEndTime&&(T.zet=e.rack.fixEndTime)),null),v=0,j=null,$=0,ee=null,E=null;if(g&&T.zet<g.startTime&&(e.pattern.useDiscretionary&&o==teasp.constant.C_DISC?(ee=_=[{from:T.zet,to:g.startTime,type:teasp.constant.REST_FREE}],v=teasp.logic.EmpTime.getSpanTime(_)):(Ae={from:Math.max(T.zet,"number"==typeof s.startTime?s.startTime:0),to:Math.min(g.startTime,
"number"==typeof s.endTime?s.endTime:2880),type:teasp.constant.REST_FREE}).from<Ae.to&&(ee=_=[Ae],v=teasp.logic.EmpTime.getSpanTime(_))),u&&T.zst>u.endTime&&(e.pattern.useDiscretionary&&o==teasp.constant.C_DISC?(E=j=[{from:u.endTime,to:T.zst,type:teasp.constant.REST_FREE}],$=teasp.logic.EmpTime.getSpanTime(j)):(Ae={from:Math.max(u.endTime,"number"==typeof s.startTime?s.startTime:0),to:Math.min(T.zst,
"number"==typeof s.endTime?s.endTime:2880),type:teasp.constant.REST_FREE}).from<Ae.to&&(E=j=[Ae],$=teasp.logic.EmpTime.getSpanTime(j))),e.rack.worked&&e.rack.flexFlag<2&&B&&(T.stFlag=8&a.useEarlyWorkFlag&&($&&s.startTime<T.zst||s.startTime<T.st),T.etFlag=8&a.useOverTimeFlag&&(v&&s.endTime>T.zet||s.endTime>T.et),T.stFlag||T.etFlag)){var L=i.concat(e.rack.fixRests),F=L=(L=L.concat(e.rack.freeRests)).concat(
e.rack.hourRests),te=null,ae=null,k=[].concat(_||[]),k=(g&&g.endTime<s.endTime&&k.push({from:Math.max(g.endTime,s.startTime),to:s.endTime}),k.length&&(te=teasp.util.time.excludeRanges(k,F),L=L.concat(k)),[].concat(j||[])),m=(u&&s.startTime<u.startTime&&k.unshift({from:s.startTime,to:Math.min(u.startTime,s.endTime)}),k.length&&(ae=teasp.util.time.excludeRanges(k,F),L=L.concat(k)),te=te&&te.sort(function(e,t){
return e.to==e.to?e.from-t.from:e.to-t.to}),ae=ae&&ae.sort(function(e,t){return e.to==e.to?e.from-t.from:e.to-t.to}),0),k=0;if(T.etFlag){var oe={from:s.startTime<T.st?T.st:s.startTime,to:s.endTime},se=(0<=T.bet0&&T.bet0<oe.to&&(oe.to=T.bet0),this.getSlicedList(e,[oe],L,a,H));for(c=0;c<se.length;c++)m+=(A=se[c]).to-A.from,null===T.xet&&e.rack.fixTime<=m&&(T.xet=A.to-(m-e.rack.fixTime));var ie=null;if(
m<e.rack.fixTime&&te){var D=e.rack.fixTime-m,I=new Array;for(c=0;c<te.length&&0<D;c++){var A=te[c];0<=T.bet0&&T.bet0<A.to&&(A.to=T.bet0),0<=T.bst0&&A.from<T.bst0&&(A.from=T.bst0),(O=A.to-A.from)<=0||(O<=D?(I.push(A),D-=O):(I.push({from:A.from,to:A.to-(he=O-D)}),D-=O-he))}if(I.length){for(k=teasp.logic.EmpTime.getSpanTime(I),L=teasp.util.time.excludeRanges(L,I),m+=k,c=0;c<I.length;c++)(null===ie||ie<I[c].to)&&(
ie=I[c].to);ee=ee&&teasp.util.time.excludeRanges(dojo.clone(ee),[{from:ee[0].from,to:ie}]),_=teasp.util.time.excludeRanges(_,I),v=teasp.logic.EmpTime.getSpanTime(_)}}v=0<se.length?se[se.length-1].to:s.endTime;null===T.xet&&(T.xet=null!==ie?ie:v),null!==ie&&T.xet<ie?T.xet=ie:(T.xet<T.et&&(T.xet=T.et),0<=T.bet&&T.bet<T.xet&&null===ie&&(T.xet=T.bet),T.xet>s.endTime&&(T.xet=s.endTime))}if(m<e.rack.fixTime&&T.stFlag){oe={
from:s.startTime,to:null!==T.xet?T.xet:s.endTime>T.et?T.et:s.endTime};for(0<=T.bst0&&oe.from<T.bst0&&(oe.from=T.bst0),m=0,c=(se=this.getSlicedList(e,[oe],L,a,H)).length-1;0<=c;c--)m+=(A=se[c]).to-A.from,null===T.xst&&e.rack.fixTime<=m&&(T.xst=A.from+(m-e.rack.fixTime));var ne=null;if(m<e.rack.fixTime&&ae){D=e.rack.fixTime-m,I=(D-=k,new Array);for(c=ae.length-1;0<=c&&0<D;c--){A=ae[c];0<=T.bet0&&T.bet0<A.to&&(
A.to=T.bet0),0<=T.bst0&&A.from<T.bst0&&(A.from=T.bst0),(O=A.to-A.from)<=0||(O<=D?(I.push(A),D-=O):(I.push({from:A.from+(he=O-D),to:A.to}),D-=O-he))}if(I.length){for(c=0;c<I.length;c++)(null===ne||I[c].from<ne)&&(ne=I[c].from);E=E&&teasp.util.time.excludeRanges(dojo.clone(E),[{from:ne,to:E[0].to}]),j=teasp.util.time.excludeRanges(j,I),$=teasp.logic.EmpTime.getSpanTime(j)}}v=0<se.length?se[0].from:s.startTime;
null===T.xst&&(T.xst=null!==ne?ne:v),null!==ne&&ne<T.xst?T.xst=ne:(T.xst>T.st&&(T.xst=T.st),0<=T.bst&&T.xst<T.bst&&null===ne&&(T.xst=T.bst),T.xst<s.startTime&&(T.xst=s.startTime))}}var oe=0,L=0,k=!1,$=null,v=0,re=0,S=0,le=null,pe=null,b=null;if(teasp.util.time.isInputTime(e.startTime,e.endTime)){var x=[],de=(
o==teasp.constant.C_REAL||o==teasp.constant.C_FREAL||!e.pattern.useDiscretionary||e.pattern.useDiscretionary&&!B&&a.workSystem!=teasp.constant.WORK_SYSTEM_MANAGER?(le=s.calcStartTime=e.startTime,pe=s.calcEndTime=e.endTime,i=(i=i.concat(e.rack.fixRests)).concat(e.rack.freeRests),"number"==typeof s.calcStartTime&&2&a.useEarlyWorkFlag&&s.calcStartTime<n?(u&&u.endTime<T.zst&&(j?x=x.concat(j):x.push({from:u.endTime,
to:T.zst,type:teasp.constant.REST_FREE})),null!==T.xst?s.calcStartTime=T.xst:u&&s.calcStartTime<u.startTime&&u.startTime<T.st?s.calcStartTime=u.startTime:s.calcStartTime<T.st&&(s.calcStartTime=T.st)):"number"==typeof s.calcStartTime&&s.calcStartTime>n&&h&&teasp.constant.STATUS_FIX.contains(h.status)&&(s.latePlus=h.endTime<r&&h.endTime<s.calcStartTime?this.getRealTime(h.endTime,Math.min(r,s.calcStartTime),z):0,
e.rack.hotenLate&&(R=(N=Math.min(h.endTime,r))<s.calcStartTime?this.getRealTime(N,s.calcStartTime,z):0,de=n,N=s.calcStartTime,R?(v+=R,de=teasp.logic.EmpTime.slideTime(n,s.calcEndTime,f,R,!1)):s.startTimeOrg&&(N=s.startTimeOrg),b=teasp.logic.EmpTime.complementTime(N,s.endTime,de,b,e.pattern.restTimes,y,G,X,!1),s.calcStartTime=b.tm,s.hotenWork+=b.work,s.hotenRest+=b.rest)),
"number"==typeof s.calcEndTime&&2&a.useOverTimeFlag&&s.calcEndTime>r?(g&&T.zet<g.startTime&&(_?x=x.concat(_):x.push({from:T.zet,to:g.startTime,type:teasp.constant.REST_FREE})),null!==T.xet?s.calcEndTime=T.xet:g&&s.calcEndTime>g.endTime&&g.endTime>T.et?s.calcEndTime=g.endTime:s.calcEndTime>T.et&&(s.calcEndTime=T.et)):"number"==typeof s.calcEndTime&&s.calcEndTime<r&&U&&teasp.constant.STATUS_FIX.contains(U.status)&&(
s.earlyPlus=n<U.startTime&&s.calcEndTime<U.startTime?this.getRealTime(Math.max(n,s.calcEndTime),U.startTime,z):0,e.rack.hotenEarlyEnd&&(ce=Math.max(U.startTime,n),Me=s.calcEndTime<ce?this.getRealTime(s.calcEndTime,ce,z):0,Te=r,R=s.calcEndTime,Me?(v+=Me,Te=teasp.logic.EmpTime.slideTime(s.calcStartTime,r,f,Me,!0)):s.endTimeOrg&&(R=s.endTimeOrg),b=teasp.logic.EmpTime.complementTime(s.calcStartTime,R,Te,b,
e.pattern.restTimes,y,G,X,!0),s.calcEndTime=b.tm,s.hotenWork+=b.work,s.hotenRest+=b.rest))):(N=null,B?(a.workSystem==teasp.constant.WORK_SYSTEM_MANAGER?(s.calcStartTime=s.startTime,s.calcEndTime=s.endTime):(s.calcStartTime=s.startTime="number"==typeof e.startTime?e.rack.fixStartTime:null,s.calcEndTime=s.endTime="number"==typeof e.endTime?e.rack.fixEndTime:null),s.endTimeOrg=s.startTimeOrg=null,
k=o==teasp.constant.C_DISC&&a.workSystem!=teasp.constant.WORK_SYSTEM_MANAGER):this.pouch.isNightChargeOnly()&&o==teasp.constant.C_DISC?s.discReal=!0:(N=0<e.rack.validApplys.kyushtu.length?e.rack.validApplys.kyushtu[0]:null,s.calcStartTime=s.startTime="number"==typeof e.startTime?N?N.startTime:e.rack.fixStartTime:null,s.calcEndTime=s.endTime="number"==typeof e.endTime?N?N.endTime:e.rack.fixEndTime:null,
s.endTimeOrg=s.startTimeOrg=null),N||"number"!=typeof e.rack.fixStartTime2||"number"!=typeof e.rack.fixEndTime2||"number"!=typeof e.startTime||"number"!=typeof e.endTime||($={from:e.rack.fixStartTime2,to:e.rack.fixEndTime2}),i=i.concat(e.pattern.restTimes),g&&(e.rack.fixEndTime<g.startTime&&(_?x=x.concat(_):x.push({from:e.rack.fixEndTime,to:g.startTime,type:teasp.constant.REST_FREE})),
"number"==typeof e.endTime&&s.calcEndTime<g.endTime&&(!this.pouch.isNightChargeOnly()||o!=teasp.constant.C_DISC)&&(s.calcEndTime=s.endTime=g.endTime,s.endTimeOrg=null)),u&&(u.endTime<e.rack.fixStartTime&&(j?x=x.concat(j):x.push({from:u.endTime,to:e.rack.fixStartTime,type:teasp.constant.REST_FREE})),"number"==typeof e.startTime&&s.calcStartTime>u.startTime&&(!this.pouch.isNightChargeOnly()||o!=teasp.constant.C_DISC
)&&(s.calcStartTime=s.startTime=u.startTime,s.startTimeOrg=null))),s.blankSpan=x,ee&&(s.skipSpan=s.skipSpan.concat(ee)),E&&(s.skipSpan=s.skipSpan.concat(E)),s.hotenWork||0),ce=E||[],f=((ce=s.startTime<s.calcStartTime?ce.concat([{from:s.startTime,to:s.calcStartTime}]):ce).length&&(s.svEst=teasp.logic.EmpTime.getSpanTime(teasp.util.time.excludeRanges(ce,i)),de&&(ke=Math.min(s.svEst,de),s.svEst-=ke,de-=ke)),ee||[]);if((
f=s.calcEndTime<s.endTime?f.concat([{from:s.calcEndTime,to:s.endTime}]):f).length&&(s.svZan=teasp.logic.EmpTime.getSpanTime(teasp.util.time.excludeRanges(f,i)),de&&(ke=Math.min(s.svZan,de),s.svZan-=ke,de-=ke)),0<x.length&&(i=i.concat(x)),"number"==typeof le&&"number"==typeof pe&&e.pattern.useDiscretionary&&o==teasp.constant.C_REAL&&(F=teasp.util.time.margeTimeSpans(i.concat(e.rack.hourRests)),
Me=teasp.util.time.excludeRanges([{from:le,to:pe}],F),s.workNetTime=teasp.logic.EmpTime.getSpanTime(teasp.util.time.includeRanges(Me,[{from:null!==T.xst?T.xst:T.st,to:null!==T.xet?T.xet:T.et}]))),e.rack.worked)for(s.calcStartTime>s.calcEndTime&&(s.calcEndTime=s.calcStartTime),s.workSpan=[$||{from:s.calcStartTime,to:s.calcEndTime}],c=0;c<s.blankSpan.length;)s.workSpan=teasp.util.time.sliceTimes(s.workSpan,
s.blankSpan[c]),c++}var me=[];if(e.rack.worked||0<e.rack.paidHolyTime){k?(i=e.pattern.restTimes,s.blankSpan&&0<s.blankSpan.length&&(i=i.concat(s.blankSpan))):a.workSystem==teasp.constant.WORK_SYSTEM_MANAGER?(i=teasp.util.time.margeTimeSpans(J.concat(e.rack.hourRests)),s.blankSpan&&0<s.blankSpan.length&&(i=i.concat(s.blankSpan))):i=i.concat(e.rack.hourRests);var se=this.getSlicedList(e,[{from:s.calcStartTime,
to:s.calcEndTime}],i,a,H,k),he=0;for(e.rack.flexHalfDayTime&&(he+=e.rack.paidHolyTime),c=0;c<se.length;c++)(A=se[c]).holy&&(a.workSystem==teasp.constant.WORK_SYSTEM_FLEX?he+=teasp.logic.EmpTime.getSpanTime(teasp.util.time.excludeRanges([A],teasp.util.time.margeTimeSpans(e.rack.freeHolySpans.concat(e.rack.unpaidRests)))
):e.rack.holidayJoin&&e.rack.holidayJoin.flag&&3!=e.rack.holidayJoin.flag?he+=teasp.logic.EmpTime.getSpanTime(teasp.util.time.excludeRanges([A],e.rack.freeHolySpans)):he+=A.to-A.from,me.push({from:A.from,to:A.to}));var ue="number"==typeof s.calcStartTime?s.calcStartTime:e.rack.fixStartTime,ge=(s.workInFixedTime=e.rack.flexHalfDayTime||he<=e.rack.fixTime?he:e.rack.fixTime,0),ye=0;for(c=0;c<se.length;c++){var fe,be,w,
_e,ve,M,O=(A=se[c]).to-A.from;A.dayType==teasp.constant.DAY_TYPE_LEGAL_HOLIDAY?(A.holy||V.push({from:A.from,to:A.to}),(e.workFlag||e.autoLH)&&(ye+=O),s.workHolidayTime+=O,A.lhoTime+=O,0<O&&s.workHolidaySpan.push({from:A.to-O,to:A.to})):(A.holy||(this.isFixDay(e)?(fe=Math.min(l,q),be=Math.max(p,d),e.pattern.useDiscretionary&&o==teasp.constant.C_DISC&&(fe=s.calcStartTime,be=s.calcEndTime),teasp.logic.EmpTime.entrySpan(
K,V,fe,be,A)):V.push({from:A.from,to:A.to})),ve=!(M=be=fe=0),a.workSystem==teasp.constant.WORK_SYSTEM_FLEX&&o!=teasp.constant.C_FREAL&&o!=teasp.constant.C_FDISC?(w=t.fixTime-t.paidHolyTime,fe=Math.max(w-t.workTime,0),be=Math.max(t.legalTime-t.workLegalTime,0),M=Math.max(t.avg50week-t.workAvg50week,0)):(fe=Math.max(e.rack.fixTime-(s.workInFixedTime+ye),0),be=Math.max(C-s.workLegalTime,0),ve=!1),m=Math.min(O,fe),
w=Math.min(O,be),M=t.avg50week?Math.min(O,M):0,_e=O,ve&&t.avg50week&&0<M&&!A.holy&&(t.workAvg50week+=M),ve&&t.avg50week&&M<_e&&!A.holy&&(s.settlementTime+=ve=_e-M,s.workLegalOutOverTime+=ve,s.workLegalOutOverSpan.length<=0?s.workLegalOutOverSpan.push({from:A.to-ve,to:A.to}):s.workLegalOutOverSpan[0].to=A.to,M<m&&(m=M),M<w&&(w=M),_e-=ve),0<m&&(A.holy||(A.fixTime+=m,s.workInFixedTime+=m,ge+=m,t.workTime+=m),
s.workInFixedSpan?s.workInFixedSpan.to=A.from+m:s.workInFixedSpan={from:A.from,to:A.from+m},a.workSystem==teasp.constant.WORK_SYSTEM_FLEX&&o!=teasp.constant.C_FREAL&&o!=teasp.constant.C_FDISC?t.legalTime<t.workTime&&(D=m<(D=t.workTime-t.legalTime)?m:D,A.holy||(s.workChargeSpan.push({from:A.from+m-D,to:A.from+m}),s.workChargeTime+=D),_e-=D):a.workSystem==teasp.constant.WORK_SYSTEM_FIX&&C<ge&&(D=m<(D=ge-C)?m:D,
A.holy||(s.workChargeSpan.push({from:A.from+m-D,to:A.from+m}),s.workDayChargeTime+=D),_e-=D)),0<w&&(A.holy||(s.workLegalTime+=w,t.workLegalTime+=w,t.workLegalTimeWeek+=w,A.extTime+=w,s.workLegalSpan?s.workLegalSpan.to=A.from+w:s.workLegalSpan={from:ue,to:A.from+w}),a.workSystem!=teasp.constant.WORK_SYSTEM_FLEX&&(M=w,t.legalTimeWeek&&t.legalTimeWeek<t.workLegalTimeWeek&&(D=w<(D=t.workLegalTimeWeek-t.legalTimeWeek)?w:D
,A.holy||(s.workChargeSpan.push({from:A.from+w-D,to:A.from+w}),s.workChargeTime+=D,s.workChargeTime40H+=D,t.workLegalTime-=D,M-=D)),t.legalTime<t.workLegalTime&&(D=M<(D=t.workLegalTime-t.legalTime)?M:D,A.holy||(s.workChargeSpan.push({from:A.from+M-D,to:A.from+M}),s.workChargeTime+=D,0==a.variablePeriod&&(s.workChargeTime40H+=D))))),w<_e&&!A.holy&&(s.workLegalOutOverTime+=_e-w,A.outTime+=_e-w,
s.workLegalOutOverSpan.length<=0?s.workLegalOutOverSpan.push({from:A.to-(_e-w),to:A.to}):s.workLegalOutOverSpan[0].to==A.to?s.workLegalOutOverSpan[0].from-=_e-w:s.workLegalOutOverSpan[0].to=A.to)),A.holy||(e.pattern.igonreNightWork||(s.workNightTime+=this.getSpanOnRanges(A,P)),s.workRealTime+=O,this.isFixDay(e)?A.night?(s.weekDayNightLegalFixTime+=A.fixTime,s.weekDayNightLegalExtTime+=A.extTime-A.fixTime,
s.weekDayNightLegalOutTime+=A.outTime):(s.weekDayDayLegalFixTime+=A.fixTime,s.weekDayDayLegalExtTime+=A.extTime-A.fixTime,s.weekDayDayLegalOutTime+=A.outTime):A.dayType!=teasp.constant.DAY_TYPE_NORMAL_HOLIDAY&&A.dayType!=teasp.constant.DAY_TYPE_PUBLIC_HOLIDAY||(A.night?(s.weekEndNightLegalTime+=A.extTime,s.weekEndNightLegalOutTime+=A.outTime):(s.weekEndDayLegalTime+=A.extTime,s.weekEndDayLegalOutTime+=A.outTime)),
A.night?s.holidayNightTime+=A.lhoTime:s.holidayDayTime+=A.lhoTime)}var R=e.rack.holidayDeductionTime,Te=(a.workSystem==teasp.constant.WORK_SYSTEM_FLEX&&(R=0),s.workWholeTime=s.workRealTime+(k?e.rack.adjustHolyTime||0:e.rack.paidHolyTime-R),s.wwt=s.workWholeTime+(e.rack.tempHolyTime||0)+R,e.pattern.useDiscretionary&&o==teasp.constant.C_DISC&&(J=e.pattern.restTimes),{from:n,to:d}),Z=0,y=0,G=0,N=0;if(e.rack.worked){
var je=[{from:s.calcStartTime,to:s.calcEndTime}];for(c=0;c<s.skipSpan.length;)je=teasp.util.time.sliceTimes(je,s.skipSpan[c]),c++;for(c=s.restTime=0;c<je.length;c++)s.restTime+=teasp.util.time.rangeTime(je[c],J);Z=e.rack.fixTime?p-l-teasp.util.time.rangeTime({from:l,to:p},e.rack.hourRests):Te.to-Te.from-teasp.util.time.rangeTime(Te,e.rack.hourRests),a.deductWithFixedTime&&(0<(y=Math.max(0,p-l-e.rack.fixTime))&&(
F=e.pattern.restTimes||[],l<s.calcStartTime&&(y-=teasp.util.time.rangeTime({from:l,to:s.calcStartTime},F),b&&b.lateRx&&(y-=b.lateRx)),s.calcEndTime<p&&(y-=teasp.util.time.rangeTime({from:s.calcEndTime,to:p},F),b&&b.earlyRx&&(y-=b.earlyRx)),0<y&&(Ie=[{from:Math.max(l,s.calcStartTime),to:Math.min(p,s.calcEndTime)}],G=teasp.logic.EmpTime.getSpanTime(teasp.util.time.includeRanges(Ie,F)),N=teasp.logic.EmpTime.getSpanTime(
teasp.util.time.includeRanges(Ie,J||[])),re=S=Math.max(y-Math.min(G,N),0))),e.rack.hourRests.length&&(Ie=[{from:Math.max(l,s.calcStartTime),to:Math.min(p,s.calcEndTime)}],(_=teasp.util.time.includeRanges([{from:l,to:p}],teasp.util.time.excludeRanges(e.rack.hourRests,Ie))).length&&(g=teasp.logic.EmpTime.getSpanTime(teasp.util.time.includeRanges(_,e.pattern.restTimes||[])),(j=teasp.logic.EmpTime.getSpanTime(
teasp.util.time.includeRanges(_,J||[])))<g&&(S+=g-j))))}var u={from:l,to:p},E=teasp.util.time.rangeTime(u,e.pattern.restTimes||[]),Ee=!1,Le=0;if((e.pattern.restTimes||[]).length<=0){Q=this.pouch.getRestTimeCheck();for(c=0;c<Q.length;c++)Q[c].check&&(Ee=!0,Q[c].workTime<Z&&(Le=Math.max(Le,Q[c].restTime)));0<y&&0<Le&&(re=S=Math.max(y-Math.min(N,Le),0))}Ee||(E=teasp.util.time.rangeTime({from:s.calcStartTime,
to:s.calcEndTime},teasp.util.time.includeRanges([u],e.pattern.restTimes||[])));var ke,De,ce=Math.max(Le,E),ee=teasp.util.time.rangeTime({from:s.calcStartTime,to:s.calcEndTime},teasp.util.time.includeRanges([u],J));q<u.from&&(v+=teasp.util.time.rangeTime({from:s.calcStartTime,to:s.calcEndTime},teasp.util.time.includeRanges([{from:q,to:u.from}],J))),u.to<d&&(v+=teasp.util.time.rangeTime({from:s.calcStartTime,
to:s.calcEndTime},teasp.util.time.includeRanges([{from:u.to,to:d}],J))),p<d&&p<s.calcStartTime&&(v+=this.getRealTime(p,Math.min(d,s.calcStartTime),e.pattern.restTimes)),q<l&&s.calcEndTime<l&&(v+=this.getRealTime(Math.max(q,s.calcEndTime),l,e.pattern.restTimes)),!e.rack.worked||e.pattern.useDiscretionary||!B||e.rack.flexFlag&&!e.rack.useCoreTime||(f=e.rack.fixTime||e.pattern.standardFixTime,
ke=e.rack.actFixTime||e.rack.fixTime,de=e.rack.actFixTime>e.rack.fixTime?e.rack.actFixTime-e.rack.fixTime:0,le=f-(e.rack.holyTime||0),e.rack.holidayJoin&&e.rack.holidayJoin.flag&&3!=e.rack.holidayJoin.flag&&(pe=dojo.clone(e.rack.holySpans).concat(e.pattern.restTimes||[]),Me=teasp.util.time.excludeRanges([{from:e.rack.fixStartTime,to:e.rack.fixEndTime}],pe),ke=teasp.logic.EmpTime.getSpanTime(Me)),
$=s.calcStartTime>n?this.getRealTime(n,Math.min(r,s.calcStartTime),z):0,!h||!teasp.constant.STATUS_FIX.contains(h.status)||h.ownReason&&h.treatDeduct?s.lateTime=$:(s.latePlus&&(s.lateTime=s.latePlus),h.treatDeduct<2&&(S-=$-s.lateTime)),s.lateTime>ke&&!e.rack.flexFlag?s.lateTime=ke:e.rack.coreTime&&s.lateTime>e.rack.coreTime&&(s.lateTime=e.rack.coreTime),R=s.calcEndTime<r?this.getRealTime(Math.max(n,s.calcEndTime),r,z
):0,!U||!teasp.constant.STATUS_FIX.contains(U.status)||U.ownReason&&U.treatDeduct?s.earlyTime=R:(s.earlyPlus&&(s.earlyTime=s.earlyPlus),U.treatDeduct<2&&(S-=R-s.earlyTime)),s.earlyTime>ke&&!e.rack.flexFlag?s.earlyTime=ke:e.rack.coreTime&&s.earlyTime>e.rack.coreTime&&(s.earlyTime=e.rack.coreTime),ce<ee&&(s.privateInnerTime=ee-ce),a.deductWithFixedTime&&f?(s.lateLostTime=s.lateTime,s.earlyLostTime=s.earlyTime,
s.privateInnerLostTime=s.privateInnerTime,e.rack.holidayJoin&&e.rack.holidayJoin.flag&&3!=e.rack.holidayJoin.flag&&le<ke-de&&(S+=ke-le),0<S&&(this.pouch.isAdjustLateTimeEarlyTime()?(0<(O=Math.min(s.privateInnerLostTime,S))&&(s.privateInnerLostTime-=O,S-=O),0<(O=Math.min(s.earlyLostTime,S))&&(s.earlyLostTime-=O,S-=O),0<(O=Math.min(s.lateLostTime,S))&&(s.lateLostTime-=O,S-=O)):(0<(O=Math.min(s.lateLostTime,S))&&(
s.lateLostTime-=O,S-=O),0<(O=Math.min(s.earlyLostTime,S))&&(s.earlyLostTime-=O,S-=O),0<(O=Math.min(s.privateInnerLostTime,S))&&(s.privateInnerLostTime-=O,S-=O))),a.workSystem!=teasp.constant.WORK_SYSTEM_FLEX&&e.dayType==teasp.constant.DAY_TYPE_NORMAL&&0<(L=s.lateLostTime+s.earlyLostTime+s.privateInnerLostTime)&&(oe+=0<(Te=L-(0<(De=f-s.workWholeTime)?De:0))?Te:0)):s.wwt<f&&(0<(De=f-s.wwt)&&(s.lateLostTime=Math.min(f,
s.lateTime<De?s.lateTime:De),De-=s.lateLostTime),0<De&&(s.privateInnerLostTime=Math.min(f,s.privateInnerTime<De?s.privateInnerTime:De),De-=s.privateInnerLostTime),0<De&&(s.earlyLostTime=Math.min(f,s.earlyTime<De?s.earlyTime:De),De-=s.earlyLostTime)))}var Ie,Ae,b=0,b=k?s.workLegalTime+oe:s.workLegalTime+e.rack.paidHolyTime+oe;for(s.workLegalOverTime=Math.min(s.workWholeTime,s.workInFixedTime<b?b-s.workInFixedTime:0),
s.workDayChargeTime-=oe,s.workDayChargeTime<0&&(s.workDayChargeTime=0),s.workChargeTime+=s.workDayChargeTime,0<s.workLegalOverTime&&s.workLegalSpan&&(s.workLegalOverSpan.push(dojo.clone(s.workLegalSpan)),0<s.workInFixedTime&&s.workInFixedSpan&&(s.workLegalOverSpan[0].from=s.workInFixedSpan.to)),a.workSystem!=teasp.constant.WORK_SYSTEM_FLEX&&a.deductWithFixedTime&&(G=e.rack.fixTime,Ie=teasp.logic.EmpTime.getSpanTime(K
),e.pattern.useDiscretionary&&o==teasp.constant.C_DISC||(0<S&&(re-=Math.min(S,re)),Ie<re&&(re=Ie),G=Math.min(Ie+v+re,G-L-e.rack.paidHolyTime-(e.rack.tempHolyTime||0))),teasp.logic.EmpTime.adjustSpans(K,V,G,{from:v?0:l,to:v?2880:p}),G=teasp.logic.EmpTime.getSpanTime(K),(0<K.length||0<V.length)&&(_=teasp.logic.EmpTime.getSpanTime(V),g=teasp.logic.EmpTime.getSpanTime(K)+_,g-=s.workHolidayTime,
s.workLegalOverTime=Math.max(0,Math.min(C,g)-G)),s.workHolidaySpan.length&&(V=teasp.util.time.excludeRanges(V,s.workHolidaySpan),K=teasp.util.time.excludeRanges(K,s.workHolidaySpan)),j=teasp.logic.EmpTime.recalcSapn(V,K,s.workLegalOverTime,s.workLegalOutOverTime,s.workChargeTime),s.workInFixedSpan=j.workInFixedSpan,s.workLegalOverSpan=j.workLegalOverSpan,s.workLegalOutOverSpan=j.workLegalOutOverSpan,
s.workChargeSpan=j.workChargeSpan),s.workInFixedSpan?(y=e.rack.worked?[s.workInFixedSpan]:[],s.workInFixedTime=teasp.logic.EmpTime.getSpanTime(teasp.util.time.excludeRanges(teasp.util.time.margeTimeSpans(y.concat(e.rack.paidHolySpans)),teasp.util.time.margeTimeSpans(J.concat(e.rack.unpaidRests).concat(e.rack.worked?[]:e.pattern.restTimes))))):s.workInFixedTime=0,c=0;c<s.blankSpan.length;
)s.workLegalOverSpan=teasp.util.time.sliceTimes(s.workLegalOverSpan,s.blankSpan[c]),s.workLegalOutOverSpan=teasp.util.time.sliceTimes(s.workLegalOutOverSpan,s.blankSpan[c]),s.workChargeSpan=teasp.util.time.sliceTimes(s.workChargeSpan,s.blankSpan[c]),c++;if(s.workLegalOverSpan=teasp.util.time.excludeRanges(s.workLegalOverSpan,me),s.workLegalOutOverSpan=teasp.util.time.excludeRanges(s.workLegalOutOverSpan,me),
s.workLegalOutOverSpan){var Se=s.workLegalOutOverSpan;for(c=s.workLegalOutOverTime=0;c<Se.length;c++){O=i&&0<i.length?teasp.util.time.rangeTime(Se[c],teasp.util.time.margeTimeSpans(i)):0;s.workLegalOutOverTime+=Se[c].to-Se[c].from-O}}else s.workLegalOutOverTime=0;if(a.workSystem==teasp.constant.WORK_SYSTEM_MANAGER?(s.workChargeTime=0,s.workDayChargeTime=0,s.workChargeSpan=[]
):a.workSystem==teasp.constant.WORK_SYSTEM_FLEX&&(s.lateLostTime=0,s.privateInnerLostTime=0,s.earlyLostTime=0),this.pouch.isAdjustLateTimeEarlyTime()&&(a.workSystem==teasp.constant.WORK_SYSTEM_FIX||a.workSystem==teasp.constant.WORK_SYSTEM_MUTATE)&&!e.pattern.useDiscretionary&&this.existPaidRestOutsideWork(e)){for(var N=teasp.logic.EmpTime.getSpanTime(K),xe=e.date+" fxzan="+teasp.util.time.timeValue(N),
we=0;we<K.length;we++)xe+=" "+teasp.util.time.timeValue(K[we].from)+"-"+teasp.util.time.timeValue(K[we].to);console.log(xe);var Me,E=Math.max(e.rack.fixTime-(N+e.rack.holyTime),0),u=s.lateTime+s.earlyTime+s.privateInnerTime;E<u&&(0<(B=Math.min(s.privateInnerTime,u-E))&&(s.privateInnerTime-=B,s.privateInnerLostTime>s.privateInnerTime&&(s.privateInnerLostTime=s.privateInnerTime),u-=B),0<(pe=Math.min(s.earlyTime,u-E)
)&&(s.earlyTime-=pe,s.earlyLostTime>s.earlyTime&&(s.earlyLostTime=s.earlyTime),u-=pe),0<(Me=Math.min(s.lateTime,u-E))&&(s.lateTime-=Me,s.lateLostTime>s.lateTime&&(s.lateLostTime=s.lateTime),u-=Me))}for(s.workOverTime=s.workLegalOverTime+s.workLegalOutOverTime,!e.rack.worked&&0<e.rack.paidHolySpans.length&&(s.workLegalOverTime=0,s.workLegalOutOverTime=0,s.workOverTime=0,s.workChargeTime=0,s.workDayChargeTime=0,
s.workLegalOverSpan=[],s.workLegalOutOverSpan=[],s.workChargeSpan=[]),s.awayTime=teasp.logic.EmpTime.getSpanTime(e.rack.awayTimes||[]),c=0;c<P.length;c++)(Ae=P[c].span)&&s.workNightSpans.push(Ae);if(0<s.workNightSpans.length&&o==teasp.constant.C_REAL){Se=dojo.clone(s.workNightSpans),x=(J||[]).concat(s.blankSpan||[]);for(c=0;c<x.length;c++)Se=teasp.util.time.sliceTimes(Se,x[c]);s.realWorkNightSpans=Se}
s.startTimeOrg&&(s.startTime=s.startTimeOrg),s.endTimeOrg&&(s.endTime=s.endTimeOrg),e.pattern.useDiscretionary&&o==teasp.constant.C_REAL&&("number"==typeof s.workNetTime&&(s.workRealTime=s.workNetTime),0<s.restTime&&(s.restTime=Math.max(s.restTime-(s.hotenRest||0),0)));h=this.getMonthByDate(this.pouch.dataObj.months,e.date);this.pouch.isUseLegacyIrregularLogicUntil(h)&&0<a.variablePeriod&&(
s.workChargeTime40H=s.workChargeTime),e[o]=this.calculateEmpDayRes(e,s,t,a,H,o)},teasp.logic.EmpTime.prototype.calculateEmpDayRes=function(e,t,a,o,s,i){return o.workSystem==teasp.constant.WORK_SYSTEM_MANAGER&&i==teasp.constant.C_DISC&&(0<t.workOverTime&&(t.workWholeTime-=t.workOverTime,t.workRealTime-=t.workOverTime,t.workWholeTime<0&&(t.workWholeTime=0),t.workRealTime<0&&(t.workRealTime=0),t.workOverTime=0,
t.workLegalOutOverTime=0,t.workLegalOverTime=0),t.workLegalOverSpan=[],t.workLegalOutOverSpan=[],t.workHolidaySpan=[],e.rack.worked&&this.isFixDay(e)&&(t.calcStartTime=t.startTime="number"==typeof e.startTime?e.rack.fixStartTime:null,t.calcEndTime=t.endTime="number"==typeof e.endTime?e.rack.fixEndTime:null,t.workInFixedSpan={from:e.rack.fixStartTime,to:e.rack.fixEndTime},t.workSpan=[{from:e.rack.fixStartTime,
to:e.rack.fixEndTime}],t.minasiWorkWholeTime=e.pattern.standardFixTime),0<t.workHolidayTime&&(t.workHolidayTime=0)),t},teasp.logic.EmpTime.prototype.recalcDiscForManager=function(e,t,a,o,s){for(var i=0;i<o.length;i++){var n,r=o[i],l=t[r];l&&this.pouch.isAlive(r)&&this.getMonthByDate(e,r).config.workSystem==teasp.constant.WORK_SYSTEM_MANAGER&&(r=l.rack.fixTime||0,n=l.real.workHolidayTime||0,workWholeTime=Math.min((
l.real.workWholeTime||0)-n,l.disc.workWholeTime||0),workRealTime=Math.min((l.real.workRealTime||0)-n,l.disc.workRealTime||0),workLegalTime=Math.min((l.real.workLegalTime||0)-n,l.disc.workLegalTime||0),workInFixedTime=Math.min((l.real.workInFixedTime||0)-n,l.disc.workInFixedTime||0),l.disc.workRealTime=Math.min(workRealTime,r),l.disc.workWholeTime=l.disc.workRealTime+(l.rack.paidHolyTime||0),
l.disc.workLegalTime=Math.min(workLegalTime,r),l.disc.workInFixedTime=Math.min(workInFixedTime,r))}},teasp.logic.EmpTime.prototype.decorateEmpDay=function(e,t,a){var o={ct:{st:0,et:0},title:"",iconClass:"",restLack:!1};if(this.pouch.isAlive(a.rack.key)){var s=a.rack.validApplys.direct,i=0<a.rack.validApplys.kyushtu.length?a.rack.validApplys.kyushtu[0]:null,s=s&&s.directFlag||i&&i.directFlag||0,i=[];
1&s?o.ct.st="number"!=typeof a.startTime?0:2:"number"!=typeof a.startTime?o.ct.st=0:"number"!=typeof a.pushStartTime?o.ct.st=-1:a.startTime<a.pushStartTime?o.ct.st=-2:e.commentIfNoPushTime&&a.startTime!=a.pushStartTime?o.ct.st=-3:o.ct.st=1,
2&s?o.ct.et="number"!=typeof a.endTime?0:2:"number"!=typeof a.endTime?o.ct.et=0:"number"!=typeof a.pushEndTime?o.ct.et=-1:a.endTime>a.pushEndTime?o.ct.et=-2:e.commentIfNoPushTime&&a.endTime!=a.pushEndTime?o.ct.et=-3:o.ct.et=1,-1==o.ct.st?o.ct.stan=teasp.message.getLabel("tm10001300"):o.ct.st<0?o.ct.stan=teasp.message.getLabel("tm10001310",teasp.util.time.timeValue(a.pushStartTime)):2==o.ct.st&&(
o.ct.stan=teasp.message.getLabel("tm10001680",teasp.message.getLabel("tk10004680"))),-1==o.ct.et?o.ct.etan=teasp.message.getLabel("tm10001300"):o.ct.et<0?o.ct.etan=teasp.message.getLabel("tm10001310",teasp.util.time.timeValue(a.pushEndTime)):2==o.ct.et&&(o.ct.etan=teasp.message.getLabel("tm10001680",teasp.message.getLabel("tk10004690"))),-1==o.ct.st&&-1==o.ct.et?o.ct.note=teasp.message.getLabel("tm10001320"
):o.ct.stan&&o.ct.etan?2!=o.ct.st&&2!=o.ct.et?o.ct.note=teasp.message.getLabel("tm10001330",o.ct.stan,o.ct.etan):2==o.ct.st&&2!=o.ct.et?o.ct.note=teasp.message.getLabel("tk10004680")+teasp.message.getLabel("tm10001570")+teasp.message.getLabel("tm10001350",o.ct.etan):2!=o.ct.st&&2==o.ct.et?o.ct.note=teasp.message.getLabel("tm10001340",o.ct.stan)+teasp.message.getLabel("tm10001570")+teasp.message.getLabel("tk10004690"
):o.ct.note=teasp.message.getLabel("tk10004670"):o.ct.stan?2==o.ct.st?o.ct.note=teasp.message.getLabel("tk10004680"):o.ct.note=teasp.message.getLabel("tm10001340",o.ct.stan):o.ct.etan&&(2==o.ct.et?o.ct.note=teasp.message.getLabel("tk10004690"):o.ct.note=teasp.message.getLabel("tm10001350",o.ct.etan)),"number"==typeof a.startTime&&"number"==typeof a.endTime&&a.startTime>=a.endTime&&(o.invalidTime=!0);var s="wt-f01",
n="wt-f02",r="wt-f03",l="wt-f04",p="wt-f06",d="wt-f07";if(this.isFixDay(a)?a.rack.plannedHolidayReal?(i.push(teasp.message.getLabel("tm10001360")),a.rack.worked?o.iconClass=s:(o.ct.st||o.ct.et)&&a.rack.todayDiff<0?o.iconClass=n:o.iconClass=p):a.rack.holidayJoin&&3==a.rack.holidayJoin.flag?(i.push(a.rack.holidayJoin.name),
a.rack.holidayJoin.type==teasp.constant.HOLIDAY_TYPE_PAID?o.iconClass=p:a.rack.holidayJoin.type==teasp.constant.HOLIDAY_TYPE_FREE?o.iconClass=r:a.rack.holidayJoin.type==teasp.constant.HOLIDAY_TYPE_DAIQ&&(o.iconClass=l)):(i.push(teasp.message.getLabel("tm10001370")),a.rack.worked?o.iconClass=s:a.rack.todayDiff<0&&!o.invalidTime&&(o.iconClass=n,i.push(teasp.message.getLabel("tm10001380")))):(
y=a.rack.validApplys.holidayAll||a.rack.validApplys.holidayAm||a.rack.validApplys.holidayPm,0<a.rack.validApplys.kyushtu.length||teasp.util.time.isInputTime(a.startTime,a.endTime)?(i.push(teasp.message.getLabel("tm10001390")),a.rack.worked?o.iconClass=s:a.rack.todayDiff<0&&(o.iconClass=n)):y&&y.holiday.displayDaysOnCalendar?(i.push(y.holiday.name),
y.holiday.type==teasp.constant.HOLIDAY_TYPE_PAID?o.iconClass=p:y.holiday.type==teasp.constant.HOLIDAY_TYPE_FREE?o.iconClass=r:y.holiday.type==teasp.constant.HOLIDAY_TYPE_DAIQ&&(o.iconClass=l)):a.dayType==teasp.constant.DAY_TYPE_NORMAL_HOLIDAY?i.push(teasp.message.getLabel("fixHoliday_label")):a.dayType==teasp.constant.DAY_TYPE_LEGAL_HOLIDAY?i.push(teasp.message.getLabel("legalHoliday_label")
):a.dayType==teasp.constant.DAY_TYPE_PUBLIC_HOLIDAY&&i.push(teasp.message.getLabel("publicHoliday_label"))),0<a.real.workRealTime){var c=this.pouch.getRestTimeCheck();if(c&&is_array(c)){var m=a.real.workRealTime,h=a.real.restTime;a.pattern.useDiscretionary||(m-=a.real.hotenWork||0,h-=a.real.hotenRest||0);for(var u=0;u<c.length;u++){var g=c[u];g.check&&m>g.workTime&&h<g.restTime&&(o.restLack=!0)}}}var y,s=a.note||"",
n=s,p=(e.separateDailyNote&&(s+=a.rack.applyNotes||""),this.pouch.isRemarksRigorous());(p&&!n||!p&&!s)&&(r=null,e.commentIfNoPushTime&&(o.ct.st<0||o.ct.et<0)&&(r=-1<=o.ct.st&&-1<=o.ct.et?teasp.message.getLabel("tm10001400"):teasp.message.getLabel("tm10001410")),l="",e.commentIfAbsence&&a.hasOwnProperty("real")&&(0<a.real.lateLostTime||0<a.real.earlyLostTime||0<a.real.privateInnerLostTime)&&(0<a.real.lateLostTime&&(
l+=teasp.message.getLabel("tm10001420")),0<a.real.earlyLostTime&&(l+=(""!=l?teasp.message.getLabel("tm10001570"):"")+teasp.message.getLabel("tm10001430")),0<a.real.privateInnerLostTime&&(l+=(""!=l?teasp.message.getLabel("tm10001570"):"")+teasp.message.getLabel("tm10001440"))),l=""==l?null:l+teasp.message.getLabel("tm10001450"),(r||l)&&(o.iconClass=d,i.push((l||r)+teasp.message.getLabel("tm10001460")))),
"number"==typeof a.endTime&&1440<a.endTime&&(y=this.pouch.getEmpDay(teasp.util.date.addDays(a.rack.key,1)).getProhibitOverNightWorkHoliday())&&(o.prohibitOverNightWork=teasp.message.getLabel("tf10008370",teasp.util.date.formatDate(a.rack.key,"M/d"),y.name),o.iconClass=d,i.push(teasp.message.getLabel("tf10008360",y.name))),this.pouch.isProhibitBorderRestTime()&&teasp.logic.EmpTime.checkBorderRestTime(a.startTime,
a.endTime,a.timeTable)&&(o.prohibitOverNightWork=teasp.message.getLabel("tf10008410",teasp.util.date.formatDate(a.rack.key,"M/d")),o.iconClass=d,i.push(teasp.message.getLabel("tf10008400"))),o.invalidTime&&(o.iconClass=d,i.push(teasp.message.getLabel("ci00001030",teasp.message.getLabel("startEndTime_label")))),i.length&&(o.title=i.join("\n")),a.deco=o}else a.deco=o},
teasp.logic.EmpTime.prototype.getPeriodMap=function(e){for(var t,a={},o={},s=0;s<e.length;s++){var i,n=e[s],r=this.pouch.getPeriodParam(n);a[n.monthEx]=r,n.legalTimeOfPeriod=r.legalTimeOfPeriod,n.carryforwardTime=this.pouch.getCarryforwardTime(n.monthEx),n.realWorkTimeWoLH=this.pouch.getRealWorkTimeWoLH(n.monthEx),n.amountTime=this.pouch.getAmountTime(n.monthEx),n.settlementTime=this.pouch.getSettlementTime(n.monthEx
),n.periodInfo={startDateOfPeriod:r.from,endDateOfPeriod:r.to,legalTimeOfPeriod:r.legalTimeOfPeriod,elapsedMonth:1,numberOfMonths:1,fixTimeOfPeriod:0,remainFixTimeOfPeriod:0,remainLegalTimeOfPeriod:0,realWorkTimeWoLHPrev:0,settlementTimePrev:0,carryforwardFromPrev:0},1<n.periodLen&&(i=(i=o[n.periodSd])||(o[n.periodSd]={legalTimeOfPeriod:0,fixTimeOfPeriod:0,months:[],from:r.from,to:r.to}),
n.startDate<=i.to&&i.from<=n.endDate&&i.months.push(n))}for(t in o)if((i=o[t]).months.length){(f=i.months[0].config).workSystem==teasp.constant.WORK_SYSTEM_FLEX&&(_=i.months[0].startDate,l=i.months[i.months.length-1].endDate,i.from<_&&(i.from=_),l<i.to&&(i.to=l)),i.legalTimeOfPeriod=Math.floor(teasp.util.date.daysInRange(i.from,i.to)*(1<f.variablePeriod?2400:f.legalTimeOfWeek)/7);for(var l,p=!1,
s=0;s<i.months.length;s++){var d=i.months[s];i.fixTimeOfPeriod+=d.fixTime,d.missFlexPeriod=p,this.pouch.isEmptyAmountTime(d.startDate)&&(p=!0)}var c=i.fixTimeOfPeriod,m=(f.workSystem==teasp.constant.WORK_SYSTEM_FLEX&&c>i.legalTimeOfPeriod&&"1"==f.flexLegalWorkTimeOption&&(i.legalTimeOfPeriod=c),i.legalTimeOfPeriod),h=0,u=0,g=0;for(s=0;s<i.months.length;s++)(d=i.months[s]
).periodInfo.startDateOfPeriod=this.pouch.getStartDateOfPeriod(n,i.from),d.periodInfo.endDateOfPeriod=this.pouch.getEndDateOfPeriod(n,i.to),d.periodInfo.elapsedMonth=this.pouch.getElapsedMonth(d,s+1),d.periodInfo.numberOfMonths=this.pouch.getNumberOfMonths(d,i.months.length),d.periodInfo.fixTimeOfPeriod=this.pouch.getFixTimeOfPeriod(d,i.fixTimeOfPeriod),d.periodInfo.legalTimeOfPeriod=this.pouch.getLegalTimeOfPeriod(d
,i.legalTimeOfPeriod),d.periodInfo.remainFixTimeOfPeriod=this.pouch.getRemainFixTimeOfPeriod(d,c),d.periodInfo.remainLegalTimeOfPeriod=this.pouch.getRemainLegalTimeOfPeriod(d,m),d.periodInfo.carryforwardFromPrev=this.pouch.getCarryforwardFromPrev(d,h),d.periodInfo.realWorkTimeWoLHPrev=this.pouch.getRealWorkTimeWoLHPrev(d,u),d.periodInfo.settlementTimePrev=this.pouch.getSettlementTimePrev(d,g),
d.legalTimeOfPeriod=d.periodInfo.legalTimeOfPeriod,d.fixTimeOfPeriod=d.periodInfo.fixTimeOfPeriod,d.carryforwardFromPrev=d.periodInfo.carryforwardFromPrev,d.settlementTimePrev=d.periodInfo.settlementTimePrev,(m-=d.realWorkTimeWoLH-d.settlementTime)<0&&(m=0),(c-=d.fixTime+d.amountTime-d.settlementTime)<0&&(c=0),h+=d.amountTime-d.settlementTime,u+=d.realWorkTimeWoLH,g+=d.settlementTime}for(var y={},s=0;s<e.length;s++){
for(var f=(n=e[s]).config,r=a[n.monthEx],b={fixTime:0,workTime:0,legalTime:0,legalTimeWeek:0,workLegalTime:0,workLegalTimeWeek:0,avg50week:0,workAvg50week:0,presetWeek:{},presetMonth:{},dbWorkLegalVal:0},_=n.startDate,v=n._em.empType.configBase.initialDayOfWeek,T=teasp.util.date.getDateList(n.startDate,n.endDate),j=0;j<T.length;j++){var E=this.pouch.getObj().days[T[j]];E&&this.pouch.setFixTimeMap(n,E.date,
E.dayType!=teasp.constant.DAY_TYPE_LEGAL_HOLIDAY&&E.rack&&E.rack.fixTime||0)}f.workSystem==teasp.constant.WORK_SYSTEM_FLEX?(1<f.variablePeriod?(b.avg50week=n.avg50week,b.legalTime=n.periodInfo.remainLegalTimeOfPeriod,b.fixTime=n.periodInfo.remainFixTimeOfPeriod):(b.legalTime=n.legalTime,"1"==f.flexFixOption?b.fixTime=f.flexFixMonthTime:r.fixDays&&(b.fixTime=n.fixTime||0)),b.presetMonth[_]=0
):f.workSystem==teasp.constant.WORK_SYSTEM_MUTATE&&0!=f.variablePeriod?(b.legalTime=n.legalTimeOfPeriod,b.presetMonth[_]=1<f.variablePeriod&&n.preWorkLegalTimeOfPeriod||0,b.presetWeek[v]=0,1==f.variablePeriod&&(n.legalTime=b.legalTime),b.legalTimeWeek=this.pouch.getLegalTimeWeek(n,n.startDate)):(b.legalTime=f.legalTimeOfWeek,b.presetWeek[v]=0),b.paidHolyTime=n.paidHolyTime||0,y[n.monthEx]=b}return y},
teasp.logic.EmpTime.prototype.getMonthByDate=function(e,t){if(is_array(e)){for(var a=0;a<e.length;a++)if((s=e[a]).startDate<=t&&t<=s.endDate)return s}else for(var o in e){var s;if(e.hasOwnProperty(o))if((s=e[o]).startDate<=t&&t<=s.endDate)return s}return null},teasp.logic.EmpTime.prototype.getRealTime=function(e,t,a){var o=e<t?e:t,t=e<t?t:e;return t-o-teasp.util.time.rangeTime({from:o,to:t},a)},
teasp.logic.EmpTime.prototype.getLoopSpans=function(e,t,a,o){for(var e={from:e,to:t},s=[],i={from:e.from,to:e.to};0<i.to-a;)i.from-=a,i.to-=a;for(;s.push({from:i.from<0?0:i.from,to:i.to<o?i.to:o}),i.from+=a,i.to+=a,i.from<o;);return s},teasp.logic.EmpTime.prototype.getSpanOnRanges=function(e,t){for(var a=0,o=0;o<t.length;o++){var s,i=t[o];e.from<i.to&&i.from<e.to&&(s={from:(e.from<i.from?i:e).from,to:(i.to<e.to?i:e
).to},i.span?(i.span.to=s.to,i.time+=s.to-s.from):(i.span=s,i.time=s.to-s.from),a+=s.to-s.from)}return a},teasp.logic.EmpTime.prototype.getSlicedList=function(e,t,a,o,s,i){for(var n=[],r=i?[]:dojo.clone(e.rack.holySpans||[]),l=null===e.startTime&&null===e.endTime?e.pattern.restTimes:e.rack.fixRests.concat(e.rack.freeRests),p=0;p<l.length;)r=teasp.util.time.sliceTimes(r,l[p]),p++;if(
!e.ignorePaidHoly&&!e.rack.flexHalfDayTime)for(p=0;p<r.length;p++)n.push({from:r[p].from,to:r[p].to,dayType:teasp.constant.DAY_TYPE_NORMAL,night:!1,holy:!0,fixTime:0,extTime:0,outTime:0,lhoTime:0});if(e.rack.worked)for(var d=0;d<t.length;d++)for(var c=this.sliceRange(t[d].from,t[d].to,e.dayType,e.rack.nextDayType,e.pattern,s.nightTimes),m=0;m<c.length;m++){for(var h=c[o.extendDayType?0:m].dayType,u=c[m].night,
r=c[m].span,p=0;p<a.length;)r=teasp.util.time.sliceTimes(r,a[p]),p++;for(p=0;p<r.length;p++)n.push({from:r[p].from,to:r[p].to,dayType:h,night:u,holy:!1,fixTime:0,extTime:0,outTime:0,lhoTime:0})}return n=n.sort(function(e,t){return e.from-t.from})},teasp.logic.EmpTime.prototype.sliceRange=function(e,t,a,o,s,i){if(!teasp.util.time.isValidRange(e,t))return[];var n={},r=0;1440<t?(n[r++]={dayType:a,from:e,to:1440,night:!1
},a==teasp.constant.DAY_TYPE_NORMAL&&a!=o&&o!=teasp.constant.DAY_TYPE_LEGAL_HOLIDAY&&1440<s.stdEndTime?s.stdEndTime<t?(n[r++]={dayType:a,from:1440,to:s.stdEndTime,night:!1},n[r++]={dayType:o,from:s.stdEndTime,to:t,night:!1}):n[r++]={dayType:a,from:1440,to:t,night:!1}:n[r++]={dayType:o,from:1440,to:t,night:!1}):n[r++]={dayType:a,from:e,to:t,night:!1};for(var l=0;l<i.length;l++){var p=i[l];for(d in n)(c=n[d])&&(
p.from<=c.from&&c.to<=p.to?c.night=!0:p.from<=c.from&&c.from<p.to&&p.to<c.to?(n[d]=null,n[r++]={dayType:c.dayType,from:c.from,to:p.to,night:!0},n[r++]={dayType:c.dayType,from:p.to,to:c.to,night:c.night}):c.from<p.from&&p.from<c.to&&c.to<=p.to?(n[d]=null,n[r++]={dayType:c.dayType,from:c.from,to:p.from,night:c.night},n[r++]={dayType:c.dayType,from:p.from,to:c.to,night:!0}):c.from<p.from&&p.to<c.to&&(n[d]=null,n[r++]={
dayType:c.dayType,from:c.from,to:p.from,night:c.night},n[r++]={dayType:c.dayType,from:p.from,to:p.to,night:!0},n[r++]={dayType:c.dayType,from:p.to,to:c.to,night:c.night}))}var d,c,m=[];for(d in n)(c=n[d])&&m.push({dayType:c.dayType,night:c.night,span:[{from:c.from,to:c.to}]});return m=m.sort(function(e,t){return e.span[0].from-t.span[0].from})},teasp.logic.EmpTime.recalcSapn=function(e,t,a,o,s){var i={
workInFixedSpan:null,workLegalOverSpan:[],workLegalOutOverSpan:[],workChargeSpan:[]};e=e||[],t=t||[];for(var n=0;n<e.length;n++)e[n].flag=2;for(n=0;n<t.length;n++)t[n].flag=1;for(var r=(r=e.concat(t)).sort(function(e,t){return e.from!=t.from?e.from-t.from:e.to-t.to}),l=0,p=0,n=0;n<r.length;n++)2==r[n].flag?(0<n&&r[n-1].flag!=r[n].flag&&l++,r[n].outIndex=l):(0<n&&r[n-1].flag!=r[n].flag&&p++,r[n].fixIndex=p);
t&&0<t.length&&(i.workInFixedSpan={from:t[0].from,to:t[t.length-1].to});var d=a,c=s,m=[],h=[],u=[],g=dojo.clone(t),y=0;for(n=0;n<e.length&&0<d;){var f=e[n].to-e[n].from;0<m.length&&m[m.length-1].outIndex!=e[n].outIndex&&y++,y>=m.length&&m.push({from:e[n].from,outIndex:e[n].outIndex}),d<f?(m[y].to=e[n].from+d,g.push({from:e[n].from,to:m[y].to,flag:e[n].flag}),h.push({from:m[y].to,to:e[n].to,outIndex:e[n].outIndex})):(
m[y].to=e[n].to,g.push(e[n])),d-=f,n++}for(y=0;n<e.length;)0<h.length&&h[h.length-1].outIndex!=e[n].outIndex&&y++,y>=h.length&&h.push({from:e[n].from,to:e[n].to,outIndex:e[n].outIndex}),h[y].to=e[n].to,n++;for(y=0,n=(g=g.sort(function(e,t){return e.from!=t.from?e.from-t.from:e.to-t.to})).length-1;0<=n&&0<c;){f=g[n].to-g[n].from;0<u.length&&u[y].flag!=g[n].flag&&y++,y>=u.length&&u.push({to:g[n].to,flag:g[n].flag}),
u[y].from=c<f?g[n].to-c:g[n].from,c-=f,n--}return i.workLegalOverSpan=m,i.workLegalOutOverSpan=h,i.workChargeSpan=u,i},teasp.logic.EmpTime.prototype.getApplyDateMap=function(e){for(var t={},a=0;a<e.length;a++){var o=e[a];if(o.startDate)if(o.applyType==teasp.constant.APPLY_TYPE_MONTHLYOVERTIME)(t[teasp.constant.APPLY_TYPE_MONTHLYOVERTIME]||(t[teasp.constant.APPLY_TYPE_MONTHLYOVERTIME]=[])).push(o);else{o.endDate||(
o.endDate=o.startDate);for(var s=o.holiday&&o.holiday.displayDaysOnCalendar||!1,i=teasp.util.date.getDateList(o.startDate,o.endDate),n=[],r=0;r<=1&&n.length<=0;){for(var l=0;l<i.length;l++){var p=i[l];!s&&o.excludeDate.contains(p)||(t[p]||(t[p]=[]),t[p].push(o),n.push(p))}s=!0,r++}o.applyType!=teasp.constant.APPLY_TYPE_EXCHANGE&&o.applyType!=teasp.constant.APPLY_TYPE_SHIFTCHANGE||(t[p=o.exchangeDate]||(t[p]=[]),
t[p].push(o))}else t[o.yearMonth]=o}return t},teasp.logic.EmpTime.prototype.getValidApplys=function(e,t,a){return teasp.logic.EmpTime.getValidApplyMap(e,t,a)},teasp.logic.EmpTime.getValidApplyMap=function(e,t,a){for(var o={patternS:null,patternL:null,patternD:null,exchangeS:null,exchangeE:null,kyushtu:[],holidayAll:null,holidayAm:null,holidayPm:null,holidayTime:[],zangyo:[],earlyStart:[],lateStart:null,earlyEnd:null,
dailyFix:null,shiftSet:null,shiftChange:null,showApply:null,reviseTime:[],waiting:[],rejects:{patternS:null,patternL:null,patternD:null,exchangeS:null,exchangeE:null,kyushtu:[],holidayAll:null,holidayAm:null,holidayPm:null,holidayTime:[],zangyo:[],earlyStart:[],lateStart:null,earlyEnd:null,reviseTime:[],shiftChange:null,dailyFix:null},oldDailyFix:null},s=(e=e.sort(function(e,t){
return e.applyTime<t.applyTime?1:e.applyTime>t.applyTime?-1:0}),[]),i=0;i<e.length;i++){var n,r=e[i];teasp.constant.STATUS_REJECTS.contains(r.status)&&r.close||(o.oldDailyFix||r.applyType!=teasp.constant.APPLY_TYPE_DAILY||!teasp.constant.STATUS_REJECTS.contains(r.status)&&!teasp.constant.STATUS_CANCELS.contains(r.status)||(o.oldDailyFix=r),teasp.constant.STATUS_CANCELS.contains(r.status)||(
teasp.constant.STATUS_FIX.contains(r.status)?r.decree&&r.applyType!=teasp.constant.APPLY_TYPE_HOLIDAY?r.applyType!=teasp.constant.APPLY_TYPE_PATTERNS||o.shiftSet||((o.shiftSet=r).aliasKey=teasp.constant.APPLY_KEY_SHIFT):r.applyType==teasp.constant.APPLY_TYPE_DAILY?o.dailyFix?t.push({apply:r,reason:teasp.constant.REASON_DUPL,keep:!1}
):o.dailyFix=r:r.applyType==teasp.constant.APPLY_TYPE_PATTERNS?r.pattern?o.patternS?t.push({apply:r,reason:teasp.constant.REASON_DUPL,keep:!1}):o.patternS=r:o.patternD?t.push({apply:r,reason:teasp.constant.REASON_DUPL,keep:!1}):o.patternD=r:r.applyType==teasp.constant.APPLY_TYPE_PATTERNL?o.patternL?t.push({apply:r,reason:teasp.constant.REASON_DUPL,keep:!1}
):o.patternL=r:r.applyType==teasp.constant.APPLY_TYPE_EXCHANGE?r.startDate==a?o.exchangeS?t.push({apply:r,reason:teasp.constant.REASON_DUPL,keep:!1}):(o.exchangeS=r,o.exchangeS.exchangeDateReal=teasp.logic.EmpTime.getRealExchangeDate(a,e)):o.exchangeE?t.push({apply:r,reason:teasp.constant.REASON_DUPL,keep:!1}):(o.exchangeE=r,o.exchangeE.exchangeDateReal=r.exchangeDate
):r.applyType==teasp.constant.APPLY_TYPE_KYUSHTU?o.kyushtu.push(r):r.applyType==teasp.constant.APPLY_TYPE_HOLIDAY?(n=r.holiday).range==teasp.constant.RANGE_TIME?o.holidayTime.push(r):n.range==teasp.constant.RANGE_ALL?o.holidayAll?t.push({apply:r,reason:teasp.constant.REASON_RANGE_DUPL,keep:!1}):o.holidayAll=r:n.range==teasp.constant.RANGE_AM?o.holidayAm?t.push({apply:r,reason:teasp.constant.REASON_RANGE_DUPL,keep:!1}
):o.holidayAm=r:n.range==teasp.constant.RANGE_PM&&(o.holidayPm?t.push({apply:r,reason:teasp.constant.REASON_RANGE_DUPL,keep:!1}):o.holidayPm=r):r.applyType==teasp.constant.APPLY_TYPE_ZANGYO?o.zangyo.push(r):r.applyType==teasp.constant.APPLY_TYPE_EARLYSTART?o.earlyStart.push(r):r.applyType==teasp.constant.APPLY_TYPE_LATESTART?o.lateStart?t.push({apply:r,reason:teasp.constant.REASON_DUPL,keep:!1}
):o.lateStart=r:r.applyType==teasp.constant.APPLY_TYPE_EARLYEND?o.earlyEnd?t.push({apply:r,reason:teasp.constant.REASON_DUPL,keep:!1}):o.earlyEnd=r:r.applyType==teasp.constant.APPLY_TYPE_DIRECT?o.direct?t.push({apply:r,reason:teasp.constant.REASON_DUPL,keep:!1}):o.direct=r:r.applyType==teasp.constant.APPLY_TYPE_REVISETIME?o.reviseTime.push(r):r.applyType==teasp.constant.APPLY_TYPE_SHIFTCHANGE&&(o.shiftChange?t.push({
apply:r,reason:teasp.constant.REASON_DUPL,keep:!1}):o.shiftChange=r):(s.push(r),teasp.constant.STATUS_REJECTS.contains(r.status)&&!r.close&&(
r.applyType==teasp.constant.APPLY_TYPE_DAILY?o.rejects.dailyFix=r:r.applyType==teasp.constant.APPLY_TYPE_PATTERNS?o.rejects.patternS=r:r.applyType==teasp.constant.APPLY_TYPE_PATTERNL?o.rejects.patternL=r:r.applyType==teasp.constant.APPLY_TYPE_EXCHANGE?r.startDate==a?o.rejects.exchangeS=r:o.rejects.exchangeE=r:r.applyType==teasp.constant.APPLY_TYPE_KYUSHTU?o.rejects.kyushtu.push(r
):r.applyType==teasp.constant.APPLY_TYPE_HOLIDAY?(n=r.holiday).range==teasp.constant.RANGE_TIME?o.rejects.holidayTime.push(r):n.range==teasp.constant.RANGE_ALL?o.rejects.holidayAll=r:n.range==teasp.constant.RANGE_AM?o.rejects.holidayAm=r:n.range==teasp.constant.RANGE_PM&&(o.rejects.holidayPm=r):r.applyType==teasp.constant.APPLY_TYPE_ZANGYO?o.rejects.zangyo.push(r
):r.applyType==teasp.constant.APPLY_TYPE_EARLYSTART?o.rejects.earlyStart.push(r):r.applyType==teasp.constant.APPLY_TYPE_LATESTART?o.rejects.lateStart=r:r.applyType==teasp.constant.APPLY_TYPE_EARLYEND?o.rejects.earlyEnd=r:r.applyType==teasp.constant.APPLY_TYPE_DIRECT?o.rejects.direct=r:r.applyType==teasp.constant.APPLY_KEY_REVISETIME?o.rejects.reviseTime=r:r.applyType==teasp.constant.APPLY_TYPE_SHIFTCHANGE&&(
o.rejects.shiftChange=r)))))}for(l in o)o.hasOwnProperty(l)&&o[l]&&"showApply"!=l&&"waiting"!=l&&"rejects"!=l&&(is_array(o[l])?s=s.concat(o[l]):s.push(o[l]));for(var l,s=s.sort(function(e,t){return e.applyTime<t.applyTime?1:e.applyTime>t.applyTime?-1:0}),p=["zangyo","earlyStart","kyushtu"],i=0;i<p.length;i++)o[l=p[i]]&&1<o[l].length&&(o[l]=o[l].sort(function(e,t){
return e.afterFlag&&!t.afterFlag?-1:!e.afterFlag&&t.afterFlag||e.applyTime<t.applyTime?1:e.applyTime>t.applyTime?-1:0}));for(i=0;i<s.length;i++)(r=s[i]).decree&&r.applyType!=teasp.constant.APPLY_TYPE_HOLIDAY||teasp.constant.STATUS_CANCELS.contains(r.status)||((teasp.constant.STATUS_REJECTS.contains(r.status)&&!r.close||r.status==teasp.constant.STATUS_WAIT)&&o.waiting.push(r),
o.showApply?teasp.constant.STATUS_REJECTS.contains(o.showApply.status)||(teasp.constant.STATUS_REJECTS.contains(r.status)||r.status==teasp.constant.STATUS_WAIT&&o.showApply.status!=teasp.constant.STATUS_WAIT)&&(o.showApply=r):o.showApply=r);return o},teasp.logic.EmpTime.createWeekObjs=function(e,t,a,o){for(var s=[],i=teasp.util.date.parseDate(e),n=teasp.util.date.parseDate(t),e=i.getDay(),r=(a!=e&&(
i=teasp.util.date.addDays(i,a-e-(e<a?7:0))),0);teasp.util.date.compareDate(i,n)<=0;){s[r]={legalHolidays:0,workOrFixDays:0,lastHoliday:null,dkeys:[],liveWeekAll:!0};for(var l=s[r],p=0;p<7&&teasp.util.date.compareDate(i,n)<=0;p++)l.dkeys.push(teasp.util.date.formatDate(i)),i=teasp.util.date.addDays(i,1);if(o){for(var d=127,p=0;p<l.dkeys.length;p++){var c=l.dkeys[p];o(c)||0<=(c=l.dkeys.indexOf(c))&&(d&=~(1<<c))}
l.liveWeekAll=127===d}r++}return s},teasp.logic.EmpTime.prototype.getCompleteWeekCnt=function(e){for(var t=0,a=0;a<e.length;a++)7<=e[a].dkeys.length&&t++;return t},teasp.logic.EmpTime.getWeekObj=function(e,t){for(var a=0;a<e.length;a++)if(e[a].dkeys.contains(t))return e[a];return null},teasp.logic.EmpTime.getDateListByWeekObjs=function(e){for(var t=[],a=0;a<e.length;a++)t=t.concat(e[a].dkeys);return t},
teasp.logic.EmpTime.getWorkAndRestTime=function(e,t,a,o,s){var i=new teasp.data.Pouch,e=(i.dataObj=dojo.clone(e),i.dataObj.days[t]);e&&(e.startTime=a,e.endTime=o,e.timeTable=s,e.pattern=null,e.ignorePaidHoly=!0);new teasp.logic.EmpTime(i).recalcEmpDay(t);a=i.getEmpDay(t),o=a.getDiscretionaryLevel(),s=i.getOverTimeRequireTime(o),t=i.getEarlyWorkRequireTime(o),o=a.getMissingOverTime(s),s=a.getMissingEarlyWork(t),t={
workTime:e.real.workRealTime,restTime:e.real.restTime,missingOverTimeApply:0<o,missingOverTimeApplyExist:0<o&&a.isExistApply(teasp.constant.APPLY_KEY_ZANGYO),missingEarlyWorkApply:0<s,missingEarlyWorkApplyExist:0<s&&a.isExistApply(teasp.constant.APPLY_KEY_EARLYSTART),missingLateStartApply:i.isRequiredLateStartApply()&&a.isMissingLateStartApply(),missingEarlyEndApply:i.isRequiredEarlyEndApply(
)&&a.isMissingEarlyEndApply()};return e.pattern.useDiscretionary||(t.workTime-=e.real.hotenWork||0,t.restTime-=e.real.hotenRest||0),t},teasp.logic.EmpTime.prototype.recalcEmpDay=function(e){var t,a=this.pouch.getObj(),o=a.common,s=a.config,i=a.months,n=a.days,a=a.applys,a=this.getApplyDateMap(a),r=[];for(t in n)r.push(t);r=r.sort(function(e,t){return e<t?-1:1}),n=this.mergeEmpDay(n,e,a[e]||[],r,s),
a=this.getPeriodMap(i),i=this.getMonthByDate(i,e),s=i.config,e=a[i.monthEx];n.period=dojo.clone(e),this.calculateEmpDay(n,e,s,o,teasp.constant.C_REAL),this.calculateEmpDay(n,e,s,o,teasp.constant.C_DISC)},teasp.logic.EmpTime.prototype.getDaiqCount=function(e){if(!e||!e.rack.validApplys)return!1;var e=e.rack.validApplys,t=0;
return e.holidayAll&&e.holidayAll.holiday.type==teasp.constant.HOLIDAY_TYPE_DAIQ&&teasp.constant.STATUS_FIX.contains(e.holidayAll.status)&&t++,e.holidayAm&&e.holidayAm.holiday.type==teasp.constant.HOLIDAY_TYPE_DAIQ&&teasp.constant.STATUS_FIX.contains(e.holidayAm.status)&&(t+=.5),e.holidayPm&&e.holidayPm.holiday.type==teasp.constant.HOLIDAY_TYPE_DAIQ&&teasp.constant.STATUS_FIX.contains(e.holidayPm.status)&&(t+=.5),t},
teasp.logic.EmpTime.prototype.getStockCount=function(e){if(!e||!e.rack.validApplys)return null;var t,a=e.rack.validApplys,o={};return a.holidayAll&&a.holidayAll.holiday.managed&&teasp.constant.STATUS_FIX.contains(a.holidayAll.status)&&(o[a.holidayAll.holiday.manageName]={date:e.rack.key,days:1,name:a.holidayAll.holiday.name}),a.holidayAm&&a.holidayAm.holiday.managed&&teasp.constant.STATUS_FIX.contains(
a.holidayAm.status)&&(o[a.holidayAm.holiday.manageName]={date:e.rack.key,days:.5,name:a.holidayAm.holiday.name}),a.holidayPm&&a.holidayPm.holiday.managed&&teasp.constant.STATUS_FIX.contains(a.holidayPm.status)&&(o[a.holidayPm.holiday.manageName]?(t=o[a.holidayPm.holiday.manageName],o[a.holidayPm.holiday.manageName]={date:e.rack.key,days:.5+t.days,name:t.name+","+a.holidayPm.holiday.name}
):o[a.holidayPm.holiday.manageName]={date:e.rack.key,days:.5,name:a.holidayPm.holiday.name}),o},teasp.logic.EmpTime.getPatternByDate=function(e,t){for(var a=0;a<e.length;a++){var o=e[a];if("1"==o.schedOption){var s=""+t.getDay();if(0<=o.schedWeekly.indexOf(s))return o}else if("2"==o.schedOption){var i=parseInt(o.schedMonthlyDate,10);if((i=32==i?teasp.util.date.getMonthEndDay(t.getFullYear(),t.getMonth()+1):i
)==t.getDate())return o}else if("3"==o.schedOption){var i=parseInt(o.schedMonthlyLine,10),n=Math.floor((t.getDate()+6)/7),s=(5==i&&(i=(teasp.util.date.getMonthEndDay(t.getFullYear(),t.getMonth()+1)+6)/7),""+t.getDay());if(n==i&&o.schedMonthlyWeek==s)return o}}return null},teasp.logic.EmpTime.getDayInfo=function(e,t,a,o){var s=teasp.util.date.parseDate(e),i={dayType:teasp.constant.DAY_TYPE_NORMAL,plannedHoliday:!1},
e=t.fixHolidays[e];return i.dayType=e?e.dayType:teasp.constant.DAY_TYPE_NORMAL,null!==t.config.defaultLegalHoliday&&i.dayType!=teasp.constant.DAY_TYPE_NORMAL&&s.getDay()==t.config.defaultLegalHoliday&&(i.defaultLegalHolidayFlag=!0),a?(a.type&&(i.dayType="string"==typeof a.type?parseInt(a.type,10):a.type,i.plannedHoliday=a.plannedHoliday),a.pattern&&(i.pattern=a.pattern),i.event=e&&e.title||"",i.event+=(""!=(
i.event||"")&&a.event?teasp.message.getLabel("tm10001470"):"")+(a.event||"")):i.event=e&&e.title||"",i.pattern||(t=teasp.logic.EmpTime.getPatternByDate(o,s))&&(i.pattern=t.pattern),i},teasp.logic.EmpTime.getRealExchangeDate=function(e,t){for(var a=0;a<t.length;a++){var o=t[a];if(o.applyType==teasp.constant.APPLY_TYPE_EXCHANGE&&teasp.constant.STATUS_FIX.contains(o.status)&&o.originalStartDate==e)return o.exchangeDate}
return null},teasp.logic.EmpTime.getFixTimeSpan=function(e,t,a){for(var o=[{from:e,to:2880}],s=0;s<t.length;)o=teasp.util.time.sliceTimes(o,t[s]),s++;for(var i=[],n=0,s=0;n<a&&s<o.length;){var r=o[s].to-o[s].from;a<n+r&&(o[s].to=o[s].from+(r=a-n)),i.push(o[s]),n+=r,s++}return 0<i.length?i[i.length-1].to:null},teasp.logic.EmpTime.getReachTime=function(e,t,a){for(var o=[{from:e,to:2880}],s=0;s<t.length;
)o=teasp.util.time.sliceTimes(o,t[s]),s++;for(var i=0,n=-1,s=0;s<o.length;s++)if(a<=(i+=o[s].to-o[s].from)){n=o[s].to-(i-a);break}return n},teasp.logic.EmpTime.getReachTimeReverse=function(e,t,a){for(var o=[{from:0,to:e}],s=0;s<t.length;)o=teasp.util.time.sliceTimes(o,t[s]),s++;for(var i=0,n=-1,s=o.length-1;0<=s;s--)if(a<=(i+=o[s].to-o[s].from)){n=o[s].from+(i-a);break}return n},
teasp.logic.EmpTime.containApply=function(e,t){for(var a in e){var o=e[a];if(o)if(is_array(o)){for(var s=0;s<o.length;s++)if(t.id==o[s].id)return!0}else if(t.id==o.id)return!0}return!1},teasp.logic.EmpTime.slideTime=function(e,t,a,o,s){for(var i=[{from:e,to:t}],n=0;n<a.length;)i=teasp.util.time.sliceTimes(i,a[n]),n++;var r,l=-1,p=o;if(s)for(n=i.length-1;0<=n;n--){if(p<=(r=i[n].to-i[n].from)){l=i[n].to-p;break}p-=r
}else for(n=0;n<i.length;n++){if(p<=(r=i[n].to-i[n].from)){l=i[n].from+p;break}p-=r}return l<0?s?t:e:l},teasp.logic.EmpTime.complementTime=function(e,t,a,o,s,i,n,r,l){function p(e,t,a){var o=e<t?e:t;return(t=e<t?t:e)-o-teasp.util.time.rangeTime({from:o,to:t},a)}var d,c=p(e,t,n),m=p(e,t,s),r=(r&&(m-=r),c-m),c=(o&&(r-=o.rx),{tm:l?t:e,rx:r,work:0,rest:0,lateRx:l?0:r,earlyRx:l?r:0,ir:teasp.logic.EmpTime.getIgnoreRests(e,
t,r,s,n)}),h=(i=teasp.util.time.excludeRanges(i,c.ir),-1);if(l){if((d=p(t,a,s)-r)<0&&(c.rx+=d),d<=0)return c;for(u=[{from:t,to:a}],g=0;g<i.length;)u=teasp.util.time.sliceTimes(u,i[g]),g++;for(g=0;g<u.length;g++){if(d<=(y=u[g].to-u[g].from)){h=u[g].from+d;break}d-=y}}else{if((d=p(a,e,s)-r)<0&&(c.rx+=d),d<=0)return c;for(var u=[{from:a,to:e}],g=0;g<i.length;)u=teasp.util.time.sliceTimes(u,i[g]),g++;for(
g=u.length-1;0<=g;g--){if(d<=(y=u[g].to-u[g].from)){h=u[g].to-d;break}d-=y}}var y=h<0?a:h;return!l&&y<e?(c.work=p(y,e,i),c.rest=e-y-c.work):l&&t<y&&(c.work=p(t,y,i),c.rest=y-t-c.work),c.tm=y,c},teasp.logic.EmpTime.getAdjustFixTime=function(e,t,a,o){var s=teasp.util.time.rangeTime(e,t.restTimes||[]),i=0;if((t.restTimes||[]).length<=0)for(var n=0;n<o.length;n++)o[n].check&&o[n].workTime<a&&(i=Math.max(i,o[n].restTime))
t=Math.max(i,s);return!(a<e.to-e.from-t)&&s<t?a-(t-s):a},teasp.logic.EmpTime.entrySpan=function(e,t,a,o,s){var i=null,n=null;a==o||s.to<=a||o<=s.from?n={from:s.from,to:s.to}:s.from<a?(n={from:s.from,to:a},i={from:a,to:s.to}):o<s.to?(i={from:s.from,to:o},n={from:o,to:s.to}):i={from:s.from,to:s.to},i&&e.push(i),n&&t.push(n)},teasp.logic.EmpTime.adjustSpans=function(e,t,a,o){var s=teasp.logic.EmpTime.getSpanTime(e),
i=teasp.logic.EmpTime.getSpanTime(t);a<s?teasp.logic.EmpTime.adjustSpan(e,t,s-a,o):s<a&&0<t.length&&(a=Math.min(a-s,i),teasp.logic.EmpTime.adjustSpan(e,t,-1*a,o))},teasp.logic.EmpTime.adjustSpan=function(e,t,a,o){var s=[].concat(e),i=[].concat(t);if(0<a){for(var n=teasp.logic.EmpTime.getSpanTime(s),r=Math.min(n,a),l=s.length-1;0<=l&&0<r;l--){var p=s[l];(g=p.to-p.from)<=r?(s.splice(l,1),i.push(p),r-=g):(y={to:p.to},
p.to-=r,y.from=p.to,i.push(y),r=0)}i=i.sort(function(e,t){return e.from-t.from})}else{a=Math.abs(a);for(var n=teasp.logic.EmpTime.getSpanTime(i),r=Math.min(n,a),d=[],c=0<s.length?s[0].from:-1,m=[],h=[],l=0;l<i.length;l++){var u=i[l];(0<=c&&u.from<c?h:m).push(u)}for(l=0;l<m.length&&0<r;l++){var g,y,u=m[l];0<(g=Math.min(u.to,o.to)-u.from)&&(g<=r?(Math.min(u.to,o.to)==u.to?(d.push(l),s.push(u)):(y={from:u.from,to:o.to},
u.from=o.to,s.push(y)),r-=g):(y={from:u.from},u.from+=r,y.to=u.from,s.push(y),r=0))}if(0<d.length)for(l=d.length-1;0<=l;l--)m.splice(d[l],1);for(l=h.length-1;0<=l&&0<r;l--)0<(g=(u=h[l]).to-Math.max(o.from,u.from))&&(g<=r?(Math.max(o.from,u.from)==u.from?(h.splice(l,1),s.push(u)):(y={from:o.from,to:u.to},u.to=o.from,s.push(y)),r-=g):(y={to:u.to},u.to-=r,y.from=u.to,s.push(y),r=0));s=s.sort(function(e,t){
return e.from-t.from}),i=(i=m.concat(h)).sort(function(e,t){return e.from-t.from})}e.splice(0,e.length),t.splice(0,t.length);for(l=0;l<s.length;l++)e.push(s[l]);for(l=0;l<i.length;l++)t.push(i[l])},teasp.logic.EmpTime.getSpanTime=function(e){for(var t=0,a=0;a<e.length;a++){var o=e[a];"number"==typeof o.from&&"number"==typeof o.to&&o.from<o.to&&(t+=o.to-o.from)}return t},
teasp.logic.EmpTime.prototype.getHolidayTimeInRange=function(e,t,a){for(var o=e.timeTable||[],s=[],i=0;i<o.length;i++)o[i].type==teasp.constant.REST_PAY&&s.push(o[i]);if(s.length<-0)return 0;for(var n=teasp.util.time.excludeRanges([{from:t,to:a}],e.pattern.restTimes),r=0,i=0;i<n.length;i++)r+=teasp.util.time.rangeTime(n[i],s);return r},teasp.logic.EmpTime.prototype.readTimeTable=function(e,t){t&&t.length&&(
e.timeTable=teasp.logic.EmpTime.rebuildTimeTable(e.timeTable,t)),e.rack.freeRests=[],e.rack.fixRests=[],e.rack.awayTimes=[];for(var a,o=0;o<e.timeTable.length;o++){var s=e.timeTable[o];null!==s.from&&null!==s.to&&(s.type==teasp.constant.REST_FREE||s.type==teasp.constant.REST_FIX?(teasp.logic.EmpTime.isFixRest(s,e.pattern.restTimes)?e.rack.fixRests:e.rack.freeRests).push(s
):s.type==teasp.constant.AWAY&&e.rack.awayTimes.push(s))}0<e.rack.holySpans.length&&(t=teasp.util.time.excludeRanges(e.rack.fixRests,e.rack.holySpans),a=teasp.util.time.includeRanges(e.rack.holySpans,e.pattern.restTimes),e.rack.fixRests=t.concat(a),e.rack.freeRests=teasp.util.time.excludeRanges(e.rack.freeRests,e.rack.holySpans)),this.rebuildRestTimes(e)},teasp.logic.EmpTime.prototype.rebuildRestTimes=function(e){
var t=e.rack.validApplys,a=e.rack.freeRests||[],o=teasp.logic.EmpTime.getSpanTime(a);if(o){for(var s=[],i=0;i<t.holidayTime.length;i++){var n=t.holidayTime[i],n=[{from:n.startTime,to:n.endTime}],n=(a.length&&(a=teasp.util.time.excludeRanges(a,n)),teasp.util.time.includeRanges(n,e.pattern.restTimes));n.length&&(s=s.concat(n))}var r=teasp.logic.EmpTime.getSpanTime(a);if(o!=r){for(var l=e.timeTable||[],
i=l.length-1;0<=i;i--)teasp.logic.EmpTime.isFixRest(l[i],e.pattern.restTimes)||l.splice(i,1);for(i=0;i<a.length;i++)l.push({from:a[i].from,to:a[i].to,type:teasp.constant.REST_FREE});s=teasp.util.time.excludeRanges(s,l);const d=e.rack.fixRests;if(s.length)for(i=0;i<s.length;i++){var p=s[i],p={from:p.from,to:p.to,type:teasp.constant.REST_FIX};l.push(p),d.push(p)}e.rack.freeRests=a,e.rack.fixRests=d,e.rack.timeTable=l}}
},teasp.logic.EmpTime.isFixRest=function(e,t){for(var a=t||[],o=0;o<a.length;o++)if(a[o].from<=e.from&&e.to<=a[o].to)return!0;return!1},teasp.logic.EmpTime.prototype.preHoten=function(e){var t=e.rack.bdrStartTime,a=e.rack.bdrEndTime,o=e.rack.validApplys.lateStart,s=e.rack.validApplys.earlyEnd,i=e.rack.freeRests.concat(e.rack.fixRests),n=(n=teasp.util.time.includeRanges(teasp.util.time.margeTimeSpans(i.concat(
e.rack.hourRests)),[{from:t,to:a}])).concat(teasp.util.time.excludeRanges(e.pattern.restTimes,[{from:t,to:a}])),i=(i=teasp.util.time.includeRanges(i,[{from:t,to:a}])).concat(teasp.util.time.excludeRanges(e.pattern.restTimes,[{from:t,to:a}])),r=teasp.util.time.margeTimeSpans(e.pattern.restTimes.concat(e.rack.hourRests)),l=teasp.util.time.margeTimeSpans(r.concat(e.rack.excludeHalf)),p=0;if((e.pattern.restTimes||[]
).length<=0)for(var d=a-t,c=this.pouch.getRestTimeCheck(),m=0;m<c.length;m++)c[m].check&&c[m].workTime<d&&(p=Math.max(p,c[m].restTime));var h,u=e.startTime,g=e.endTime,y=null;"number"==typeof u&&t<u&&o&&teasp.constant.STATUS_FIX.contains(o.status)&&(o=(o=Math.min(o.endTime,a))<u?this.getRealTime(o,u,l):0,e.rack.hotenLate&&(h=t,o&&(h=teasp.logic.EmpTime.slideTime(t,g,r,o,!1)),u=(y=teasp.logic.EmpTime.complementTime(u,
g,h,y,e.pattern.restTimes,n,i,p,!1)).tm,y.ir.length&&this.readTimeTable(e,y.ir))),"number"==typeof g&&g<a&&s&&teasp.constant.STATUS_FIX.contains(s.status)&&(h=g<(o=Math.max(s.startTime,t))?this.getRealTime(g,o,l):0,e.rack.hotenEarlyEnd&&(s=a,h&&(s=teasp.logic.EmpTime.slideTime(u,a,r,h,!0)),g=(y=teasp.logic.EmpTime.complementTime(u,g,s,y,e.pattern.restTimes,n,i,p,!0)).tm,y.ir.length&&this.readTimeTable(e,y.ir)))},
teasp.logic.EmpTime.rebuildTimeTable=function(e,t){for(var a=[],o=[],s=0;s<e.length;s++){var i=e[s];(null!==i.from&&null!==i.to&&i.type==teasp.constant.REST_FIX?a:o).push(i)}for(var a=teasp.util.time.excludeRanges(a,t),n=o,s=0;s<a.length;s++){var r=a[s];n.push({from:r.from,to:r.to,type:teasp.constant.REST_FIX})}return n},teasp.logic.EmpTime.getIgnoreRests=function(e,t,a,o,s){var i=[];if(0<=a)return i;for(
var n=teasp.util.time.excludeRanges(o,[{from:e,to:t}]),r=Math.abs(a),l=n.length-1;0<r&&0<=l;){var p=n[l],d=p.to-p.from;r<d?i.push({from:p.from+(d-r),to:p.to}):i.push(p),r-=d,l--}return i},teasp.logic.EmpTime.prototype.correctDiscChargeTime=function(e,t){if(e&&e.pattern&&(e.pattern.useDiscretionary||t)){var t=e.real.workChargeTime||0,a=e.disc.workChargeTime||0;if(t!=a){var o=e.real.workChargeSpan||[],s=new Array;if(
a<t)for(var i=a,n=o.length-1;0<=n;n--){if(i<=(u=(h=o[n]).to-h.from)){s.push({from:h.to-i,to:h.to});break}s.push(h),i-=u}else{for(var t=dojo.clone(e.real.workLegalOverSpan||[]),r=2880,l=(0<(t=t.sort(function(e,t){return e.to-t.to})).length&&(r=t[0].from),e.real.workInFixedSpan&&e.real.workInFixedSpan.from<r&&(r=e.real.workInFixedSpan.from),0<t.length?t[t.length-1].to:e.real.endTime),p=0,n=0;n<o.length;n++)p+=(h=o[n]
).to-h.from,l>h.from&&(l=h.from);for(var i=a-p,d=new Array,c=[{from:r,to:l}],m=e.timeTable||[],n=0;n<m.length;n++)"number"!=typeof(u=m[n]).from||"number"!=typeof u.to||u.type!=teasp.constant.REST_FREE&&u.type!=teasp.constant.REST_FIX&&u.type!=teasp.constant.REST_PAY&&u.type!=teasp.constant.REST_UNPAY||d.push(u);for(n=0;n<d.length;)c=teasp.util.time.sliceTimes(c,d[n]),n++;for(var h,u,n=c.length-1;0<=n;n--){if(i<=(u=(
h=c[n]).to-h.from)){s.push({from:h.to-i,to:h.to});break}s.push(h),i-=u}o.length&&(s=s.concat(o))}s=s.sort(function(e,t){return e.from-t.from}),e.real.workChargeTime=a,e.real.workChargeSpan=s}}},teasp.logic.EmpTime.filterTimeTable=function(e,t,a){for(var o=(e&&"string"==typeof e?dojo.fromJson(e):e)||[],s=a||0,i=[],n=dojo.isArray(t)?t:[t],r=0;r<o.length;r++)!(0<=n.indexOf(o[r].type)
)||1&s&&"number"!=typeof o[r].from||2&s&&"number"!=typeof o[r].to||i.push(o[r]);return i},teasp.logic.EmpTime.checkBorderRestTime=function(e,t,a){for(var o=(a&&"string"==typeof a?dojo.fromJson(a):a)||[],s=0;s<o.length;s++){var i=o[s];if((i.type==teasp.constant.REST_FIX||i.type==teasp.constant.REST_FREE)&&"number"==typeof i.from&&"number"==typeof i.to&&(
"number"==typeof e&&i.from<=e&&e<i.to||"number"==typeof t&&i.from<t&&t<=i.to))return!0}return!1},teasp.logic.EmpTime.adjustInputTime=function(e,t){var a=(a=teasp.logic.EmpTime.filterTimeTable(e.rests,[teasp.constant.REST_FIX,teasp.constant.REST_FREE],3)).sort(function(e,t){return e.from==t.from?e.from-t.from:e.to-t.to});if(1&t&&"number"==typeof e.from)for(var o=0;o<a.length;o++)(s=a[o]).from<=e.from&&e.from<s.to&&(
e.from=s.to);if(2&t&&"number"==typeof e.to)for(var s,o=a.length-1;0<=o;o--)(s=a[o]).from<e.to&&e.to<=s.to&&(e.to=s.from);return e},teasp.logic.EmpTime.prototype.existPaidRestOutsideWork=function(e){var t=e.startTime,a=e.endTime;if("number"==typeof t&&"number"==typeof a)for(var o=e.rack.holySpans||[],s=0;s<o.length;s++){var i=o[s];if(i.from<t||a<i.to)return!0}return!1},
teasp.logic.EmpTime.prototype.getHolidayExcludeMap=function(e){for(var t={},a=0;a<e.length;a++){var o=e[a];if(o.holiday&&teasp.constant.STATUS_FIX.contains(o.status)&&!o.holiday.displayDaysOnCalendar&&0!=o.excludeDate.length)for(var s=teasp.util.date.getDateList(o.startDate,o.endDate),i=0;i<s.length;i++){var n=s[i];o.excludeDate.contains(n)&&(t[n]||(t[n]=[]),t[n].push(o))}}return t},teasp.provide(
"teasp.logic.convert"),teasp.logic.convert=function(){},teasp.logic.convert.convSessionInfoObj=function(e,t,a){return teasp.logic.convert.excludeNameSpace(e),{user:{id:e.UserId__c,name:e.UserId__r?e.UserId__r.Name:null,profileName:!!e.UserId__r&&e.UserId__r.Profile.Name,sysAdmin:!!e.UserId__r&&e.UserId__r.Profile.PermissionsModifyAllData,rights:a||0},emp:{id:e.Id||null,name:e.Name||null,isAdmin:e.IsAdmin__c||!1,
isAllEditor:e.IsAllEditor__c||!1,isAllReader:e.IsAllReader__c||!1,isExpAdmin:e.IsExpAdmin__c||!1}}},teasp.logic.convert.convCommonObj=function(e,t){teasp.logic.convert.excludeNameSpace(e);e=0<e.length?e[0]:null,t=e?{taxRate:e.TaxRate__c,taxRoundFlag:e.TaxRoundFlag__c,helpLink:e.HelpLink__c,infoLink:e.InfoLink__c,useFixedButton:e.UseFixedButton__c,useEkitan:"利用する"==e.UseEkitan__c,useRestartable:e.UseRestartable__c,
treatLateStart:teasp.logic.convert.valNumber(e.TreatLateStart__c,0),treatEarlyEnd:teasp.logic.convert.valNumber(e.TreatEarlyEnd__c,0),ekitanArea:e.EkitanArea__c,localKey:e.LocalKey__c,commentIfAbsence:e.CommentIfAbsence__c,commentIfNoPushTime:e.CommentIfNoPushTime__c,indicateNoPushTime:e.IndicateNoPushTime__c,cancelMonthApply:e.CancelMonthApply__c,cancelDayApply:e.CancelDayApply__c,
mailEmpApplyCanceled:e.mailEmpApplyCanceled__c,flexGraph:"表示する"==e.FlexGraph__c,discretionaryOption:"表示する"==e.DiscretionaryOption__c,borderTime:e.BorderTime__c,legalTimeOfDay:e.LegalTimeOfDay__c,nightStartTime:e.NightStartTime__c,nightEndTime:e.NightEndTime__c,jobWorkflow:e.JobWorkflow__c,jobInitialDateHistory:dojo.fromJson(e.JobInitialDateHistory__c||"[]"),jobInitialDayOfMonth:teasp.logic.convert.valNumber(
e.JobInitialDayOfMonth__c),jobMarkOfMonth:teasp.logic.convert.valNumber(e.JobMarkOfMonth__c),progressList:teasp.logic.convert.valArray(e.ProgressList__c,/\r?\n/,teasp.logic.convert.convValidList),processList:teasp.logic.convert.valArray(e.ProcessList__c,/\r?\n/,teasp.logic.convert.convValidList),expWorkflow:e.ExpWorkflow__c,ticketPeriod:e.TicketPeriod__c,expApplyPrefix:e.ExpApplyPrefix__c,revision:e.Revision__c,
keepExteriorTime:e.KeepExteriorTime__c,borderRevNo:t,expStartDate:e.ExpStartDate__c||0,requireNote:e.RequireNote__c,requireNoteOption:teasp.logic.convert.valArray(e.RequireNoteOption__c),checkDefaultDailyFix:e.CheckDefaultDailyFix__c,jobLeaderFilter:e.JobLeaderFilter__c,nonDialogKey:e.NonDialogKey__c,notInfoAutoView:e.NotInfoAutoView__c,msDailyWorkTimeIsReal:e.MsDailyWorkTimeIsReal__c,
dailyApprover:e.DailyApprover__c,useDailyApply:e.UseDailyApply__c,allowEditManager:e.AllowEditManager__c,allowEditExpAdmin:e.AllowEditExpAdmin__c,disabledTimeReport:e.DisabledTimeReport__c,disabledEmpExp:e.DisabledEmpExp__c,disabledEmpJob:e.DisabledEmpJob__c,workNoteCrlfOn:e.WorkNoteCrlfOn__c,handleInvalidApply:e.HandleInvalidApply__c,clarifyAfterApply:e.ClarifyAfterApply__c,
hideMonthlySummary:e.HideMonthlySummary__c,hideBottomSummary:e.HideBottomSummary__c,hideTimeGraphPopup:e.HideTimeGraphPopup__c,permitLeavingPush24hours:e.permitLeavingPush24hours__c,permitStartBtnDateChange:e.PermitStartBtnDateChange__c,separateDailyNote:e.SeparateDailyNote__c,permitDeptFixWoMonthFix:e.PermitDeptFixWoMonthFix__c,leftoverJobId:e.LeftoverJobId__c,
leftoverJobCode:e.LeftoverJobId__r&&e.LeftoverJobId__r.JobCode__c||"",leftoverJobName:e.LeftoverJobId__r&&e.LeftoverJobId__r.Name||"",leftoverJobStartDate:teasp.logic.convert.valDate(e.LeftoverJobId__r&&e.LeftoverJobId__r.StartDate__c),leftoverJobEndDate:teasp.logic.convert.valDate(e.LeftoverJobId__r&&e.LeftoverJobId__r.EndDate__c),leftoverJobActive:e.LeftoverJobId__r&&e.LeftoverJobId__r.Active__c||!1,
leftoverJobAssignClass:e.LeftoverJobId__r&&e.LeftoverJobId__r.JobAssignClass__c||null,useJobApproverSet:e.UseJobApproverSet__c,useExpApproverSet:e.UseExpApproverSet__c,dontFixJobMonthly:e.DontFixJobMonthly__c,limitToMainteJob:e.LimitToMainteJob__c,useJobExtraItem1:e.UseJobExtraItem1__c,permitDuplicateJobProcess:e.PermitDuplicateJobProcess__c,jobExtraItem1Name:e.JobExtraItem1Name__c||"",
jobExtraItem1Length:e.JobExtraItem1Length__c||0,jobExtraItem1Width:e.JobExtraItem1Width__c||0,useJobExtraItem2:e.UseJobExtraItem2__c,jobExtraItem2Name:e.JobExtraItem2Name__c||"",jobExtraItem2Length:e.JobExtraItem2Length__c||0,jobExtraItem2Width:e.JobExtraItem2Width__c||0,workNoteTemplate:e.WorkNoteTemplate__c||null,prohibitAcrossMonthApply:e.ProhibitAcrossMonthApply__c,expLinkDocument:e.ExpLinkDocument__c,
requireExpLinkJob:e.RequireExpLinkJob__c,recalcByLatestExchangeRate:e.RecalcByLatestExchangeRate__c,limitedTimeDistance:teasp.logic.convert.valFloat(e.LimitedTimeDistance__c,48),permitChangeLeftoverJob:e.PermitChangeLeftoverJob__c,namingRule:e.NamingRule__c,expPreApplyConfig:teasp.constant.getExpPreApplyConfig(e.ExpPreApplyConfig__c?dojo.fromJson(e.ExpPreApplyConfig__c):null),
extraItemOutPutDataName1:e.ExtraItemOutputDataName1__c||"",extraItemOutPutDataName2:e.ExtraItemOutputDataName2__c||"",useAccessControlSystem:e.UseAccessControlSystem__c,divergenceReasonList:teasp.logic.convert.valArray(e.DivergenceReasonList__c,/\r?\n/,teasp.logic.convert.convValidList),defaultWorkLocationId:e.DefaultWorkLocationId__c||null,config:dojo.fromJson(e.Config__c||"{}"),
permitMonthlySummaryHelpURL:e.DisableMonthlySummaryHelpURL__c,fixedWorkMSHelpURL:e.FixedWorkMSHelpURL__c,flextimeMSHelpURL:e.FlextimeMSHelpURL__c,variableWorkMSHelpURL:e.VariableWorkMSHelpURL__c,managerMSHelpURL:e.ManagerMSHelpURL__c,discretionaryWorkMSHelpURL:e.DiscretionaryWorkMSHelpURL__c}:{revision:null};return teasp.setTs1OptimizeOnBrowser(t.config&&t.config.ts1OptimizeOnBrowser||!1),teasp.setTs1OptimizeWidth(
t.config&&t.config.ts1OptimizeWidth||null),teasp.setTs1OptimizeOption(t.config&&t.config.ts1OptimizeOption||teasp.ts1OptimizeOptionValue.OptimizedTs1),t},teasp.logic.convert.convTargetEmpObj=function(e,t){teasp.logic.convert.excludeNameSpace(e);t={id:e.Id||null,name:e.Name||null,code:e.EmpCode__c||"",empTypeId:e.EmpTypeId__c||null,empTypeName:e.EmpTypeId__r?e.EmpTypeId__r.Name:"",
userId:e.UserId__r?e.UserId__r.Id:null,userName:e.UserId__r?e.UserId__r.Name:"",managerId:e.Manager__r?e.Manager__r.Id:null,managerName:e.Manager__r?e.Manager__r.Name:"",entryDate:teasp.logic.convert.valDate(e.EntryDate__c),endDate:teasp.logic.convert.valDate(e.EndDate__c),deptId:e.DeptId__r?e.DeptId__r.Id:null,deptCode:e.DeptId__r?e.DeptId__r.DeptCode__c:"",deptName:e.DeptId__r?e.DeptId__r.Name:"",
deptStartDate:teasp.logic.convert.valDate(e.DeptStartDate__c),deptStartMonth:teasp.logic.convert.valNumber(e.DeptStartMonth__c),isAdmin:e.IsAdmin__c||!1,isAllEditor:e.IsAllEditor__c||!1,isAllReader:e.IsAllReader__c||!1,isExpAdmin:e.IsExpAdmin__c||!1,workInputType:teasp.logic.convert.valNumber(e.WorkInputType__c),workNoteOption:void 0===e.WorkNoteOption__c||e.WorkNoteOption__c,taskNoteOption:e.TaskNoteOption__c||!1,
jobAssignClass:e.JobAssignClass__c||null,expConfig:e.ExpConfig__c||null,commuterRouteLock:e.CommuterRouteLock__c||!1,commuterRouteNote:e.CommuterRouteNote__c||"",nextYuqProvideDate:teasp.logic.convert.valDate(e.NextYuqProvideDate__c),hidden:e.Hidden__c||!1,title:e.Title__c||null,mode:t||"edit",inputFlag:teasp.logic.convert.valNumber(e.InputFlag__c,0),inputAccessControlFlag:teasp.logic.convert.valNumber(
e.InputAccessControlFlag__c,0),inputAccessControlFlagHistory:function(e){var t=[];try{l=dojo.fromJson(e||"[]");for(var a=0;a<l.length;a++){var o=l[a];o.date&&(o.inputAccessControlFlag=teasp.logic.convert.valNumber(o.inputAccessControlFlag,0),t.push(o))}t=t.sort(function(e,t){return e.date<t.date?-1:1})}catch(e){}return t}(e.InputAccessControlFlagHistory__c),
inputAccessControlFlagLock:!!e.InputAccessControlFlagLock__c,smallPhotoUrl:e.UserId__r&&e.UserId__r.SmallPhotoUrl||null,leftoverJobId:e.LeftoverJobId__c||null,leftoverJobCode:e.LeftoverJobId__r&&e.LeftoverJobId__r.JobCode__c||"",leftoverJobName:e.LeftoverJobId__r&&e.LeftoverJobId__r.Name||"",leftoverJobStartDate:teasp.logic.convert.valDate(e.LeftoverJobId__r&&e.LeftoverJobId__r.StartDate__c),
leftoverJobEndDate:teasp.logic.convert.valDate(e.LeftoverJobId__r&&e.LeftoverJobId__r.EndDate__c),leftoverJobActive:e.LeftoverJobId__r&&e.LeftoverJobId__r.Active__c||!1,leftoverJobAssignClass:e.LeftoverJobId__r&&e.LeftoverJobId__r.JobAssignClass__c||null,configBase:e.EmpTypeId__r?{id:e.EmpTypeId__r.ConfigBaseId__r.Id,initialDayOfWeek:teasp.logic.convert.valNumber(e.EmpTypeId__r.ConfigBaseId__r.InitialDayOfWeek__c),
initialDateOfMonth:teasp.logic.convert.valNumber(e.EmpTypeId__r.ConfigBaseId__r.InitialDateOfMonth__c),markOfMonth:teasp.logic.convert.valNumber(e.EmpTypeId__r.ConfigBaseId__r.MarkOfMonth__c),initialDateOfYear:teasp.logic.convert.valNumber(e.EmpTypeId__r.ConfigBaseId__r.InitialDateOfYear__c),markOfYear:teasp.logic.convert.valNumber(e.EmpTypeId__r.ConfigBaseId__r.MarkOfYear__c)}:null,daiqManage:e.EmpTypeId__r?{
daiqLimit:e.EmpTypeId__r.DaiqLimit__c,daiqAllBorderTime:e.EmpTypeId__r.DaiqAllBorderTime__c,daiqHalfBorderTime:e.EmpTypeId__r.DaiqHalfBorderTime__c,useDaiqLegalHoliday:e.EmpTypeId__r.UseDaiqLegalHoliday__c,useDaiqManage:e.EmpTypeId__r.UseDaiqManage__c,useDaiqReserve:e.EmpTypeId__r.UseDaiqReserve__c,useHalfDaiq:e.EmpTypeId__r.UseHalfDaiq__c,useRegulateHoliday:e.EmpTypeId__r.UseRegulateHoliday__c,
noDaiqExchanged:e.EmpTypeId__r.NoDaiqExchanged__c}:null,holidayStock:e.EmpTypeId__r?{enableStockHoliday:e.EmpTypeId__r.EnableStockHoliday__c,maxStockHoliday:e.EmpTypeId__r.MaxStockHoliday__c,maxStockHolidayPerYear:e.EmpTypeId__r.MaxStockHolidayPerYear__c}:null};return t.configBaseOrg=t.configBase,t},teasp.logic.convert.convApproverSetObjs=function(e){teasp.logic.convert.excludeNameSpace(e);for(var t=e||[],a={},
o=0;o<t.length;o++){var s=t[o];a[s.Type__c]={id:s.Id,type:s.Type__c,approvers:[s.Approver1__r?{id:s.Approver1__r.Id,name:s.Approver1__r.Name}:null,s.Approver2__r?{id:s.Approver2__r.Id,name:s.Approver2__r.Name}:null,s.Approver3__r?{id:s.Approver3__r.Id,name:s.Approver3__r.Name}:null,s.Approver4__r?{id:s.Approver4__r.Id,name:s.Approver4__r.Name}:null,s.Approver5__r?{id:s.Approver5__r.Id,name:s.Approver5__r.Name}:null,
s.Approver6__r?{id:s.Approver6__r.Id,name:s.Approver6__r.Name}:null,s.Approver7__r?{id:s.Approver7__r.Id,name:s.Approver7__r.Name}:null,s.Approver8__r?{id:s.Approver8__r.Id,name:s.Approver8__r.Name}:null,s.Approver9__r?{id:s.Approver9__r.Id,name:s.Approver9__r.Name}:null,s.Approver10__r?{id:s.Approver10__r.Id,name:s.Approver10__r.Name}:null]}}for(var i=[teasp.constant.APPROVER_TYPE_MONTH,
teasp.constant.APPROVER_TYPE_MONTHLY,teasp.constant.APPROVER_TYPE_DAILY,teasp.constant.APPROVER_TYPE_DAILYFIX,teasp.constant.APPROVER_TYPE_JOB,teasp.constant.APPROVER_TYPE_EXP],o=0;o<i.length;o++){var n=i[o];a[n]||(a[n]={id:null,type:n,approvers:[null,null,null,null,null,null,null,null,null,null]})}return a},teasp.logic.convert.convEmpMonthObjs=function(e,t,a){for(var o=e||[],s=t||[],i=(
teasp.logic.convert.excludeNameSpace(o),teasp.logic.convert.excludeNameSpace(s),[]),n=0;n<o.length;n++){var r=o[n],l={id:r.Id,yearMonth:r.YearMonth__c,apply:{id:r.EmpApplyId__r?r.EmpApplyId__r.Id:null,status:r.EmpApplyId__r?r.EmpApplyId__r.Status__c:null,close:r.EmpApplyId__r?r.EmpApplyId__r.Close__c:null},deptMonth:r.DeptMonthId__c?{id:r.DeptMonthId__c,status:r.DeptMonthId__r.Status__c||null,
deptId:r.DeptMonthId__r.DeptId__c||null,deptName:r.DeptMonthId__r.DeptId__r&&r.DeptMonthId__r.DeptId__r.Name||null,deptCode:r.DeptMonthId__r.DeptId__r&&r.DeptMonthId__r.DeptId__r.DeptCode__c||null,histDept:r.DeptMonthId__r.HistDeptId__c?{deptId:r.DeptMonthId__r.HistDeptId__c,deptName:r.DeptMonthId__r.HistDeptId__r.Name||null,
deptCode:r.DeptMonthId__r.HistDeptId__r.DeptCode__c||r.DeptMonthId__r.HistDeptId__r.Code__c||null}:null}:null,inputFlag:teasp.logic.convert.valNumber(r.InputFlag__c,0),inputAccessControlFlag:teasp.logic.convert.valNumber(r.InputAccessControlFlag__c,0),startDate:teasp.logic.convert.valDate(r.StartDate__c),endDate:teasp.logic.convert.valDate(r.EndDate__c),lastModifiedDate:r.LastModifiedDate,
legalWorkTimeOfPeriod:r.LegalWorkTimeOfPeriod__c,attributeAtConfirm:teasp.decode(r.AttributeAtConfirm__c,1),configId:r.ConfigId__c,periodWorkOverTime36:r.PeriodWorkOverTime36__c,empTypeId:r.EmpTypeId__c||null,empTypeName:r.EmpTypeId__r?r.EmpTypeId__r.Name:null,configBase:r.EmpTypeId__r?{id:r.EmpTypeId__r.ConfigBaseId__r.Id,initialDayOfWeek:teasp.logic.convert.valNumber(
r.EmpTypeId__r.ConfigBaseId__r.InitialDayOfWeek__c),initialDateOfMonth:teasp.logic.convert.valNumber(r.EmpTypeId__r.ConfigBaseId__r.InitialDateOfMonth__c),markOfMonth:teasp.logic.convert.valNumber(r.EmpTypeId__r.ConfigBaseId__r.MarkOfMonth__c),initialDateOfYear:teasp.logic.convert.valNumber(r.EmpTypeId__r.ConfigBaseId__r.InitialDateOfYear__c),markOfYear:teasp.logic.convert.valNumber(
r.EmpTypeId__r.ConfigBaseId__r.MarkOfYear__c)}:null,daiqManage:r.EmpTypeId__r?{daiqLimit:r.EmpTypeId__r.DaiqLimit__c,daiqAllBorderTime:r.EmpTypeId__r.DaiqAllBorderTime__c,daiqHalfBorderTime:r.EmpTypeId__r.DaiqHalfBorderTime__c,useDaiqLegalHoliday:r.EmpTypeId__r.UseDaiqLegalHoliday__c,useDaiqManage:r.EmpTypeId__r.UseDaiqManage__c,useDaiqReserve:r.EmpTypeId__r.UseDaiqReserve__c,
useHalfDaiq:r.EmpTypeId__r.UseHalfDaiq__c,useRegulateHoliday:r.EmpTypeId__r.UseRegulateHoliday__c,noDaiqExchanged:r.EmpTypeId__r.NoDaiqExchanged__c}:null,holidayStock:r.EmpTypeId__r?{enableStockHoliday:r.EmpTypeId__r.EnableStockHoliday__c,maxStockHoliday:r.EmpTypeId__r.MaxStockHoliday__c,maxStockHolidayPerYear:r.EmpTypeId__r.MaxStockHolidayPerYear__c}:null};if(a)for(var p=0;p<a.length;p++){var d=(a[p]||"").split("."
)[0];r.hasOwnProperty(d)&&(l[d]="number"==typeof r[d]?r[d]:r[d]||null)}i.push(l)}for(var c=[],n=0;n<s.length;n++){var m=s[n],l={id:m.Id,yearMonth:m.YearMonth__c,status:m.Status__c||null,deptId:m.DeptId__c||null,deptName:m.DeptId__r&&m.DeptId__r.Name||null,histDept:m.HistDeptId__c?{deptId:m.HistDeptId__c,deptName:m.HistDeptId__r.Name,deptCode:m.HistDeptId__r.DeptCode__c||m.HistDeptId__r.Code__c||null}:null};c.push(l)}
return{months:i,deptMonths:c}},teasp.logic.convert.convEmpMonthSimpleObjs=function(e){for(var t=e||[],a=(teasp.logic.convert.excludeNameSpace(t),[]),o=0;o<t.length;o++){var s=t[o],s={id:s.Id,yearMonth:s.YearMonth__c,startDate:teasp.logic.convert.valDate(s.StartDate__c),endDate:teasp.logic.convert.valDate(s.EndDate__c),apply:{id:s.EmpApplyId__r?s.EmpApplyId__r.Id:null,
status:s.EmpApplyId__r?s.EmpApplyId__r.Status__c:null,close:s.EmpApplyId__r?s.EmpApplyId__r.Close__c:null},deptMonth:s.DeptMonthId__c?{id:s.DeptMonthId__c,status:s.DeptMonthId__r.Status__c||null,deptId:s.DeptMonthId__r.DeptId__c||null,deptName:s.DeptMonthId__r.DeptId__r&&s.DeptMonthId__r.DeptId__r.Name||null,deptCode:s.DeptMonthId__r.DeptId__r&&s.DeptMonthId__r.DeptId__r.DeptCode__c||null}:null};a.push(s)}return a},
teasp.logic.convert.convConfigObjs=function(e){teasp.logic.convert.excludeNameSpace(e);for(var t=[],a=0;a<e.length;a++){var o=e[a],o={id:o.Id,workSystem:o.WorkSystem__c,holidays:o.Holidays__c,autoLegalHoliday:o.AutoLegalHoliday__c,defaultLegalHoliday:teasp.logic.convert.valNumber(o.DefaultLegalHoliday__c,null),useWorkFlow:o.UseWorkFlow__c,useMakeupHoliday:o.UseMakeupHoliday__c,changePattern:"1"==o.ChangePattern__c,
changeShift:"1"==o.ChangeShift__c,flexStartTime:o.FlexStartTime__c,flexEndTime:o.FlexEndTime__c,coreStartTime:o.CoreStartTime__c,coreEndTime:o.CoreEndTime__c,useCoreTime:o.UseCoreTime__c,flexFixOption:o.FlexFixOption__c,flexFixMonthTime:o.FlexFixMonthTime__c,flexFixDayTime:o.FlexFixDayTime__c,flexLegalWorkTimeOption:o.FlexLegalWorkTimeOption__c,variablePeriod:teasp.logic.convert.valNumber(o.VariablePeriod__c,1),
timeRound:o.TimeRound__c,timeRoundBegin:o.TimeRoundBegin__c,timeRoundEnd:o.TimeRoundEnd__c,timeFormat:o.TimeFormat__c,legalTimeOfWeek:o.LegalTimeOfWeek__c,validStartMonth:o.ValidStartMonth__c||null,validEndMonth:o.ValidEndMonth__c||null,validStartDate:teasp.logic.convert.valDate(o.ValidStartDate__c),validEndDate:teasp.logic.convert.valDate(o.ValidEndDate__c),generation:o.Generation__c,baseTime:o.BaseTime__c,
baseTimeForStock:o.BaseTimeForStock__c,standardFixTime:o.StandardFixTime__c,coreTimeGraph:o.CoreTimeGraph__c,restTimeCheck:dojo.fromJson(o.RestTimeCheck__c||"[]"),roundMonthlyTime:teasp.logic.convert.valNumber(o.RoundMonthlyTime__c),useEarlyEndApply:o.UseEarlyEndApply__c,useLateStartApply:o.UseLateStartApply__c,useEarlyWorkFlag:teasp.logic.convert.convOverFlag(o.UseEarlyWorkFlag__c||0),
useOverTimeFlag:teasp.logic.convert.convOverFlag(o.UseOverTimeFlag__c||0),useDailyApply:o.UseDailyApply__c,useReviseTimeApply:o.UseReviseTimeApply__c,useHolidayWorkFlag:o.UseHolidayWorkFlag__c,pastTimeOnly:o.PastTimeOnly__c,changeDayType:o.ChangeDayType__c,exchangeLimit:teasp.logic.convert.valNumber(o.ExchangeLimit__c,null),exchangeLimit2:teasp.logic.convert.valNumber(o.ExchangeLimit2__c,null),
checkDailyFixLeak:o.CheckDailyFixLeak__c,checkWorkingTimeMonthly:o.CheckWorkingTimeMonthly__c,nonPublicHoliday:o.NonPublicHoliday__c,halfDaiqReckontoWorked:o.HalfDaiqReckontoWorked__c,daiqReckontoWorked:o.HalfDaiqReckontoWorked__c,inputWorkingTimeOnWorkTimeView:o.InputWorkingTimeOnWorkTimeView__c,leavingAcrossNextDay:o.LeavingAcrossNextDay__c,
prohibitApplicantEliminatingLegalHoliday:o.ProhibitApplicantEliminatingLegalHoliday__c,prohibitInputTimeUntilApproved:o.ProhibitInputTimeUntilApproved__c,separateDailyFixButton:o.SeparateDailyFixButton__c,summary36TimePeriod:o.Summary36TimePeriod__c,useApplyApproverTemplate:o.UseApplyApproverTemplate__c,overTimeBorderTime:teasp.logic.convert.valNumber(o.OverTimeBorderTime__c,-1),
earlyWorkBorderTime:teasp.logic.convert.valNumber(o.EarlyWorkBorderTime__c,-1),permitUpdateTimeLevel:teasp.logic.convert.valNumber(o.PermitUpdateTimeLevel__c,0),highlightLateEarly:o.HighlightLateEarly__c,nightChargeOnly:o.NightChargeOnly__c,useDirectApply:o.UseDirectApply__c,workTypeList:o.WorkTypeList__c,config:teasp.decode(o.Config__c,1),weekDayAccessBaseTime:o.WeekDayAccessBaseTime__c,
holidayAccessBaseTime:o.HolidayAccessBaseTime__c,permitDailyApply:o.PermitDailyApply__c,permitMonthlyApply:o.PermitMonthlyApply__c,permitDivergenceTime:o.PermitDivergenceTime__c,useAccessControlSystem:o.UseAccessControlSystem__c,msAccessInfo:o.MsAccessInfo__c,useWorkLocation:o.UseWorkLocation__c,requireWorkLocation:o.RequireWorkLocation__c,dailyApprover:teasp.logic.convert.valNumber(o.DailyApprover__c,0),
checkWorkingTime:o.CheckWorkingTime__c,deductWithFixedTime:o.DeductWithFixedTime__c,extendDayType:o.ExtendDayType__c,originalId:o.OriginalId__c,configBaseId:o.ConfigBaseId__c,removed:o.Removed__c,defaultPattern:{stdStartTime:o.StdStartTime__c,stdEndTime:o.StdEndTime__c,restTimes:teasp.util.extractTimes(o.RestTimes__c),standardFixTime:o.StandardFixTime__c,useHalfHoliday:o.UseHalfHoliday__c,
amHolidayStartTime:o.AmHolidayStartTime__c,amHolidayEndTime:o.AmHolidayEndTime__c,pmHolidayStartTime:o.PmHolidayStartTime__c,pmHolidayEndTime:o.PmHolidayEndTime__c,igonreNightWork:o.IgonreNightWork__c,useDiscretionary:o.UseDiscretionary__c,useHalfHolidayRestTime:o.UseHalfHolidayRestTime__c,amHolidayRestTimes:teasp.util.extractTimes(o.AmHolidayRestTimes__c),pmHolidayRestTimes:teasp.util.extractTimes(
o.PmHolidayRestTimes__c)}};o.workSystem==teasp.constant.WORK_SYSTEM_MANAGER&&(o.halfDaiqReckontoWorked=!1,o.daiqReckontoWorked=!1),o.workSystem==teasp.constant.WORK_SYSTEM_MUTATE&&1<o.variablePeriod&&(o.legalTimeOfWeek=2400),o.config||(o.config={}),o.config.empApply||(o.config.empApply={}),t.push(o)}return t},teasp.logic.convert.convConfigMinObjs=function(e){teasp.logic.convert.excludeNameSpace(e);for(var t=[],
a=0;a<e.length;a++){var o=e[a],o={id:o.Id,holidays:o.Holidays__c,autoLegalHoliday:o.AutoLegalHoliday__c,defaultLegalHoliday:o.DefaultLegalHoliday__c||null,validStartMonth:o.ValidStartMonth__c||null,validEndMonth:o.ValidEndMonth__c||null,validStartDate:teasp.logic.convert.valDate(o.ValidStartDate__c),validEndDate:teasp.logic.convert.valDate(o.ValidEndDate__c),generation:o.Generation__c,
nonPublicHoliday:o.NonPublicHoliday__c};t.push(o)}return t},teasp.logic.convert.convJobApplyObj=function(e){teasp.logic.convert.excludeNameSpace(e);e=e&&e.length?e[0]:e;return e?{id:e.Id,yearMonth:e.YearMonth__c,subNo:e.SubNo__c||null,status:e.Status__c,startDate:teasp.logic.convert.valDate(e.StartDate__c),endDate:teasp.logic.convert.valDate(e.EndDate__c)}:null},teasp.logic.convert.convJobApplysObj=function(e){
teasp.logic.convert.excludeNameSpace(e);for(var t=[],a=0;a<e.length;a++){var o=e[a];t.push({id:o.Id,yearMonth:o.YearMonth__c,subNo:o.SubNo__c||null,status:o.Status__c,startDate:teasp.logic.convert.valDate(o.StartDate__c),endDate:teasp.logic.convert.valDate(o.EndDate__c)})}return t},teasp.logic.convert.convCalendarObjs=function(e){teasp.logic.convert.excludeNameSpace(e);for(var t=[],a=0;a<e.length;a++){var o=e[a];
t.push({date:teasp.logic.convert.valDate(o.Date__c),type:o.Type__c,empTypeId:o.EmpTypeId__c,deptId:o.DeptId__c,event:o.Event__c,plannedHoliday:o.PlannedHoliday__c,priority:"1"==o.Priority__c,pattern:o.PatternId__r?{id:o.PatternId__r.Id,name:o.PatternId__r.Name,stdStartTime:o.PatternId__r.StdStartTime__c,stdEndTime:o.PatternId__r.StdEndTime__c,restTimes:teasp.util.extractTimes(o.PatternId__r.RestTimes__c),
standardFixTime:o.PatternId__r.StandardFixTime__c,useHalfHoliday:o.PatternId__r.UseHalfHoliday__c,amHolidayStartTime:o.PatternId__r.AmHolidayStartTime__c,amHolidayEndTime:o.PatternId__r.AmHolidayEndTime__c,pmHolidayStartTime:o.PatternId__r.PmHolidayStartTime__c,pmHolidayEndTime:o.PatternId__r.PmHolidayEndTime__c,igonreNightWork:o.PatternId__r.IgonreNightWork__c,useDiscretionary:o.PatternId__r.UseDiscretionary__c,
enableRestTimeShift:o.PatternId__r.EnableRestTimeShift__c,workTimeChangesWithShift:o.PatternId__r.WorkTimeChangesWithShift__c,disableCoreTime:o.PatternId__r.DisableCoreTime__c,useHalfHolidayRestTime:o.PatternId__r.UseHalfHolidayRestTime__c,amHolidayRestTimes:teasp.util.extractTimes(o.PatternId__r.AmHolidayRestTimes__c),pmHolidayRestTimes:teasp.util.extractTimes(o.PatternId__r.PmHolidayRestTimes__c)}:null})}for(
var s={},a=0;a<t.length;a++){var i,n=t[a];n.deptId?(s[n.deptId]||(s[n.deptId]={}),s[n.deptId][n.date]=n):(i=s[n.date])?n.empTypeId?(n.event&&(i.event=(""!=(i.event||"")?i.event+teasp.message.getLabel("tm10001470"):"")+n.event),i.pattern=n.pattern,!i.priority&&n.type&&(i.type=n.type,i.plannedHoliday=n.plannedHoliday)):(n.event&&(i.event=n.event+(""!=(i.event||"")?teasp.message.getLabel("tm10001470")+i.event:"")),
n.priority&&n.type&&(i.type=n.type,i.plannedHoliday=n.plannedHoliday)):s[n.date]=n}return s},teasp.logic.convert.convEmpDayObjs=function(e){teasp.logic.convert.excludeNameSpace(e);for(var t={},a=0;a<e.length;a++){var o,s=e[a],s=(t[teasp.logic.convert.valDate(s.Date__c)]={dayType:parseInt(s.DayType__c,10),dbOrgDayType:s.OrgDayType__c,holiday1:s.HolidayId1__r?{id:s.HolidayId1__r.Id,
name:teasp.logic.convert.excludeCopyTag(s.HolidayId1__r.Name),type:s.HolidayId1__r.Type__c,range:s.HolidayId1__r.Range__c,plannedHoliday:s.HolidayId1__r.PlannedHoliday__c,displayDaysOnCalendar:s.HolidayId1__r.DisplayDaysOnCalendar__c,yuqSpend:s.HolidayId1__r.YuqSpend__c,config:dojo.fromJson(s.HolidayId1__r.Config__c||"{}")}:s.HolidayApplyId1__r&&"1"==s.HolidayApplyId1__r.FilterValid__c?{
id:s.HolidayApplyId1__r.HolidayId__r.Id,name:teasp.logic.convert.excludeCopyTag(s.HolidayApplyId1__r.HolidayId__r.Name),type:s.HolidayApplyId1__r.HolidayId__r.Type__c,range:s.HolidayApplyId1__r.HolidayId__r.Range__c,displayDaysOnCalendar:s.HolidayApplyId1__r.HolidayId__r.DisplayDaysOnCalendar__c,yuqSpend:s.HolidayApplyId1__r.HolidayId__r.YuqSpend__c,config:dojo.fromJson(
s.HolidayApplyId1__r.HolidayId__r.Config__c||"{}")}:null,holiday2:s.HolidayId2__r?{id:s.HolidayId2__r.Id,name:teasp.logic.convert.excludeCopyTag(s.HolidayId2__r.Name),type:s.HolidayId2__r.Type__c,range:s.HolidayId2__r.Range__c,plannedHoliday:s.HolidayId2__r.PlannedHoliday__c,displayDaysOnCalendar:s.HolidayId2__r.DisplayDaysOnCalendar__c,yuqSpend:s.HolidayId2__r.YuqSpend__c,config:dojo.fromJson(
s.HolidayId2__r.Config__c||"{}")}:s.HolidayApplyId2__r&&"1"==s.HolidayApplyId2__r.FilterValid__c?{id:s.HolidayApplyId2__r.HolidayId__r.Id,name:teasp.logic.convert.excludeCopyTag(s.HolidayApplyId2__r.HolidayId__r.Name),type:s.HolidayApplyId2__r.HolidayId__r.Type__c,range:s.HolidayApplyId2__r.HolidayId__r.Range__c,displayDaysOnCalendar:s.HolidayApplyId2__r.HolidayId__r.DisplayDaysOnCalendar__c,
yuqSpend:s.HolidayApplyId2__r.HolidayId__r.YuqSpend__c,config:dojo.fromJson(s.HolidayApplyId2__r.HolidayId__r.Config__c||"{}")}:null,pattern:s.PatternId__r?{id:s.PatternId__r.Id,name:teasp.logic.convert.excludeCopyTag(s.PatternId__r.Name),stdStartTime:s.PatternId__r.StdStartTime__c,stdEndTime:s.PatternId__r.StdEndTime__c,restTimes:teasp.util.extractTimes(s.PatternId__r.RestTimes__c),
standardFixTime:s.PatternId__r.StandardFixTime__c,useHalfHoliday:s.PatternId__r.UseHalfHoliday__c,amHolidayStartTime:s.PatternId__r.AmHolidayStartTime__c,amHolidayEndTime:s.PatternId__r.AmHolidayEndTime__c,pmHolidayStartTime:s.PatternId__r.PmHolidayStartTime__c,pmHolidayEndTime:s.PatternId__r.PmHolidayEndTime__c,igonreNightWork:s.PatternId__r.IgonreNightWork__c,useDiscretionary:s.PatternId__r.UseDiscretionary__c,
enableRestTimeShift:s.PatternId__r.EnableRestTimeShift__c,workTimeChangesWithShift:s.PatternId__r.WorkTimeChangesWithShift__c,disableCoreTime:s.PatternId__r.DisableCoreTime__c,useHalfHolidayRestTime:s.PatternId__r.UseHalfHolidayRestTime__c,amHolidayRestTimes:teasp.util.extractTimes(s.PatternId__r.AmHolidayRestTimes__c),pmHolidayRestTimes:teasp.util.extractTimes(s.PatternId__r.PmHolidayRestTimes__c)}:null,
startTime:s.StartTime__c,endTime:s.EndTime__c,pushStartTime:s.PushStartTime__c,pushEndTime:s.PushEndTime__c,timeTable:teasp.util.extractTimes(s.TimeTable__c),workLegalTime:s.WorkLegalTime__c,workLegalOverTime:s.WorkLegalOverTime__c,workChargeTime:s.WorkChargeTime__c,note:s.Note__c,dairyDivergenceJudgement:s.DairyDivergenceJudgement__c,enterDivergenceJudgement:teasp.logic.convert.valNumber(
s.EnterDivergenceJudgement__c,null),enterDivergenceReason:s.EnterDivergenceReason__c,enterTime:s.EnterTime__c,exitDivergenceJudgement:teasp.logic.convert.valNumber(s.ExitDivergenceJudgement__c,null),exitDivergenceReason:s.ExitDivergenceReason__c,exitTime:s.ExitTime__c,event:s.Event__c,exchangeDate:teasp.logic.convert.valDate(
s.ExchangeSApplyId__r&&"1"==s.ExchangeSApplyId__r.FilterValid__c?s.ExchangeSApplyId__r.ExchangeDate__c:s.ExchangeEApplyId__r&&"1"==s.ExchangeEApplyId__r.FilterValid__c?s.ExchangeEApplyId__r.StartDate__c:null),plannedHoliday:s.PlannedHoliday__c,workNote:s.WorkNote__c,workLocationId:s.WorkLocationId__c,applyId:{holidayApplyId1:s.HolidayApplyId1__c,holidayApplyId2:s.HolidayApplyId2__c,
exchangeSApplyId:s.ExchangeSApplyId__c,exchangeEApplyId:s.ExchangeEApplyId__c,patternSApplyId:s.PatternSApplyId__c,patternLApplyId:s.PatternLApplyId__c,zangyoApplyId:s.ZangyoApplyId__c,earlyStartApplyId:s.EarlyStartApplyId__c,holidayWorkApplyId:s.HolidayWorkApplyId__c,lateStartApplyId:s.LateStartApplyId__c,earlyEndApplyId:s.EarlyEndApplyId__c,dailyApplyId:s.DailyApplyId__c}},t[teasp.logic.convert.valDate(s.Date__c)])
s.holiday1&&s.holiday2&&s.holiday1.range==teasp.constant.RANGE_PM&&s.holiday2.range==teasp.constant.RANGE_AM&&(o=s.holiday1,s.holiday1=s.holiday2,s.holiday2=o)}return t},teasp.logic.convert.convSimpleEmpDayObjs=function(e){teasp.logic.convert.excludeNameSpace(e);for(var t={},a=0;a<e.length;a++){var o=e[a];t[teasp.logic.convert.valDate(o.Date__c)]={dayType:parseInt(o.DayType__c,10),startTime:o.StartTime__c,
endTime:o.EndTime__c,plannedHoliday:o.PlannedHoliday__c}}return t},teasp.logic.convert.convEmpApplyObjs=function(e){teasp.logic.convert.excludeNameSpace(e);for(var t=[],a=0;a<e.length;a++){var o=e[a],o={id:o.Id,applyType:o.ApplyType__c,yearMonth:o.YearMonth__c,startDate:teasp.logic.convert.valDate(o.StartDate__c),endDate:teasp.logic.convert.valDate(o.EndDate__c),startTime:o.StartTime__c,endTime:o.EndTime__c,
exchangeDate:teasp.logic.convert.valDate(o.ExchangeDate__c),originalStartDate:teasp.logic.convert.valDate(o.OriginalStartDate__c),status:o.Status__c,close:o.Close__c,decree:o.Decree__c,content:o.Content__c,dayType:o.DayType__c||null,holiday:o.HolidayId__r?{id:o.HolidayId__r.Id,name:o.HolidayId__r.Name,type:o.HolidayId__r.Type__c,range:o.HolidayId__r.Range__c,managed:o.HolidayId__r.Managed__c,
manageName:o.HolidayId__r.ManageName__c,displayDaysOnCalendar:o.HolidayId__r.DisplayDaysOnCalendar__c,yuqSpend:o.HolidayId__r.YuqSpend__c,config:dojo.fromJson(o.HolidayId__r.Config__c||"{}"),order:o.HolidayId__r.Order__c||0}:null,pattern:o.PatternId__r?{id:o.PatternId__c,name:o.PatternId__r.Name,stdStartTime:o.PatternId__r.StdStartTime__c,stdEndTime:o.PatternId__r.StdEndTime__c,restTimes:teasp.util.extractTimes(
o.PatternId__r.RestTimes__c),standardFixTime:o.PatternId__r.StandardFixTime__c,useHalfHoliday:o.PatternId__r.UseHalfHoliday__c,amHolidayStartTime:o.PatternId__r.AmHolidayStartTime__c,amHolidayEndTime:o.PatternId__r.AmHolidayEndTime__c,pmHolidayStartTime:o.PatternId__r.PmHolidayStartTime__c,pmHolidayEndTime:o.PatternId__r.PmHolidayEndTime__c,igonreNightWork:o.PatternId__r.IgonreNightWork__c,
useDiscretionary:o.PatternId__r.UseDiscretionary__c,enableRestTimeShift:o.PatternId__r.EnableRestTimeShift__c,workTimeChangesWithShift:o.PatternId__r.WorkTimeChangesWithShift__c,disableCoreTime:o.PatternId__r.DisableCoreTime__c,useHalfHolidayRestTime:o.PatternId__r.UseHalfHolidayRestTime__c,amHolidayRestTimes:teasp.util.extractTimes(o.PatternId__r.AmHolidayRestTimes__c),pmHolidayRestTimes:teasp.util.extractTimes(
o.PatternId__r.PmHolidayRestTimes__c)}:null,workPlace:o.WorkPlaceId__r?{id:o.WorkPlaceId__c,code:o.WorkPlaceId__r.DeptCode__c,name:o.WorkPlaceId__r.Name,symbol:o.WorkPlaceId__r.Symbol__c}:null,applyTime:teasp.logic.convert.valDateTime(o.ApplyTime__c),note:o.Note__c,contact:o.Contact__c,ownReason:o.OwnReason__c,daiqReserve:o.DaiqReserve__c,daiqDate1:teasp.logic.convert.valDate(o.DaiqDate1__c),
daiqDate1Range:teasp.logic.convert.valNumber(o.DaiqDate1Range__c),daiqDate2:teasp.logic.convert.valDate(o.DaiqDate2__c),daiqDate2Range:teasp.logic.convert.valNumber(o.DaiqDate2Range__c),useRegulateHoliday:o.UseRegulateHoliday__c,treatDeduct:teasp.logic.convert.valNumber(o.TreatDeduct__c,0),excludeDate:teasp.logic.convert.valArray(o.ExcludeDate__c,/:/,teasp.logic.convert.convFormatDate),timeTable:o.TimeTable__c||null,
oldValue:o.OldValue__c||null,reviseType:o.ReviseType__c||null,entered:o.Entered__c||!1,afterFlag:o.AfterFlag__c||!1,content:o.Content__c||null,directFlag:o.DirectFlag__c||!1,workType:o.WorkType__c||null,travelTime:o.TravelTime__c,estimatedOverTime:o.EstimatedOverTime__c,holidayTime:o.HolidayTime__c,approvers:[o.Approver1__r?{id:o.Approver1__r.Id,name:o.Approver1__r.Name}:null,o.Approver2__r?{id:o.Approver2__r.Id,
name:o.Approver2__r.Name}:null,o.Approver3__r?{id:o.Approver3__r.Id,name:o.Approver3__r.Name}:null,o.Approver4__r?{id:o.Approver4__r.Id,name:o.Approver4__r.Name}:null,o.Approver5__r?{id:o.Approver5__r.Id,name:o.Approver5__r.Name}:null,o.Approver6__r?{id:o.Approver6__r.Id,name:o.Approver6__r.Name}:null,o.Approver7__r?{id:o.Approver7__r.Id,name:o.Approver7__r.Name}:null,o.Approver8__r?{id:o.Approver8__r.Id,
name:o.Approver8__r.Name}:null,o.Approver9__r?{id:o.Approver9__r.Id,name:o.Approver9__r.Name}:null,o.Approver10__r?{id:o.Approver10__r.Id,name:o.Approver10__r.Name}:null]};"勤務確定"==o.applyType&&(o.startDate=null,o.endDate=null),t.push(o)}return t},teasp.logic.convert.convEmpMonthApplyObjs=function(e){return teasp.logic.convert.excludeNameSpace(e),e?{id:e.Id,yearMonth:e.YearMonth__c,status:e.Status__c,close:e.Close__c,
applyType:e.ApplyType__c,applyTime:teasp.logic.convert.valDateTime(e.ApplyTime__c)}:null},teasp.logic.convert.convEvents=function(e){var t=[];if(!e)return t;teasp.logic.convert.excludeNameSpace(e);for(var a=0;a<e.length;a++){var o=e[a];t.push({id:o.id,startDateTime:teasp.logic.convert.valDateTime(o.StartDateTime),endDateTime:teasp.logic.convert.valDateTime(o.EndDateTime),subject:o.Subject,
isAllDayEvent:o.IsAllDayEvent,description:o.Description,what:o.what})}return t=t.sort(function(e,t){return e.isAllDayEvent&&!t.isAllDayEvent?-1:!e.isAllDayEvent&&t.isAllDayEvent?1:e.isAllDayEvent&&t.isAllDayEvent?0:e.startDateTime<t.startDateTime?-1:1})},teasp.logic.convert.convTxsLogs=function(e){var t=[];if(!e||!e.logs)return t;teasp.logic.convert.excludeNameSpace(e);for(var a=e.logs,o=0;o<a.length;o++){var s=a[o];
t.push({id:s.Id,targetTime:teasp.logic.convert.valDateTimeObj(s.TargetTime__c),endTime:teasp.logic.convert.valDateTimeObj(s.endTime__c),stauts:s.Status__c,target:s.TargetId__c?e[s.TargetId__c]:null})}return t},teasp.logic.convert.convCalAccessService=function(e){var t;return e?(teasp.logic.convert.excludeNameSpace(e),e):t},teasp.logic.convert.convCalAuthResult=function(e){
return e&&teasp.logic.convert.excludeNameSpace(e),e},teasp.logic.convert.convInfoObjs=function(e){teasp.logic.convert.excludeNameSpace(e);for(var t=[],a=0;a<e.length;a++){var o=e[a];t.push({id:o.Id,createdDate:teasp.logic.convert.valDateTime(o.CreatedDate),text:o.Text__c,agree:o.Agree__c})}return t},teasp.logic.convert.convJobAssignObjs=function(e){teasp.logic.convert.excludeNameSpace(e);for(var t=[],
a=0;a<e.length;a++){var o=e[a];t.push({id:o.Id,jobId:o.JobId__r?o.JobId__r.Id:null,job:{code:o.JobId__r.JobCode__c,name:o.JobId__r.Name,deptId:o.JobId__r.DeptId__c,deptCode:o.JobId__r.DeptId__r&&o.JobId__r.DeptId__r.DeptCode__c||null,deptName:o.JobId__r.DeptId__r&&o.JobId__r.DeptId__r.Name||null,startDate:teasp.logic.convert.valDate(o.JobId__r.StartDate__c),endDate:teasp.logic.convert.valDate(o.JobId__r.EndDate__c),
assignLimit:o.JobId__r.AssignLimit__c,accountId:o.JobId__r.AccountId__c,jobLeaderId:o.JobId__r.JobLeaderId__c,jobLeader:o.JobId__r.JobLeaderId__r?o.JobId__r.JobLeaderId__r.Name:"",explain:o.JobId__r.Explain__c,active:o.JobId__r.Active__c,jobAssignClass:o.JobId__r.JobAssignClass__c||null,processList:o.JobId__r.ProcessList__c},isAssigned:o.IsAssigned__c,order:o.Order__c||0,process:o.Process__c||null})}return t},
teasp.logic.convert.convWorkObjs=function(e){teasp.logic.convert.excludeNameSpace(e);for(var t=[],a=0;a<e.length;a++){var o=e[a];t.push({id:o.Id,date:teasp.logic.convert.valDate(o.EmpDayId__r.Date__c),jobId:o.JobId__r.Id,job:{code:o.JobId__r.JobCode__c,name:o.JobId__r.Name,deptId:o.JobId__r.DeptId__c,deptCode:o.JobId__r.DeptId__r&&o.JobId__r.DeptId__r.DeptCode__c||null,
deptName:o.JobId__r.DeptId__r&&o.JobId__r.DeptId__r.Name||null,startDate:teasp.logic.convert.valDate(o.JobId__r.StartDate__c),endDate:teasp.logic.convert.valDate(o.JobId__r.EndDate__c),assignLimit:o.JobId__r.AssignLimit__c,accountId:o.JobId__r.AccountId__c,jobLeaderId:o.JobId__r.JobLeaderId__c,jobLeader:o.JobId__r.JobLeaderId__r?o.JobId__r.JobLeaderId__r.Name:"",explain:o.JobId__r.Explain__c,
active:o.JobId__r.Active__c},jobApply:{id:o.JobApplyId__c,yearMonth:o.JobApplyId__r?o.JobApplyId__r.YearMonth__c:null,subNo:o.JobApplyId__r&&o.JobApplyId__r.SubNo__c||null,status:o.JobApplyId__r?o.JobApplyId__r.Status__c:null,startDate:o.JobApplyId__r?teasp.logic.convert.valDate(o.JobApplyId__r.StartDate__c):null,endDate:o.JobApplyId__r?teasp.logic.convert.valDate(o.JobApplyId__r.EndDate__c):null},volume:o.Volume__c,
percent:o.Percent__c,time:o.CalcTime__c,timeFix:o.TimeFix__c,taskNote:o.TaskNote__c||null,progress:o.Progress__c||null,process:o.Process__c||null,extraItem1:o.ExtraItem1__c||null,extraItem2:o.ExtraItem2__c||null,extraItem1Name:o.ExtraItem1Name__c||null,extraItem2Name:o.ExtraItem2Name__c||null,order:o.Order__c||0})}return t},teasp.logic.convert.convUnlimitedJobObjs=function(e){teasp.logic.convert.excludeNameSpace(e);
for(var t=[],a=0;a<e.length;a++){var o=e[a];t.push({jobId:o.Id,jobCode:o.JobCode__c,jobName:o.Name,deptId:o.DeptId__c,deptCode:o.DeptId__r&&o.DeptId__r.DeptCode__c||null,deptName:o.DeptId__r&&o.DeptId__r.Name||null,startDate:teasp.logic.convert.valDate(o.StartDate__c),endDate:teasp.logic.convert.valDate(o.EndDate__c),assignLimit:o.AssignLimit__c,accountId:o.AccountId__c,jobLeaderId:o.JobLeaderId__c,
jobLeader:o.JobLeaderId__r?o.JobLeaderId__r.Name:"",explain:o.Explain__c||"",active:o.Active__c,assignLimit:o.AssignLimit__c,assignSelf:o.JobR1__r&&o.JobR1__r.length,jobAssignClass:o.JobAssignClass__c,processList:o.ProcessList__c})}return t},teasp.logic.convert.convExpLogObjs=function(e){teasp.logic.convert.excludeNameSpace(e);for(var t,a,o,s,i=[],n=0;n<e.length;n++){var r=e[n];i.push({id:r.Id,
date:teasp.logic.convert.valDate(r.Date__c),jobId:r.JobId__r?r.JobId__r.Id:null,job:r.JobId__r?{code:r.JobId__r.JobCode__c,name:r.JobId__r.Name}:null,expApplyId:r.ExpApplyId__r?r.ExpApplyId__r.Id:null,expApply:r.ExpApplyId__r?{id:r.ExpApplyId__r.Id,expApplyNo:r.ExpApplyId__r.ExpApplyNo__c,status:r.ExpApplyId__r.Status__c}:null,expItemId:r.ExpItemId__r?r.ExpItemId__r.Id:null,expItem:r.ExpItemId__r?{
id:r.ExpItemId__r.Id,code:r.ExpItemId__r.Code__c,note:r.ExpItemId__r.Note__c,itemName:r.ExpItemId__r.ItemName__c,name:r.ExpItemId__r.Name,cost:r.ExpItemId__r.Cost__c,receipt:r.ExpItemId__r.Receipt__c,useExtraItem1:r.ExpItemId__r.UseExtraItem1__c,useExtraItem2:r.ExpItemId__r.UseExtraItem2__c,extraItem1Name:r.ExpItemId__r.ExtraItem1Name__c||teasp.message.getLabel("tk10005100"),
extraItem2Name:r.ExpItemId__r.ExtraItem2Name__c||teasp.message.getLabel("tk10005100"),extraItem1Width:r.ExpItemId__r.ExtraItem1Width__c,extraItem2Width:r.ExpItemId__r.ExtraItem2Width__c,extraItem1LimitLength:r.ExpItemId__r.ExtraItem1LimitLength__c,extraItem2LimitLength:r.ExpItemId__r.ExtraItem2LimitLength__c,transportType:teasp.logic.convert.valNumber(r.ExpItemId__r.TransportType__c),
foreignFlag:r.ExpItemId__r.ForeignFlag__c,removed:r.ExpItemId__r.Removed__c,enableQuantity:r.ExpItemId__r.EnableQuantity__c||!1,unitName:r.ExpItemId__r.UnitName__c||""}:null,foreignFlag:!!r.CurrencyName__c,currencyName:r.CurrencyName__c||null,currencyRate:r.CurrencyRate__c||0,foreignAmount:r.ForeignAmount__c||0,taxFlag:r.ExpItemId__r.TaxFlag__c||!1,tax:r.Tax__c||0,taxAuto:"boolean"!=typeof r.TaxAuto__c||r.TaxAuto__c,
taxType:r.TaxType__c||"0",withoutTax:r.WithoutTax__c||0,startName:r.startName__c||null,startCode:r.startCode__c||null,endName:r.endName__c||null,endCode:r.endCode__c||null,cost:r.Cost__c||0,receipt:r.Receipt__c||!1,roundTrip:r.roundTrip__c||!1,transportType:teasp.logic.convert.valNumber(r.TransportType__c),detail:r.Detail__c||null,route:r.Route__c||null,extraItem1:r.ExtraItem1__c||null,
extraItem2:r.ExtraItem2__c||null,useExtraItem1:!!r.ExtraItem1__c,useExtraItem2:!!r.ExtraItem2__c,item:r.Item__c||null,icInfo:(t=r.Item__c,a=r.Cost__c,o=r.startName__c,s=r.endName__c,teasp.constant.IC_INPUTS.contains(t)&&a?{item:t,cost:a||0,start:o||null,end:s||null}:null),order:r.Order__c||0,attachments:r.Attachments&&0<r.Attachments.length?[{id:r.Attachments[0].Id,name:r.Attachments[0].Name,
contentType:r.Attachments[0].ContentType}]:null,unitPrice:r.UnitPrice__c||null,quantity:r.Quantity__c||null,paymentDate:teasp.logic.convert.valDate(r.PaymentDate__c),isPaid:r.IsPaid__c||null,payeeId:r.PayeeId__c||null,payee:r.PayeeId__r?{name:r.PayeeId__r.Name||"",payeeType:r.PayeeId__r.PayeeType__c}:null,chargeDept:r.ChargeDeptId__r?{id:r.ChargeDeptId__c||null,code:r.ChargeDeptId__r.DeptCode__c||"",
name:r.ChargeDeptId__r.Name||""}:null,cardStatementLineId:r.CardStatementLineId__c||null,cardStatementLine:r.CardStatementLineId__r?{recordTypeName:r.CardStatementLineId__r.RecordType&&r.CardStatementLineId__r.RecordType.Name||""}:null})}return i},teasp.logic.convert.convExpApplyObjs=function(e){teasp.logic.convert.excludeNameSpace(e);for(var t=[],a=0;a<e.length;a++){var o=e[a];t.push({id:o.Id,
expApplyNo:o.ExpApplyNo__c,deptId:o.DeptId__c,deptCode:o.DeptCode__c||"",deptName:o.DeptName__c||"",status:o.Status__c,comment:o.Comment__c,applyTime:teasp.logic.convert.valDateTime(o.ApplyTime__c),approveTime:teasp.logic.convert.valDateTime(o.ApproveTime__c),approverName:o.ApproverId__r?o.ApproverId__r.Name:"",payDate:teasp.logic.convert.valDate(o.payDate__c),totalCost:o.TotalCost__c||0,
amountDueToPay:o.AmountDueToPay__c||0,expPreApplyId:o.ExpPreApplyId__c||null,provisionalPaymentAmount:o.ProvisionalPaymentAmount__c||0,expPreApplyNo:o.ExpPreApplyId__r&&o.ExpPreApplyId__r.ExpPreApplyNo__c||null,expPreApplyTitle:o.ExpPreApplyId__r&&o.ExpPreApplyId__r.Title__c||null,expPreApplyPpAmount:o.ExpPreApplyId__r&&o.ExpPreApplyId__r.ProvisionalPaymentAmount__c||0,statusC:o.StatusC__c||null,
statusD:o.StatusD__c||null,expenseType:o.ExpenseType__c,payExpItemId:o.PayExpItemId__c,payExpItemName:o.PayExpItemId__r&&o.PayExpItemId__r.Name||null,applyDate:teasp.logic.convert.valDate(o.ApplyDate__c),provisionalPaymentId:o.ProvisionalPaymentId__c,provisionalPaymentTitle:o.ProvisionalPaymentId__r&&o.ProvisionalPaymentId__r.Title__c||"",extraItem1:o.ExtraItem1__c,extraItem2:o.ExtraItem2__c,
chargeDeptId:o.ChargeDeptId__c,chargeDeptCode:o.ChargeDeptId__r&&o.ChargeDeptId__r.DeptCode__c||"",chargeDeptName:o.ChargeDeptId__r&&o.ChargeDeptId__r.Name||"",chargeJobId:o.ChargeJobId__c,chargeJobCode:o.ChargeJobId__r&&o.ChargeJobId__r.JobCode__c||"",chargeJobName:o.ChargeJobId__r&&o.ChargeJobId__r.Name||"",expCancelApplyId:o.ExpCancelApplyId__c,
expCancelApplyStatus:o.ExpCancelApplyId__r&&o.ExpCancelApplyId__r.Status__c||"",expCancelApproveTime:teasp.logic.convert.valDateTime(o.ExpCancelApplyId__r&&o.ExpCancelApplyId__r.ApproveTime__c||null),expCancelApproverName:o.ExpCancelApplyId__r&&o.ExpCancelApplyId__r.ApproverId__r&&o.ExpCancelApplyId__r.ApproverId__r.Name||"",ringi:o.ApplyId__r?{id:o.ApplyId__r.Id,applyNo:o.ApplyId__r.ApplicationNo__c,
type:o.ApplyId__r.Type__c,name:o.ApplyId__r.Name,applicationDate:teasp.logic.convert.valDate(o.ApplyId__r.ApplicationDate__c),ownerId:o.ApplyId__r.Owner.Id,ownerName:o.ApplyId__r.Owner.Name,status:o.ApplyId__r.Status__c,amount:o.ApplyId__r.Amount__c}:null,attachments:o.Attachments||[]})}return t},teasp.logic.convert.convExpItemObjs=function(e){teasp.logic.convert.excludeNameSpace(e);for(var t=[],a=0;a<e.length;a++){
var o=e[a];t.push({id:o.Id,code:o.Code__c,note:o.Note__c,itemName:o.ItemName__c,name:o.Name,cost:o.Cost__c,receipt:o.Receipt__c,transportType:teasp.logic.convert.valNumber(o.TransportType__c),removed:o.Removed__c,order:o.Order__c||0,foreignFlag:o.ForeignFlag__c,taxFlag:o.TaxFlag__c,taxAuto:!0,taxType:o.TaxType__c||"1",taxCode:o.TaxCode__c||null,auxCode:o.AuxCode__c||null,auxTitle:o.AuxTitle__c||null,
fixAmount:o.FixAmount__c,allowMinus:o.AllowMinus__c,group:o.Group__c||null,forAdjustment:o.ForAdjustment__c,useExtraItem1:o.UseExtraItem1__c,useExtraItem2:o.UseExtraItem2__c,extraItem1Name:o.ExtraItem1Name__c||"(未使用)",extraItem2Name:o.ExtraItem2Name__c||"(未使用)",extraItem1Width:o.ExtraItem1Width__c||null,extraItem2Width:o.ExtraItem2Width__c||null,extraItem1LimitLength:o.ExtraItem1LimitLength__c||null,
extraItem2LimitLength:o.ExtraItem2LimitLength__c||null,enableQuantity:o.EnableQuantity__c||!1,unitName:o.UnitName__c||""})}return t=t.sort(function(e,t){return e.order-t.order})},teasp.logic.convert.convForeignCurrencyObjs=function(e){teasp.logic.convert.excludeNameSpace(e);for(var t=[],a=0;a<e.length;a++){var o=e[a];t.push({id:o.Id,name:o.Name,yomi:o.Yomi__c,rate:o.Rate__c,removed:o.Removed__c})}return t=t.sort(
function(e,t){return e.order-t.order})},teasp.logic.convert.convYuqRemainObjs=function(e){teasp.logic.convert.excludeNameSpace(e);for(var t=[],a=0;a<e.length;a++){for(var o=e[a],s={id:o.Id,baseTime:o.BaseTime__c,subject:o.Subject__c,createdDate:teasp.logic.convert.valDateTime(o.CreatedDate),date:teasp.logic.convert.valDate(o.Date__c),startDate:teasp.logic.convert.valDate(o.StartDate__c),
limitDate:teasp.logic.convert.valDate(o.LimitDate__c),tempFlag:o.TempFlag__c,autoFlag:o.AutoFlag__c,provideDays:0,provideTime:0,spendDays:0,spendTime:0,remainDays:0,remainTime:0,remainMinutes:0,children:[]},i=0;i<o.EmpYuqGroupR__r.length;i++){var n=o.EmpYuqGroupR__r[i];0<n.Time__c||n.lostFlag?s.provideTime+=n.Time__c:s.spendTime+=n.Time__c,s.children.push({date:teasp.logic.convert.valDate(n.EmpYuqId__r.Date__c),
time:n.Time__c,empApplyId:n.EmpYuqId__r.EmpApplyId__c||null,lostFlag:n.EmpYuqId__r.LostFlag__c,startDate:n.EmpYuqId__r.EmpApplyId__r?teasp.logic.convert.valDate(n.EmpYuqId__r.EmpApplyId__r.StartDate__c):null,endDate:n.EmpYuqId__r.EmpApplyId__r?teasp.logic.convert.valDate(n.EmpYuqId__r.EmpApplyId__r.EndDate__c):null,excludeDate:n.EmpYuqId__r.EmpApplyId__r?n.EmpYuqId__r.EmpApplyId__r.ExcludeDate__c:null})}
s.remainTime=s.provideTime+s.spendTime;var r=s.provideTime/s.baseTime,r=(s.provideDays=Math.floor(2*r)/2,s.provideTime-=s.provideDays*s.baseTime,s.spendTime*=-1,s.spendTime/s.baseTime),r=(s.spendDays=Math.floor(2*r)/2,s.spendTime-=s.spendDays*s.baseTime,s.remainTime/s.baseTime);s.remainMinutes=s.remainTime,s.remainDays=Math.floor(2*r)/2,s.remainTime-=s.remainDays*s.baseTime,t.push(s)}return t},
teasp.logic.convert.convStockObjs=function(e){teasp.logic.convert.excludeNameSpace(e);for(var t=[],a=0;a<e.length;a++){var o=e[a],s={id:o.Id,name:o.Name,createdDate:teasp.logic.convert.valDateTime(o.CreatedDate),type:o.Type__c,lostFlag:o.LostFlag__c||!1,date:teasp.logic.convert.valDate(o.Date__c),startDate:teasp.logic.convert.valDate(o.StartDate__c),limitDate:teasp.logic.convert.valDate(o.LimitDate__c),
days:new Decimal(o.Days__c||0).plus(new Decimal(o.Hours__c||0)).toNumber(),consumedDays:o.ConsumedDays__c?parseFloat(o.ConsumedDays__c):0,remainDays:o.RemainDaysAndHours__c?parseFloat(o.RemainDaysAndHours__c):0,workRealTime:"number"==typeof o.WorkRealTime__c?o.WorkRealTime__c:null,timeUnit:!o.Days__c&&0!=o.Hours__c,baseTime:o.BaseTime__c,consumers:function(){var e=[];if(o.Consumers__r)for(
var t=0;t<o.Consumers__r.length;t++){var a=o.Consumers__r[t];e.push({id:a.Id,cdays:new Decimal(a.Days__c||0).plus(new Decimal(a.Hours__c||0)).toNumber(),consumedByStockId:a.ConsumedByStockId__c,name:a.ConsumedByStockId__r&&a.ConsumedByStockId__r.Name||"",lostFlag:a.ConsumedByStockId__r&&a.ConsumedByStockId__r.LostFlag__c||!1,date:a.ConsumedByStockId__r&&teasp.logic.convert.valDate(a.ConsumedByStockId__r.Date__c
)||null,days:new Decimal(a.ConsumedByStockId__r&&a.ConsumedByStockId__r.Days__c||0).plus(new Decimal(a.ConsumedByStockId__r&&a.ConsumedByStockId__r.Hours__c||0)).toNumber(),startDate:a.ConsumedByStockId__r&&teasp.logic.convert.valDate(a.ConsumedByStockId__r.StartDate__c)||null,limitDate:a.ConsumedByStockId__r&&teasp.logic.convert.valDate(a.ConsumedByStockId__r.LimitDate__c)||null,
empApplyId:a.ConsumedByStockId__r&&a.ConsumedByStockId__r.EmpApplyId__c||null,applyType:a.ConsumedByStockId__r&&a.ConsumedByStockId__r.EmpApplyId__r&&a.ConsumedByStockId__r.EmpApplyId__r.ApplyType__c||null,status:a.ConsumedByStockId__r&&a.ConsumedByStockId__r.EmpApplyId__r&&a.ConsumedByStockId__r.EmpApplyId__r.Status__c||null,
close:a.ConsumedByStockId__r&&a.ConsumedByStockId__r.EmpApplyId__r&&a.ConsumedByStockId__r.EmpApplyId__r.Close__c||null,applyTime:a.ConsumedByStockId__r&&a.ConsumedByStockId__r.EmpApplyId__r&&teasp.logic.convert.valDateTime(a.ConsumedByStockId__r.EmpApplyId__r.ApplyTime__c)||null,holidayId:a.ConsumedByStockId__r&&a.ConsumedByStockId__r.EmpApplyId__r&&a.ConsumedByStockId__r.EmpApplyId__r.HolidayId__c||null,
holidayName:a.ConsumedByStockId__r&&a.ConsumedByStockId__r.EmpApplyId__r&&a.ConsumedByStockId__r.EmpApplyId__r.HolidayId__r&&a.ConsumedByStockId__r.EmpApplyId__r.HolidayId__r.Name||null,holidayType:a.ConsumedByStockId__r&&a.ConsumedByStockId__r.EmpApplyId__r&&a.ConsumedByStockId__r.EmpApplyId__r.HolidayId__r&&a.ConsumedByStockId__r.EmpApplyId__r.HolidayId__r.Type__c||null,
holidayRange:a.ConsumedByStockId__r&&a.ConsumedByStockId__r.EmpApplyId__r&&a.ConsumedByStockId__r.EmpApplyId__r.HolidayId__r&&a.ConsumedByStockId__r.EmpApplyId__r.HolidayId__r.Range__c||null,timeUnit:a.ConsumedByStockId__r&&!a.ConsumedByStockId__r.Days__c&&0!=a.ConsumedByStockId__r.Hours__c,baseTime:a.ConsumedByStockId__r&&(a.ConsumedByStockId__r.BaseTime||0)})}return e}(),apply:o.EmpApplyId__r?{
id:o.EmpApplyId__r.Id,status:o.EmpApplyId__r.Status__c,applyType:o.EmpApplyId__r.ApplyType__c,close:o.EmpApplyId__r.Close__c,holiday:o.EmpApplyId__r.HolidayId__r?{name:o.EmpApplyId__r.HolidayId__r.Name,type:o.EmpApplyId__r.HolidayId__r.Type__c,range:o.EmpApplyId__r.HolidayId__r.Range__c,displayDaysOnCalendar:o.EmpApplyId__r.HolidayId__r.DisplayDaysOnCalendar__c,yuqSpend:o.EmpApplyId__r.HolidayId__r.YuqSpend__c}:null
}:null};t.push(s)}return t},teasp.logic.convert.convEmpTypePatternObjs=function(e){teasp.logic.convert.excludeNameSpace(e);for(var t=[],a=0;a<e.length;a++){var o=e[a];t.push({id:o.Id,schedOption:o.SchedOption__c,schedMonthlyDate:o.SchedMonthlyDate__c||null,schedMonthlyLine:o.SchedMonthlyLine__c||null,schedMonthlyWeek:o.SchedMonthlyWeek__c||null,schedWeekly:o.SchedWeekly__c||null,order:o.Order__c||0,
pattern:o.PatternId__r?{id:o.PatternId__r.Id,name:o.PatternId__r.Name,stdStartTime:o.PatternId__r.StdStartTime__c,stdEndTime:o.PatternId__r.StdEndTime__c,restTimes:teasp.util.extractTimes(o.PatternId__r.RestTimes__c),standardFixTime:o.PatternId__r.StandardFixTime__c,useHalfHoliday:o.PatternId__r.UseHalfHoliday__c,amHolidayStartTime:o.PatternId__r.AmHolidayStartTime__c,
amHolidayEndTime:o.PatternId__r.AmHolidayEndTime__c,pmHolidayStartTime:o.PatternId__r.PmHolidayStartTime__c,pmHolidayEndTime:o.PatternId__r.PmHolidayEndTime__c,useDiscretionary:o.PatternId__r.UseDiscretionary__c,igonreNightWork:o.PatternId__r.IgonreNightWork__c,range:o.PatternId__r.Range__c,prohibitChangeExchangedWorkTime:o.PatternId__r.ProhibitChangeExchangedWorkTime__c,
prohibitChangeHolidayWorkTime:o.PatternId__r.ProhibitChangeHolidayWorkTime__c,prohibitChangeWorkTime:o.PatternId__r.ProhibitChangeWorkTime__c,enableRestTimeShift:o.PatternId__r.EnableRestTimeShift__c,workTimeChangesWithShift:o.PatternId__r.WorkTimeChangesWithShift__c,disableCoreTime:o.PatternId__r.DisableCoreTime__c,useHalfHolidayRestTime:o.PatternId__r.UseHalfHolidayRestTime__c,
amHolidayRestTimes:teasp.util.extractTimes(o.PatternId__r.AmHolidayRestTimes__c),pmHolidayRestTimes:teasp.util.extractTimes(o.PatternId__r.PmHolidayRestTimes__c)}:null})}return t=t.sort(function(e,t){return e.order-t.order})},teasp.logic.convert.convPatternObjs=function(e){teasp.logic.convert.excludeNameSpace(e);for(var t=[],a=0;a<e.length;a++){var o=e[a];o.PatternId__r&&t.push({id:o.PatternId__r.Id,
name:o.PatternId__r.Name,stdStartTime:o.PatternId__r.StdStartTime__c,stdEndTime:o.PatternId__r.StdEndTime__c,restTimes:teasp.util.extractTimes(o.PatternId__r.RestTimes__c),standardFixTime:o.PatternId__r.StandardFixTime__c,useHalfHoliday:o.PatternId__r.UseHalfHoliday__c,amHolidayStartTime:o.PatternId__r.AmHolidayStartTime__c,amHolidayEndTime:o.PatternId__r.AmHolidayEndTime__c,
pmHolidayStartTime:o.PatternId__r.PmHolidayStartTime__c,pmHolidayEndTime:o.PatternId__r.PmHolidayEndTime__c,useDiscretionary:o.PatternId__r.UseDiscretionary__c,igonreNightWork:o.PatternId__r.IgonreNightWork__c,range:o.PatternId__r.Range__c,order:o.Order__c||0,prohibitChangeExchangedWorkTime:o.PatternId__r.ProhibitChangeExchangedWorkTime__c,prohibitChangeHolidayWorkTime:o.PatternId__r.ProhibitChangeHolidayWorkTime__c,
prohibitChangeWorkTime:o.PatternId__r.ProhibitChangeWorkTime__c,enableRestTimeShift:o.PatternId__r.EnableRestTimeShift__c,workTimeChangesWithShift:o.PatternId__r.WorkTimeChangesWithShift__c,disableCoreTime:o.PatternId__r.DisableCoreTime__c,useHalfHolidayRestTime:o.PatternId__r.UseHalfHolidayRestTime__c,amHolidayRestTimes:teasp.util.extractTimes(o.PatternId__r.AmHolidayRestTimes__c),
pmHolidayRestTimes:teasp.util.extractTimes(o.PatternId__r.PmHolidayRestTimes__c)})}return t=t.sort(function(e,t){return e.order-t.order})},teasp.logic.convert.convEmpTypeHolidayObjs=function(e){teasp.logic.convert.excludeNameSpace(e);for(var t=[],a=0;a<e.length;a++){var o=e[a];t.push({id:o.HolidayId__r.Id,name:o.HolidayId__r.Name,type:o.HolidayId__r.Type__c,range:o.HolidayId__r.Range__c,
description:o.HolidayId__r.Description__c,isWorking:o.HolidayId__r.IsWorking__c,yuqSpend:o.HolidayId__r.YuqSpend__c,plannedHolida:o.HolidayId__r.PlannedHoliday__c,managed:o.HolidayId__r.Managed__c,manageName:o.HolidayId__r.ManageName__c,displayDaysOnCalendar:o.HolidayId__r.DisplayDaysOnCalendar__c,yuqSpend:o.HolidayId__r.YuqSpend__c,config:dojo.fromJson(o.HolidayId__r.Config__c||"{}"),
timeUnit:o.HolidayId__r.TimeUnit__c,order:o.Order__c||0})}return t=t.sort(function(e,t){return e.order-t.order})},teasp.logic.convert.convCommuterPasses=function(e){teasp.logic.convert.excludeNameSpace(e);for(var t=[],a=0;a<e.length;a++){var o=e[a];t.push({id:o.Id,name:o.Name,routeCode:o.RouteCode__c,routeDescription:o.RouteDescription__c,passFare:o.PassFare__c,passPeriod:o.PassPeriod__c,
startDate:teasp.logic.convert.valDate(o.StartDate__c),note:o.Note__c,status:o.Status__c})}return t},teasp.logic.convert.convApplySteps=function(e){teasp.logic.convert.excludeNameSpace(e);for(var t=[],a=0;a<e.length;a++){var o,s=e[a];s.StepStatus&&"noresponse"==s.StepStatus.toLowerCase()||(o=teasp.util.date.longToDate(s.CreatedDate,1),t.push({applyId:s.ProcessInstance.TargetObjectId,actorName:s.Actor.Name,
createdDate:teasp.util.date.formatDateTime(o),stepStatus:teasp.constant.getStepStatus(s.StepStatus),comments:s.Comments}))}return t},teasp.logic.convert.convEmpMonthObj=function(e){if(e.length<=0)return null;teasp.logic.convert.excludeNameSpace(e);e=e[0];return{id:e.Id,lastModifiedDate:e.LastModifiedDate,startDate:e.StartDate__c,endDate:e.EndDate__c,configId:e.ConfigId__c,empApplyId:e.EmpApplyId__c,
absentCount:e.AbsentCount__c,amountTime:e.AmountTime__c,averageEndTime:e.AverageEndTime__c,averageStartTime:e.AverageStartTime__c,daiqHolidayCount:e.DaiqHolidayCount__c,earlyCount:e.EarlyCount__c,earlyLostTime:e.EarlyLostTime__c,earlyTime:e.EarlyTime__c,holidayDayTime:e.HolidayDayTime__c,holidayNightTime:e.HolidayNightTime__c,lateCount:e.LateCount__c,lateLostTime:e.LateLostTime__c,lateTime:e.LateTime__c,
legalWorkTime:e.LegalWorkTime__c,lostTime:e.LostTime__c,paidHolidayCount:e.PaidHolidayCount__c,paidRestTime:e.PaidRestTime__c,plannedHolidayCount:e.PlannedHolidayCount__c,privateCount:e.PrivateCount__c,privateInnerCount:e.PrivateInnerCount__c,privateInnerLostTime:e.PrivateInnerLostTime__c,privateInnerTime:e.PrivateInnerTime__c,privateOuterTime:e.PrivateOuterTime__c,totalWorkOverCount36:e.TotalWorkOverCount36__c,
totalWorkOverTime36:e.TotalWorkOverTime36__c,weekDayDayLegalExtTime:e.WeekDayDayLegalExtTime__c,weekDayDayLegalFixTime:e.WeekDayDayLegalFixTime__c,weekDayDayLegalOutTime:e.WeekDayDayLegalOutTime__c,weekDayNightLegalExtTime:e.WeekDayNightLegalExtTime__c,weekDayNightLegalFixTime:e.WeekDayNightLegalFixTime__c,weekDayNightLegalOutTime:e.WeekDayNightLegalOutTime__c,weekEndDayLegalOutTime:e.WeekEndDayLegalOutTime__c,
weekEndDayLegalTime:e.WeekEndDayLegalTime__c,weekEndNightLegalOutTime:e.WeekEndNightLegalOutTime__c,weekEndNightLegalTime:e.WeekEndNightLegalTime__c,workAwayTime:e.WorkAwayTime__c,workChargeTime:e.WorkChargeTime__c,workFixedDay:e.WorkFixedDay__c,workFixedTime:e.WorkFixedTime__c,workHolidayCount:e.WorkHolidayCount__c,workLegalHolidayCount:e.WorkLegalHolidayCount__c,workLegalOutOverTime:e.WorkLegalOutOverTime__c,
workLegalOverTime:e.WorkLegalOverTime__c,workNetTime:e.WorkNetTime__c,workOffTime:e.WorkOffTime__c,workOver40perWeek:e.WorkOver40perWeek__c,workOver45Time:e.WorkOver45Time__c,workOver60Time:e.WorkOver60Time__c,workPublicHolidayCount:e.WorkPublicHolidayCount__c,workRealDay:e.WorkRealDay__c,workRealTime:e.WorkRealTime__c,workWholeTime:e.WorkWholeTime__c}},teasp.logic.convert.convEmpYuqObj=function(e){
teasp.logic.convert.excludeNameSpace(e);for(var t=[],a=0;a<e.length;a++){var o=e[a],o={id:o.Id,name:o.Name,createdDate:teasp.logic.convert.valDateTime(o.CreatedDate),lastModifiedDate:teasp.logic.convert.valDateTime(o.LastModifiedDate),systemModstamp:teasp.logic.convert.valDateTime(o.SystemModstamp),date:teasp.logic.convert.valDate(o.Date__c),subject:o.Subject__c,startDate:teasp.logic.convert.valDate(o.StartDate__c),
limitDate:teasp.logic.convert.valDate(o.LimitDate__c),baseTime:o.BaseTime__c,autoFlag:o.AutoFlag__c||"(null)",batchId:o.BatchId__c||"(null)",empApplyId:o.EmpApplyId__c||"(null)",lostFlag:o.LostFlag__c||"(null)",oldNextYuqProvideDate:teasp.logic.convert.valDate(o.oldNextYuqProvideDate__c),provideDay:o.ProvideDay__c||"(null)",spendDay:o.SpendDay__c||"(null)",totalTime:o.TotalTime__c||"(null)",
tempFlag:o.TempFlag__c||"(null)",timeUnit:o.TimeUnit__c||"(null)"};t.push(o)}return t},teasp.logic.convert.convEmpYuqDetailObj=function(e){teasp.logic.convert.excludeNameSpace(e);for(var t=[],a=0;a<e.length;a++){var o=e[a],o={id:o.Id,name:o.Name,createdDate:teasp.logic.convert.valDateTime(o.CreatedDate),lastModifiedDate:teasp.logic.convert.valDateTime(o.LastModifiedDate),
systemModstamp:teasp.logic.convert.valDateTime(o.SystemModstamp),empYuqId:o.EmpYuqId__c,groupId:o.GroupId__c,days:o.Days__c,provideDays:o.ProvideDays__c,spendDays:o.SpendDays__c,time:o.Time__c,parent:o.EmpYuqId__r?{id:o.EmpYuqId__c,date:teasp.logic.convert.valDate(o.EmpYuqId__r.Date__c),subject:o.EmpYuqId__r.Subject__c,startDate:teasp.logic.convert.valDate(o.EmpYuqId__r.StartDate__c),
limitDate:teasp.logic.convert.valDate(o.EmpYuqId__r.LimitDate__c),baseTime:o.EmpYuqId__r.BaseTime__c,empApplyId:o.EmpYuqId__r.EmpApplyId__c||"(null)",lostFlag:o.EmpYuqId__r.LostFlag__c||"(null)",totalTime:o.EmpYuqId__r.TotalTime__c||"(null)"}:null};t.push(o)}return t},teasp.logic.convert.filterStatus=function(e,t){return t&&"確定取消"==e?"申請取消":"却下済み"==e?"却下":e},teasp.logic.convert.getStatusType=function(e){
return"承認待ち"==e?teasp.constant.getDisplayStatus("申請済み"):teasp.constant.getDisplayStatus(e)},teasp.logic.convert.convMixApplySteps=function(e,t,a){teasp.logic.convert.excludeNameSpace(e);var o=[];if(e.steps)for(var s=0;s<e.steps.length;s++){var i=e.steps[s];if(!i.StepStatus||"noresponse"!=i.StepStatus.toLowerCase()){var n=i.CreatedDate||i.LastModifiedDate,r=teasp.util.date.longToDate(n,1),
l=i.ProcessInstance?i.ProcessInstance.TargetObjectId:i.Id;if(o.push({applyId:l,actorName:i.StepStatus&&"noresponse"==i.StepStatus.toLowerCase()&&i.OriginalActor?i.OriginalActor.Name:i.Actor?i.Actor.Name:i.LastModifiedBy?i.LastModifiedBy.Name:"",createdDate:teasp.util.date.formatDateTime(r),createdDateN:n,stepStatus:i.StepStatus?teasp.constant.getStepStatus(i.StepStatus):teasp.logic.convert.getStatusType(
teasp.logic.convert.filterStatus(i.Status__c,a)),statusType:teasp.logic.convert.getStatusType(i.StepStatus?teasp.constant.getStepStatus(i.StepStatus):teasp.logic.convert.filterStatus(i.Status__c,a)),stepType:i.StepStatus?0:1,comments:i.Comments||i.Note__c||""}),i.Log__c&&0<i.Log__c.length)for(var p=dojo.fromJson("["+i.Log__c+"]"),d=0;d<p.length;d++){var c=p[d];c&&o.push({applyId:l,actorName:c.actorName,
createdDate:c.createdDate,createdDateN:teasp.util.date.parseDate(c.createdDate).getTime(),stepStatus:teasp.logic.convert.filterStatus(c.stepStatus,a),statusType:teasp.logic.convert.getStatusType(c.stepStatus),stepType:1,comments:c.comments})}}}return o=o.sort(function(e,t){return e.createdDateN==t.createdDateN?e.actorName==t.actorName?e.stepType-t.stepType:e.actorName<t.actorName?-1:1:e.createdDateN-t.createdDateN}),
t?{steps:teasp.logic.convert.mergeApplySteps(o),items:e.items||[]}:o},teasp.logic.convert.mergeApplySteps=function(e){for(var t,a=e,o={},s=0;s<a.length;s++)(i=(i=o[(p=a[s]).applyId])||(o[p.applyId]=[])).push(p);for(t in o){for(var i=o[t],n=1,r=1,l=null,s=0;s<i.length;s++){var p=i[s];l&&l.statusType!=p.statusType&&n++,p._cn=n,p._ix=r++,l=p}for(i=i.sort(function(e,t){
return e._cn==t._cn?e.stepType==t.stepType?e._ix-t._ix:e.stepType-t.stepType:e._cn-t._cn}),l=null,s=0;s<i.length;s++){p=i[s];!l||l.statusType!=p.statusType||l.actorName!=p.actorName&&l.stepType==p.stepType?p.stepStatus==teasp.message.getLabel("notFix_label")&&(p._none=!0):p._dupl=!0,l=p}}for(s=a.length-1;0<=s;s--)(a[s]._dupl||a[s]._none)&&a.splice(s,1);return a},teasp.logic.convert.convRejectApplyList=function(e){
teasp.logic.convert.excludeNameSpace(e);for(var t=[],a=0;a<e.rejectEmpApplys.length;a++){var o=e.rejectEmpApplys[a];t.push({id:o.Id,objectType:0,status:o.Status__c,applyType:o.ApplyType__c,yearMonth:o.YearMonth__c,subNo:o.AtkEmpMonthR1__r&&o.AtkEmpMonthR1__r.length?o.AtkEmpMonthR1__r[0].SubNo__c:null,holidayId:o.HolidayId__c,directFlag:o.DirectFlag__c,entered:o.Entered__c,
yuqSpend:!!o.HolidayId__r&&o.HolidayId__r.YuqSpend__c,managed:!!o.HolidayId__r&&o.HolidayId__r.Managed__c,manageName:o.HolidayId__r?o.HolidayId__r.ManageName__c:null,applyTime:teasp.logic.convert.valDateTime(o.ApplyTime__c),rejectTime:teasp.logic.convert.valDateTimeBiggest(o.ProcessSteps||[],"CreatedDate"),startDate:teasp.logic.convert.valDate((o.AtkEmpMonthR1__r&&o.AtkEmpMonthR1__r.length?o.AtkEmpMonthR1__r[0]:o
).StartDate__c),endDate:teasp.logic.convert.valDate((o.AtkEmpMonthR1__r&&o.AtkEmpMonthR1__r.length?o.AtkEmpMonthR1__r[0]:o).EndDate__c)})}for(a=0;a<e.rejectExpApplys.length;a++){o=e.rejectExpApplys[a];t.push({id:o.Id,objectType:1,status:o.Status__c,applyTime:teasp.logic.convert.valDateTime(o.ApplyTime__c),rejectTime:teasp.logic.convert.valDateTimeBiggest(o.ProcessSteps||[],"CreatedDate"),expApplyNo:o.ExpApplyNo__c})}
for(a=0;a<e.rejectJobApplys.length;a++){o=e.rejectJobApplys[a];t.push({id:o.Id,objectType:2,status:o.Status__c,yearMonth:o.YearMonth__c,subNo:o.SubNo__c,applyTime:teasp.logic.convert.valDateTime(o.ApplyTime__c),rejectTime:teasp.logic.convert.valDateTimeBiggest(o.ProcessSteps||[],"CreatedDate"),startDate:teasp.logic.convert.valDate(o.StartDate__c),endDate:teasp.logic.convert.valDate(o.EndDate__c)})}return t=t.sort(
function(e,t){return e.rejectTime<t.rejectTime?1:e.rejectTime>t.rejectTime?-1:0})},teasp.logic.convert.convCancelApplyList=function(e){teasp.logic.convert.excludeNameSpace(e);for(var t=[],a=0;a<e.cancelHolidayApplys.length;a++){var o=e.cancelHolidayApplys[a];t.push({id:o.Id,objectType:0,status:o.Status__c,applyType:o.ApplyType__c,yearMonth:o.YearMonth__c,holidayId:o.HolidayId__c,directFlag:o.DirectFlag__c,
entered:o.Entered__c,yuqSpend:!!o.HolidayId__r&&o.HolidayId__r.YuqSpend__c,managed:!!o.HolidayId__r&&o.HolidayId__r.Managed__c,manageName:o.HolidayId__r?o.HolidayId__r.ManageName__c:null,applyTime:teasp.logic.convert.valDateTime(o.ApplyTime__c),startDate:teasp.logic.convert.valDate(o.StartDate__c),endDate:teasp.logic.convert.valDate(o.EndDate__c)})}return t},teasp.logic.convert.convSumTimeObjs=function(e){
return teasp.logic.convert.excludeNameSpace(e),{periodWorkTime:e.periodWorkTime,periodDayCount:e.periodDayCount,carryforwardMap:e.carryforwardMap,realWorkTimeWoLHMap:e.realWorkTimeWoLHMap,amountTimeMap:e.amountTimeMap,settlementTimeMap:e.settlementTimeMap,totalWorkOverTime36:e.periodWorkOverTime36,totalWorkOverCount36:e.periodWorkOverCount36,quartWorkOverTime36:e.quartWorkOverTime36}},
teasp.logic.convert.convExpApplyHistory=function(e){teasp.logic.convert.excludeNameSpace(e);for(var t=[],a=0;a<e.length;a++){var o=e[a];t.push({id:o.Id,expApplyNo:o.ExpApplyNo__c,name:o.Name,deptId:o.DeptId__c,deptCode:o.DeptCode__c||"",deptName:o.DeptName__c||"",totalCost:o.TotalCost__c,count:o.Count__c,applyTime:teasp.logic.convert.valDateTime(o.ApplyTime__c),startDate:teasp.logic.convert.valDate(o.StartDate__c),
endDate:teasp.logic.convert.valDate(o.EndDate__c),status:o.Status__c,expDetails:o.EmpExp__r||[]})}return t=t.sort(function(e,t){return e.id<t.id?1:e.id>t.id?-1:0})},teasp.logic.convert.convHolidayHistoryObjs=function(e){return{startDate:e.startDate,empApplys:teasp.logic.convert.convEmpApplyObjs(e.empApplys),empDays:teasp.logic.convert.convEmpDayObjs(e.empDays),empYuqs:teasp.logic.convert.convEmpYuqObj(e.empYuqs)}},
teasp.logic.convert.convWorkNoteList=function(e){teasp.logic.convert.excludeNameSpace(e);for(var t={},a=0;a<e.length;a++){var o=e[a];t[teasp.logic.convert.valDate(o.Date__c)]={workNetTime:o.WorkNetTime__c,workRealTime:o.WorkRealTime__c,startTime:o.StartTime__c,endTime:o.EndTime__c,workNote:o.WorkNote__c,dailyApplyStatus:o.DailyApplyId__r&&o.DailyApplyId__r.Status__c||null,
monthApplyStatus:o.EmpMonthId__r&&o.EmpMonthId__r.EmpApplyId__r&&o.EmpMonthId__r.EmpApplyId__r.Status__c||null}}return t},teasp.logic.convert.convDeptList=function(e){teasp.logic.convert.excludeNameSpace(e);for(var t=[],a=0;a<e.length;a++){var o=e[a];t.push({id:o.Id,deptCode:o.DeptCode__c||null,name:o.Name,parentId:o.ParentId__c||null,startDate:teasp.logic.convert.valDate(o.StartDate__c),
endDate:teasp.logic.convert.valDate(o.EndDate__c)})}return t},teasp.logic.convert.convDeptHist=function(e){teasp.logic.convert.excludeNameSpace(e);for(var t=e.empDeptHist||[],a=e.deptOwnHist||[],o=[],s=[],i=0;i<t.length;i++){var n=t[i];o.push({id:n.Id,deptId:n.DeptId__c||null,deptName:n.DeptId__r?n.DeptId__r.Name:null,deptCode:n.DeptId__r?n.DeptId__r.DeptCode__c:null,startDate:teasp.logic.convert.valDate(
n.StartDate__c),endDate:teasp.logic.convert.valDate(n.EndDate__c),startMonth:teasp.logic.convert.valNumber(n.StartMonth__c),endMonth:teasp.logic.convert.valNumber(n.EndMonth__c)})}for(i=0;i<a.length;i++){n=a[i];s.push({id:null,deptId:n.Id||null,deptName:n.Name,deptCode:n.Code__c||null,startDate:teasp.logic.convert.valDate(n.StartDate__c),endDate:teasp.logic.convert.valDate(n.EndDate__c)})}return{empDeptHist:o,
deptOwnHist:s}},teasp.logic.convert.convEmpTypeInfo=function(e,t,a){if(!e)return null;teasp.logic.convert.excludeNameSpace(e);for(var o=e.empTypeHistory||[],s=e.empTypes||[],i=[],n={},r=0;r<s.length;r++){var l=s[r],l={empTypeId:l.Id||null,empTypeName:l.Name||"",configBase:{id:l.ConfigBaseId__r.Id,initialDayOfWeek:teasp.logic.convert.valNumber(l.ConfigBaseId__r.InitialDayOfWeek__c),
initialDateOfMonth:teasp.logic.convert.valNumber(l.ConfigBaseId__r.InitialDateOfMonth__c),markOfMonth:teasp.logic.convert.valNumber(l.ConfigBaseId__r.MarkOfMonth__c),initialDateOfYear:teasp.logic.convert.valNumber(l.ConfigBaseId__r.InitialDateOfYear__c),markOfYear:teasp.logic.convert.valNumber(l.ConfigBaseId__r.MarkOfYear__c)},daiqManage:{daiqLimit:l.DaiqLimit__c,daiqAllBorderTime:l.DaiqAllBorderTime__c,
daiqHalfBorderTime:l.DaiqHalfBorderTime__c,useDaiqLegalHoliday:l.UseDaiqLegalHoliday__c,useDaiqManage:l.UseDaiqManage__c,useDaiqReserve:l.UseDaiqReserve__c,useHalfDaiq:l.UseHalfDaiq__c,useRegulateHoliday:l.UseRegulateHoliday__c,noDaiqExchanged:l.NoDaiqExchanged__c},holidayStock:{enableStockHoliday:l.EnableStockHoliday__c,maxStockHoliday:l.MaxStockHoliday__c,maxStockHolidayPerYear:l.MaxStockHolidayPerYear__c}};
n[l.empTypeId]=l,i.push(l)}for(o=o.sort(function(e,t){return e.date<t.date?-1:e.date>t.date?1:0}),r=0;r<o.length;r++)o[r].empType=n[o[r].empTypeId]||null;return{ym:!a&&t||null,dt:a||null,empTypes:i,empTypeMap:n,empTypeHistory:o}},teasp.logic.convert.convConfigHistory=function(e){teasp.logic.convert.excludeNameSpace(e);for(var t=0;t<e.length;t++){var a=e[t];a.startDate=a.startDate?teasp.util.date.formatDate(
a.startDate):null,a.endDate=a.endDate?teasp.util.date.formatDate(a.endDate):null}return e},teasp.logic.convert.convApprover=function(e){return e&&teasp.logic.convert.excludeNameSpace(e),e},teasp.logic.convert.convFormatDate=function(e){var t=[];if(e&&0<e.length)for(var a=0;a<e.length;a++)""!=e[a].trim()&&t.push(teasp.util.date.formatDate(e[a]));return t},teasp.logic.convert.convValidList=function(e){var t=[];if(
e&&0<e.length)for(var a=0;a<e.length;a++)""!=e[a].trim()&&t.push(e[a]);return t},teasp.logic.convert.convOverFlag=function(e){return e?7==e?10:8==e?14:e:0},teasp.logic.convert.valArray=function(e,t,a){if(null==e)return[];e=e.split(t||",");return a?a(e):e},teasp.logic.convert.valNumber=function(e,t){return null==e?t:"string"==typeof e?parseInt(e,10):e},teasp.logic.convert.valFloat=function(e,t){
return null==e?t:"string"==typeof e?parseFloat(e):e},teasp.logic.convert.valDate=function(e){return null==e?null:teasp.util.date.formatDate(teasp.util.date.longToDate(e,1))},teasp.logic.convert.valDateTime=function(e){return null==e?null:teasp.util.date.formatDateTime(teasp.util.date.longToDate(e,1))},teasp.logic.convert.valDateTimeObj=function(e){return null==e?null:teasp.util.date.longToDate(e,1)},
teasp.logic.convert.valDateTimeBiggest=function(e,t){for(var a=0,o=0;o<e.length;o++){var s=e[o];a<s[t]&&(a=s[t])}var i=teasp.util.date.longToDate(a,1);return teasp.util.date.formatDateTime(i)},teasp.logic.convert.excludeNameSpace=function(e){var t,a="teamspirit__";if(is_array(e))for(var o=0;o<e.length;o++)teasp.logic.convert.excludeNameSpace(e[o]);else for(var s in e)e.hasOwnProperty(s)&&(s.substring(0,a.length)==a?(
e[t=s.substring(a.length)]=dojo.clone(e[s]),delete e[s],"object"==typeof e[t]&&teasp.logic.convert.excludeNameSpace(e[t])):"object"==typeof e[s]&&teasp.logic.convert.excludeNameSpace(e[s]))},teasp.logic.convert.excludeTSEMNameSpace=function(e){var t,a="TSEM__";if(is_array(e))for(var o=0;o<e.length;o++)teasp.logic.convert.excludeTSEMNameSpace(e[o]);else for(var s in e)e.hasOwnProperty(s)&&(s.substring(0,a.length)==a?(
e[t=s.substring(a.length)]=dojo.clone(e[s]),delete e[s],"object"==typeof e[t]&&teasp.logic.convert.excludeTSEMNameSpace(e[t])):"object"==typeof e[s]&&teasp.logic.convert.excludeTSEMNameSpace(e[s]))},teasp.logic.convert.excludeCopyTag=function(e){return e&&e.length>teasp.constant.COPYTAG.length&&e.substring(e.length-teasp.constant.COPYTAG.length)==teasp.constant.COPYTAG?e.substring(0,
e.length-teasp.constant.COPYTAG.length):e},teasp.logic.convert.convRequestGroups=function(e){teasp.logic.convert.excludeNameSpace(e),teasp.logic.convert.excludeTSEMNameSpace(e);for(var t=[],a=0;a<e.length;a++){var o=e[a],s={id:o.Id,name:o.Name,events:[]};if(o.TemRequestEventMatchings__r)for(var i=0;i<o.TemRequestEventMatchings__r.length;i++){var n=o.TemRequestEventMatchings__r[i],n={id:n.EventId__c,
groupId:n.GroupId__c,name:n.EventId__r.Name};s.events.push(n)}t.push(s)}return t},teasp.logic.convert.convRequestEvents=function(e){teasp.logic.convert.excludeNameSpace(e),teasp.logic.convert.excludeTSEMNameSpace(e);for(var t={},a=0;a<e.length;a++){var o=e[a],s={id:o.Id,flows:[]};if(o.TemRequestFlowMatchings__r)for(var i=0;i<o.TemRequestFlowMatchings__r.length;i++){var n=o.TemRequestFlowMatchings__r[i],n={
id:n.FlowId__c,eventId:n.EventId__c,isRequired:n.IsRequired__c,name:n.FlowId__r.Name,isRead:n.FlowId__r.IsRead__c,isDefaultSetting:n.FlowId__r.IsDefaultSetting__c};s.flows.push(n)}t[s.id]=s}return t},teasp.logic.convert.convEmployeeMaster=function(e){return teasp.logic.convert.excludeNameSpace(e),teasp.logic.convert.excludeTSEMNameSpace(e),e},teasp.logic.convert.convRequestList=function(e){
teasp.logic.convert.excludeNameSpace(e),teasp.logic.convert.excludeTSEMNameSpace(e);for(var t=[],a=0;a<e.length;a++){var o=e[a],s=teasp.logic.convert.valDateTime(o.ApplyDatetime__c),i=(o.TSEM||o).Status__c,n=(o.TSEM&&null==o.ApplyDatetime__c&&(teasp.constant.STATUS_FIX.contains(i)||teasp.constant.STATUS_REJECTS.contains(i))&&o.TSEM.ApplyDatetime__c&&(n=moment(o.TSEM.ApplyDatetime__c.replace("T"," ")),
s=teasp.util.date.formatDateTime(n.toDate(),"SLA-HM",!0)),{id:o.Id,name:o.Name,applyDatetime:s,status:i,isHRMversion1:o.isHRMversion1});t.push(n)}return t},teasp.logic.convert.convRequestObj=function(e){return teasp.logic.convert.excludeNameSpace(e),teasp.logic.convert.excludeTSEMNameSpace(e),e},teasp.logic.convert.convTSEMApplySteps=function(e){teasp.logic.convert.excludeNameSpace(e),
teasp.logic.convert.excludeTSEMNameSpace(e);for(var t=[],a=0;a<e.length;a++){var o,s=e[a];s.StepStatus&&"noresponse"==s.StepStatus.toLowerCase()||(o=moment(s.CreatedDate),t.push({applyId:s.ProcessInstance.TargetObjectId,actorName:s.Actor.Name,createdDateS:o.isValid()?teasp.util.date.formatDateTime(o.toDate(),"SLA-HM",!0):"-",stepStatus:teasp.constant.getStepStatus(s.StepStatus),comments:s.Comments}))}return t},
teasp.provide("teasp.logic.EmpTime"),teasp.logic.YuqDays=function(e,t){this.mix=!0,this.setValue(e||0,t||0)},teasp.logic.YuqDays.prototype.setValue=function(e,t){this.baseTime=e;e=this.baseTime?this.baseTime/2:0;this.days=e&&e<=t?Math.floor(t/e)/2:0,this.minutes=e?t%e:0,this.minutes&&0<this.minutes%60&&0<this.days&&0<e%60&&(this.days-=.5,this.minutes+=e)},teasp.logic.YuqDays.prototype.append=function(e){
0==this.baseTime&&(this.baseTime=e.getBaseTime()),this.mix&&this.baseTime==e.getBaseTime()?this.setValue(this.baseTime,(this.days+e.getDays())*this.baseTime+(this.minutes+e.getMinutes())):(this.mix=!1,this.days+=e.getDays(),this.minutes+=e.getMinutes())},teasp.logic.YuqDays.prototype.subtract=function(e){this.baseTime&&(e=this.getAllMinutes()-e.calcMinutesByBaseTime(this.baseTime),this.setValue(this.baseTime,
e=e<0?0:e))},teasp.logic.YuqDays.prototype.calcMinutesByBaseTime=function(e){return e*this.days+this.minutes},teasp.logic.YuqDays.prototype.format=function(){var e=this.days,t=this.minutes;return e||t?t?e?e+"+"+teasp.util.time.timeValue(t):teasp.util.time.timeValue(t):""+e:"0"},teasp.logic.YuqDays.prototype.getDays=function(){return this.days},teasp.logic.YuqDays.prototype.getMinutes=function(){return this.minutes},
teasp.logic.YuqDays.prototype.getHours=function(){return this.minutes?this.minutes/60:0},teasp.logic.YuqDays.prototype.getBaseTime=function(){return this.baseTime},teasp.logic.YuqDays.prototype.getAllMinutes=function(){return this.calcMinutesByBaseTime(this.baseTime)},teasp.provide("teasp.data.EmpApply"),teasp.data.EmpApply=function(e){this.apply=e},teasp.data.EmpApply.prototype.getId=function(){return this.apply.id}
,teasp.data.EmpApply.prototype.getApplyType=function(){return this.apply.applyType},teasp.data.EmpApply.prototype.getDisplayApplyType=function(){return teasp.data.EmpApply.getDisplayApplyType(this.apply.applyType)},teasp.data.EmpApply.getDisplayApplyType=function(e){switch(e){case teasp.constant.APPLY_TYPE_HOLIDAY:return teasp.message.getLabel("applyHoliday_label");case teasp.constant.APPLY_TYPE_EXCHANGE:
return teasp.message.getLabel("applyExchange_label");case teasp.constant.APPLY_TYPE_ZANGYO:return teasp.message.getLabel("applyZangyo_label");case teasp.constant.APPLY_TYPE_EARLYSTART:return teasp.message.getLabel("applyEarlyWork_label");case teasp.constant.APPLY_TYPE_KYUSHTU:return teasp.message.getLabel("applyHolidayWork_label");case teasp.constant.APPLY_TYPE_PATTERNS:return teasp.message.getLabel(
"applyPatternS_label");case teasp.constant.APPLY_TYPE_PATTERNL:return teasp.message.getLabel("applyPatternL_label");case teasp.constant.APPLY_TYPE_LATESTART:return teasp.message.getLabel("applyLateStart_label");case teasp.constant.APPLY_TYPE_EARLYEND:return teasp.message.getLabel("applyEarlyEnd_label");case teasp.constant.APPLY_TYPE_MONTHLY:return teasp.message.getLabel("fixMonth_caption");
case teasp.constant.APPLY_TYPE_DAILY:return teasp.message.getLabel("applyDaily_label");case teasp.constant.APPLY_TYPE_REVISETIME:return teasp.message.getLabel("applyReviseTime_label");case teasp.constant.APPLY_TYPE_DIRECT:return teasp.message.getLabel("tk10004650");case teasp.constant.APPLY_TYPE_SHIFTCHANGE:return teasp.message.getLabel("tf10011260");case teasp.constant.APPLY_TYPE_MONTHLYOVERTIME:
return teasp.message.getLabel("mo00000001")}return e},teasp.data.EmpApply.prototype.getHolidayName=function(){return this.apply.holiday.name},teasp.data.EmpApply.prototype.isTimeHoliday=function(){return this.apply.holiday.range==teasp.constant.RANGE_TIME},teasp.data.EmpApply.prototype.getExchangeDate=function(){return this.apply.exchangeDate},teasp.data.EmpApply.prototype.getExchangePair=function(){
return teasp.message.getLabel("tm10001520",teasp.util.date.formatDate(this.apply.startDate,"SLA"),teasp.util.date.formatDate(this.apply.exchangeDate,"M/d"))},teasp.data.EmpApply.prototype.getPatternName=function(){return this.apply.pattern.name},teasp.data.EmpApply.prototype.getDateRange=function(){return teasp.util.date.formatDateRange(this.apply.startDate,this.apply.endDate,"SLA")},
teasp.data.EmpApply.prototype.getStartDate=function(){return this.apply.startDate},teasp.data.EmpApply.prototype.getEndDate=function(){return this.apply.endDate},teasp.data.EmpApply.prototype.getNote=function(){return this.apply.note||""},teasp.data.EmpApply.prototype.getContact=function(){return this.apply.contact||""},teasp.data.EmpApply.prototype.getApplyTime=function(){return teasp.util.date.formatDateTime(
this.apply.applyTime,"SLA-HM")},teasp.data.EmpApply.prototype.getStatus=function(){return this.apply.status||teasp.message.getLabel("notFix_label")},teasp.data.EmpApply.prototype.isApprove=function(){return teasp.constant.STATUS_APPROVES.contains(this.apply.status)},teasp.data.EmpApply.prototype.isReject=function(){return teasp.constant.STATUS_REJECTS.contains(this.apply.status)},
teasp.data.EmpApply.prototype.isRejectDone=function(){return teasp.constant.STATUS_REJECTDONE==this.apply.status},teasp.data.EmpApply.prototype.isClose=function(){return this.apply.close||!1},teasp.data.EmpApply.prototype.isCancel=function(){return teasp.constant.STATUS_CANCELS.contains(this.apply.status)},teasp.data.EmpApply.prototype.isApplyPatternS=function(){
return this.apply.applyType==teasp.constant.APPLY_TYPE_PATTERNS},teasp.data.EmpApply.prototype.isApplyPatternL=function(){return this.apply.applyType==teasp.constant.APPLY_TYPE_PATTERNL},teasp.data.EmpApply.prototype.isApplyHoliday=function(){return this.apply.applyType==teasp.constant.APPLY_TYPE_HOLIDAY},teasp.data.EmpApply.prototype.isApplyZangyo=function(){
return this.apply.applyType==teasp.constant.APPLY_TYPE_ZANGYO},teasp.data.EmpApply.prototype.isApplyExchange=function(){return this.apply.applyType==teasp.constant.APPLY_TYPE_EXCHANGE},teasp.data.EmpApply.prototype.isApplyShiftChange=function(){return this.apply.applyType==teasp.constant.APPLY_TYPE_SHIFTCHANGE},teasp.data.EmpApply.prototype.isApplyKyushtu=function(){
return this.apply.applyType==teasp.constant.APPLY_TYPE_KYUSHTU},teasp.data.EmpApply.prototype.getTimeRange=function(){var e=this.apply.startTime,t=this.apply.endTime;if("number"!=typeof e||"number"!=typeof t){if(!this.isApplyPatternS()&&!this.isApplyPatternL())return"";e=this.apply.pattern.stdStartTime,t=this.apply.pattern.stdEndTime}return teasp.message.getLabel("tm10003590",teasp.util.time.timeValue(e),
teasp.util.time.timeValue(t))},teasp.data.EmpApply.prototype.isOwnReason=function(){return this.apply.ownReason},teasp.data.EmpApply.prototype.getTreatDeduct=function(){return this.apply.treatDeduct},teasp.provide("teasp.data.EmpDay"),teasp.data.EmpDay=function(e,t){this.parent=e,this.dataObj=this.parent.getObj(),this.day="string"==typeof t?this.dataObj.days.hasOwnProperty(t
)?this.dataObj.days[t]:this.parent.getMonthDay(t):t},teasp.data.EmpDay.prototype.isValid=function(){return!(!this.day||!this.day.rack)},teasp.data.EmpDay.prototype.getObj=function(){return this.day},teasp.data.EmpDay.prototype.getKey=function(){return this.day.rack.key},teasp.data.EmpDay.prototype.getMonth=function(){return this.parent},teasp.data.EmpDay.prototype.getDayType=function(){return this.day.dayType},
teasp.data.EmpDay.prototype.getExplicDayType=function(){var e=this.day,t=(e=e.exchangeDate&&this.dataObj.days[e.exchangeDate]?this.dataObj.days[e.exchangeDate]:e).rack&&e.rack.validApplys||null;return t&&t.patternD?t.patternD.dayType:e.explicDayType},teasp.data.EmpDay.prototype.getDayNote=function(e){var t=this.day.note||"",a="",o=this.getEmpApplyByKey(teasp.constant.APPLY_KEY_DIRECT)||this.getEmpApplyByKey(
teasp.constant.APPLY_KEY_KYUSHTU);if(o&&o.travelTime&&this.day.date==o.startDate&&(a=teasp.message.getLabel("tk10004711",teasp.util.time.timeValue(o.travelTime))),e)return t?t+"\r\n"+a:a;o=this.day.rack.applyNotes||null,(o=o?o+"\r\n"+a:a)&&0<=(e=t.indexOf(o))&&(t=t.substring(0,e)+t.substring(e+o.length)),a=/^(?:\r?\n)(.+)$/.exec(t);return(o?o+"\r\n":"")+((t=a?a[1]:t)||"")},
teasp.data.EmpDay.prototype.setDayNote=function(e){this.day.note=e},teasp.data.EmpDay.prototype.getWorkNote=function(){return this.day.workNote||""},teasp.data.EmpDay.prototype.setWorkNote=function(e){this.day.workNote=e},teasp.data.EmpDay.prototype.getTimeCaution=function(){return this.day.deco.ct.note||""},teasp.data.EmpDay.prototype.getDayTitle=function(){return this.day.deco.title||""},
teasp.data.EmpDay.prototype.getDayIconClass=function(){return this.day.deco.iconClass||""},teasp.data.EmpDay.prototype.getTypicalEmpApply=function(){return this.day.rack.validApplys.showApply},teasp.data.EmpDay.prototype.getTimeTable=function(e){var t=this.day.timeTable||[];if(!e||!t.length)return t;var a=this.day.real&&this.day.real.blankSpan||[];if(!a.length)return t;for(var o=dojo.clone(t),s=o.length-1;0<=s;s--){
var i,n=o[s];n.type!=teasp.constant.REST_FIX||0<(i=teasp.util.time.rangeTime(n,a))&&(i==n.to-n.from?o.splice(s,1):(i=teasp.util.time.excludeRanges([n],a))&&0<i.length&&(n.from=i[0].from,n.to=i[0].to))}return o},teasp.data.EmpDay.prototype.getPattern=function(){return this.day.pattern},teasp.data.EmpDay.prototype.isInputTime=function(){
return this.day.deco?this.day.deco.ct.st||this.day.deco.ct.et:this.day.startTime||this.day.endTime},teasp.data.EmpDay.prototype.isPlannedHoliday=function(){return this.day.plannedHoliday||!1},teasp.data.EmpDay.prototype.isToday=function(){return 0==this.day.rack.todayDiff},teasp.data.EmpDay.prototype.isWorked=function(){return this.day.rack.worked},teasp.data.EmpDay.prototype.getHolidayFlag=function(){
return this.day.rack.holidayJoin?this.day.rack.holidayJoin.flag:0},teasp.data.EmpDay.prototype.isHolidayAll=function(){return 3==this.getHolidayFlag()},teasp.data.EmpDay.prototype.getFixStartTime=function(e){return e&&"number"==typeof this.day.rack.bdrStartTime?this.day.rack.bdrStartTime:this.day.rack.fixStartTime},teasp.data.EmpDay.prototype.getFixEndTime=function(e){
return e&&"number"==typeof this.day.rack.bdrEndTime?this.day.rack.bdrEndTime:this.day.rack.fixEndTime},teasp.data.EmpDay.prototype.getStartTimeJudge=function(e){return e?this.day.deco.ct.stan:this.day.deco.ct.st},teasp.data.EmpDay.prototype.getEndTimeJudge=function(e){return e?this.day.deco.ct.etan:this.day.deco.ct.et},teasp.data.EmpDay.prototype.getStartTimeEmboss=function(){return this.day.deco.ct.stan||""},
teasp.data.EmpDay.prototype.getEndTimeEmboss=function(){return this.day.deco.ct.etan||""},teasp.data.EmpDay.prototype.getFixRests=function(){return this.day.rack.fixRests||[]},teasp.data.EmpDay.prototype.getFreeRests=function(){return this.day.rack.freeRests||[]},teasp.data.EmpDay.prototype.getHourRests=function(){return this.day.rack.hourRests||[]},teasp.data.EmpDay.prototype.getPaidRests=function(){
return this.day.rack.paidRests||[]},teasp.data.EmpDay.prototype.getUnpaidRests=function(){return this.day.rack.unpaidRests||[]},teasp.data.EmpDay.prototype.getFixTime=function(){return this.day.rack.fixTime||0},teasp.data.EmpDay.prototype.getDayValueByKey=function(e){return this.day[e]},teasp.data.EmpDay.prototype.getDayTimeByKey=function(e,t,a){return this.parent.getDisplayTime(this.day.real[e],t,a)},
teasp.data.EmpDay.prototype.getDayIndexOfMonth=function(){return teasp.util.date.daysInRange(this.dataObj.month.startDate,this.day.date)-1},teasp.data.EmpDay.prototype.getTip=function(){return this.tip},teasp.data.EmpDay.prototype.setTip=function(e){this.tip=e},teasp.data.EmpDay.prototype.getEmpApplyByKey=function(e,t){if(!this.day.rack.validApplys)return null;var a=this.day.rack.validApplys[e];return is_array(a
)?0<a.length?a[0]:null:!a&&e==teasp.constant.APPLY_KEY_DAILY&&t?this.day.rack.validApplys.oldDailyFix||null:a||null},teasp.data.EmpDay.prototype.isExistApply=function(e){return!!this.day.rack&&(is_array(this.day.rack.validApplys[e])?0<this.day.rack.validApplys[e].length:!!this.day.rack.validApplys[e])},teasp.data.EmpDay.prototype.isMonthFix=function(){var e=this.parent.getEmpMonthByDate(this.getKey());
return e&&e.apply&&teasp.constant.STATUS_FIX.contains(e.apply.status)},teasp.data.EmpDay.prototype.isDailyFix=function(){return this.isMonthFix()||this.isExistApply(teasp.constant.APPLY_KEY_DAILY)},teasp.data.EmpDay.prototype.getApplyStatus=function(e){return this.day.rack?is_array(this.day.rack.validApplys[e])?0<(t=this.day.rack.validApplys[e]
).length?t[0].status:"":this.day.rack.validApplys[e]?this.day.rack.validApplys[e].status:"":"";var t},teasp.data.EmpDay.prototype.getTimeHolidayApply=function(){return this.day.rack.validApplys.holidayTime},teasp.data.EmpDay.prototype.getEmpApplyList=function(e){if("ALL"==e)return this.day.rack.allApplys||[];if("ALL_WAIT"==e)return this.day.rack.validApplys.waiting||[];if("REJECT_WAIT"==e){for(
var t=this.day.rack.validApplys.waiting,a=[],o=0;o<t.length;o++){var s=t[o];teasp.constant.STATUS_REJECTS.contains(s.status)&&a.push(s)}return a}var i,n=this.day.rack.validApplys,a=[];for(i in n)n.hasOwnProperty(i)&&n[i]&&"showApply"!=i&&"waiting"!=i&&"rejects"!=i&&(is_array(n[i])?a=a.concat(n[i]):n[i]&&a.push(n[i]));return a},teasp.data.EmpDay.prototype.getHolidayExcludes=function(){
return this.day.rack.holidayExcludes},teasp.data.EmpDay.prototype.isShowApply=function(e){return!0},teasp.data.EmpDay.prototype.setEmpApplySteps=function(e,t){for(var a=0;a<this.day.rack.allApplys.length;a++){var o=this.day.rack.allApplys[a];o.steps=[];for(var s=0;s<e.length;s++)teasp.util.equalId(o.id,e[s].applyId)&&o.steps.push(e[s]);for(var i=t||[],s=0;s<i.length;s++)if(i[s].ProcessInstance.TargetObjectId==o.id){
o.processInstanceWorkItemId=i[s].Id;break}}},teasp.data.EmpDay.prototype.isInputable=function(e){return!!((this.day.dayType==teasp.constant.DAY_TYPE_NORMAL||this.day.autoLH)&&(!this.day.rack||!this.day.rack.holidayJoin||3!=this.day.rack.holidayJoin.flag)&&!this.day.plannedHoliday||!e&&(this.day.deco.ct.st||this.day.deco.ct.et
)||e&&this.day.workFlag||this.day.rack&&this.day.rack.validApplys&&this.day.rack.validApplys.kyushtu&&0<this.day.rack.validApplys.kyushtu.length&&(!this.parent.isProhibitInputTimeUntilApproved()||teasp.constant.STATUS_APPROVES.contains(this.day.rack.validApplys.kyushtu[0].status)))},teasp.data.EmpDay.prototype.isInputableEx=function(){var e=this.getEmpApplyByKey(teasp.constant.APPLY_KEY_EXCHANGES),
t=this.getEmpApplyByKey(teasp.constant.APPLY_KEY_EXCHANGEE),a=e||t;if(!a&&!this.isHoliday()&&!this.day.plannedHoliday)return{applyName:null,inputable:!0};var o=this.getEmpApplyByKey(teasp.constant.APPLY_KEY_KYUSHTU);return e&&!teasp.constant.STATUS_APPROVES.contains(e.status)||t&&!teasp.constant.STATUS_APPROVES.contains(t.status)?{applyName:a.applyType,inputable:!1}:o&&!teasp.constant.STATUS_APPROVES.contains(
o.status)?{applyName:o.applyType,inputable:!1}:{applyName:null,inputable:!0}},teasp.data.EmpDay.prototype.isHoliday=function(){return!((this.day.dayType==teasp.constant.DAY_TYPE_NORMAL||this.day.autoLH)&&!this.day.rack.isOrgHoliday)},teasp.data.EmpDay.prototype.canSelectHoliday=function(e){return!this.day.interim&&(!(!e&&(this.isHoliday()||this.day.plannedHoliday))&&(!this.getEmpApplyByKey(
teasp.constant.APPLY_KEY_KYUSHTU)&&(!(!this.isHoliday()&&this.day.plannedHoliday)&&3!=(this.day.rack.holidayJoin?this.day.rack.holidayJoin.flag:0))))},teasp.data.EmpDay.prototype.canSelectZangyo=function(e){return!this.day.interim&&(3!=(this.day.rack.holidayJoin?this.day.rack.holidayJoin.flag:0)&&(!(!(e||4&this.parent.getUseOverTimeFlag())&&this.isExistApply(teasp.constant.APPLY_KEY_ZANGYO))&&(!(e&&!(
4&this.parent.getUseEarlyWorkFlag())&&this.isExistApply(teasp.constant.APPLY_KEY_EARLYSTART))&&(!this.isHoliday()&&!this.day.plannedHoliday||0<this.day.rack.validApplys.kyushtu.length))))},teasp.data.EmpDay.prototype.isReliableDate=function(){if(this.parent.isProhibitInputTimeUntilApproved()){var e=this.getEmpApplyByKey(teasp.constant.APPLY_KEY_EXCHANGES),t=this.getEmpApplyByKey(teasp.constant.APPLY_KEY_EXCHANGEE);
if(e&&!teasp.constant.STATUS_APPROVES.contains(e.status)||t&&!teasp.constant.STATUS_APPROVES.contains(t.status))return!1}return!0},teasp.data.EmpDay.prototype.canSelectKyushtu=function(){return!this.day.interim&&(!(!this.isHoliday()&&!this.day.plannedHoliday)&&(!(!(4&this.parent.getUseHolidayWorkFlag())&&this.isExistApply(teasp.constant.APPLY_KEY_KYUSHTU))&&(3!=(
this.day.rack.holidayJoin?this.day.rack.holidayJoin.flag:0)&&this.isReliableDate())))},teasp.data.EmpDay.prototype.canSelectExchange=function(){if(this.day.interim)return!1;if(this.day.plannedHoliday)return!1;if(this.day.rack.validApplys.exchangeS||this.day.rack.validApplys.direct)return!1;var e=this.day.rack.validApplys.exchangeE;if(e&&!teasp.constant.STATUS_APPROVES.contains(e.status))return!1;
var e=this.day.rack.holidayJoin?this.day.rack.holidayJoin.flag:0,t=this.day.rack.validApplys.holidayTime;if(this.isHoliday()){if(e&&this.day.rack.holidayJoin.displayDaysOnCalendar)return!1}else if(e||t&&0<t.length)return!1;return(!this.isHoliday()||!this.getEmpApplyByKey(teasp.constant.APPLY_KEY_KYUSHTU))&&this.isReliableDate()},teasp.data.EmpDay.prototype.canSelectPatternL=function(){return!this.isHoliday()&&(!(
this.day.plannedHoliday&&!this.day.rack.validApplys.kyushtu.length)&&0==(this.day.rack.holidayJoin?this.day.rack.holidayJoin.flag:0))},teasp.data.EmpDay.prototype.canSelectPatternS=function(){return!(this.day.plannedHoliday&&!this.day.rack.validApplys.kyushtu.length)&&0==(this.day.rack.holidayJoin?this.day.rack.holidayJoin.flag:0)},teasp.data.EmpDay.prototype.canSelectLateStart=function(){return!this.day.interim&&(
3!=(this.day.rack.holidayJoin?this.day.rack.holidayJoin.flag:0)&&(!(this.getBorderTime().st<0)&&(!this.isExistApply(teasp.constant.APPLY_KEY_LATESTART)&&(!this.isHoliday()&&!this.day.plannedHoliday||(!(!this.day.plannedHoliday||!this.isExistApply(teasp.constant.APPLY_KEY_KYUSHTU))||!!this.parent.isRegulateHoliday(this.day.date))))))},teasp.data.EmpDay.prototype.canSelectEarlyEnd=function(){return!this.day.interim&&(
3!=(this.day.rack.holidayJoin?this.day.rack.holidayJoin.flag:0)&&(!(this.getBorderTime().et<0)&&(!this.isExistApply(teasp.constant.APPLY_KEY_EARLYEND)&&(!this.isHoliday()&&!this.day.plannedHoliday||(!(!this.day.plannedHoliday||!this.isExistApply(teasp.constant.APPLY_KEY_KYUSHTU))||!!this.parent.isRegulateHoliday(this.day.date))))))},teasp.data.EmpDay.prototype.canSelectDailyEx=function(e,t,a){if(this.day.interim
)return!1;if(this.parent.isInputAccessControl()){if(this.isDivergeBeforeJudge())return{flag:!1,reason:teasp.message.getLabel("ac00000480"),pending:!0};if(this.isDivergeNoReason(a))return{flag:!1,reason:teasp.message.getLabel("ac00000470")}}if(3!=e){a=this.getDeficit(e);if(a.ng)return{flag:!1,reason:teasp.message.getLabel("ci00001030",teasp.message.getLabel("startEndTime_label"))};if(a.empty)return{flag:!1,
reason:teasp.message.getLabel("tk10005430",teasp.message.getLabel(1==a.empty?"startTime_label":2==a.empty?"endTime_label":"startEndTime_label"))};if(a.entered&&!this.day.workLocationId&&this.parent.isRequireWorkLocation())return{flag:!1,reason:teasp.message.getLabel("tk10005430",teasp.message.getLabel("tw00000010"))};if(1==e&&!a.entered&&this.day.workLocationId)return{flag:!1,reason:teasp.message.getLabel(
"tw00000310")}}if(this.isExistApply(teasp.constant.APPLY_KEY_KYUSHTU)&&!t&&!this.isWorked()&&this.parent.isUseDaiqManage())return{flag:!1,reason:teasp.message.getLabel("tm10003830")};if(this.day.dayType!=teasp.constant.DAY_TYPE_NORMAL&&this.isInputTime()&&!this.isExistApply(teasp.constant.APPLY_KEY_KYUSHTU)&&!this.day.workFlag&&!this.day.autoLH)return{flag:!1,reason:teasp.message.getLabel("tm10003620")};if(
this.isExistNotEnterReviseTime())return{flag:!1,reason:teasp.message.getLabel("tf10007930")};if(e){for(var o=this.getEmpApplyList("ALL_WAIT"),s=0,i=0;i<o.length;i++)o[i].applyType!=teasp.constant.APPLY_TYPE_DAILY&&s++;if(0<s)return{flag:!1,reason:teasp.message.getLabel("tm10001080")}}if(this.day.rack&&this.day.rack.holidayJoin&&3==this.day.rack.holidayJoin.flag)return{flag:!1,hidden:!0,reason:teasp.message.getLabel(
"tk10005340")};if(!this.isInputable())return{flag:!1,hidden:!0,reason:""};if(3!=e&&2!=e){var a=[],e=this.getDiscretionaryLevel(),n=this.parent.getOverTimeRequireTime(e),e=this.parent.getEarlyWorkRequireTime(e),n=this.getMissingOverTime(n),e=this.getMissingEarlyWork(e),r=0;if(0<n&&(a.push(teasp.message.getLabel("tf10008740",teasp.message.getLabel("tm10001293"))),this.isExistApply(teasp.constant.APPLY_KEY_ZANGYO)&&r++)
,0<e&&(a.push(teasp.message.getLabel("tf10008740",teasp.message.getLabel("tm10001294"))),this.isExistApply(teasp.constant.APPLY_KEY_EARLYSTART)&&r++),0<r&&a.push(teasp.message.getLabel("tf10008760")),this.parent.isRequiredLateStartApply()&&this.isMissingLateStartApply()&&a.push(teasp.message.getLabel("tf10008740",teasp.message.getLabel("applyLateStart_label"))),this.parent.isRequiredEarlyEndApply(
)&&this.isMissingEarlyEndApply()&&a.push(teasp.message.getLabel("tf10008740",teasp.message.getLabel("applyEarlyEnd_label"))),a.length)return a.unshift(teasp.message.getLabel("tf10008750")),{flag:!1,active:!0,reason:a.join("\n")}}var l=this.parent.getInvalidApplysOfDay(this.day.date,!0,t);if(0<l.length){for(var p=[],i=0;i<l.length;i++)2<=i||p.push(l[i].text);return 2<l.length&&(p[p.length-1]+=".."),{flag:!1,
reason:p.join("<br/>")}}n=this.getDayNoteWarning(t);return n?{flag:!1,reason:n}:{flag:!0}},teasp.data.EmpDay.prototype.canSelectReviseTime=function(){return this.getApplyStatus(teasp.constant.APPLY_KEY_REVISETIME)!=teasp.constant.STATUS_WAIT&&(!!this.isInputTime()||!this.day.interim&&(3!=(this.day.rack.holidayJoin?this.day.rack.holidayJoin.flag:0)&&((!this.isHoliday(
)&&!this.day.plannedHoliday||0<this.day.rack.validApplys.kyushtu.length)&&this.isReliableDate())))},teasp.data.EmpDay.prototype.canSelectDirect=function(){if(this.day.interim)return!1;if("number"==typeof this.day[teasp.constant.C_REAL].startTime&&"number"==typeof this.day[teasp.constant.C_REAL].endTime)return!1;var e=this.existWaitReviseTime();return(!e||"number"!=typeof e.from||"number"!=typeof e.to)&&(3!=(
this.day.rack.holidayJoin?this.day.rack.holidayJoin.flag:0)&&(!this.isExistApply(teasp.constant.APPLY_KEY_DIRECT)&&(!this.isHoliday()&&!this.day.plannedHoliday)))},teasp.data.EmpDay.prototype.canCancelDayApply=function(e){if(e.applyType==teasp.constant.APPLY_TYPE_REVISETIME){var t=this.day.rack.validApplys.reviseTime;if(0<t.length&&t[0].id!=e.id&&!teasp.constant.STATUS_NEGATIVE.contains(e.status))return 0}
return teasp.constant.STATUS_APPROVES.contains(e.status)?this.parent.canCancelDayApply()?e.status==teasp.constant.STATUS_ADMIT?3:2:0:teasp.constant.STATUS_REJECTS.contains(e.status)?-1:1},teasp.data.EmpDay.prototype.getDefaultZangyoRange=function(e,t,a){var o={from:null,to:null,bdrTime:null,bdrFlag:!!(void 0!==a&&8&a)};return e?(o.from=this.day.rack.shiftStartTime||this.day.pattern.stdStartTime,
o.to=this.day.rack.shiftEndTime||this.day.pattern.stdEndTime):(0<this.day.rack.validApplys.kyushtu.length&&!this.day.plannedHoliday?(o.from=this.day.rack.shiftEndTime||this.day.pattern.stdEndTime,o.to=o.from+120,o.bdrTime=o.from):this.isHoliday()||(this.day.notify?o.from=this.day.notify.endTime:o.from=this.day.rack.shiftEndTime||this.day.pattern.stdEndTime,o.to=o.from+120,"number"==typeof t&&0<t&&o.from<t?(
o.bdrTime=t,this.parent.isDefaultIsBorderTime(1)&&this.day.rack.flexFlag&&2&a&&o.from<o.bdrTime&&(o.from=o.bdrTime,o.to=o.from+120)):o.bdrTime=o.from),2880<o.to&&(o.to=2880)),o},teasp.data.EmpDay.prototype.getDefaultEarlyStartRange=function(e,t){var a={from:null,to:null,bdrTime:null,bdrFlag:!!(void 0!==t&&8&t)};return 0<this.day.rack.validApplys.kyushtu.length&&!this.day.plannedHoliday?(
a.to=this.day.rack.shiftStartTime||this.day.pattern.stdStartTime,a.bdrTime=a.to):this.isHoliday()||(this.day.notify?a.to=this.day.notify.startTime:a.to=this.day.rack.shiftStartTime||this.day.pattern.stdStartTime,"number"==typeof e&&0<=e&&e<a.to?(a.bdrTime=e,this.parent.isDefaultIsBorderTime(2)&&this.day.rack.flexFlag&&2&t&&a.bdrTime<a.to&&(a.to=a.bdrTime)):a.bdrTime=a.to),a.from=a.to-60,a.from<0&&(a.from=0),a},
teasp.data.EmpDay.prototype.getDiscretionaryLevel=function(){var e=this.dataObj.common.discretionaryOption;return this.day.pattern.useDiscretionary?this.isHoliday()||this.day.plannedHoliday?2*(e?-1:1):e?-1:1:0},teasp.data.EmpDay.prototype.getInputTimeRange=function(e){var t=this.day.rack.holidayJoin?this.day.rack.holidayJoin.flag:0;if(3==t)return null;var a={from:0,to:2880};return!t||this.isFlexHalfDayTimeDay()?a:(
1==t?a.from=this.day.pattern.amHolidayEndTime:a.to=this.day.pattern.pmHolidayStartTime,this.parent.isProhibitBorderRestTime()?(a.rests=e||this.day.pattern.restTimes||[],teasp.logic.EmpTime.adjustInputTime(a,1==t?1:2)):a)},teasp.data.EmpDay.prototype.getTimeHolidaySpans=function(){for(var e=[],t=this.day.timeTable||[],a=0;a<t.length;a++){var o=t[a];o.type==teasp.constant.REST_PAY&&e.push(o)}return e},
teasp.data.EmpDay.prototype.getSeparatedRests=function(e){for(var t={fix:[],free:[],paid:[],unpaid:[]},a=e||this.day.pattern,o=this.day.timeTable||[],s=0;s<o.length;s++){var i=o[s];i.type!=teasp.constant.REST_FIX&&i.type!=teasp.constant.REST_FREE&&i.type!=teasp.constant.REST_PAY&&i.type!=teasp.constant.REST_UNPAY||(
i.type==teasp.constant.REST_PAY?t.paid:i.type==teasp.constant.REST_UNPAY?t.unpaid:teasp.logic.EmpTime.isFixRest(i,a.restTimes)?t.fix:t.free).push(i)}return this.isInputTime()||(t.fix=a.restTimes||[],t.free=[]),t},teasp.data.EmpDay.prototype.checkInconsistent=function(e,t,a){var o=teasp.constant.C_REAL,s="number"==typeof this.day[o].startTime?this.day[o].startTime:-1,
o="number"==typeof this.day[o].endTime?this.day[o].endTime:-1,i=this.getTimeHolidaySpans();if((s<0&&o<0||0<=o&&o<s)&&!i.length)return 0;var t=t||this.day.pattern,a=a||0,n={from:t.amHolidayStartTime+a,to:t.amHolidayEndTime+a},r={from:t.pmHolidayStartTime+a,to:t.pmHolidayEndTime+a},a={from:t.stdStartTime+a,to:t.stdEndTime+a};if(e==teasp.constant.RANGE_AM){if(0<=o&&o<=n.to)return-1;if(0<=s)return n.to<=s?0:1;if(
i.length&&0<teasp.util.time.rangeTime(n,i))return-2}else if(e==teasp.constant.RANGE_PM){if(0<=s&&r.from<=s)return-1;if(0<=o)return o<=r.from?0:2;if(i.length&&0<teasp.util.time.rangeTime(r,i))return-2}else if(e==teasp.constant.RANGE_ALL)return-1;if(i.length){if(teasp.util.time.excludeRanges(i,[a]).length)return-3;for(var l=this.getSeparatedRests(t),p=0;p<i.length;p++)if(0<teasp.util.time.rangeTime(i[0],l.free)
)return-4}return 0},teasp.data.EmpDay.prototype.getValidTimeList=function(){var e={from:this.day.rack.startTimeEx,to:this.day.rack.endTimeEx,rests:[],workable:{from:0,to:2880},border:{from:Math.max((this.getFixStartTime()||0)-240,0),to:Math.max((this.getFixStartTime()||0)+1200,1440)}};if(null===e.from&&null===e.to){var t=[];dojo.forEach(this.day.rack.validApplys.holidayTime||[],function(e){t.push({from:e.startTime,
to:e.endTime})}),e.rests=teasp.util.time.margeTimeSpans(t.concat(this.day.pattern.restTimes))}else for(var a=this.day.timeTable||[],o=0;o<a.length;o++){var s=a[o];s.type!=teasp.constant.REST_FIX&&s.type!=teasp.constant.REST_FREE&&s.type!=teasp.constant.REST_PAY&&s.type!=teasp.constant.REST_UNPAY||e.rests.push(s)}
return this.day.rack.validApplys.holidayAm?e.workable.from=this.day.pattern.amHolidayEndTime:this.day.rack.validApplys.holidayPm&&(e.workable.to=this.day.pattern.pmHolidayStartTime),e},teasp.data.EmpDay.prototype.mergeRests=function(e,t){var a=this.day.timeTable||[];t.type=null;for(var o=0;o<a.length;o++){var s=a[o];if((
s.type==teasp.constant.REST_FIX||s.type==teasp.constant.REST_FREE||s.type==teasp.constant.REST_PAY||s.type==teasp.constant.REST_UNPAY)&&t.from==s.from&&t.to==s.to){t.type=s.type;break}}if(!t.type){for(o=0;o<this.day.pattern.restTimes.length;o++){var i=this.day.pattern.restTimes[o];if(t.from==i.from&&t.to==i.to){t.type=teasp.constant.REST_FIX;break}}t.type||(t.type=teasp.constant.REST_FREE)}e.push(t)},
teasp.data.EmpDay.prototype.getDayNoteWarning=function(e){var t=this.day.pattern.useDiscretionary?teasp.constant.C_DISC:teasp.constant.C_REAL,a=null,o=null,s=this.getDayNote(!this.parent.isSeparateDailyNote()),s=(this.dataObj.common.commentIfNoPushTime&&!s&&(this.day.deco.ct.st<0||this.day.deco.ct.et<0)&&(a=-1<=this.day.deco.ct.st&&-1<=this.day.deco.ct.et?teasp.message.getLabel("tm10001400"):teasp.message.getLabel(
"tm10001410")),this.dataObj.common.commentIfAbsence&&!s&&this.day[t]&&(0<this.day[t].lateLostTime||0<this.day[t].earlyLostTime||0<this.day[t].privateInnerLostTime)&&(o="",0<this.day[t].lateLostTime&&(o+=teasp.message.getLabel("tm10001420")),0<this.day[t].earlyLostTime&&(o+=(""!=o?teasp.message.getLabel("tm10001570"):"")+teasp.message.getLabel("tm10001430")),0<this.day[t].privateInnerLostTime&&(o+=(
""!=o?teasp.message.getLabel("tm10001570"):"")+teasp.message.getLabel("tm10001440")),o+=teasp.message.getLabel("tm10001450")),[]);return(a||o)&&s.push(teasp.message.getLabel("tm10001600",teasp.util.date.formatDate(this.day.rack.key,"M/d"),o||a)),!e&&this.day.deco.prohibitOverNightWork&&s.push(this.day.deco.prohibitOverNightWork),s.length?s.join("\n"):null},teasp.data.EmpDay.prototype.getCalendarEvent=function(){
var e=this.day.event||"",t=teasp.message.getLabel("tm10001360");return e=this.day.plannedHoliday&&e.indexOf(t)<0?(e?e+teasp.message.getLabel("tm10001540"):"")+t:e},teasp.data.EmpDay.prototype.getDayEvent=function(){var e=teasp.message.getLabel("tm10001360"),t=[],a=this.day.rack.validApplys,o=a.exchangeS||a.exchangeE,o=(o&&t.push(teasp.message.getLabel(a.exchangeS&&a.exchangeE?"tk10004390":"tm10001610",
teasp.util.date.formatDate(a.exchangeS?a.exchangeS.exchangeDate:o.originalStartDate,"M/d"))),this.day.event||""),o=(0<o.length&&t.push(o),!this.day.plannedHoliday||this.day.event&&this.day.event==e||t.push(e),a.patternS||a.patternL),e=(o&&t.push(teasp.message.getLabel("tm10001292",o.pattern&&o.pattern.name||"")),a.patternD&&t.push(teasp.message.getLabel("tm10001292",this.parent.getDisplayDayType(a.patternD.dayType)))
,a.holidayAll&&t.push(teasp.message.getLabel("tm10001291",a.holidayAll&&a.holidayAll.holiday.name||"")),a.holidayAm&&t.push(teasp.message.getLabel("tm10001291",a.holidayAm&&a.holidayAm.holiday.name||"")),!a.holidayPm||a.holidayAm&&a.holidayAm.holiday.name==a.holidayPm.holiday.name||t.push(teasp.message.getLabel("tm10001291",a.holidayPm&&a.holidayPm.holiday.name||"")),this.getSummaryOfHourlyLeave());return e&&t.push(e
),0<a.kyushtu.length&&t.push(teasp.message.getLabel("tm10001390")+(this.day.deco.ct.st||this.day.deco.ct.et?"":teasp.message.getLabel("tm10001620"))),0<a.zangyo.length&&t.push(teasp.message.getLabel("tm10001293")),0<a.earlyStart.length&&t.push(teasp.message.getLabel("tm10001294")),a.lateStart?(t.push(teasp.message.getLabel("tk10001181",a.lateStart.treatDeduct?teasp.message.getLabel(
a.lateStart.ownReason?"tk10001183":"tk10001184"):"")),this.day.real&&this.day.real.latePlus&&t.push(teasp.message.getLabel("tm10001420"))):this.day.real&&0<this.day.real.lateTime&&t.push(teasp.message.getLabel("tm10001420")),a.earlyEnd?(t.push(teasp.message.getLabel("tk10001182",a.earlyEnd.treatDeduct?teasp.message.getLabel(a.earlyEnd.ownReason?"tk10001183":"tk10001184"):"")),
this.day.real&&this.day.real.earlyPlus&&t.push(teasp.message.getLabel("tm10001430"))):this.day.real&&0<this.day.real.earlyTime&&t.push(teasp.message.getLabel("tm10001430")),a.dailyFix&&t.push(teasp.message.getLabel("tm10001297")),0<a.reviseTime.length&&t.push(teasp.message.getLabel("tm10001298")),a.direct&&(o=teasp.message.getLabel("tk10004650"),1==a.direct.directFlag?o=teasp.message.getLabel("tk10004760",
teasp.message.getLabel("tk10004680")):2==a.direct.directFlag&&(o=teasp.message.getLabel("tk10004760",teasp.message.getLabel("tk10004690"))),t.push(o)),this.parent.isUseWorkLocation()&&this.getWorkLocationName()&&this.parent.isAlive(this.getKey())&&(this.isInputTime()||this.isInputable())&&t.push(this.getWorkLocationName()),t.join(",")},teasp.data.EmpDay.prototype.getStartTime=function(e,t,a,o){return a=a||(
this.day.pattern.useDiscretionary?teasp.constant.C_DISC:teasp.constant.C_REAL),this.day[a]?this.parent.getDisplayTime(o?this.day[a].calcStartTime:this.day[a].startTime,e,t):t||null},teasp.data.EmpDay.prototype.getEndTime=function(e,t,a,o){return a=a||(this.day.pattern.useDiscretionary?teasp.constant.C_DISC:teasp.constant.C_REAL),this.day[a]?this.parent.getDisplayTime(o?this.day[a].calcEndTime:this.day[a].endTime,e,t
):t||null},teasp.data.EmpDay.prototype.getRealStartTime=function(){return this.day[teasp.constant.C_REAL]&&this.day[teasp.constant.C_REAL].startTime||null},teasp.data.EmpDay.prototype.getRealEndTime=function(){return this.day[teasp.constant.C_REAL]&&this.day[teasp.constant.C_REAL].endTime||null},teasp.data.EmpDay.prototype.getDaySubTimeByKey=function(e,t,a,o,s){return s=s||(
this.day.pattern.useDiscretionary?teasp.constant.C_DISC:teasp.constant.C_REAL),this.day[s]?this.parent.getDisplayTime(this.day[s][e],t,a,o):0},teasp.data.EmpDay.prototype.resetTime=function(){if(this.day.startTime=null,this.day.endTime=null,this.day.timeTable=[],this.day.pattern)for(var e=0;e<this.day.pattern.restTimes.length;e++){var t=this.day.pattern.restTimes[e];this.day.timeTable.push({from:t.from,to:t.to,
type:teasp.constant.REST_FIX})}},teasp.data.EmpDay.prototype.adjustTime=function(e){var t;e==teasp.constant.RANGE_ALL?this.resetTime():(t=this.day.pattern,e==teasp.constant.RANGE_AM?"number"==typeof this.day.startTime&&"number"==typeof t.amHolidayEndTime&&this.day.startTime<t.amHolidayEndTime&&(this.day.startTime=t.amHolidayEndTime,
"number"==typeof this.day.endTime&&this.day.startTime>=this.day.endTime&&this.resetTime()):e==teasp.constant.RANGE_PM&&"number"==typeof this.day.endTime&&"number"==typeof t.pmHolidayStartTime&&this.day.endTime>t.pmHolidayStartTime&&(this.day.endTime=t.pmHolidayStartTime,"number"==typeof this.day.startTime&&this.day.startTime>=this.day.endTime&&this.resetTime()))},teasp.data.EmpDay.prototype.getRestTime=function(e,t,a
,o){o=o||(this.day.pattern.useDiscretionary?teasp.constant.C_DISC:teasp.constant.C_REAL);var s=this.day[o].restTime;if(this.parent.isKeepExteriorTime()&&this.day.rack.worked&&this.day.rack.freeRests&&0<this.day.rack.freeRests.length){var o={from:this.day[o].calcStartTime||this.day.startTime,to:this.day[o].calcEndTime||this.day.endTime},i=teasp.util.time.sliceTimes(this.day.rack.freeRests,o);if(0<i.length)for(
var n=0;n<i.length;n++)s+=i[n].to-i[n].from}return this.parent.getDisplayTime(s,e,t,a)},teasp.data.EmpDay.prototype.isRestLack=function(){return this.day.deco.restLack},teasp.data.EmpDay.prototype.getDaySummary=function(){var e=this.day.pattern,t={title:"",fixTimeTitle:"",fixTimeSpan:"",fixRestSpan:null,holys:[],st:"",et:"",rests:"",restSpan:"",aways:"",awaySpan:"",legalzan:"",legalout:"",legalext:"",hwrkTime:"",
nightTime:"",restTime:"",awayTime:"",workFixTime:"",workWholeTime:"",workRealTime:"",discretionary:!1};if(this.isHoliday()?(t.fixTimeTitle=teasp.message.getLabel("tm10001200"),0<this.day.rack.validApplys.kyushtu.length?t.fixTimeSpan=teasp.util.time.timeValue(this.getFixStartTime())+"-"+teasp.util.time.timeValue(this.getFixEndTime()):t.fixTimeSpan="",this.getDayType(
)==teasp.constant.DAY_TYPE_LEGAL_HOLIDAY?t.title+=teasp.message.getLabel("legalHoliday_label"):this.getDayType()==teasp.constant.DAY_TYPE_PUBLIC_HOLIDAY?t.title+=teasp.message.getLabel("publicHoliday_label"):t.title+=teasp.message.getLabel("fixHoliday_label")):(this.parent.getWorkSystem()==teasp.constant.WORK_SYSTEM_FIX||this.parent.getWorkSystem(
)==teasp.constant.WORK_SYSTEM_MUTATE?t.fixTimeTitle=teasp.message.getLabel("tm10001140"):t.fixTimeTitle=teasp.message.getLabel("tm10001150"),t.fixTimeSpan=teasp.util.time.timeValue(this.getFixStartTime())+"-"+teasp.util.time.timeValue(this.getFixEndTime()),this.parent.getWorkSystem()==teasp.constant.WORK_SYSTEM_FLEX?e.id?e.disableCoreTime?t.core=teasp.message.getLabel("tm10010150"):(t.core=teasp.util.time.timeValue(
this.getFixStartTime())+"-"+teasp.util.time.timeValue(this.getFixEndTime()),t.fixTimeSpan=teasp.util.time.timeValue(e.stdStartTime)+"-"+teasp.util.time.timeValue(e.stdEndTime)):this.parent.getConfigObj().useCoreTime?t.core=teasp.util.time.timeValue(this.parent.getConfigObj().coreStartTime)+"-"+teasp.util.time.timeValue(this.parent.getConfigObj().coreEndTime):t.core=null:t.fixTimeSpan+=" "+teasp.message.getLabel(
"tm10001680",teasp.util.time.timeValue(this.getFixTime())),this.isPlannedHoliday()&&(t.title+=teasp.message.getLabel("tm10001180")),t.title+=e.name?e.name.entitize():teasp.message.getLabel("tm10001190"),e.useDiscretionary&&(t.discretionary=!0)),""!=t.fixTimeSpan&&e.restTimes&&0<e.restTimes.length){t.fixRestSpan="";for(var a=0;a<e.restTimes.length;a++){var o=e.restTimes[a];t.fixRestSpan+=(0<a?",":""
)+teasp.util.time.timeValue(o.from)+"-"+teasp.util.time.timeValue(o.to)}}t.st=this.getStartTime(!1,null,teasp.constant.C_REAL),t.et=this.getEndTime(!1,null,teasp.constant.C_REAL);var s=this.getStartTime(!0,0,teasp.constant.C_REAL),i=this.getEndTime(!0,0,teasp.constant.C_REAL),n=this.getTimeTable(!0),r=this.getArrayOfHourlyLeave();r.length&&(t.holys=t.holys.concat(r));for(a=0;a<n.length;a++)(o=n[a]
).type==teasp.constant.REST_FIX||o.type==teasp.constant.REST_FREE?null===o.from||null===o.to?t.restSpan+=(""!=t.restSpan?",":"")+teasp.util.time.timeValue(o.from)+"-"+teasp.util.time.timeValue(o.to):(!s||s<o.to)&&(!i||o.from<i)&&(t.restSpan+=(""!=t.restSpan?",":"")+teasp.util.time.timeValue(s&&o.from<s?s:o.from)+"-"+teasp.util.time.timeValue(i&&i<o.to?i:o.to)):o.type==teasp.constant.AWAY&&(t.awaySpan+=(
""!=t.awaySpan?",":"")+teasp.util.time.timeValue(o.from)+"-"+teasp.util.time.timeValue(o.to));this.dataObj.holiday1&&t.holys.push({name:this.dataObj.holiday1.name}),this.dataObj.holiday2&&t.holys.push({name:this.dataObj.holiday2.name});r=this.parent.getCalcMode(),r=(r=r==teasp.constant.C_FDISC?teasp.constant.C_FREAL:r)==teasp.constant.C_FREAL?r:null;return this.parent.isDiscretionaryOption(
)&&r==teasp.constant.C_DISC&&(r=teasp.constant.C_REAL),t.legalzan=this.getDaySubTimeByKey("workLegalOverTime",!0,0,null,r),t.legalout=this.getDaySubTimeByKey("workLegalOutOverTime",!0,0,null,r),t.legalext=this.getDaySubTimeByKey("workChargeTime",!0,0,null,r),t.hwrkTime=this.getDaySubTimeByKey("workHolidayTime",!0,0,null,r),t.restTime=this.getDaySubTimeByKey("restTime",!0,0,null,r),t.awayTime=this.getDaySubTimeByKey(
"awayTime",!0,0,null,r),t.workFixTime=this.getDaySubTimeByKey("workInFixedTime",!0,0,null,r),t.workWholeTime=this.getDaySubTimeByKey("workWholeTime",!0,0,null,r),t.workRealTime=this.getDaySubTimeByKey("workRealTime",!0,0,null,r),t.workNetTime=this.getDaySubTimeByKey("workRealTime",!0,0,null,teasp.constant.C_REAL),t.nightTime=this.getDaySubTimeByKey("workNightTime",!0,0,null,teasp.constant.C_REAL),t},
teasp.data.EmpDay.prototype.getWorkPlaceSymbol=function(){var e=this.day.rack.validApplys.shiftSet;return!e||!e.workPlace||e.workPlace.id==this.parent.getDeptId()?null:e.workPlace.symbol||e.workPlace.name.substring(0,1)},teasp.data.EmpDay.prototype.getReviseTimeTable=function(e){return this.getMergedReviseTime(e.oldValue,e.timeTable)},teasp.data.EmpDay.prototype.getReviseOldValue=function(e){
return this.getMergedReviseTime(e.timeTable,e.oldValue)},teasp.data.EmpDay.fromJsonTT=function(e){return"string"==typeof e?dojo.fromJson(e.replace(/\\/g,"")):e},teasp.data.EmpDay.prototype.getMergedReviseTime=function(e,t){var a=teasp.data.EmpDay.fromJsonTT(e),o=teasp.data.EmpDay.fromJsonTT(t),s=null,i=[],n=[],r=null,l=[],p=[],d=[],c=[];for(h=0;h<o.length;h++
)1==o[h].type?s=o[h]:o[h].type!=teasp.constant.REST_FIX&&o[h].type!=teasp.constant.REST_FREE||i.push(o[h]);var m=this.getTimeTable();for(h=0;h<m.length;h++)m[h].type==teasp.constant.AWAY&&n.push(m[h]);for(h=0;h<a.length;h++)1==a[h].type?r=a[h]:(a[h].type==teasp.constant.REST_FIX||a[h].type==teasp.constant.REST_FREE?l:p).push(a[h]);var e=this.getStartTime(!0,null,teasp.constant.C_REAL),t=this.getEndTime(!0,null,
teasp.constant.C_REAL);if("number"==typeof(e={from:"number"==typeof e?e:null,to:"number"==typeof t?t:null}).from||"number"==typeof e.to){for(var m=this.getTimeTable(),h=0;h<m.length;h++)1!=m[h].type&&(m[h].type==teasp.constant.REST_FIX||m[h].type==teasp.constant.REST_FREE?d:c).push(m[h]);if(e.from!=r.from&&(s.from=e.from),e.to!=r.to&&(s.to=e.to),d.length!=l.length)i=d;else for(l=l.sort(function(e,t){
return e.from==t.from?e.to-t.to:e.from-t.from}),d=d.sort(function(e,t){return e.from==t.from?e.to-t.to:e.from-t.from}),h=0;h<d.length;h++)if(d[h].from!=l[h].from||d[h].to!=l[h].to){i=d;break}}return[s].concat(i).concat(n)},teasp.data.EmpDay.prototype.getApplyNotes=function(){return this.day.rack.applyNotes},teasp.data.EmpDay.prototype.isExchangedEdge=function(){var e=this.isExistApply(
teasp.constant.APPLY_KEY_EXCHANGES),t=this.isExistApply(teasp.constant.APPLY_KEY_EXCHANGEE);return(e||t)&&!(e&&t)},teasp.data.EmpDay.prototype.createTimeTable=function(e,t,a){for(var o=this.getPattern(),s=[],i=0;i<o.restTimes.length;i++)s.push({from:o.restTimes[i].from,to:o.restTimes[i].to,type:teasp.constant.REST_FIX});if(!e&&!t)return[{from:null,to:null,type:1}].concat(s);var n=this.getStartTime(!0,0,
teasp.constant.C_REAL),r=this.getEndTime(!0,0,teasp.constant.C_REAL),l=[],p=[],d=dojo.clone(this.getTimeTable());if(a&&"number"!=typeof n&&"number"!=typeof r)p=s;else for(i=0;i<d.length;i++){var c=d[i];c.type==teasp.constant.AWAY?l.push(c):c.type!=teasp.constant.REST_FIX&&c.type!=teasp.constant.REST_FREE||p.push(c)}return[{from:e,to:t,type:1}].concat(p).concat(l)},
teasp.data.EmpDay.prototype.createTimeTableFix=function(e){var t=this.getPattern(),a=this.day.rack.shiftStartTime||t.stdStartTime,t=this.day.rack.shiftEndTime||t.stdEndTime,o=this.getStartTime(!0,0,teasp.constant.C_REAL),s=this.getEndTime(!0,0,teasp.constant.C_REAL),i=this.getInputTimeRange(),i=(i&&(a<i.from&&(a=i.from),t>i.to&&(t=i.to)),this.getEmpApplyByKey(teasp.constant.APPLY_KEY_ZANGYO)),n=this.getEmpApplyByKey(
teasp.constant.APPLY_KEY_EARLYSTART),r=this.getEmpApplyByKey(teasp.constant.APPLY_KEY_KYUSHTU),l=this.getEmpApplyByKey(teasp.constant.APPLY_KEY_LATESTART),p=this.getEmpApplyByKey(teasp.constant.APPLY_KEY_EARLYEND);return i&&(i.startTime<a&&(a=i.startTime),i.endTime>t&&(t=i.endTime)),n&&(n.startTime<a&&(a=n.startTime),n.endTime>t&&(t=n.endTime)),r&&(this.isHoliday()||this.day.plannedHoliday)&&(r.startTime<a&&(
a=r.startTime),r.endTime>t&&(t=r.endTime)),l&&l.endTime>a&&(a=l.endTime),p&&p.startTime<t&&(t=p.startTime)<a&&(t=null),this.createTimeTable(1&e?a:o,2&e?t:s,!o&&!s)},teasp.data.EmpDay.prototype.getLateFlag=function(){return 0<this.day.real.lateTime},teasp.data.EmpDay.prototype.getEarlyFlag=function(){return 0<this.day.real.earlyTime},teasp.data.EmpDay.prototype.getInputLimit=function(){var e=this.getStartTime(!0,null,
teasp.constant.C_REAL),t=this.getEndTime(!0,null,teasp.constant.C_REAL),a=this.getEmpApplyByKey(teasp.constant.APPLY_KEY_DIRECT),o=this.getEmpApplyByKey(teasp.constant.APPLY_KEY_KYUSHTU),a=a&&a.directFlag||o&&o.directFlag||0,o={flag:a,directFlag:a,st:e=""===e?null:e,et:t=""===t?null:t};return o.flag&&(1&o.flag&&"number"!=typeof e&&(o.flag&=-2),2&o.flag&&"number"!=typeof t&&(o.flag&=-3)),o},
teasp.data.EmpDay.prototype.existWaitReviseTime=function(){for(var e=this.day.rack.validApplys.reviseTime||[],t={from:null,to:null},a=0;a<e.length;a++){var o=e[a];if(o.status==teasp.constant.STATUS_WAIT){for(var s=teasp.data.EmpDay.fromJsonTT(o.oldValue),i=teasp.data.EmpDay.fromJsonTT(o.timeTable),n={from:null,to:null},r={from:null,to:null},a=0;a<s.length;a++)if(1==(l=s[a]).type){n.from=l.from,n.to=l.to;break}for(
var l,a=0;a<i.length;a++)if(1==(l=i[a]).type){r.from=l.from,r.to=l.to;break}t.from=n.from||r.from||t.from,t.to=n.to||r.to||t.to}}return null===t.from&&null===t.to?null:t},teasp.data.EmpDay.prototype.getTimeHolidayTime=function(e){for(var t=this.day.rack.validApplys&&this.day.rack.validApplys.holidayTime||[],a=0,o=e||[],s=0;s<t.length;s++){for(var i=t[s],n=i.holiday||{},r=1,l=(n.yuqSpend?r=60:n.managed&&(r=30),[]),
p=0;p<o.length;p++){var d=o[p];d.type==teasp.constant.REST_FIX&&l.push(d)}var c,n=i.startTime,i=i.endTime;"number"!=typeof n||"number"!=typeof i||i<=n||(c=i-n,0<l.length&&(0<(n=teasp.util.time.rangeTime({from:n,to:i},l))&&(c-=n)),a+=Math.ceil(c/r)*r)}return a},teasp.data.EmpDay.prototype.getPushableEndTime=function(e,t){var a=this.day.date,o=60*e.getHours()+e.getMinutes(),e=teasp.util.date.compareDate(a,e);if(
0==e||-1==e){var s=this.day.startTime,i=this.day.endTime,t=!(!t&&!s||i),i=this.parent.isPermitLeavingPush24hours();if(t&&-1==e){a=this.parent.getNextMonthDay(a).endTime;if(t="number"==typeof nst||"number"==typeof a&&a<o||"number"==typeof s&&i&&s<o||!i&&300<o?!1:t)return o+1440}if(t&&0==e){if(s)return o;if((
this.day.dayType==teasp.constant.DAY_TYPE_NORMAL&&!this.day.plannedHoliday||0<this.day.rack.validApplys.kyushtu.length&&(!this.parent.isProhibitInputTimeUntilApproved()||teasp.constant.STATUS_APPROVES.contains(this.day.rack.validApplys.kyushtu[0].status)))&&(!this.day.rack.holidayJoin||3!=this.day.rack.holidayJoin.flag)&&!this.day.interim)return o}}return null},teasp.data.EmpDay.prototype.getZanteiRealTime=function(e
){var t,e=this.getPushableEndTime(e);return e?((t=dojo.clone(this.day)).endTime=e,teasp.action.contact.recalcOneDay(this.parent,t),t.real.workRealTime):0},teasp.data.EmpDay.prototype.getBorderTime=function(e){return this.parent.getWorkSystem()==teasp.constant.WORK_SYSTEM_FLEX?this.isUseCoreTime()?e&&"number"==typeof this.day.rack.bdrStartTime&&"number"==typeof this.day.rack.bdrEndTime?{st:this.day.rack.bdrStartTime,
et:this.day.rack.bdrEndTime}:this.getCoreTime():{st:-1,et:-1}:{st:this.getFixStartTime(e),et:this.getFixEndTime(e)}},teasp.data.EmpDay.prototype.getDeficit=function(e){var t={ng:!1,empty:0,entered:!1,require:this.parent.isRequireDailyInput()};return this.day.deco.invalidTime?t.ng=!0:this.isInputable(!0)&&(
0===this.day.deco.ct.st&&0===this.day.deco.ct.et?t.empty=3:0===this.day.deco.ct.st&&0!==this.day.deco.ct.et?t.empty=1:0!==this.day.deco.ct.st&&0===this.day.deco.ct.et?t.empty=2:t.entered=!0,3!=t.empty||t.require||(t.empty=0),2==e&&(t.empty&=1)),t},teasp.data.EmpDay.prototype.isCheckTimeOnHalfHoliday=function(){if(this.isFlexHalfDayTimeDay())return!1;if(this.getDiscretionaryLevel()){var e=this.getEmpApplyByKey(
teasp.constant.APPLY_KEY_PATTERNS),t=this.getEmpApplyByKey(teasp.constant.APPLY_KEY_PATTERNL),e=e||t;if(e&&e.pattern&&!e.pattern.enableRestTimeShift&&(e.startTime!=e.pattern.stdStartTime||e.endTime!=e.pattern.stdEndTime))return!1}return!0},teasp.data.EmpDay.prototype.getFixTimeNums=function(){for(var e=this.getPattern(),t=[],a=0;a<e.restTimes.length;a++)t.push(""+e.restTimes[a].from),t.push(""+e.restTimes[a].to);
return t.join(",")},teasp.data.EmpDay.prototype.isInterim=function(){return this.day.interim},teasp.data.EmpDay.prototype.isUseCoreTime=function(){return this.day.rack.useCoreTime||!1},teasp.data.EmpDay.prototype.getCoreTime=function(){var e=this.getEmpApplyByKey(teasp.constant.APPLY_KEY_PATTERNS),t=this.getEmpApplyByKey(teasp.constant.APPLY_KEY_PATTERNL),e=e||t;return e?{st:e.startTime||e.pattern.stdStartTime,
et:e.endTime||e.pattern.stdEndTime}:{st:this.parent.getConfigObj().coreStartTime,et:this.parent.getConfigObj().coreEndTime}},teasp.data.EmpDay.prototype.isNormalDay=function(){return this.day.dayType==teasp.constant.DAY_TYPE_NORMAL||this.day.autoLH&&this.day.rack.validApplys.kyushtu.length<=0||this.parent.isRegulateHoliday(this.day.date)},teasp.data.EmpDay.prototype.isExistNotEnterReviseTime=function(){for(
var e=this.day.rack.validApplys.reviseTime||[],t=0;t<e.length;t++){var a=e[t];if(teasp.constant.STATUS_APPROVES.contains(a.status)&&!a.entered)return!0}return!1},teasp.data.EmpDay.prototype.isInputed=function(e){var t="number"==typeof this.getRealStartTime(),a="number"==typeof this.getRealEndTime();return t&&a||e&&(t||a)},teasp.data.EmpDay.prototype.getDivergenceJudge=function(e){return new teasp.helper.Diverge({
date:this.day.date,enterTime:this.day.enterTime,enterDivergenceJudgement:this.day.enterDivergenceJudgement,enterDivergenceReason:(e||this.day).enterDivergenceReason,st:this.getRealStartTime(),exitTime:this.day.exitTime,exitDivergenceJudgement:this.day.exitDivergenceJudgement,exitDivergenceReason:(e||this.day).exitDivergenceReason,et:this.getRealEndTime()}).getJudge()},
teasp.data.EmpDay.prototype.getDispDivergence=function(e,t,a,o,s,i){if(i)return"";var n,i=this.parent.getPermitDivergenceTime(),r=this.getDivergenceJudge();if(r.type<=0||"number"!=typeof i)return"";if(1==s){if(!r.dIn.type||"number"!=typeof e||"number"!=typeof a)return"";n=e-a}else{if(!r.dOut.type||"number"!=typeof t||"number"!=typeof o)return"";n=t-o}return i<(n=Math.abs(n))?teasp.message.getLabel("ac00000240",i):""}
,teasp.data.EmpDay.prototype.isPast=function(){return this.day.date<teasp.util.date.formatDate(new Date)},teasp.data.EmpDay.prototype.getEnterTime=function(){return"number"==typeof this.day.enterTime||2!=this.day.enterDivergenceJudgement&&!this.isPast()?this.parent.getDisplayTime(this.day.enterTime,!1,"",null,!0):teasp.message.getLabel("ac00000440")},teasp.data.EmpDay.prototype.getExitTime=function(){
return"number"==typeof this.day.exitTime||2!=this.day.exitDivergenceJudgement&&!this.isPast()?this.parent.getDisplayTime(this.day.exitTime,!1,"",null,!0):teasp.message.getLabel("ac00000440")},teasp.data.EmpDay.prototype.getEnterDivergenceReason=function(e){var t=this.day.enterDivergenceReason||"";return t=e?t.replace(/\r?\n/g,"<br/>"):t},teasp.data.EmpDay.prototype.getExitDivergenceReason=function(e){
var t=this.day.exitDivergenceReason||"";return t=e?t.replace(/\r?\n/g,"<br/>"):t},teasp.data.EmpDay.prototype.getEnterDivergence=function(e){return this.getDispDivergence(this.day.startTime,this.day.endTime,this.day.enterTime,this.day.exitTime,1,e)},teasp.data.EmpDay.prototype.getExitDivergence=function(e){return this.getDispDivergence(this.day.startTime,this.day.endTime,this.day.enterTime,this.day.exitTime,2,e)},
teasp.data.EmpDay.prototype.isDivergeBeforeJudge=function(){return this.getDivergenceJudge().type<0&&!this.parent.isPermitDailyApply()},teasp.data.EmpDay.prototype.isDivergeNoReason=function(e){e=this.getDivergenceJudge(e);return 0<e.type&&!e.reason},teasp.data.EmpDay.prototype.getDivergeNg=function(){var e=teasp.util.date.formatDate(this.day.rack.key,"M/d");return this.isDivergeBeforeJudge(
)?e+" "+teasp.message.getLabel("ac00000490"):this.isDivergeNoReason()?e+" "+teasp.message.getLabel("ac00000430"):null},teasp.data.EmpDay.prototype.getProhibitOverNightWorkHoliday=function(){
return this.day.holiday1&&this.day.holiday1.config&&this.day.holiday1.config.prohibitOverNightWork?this.day.holiday1:this.day.holiday2&&this.day.holiday2.config&&this.day.holiday2.config.prohibitOverNightWork?this.day.holiday2:null},teasp.data.EmpDay.prototype.getMissingOverTime=function(e){var t=this.day.disc&&this.day.disc.svZan||0;return 0<e&&e<=t?t-e+1:0},teasp.data.EmpDay.prototype.getMissingEarlyWork=function(e
){var t=this.day.disc&&this.day.disc.svEst||0;return 0<e&&e<=t?t-e+1:0},teasp.data.EmpDay.prototype.isMissingLateStartApply=function(){var e=this.getBorderTime(!0);if(e.st<0)return!1;var t=this.day.disc?this.day.disc.calcStartTime:null;if("number"!=typeof t)return!1;if(t<=e.st)return!1;if(
this.day.dayType!=teasp.constant.DAY_TYPE_NORMAL&&this.day.rack&&this.day.rack.validApplys&&this.day.rack.validApplys.kyushtu&&this.day.rack.validApplys.kyushtu.length&&!this.day.rack.validApplys.kyushtu[0].useRegulateHoliday)return!1;var t=this.getEmpApplyByKey(teasp.constant.APPLY_KEY_LATESTART),a=t&&t.endTime<this.day.disc.startTime?teasp.logic.EmpTime.getSpanTime(teasp.util.time.excludeRanges([{from:t.endTime,
to:this.day.disc.startTime}],this.day.rack.hourRests)):0;return!t||0<a&&t.endTime<e.et},teasp.data.EmpDay.prototype.isMissingEarlyEndApply=function(){var e=this.getBorderTime(!0);if(e.et<0)return!1;var t=this.day.disc?this.day.disc.calcEndTime:null;if("number"!=typeof t)return!1;if(e.et<=t)return!1;if(
this.day.dayType!=teasp.constant.DAY_TYPE_NORMAL&&this.day.rack&&this.day.rack.validApplys&&this.day.rack.validApplys.kyushtu&&this.day.rack.validApplys.kyushtu.length&&!this.day.rack.validApplys.kyushtu[0].useRegulateHoliday)return!1;var t=this.getEmpApplyByKey(teasp.constant.APPLY_KEY_EARLYEND),a=t&&this.day.disc.endTime<t.startTime?teasp.logic.EmpTime.getSpanTime(teasp.util.time.excludeRanges([{
from:this.day.disc.endTime,to:t.startTime}],this.day.rack.hourRests)):0;return!t||0<a&&e.st<t.startTime},teasp.data.EmpDay.prototype.compareRestsAfterApply=function(e){if(!this.isInputTime())return{diff:!1};for(var t=this.day.pattern,a=t.restTimes,o=(t.useHalfHolidayRestTime&&(2==e.holidayRange?a=t.amHolidayRestTimes:3==e.holidayRange&&(a=t.pmHolidayRestTimes)),[]),s=this.day.timeTable||[],i=0;i<s.length;i++){
var n=s[i];n.type!=teasp.constant.REST_FIX&&n.type!=teasp.constant.REST_FREE||o.push(n)}e=teasp.util.convertSpanStrings(teasp.util.sortSpans(a)).join(", "),t=teasp.util.convertSpanStrings(teasp.util.sortSpans(o)).join(", ");return{note:teasp.message.getLabel("tf10009800",e||teasp.message.getLabel("tf10009810"),t||teasp.message.getLabel("tf10009810")),diff:teasp.util.compareSpans(a,o)}},
teasp.data.EmpDay.prototype.getSummaryOfHourlyLeave=function(){for(var e=this.day.rack.validApplys.holidayTime||[],t={},a=0;a<e.length;a++){var o=e[a],s=o&&o.holiday;s&&(p=(p=t[s.name])||(t[s.name]={name:s.name,time:0,order:s.order}),o=o._spendTime||0,s.yuqSpend?p.time+=60*Math.ceil(o/60):s.managed?p.time+=30*Math.ceil(o/30):p.time+=o)}var i,n=[];for(i in t)n.push(t[i]);for(var n=n.sort(function(e,t){
return e.order-t.order}),r=[],l=0;l<n.length;l++){var p=n[l];r.push(p.name+teasp.message.getLabel("tm10001680",teasp.util.time.timeValue(p.time)))}return r.join(",")},teasp.data.EmpDay.prototype.getArrayOfHourlyLeave=function(){for(var e=(e=this.day.rack.validApplys.holidayTime||[]).sort(function(e,t){return e.startTime-t.startTime}),t=[],a=0;a<e.length;a++){var o=e[a],s=o&&o.holiday;s&&(s.yuqSpend?t.push({
name:teasp.message.getLabel("tm10001170",teasp.util.time.timeValue(o.startTime)+"-"+teasp.util.time.timeValue(o.endTime))}):t.push({name:s.name+teasp.message.getLabel("tm10001680",teasp.util.time.timeValue(o.startTime)+"-"+teasp.util.time.timeValue(o.endTime))}))}return t},teasp.data.EmpDay.prototype.isConflictReviseTime=function(e,t,a){for(var o,s=this.day.rack.validApplys.reviseTime||[],i=[{from:e,to:t}],n=[],r=[],
l=0;l<s.length;l++){var p=s[l];if(p.status==teasp.constant.STATUS_WAIT){for(var d=teasp.data.EmpDay.fromJsonTT(p.oldValue),c=teasp.data.EmpDay.fromJsonTT(p.timeTable),l=0;l<d.length;l++)(m=d[l]).type!=teasp.constant.REST_FIX&&m.type!=teasp.constant.REST_FREE||n.push(m);for(var m,l=0;l<c.length;l++)(m=c[l]).type!=teasp.constant.REST_FIX&&m.type!=teasp.constant.REST_FREE||r.push(m);if(p=teasp.logic.EmpTime.getSpanTime(
teasp.util.time.excludeRanges(i,n)),o=teasp.logic.EmpTime.getSpanTime(teasp.util.time.excludeRanges(i,r)),Math.ceil(p/a)*a!=Math.ceil(o/a)*a)return!0}}if(s.length){e=this.getPattern().restTimes||[];if(teasp.logic.EmpTime.getSpanTime(teasp.util.time.includeRanges(i,e))<teasp.logic.EmpTime.getSpanTime(teasp.util.time.includeRanges(i,r)))return!0}return!1},teasp.data.EmpDay.prototype.isConflictTimeHoliay=function(e,t){
for(var a=(a=this.day.rack.validApplys.holidayTime||[]).sort(function(e,t){return e.startTime-t.startTime}),o=[],s=[],i=0;i<e.length;i++)(r=e[i]).type!=teasp.constant.REST_FIX&&r.type!=teasp.constant.REST_FREE||o.push(r);for(o=o.sort(function(e,t){return e.from==t.from?e.to-t.to:e.from-t.from}),i=0;i<t.length;i++)(r=t[i]).type!=teasp.constant.REST_FIX&&r.type!=teasp.constant.REST_FREE||s.push(r);var s=s.sort(
function(e,t){return e.from==t.from?e.to-t.to:e.from-t.from}),n=o.length!=s.length;if(!n)for(i=0;i<o.length;i++){var r=o[i],l=s[i];if(r.from!=l.from||r.to!=l.to){n=!0;break}}if(!n)return!1;for(var p=0;p<a.length;p++){var d=a[p],c=d.holiday||{},m=1,c=(c.yuqSpend?m=60:c.managed&&(m=30),[{from:d.startTime,to:d.endTime}]),d=teasp.logic.EmpTime.getSpanTime(teasp.util.time.excludeRanges(c,o)),
c=teasp.logic.EmpTime.getSpanTime(teasp.util.time.excludeRanges(c,s));if(Math.ceil(d/m)*m!=Math.ceil(c/m)*m)return!0}return!1},teasp.data.EmpDay.prototype.canSelectShiftChange=function(e){var t,a=this.parent.getShiftChangeableDates(e),o=!1;for(t in a)a.hasOwnProperty(t)&&a[t].changeable&&(o=!0);return o},teasp.data.EmpDay.prototype.getValidApplys=function(){return this.day.rack.validApplys||null},
teasp.data.EmpDay.prototype.isFlexHalfDayTimeDay=function(){return!(!this.parent.isFlexibleHalfDayTime()||!this.day.rack.flexFlag||this.isUseCoreTime())},teasp.data.EmpDay.prototype.getWorkLocationId=function(){return this.day.workLocationId||null},teasp.data.EmpDay.prototype.getWorkLocationName=function(){const e=this.parent.getWorkLocationById(this.day.workLocationId);return e&&e.getName()||""},
teasp.data.EmpDay.prototype.getAwayTimes=function(){const t=[];return dojo.forEach(this.getTimeTable(),function(e){e.type==teasp.constant.AWAY&&t.push(e)}),t},teasp.provide("teasp.data.EmpWork"),teasp.data.EmpWork=function(e,t){this.workObj=e,this.extraItems=t},teasp.data.EmpWork.prototype.getDate=function(){return this.workObj.date},teasp.data.EmpWork.prototype.getNo=function(){return this.workObj.order},
teasp.data.EmpWork.prototype.getProcess=function(){return this.workObj.process},teasp.data.EmpWork.prototype.getJobId=function(){return this.workObj.jobId},teasp.data.EmpWork.prototype.getJobName=function(){return this.workObj.job.name},teasp.data.EmpWork.prototype.getJobLeaderId=function(){return this.workObj.job.jobLeaderId},teasp.data.EmpWork.prototype.getProcessName=function(){return this.workObj.process||""},
teasp.data.EmpWork.prototype.getTime=function(){return this.workObj.time||0},teasp.data.EmpWork.prototype.getPercent=function(e){return 0<e?Math.round(1e3*this.workObj.time/e):this.workObj.percent},teasp.data.EmpWork.prototype.getVolume=function(){return this.workObj.volume||0},teasp.data.EmpWork.prototype.getProgress=function(){return this.workObj.progress||""},teasp.data.EmpWork.prototype.getTaskNote=function(){
return this.workObj.taskNote||""},teasp.data.EmpWork.prototype.getExtraItems=function(){return this.extraItems},teasp.provide("teasp.data.EmpExp"),teasp.data.EmpExp=function(e){this.expLog=e},teasp.data.EmpExp.prototype.getId=function(){return this.expLog.id},teasp.data.EmpExp.prototype.getNo=function(){return this.expLog.order||""},teasp.data.EmpExp.prototype.getItemName=function(){return this.expLog.expItem.name},
teasp.data.EmpExp.prototype.getRoute=function(){return this.expLog.route},teasp.data.EmpExp.prototype.isEkitan=function(){return 1==this.expLog.transportType},teasp.data.EmpExp.prototype.isReceipt=function(){return this.expLog.receipt},teasp.data.EmpExp.prototype.isCurrency=function(){return(this.expLog.expItem||this.expLog).foreignFlag},teasp.data.EmpExp.prototype.isTax=function(){return this.expLog.taxFlag},
teasp.data.EmpExp.prototype.isExtraItem=function(){return!(!this.expLog.useExtraItem1&&!this.expLog.useExtraItem2)},teasp.data.EmpExp.prototype.isIc=function(){return teasp.constant.IC_INPUTS.contains(this.expLog.item||"")},teasp.data.EmpExp.prototype.isUber=function(){return this.expLog.item&&"uber"==this.expLog.item},teasp.data.EmpExp.prototype.isQuantity=function(){
return!!this.expLog.expItem&&this.expLog.expItem.enableQuantity},teasp.data.EmpExp.prototype.isPayment=function(){return this.expLog.payee||this.expLog.paymentDate},teasp.data.EmpExp.prototype.getChargeDept=function(){return this.expLog.chargeDept||null},teasp.data.EmpExp.prototype.getCost=function(){return this.expLog.cost},teasp.data.EmpExp.prototype.getDetail=function(){return this.expLog.detail||""},
teasp.data.EmpExp.prototype.getRouteName=function(e){var t;return 0==this.expLog.transportType?"":(t=teasp.message.getLabel(this.expLog.roundTrip?"tm20009040":"tm20009060",teasp.util.entitizf(this.expLog.startName),teasp.util.entitizf(this.expLog.endName)),e&&e.ICCardMode&&"1"==e.ICCardMode&&(t+="  "+teasp.message.getLabel("tk10005550")),t)},teasp.data.EmpExp.prototype.getCurrencyInfo=function(){var e,t;
return this.expLog.foreignFlag?(e=teasp.util.currency.formatDecimal(this.expLog.currencyRate,teasp.constant.CU_DEC_POINT_MIN,teasp.constant.CU_DEC_POINT_MAX),t=teasp.util.currency.formatDecimal(this.expLog.foreignAmount,0,teasp.constant.CU_DEC_POINT_MAX,!0),teasp.message.getLabel("tm20001170",teasp.util.entitizf(this.expLog.currencyName),e.str,t.str)):""},teasp.data.EmpExp.prototype.getTaxInfo=function(){if(
this.expLog.taxFlag){var e="",t="";switch(this.expLog.taxAuto||(e=teasp.message.getLabel("tm20001200")),this.expLog.taxType){case"1":t=teasp.message.getLabel("tm20001210");break;case"2":t=teasp.message.getLabel("tm20001220");break;case"0":return t=teasp.message.getLabel("tm20001230")}return t+" : "+teasp.util.currency.formatMoney(this.expLog.tax,"&#165;#,##0")+e}return""},
teasp.data.EmpExp.prototype.getQuantityInfo=function(){var e=teasp.message.getLabel("tm10001070",teasp.message.getLabel("tm20004720"),teasp.util.currency.formatMoney(this.expLog.unitPrice,"&#165;#,##0")),e=(e+="&nbsp;&nbsp;")+teasp.message.getLabel("tm10001070",teasp.message.getLabel("tm20004730"),this.expLog.quantity||"-");return this.expLog.expItem&&this.expLog.expItem.unitName&&(e+=" "+teasp.util.entitizf(
this.expLog.expItem.unitName)),e},teasp.data.EmpExp.prototype.getPayeeType=function(){return this.expLog.payee&&this.expLog.payee.payeeType||null},teasp.data.EmpExp.prototype.getCardStatementLineId=function(){return this.expLog.cardStatementLineId||null},teasp.data.EmpExp.prototype.isCardStatementLine=function(){return!(!this.expLog.cardStatementLineId||this.isReceiptInput())},
teasp.data.EmpExp.prototype.isReceiptInput=function(){return this.expLog.cardStatementLine&&"領収書"==this.expLog.cardStatementLine.recordTypeName},teasp.data.EmpExp.prototype.getPayeeInfo=function(){var e=[];return this.expLog.payee&&this.expLog.payee.name&&e.push(teasp.message.getLabel("tm10001070",teasp.message.getLabel("tf10000580"),teasp.util.entitizf(this.expLog.payee.name))),this.expLog.paymentDate&&e.push(
teasp.message.getLabel("tm10001070",teasp.message.getLabel("tf10000590"),teasp.util.date.formatDate(this.expLog.paymentDate,"SLA"))),0<e.length?e.join("<br/>"):""},teasp.data.EmpExp.prototype.getExtraItemInfo=function(){var e;return!(!this.expLog.useExtraItem1&&!this.expLog.useExtraItem2)?(e="",(e+=this.expLog.useExtraItem1?'<span style="white-space:nowrap">'+teasp.util.entitizf(this.expLog.expItem.extraItem1Name
)+":</span>"+teasp.util.entitizf(this.expLog.extraItem1)+"<br />":"")+(this.expLog.useExtraItem2?'<span style="white-space:nowrap">'+teasp.util.entitizf(this.expLog.expItem.extraItem2Name)+":</span>"+teasp.util.entitizf(this.expLog.extraItem2):"")):""},teasp.data.EmpExp.prototype.hasAttachments=function(){return!!this.expLog.attachments},teasp.data.WorkLocation=function(e){this.obj=e,this.initFlag=!1},
teasp.data.WorkLocation.prototype.getId=function(){return this.obj.Id},teasp.data.WorkLocation.prototype.getName=function(){return this.obj.Name},teasp.data.WorkLocation.prototype.isRemoved=function(){return this.obj.Removed__c||!1},teasp.data.WorkLocation.prototype.setInitFlag=function(e){this.initFlag=e},teasp.data.WorkLocation.prototype.isInitFlag=function(){return this.initFlag},teasp.provide("teasp.data.Pouch"),
teasp.data.Pouch=function(){this.dataObj={common:null,events:null,expItems:null,expApplyHistory:null,foreignCurrency:null,workNotes:[],fixTimeMap:{}},this.countNight=!1},teasp.data.Pouch.NG_JOB_ASSIGN_EMP=1,teasp.data.Pouch.NG_JOB_ASSIGN_CLASS=2,teasp.data.Pouch.NG_JOB_OUT_OF_TERM=3,teasp.data.Pouch.prototype.getObj=function(){return this.dataObj},teasp.data.Pouch.prototype.getKeyObj=function(e){
return this.dataObj[e]},teasp.data.Pouch.prototype.getParams=function(){return this.dataObj.params||{}},teasp.data.Pouch.prototype.setParams=function(e){this.dataObj.params=e},teasp.data.Pouch.prototype.getParamByKey=function(e){return this.dataObj.params[e]},teasp.data.Pouch.prototype.getParamDate=function(){return this.dataObj.params.date},teasp.data.Pouch.prototype.getToday=function(){
return teasp.util.date.formatDate(teasp.util.date.getToday())},teasp.data.Pouch.prototype.setKeyObj=function(e,t){var a;if("targetEmp"==e)this.dataObj.targetEmp=t,this.dataObj.targetEmp.originalEmpType={empTypeId:this.dataObj.targetEmp.empTypeId,empTypeName:this.dataObj.targetEmp.empTypeName,configBase:this.dataObj.targetEmp.configBase,daiqManage:this.dataObj.targetEmp.daiqManage,
holidayStock:this.dataObj.targetEmp.holidayStock};else if("deptHist"==e){this.dataObj.deptHist=t&&t.empDeptHist||[],this.dataObj.deptOwnHist=t&&t.deptOwnHist||[];var o=this.dataObj.deptHist.sort(function(e,t){return!e.endDate&&t.endDate?-1:e.endDate&&!e.endDate||e.endDate<t.endDate?1:e.endDate>t.endDate?-1:0}),s={deptId:this.dataObj.targetEmp.deptId,deptName:this.dataObj.targetEmp.deptName,
deptCode:this.dataObj.targetEmp.deptCode,startDate:null,endDate:null,startMonth:null,endMonth:null};0<o.length&&(s.startDate=teasp.util.date.addDays(o[0].endDate,1)),this.dataObj.deptHist.unshift(s)}else if("common"==e){for(var i={},n=[],r=(this.dataObj[e]=t).jobInitialDateHistory||[],l=0;l<r.length;l++)i[(b=r[l]).date]=b,n.push(b.date);n=n.sort(function(e,t){return e.date<t.date?-1:e.date>t.date?1:0});var p=[],
d=null;for(l=0;l<n.length;l++){var c=n[l];p.push({sd:d,ed:teasp.util.date.addDays(c,-1),initialDateOfMonth:i[c].initialDateOfMonth,markOfMonth:i[c].markOfMonth}),d=c}p.push({sd:d,ed:null,initialDateOfMonth:t.jobInitialDayOfMonth,markOfMonth:t.jobMarkOfMonth}),this.dataObj.jobInitHistory=p}else if("empTypeInfo"==e){if(this.getEmpId()){var i={},n=[],m=t.empTypeHistory||[];for(l=0;l<m.length;l++){var h=m[l];h.empType&&(
i[h.date]=h.empType,n.push(h.date))}(n=n.sort(function(e,t){return e.date<t.date?-1:e.date>t.date?1:0})).push(null),i.null=t.empTypeMap[this.dataObj.targetEmp.originalEmpType.empTypeId];var p=[],d=null,u=null;for(l=0;l<n.length;l++)(b={sd:d,ed:(c=n[l])?teasp.util.date.addDays(c,-1):null,empType:i[c]}
).stamp=b.empType.configBase.initialDateOfMonth+"-"+b.empType.configBase.markOfMonth+"-"+b.empType.configBase.initialDateOfYear+"-"+b.empType.configBase.markOfYear+"-"+b.empType.configBase.initialDayOfWeek,u&&u.stamp==b.stamp?b.id=u.id:b.id=u?b.sd:null,p.push(b),u=b,d=c;var g=[];for(l=0;l<p.length;l++){var y,f,b=p[l],_=l<p.length-1?p[l+1]:null,H=!1;_&&b.stamp==_.stamp&&(y=teasp.util.date.addDays(b.ed,1),(
f=teasp.util.searchYearMonthDate(b.empType.configBase.initialDateOfMonth,b.empType.configBase.markOfMonth,null,y)).startDate!=y&&(!b.sd||b.sd<f.startDate?(b.ed=teasp.util.date.addDays(f.startDate,-1),_.sd=f.startDate):(_.sd=b.sd,H=!0))),b.sd&&b.ed&&!(b.sd<=b.ed)||H||g.push(b)}for(l=0;l<g.length;l++){b=g[l];console.log(b.sd+" - "+b.ed+" empType="+b.empType.empTypeName)}this.dataObj.empTypeHistory=g,
this.dataObj.empTypeMap=t.empTypeMap,(this.dataObj.empTypeInfo=t)&&this.setEmpTypeByDate(t.ym,t.dt)}}else if("empMonthList"==e)for(this.dataObj.empMonthList=t||[],this.dataObj.empMonthMap={},l=0;l<this.dataObj.empMonthList.length;l++)(E=this.dataObj.empMonthList[l]).empType=this.dataObj.empTypeMap[E.empTypeId]||null,E.monthEx=E.startDate,this.dataObj.empMonthMap[E.monthEx]=E;else if("months"==e){var v=t.months,
T=t.deptMonths||[],i={};for(l=0;l<T.length;l++)i[T[l].yearMonth]=T[l];var P={};for(l=0;l<v.length;l++)P[v[l].id]=v[l];var j,E,C={},v=[],L=null;for(l=0;l<this.dataObj.empMonthList.length;l++)(E=this.dataObj.empMonthList[l]).empMonthId?(j=P[E.empMonthId]||{})._em=E:i[(j={yearMonth:E.yearMonth,startDate:E.startDate,endDate:E.endDate,id:null,apply:{id:null,status:null},inputFlag:this.dataObj.targetEmp.inputFlag,empty:!0,
_em:E}).yearMonth]&&(j.deptMonth=i[j.yearMonth]),j.subNo=j._em.subNo,j.monthEx=j._em.monthEx,j.startDate<=this.dataObj.params.startDate&&this.dataObj.params.startDate<=j.endDate&&(L=j,v.length&&v[v.length-1]._em.initialDate!=L._em.initialDate&&(L.resetFlag=!0)),v.push(j),C[j.monthEx]=j;this.dataObj.months=v,this.dataObj.empMonthMap=C,this.dataObj.month=L,this.dataObj.targetEmp&&(s=null,(
s=L&&L.empTypeId&&this.isEmpMonthFixed(L,!0)?L:this.dataObj.targetEmp.currentEmpType||this.dataObj.targetEmp.originalEmpType)&&this.dataObj.targetEmp.empTypeId!=s.empTypeId&&(this.dataObj.targetEmp.empTypeId=s.empTypeId,this.dataObj.targetEmp.empTypeName=s.empTypeName,this.dataObj.targetEmp.configBase=s.configBase,this.dataObj.targetEmp.daiqManage=s.daiqManage,this.dataObj.targetEmp.holidayStock=s.holidayStock),(
s=this.getDeptByMonth(L))?(s.histDept&&(s=s.histDept),this.dataObj.targetEmp.deptId=s.deptId,this.dataObj.targetEmp.deptName=s.deptName,this.dataObj.targetEmp.deptCode=s.deptCode):(s=this.getDeptAtTheTime(this.dataObj.targetEmp,L.endDate)).deptId!=this.dataObj.targetEmp.deptId&&(this.dataObj.targetEmp.deptId=s.deptId,this.dataObj.targetEmp.deptName=s.deptName,this.dataObj.targetEmp.deptCode=s.deptCode))}else if(
"configs"==e){if(this.dataObj.months){var k=t;for(l=0;l<k.length;l++)for(var D in(a=k[l]).restTimeCheck&&1<a.restTimeCheck.length&&(a.restTimeCheck=a.restTimeCheck.sort(function(e,t){return e.workTime-t.workTime})),this.dataObj.empMonthMap)this.dataObj.empMonthMap.hasOwnProperty(D)&&(E=this.dataObj.empMonthMap[D],this.isEmpMonthFixed(E,!0)&&E.configId?teasp.util.equalId(E.configId,a.id)&&(E.config=a
):a.originalId||a.removed||a.configBaseId!=E._em.configBaseId||a.validStartDate&&!(a.validStartDate<=E.endDate)||a.validEndDate&&!(a.validEndDate>=E.startDate)||(E.config=a));for(D in this.dataObj.empMonthMap)this.dataObj.empMonthMap.hasOwnProperty(D)&&((E=this.dataObj.empMonthMap[D]).fixHolidays=getHolidaysEx(teasp.util.date.parseDate(E.startDate),teasp.util.date.parseDate(E.endDate),E.config.holidays,
E.config.nonPublicHoliday));this.dataObj.configs=k,this.dataObj.month&&(this.dataObj.config=this.dataObj.month.config)}else 1==t.length&&(this.dataObj.config=t[0]);this.dataObj.config.workSystem==teasp.constant.WORK_SYSTEM_MANAGER&&(this.countNight=!0)}else if("sumTime"==e){this.dataObj.month.totalWorkOverTime36=t.totalWorkOverTime36,this.dataObj.month.totalWorkOverCount36=t.totalWorkOverCount36;
s=this.dataObj.month.config;this.dataObj.month.quartWorkOverTime36=t.quartWorkOverTime36,s&&s.workSystem==teasp.constant.WORK_SYSTEM_MUTATE&&1<s.variablePeriod&&(this.dataObj.month.preWorkLegalTimeOfPeriod=t.periodWorkTime||0,this.dataObj.month.legalTimeOfPeriod=Math.floor(t.periodDayCount/7*40*60)),this.dataObj.carryforwardMap=t.carryforwardMap||{},this.dataObj.realWorkTimeWoLHMap=t.realWorkTimeWoLHMap||{},
this.dataObj.amountTimeMap=t.amountTimeMap||{},this.dataObj.settlementTimeMap=t.settlementTimeMap||{}}else if("jobApply"==e){s=(s=t)||{yearMonth:this.dataObj.params.month,startDate:this.dataObj.params.startDate,endDate:this.dataObj.params.endDate,subNo:this.dataObj.params.subNo,id:null,status:null};this.dataObj.jobApply=s}else if("jobAssigns"==e){s=t.sort(function(e,t){return e.order-t.order});
this.dataObj.jobAssigns=s}else if("works"==e){var I=t.sort(function(e,t){var a=teasp.util.date.compareDate(e.date,t.date);return a||e.order-t.order});for(l=0;l<I.length;l++)I[l].no=l+1;this.dataObj.works=I}else if("expApply"==e)this.dataObj.expApply=0<t.length?t[0]:null;else if("expLogs"==e){var A=t.sort(function(e,t){var a=teasp.util.date.compareDate(e.date,t.date);return a||e.order-t.order}),S={},W={},x=[],F=0,
c=null;for(l=0;l<A.length;l++){var w=A[l],M=w.date+":"+(w.expApplyId||"")+":"+(w.jobId||"");w.date!=c&&(c=w.date,F=1),w.no=F++,(o=(o=S[M])||(S[M]=[])).push(w),x.contains(M)||x.push(M),W.hasOwnProperty(M)||(W[M]=w.job?w.job.name:"")}for(A=[],l=0;l<x.length;l++)M=x[l],A=A.concat(S[M]);this.dataObj.expLogs=A}else if("expHistory"==e)t&&(t=dojo.fromJson(t),this.dataObj.stationHist=t.stationHist||[],
this.dataObj.routeHist=t.routeHist||[],0<this.dataObj.stationHist.length&&(this.dataObj.stationHist=this.dataObj.stationHist.reverse()));else if("txsLogs"==e){r=[];if(t){for(l=0;l<t.length;l++){var O,R,N=t[l];N.target&&(N.date=this.dataObj.params.date,R=teasp.util.date.getTzDateTime(N.targetTime),N.st=60*R.getHours()+R.getMinutes(),N.moved=!1,c=teasp.util.date.formatDate(R),this.dataObj.params.date!=c&&1<(
O=teasp.util.date.daysInRange(this.dataObj.params.date,c))&&(N.st+=1440*(O-1)),N.endTime&&(R=teasp.util.date.getTzDateTime(N.endTime),N.et=60*R.getHours()+R.getMinutes(),c=teasp.util.date.formatDate(R),this.dataObj.params.date!=c&&1<(O=teasp.util.date.daysInRange(this.dataObj.params.date,c))&&(N.et+=1440*(O-1))),
"Task"!=N.target.type&&"Event"!=N.target.type&&"Account"!=N.target.type&&"Opportunity"!=N.target.type&&"AtkJob__c"!=N.target.type||r.push(N))}r.sort(function(e,t){return e.targetTime.getTime()-t.targetTime.getTime()})}this.dataObj.txsLogs=r}else"depts"==e?(teasp.util.levelingDepts(t),this.dataObj.depts=t):"workLocations"==e?this.setWorkLocations(t||[]):this.dataObj[e]=t},
teasp.data.Pouch.prototype.setEmpInfo=function(e,t){this.dataObj.sessionInfo=e,this.dataObj.targetEmp=t},teasp.data.Pouch.prototype.setEmpTypeByDate=function(e,t){this.dataObj.targetEmp.currentEmpType=this.getEmpTypeByDate(e,t)},teasp.data.Pouch.prototype.getEmpTypeByDate=function(e,t){for(var a=t,o=(t||(a=(a=""+e).substring(0,4)+"-"+a.substring(4,6)+"-01"),this.getEmpMonthList(a,2,-2)),s=null,i=0;i<o.length;i++){
var n=o[i];if(!t&&n.yearMonth==e||t&&n.startDate<=t&&t<=n.endDate){s=n;break}}return s.empType},teasp.data.Pouch.prototype.resetDailyData=function(){delete this.dataObj.classifyJobWorks,delete this.dataObj.works,delete this.dataObj.expLogs,delete this.dataObj.events},teasp.data.Pouch.prototype.getDisplayTime=function(e,t,a,o,s){if("number"!=typeof e)return a||"";if(t)return e;a=this.dataObj.config.timeFormat||"hh:mm"
if(0===e)return o||""==o?o:"hh:mm"==a?"0:00":"0.00";t=e<0,t&&s&&(e=1440+e),t&&(e=Math.abs(e)),o=Math.floor(e/60),e=Math.round(e)%60,a="hh:mm"!=a?o+"."+((e=Math.round(100*e/60))<10?"0":"")+e:o+":"+(e<10?"0":"")+e;return t&&s?teasp.message.getLabel("ac00000600",a):(t?"-":"")+a},teasp.data.Pouch.prototype.getStatusIconClass=function(e,t){
return e==teasp.constant.STATUS_WAIT||e==teasp.constant.STATUS_APPROVING?"sts008":e==teasp.constant.STATUS_APPROVE||e==teasp.constant.STATUS_ADMIT?"sts005":teasp.constant.STATUS_REJECTS.contains(e)?"sts006":"sts004"},teasp.data.Pouch.prototype.isReadOnly=function(e){var t=teasp.constant.P_E;return e==teasp.constant.TARGET_EXP&&(t|=teasp.constant.P_AX),"edit"!=this.dataObj.targetEmp.mode||0==this.getRights(t)},
teasp.data.Pouch.prototype.getMode=function(){return this.dataObj.targetEmp.mode},teasp.data.Pouch.prototype.getSessionUserName=function(){return this.dataObj.sessionInfo.user.name},teasp.data.Pouch.prototype.getCommonObj=function(){return this.dataObj.common},teasp.data.Pouch.prototype.getHelpLink=function(){return this.dataObj.common.helpLink},teasp.data.Pouch.prototype.getInfoLink=function(){
return this.dataObj.common.infoLink},teasp.data.Pouch.prototype.isCheckDefaultDailyFix=function(){return this.dataObj.common.checkDefaultDailyFix},teasp.data.Pouch.prototype.isJobLeaderFilter=function(){return this.dataObj.common.jobLeaderFilter},teasp.data.Pouch.prototype.isSysAdmin=function(){return this.dataObj.sessionInfo.user.sysAdmin},teasp.data.Pouch.prototype.isAdmin=function(e){return!(!e||!this.isSysAdmin()
)||this.dataObj.sessionInfo.emp.isAdmin},teasp.data.Pouch.prototype.isExpAdmin=function(){return this.dataObj.sessionInfo.emp.isExpAdmin},teasp.data.Pouch.prototype.isAllEditor=function(){return this.dataObj.sessionInfo.emp.isAllEditor},teasp.data.Pouch.prototype.isAllReader=function(){return this.dataObj.sessionInfo.emp.isAllReader},teasp.data.Pouch.prototype.getRights=function(e){
return this.dataObj.sessionInfo.user.rights&(e||0)},teasp.data.Pouch.prototype.isOnlyJL=function(){var e=this.dataObj.sessionInfo.user.rights;return 0!=(e&teasp.constant.P_JL)&&0==(e&~teasp.constant.P_JL)},teasp.data.Pouch.prototype.getTargetEmpObj=function(){return this.dataObj.targetEmp},teasp.data.Pouch.prototype.getEmpId=function(){return this.dataObj.targetEmp?this.dataObj.targetEmp.id:null},
teasp.data.Pouch.prototype.getSmallPhotoUrl=function(){return this.dataObj.targetEmp&&this.dataObj.targetEmp.smallPhotoUrl||null},teasp.data.Pouch.prototype.getEmpTypeId=function(){return this.dataObj.targetEmp.empTypeId},teasp.data.Pouch.prototype.getEmpTypeName=function(){return this.dataObj.targetEmp.empTypeName},teasp.data.Pouch.prototype.getTitle=function(){return this.dataObj.targetEmp.title||""},
teasp.data.Pouch.prototype.getName=function(){return this.dataObj.targetEmp.name},teasp.data.Pouch.prototype.getEmpCode=function(){return this.dataObj.targetEmp.code},teasp.data.Pouch.prototype.getDeptId=function(){return this.dataObj.targetEmp.deptId},teasp.data.Pouch.prototype.getDeptCode=function(){return this.dataObj.targetEmp.deptCode},teasp.data.Pouch.prototype.getDeptName=function(){
return this.dataObj.targetEmp.deptName},teasp.data.Pouch.prototype.getEntryDate=function(){return this.dataObj.targetEmp.entryDate},teasp.data.Pouch.prototype.getEndDate=function(){return this.dataObj.targetEmp.endDate},teasp.data.Pouch.prototype.getNextYuqProvideDate=function(){return this.dataObj.targetEmp.nextYuqProvideDate},teasp.data.Pouch.prototype.getUserName=function(){return this.dataObj.targetEmp.userName},
teasp.data.Pouch.prototype.getManagerName=function(){return this.dataObj.targetEmp.managerName},teasp.data.Pouch.prototype.isOwner=function(){return teasp.util.equalId(this.dataObj.targetEmp.userId,this.dataObj.sessionInfo.user.id)},teasp.data.Pouch.prototype.getInputFlag=function(){return this.dataObj.month.inputFlag},teasp.data.Pouch.prototype.getSessionUserId=function(){return this.dataObj.sessionInfo.user.id},
teasp.data.Pouch.prototype.isKeepExteriorTime=function(){return this.dataObj.common.keepExteriorTime},teasp.data.Pouch.prototype.isOldRevision=function(){return void 0!==this.dataObj.common.borderRevNo&&(!!this.dataObj.common.borderRevNo&&this.dataObj.common.revision<this.dataObj.common.borderRevNo)},teasp.data.Pouch.prototype.getDebugOption=function(){return{debugLev:teasp.constant.LEVEL_OFF}},
teasp.data.Pouch.prototype.isDebug=function(){return!!(this.dataObj.common.localKey&&7<this.dataObj.common.localKey.length&&"1"==this.dataObj.common.localKey.substring(7,8))},teasp.data.Pouch.prototype.isApplyLimitOff=function(){return!!(this.dataObj.common.localKey&&8<this.dataObj.common.localKey.length&&"1"==this.dataObj.common.localKey.substring(8,9))},teasp.data.Pouch.prototype.isBulkTestOn=function(){return!!(
this.dataObj.common.localKey&&9<this.dataObj.common.localKey.length&&"1"==this.dataObj.common.localKey.substring(9,10))},teasp.data.Pouch.prototype.isBulkInputOn=function(){return!!(this.dataObj.common.localKey&&11<this.dataObj.common.localKey.length&&"1"==this.dataObj.common.localKey.substring(11,12))},teasp.data.Pouch.prototype.isDiscoFlag=function(){return!!(
this.dataObj.common.localKey&&12<this.dataObj.common.localKey.length&&"1"==this.dataObj.common.localKey.substring(12,13))},teasp.data.Pouch.prototype.isYuqZanFlag=function(){return!!(this.dataObj.common.localKey&&13<this.dataObj.common.localKey.length&&"1"==this.dataObj.common.localKey.substring(13,14))},teasp.data.Pouch.prototype.isAllowMinusExpApply=function(){return!!(
this.dataObj.common.localKey&&14<this.dataObj.common.localKey.length&&"1"==this.dataObj.common.localKey.substring(14,15))},teasp.data.Pouch.prototype.getClearLevel=function(){if(this.dataObj.common.localKey&&15<this.dataObj.common.localKey.length){var e=this.dataObj.common.localKey.substring(15,16);if(/[0-9]/.test(e))return parseInt(e,10)}return 0},teasp.data.Pouch.prototype.isCountZeroWorkTime=function(){return!!(
this.dataObj.common.localKey&&16<this.dataObj.common.localKey.length&&"1"==this.dataObj.common.localKey.substring(16,17))},teasp.data.Pouch.prototype.isAutoVerify=function(){return void 0===this.autoVerify&&(this.autoVerify=!!(this.dataObj.common.localKey&&17<this.dataObj.common.localKey.length&&"1"==this.dataObj.common.localKey.substring(17,18))),this.autoVerify},
teasp.data.Pouch.prototype.isDefaultIsBorderTime=function(e){var t=this.getObj().config.config;if(t&&t.empApply){if(1==e&&"boolean"==typeof t.empApply.overTimeInitOverFlexZone)return t.empApply.overTimeInitOverFlexZone;if(2==e&&"boolean"==typeof t.empApply.earlyWorkInitOverFlexZone)return t.empApply.earlyWorkInitOverFlexZone}return!!(
this.dataObj.common.localKey&&19<this.dataObj.common.localKey.length&&"1"==this.dataObj.common.localKey.substring(19,20))},teasp.data.Pouch.prototype.isRemarksRigorous=function(){return!!(this.dataObj.common.localKey&&21<this.dataObj.common.localKey.length&&"1"==this.dataObj.common.localKey.substring(21,22))},teasp.data.Pouch.prototype.setAutoVerify=function(e){this.autoVerify=e},
teasp.data.Pouch.prototype.isApprover=function(e){return e.status==teasp.constant.STATUS_WAIT&&(this.dataObj.approver&&this.dataObj.approver[e.id])},teasp.data.Pouch.prototype.isRequireNote=function(e){if(!this.dataObj.common.requireNote)return!1;var t=this.dataObj.common.requireNoteOption;return!t||t.length<=0||!(!t.contains("all")&&!t.contains(e))},teasp.data.Pouch.prototype.isNonDialogMode=function(){try{var e;
void 0===this.dataObj.nonDialogMode&&(!this.dataObj.common.nonDialogKey||/iPad/.test(navigator.userAgent)?this.dataObj.nonDialogMode=!1:(e=new RegExp(this.dataObj.common.nonDialogKey,"i"),this.dataObj.nonDialogMode=e.test(navigator.userAgent)))}catch(e){}return this.dataObj.nonDialogMode||!1},teasp.data.Pouch.prototype.isNotInfoAutoView=function(){return this.dataObj.common.notInfoAutoView||!1},
teasp.data.Pouch.prototype.isMsDailyWorkTimeIsReal=function(){return this.dataObj.common.msDailyWorkTimeIsReal||!1},teasp.data.Pouch.prototype.isDisabledTimeReport=function(){return this.dataObj.common.disabledTimeReport||!1},teasp.data.Pouch.prototype.isDisabledEmpExp=function(){return this.dataObj.common.disabledEmpExp||!1},teasp.data.Pouch.prototype.isDisabledEmpJob=function(){
return this.dataObj.common.disabledEmpJob||!1},teasp.data.Pouch.prototype.isNoteNewLine=function(){return this.dataObj.common.workNoteCrlfOn||!1},teasp.data.Pouch.prototype.convNoteString=function(e){return this.isNoteNewLine()?(e||"").replace(/\n/g,"<br/>"):e||""},teasp.data.Pouch.prototype.getHandleInvalidApply=function(){return this.dataObj.common.handleInvalidApply||0},
teasp.data.Pouch.prototype.isClarifyAfterApply=function(){return this.dataObj.common.clarifyAfterApply||!1},teasp.data.Pouch.prototype.isHideMonthlySummary=function(){return this.dataObj.common.hideMonthlySummary||!1},teasp.data.Pouch.prototype.isHideBottomSummary=function(){return this.dataObj.common.hideBottomSummary||!1},teasp.data.Pouch.prototype.isHideTimeGraphPopup=function(){
return this.dataObj.common.hideTimeGraphPopup||!1},teasp.data.Pouch.prototype.isPermitLeavingPush24hours=function(){return this.dataObj.common.permitLeavingPush24hours||!1},teasp.data.Pouch.prototype.isPermitStartBtnDateChange=function(){return this.dataObj.common.permitStartBtnDateChange||!1},teasp.data.Pouch.prototype.isSeparateDailyNote=function(){return this.dataObj.common.separateDailyNote||!1},
teasp.data.Pouch.prototype.isProhibitAcrossMonthApply=function(){return this.dataObj.common.prohibitAcrossMonthApply||!1},teasp.data.Pouch.prototype.getApproverName=function(e){for(var t=e.approvers||[],a=[],o=null,s=0;s<t.length;s++){var i=t[s];!i||o&&o==i.id||(a.push(i.name),o=o||i.id)}return a.join(", ")},teasp.data.Pouch.prototype.isLoadedApproverSet=function(){return!!this.dataObj.approverSet},
teasp.data.Pouch.prototype.getApproverSetName=function(e){return this.dataObj.approverSet?this.getApproverName(this.dataObj.approverSet[e]):""},teasp.data.Pouch.prototype.getApproverSetId=function(e){return this.dataObj.approverSet&&this.dataObj.approverSet[e]?this.dataObj.approverSet[e].id:""},teasp.data.Pouch.prototype.isUseApproverSet=function(e){return e==teasp.constant.APPLY_KEY_JOBAPPLY?this.isUseJobWorkFlow(
)&&(this.dataObj.common.useJobApproverSet||!1):e==teasp.constant.APPLY_KEY_EXPAPPLY?this.isUseExpWorkFlow()&&(this.dataObj.common.useExpApproverSet||!1):this.isUseWorkFlow()&&(this.getObj().config.useApplyApproverTemplate||!1)},teasp.data.Pouch.prototype.getDeptByMonth=function(e){if(e.deptMonth&&(teasp.constant.STATUS_FIX.contains(e.deptMonth.status)||e.apply&&teasp.constant.STATUS_FIX.contains(e.apply.status))
)return e.deptMonth;for(var t=this.dataObj.deptHist||[],a=0;a<t.length;a++){var o=t[a];if(!o.startDate||o.startDate<=e.endDate)return this.getDeptAtTheTime(o,e.endDate)}return 0<t.length?t[0]:null},teasp.data.Pouch.prototype.getDeptIdByMonth=function(e){e=this.getDeptByMonth(e);return e&&e.deptId||null},teasp.data.Pouch.prototype.getDeptAtTheTime=function(e,t){for(var a=this.dataObj.deptOwnHist||[],o=0;o<a.length;o++
){var s=a[o];if(e.deptCode==s.deptCode&&((!s.startDate||s.startDate<=t)&&(!s.endDate||s.endDate>=t)))return s}return e},teasp.data.Pouch.prototype.isExpLinkDocument=function(){return this.dataObj.common.expLinkDocument||!1},teasp.data.Pouch.prototype.isRequireExpLinkJob=function(){return this.dataObj.common.requireExpLinkJob||!1},teasp.data.Pouch.prototype.isParallelMessage=function(){
return"1"==this.dataObj.common.namingRule},teasp.data.Pouch.prototype.mergeCalendar=function(e,t){var a=this.dataObj,o=new teasp.logic.EmpTime(this),s=o.getApplyDateMap(a.applys),i=teasp.util.date.getDateList(e,t),n=i.length;a.checkWorkingTime=!1;for(var r=0;r<a.applys.length;r++){var l=a.applys[r];l.applyType==teasp.constant.APPLY_TYPE_EXCHANGE&&(l.exchangeDate<e||t<l.exchangeDate?i.push(l.exchangeDate):(
l.startDate<e||t<l.startDate)&&i.push(l.startDate))}n<i.length&&(i=i.sort(function(e,t){return e<t?-1:t<e?1:0}));for(var p=[],r=0;r<i.length;r++){var d=i[r];a.days[d]?a.days[d].date=d:a.days[d]={date:d},p.push(a.days[d])}for(r=0;r<p.length;r++){var c=p[r],m=c.date;c.dbDayType=c.dayType;for(var h=0;h<a.months.length;h++){var u=a.months[h];u.startDate<=m&&m<=u.endDate&&(c.month=u)}var g,y,f,b=c.month,_=(
b.config.useDailyApply&&b.config.checkWorkingTime&&(a.checkWorkingTime=!0),b&&b.apply&&teasp.constant.STATUS_FIX.contains(b.apply.status)),v=(_?(b.config.holidays.indexOf("2")<0&&!teasp.util.time.isValidRange(c.startTime,c.endTime)&&c.dayType==teasp.constant.DAY_TYPE_LEGAL_HOLIDAY&&(c.dayType=teasp.constant.DAY_TYPE_NORMAL_HOLIDAY),c.holiday1&&c.holiday1.plannedHoliday&&(c.plannedHoliday=!0),
c.dayType!=teasp.constant.DAY_TYPE_NORMAL&&teasp.util.time.isValidRange(c.startTime,c.endTime)&&(c.workFlag=!0)):(delete c.dayType,delete c.event,delete c.plannedHoliday,delete c.pattern,delete c.holiday1,delete c.holiday2,delete c.exchangeDate,delete c.rack,delete c.period,delete c.real,delete c.deco,c.dayType=teasp.constant.DAY_TYPE_NORMAL,c.plannedHoliday=!1,y=teasp.util.date.parseDate(m),v=b.fixHolidays[m],
c.dayType=v?v.dayType:teasp.constant.DAY_TYPE_NORMAL,null!==b.config.defaultLegalHoliday&&c.dayType!=teasp.constant.DAY_TYPE_NORMAL&&y.getDay()==b.config.defaultLegalHoliday&&(c.defaultLegalHolidayFlag=!0),g=[],v&&v.title&&g.push("("+v.title+")"),(v=a.cals[m])&&(v.type&&(c.dayType="string"==typeof v.type?parseInt(v.type,10):v.type,c.plannedHoliday=v.plannedHoliday),v.pattern&&(c.pattern=v.pattern),v.event&&g.push(
v.event)),(b=(v=this.getDeptIdByMonth(b))&&a.cals[v]&&a.cals[v][m]||null)&&b.event&&g.push(b.event),c.event=g.join(teasp.message.getLabel("tm10001470")),c.pattern||(f=teasp.logic.EmpTime.getPatternByDate(a.empTypePatterns,y))&&(c.pattern=f.pattern),c.explicDayType=c.dayType),c.rack={},c.rack.key=m,c.rack.inputable=!0,c.plannedHoliday&&c.dayType!=teasp.constant.DAY_TYPE_NORMAL&&(c.plannedHoliday=!1),o.getValidApplys(
s[m]||[],[],m)),b=((c.rack.validApplys=v).shiftSet&&((f=v.shiftSet).pattern&&(c.pattern=f.pattern),null!==f.dayType&&(c.dayType="0"==f.dayType?teasp.constant.DAY_TYPE_NORMAL:teasp.constant.DAY_TYPE_NORMAL_HOLIDAY)),(v.exchangeS||v.exchangeE)&&(b=!c.month.config.prohibitInputTimeUntilApproved,g=v.exchangeS?{dkey1:v.exchangeS.startDate,dkey2:v.exchangeS.exchangeDate,valid:b||teasp.constant.STATUS_APPROVES.contains(
v.exchangeS.status)}:null,y=v.exchangeE?{dkey1:v.exchangeE.exchangeDate,dkey2:v.exchangeE.originalStartDate,valid:b||teasp.constant.STATUS_APPROVES.contains(v.exchangeE.status)}:null,(b=teasp.logic.EmpTime.exchangeDateInfo(this,a.days,m,i,y))&&b.valid&&(c.dayType=b.dayType),(b=(!(T=teasp.logic.EmpTime.exchangeDateInfo(this,a.days,m,i,g))||!T.valid)&&b||T)&&(c.exchangeDate=b.exchangeDate,c.dayType=b.dayType,
void 0!==b.orgDayType&&(c.orgDayType=b.orgDayType),b.interim?c.interim=b.interim:T&&T.interim&&(c.interim=T.interim))),(v.patternS||v.patternL)&&(f=v.patternS||v.patternL,_||(f.pattern&&(c.pattern=f.pattern),null!==f.dayType&&(c.dayType="0"==f.dayType?teasp.constant.DAY_TYPE_NORMAL:teasp.constant.DAY_TYPE_NORMAL_HOLIDAY))),c.dayType),T=(b!=teasp.constant.DAY_TYPE_NORMAL||c.plannedHoliday?(
v.holidayAll||v.holidayAm||v.holidayPm)&&(v.holidayAll&&!v.holidayAll.holiday.displayDaysOnCalendar&&(v.holidayAll=null),v.holidayAm&&!v.holidayAm.holiday.displayDaysOnCalendar&&(v.holidayAm=null),v.holidayPm&&!v.holidayPm.holiday.displayDaysOnCalendar&&(v.holidayPm=null)):0<v.kyushtu.length&&(_?c.plannedHoliday=!0:v.kyushtu=[]),c.pattern||(c.pattern=c.month.config.defaultPattern),c.pattern);_||(c.holiday1=null,
c.holiday2=null,v.holidayAll?c.holiday1=v.holidayAll.holiday:(v.holidayAm||v.holidayPm)&&(T.useHalfHoliday?v.holidayAm&&v.holidayPm?(c.holiday1=v.holidayAm.holiday,c.holiday2=v.holidayPm.holiday):v.holidayAm?c.holiday1=v.holidayAm.holiday:v.holidayPm&&(c.holiday1=v.holidayPm.holiday):(v.holidayAm&&(v.holidayAm=null),v.holidayPm&&(v.holidayPm=null)))),
b==teasp.constant.DAY_TYPE_NORMAL||0<v.kyushtu.length||c.workFlag||c.autoLH?(c.holiday1&&c.holiday1.range==teasp.constant.RANGE_ALL?c.rack.holidayJoin={flag:3,name:c.holiday1.name,type:c.holiday1.type,planned:c.holiday1.plannedHoliday||!1}:c.holiday1&&c.holiday2&&c.holiday1.range==teasp.constant.RANGE_AM&&c.holiday2.range==teasp.constant.RANGE_PM?c.rack.holidayJoin={flag:3,name:c.holiday1.name+teasp.message.getLabel(
"tm10001560")+c.holiday2.name,type:(c.holiday1.type<=c.holiday2.type?c.holiday1:c.holiday2).type}:c.holiday1&&(c.holiday1.range==teasp.constant.RANGE_AM?c.rack.holidayJoin={flag:1,name:c.holiday1.name,type:c.holiday1.type}:c.rack.holidayJoin={flag:2,name:c.holiday1.name,type:c.holiday1.type}),
b==teasp.constant.DAY_TYPE_NORMAL||c.workFlag||c.autoLH?c.rack.inputable=!c.rack.holidayJoin||3!=c.rack.holidayJoin.flag:0<v.kyushtu.length&&!teasp.constant.STATUS_APPROVES.contains(v.kyushtu[0].status)&&c.month.config.prohibitInputTimeUntilApproved&&(c.rack.inputable=!1)):c.rack.inputable=!1,c.rack.plannedHolidayReal=!1,c.plannedHoliday&&v.kyushtu.length<=0&&(c.rack.plannedHolidayReal=!0,c.rack.inputable=!1),
b==teasp.constant.DAY_TYPE_NORMAL||0<v.kyushtu.length||c.workFlag||c.autoLH?c.rack.worked=teasp.util.time.isValidRange(c.startTime,c.endTime):c.rack.worked=!1}},teasp.data.Pouch.prototype.verifyMonth=function(e,t,a){new teasp.verify.VerCheck(this.dataObj,!0).verifyMonth(e,t,a)},teasp.data.Pouch.prototype.getExpPreApplyConfig=function(){return this.dataObj.common.expPreApplyConfig||{}},
teasp.data.Pouch.prototype.getUseApplyHeader=function(){var e=this.getExpPreApplyConfig()||{},t={expenseType:this.getExpenseType(),payMethod:this.getPayExpItemName(),applyDate:this.getApplyDate(),payDate:this.getPayDate(),provisional:this.getProvisionalPaymentTitle(),chargeJob:this.getChargeJobName(),chargeDept:this.getChargeDeptName(),extraItem1:this.getExtraItem1(),extraItem2:this.getExtraItem2()},e={
useExpenseType:e.expApply.useExpenseType||t.expenseType,usePayMethod:e.expApply.usePayMethod||t.payMethod,useApplyDate:e.expApply.useApplyDate||t.applyDate,usePayDate:e.expApply.usePayDate||t.payDate,useProvisional:(e.expApply.useProvisional||t.provisional)&&!this.getExpPreApplyPpAmount(),useChargeJob:e.expApply.useChargeJob||t.chargeJob,useChargeDept:e.expApply.useChargeDept||t.chargeDept,
useExtraItem1:e.expApply.useExtraItem1||t.extraItem1,useExtraItem2:e.expApply.useExtraItem2||t.extraItem2,value:t};return e.anyUse=e.useExpenseType||e.usePayMethod||e.useApplyDate||e.usePayDate||e.useProvisional||e.useChargeJob||e.useChargeDept||e.useExtraItem1||e.useExtraItem2,e},teasp.data.Pouch.prototype.getExtraItemOutPutDataName1=function(){return this.dataObj.common.extraItemOutPutDataName1||""},
teasp.data.Pouch.prototype.getExtraItemOutPutDataName2=function(){return this.dataObj.common.extraItemOutPutDataName2||""},teasp.data.Pouch.prototype.getJobAssignClass=function(){return this.dataObj.targetEmp&&this.dataObj.targetEmp.jobAssignClass||null},teasp.data.Pouch.prototype.getEmpMonthList=function(e,t,a){"object"!=typeof e&&(e=teasp.util.date.parseDate(""+e));for(var o=this.dataObj.months||[],
s=this.dataObj.empTypeHistory||[],i=teasp.util.date.formatDate(a&&a<0?teasp.util.date.addDays(e,31*(a-1)):e),n=teasp.util.date.formatDate(teasp.util.date.addDays(e,31*(t+1))),r=new Array,l=teasp.util.date.addMonths(i,-2),p=null,d={};l<=n;){for(var c,m=null,h=0;h<s.length;h++){var u=s[h];if((!u.sd||u.sd<=l)&&(!u.ed||l<=u.ed)){for(var g=teasp.util.searchYearMonthDate(u.empType.configBase.initialDateOfMonth,
u.empType.configBase.markOfMonth,null,l),m={yearMonth:g.yearMonth,startDate:u.sd&&u.sd>g.startDate?u.sd:g.startDate,endDate:u.ed&&u.ed<g.endDate?u.ed:g.endDate,empType:u.empType,initialDate:u.id,fix:!1},y=0;y<o.length;y++){var f=o[y];if(f._em.startDate<=l&&f._em.endDate>=l&&this.isEmpMonthFixed(f,!0)){m.empType=f._em.empType,m.fix=!0;break}}break}}p&&p.startDate==m.startDate||((c=d[m.yearMonth])?(m.subNo=c,
d[m.yearMonth]=c+1):d[m.yearMonth]=1,m.yearMonthEx=teasp.util.date.formatDate(m.startDate,"yyyyMMdd"),m.endDate>=i&&r.push(m),p=m),l=teasp.util.date.addDays(m.endDate,1)}return r},teasp.data.Pouch.prototype.getEmpMonthListByYear=function(e){for(var t=this.getEmpMonthList(e.startDate,15,-15),a=teasp.data.Pouch.getYmRangeOfYear(e.yearMonth,e.empType.configBase.initialDateOfYear),o=e.initialDate||null,s=new Array,
i=0;i<a.length;i++)for(var n=a[i],r=0;r<t.length;r++){var l=t[r];l.yearMonth==n&&(l.initialDate||null)==o&&s.push(l)}return s},teasp.data.Pouch.prototype.getEmpMonthListByPeriod=function(e,t){for(var a=this.getEmpMonthList(e.startDate,15,-15),o=teasp.data.Pouch.getYmRangeOfPeriod(e.yearMonth,e.empType.configBase.initialDateOfYear,t),s=e.initialDate||null,i=new Array,n=0;n<o.length;n++)for(var r=o[n],
l=0;l<a.length;l++){var p=a[l];p.yearMonth==r&&(p.initialDate||null)==s&&this.compatibleMonth(p,e)&&i.push(p)}return i},teasp.data.Pouch.prototype.compatibleMonth=function(e,t){e=this.getMonthByStartDate(e.startDate),t=this.getMonthByStartDate(t.startDate);if(!e||!t)return!0;var a=e.config.workSystem,o=t.config.workSystem;return a!=teasp.constant.WORK_SYSTEM_FLEX&&o!=teasp.constant.WORK_SYSTEM_FLEX||(
e._em&&e._em.empTypeId)==(t._em&&t._em.empTypeId)},teasp.data.Pouch.prototype.getMonthByStartDate=function(e){for(var t=this.dataObj.months||[],a=1;a<t.length;a++)if(t[a].startDate==e)return t[a];return null},teasp.data.Pouch.prototype.getMonthByDate=function(e){for(var t=this.dataObj.months||[],a=1;a<t.length;a++){var o=t[a];if(o.startDate<=e&&e<=o.endDate)return t[a]}return null},
teasp.data.Pouch.getYmRangeOfYear=function(e,t){var a=new Array,o=Math.floor(e/100),s=e%100;for(s<t&&o--,s=t;a.length<12;)a.push(100*o+s++),12<s&&(o++,s=1);return a},teasp.data.Pouch.getYmRangeOfPeriod=function(e,t,a){for(var o=new Array,s=Math.floor(e/100),i=(e%100<t&&s--,t),n=-1;o.length<12;)(r=100*s+i++)==e&&(n=o.length),o.push(r),12<i&&(s++,i=1);for(var r=Math.floor(n/a)*a,l=new Array;l.length<a;)l.push(o[r++]);
return l},teasp.data.Pouch.prototype.getJobMonthList=function(e,t,a){"object"!=typeof e&&(e=teasp.util.date.parseDate(""+e));for(var o=this.dataObj.jobInitHistory||[],s=teasp.util.date.formatDate(a&&a<0?teasp.util.date.addDays(e,31*(a-1)):e),i=teasp.util.date.formatDate(teasp.util.date.addDays(e,31*(t+1))),n=new Array,r=teasp.util.date.addMonths(s,-2),l=null,p={};r<=i;){for(var d,c=null,m=0;m<o.length;m++){var h=o[m]
if((!h.sd||h.sd<=r)&&(!h.ed||r<=h.ed)){var u=teasp.util.searchYearMonthDate(h.initialDateOfMonth,h.markOfMonth,null,r),c={yearMonth:u.yearMonth,startDate:h.sd&&h.sd>u.startDate?h.sd:u.startDate,endDate:h.ed&&h.ed<u.endDate?h.ed:u.endDate};break}}l&&l.startDate==c.startDate||((d=p[c.yearMonth])?(c.subNo=d,p[c.yearMonth]=d+1):p[c.yearMonth]=1,c.yearMonthEx=teasp.util.date.formatDate(c.startDate,"yyyyMMdd"),
c.endDate>=s&&n.push(c),l=c),r=teasp.util.date.addDays(c.endDate,1)}return n},teasp.data.Pouch.prototype.getEmpMonth=function(e,t,a,o){for(var s=t=t&&"object"==typeof t?teasp.util.date.formatDate(t):t,i=(t||(s=(s=""+e).substring(0,4)+"-"+s.substring(4,6)+"-01"),2+(a&&0<a?a:0)),n=this.getEmpMonthList(s,i,-2+(a&&a<0?a:0)),r=null,l=0;l<n.length;l++){var p=n[l];if(!t&&p.yearMonth>=e||t&&p.startDate<=t&&t<=p.endDate){
r=p.yearMonth>e&&o&&!a&&0<l?n[l-1]:a?n[l+a]:p;break}}return r},teasp.data.Pouch.prototype.getJobMonth=function(e,t,a){for(var o=t=t&&"object"==typeof t?teasp.util.date.formatDate(t):t,s=(t||(o=(o=""+e).substring(0,4)+"-"+o.substring(4,6)+"-01"),2+(a&&0<a?a:0)),i=this.getJobMonthList(o,s,-2+(a&&a<0?a:0)),n=null,r=0;r<i.length;r++){var l=i[r];if(!t&&l.yearMonth==e||t&&l.startDate<=t&&t<=l.endDate){n=a?i[r+a]:l;break}}
return n},teasp.data.Pouch.prototype.getDivergenceReasonList=function(){return this.dataObj.common.divergenceReasonList||[]},teasp.data.Pouch.prototype.isTimeReportDedicatedToJob=function(){return this.dataObj.common.config&&this.dataObj.common.config.timeReportDedicatedToJob||!1},teasp.data.Pouch.prototype.isWarningOnMAPHW=function(){return this.dataObj.common.config&&this.dataObj.common.config.warningOnMAPHW||!1},
teasp.data.Pouch.prototype.isCheckInputWorkHours=function(){return this.dataObj.common.config&&this.dataObj.common.config.checkInputWorkHours||!1},teasp.data.Pouch.prototype.isPushTimeWithLocationWeb=function(){return this.dataObj.common.config&&this.dataObj.common.config.pushTimeWithLocationWeb||!1},teasp.data.Pouch.prototype.isHidePersonalInfo=function(){
return this.dataObj.common.config&&this.dataObj.common.config.hidePersonalInfo||!1},teasp.data.Pouch.prototype.isAdjustLateTimeEarlyTime=function(){return this.dataObj.common.config&&this.dataObj.common.config.adjustLateTimeEarlyTime||!1},teasp.data.Pouch.prototype.isFlexibleHalfDayTime=function(){return this.dataObj.common.config&&this.dataObj.common.config.flexibleHalfDayTime||!1},
teasp.data.Pouch.prototype.isUseWorkLocation=function(e){return(!e||!teasp.isNarrow())&&this.getObj().config.useWorkLocation||!1},teasp.data.Pouch.prototype.isRequireWorkLocation=function(){return this.getObj().config.useWorkLocation&&this.getObj().config.requireWorkLocation||!1},teasp.data.Pouch.prototype.setWorkLocations=function(e){this.dataObj.workLocations=[];for(
var t=this.dataObj.common.defaultWorkLocationId||null,a=0;a<e.length;a++){const o=new teasp.data.WorkLocation(e[a]);t&&o.getId()==t&&o.setInitFlag(!0),this.dataObj.workLocations.push(o)}},teasp.data.Pouch.prototype.getWorkLocations=function(e){const t=this.dataObj.workLocations||[];if(e)return t;const a=[];for(var o=0;o<t.length;o++)t[o].isRemoved()||a.push(t[o]);return a},
teasp.data.Pouch.prototype.getDefaultWorkLocation=function(){var e=null;const t=this.dataObj.workLocations||[];for(var a=0;a<t.length;a++)if(t[a].isInitFlag()){e=t[a];break}return e},teasp.data.Pouch.prototype.getWorkLocationById=function(e){if(!e)return null;for(var t=this.dataObj.workLocations||[],a=0;a<t.length;a++){const o=t[a];if(o.getId()==e)return o}return null},teasp.data.Pouch.prototype.getEmpDay=function(e
){return new teasp.data.EmpDay(this,e)},teasp.data.Pouch.prototype.getEmpApply=function(e){return new teasp.data.EmpApply(e)},teasp.data.Pouch.prototype.isAlive=function(e){return!(this.getObj().targetEmp.entryDate&&teasp.util.date.compareDate(e,this.getObj().targetEmp.entryDate)<0||this.getObj().targetEmp.endDate&&teasp.util.date.compareDate(this.getObj().targetEmp.endDate,e)<0)},
teasp.data.Pouch.prototype.getDayInfoByDate=function(e){var t={date:e,dayType:teasp.constant.DAY_TYPE_NORMAL,plannedHoliday:!1},a=this.getObj().days[t.date],e=teasp.logic.EmpTime.getDayInfo(e,this.getEmpMonthByDate(e),this.getObj().cals[e],this.getObj().empTypePatterns);return a?(t.dayType=e.dayType,t.plannedHoliday=a.plannedHoliday,t.startTime=a.startTime,t.endTime=a.endTime,t.validApplys=a.validApplys,t
):this.getObj().dayMap&&this.getObj().dayMap[t.date]?this.getObj().dayMap[t.date]:(t.unconfirmed=!0,t)},teasp.data.Pouch.prototype.getFirstHolidayOfWeek=function(e,t,a){for(var o=0;o<e.length;o++){var s=t&&a&&e[o]==t?a:e[o],i=this.getObj().days[s];if(((i=i||this.getObj().dayMap[s]||{date:s,dayType:teasp.constant.DAY_TYPE_NORMAL}).interim||i).dayType!=teasp.constant.DAY_TYPE_NORMAL)return i.date}return null},
teasp.data.Pouch.prototype.clearDayMap=function(){this.getObj().dayMap={}},teasp.data.Pouch.prototype.setNextMonth=function(e,t,a,o,s,i){for(var n=[],r=teasp.util.date.getDateList(o,s),l=0;l<r.length;l++)n.push({date:r[l]});for(var p=this.getObj().dayMap||{},l=0;l<n.length;l++){var d=n[l],c=(d.dayType=teasp.constant.DAY_TYPE_NORMAL,d.plannedHoliday=!1,d.applys=[],t[d.date]),c=(d.startTime=c?c.startTime:null,
d.endTime=c?c.endTime:null,this.getEmpMonthByDate(d.date)),c=c&&c.fixHolidays?c.fixHolidays[d.date]:null,c=(d.dayType=c?c.dayType:teasp.constant.DAY_TYPE_NORMAL,e[d.date]);c&&c.type&&(d.dayType="string"==typeof c.type?parseInt(c.type,10):c.type,d.plannedHoliday=c.plannedHoliday),d.applys=a[d.date]||[],(d.dayType!=teasp.constant.DAY_TYPE_NORMAL||d.plannedHoliday||0<d.applys.length||d.startTime||d.endTime)&&(
p[d.date]=d)}this.getObj().dayMap=p},teasp.data.Pouch.prototype.getNightRanges=function(){return this.getObj().common.nightTimes},teasp.data.Pouch.prototype.isIndicateNoPushTime=function(){return this.getObj().common.indicateNoPushTime},teasp.data.Pouch.prototype.isDiscretionaryOption=function(){return this.getObj().common.discretionaryOption},teasp.data.Pouch.prototype.isFlexGraph=function(){return this.getObj(
).common.flexGraph},teasp.data.Pouch.prototype.isUseFixedButton=function(){return this.getObj().common.useFixedButton},teasp.data.Pouch.prototype.isUseRestartable=function(){return this.getObj().common.useRestartable},teasp.data.Pouch.prototype.isUseOwnReasonLateStart=function(){return!!this.getObj().common.treatLateStart},teasp.data.Pouch.prototype.isUseOwnReasonEarlyEnd=function(){return!!this.getObj(
).common.treatEarlyEnd},teasp.data.Pouch.prototype.getTreatLateStart=function(){return this.getObj().common.treatLateStart},teasp.data.Pouch.prototype.getTreatEarlyEnd=function(){return this.getObj().common.treatEarlyEnd},teasp.data.Pouch.prototype.getCalcMode=function(e){return this.getObj().month.config.workSystem==teasp.constant.WORK_SYSTEM_FLEX&&this.getObj().common.flexGraph&&!e?this.getObj(
).common.discretionaryOption?teasp.constant.C_FREAL:teasp.constant.C_FDISC:this.getObj().common.discretionaryOption?teasp.constant.C_REAL:teasp.constant.C_DISC},teasp.data.Pouch.prototype.getDspYuqRemain=function(e,t){return this.getYuqRemain(this.getObj().yuqRemains,e,t)},teasp.data.Pouch.prototype.getYuqRemain=function(e,t,a){var o={days:0,time:0,bt:0,mix:!0,display:""};if(!e)return o;for(
var s=new teasp.logic.YuqDays,i={},n=0;n<e.length;n++){var r=e[n];if(!(0<=teasp.util.date.compareDate(t,r.limitDate)||teasp.util.date.compareDate(t,r.startDate)<0)){for(var l=0,p=0,d=0;d<r.children.length;d++){var c,m,h=r.children[d];0<h.time||h.lostFlag?l+=h.time:(!a||teasp.util.date.compareDate(h.date,t)<=0)&&(a?(c=i[h.empApplyId],p-=(m=this.getEncloseSpendTimes(h,t,r.baseTime,c)).getAllMinutes(),c?c.append(m
):i[h.empApplyId]=c=m):p+=h.time)}var u=l+p;0<u&&s.append(new teasp.logic.YuqDays(r.baseTime,u))}}return o.days+=s.getDays(),o.time+=s.getMinutes(),o.display=teasp.message.getLabel("tm10001010",o.days),0<o.time&&(o.display+=" +"+teasp.util.time.timeValue(o.time)),o},teasp.data.Pouch.prototype.getEncloseSpendTimes=function(e,t,a,o){var s=e.startDate,i=e.endDate,n=new teasp.logic.YuqDays(a,Math.abs(e.time));if(
s==i||!this.isYuqZanFlag())return n;for(var r=(e.excludeDate||"").split(/:/),l={},p=0;p<r.length;p++){var d=/(\d{4})(\d{2})(\d{2})/.exec(r[p]);d&&(l[d[1]+"-"+d[2]+"-"+d[3]]=1)}t="object"==typeof t?teasp.util.date.formatDate(t):t;for(var c=0;s<=i;)l[s]||s<=t&&c++,s=teasp.util.date.addDays(s,1);e=new teasp.logic.YuqDays(a,c*a);return o&&e.subtract(o),n.getAllMinutes()<=e.getAllMinutes()?n:e},
teasp.data.Pouch.prototype.simulateDspYuqRemain=function(e,t){var a=this.getObj().yuqRemains;if(!a)return{spends:0,remain:{days:0,time:0,display:""}};for(var o=this.getEntryDate(),s=this.getEndDate(),i=[t],n=this.getMonthDateList(),r=n[n.length-1],l=0;l<n.length;l++){var p,d=n[l];o&&d<o||s&&s<d||(p=this.getEmpDay(d)).isPlannedHoliday()&&!p.isWorked()&&i.push({dt:p.getKey(),days:1,minutes:0,planned:1})}for(var c=(
c=this.getNextYuqProvideDate())||((c=o)?teasp.util.date.addMonths(c,6):null);c&&c<=e;)c=teasp.util.date.addMonths(c,12);var m,h=this.getPlannedHoldays(),u=[];for(d in h)!h.hasOwnProperty(d)||d<=r||c&&c<d||!h[d]||o&&d<o||s&&s<d||((m=this.getEmpMonthByDate(d))&&m.apply&&teasp.constant.STATUS_FIX.contains(m.apply.status)||u.push(d));for(u=u.sort(function(e,t){return e<t?-1:t<e?1:0}),l=0;l<u.length;l++)i.push({dt:u[l],
days:1,minutes:0,planned:2});for(var i=i.sort(function(e,t){return e.dt==t.dt?0:e.dt<t.dt?-1:1}),g=(g=dojo.clone(a)).sort(function(e,t){return e.limitDate==t.limitDate?e.createdDate<t.createdDate?-1:1:e.limitDate<t.limitDate?-1:1}),y=0;y<i.length;y++){for(var f=i[y],b=null,l=0;l<g.length;l++){var _=g[l];if(!(0<=teasp.util.date.compareDate(f.dt,_.limitDate)||teasp.util.date.compareDate(f.dt,_.startDate)<0)){for(
var b=b||new teasp.logic.YuqDays(_.baseTime,_.baseTime*f.days+f.minutes),v=0,T=0,j=0;j<_.children.length;j++)0<(L=_.children[j]).time||L.lostFlag?v+=L.time:T+=L.time;var E=v+T;if(!(E<=0)){_.baseTime!=b.getBaseTime()&&(b=new teasp.logic.YuqDays(_.baseTime,b.calcMinutesByBaseTime(_.baseTime)));var T=Math.min(b.getAllMinutes(),E),L={date:f.dt,time:-1*T,lostFlag:!1};if(_.children.push(L),b.subtract(
new teasp.logic.YuqDays(_.baseTime,T)),f.days=b.getDays(),f.minutes=b.getMinutes(),b.getAllMinutes()<=0)break}}}(0<f.days||0<f.minutes)&&(f.ng=!0)}return{spends:i,remain:this.getYuqRemain(g,e)}},teasp.data.Pouch.prototype.getYuqRemainObjs=function(){return this.getObj().yuqRemains||[]},teasp.data.Pouch.prototype.getPatternList=function(e){var t,a=[];for(t in this.getObj().patterns){var o=this.getObj().patterns[t];
1==e&&o.range!=teasp.constant.RANGE_SHORT||2==e&&o.range!=teasp.constant.RANGE_LONG||a.push(o)}return a.sort(function(e,t){return e.order-t.order})},teasp.data.Pouch.prototype.getHolidayList=function(e){for(var t=[],a=this.getObj().days[e].pattern.useHalfHoliday,o=0;o<this.getObj().holidays.length;o++){var s=this.getObj().holidays[o];(a||s.range!=teasp.constant.RANGE_AM&&s.range!=teasp.constant.RANGE_PM)&&t.push(s)}
return t},teasp.data.Pouch.prototype.getHolidayManageNames=function(){for(var e=[],t=0;t<this.getObj().holidays.length;t++){var a=this.getObj().holidays[t];a.managed&&!e.contains(a.manageName)&&e.push(a.manageName)}return e},teasp.data.Pouch.prototype.getPatternObjs=function(){return this.getObj().patterns||[]},teasp.data.Pouch.prototype.getHolidayObjs=function(){return this.getObj().holidays||[]},
teasp.data.Pouch.prototype.getInitialDateOfYear=function(){return this.getObj().targetEmp.configBase.initialDateOfYear},teasp.data.Pouch.prototype.getInitialDateOfMonth=function(){return this.getObj().targetEmp.configBase.initialDateOfMonth},teasp.data.Pouch.prototype.getInitialDayOfWeek=function(){return this.getObj().targetEmp.configBase.initialDayOfWeek},teasp.data.Pouch.prototype.getMarkOfYear=function(){
return this.getObj().targetEmp.configBase.markOfYear},teasp.data.Pouch.prototype.getMarkOfMonth=function(){return this.getObj().targetEmp.configBase.markOfMonth},teasp.data.Pouch.prototype.isUseDaiqManage=function(){return this.getObj().targetEmp.daiqManage.useDaiqManage},teasp.data.Pouch.prototype.isUseHalfDaiq=function(){return this.getObj().targetEmp.daiqManage.useHalfDaiq},
teasp.data.Pouch.prototype.getDaiqLimit=function(){return this.getObj().targetEmp.daiqManage.daiqLimit},teasp.data.Pouch.prototype.getDaiqAllBorderTime=function(){return this.getObj().targetEmp.daiqManage.daiqAllBorderTime},teasp.data.Pouch.prototype.getDaiqHalfBorderTime=function(){return this.getObj().targetEmp.daiqManage.daiqHalfBorderTime},teasp.data.Pouch.prototype.isUseDaiqReserve=function(){return this.getObj(
).targetEmp.daiqManage.useDaiqManage&&this.getObj().targetEmp.daiqManage.useDaiqReserve},teasp.data.Pouch.prototype.isUseDaiqLegalHoliday=function(){return this.getObj().targetEmp.daiqManage.useDaiqLegalHoliday},teasp.data.Pouch.prototype.isUseRegulateHoliday=function(){return this.getObj().targetEmp.daiqManage.useDaiqManage&&this.getObj().targetEmp.daiqManage.useRegulateHoliday},
teasp.data.Pouch.prototype.isNoDaiqExchanged=function(){return this.getObj().targetEmp.daiqManage.useDaiqManage&&this.getObj().targetEmp.daiqManage.noDaiqExchanged},teasp.data.Pouch.prototype.isRegulateHoliday=function(e){if(!e)return!1;e=this.getDayObj(e);return e.dayType!=teasp.constant.DAY_TYPE_NORMAL&&(
e.rack&&e.rack.validApplys&&0<e.rack.validApplys.kyushtu.length&&e.rack.validApplys.kyushtu[0].useRegulateHoliday)},teasp.data.Pouch.prototype.getConfigObj=function(e){if(!e)return this.getObj().config;e=this.getEmpMonthByDate(e);return e?e.config:null},teasp.data.Pouch.prototype.getTimeFormObj=function(){var e={form:"h:mm",round:1,roundBegin:1,roundEnd:2};return"1"!=this.getObj().config.timeRound&&(e.round=parseInt(
this.getObj().config.timeRound,10),e.roundBegin=parseInt(this.getObj().config.timeRoundBegin||"1",10),e.roundEnd=parseInt(this.getObj().config.timeRoundEnd||"2",10)),"hh:mm"!=this.getObj().config.timeFormat&&(e.form=this.getObj().config.timeFormat),e},teasp.data.Pouch.prototype.getWorkSystem=function(){return this.getObj().config.workSystem},teasp.data.Pouch.prototype.getBaseTime=function(){return this.getObj(
).config.baseTime},teasp.data.Pouch.prototype.getBaseTimeForStock=function(){return this.getObj().config.baseTimeForStock||null},teasp.data.Pouch.prototype.getVariablePeriod=function(){return this.getObj().config.variablePeriod},teasp.data.Pouch.prototype.isUseLateStartApply=function(){return this.getObj().config.useLateStartApply},teasp.data.Pouch.prototype.isRequiredLateStartApply=function(){var e=this.getObj(
).config.config;return this.getObj().config.useLateStartApply&&e&&e.empApply.requireLateApply||!1},teasp.data.Pouch.prototype.isUseEarlyEndApply=function(){return this.getObj().config.useEarlyEndApply},teasp.data.Pouch.prototype.isRequiredEarlyEndApply=function(){var e=this.getObj().config.config;return this.getObj().config.useEarlyEndApply&&e&&e.empApply.requireEarlyEndApply||!1},
teasp.data.Pouch.prototype.getUseOverTimeFlag=function(){return this.getObj().config.useOverTimeFlag},teasp.data.Pouch.prototype.isUseBulkOverTime=function(){var e=this.getObj().config.config;return!!e&&e.empApply.useBulkOverTime},teasp.data.Pouch.prototype.isOverTimeRequireTime=function(){var e=this.getObj().config.config;return 0<(e&&e.empApply.overTimeRequireTime||0)},
teasp.data.Pouch.prototype.getOverTimeRequireTime=function(e){if(!(2&this.getObj().config.useOverTimeFlag))return 0;if(this.getWorkSystem()==teasp.constant.WORK_SYSTEM_MANAGER||e)return 0;e=this.getObj().config.config,e=e&&e.empApply.overTimeRequireTime||0;return 0<e?e:0},teasp.data.Pouch.prototype.getUseEarlyWorkFlag=function(){return this.getObj().config.useEarlyWorkFlag},
teasp.data.Pouch.prototype.isUseBulkEarlyWork=function(){var e=this.getObj().config.config;return!!e&&e.empApply.useBulkEarlyWork},teasp.data.Pouch.prototype.isEarlyWorkRequireTime=function(){var e=this.getObj().config.config;return 0<(e&&e.empApply.earlyWorkRequireTime||0)},teasp.data.Pouch.prototype.getEarlyWorkRequireTime=function(e){if(!(2&this.getObj().config.useEarlyWorkFlag))return 0;if(this.getWorkSystem(
)==teasp.constant.WORK_SYSTEM_MANAGER||e)return 0;e=this.getObj().config.config,e=e&&e.empApply.earlyWorkRequireTime||0;return 0<e?e:0},teasp.data.Pouch.prototype.isRequireDailyInput=function(){var e=this.getObj().config.config;return e&&e.requireDailyInput||!1},teasp.data.Pouch.prototype.isUseDailyApply=function(){return this.getObj().config.useDailyApply},teasp.data.Pouch.prototype.isUseDirectApply=function(){
return this.getObj().config.useDirectApply},teasp.data.Pouch.prototype.getWorkTypeList=function(){for(var e=(this.getObj().config.workTypeList||"").split(/\r?\n/),t=e.length-1;0<=t;t--)""==e[t]&&e.splice(t,1);return e},teasp.data.Pouch.prototype.isUseReviseTimeApply=function(){return this.getObj().config.useReviseTimeApply},teasp.data.Pouch.prototype.getUseHolidayWorkFlag=function(){return this.getObj(
).config.useHolidayWorkFlag},teasp.data.Pouch.prototype.isHolidayWorkRestChangeable=function(){if(this.isUseRegulateHoliday())return!1;var e=this.getObj().config.config;return!!e&&e.empApply.holidayWorkRestChangeable},teasp.data.Pouch.prototype.isProhibitBorderRestTime=function(){var e=this.getObj().config.config;return e&&e.prohibitBorderRestTime||!1},teasp.data.Pouch.prototype.isPastTimeOnly=function(){
return this.getObj().config.pastTimeOnly},teasp.data.Pouch.prototype.isChangeDayType=function(){return this.getObj().config.changeDayType},teasp.data.Pouch.prototype.isAllowSelectionOfLegalHoliday=function(){var e=this.getObj().config.config;return this.isChangeDayType()&&e&&e.empApply&&e.empApply.allowSelectionOfLegalHoliday||!1},teasp.data.Pouch.prototype.isProhibitWorkShiftChange=function(){var e=this.getObj(
).config.config;return e&&e.empApply&&e.empApply.prohibitWorkShiftChange||!1},teasp.data.Pouch.prototype.getDisplayDayType=function(e,t){switch(e){case"0":return teasp.message.getLabel("normalDay_label");case"1":return teasp.message.getLabel("tf10008800");case"2":return teasp.message.getLabel("tf10008810");default:return t||""}},teasp.data.Pouch.prototype.getExchangeLimit=function(){var e=this.getObj(
).config.exchangeLimit;return null===e?1:e},teasp.data.Pouch.prototype.getExchangeLimit2=function(){var e=this.getObj().config.exchangeLimit2;return null===e&&1<(e=this.getExchangeLimit())?1:e},teasp.data.Pouch.prototype.isCheckWorkingTime=function(){return this.isUseDailyApply()&&this.getObj().config.checkWorkingTime},teasp.data.Pouch.prototype.isCheckDailyFixLeak=function(){return this.isUseDailyApply(
)&&this.getObj().config.checkDailyFixLeak},teasp.data.Pouch.prototype.isCheckWorkingTimeMonthly=function(){return this.getObj().config.checkWorkingTimeMonthly},teasp.data.Pouch.prototype.getRoundMonthlyTime=function(){return this.getObj().config.roundMonthlyTime},teasp.data.Pouch.prototype.getRestTimeCheck=function(){return this.getObj().config.restTimeCheck},teasp.data.Pouch.prototype.isValidRestTimeCheck=function(
){for(var e=this.getRestTimeCheck()||[],t=0;t<e.length;t++)if(e[t].check)return!0;return!1},teasp.data.Pouch.prototype.isCoreTimeGraph=function(){return this.getObj().config.coreTimeGraph},teasp.data.Pouch.prototype.getFlexStartTime=function(){return this.getObj().config.flexStartTime},teasp.data.Pouch.prototype.getFlexEndTime=function(){return this.getObj().config.flexEndTime},
teasp.data.Pouch.prototype.isUseWorkFlow=function(){return this.getObj().config.useWorkFlow},teasp.data.Pouch.prototype.isUseExchangeDate=function(){return this.getObj().config.useMakeupHoliday},teasp.data.Pouch.prototype.isUseChangePattern=function(){return this.getObj().config.changePattern},teasp.data.Pouch.prototype.isUseChangeShift=function(){return this.getObj().config.changeShift},
teasp.data.Pouch.prototype.isUseLegalHoliday=function(){return 0<=this.getObj().config.holidays.indexOf("2")},teasp.data.Pouch.prototype.isAutoLegalHoliday=function(){return this.getObj().config.autoLegalHoliday},teasp.data.Pouch.prototype.isNonPublicHoliday=function(){return this.getObj().config.nonPublicHoliday},teasp.data.Pouch.prototype.isHalfDaiqReckontoWorked=function(){return this.getObj(
).config.halfDaiqReckontoWorked},teasp.data.Pouch.prototype.isDefaultUseDiscretionary=function(){return this.getObj().config.defaultPattern.useDiscretionary},teasp.data.Pouch.prototype.isEmpMonthFixed=function(e,t){return!(!this.isDeptMonthFixed(e)||!t&&!(e||this.getObj().month).empty)||teasp.constant.STATUS_FIX.contains(this.getEmpMonthApplyStatus(e))},teasp.data.Pouch.prototype.isDeptMonthFixed=function(e){
e=e||this.getObj().month;return!(!e||!e.deptMonth)&&teasp.constant.STATUS_FIX.contains(e.deptMonth.status)},teasp.data.Pouch.prototype.isEmpMonthFixedByDate=function(e){e=this.getEmpMonthByDate(e);return teasp.constant.STATUS_FIX.contains(e.apply.status)},teasp.data.Pouch.prototype.isEmpMonthReadOnly=function(){return this.isEmpMonthFixed()||this.isReadOnly()},teasp.data.Pouch.prototype.getYearMonth=function(){
return this.getObj().month.yearMonth},teasp.data.Pouch.prototype.getYearMonthJp=function(e){var t=this.getObj().month.yearMonth,a=this.getObj().month.subNo;return teasp.util.date.formatMonth(e?"zv00000021":"zv00000020",Math.floor(t/100),t%100,a)},teasp.data.Pouch.prototype.getStartDate=function(){return this.getObj().month.startDate||null},teasp.data.Pouch.prototype.getSubNo=function(){return this.getObj(
).month.subNo||null},teasp.data.Pouch.prototype.getLastModifiedDate=function(){return""+(this.getObj().month.lastModifiedDate||"")},teasp.data.Pouch.prototype.setLastModifiedDate=function(e){this.getObj().month&&(this.getObj().month.lastModifiedDate=e)},teasp.data.Pouch.prototype.getPrevMonthLastModifiedDate=function(){if(!this.getObj().month||!this.getObj().empMonthMap)return null;var e=this.getObj().month.yearMonth
,t=this.getObj().month.startDate,e=this.getEmpMonth(e,t,-1),t=this.getObj().empMonthMap[e.startDate];return""+(t&&t.lastModifiedDate||"")},teasp.data.Pouch.prototype.getMonthValueByKey=function(e){return this.getObj().month[e]},teasp.data.Pouch.prototype.getMonthTimeByKey=function(e,t,a){return this.getDisplayTime(this.getObj().month[e],t,a)},teasp.data.Pouch.prototype.getEmpMonthApplyId=function(){
return this.getObj().month.apply.id},teasp.data.Pouch.prototype.getEmpMonthApplyStatus=function(e,t){var a=null,e=e||this.getObj().month,o=e.deptMonth,a=!this.isSysAdmin()&&!this.isAdmin()&&o&&o.status&&teasp.constant.STATUS_APPROVES.contains(o.status)?o.status:e.apply?e.apply.status:null;return(!t||!teasp.constant.STATUS_CANCELS.contains(a))&&a||teasp.constant.STATUS_NOTADMIT},
teasp.data.Pouch.prototype.getEmpMonthApplySteps=function(){return this.getObj().month.apply.steps||[]},teasp.data.Pouch.prototype.setEmpMonthApplySteps=function(e){this.getObj().month.apply.steps=e},teasp.data.Pouch.prototype.getRestTimeChecks=function(){return this.getObj().month.config.restTimeCheck},teasp.data.Pouch.prototype.getMonthDateList=function(){return teasp.util.date.getDateList(this.getObj(
).month.startDate,this.getObj().month.endDate)},teasp.data.Pouch.prototype.isDayInMonth=function(e){return teasp.util.date.compareDate(this.getObj().month.startDate,e)<=0&&teasp.util.date.compareDate(e,this.getObj().month.endDate)<=0},teasp.data.Pouch.prototype.getInvalidApplys=function(e){for(var t=this.getMonthDateList(),a=[],o=0;o<t.length;o++)a=a.concat(this.getInvalidApplysOfDay(t[o],e));return a},
teasp.data.Pouch.prototype.getInvalidApplysOfDay=function(e,t,a){var o=[],s=this.getObj().days[e],i=a&&a.startTime||s.startTime,a=a&&a.endTime||s.endTime,n=(s.interim||s).dayType;(n=n==teasp.constant.DAY_TYPE_PUBLIC_HOLIDAY?teasp.constant.DAY_TYPE_NORMAL_HOLIDAY:n)==teasp.constant.DAY_TYPE_NORMAL||!teasp.util.time.isValidRange(i,a)||s.rack.validApplys.kyushtu.length||(s.workFlag||s.autoLH)&&s.rack.worked||o.push({
id:null,text:teasp.message.getLabel("tm10003620"),date:teasp.util.date.formatDate(e,"SLA")}),s.rack.holidayJoin&&3==s.rack.holidayJoin.flag&&teasp.util.time.isValidRange(i,a)&&o.push({id:null,text:teasp.message.getLabel("tk10005340"),date:teasp.util.date.formatDate(e,"SLA")}),n!=teasp.constant.DAY_TYPE_NORMAL||!s.plannedHoliday||!teasp.util.time.isValidRange(i,a
)||s.rack.validApplys.kyushtu.length||s.workFlag||s.autoLH||o.push({id:null,text:teasp.message.getLabel("tm10003654"),date:teasp.util.date.formatDate(e,"SLA")}),this.isLeavingAcrossNextDay()&&"number"==typeof a&&1440<a&&(this.isProhibitAcrossNextDayOfHolidayWork()&&n!=teasp.constant.DAY_TYPE_NORMAL&&!s.autoLH&&s.rack.validApplys.kyushtu.length?o.push({id:null,text:teasp.message.getLabel("tf10008430"),
date:teasp.util.date.formatDate(e,"SLA")}):(i=teasp.util.date.addDays(e,1),n!=(i=(i=((a=this.getObj().days[i]||{dayType:teasp.constant.DAY_TYPE_NORMAL}).interim||a).dayType)==teasp.constant.DAY_TYPE_PUBLIC_HOLIDAY?teasp.constant.DAY_TYPE_NORMAL_HOLIDAY:i)&&o.push({id:null,text:teasp.message.getLabel("tk10001153",teasp.constant.getDayTypeWord(n),teasp.constant.getDayTypeWord(i)),date:teasp.util.date.formatDate(e,"SLA"
)})));for(var r,l=0;l<(s.rack.invalidApplys||[]).length;l++)switch((r=s.rack.invalidApplys[l]).reason){case teasp.constant.REASON_RANGE_DUPL:o.push({id:r.id,text:teasp.message.getLabel("tm10003630"),date:teasp.util.date.formatDate(e,"SLA")});break;case teasp.constant.REASON_NOHALF:o.push({id:r.id,text:teasp.message.getLabel("tm10003640"),date:teasp.util.date.formatDate(e,"SLA")});break;
case teasp.constant.REASON_NG_HOLIDAY:o.push({id:r.id,text:teasp.message.getLabel("tm10003650"),date:teasp.util.date.formatDate(e,"SLA")});break;case teasp.constant.REASON_NG_KYUSHTU:o.push({id:r.id,text:teasp.message.getLabel("tm10003660"),date:teasp.util.date.formatDate(e,"SLA")});break;case teasp.constant.REASON_NG_EXCHANGE:o.push({id:r.id,text:teasp.message.getLabel("tm10003670"),date:teasp.util.date.formatDate(e
,"SLA")});break;case teasp.constant.REASON_NG_SHIFTCHANGE1:o.push({id:r.id,text:teasp.message.getLabel("tf10011320"),date:teasp.util.date.formatDate(e,"SLA")})}if(t)for(l=0;l<(s.rack.warningApplys||[]).length;l++)switch((r=s.rack.warningApplys[l]).reason){case teasp.constant.REASON_NG_ZANGYO:case teasp.constant.REASON_NG_EARLYSTART:case teasp.constant.REASON_NG_LATESTART:case teasp.constant.REASON_NG_EARLYEND:o.push(
{id:r.id,text:teasp.message.getLabel("tm10003651",r.apply.applyType),date:teasp.util.date.formatDate(e,"SLA")});break;case teasp.constant.REASON_NOT_EXCHANGE:o.push({id:r.id,text:teasp.message.getLabel("tm10003652",r.apply.applyType),date:teasp.util.date.formatDate(e,"SLA")});break;case teasp.constant.REASON_NG_DAYTYPE1:o.push({id:r.id,text:teasp.message.getLabel("tm10003653"),date:teasp.util.date.formatDate(e,"SLA")
})}return o},teasp.data.Pouch.prototype.isEmptyDay=function(e){e=this.getObj().days[e];return!(e.dayType!=teasp.constant.DAY_TYPE_NORMAL&&!e.workFlag&&!e.autoLH||e.rack.holidayJoin&&3==e.rack.holidayJoin.flag||e.plannedHoliday||e.deco.ct.st&&e.deco.ct.et)},teasp.data.Pouch.prototype.getEmptyDayCount=function(){for(var e=this.getMonthDateList(),t=0,a=0;a<e.length;a++){var o=e[a];this.isAlive(o)&&this.isEmptyDay(o
)&&t++}return t},teasp.data.Pouch.prototype.getApplyObjById=function(e){for(var t=0;t<this.getObj().applys.length;t++)if(teasp.util.equalId(this.getObj().applys[t].id,e))return this.getObj().applys[t];return null},teasp.data.Pouch.prototype.getEmpMonthByDate=function(e,t){for(var a in this.getObj().empMonthMap)if(this.getObj().empMonthMap.hasOwnProperty(a)){var o,a=this.getObj().empMonthMap[a];if(
a.startDate<=e&&e<=a.endDate)return t&&(o=this.getEmpMonth(null,a.startDate,t),a=this.getObj().empMonthMap[o.startDate]),a}return null},teasp.data.Pouch.prototype.getEmpMonthByYearMonth=function(e){return this.getObj().empMonthMap[e]||null},teasp.data.Pouch.prototype.getEmpMonthStartDate=function(){return this.getObj().month.startDate},teasp.data.Pouch.prototype.getEmpMonthLastDate=function(){return this.getObj(
).month.endDate},teasp.data.Pouch.prototype.isEmpMonthApprover=function(){return this.isApprover(this.getObj().month.apply)},teasp.data.Pouch.prototype.clearEmpMonthApprover=function(){this.clearApprover(this.getObj().month.apply)},teasp.data.Pouch.prototype.clearApprover=function(e){this.getObj().approver&&delete this.getObj().approver[e.id]},teasp.data.Pouch.prototype.getEmpMonthApplyObj=function(){
return this.getObj().month.apply||{id:null,applyType:teasp.constant.APPLY_TYPE_MONTHLY,status:teasp.constant.STATUS_NOTADMIT,steps:[]}},teasp.data.Pouch.prototype.setEmpMonthApplyObj=function(e){var t=this.getEmpMonthByYearMonth(e.yearMonth);t&&(t.apply.id=e.id,t.apply.applyType=e.applyType,t.apply.status=e.status,t.apply.close=e.close,t.apply.steps=[])},teasp.data.Pouch.prototype.isFixMonth=function(e){
e=e||this.getObj().month;return teasp.constant.STATUS_FIX.contains(e.apply.status)},teasp.data.Pouch.prototype.getPeriodInfoValue=function(e,t,a){var t=t||this.getObj().month,o=t.attributeAtConfirm;return this.isFixMonth(t)&&o&&void 0!==o[e]?o[e]:void 0!==a?a:t.periodInfo[e]},teasp.data.Pouch.prototype.getElapsedMonth=function(e,t){return this.getPeriodInfoValue("elapsedMonth",e,t)},
teasp.data.Pouch.prototype.getNumberOfMonths=function(e,t){return this.getPeriodInfoValue("numberOfMonths",e,t)},teasp.data.Pouch.prototype.getStartDateOfPeriod=function(e,t){return this.getPeriodInfoValue("startDateOfPeriod",e,t)},teasp.data.Pouch.prototype.getEndDateOfPeriod=function(e,t){return this.getPeriodInfoValue("endDateOfPeriod",e,t)},teasp.data.Pouch.prototype.getFixTimeOfPeriod=function(e,t){
return this.getPeriodInfoValue("fixTimeOfPeriod",e,t)},teasp.data.Pouch.prototype.getLegalTimeOfPeriod=function(e,t){return this.getPeriodInfoValue("legalTimeOfPeriod",e,t)},teasp.data.Pouch.prototype.getRemainFixTimeOfPeriod=function(e,t){return this.getPeriodInfoValue("remainFixTimeOfPeriod",e,t)},teasp.data.Pouch.prototype.getRemainLegalTimeOfPeriod=function(e,t){return this.getPeriodInfoValue(
"remainLegalTimeOfPeriod",e,t)},teasp.data.Pouch.prototype.getCarryforwardFromPrev=function(e,t){return this.getPeriodInfoValue("carryforwardFromPrev",e,t)},teasp.data.Pouch.prototype.getRealWorkTimeWoLHPrev=function(e,t){return this.getPeriodInfoValue("realWorkTimeWoLHPrev",e,t)},teasp.data.Pouch.prototype.getSettlementTimePrev=function(e,t){return this.getPeriodInfoValue("settlementTimePrev",e,t)},
teasp.data.Pouch.prototype.isSettlementMonth=function(e){return this.getElapsedMonth(e)==this.getNumberOfMonths(e)},teasp.data.Pouch.prototype.getPeriodInfo=function(e){if(this.getObj().month.config.workSystem!=teasp.constant.WORK_SYSTEM_FLEX)return null;var t=this.getObj().month.periodInfo;return e?t?dojo.toJson(t):null:t},teasp.data.Pouch.prototype.getLegalWorkTimeOfPeriod=function(){return this.getObj(
).month.config.workSystem==teasp.constant.WORK_SYSTEM_FLEX&&this.getObj().month.legalTimeOfPeriod||null},teasp.data.Pouch.prototype.getCarryforwardTime=function(e){return this.getObj().carryforwardMap&&this.getObj().carryforwardMap[e]||0},teasp.data.Pouch.prototype.getRealWorkTimeWoLH=function(e){return this.getObj().realWorkTimeWoLHMap&&this.getObj().realWorkTimeWoLHMap[e]||0},
teasp.data.Pouch.prototype.getAmountTime=function(e){return this.getObj().amountTimeMap&&this.getObj().amountTimeMap[e]||0},teasp.data.Pouch.prototype.getSettlementTime=function(e){return this.getObj().settlementTimeMap&&this.getObj().settlementTimeMap[e]||0},teasp.data.Pouch.prototype.isEmptyAmountTime=function(e){return void 0===(this.getObj().amountTimeMap&&this.getObj().amountTimeMap[e])},
teasp.data.Pouch.prototype.isMissFlexPeriod=function(){return this.getObj().month.missFlexPeriod},teasp.data.Pouch.prototype.getPeriodParam=function(e){for(var e=e||this.getObj().month,t=e,a=t.config,o=(a.workSystem==teasp.constant.WORK_SYSTEM_MUTATE||a.workSystem==teasp.constant.WORK_SYSTEM_FLEX)&&a.variablePeriod||0,s=this.getEmpMonthListByPeriod(e._em,o||1),e={from:teasp.util.date.maxDate(s[0].startDate,
this.getObj().targetEmp.entryDate),to:teasp.util.date.minDate(s[s.length-1].endDate,this.getObj().targetEmp.endDate)},i=0,n=teasp.util.date.getDateList(e.from,e.to),r=0;r<n.length;r++)(c=this.getObj().days[n[r]])&&c.dayType==teasp.constant.DAY_TYPE_NORMAL&&this.isAlive(n[r])&&i++;var l=Math.floor(n.length/7*(1<o?2400:a.legalTimeOfWeek));if(t.legalTime=l,1<o){for(r=0;r<s.length;r++){s[r];t.periodSd=s[0].startDate,
t.periodLen=o}var p={from:teasp.util.date.maxDate(t.startDate,this.getObj().targetEmp.entryDate),to:teasp.util.date.minDate(t.endDate,this.getObj().targetEmp.endDate)},d=teasp.util.date.getDateList(p.from,p.to);if("1"==a.flexFixOption)t.fixTime=a.flexFixMonthTime;else for(var c,r=t.fixTime=0;r<d.length;r++)(c=this.getObj().days[d[r]])&&teasp.logic.EmpTime.isFixDay(c)&&this.isAlive(d[r])&&(
t.fixTime+=c.rack&&c.rack.fixTime||0);t.legalTime=Math.floor(d.length*a.legalTimeOfWeek/7),a.workSystem==teasp.constant.WORK_SYSTEM_FLEX?t.avg50week=Math.floor(50*d.length*60/7):t.avg50week=0}return a.workSystem==teasp.constant.WORK_SYSTEM_FLEX&&t.fixTime>t.legalTime&&"1"==a.flexLegalWorkTimeOption&&(t.legalTime=t.fixTime),{from:e.from,to:e.to,days:n.length,fixDays:i,period:o,currentSd:t.startDate,
currentEd:t.endDate,legalTimeOfPeriod:l}},teasp.data.Pouch.prototype.getDateRangeOfMonth=function(e,t,a){for(var o=this.getEmpMonthList(e,t,a),s=("object"==typeof e&&(e=teasp.util.date.formatDate(e)),-1),i=0;i<o.length;i++){var n=o[i];if(n.startDate<=e&&e<=n.endDate){s=i;break}}a=s+(a&&a<0?a:0),t=s+t,a=0<=a&&a<o.length?o[a]:null,t=0<=t&&t<o.length?o[t]:null;return{from:a.startDate,to:teasp.util.date.addDays(
t.startDate,-1)}},teasp.data.Pouch.prototype.getHolidaySummary=function(){for(var e=[],t=(e[teasp.constant.HOLIDAY_TYPE_PAID]={},e[teasp.constant.HOLIDAY_TYPE_DAIQ]={},e[teasp.constant.HOLIDAY_TYPE_FREE]={},teasp.message.getLabel("tm10003610")),a=teasp.message.getLabel("tm10003570"),o=this.getMonthDateList(),s=0;s<o.length;s++){var i=o[s];if(this.isAlive(i)){i=this.getObj().days[i];if(i.rack.plannedHolidayReal){
var n=(f=e[teasp.constant.HOLIDAY_TYPE_PAID])[t];n||(f[t]={cnt:0,order:0}),f[t].cnt+=1}else{for(var r=[i.rack.validApplys.holidayAll?i.rack.validApplys.holidayAll.holiday:null,i.rack.validApplys.holidayAm?i.rack.validApplys.holidayAm.holiday:null,i.rack.validApplys.holidayPm?i.rack.validApplys.holidayPm.holiday:null],l=0,p=0;p<r.length;p++)(c=r[p])&&((n=(f=e[c.type])[c.name])||(f[c.name]={cnt:0,time:0,order:c.order})
,f[c.name].cnt+=c.range==teasp.constant.RANGE_ALL?1:.5,l+=c.range==teasp.constant.RANGE_ALL?1:.5);for(var d=i.rack.validApplys.holidayTime||[],p=0;p<d.length;p++){var c,m=d[p];(c=m&&m.holiday)&&(n=(n=(f=e[c.type])[c.name])||(f[c.name]={cnt:0,time:0,order:c.order}),m=m._spendTime||0,c.yuqSpend?m=60*Math.ceil(m/60):c.managed&&(m=30*Math.ceil(m/30)),n.time+=m,0)}this.isEmpMonthFixed()&&l<1&&(
!teasp.logic.EmpTime.isFixDay(i)||i.plannedHoliday||i.deco.ct.st||i.deco.ct.et||((n=(f=e[teasp.constant.HOLIDAY_TYPE_FREE])[a])||(f[a]={cnt:0,order:Number.MAX_VALUE}),f[a].cnt+=1-l))}}}var h,u=[],g=[];for(h in e)if(e.hasOwnProperty(h)){var y,f=e[h];for(y in u[h]=0,g[h]=0,f)f.hasOwnProperty(y)&&(u[h]+=f[y].cnt,g[h]+=f[y].time||0)}return{sums:u,sumh:g,items:e}},
teasp.data.Pouch.prototype.createExchangeEnableMap=function(e){var t={},a=this.getObj().days[e],o=a&&a.rack&&a.rack.validApplys||{};if(!a||a.plannedHoliday||o.exchangeS)return t;for(var a=o.exchangeE?o.exchangeE.originalStartDate:e,s=this.getDayInfoByDate(a),o=this.getExchangeLimit(),i=this.getExchangeLimit2(),i=s.dayType==teasp.constant.DAY_TYPE_NORMAL?i:o,o=this.getEmpMonth(null,a),a=this.getEmpMonth(null,a,i),
n=teasp.util.date.getDateList(o.startDate,a.endDate),r=0;r<n.length;r++){var l=n[r],p=this.getObj().days[l]||this.getObj().dayMap[l];p&&p.plannedHoliday||e!=l&&this.isExchangeableDate(l)&&(p=!p||teasp.logic.EmpTime.isFixDay(p),(s.dayType==teasp.constant.DAY_TYPE_NORMAL&&!p||s.dayType!=teasp.constant.DAY_TYPE_NORMAL&&p)&&(t[l]=1))}return t},teasp.data.Pouch.prototype.checkExchangable=function(e,t){e=this.getObj(
).dayMap[teasp.util.date.formatDate(e)]||{dayType:teasp.constant.DAY_TYPE_NORMAL},t=this.getObj().dayMap[teasp.util.date.formatDate(t)]||{dayType:teasp.constant.DAY_TYPE_NORMAL},e=teasp.logic.EmpTime.isFixDay(e),t=teasp.logic.EmpTime.isFixDay(t);return!!(e&&!t||!e&&t)},teasp.data.Pouch.prototype.createDaiqEnableMap=function(){for(var e={},t=this.getObj().targetEmp.daiqManage.daiqLimit||0,t=(12<t&&(t=12),
this.getDateRangeOfMonth(this.getObj().month.startDate,t+1,0)),a=teasp.util.date.getDateList(t.from,t.to),o=0;o<a.length;o++){var s=a[o],i=this.getDayInfoByDate(s),n=this.getExchangedAndDailyFixed(s);i.plannedHoliday||n.dailyFixed||(i.dayType==teasp.constant.DAY_TYPE_NORMAL&&!n.exchanged||i.dayType!=teasp.constant.DAY_TYPE_NORMAL&&n.exchanged)&&(e[s]=1)}return e},
teasp.data.Pouch.prototype.getApplyListByDate=function(e,t,a){var o=this.getEmpDay(e),s=[],i=(!this.getObj().params.startLdate||this.getObj().params.startLdate<=e)&&(!this.getObj().params.endLdate||this.getObj().params.endLdate>=e);if(o.isValid()&&i)for(var n=o.getEmpApplyList(),r=0;r<n.length;r++){var l=n[r];t.contains(l.applyType)||!teasp.constant.STATUS_FIX.contains(l.status)||a&&l.id==a||s.push(l)}else if(
this.getObj().dayMap){var p=this.getObj().dayMap[e];if(p)for(var d=0;d<p.applys.length;d++){l=p.applys[d];t.contains(l.applyType)||!teasp.constant.STATUS_FIX.contains(l.status)||a&&l.id==a||s.push(l)}}return s},teasp.data.Pouch.prototype.isExchangeableDate=function(e){for(var t=this.getApplyListByDate(e,[]),a=0;a<t.length;a++){var o=t[a];if(
o.applyType==teasp.constant.APPLY_TYPE_EXCHANGE||o.applyType==teasp.constant.APPLY_TYPE_DAILY)return!1}return!0},teasp.data.Pouch.prototype.getExchangedAndDailyFixed=function(e){for(var t={dailyFixed:!1,exchanged:!1},a=this.getApplyListByDate(e,[]),o=null,s=null,i=0;i<a.length;i++){var n=a[i];n.applyType==teasp.constant.APPLY_TYPE_EXCHANGE?n.startDate==e?o=n:s=n:n.applyType==teasp.constant.APPLY_TYPE_DAILY&&(
t.dailyFixed=!0)}return o&&s||(t.exchanged=o||s),t},teasp.data.Pouch.prototype.canCancelMonthApply=function(){return"edit"==this.getObj().targetEmp.mode&&(!(!this.getObj().common.cancelMonthApply&&!this.isAdmin(!0))||(!!teasp.util.equalId(this.getObj().targetEmp.userId,this.getObj().targetEmp.managerId)||this.getObj().targetEmp.userId!=this.getObj().sessionInfo.user.id))},
teasp.data.Pouch.prototype.canCancelDayApply=function(){return"edit"==this.getObj().targetEmp.mode&&(!(!this.getObj().common.cancelDayApply&&!this.isAdmin(!0))||(!!teasp.util.equalId(this.getObj().targetEmp.userId,this.getObj().targetEmp.managerId)||this.getObj().targetEmp.userId!=this.getObj().sessionInfo.user.id))},teasp.data.Pouch.prototype.getEmpMonthStatusIconClass=function(){return this.getStatusIconClass(
this.getEmpMonthApplyStatus(0,!0),this.getObj().month.apply.close)},teasp.data.Pouch.prototype.getDayObj=function(e){return this.getObj().days[e]},teasp.data.Pouch.prototype.getDayPattern=function(e){return this.getObj().days[e].pattern},teasp.data.Pouch.prototype.getPlannedHoldays=function(){return this.getObj().plannedHolidays},teasp.data.Pouch.prototype.getDirtyApplys=function(){for(var e={month:null,lst:[],
directs:[],reload:!1},t=this.getObj().rejects||[],a=this.getObj().cancels||[],o=0;o<t.length;o++){var s=t[o];0!=s.objectType||s._clearUp||(s.status==teasp.constant.STATUS_REJECTDONE||s.applyType!=teasp.constant.APPLY_TYPE_HOLIDAY&&s.applyType!=teasp.constant.APPLY_TYPE_EXCHANGE&&s.applyType!=teasp.constant.APPLY_TYPE_KYUSHTU&&s.applyType!=teasp.constant.APPLY_TYPE_SHIFTCHANGE||(e.lst.push(s),s._clearUp=!0,
s.applyType!=teasp.constant.APPLY_TYPE_SHIFTCHANGE&&s.applyType!=teasp.constant.APPLY_TYPE_EXCHANGE||(e.reload=!0)),s.applyType==teasp.constant.APPLY_TYPE_DIRECT||s.applyType==teasp.constant.APPLY_TYPE_KYUSHTU&&s.directFlag?e.directs.push(s
):s.applyType==teasp.constant.APPLY_TYPE_ZANGYO||s.applyType==teasp.constant.APPLY_TYPE_EARLYSTART||s.applyType==teasp.constant.APPLY_TYPE_LATESTART||s.applyType==teasp.constant.APPLY_TYPE_EARLYEND?(i=this.getEmpDay(s.startDate)).isValid()&&i.getInputLimit().flag&&e.directs.push(s):s.status!=teasp.constant.STATUS_REJECTDONE&&s.applyType==teasp.constant.APPLY_TYPE_MONTHLY&&this.getObj().month.yearMonth==s.yearMonth&&(
e.month=s.yearMonth,e.lst.push(s),s._clearUp=!0))}for(o=0;o<a.length;o++){var i,n=a[o];n.applyType==teasp.constant.APPLY_TYPE_MONTHLY?e.month||(e.month=n.yearMonth,e.lst.push(n)):(n.applyType==teasp.constant.APPLY_TYPE_DIRECT||n.applyType==teasp.constant.APPLY_TYPE_KYUSHTU&&n.directFlag?e.directs.push(n
):n.applyType!=teasp.constant.APPLY_TYPE_ZANGYO&&n.applyType!=teasp.constant.APPLY_TYPE_EARLYSTART&&n.applyType!=teasp.constant.APPLY_TYPE_LATESTART&&n.applyType!=teasp.constant.APPLY_TYPE_EARLYEND||(i=this.getEmpDay(n.startDate)).isValid()&&i.getInputLimit().flag&&e.directs.push(n),e.lst.push(n))}return e},teasp.data.Pouch.prototype.getReviseTimeApplys=function(){for(var e=[],t=this.getMonthDateList(),
a=0;a<t.length;a++){var o=t[a],s=this.getObj().days[o].rack.validApplys.reviseTime;if(s&&!(s.length<=0)){for(var i=[],n=0;n<s.length;n++){var r=s[n];teasp.constant.STATUS_APPROVES.contains(r.status)&&!r.entered&&i.push(r)}0<i.length&&(i=i.sort(function(e,t){return e.applyTime<t.applyTime?-1:e.applyTime>t.applyTime?1:0}),e.push(i[0]))}}return e},teasp.data.Pouch.prototype.replaceDays=function(e){if(this.getObj().days
)for(var t in e)e.hasOwnProperty(t)&&(this.getObj().days[t]=e[t]);else this.getObj().days=e},teasp.data.Pouch.prototype.getMonthSubValueByKey=function(e,t){return t=t||teasp.constant.C_DISC,this.getObj().month[t][e]||0},teasp.data.Pouch.prototype.getMonthSubTimeByKey=function(e,t,a,o){return o=o||teasp.constant.C_DISC,this.getDisplayTime(this.getObj().month[o][e],t,a)},
teasp.data.Pouch.prototype.getNextMonthDay=function(e){return this.getMonthDay(teasp.util.date.addDays(e,1))},teasp.data.Pouch.prototype.getMonthDay=function(e){var t=this.getObj().days[e];return t=(t=!t&&this.getObj().dayMap?this.getObj().dayMap[e]:t)||{date:e,dayType:teasp.constant.DAY_TYPE_NORMAL,plannedHoliday:!1,applys:[],startTime:null,endTime:null}},teasp.data.Pouch.prototype.getCalAccessService=function(){
return this.getObj().calAccessService||""},teasp.data.Pouch.prototype.getCalAuthResult=function(){return this.getObj().calAuthResult||{}},teasp.data.Pouch.prototype.getEvents=function(){return this.getObj().events||[]},teasp.data.Pouch.prototype.getAllInfoCount=function(){for(var e=0,t=0;t<this.getObj().infos.length;t++)this.getObj().infos[t].agree||e++;return e+this.getObj().rejects.length+this.getInvalidApplys(
).length+(this.isDaiqLack()?1:0)+this.setStockLackCount()+this.getDiverges().length},teasp.data.Pouch.prototype.getInfos=function(){return this.getObj().infos||[]},teasp.data.Pouch.prototype.getRejects=function(){return this.getObj().rejects||[]},teasp.data.Pouch.prototype.removeReject=function(e){for(var t=this.getObj().rejects||[],a=t.length-1;0<=a;a--)if(t[a].id==e.id){t.splice(a,1);break}},
teasp.data.Pouch.prototype.getStocks=function(){return this.getObj().stocks||[]},teasp.data.Pouch.getDaiqZan=function(e,t,a,o,s,i){return teasp.data.Pouch.getStockZan(e,teasp.constant.STOCK_DAIQ,t,a,o,s,i)},teasp.data.Pouch.getStockZan=function(H,e,t,a,o,s,P){var i=H.sort(function(e,t){
return 0<=e.days&&t.days<0?-1:e.days<0&&0<=t.days?1:0<=e.days&&0<=t.days?e.limitDate==t.limitDate?e.startDate==t.startDate?e.date==t.date?e.createdDate<t.createdDate?-1:e.createdDate>t.createdDate?1:0:e.date<t.date?-1:1:e.startDate<t.startDate?-1:1:e.limitDate<t.limitDate?-1:1:e.date==t.date?e.createdDate<t.createdDate?-1:e.createdDate>t.createdDate?1:0:e.date<t.date?-1:1}),n=[],r={},l=new Decimal(0),p=!1,d=null;
"object"==typeof t&&(t=teasp.util.date.formatDate(t)),"object"==typeof a&&(a=teasp.util.date.formatDate(a)),"object"==typeof o&&(o=teasp.util.date.formatDate(o));for(var c=0;c<i.length;c++)if(i[c].type==e){var m=i[c];if(n.push(m),!(m.days<0)){teasp.util.date.compareDate(m.startDate,t)<=0&&0<teasp.util.date.compareDate(m.limitDate,t)&&(l=l.plus(m.remainDays||0),p=!0,(!d||m.startDate<d)&&(d=m.startDate)),
m.zans=m.days||0;for(var h=0;h<m.consumers.length;h++)(A=r[(N=m.consumers[h]).consumedByStockId])||((A=r[N.consumedByStockId]=N).parents=[],A.parentMap={}),A.parentMap[m.id]||(A.parents.push(m),A.parentMap[m.id]={cdays:N.cdays})}}var u,g=0,y=[],f={},b=0;if(e==teasp.constant.STOCK_DAIQ){for(l=new Decimal(0),p=!1,c=0;c<n.length;c++){m=n[c];if((!o||m.lostFlag||m.date<=o)&&m.days<0)if(m.digest=m.days||0,m.pare=[],
A=r[m.id])for(h=0;h<A.parents.length;h++){var _=A.parents[h],v=A.parentMap[_.id],T=Math.min(Math.abs(m.digest),_.zans);v&&v.cdays<T&&(T=v.cdays),m.digest+=T,m.lostFlag&&(m.digest<0&&(m.digest=0),T!=Math.abs(m.days)&&(A._days=m._days=-1*T)),_.zans-=T,0<=T&&(m.pare.push(_),_.children||(_.children=[]),_.children.push(m))}}for(c=0;c<n.length;c++){m=n[c];if((!o||m.lostFlag||m.date<=o)&&m.days<0&&m.digest<0&&(!s||!s(m.date
))){for(var j=Math.abs(m.digest),E=0;E<n.length&&0<j;E++)0<(_=n[E]).days&&0<_.zans&&_.startDate<=m.date&&m.date<_.limitDate&&(T=Math.min(j,_.zans),_.zans-=T,j-=T,0<T&&(m.pare.push(_),_.children||(_.children=[]),_.children.push(m)));m.digest=-1*j,m.digest<0&&(g+=m.digest)}}for(c=0;c<n.length;c++)0<(m=n[c]).days&&teasp.util.date.compareDate(m.startDate,t)<=0&&0<teasp.util.date.compareDate(m.limitDate,t)&&(l=l.plus(
0<m.zans?m.zans:0),p=!0);for(c=0;c<n.length;c++){var L=[],k=[],C="";if((m=n[c]).days<0){if(N=(N=r[m.id])||{name:m.name,empApplyId:m.apply&&m.apply.id||null,holidayName:m.apply&&m.apply.holiday&&m.apply.holiday.name||"",date:m.date,days:"number"==typeof m._days?m._days:m.days,applyStartDate:m.apply&&teasp.util.date.formatDate(m.apply.startDate)||"",applyEndDate:m.apply&&teasp.util.date.formatDate(m.apply.endDate)||"",
parents:[]},m.pare){for(h=0;h<m.pare.length;h++){var _=m.pare[h],D=teasp.message.getLabel(_.apply?"tm10003720":"tm10003723",teasp.util.date.formatDate(_.date,"+M/d"),_.name);L.contains(D)||L.push(D),_.id&&k.push(_.id)}m.digest<0&&L.push("???")}else{for(var I=0,h=0;h<N.parents.length;h++){_=N.parents[h],D=teasp.message.getLabel(_.apply?"tm10003720":"tm10003723",teasp.util.date.formatDate(_.date,"+M/d"),_.name);
L.contains(D)||L.push(D),_.id&&k.push(_.id),I+=_.days}I<Math.abs(N.days)&&L.push("???")}var A={date:teasp.util.date.formatDate(N.date||N.startDate,"SLA"),rawDate:N.date||N.startDate,subject:N.empApplyId?N.holidayName:N.name,plus:"-",minus:teasp.message.getLabel("tk10005151",Math.abs("number"==typeof N._days?N._days:N.days)),startDate:"-",limitDate:"-",status:L.join(teasp.message.getLabel("tm10001540")),seq:++b,
applyStartDate:N.applyStartDate,applyEndDate:N.applyEndDate,stockId:m.id,pairIds:k};y.push(A),N.empApplyId&&(f[N.empApplyId]=A)}else{var S=0,x=0,C=m.apply?teasp.message.getLabel("tm10001390")+("number"==typeof m.workRealTime&&0<=m.workRealTime?" ("+teasp.util.time.timeValue(m.workRealTime)+")":""):m.name,w=[];if(0==m.days){if(!P)continue}else{var M=[];if(m.children)for(E=0;E<m.children.length;E++){var O=m.children[E]
,D=teasp.util.date.formatDate(O.date,"+M/d");M.contains(D)||(M.push(D),w.push(teasp.util.date.formatDate(O.date))),O.id&&k.push(O.id)}0<M.length&&L.push(teasp.message.getLabel("tm10003730",M.join(", "))),0<m.zans&&m.limitDate<=t?(S=m.zans,L.push(teasp.message.getLabel("tm10010710"))):0<m.zans&&(x=m.zans)}A={};m.apply?(A.date=teasp.util.date.formatDate(m.date,"SLA"),A.rawDate=m.date):(L.push(teasp.message.getLabel(
"tm10003722",teasp.util.date.formatDate(m.date,"SLA"))),A.date=teasp.util.date.formatDate(m.startDate,"SLA"),A.rawDate=m.startDate),A.subject=C,A.plus=teasp.message.getLabel("tk10005151",m.days),A.minus="-",A.over=S?teasp.message.getLabel("tk10005151",S):"-",A.overNum=S||0,A.zann=x?teasp.message.getLabel("tk10005151",x):"-",A.startDate=teasp.util.date.formatDate(m.startDate,"SLA"),
m.days?A.limitDate="2999-12-31"==m.limitDate?teasp.message.getLabel("infinite_date"):teasp.util.date.formatDate(m.limitDate,"SLA"):A.limitDate="-",A.limitDatex=m.limitDate,A.status=L.join(teasp.message.getLabel("tm10001540")),A.seq=++b,A.spendDates=w,A.zanNum=x,A.stockId=m.id,A.pairIds=k,y.push(A),m.apply&&(f[m.apply.id]=A)}}}else{for(var R={},c=0;c<n.length;c++)if((m=n[c]).days<0)for(var W=(N=r[m.id])&&N.parents||[]
,h=0;h<W.length;h++)(w=(w=R[(_=W[h]).id])||(R[_.id]=[])).push(teasp.util.date.formatDate(m.date));for(c=0;c<n.length;c++){L=[];if((m=n[c]).days<0){N=(N=r[m.id])||{name:m.name,empApplyId:m.apply&&m.apply.id||null,holidayName:m.apply&&m.apply.holiday&&m.apply.holiday.name||"",date:m.date,days:m.days,applyStartDate:m.apply&&teasp.util.date.formatDate(m.apply.startDate)||"",
applyEndDate:m.apply&&teasp.util.date.formatDate(m.apply.endDate)||"",parents:[],timeUnit:m.timeUnit,baseTime:m.baseTime};for(var N,I=new Decimal(0),h=0;h<N.parents.length;h++){_=N.parents[h];L.push(teasp.message.getLabel("tm10003723",teasp.util.date.formatDate(_.date,"+M/d"),_.name)),I=I.plus(_.days)}I.toDecimalPlaces(5).lessThan(new Decimal(N.days).abs().toDecimalPlaces(5))&&L.push("???");
var F=teasp.data.Pouch.formatDays(Math.abs("number"==typeof N.daysInPeriod?N.daysInPeriod:N.days),{baseTime:N.baseTime,stepHalf:!1}),A={date:teasp.util.date.formatDate(N.date||N.startDate,"SLA"),rawDate:N.date||N.startDate,subject:N.empApplyId?N.holidayName:N.name,plus:"-",minus:F.disp,convDays:F.raw5,startDate:"-",limitDate:"-",status:L.join(teasp.message.getLabel("tm10001540")),seq:++b,
applyStartDate:N.applyStartDate,applyEndDate:N.applyEndDate};y.push(A),N.empApplyId&&(f[N.empApplyId]=A)}else{S=0,x=0,A=(L.push(teasp.message.getLabel("tm10003722",teasp.util.date.formatDate(m.date,"SLA"))),0<m.remainDays&&m.limitDate<=t?(S=m.remainDays,L.push(teasp.message.getLabel("tm10010710"))):0<m.remainDays&&(x=m.remainDays),{date:teasp.util.date.formatDate(m.startDate,"SLA"),rawDate:m.startDate,subject:m.name,
plus:teasp.data.Pouch.formatDays(m.days,{baseTime:m.baseTime,stepHalf:!1}).disp,minus:"-",over:S?teasp.message.getLabel("tk10005151",S):"-",overNum:S||0,zann:x?teasp.message.getLabel("tk10005151",x):"-",startDate:teasp.util.date.formatDate(m.startDate,"SLA"),limitDate:"2999-12-31"==m.limitDate?teasp.message.getLabel("infinite_date"):teasp.util.date.formatDate(m.limitDate,"SLA"),status:L.join(teasp.message.getLabel(
"tm10001540")),seq:++b,spendDates:R[m.id]||[],zanNum:m.remainDays,limitDatex:m.limitDate});y.push(A),m.apply&&(f[m.apply.id]=A)}}}for(u in y=y.sort(function(e,t){return e.rawDate==t.rawDate?e.seq-t.seq:e.rawDate<t.rawDate?-1:1}),r)r.hasOwnProperty(u)&&((N=r[u]).parents&&delete N.parents,N.parentMap&&delete N.parentMap);for(c=0;c<n.length;c++)(m=n[c]).children&&delete m.children;return{zan:Math.max(l.toNumber(),0),
valid:p,startDateMin:d,overSpend:g,stocks:n,consumers:r,history:y,applys:f}},teasp.data.Pouch.sortProvideStocks=function(e){return e.sort(function(e,t){return e.startDate==t.startDate?e.limitDate==t.limitDate?e.date==t.date?e.createdDate<t.createdDate?-1:e.createdDate>t.createdDate?1:0:e.date<t.date?-1:1:e.limitDate<t.limitDate?-1:1:e.startDate<t.startDate?-1:1})},teasp.data.Pouch.getProvideStockForMinus=function(e){
return teasp.message.getLabel("tk10003750",teasp.util.date.formatDate(e.date,"SLA"),teasp.data.Pouch.formatDays(e.remainDays,{baseTime:e.baseTime}).disp)},teasp.data.Pouch.formatDays=function(e,t){t=dojo.mixin({baseTime:0,stepValue:30,stepHalf:!0,adjustHalf:!0,flag:0},t);if(!t.baseTime)return(a={raw:e,raw5:new Decimal(e).toDecimalPlaces(5).toNumber(),days:e,time:"0:00",minutes:0}).disp=teasp.message.getLabel(
"tm10001010",a.raw5),a;var a,o=2*t.stepValue,s=t.stepValue/2,e=new Decimal(e),i=e.isPositive(),n=(e=t.flag&&!i?new Decimal(0):e).abs(),n=t.stepHalf?n.times(2).floor().div(2):n.floor(),e=e.abs().minus(n),r=new Decimal(t.baseTime||0),l=e.times(r).round(),o=(t.adjustHalf&&!l.isZero()&&!l.mod(t.stepValue).equals(0)&&n.greaterThanOrEqualTo(.5)&&r.mod(o).equals(t.stepValue)&&l.mod(t.stepValue).equals(s)&&(n=n.minus(.5),l=(
e=e.plus(.5)).times(r).round()),e.isZero()||(t.flag?1==t.flag?e=l.div(t.stepValue).ceil().times(t.stepValue).round():2==t.flag&&(e=l.div(t.stepValue).floor().times(t.stepValue).round()):e=e.times(r).round()),n.plus(e.div(r)).times(i?1:-1)),s=e.isZero()?0:e.toNumber(),l=teasp.util.time.timeValue(s),r=[];return(a={raw:o.toNumber(),raw5:o.toDecimalPlaces(5).toNumber(),days:n.times(i?1:-1).toNumber(),time:(
i||"0:00"==l?"":"-")+l,minutes:s*(i?1:-1),baseTime:t.baseTime}).days&&r.push(teasp.message.getLabel("tm10001010",a.days)),"0:00"!=a.time&&r.push(a.time),a.disp=r.join("+")||teasp.message.getLabel("tm10001010",0),a},teasp.data.Pouch.rangeStock=function(e,t,a){if("-"==e.plus)return e.applyStartDate&&e.applyEndDate?t<=e.applyEndDate&&e.applyStartDate<=a:t<=(o=teasp.util.date.formatDate(teasp.util.date.parseDate(e.date))
)&&o<=a;var o=e.limitDatex||e.limitDate,s=teasp.util.date.formatDate(teasp.util.date.parseDate("-"==e.startDate?e.date:e.startDate)),o=teasp.util.date.formatDate(teasp.util.date.parseDate("-"==o?e.date:o));if(s<t&&t<o){if(0<(e.zanNum||0)||0<(e.overNum||0))return!0;for(var i=e.spendDates||[],n=0;n<i.length&&!(t<=i[n]&&i[n]<=a);n++);return n<i.length}return t<o&&s<=a},teasp.data.Pouch.prototype.setDaiqLack=function(e){
this.dataObj.daiqLack=e},teasp.data.Pouch.prototype.isDaiqLack=function(){return this.dataObj.daiqLack},teasp.data.Pouch.prototype.setStockLack=function(e,t,a){this.dataObj.stockLack||(this.dataObj.stockLack={}),this.dataObj.stockLack[e]={type:e,info:t,zan:a}},teasp.data.Pouch.prototype.getStockLack=function(){return this.dataObj.stockLack||{}},teasp.data.Pouch.prototype.setStockLackCount=function(){if(
!this.dataObj.stockLack)return 0;var e,t=0;for(e in this.dataObj.stockLack)this.dataObj.stockLack.hasOwnProperty(e)&&t++;return t},teasp.data.Pouch.prototype.countPlannedHoliday=function(e,t){var a=t||this.getMonthValueByKey("endDate"),o=this.getPlannedHoldays(),s=this.getObj().targetEmp.entryDate,i=this.getObj().targetEmp.endDate,n=0;if(o)for(var r in o)o.hasOwnProperty(r)&&a<r&&(!e||o[r])&&(!s||s<=r)&&(!i||r<=i
)&&n++;return n},teasp.data.Pouch.prototype.getMonthSummary=function(){for(var e,t,a={fixdays:{val:0},realdays:{val:0},workLegalHolidays:{val:0},workHolidays:{val:0},workFixedTime:{val:0},workWholeTime:{val:0},workWholeOmitHolidayTime:{val:0},workRealOmitHolidayTime:{val:0},workRealTime:{val:0},workRealTimeNoDiscretion:{val:0},legalTime:{val:0},amountTime:{val:0},curAmountTime:{val:0},legalOverTime:{val:0},
legalOutOverTime:{val:0},workHolidayTime:{val:0},workNightTime:{val:0},workChargeTime:{val:0},workOver45Time:{val:0},workOver60Time:{val:0},periodWorkLegalMax:{val:0},periodWorkLegalTime:{val:0},overTimeInWeek:{val:0},overTimeInPeriod:{val:0},lateCount:{val:0},lateTime:{val:0},lateLostTime:{val:0},earlyCount:{val:0},earlyTime:{val:0},earlyLostTime:{val:0},privateInnerCount:{val:0},privateInnerTime:{val:0},
privateInnerLostTime:{val:0},paidRestTime:{val:0},yuqRemain:{val:0},plannedRemain:{val:0},workOverTime36:{val:0},totalWorkOverTime36:{val:0},totalWorkOverCount36:{val:0},quartWorkOverTime36:{val:0},workOver40perWeek:{val:0},holidaySummary:this.getHolidaySummary(),periodParam:null,periodJp:"",periodSpan:null,currentSpan:null,flex:this.getWorkSystem()==teasp.constant.WORK_SYSTEM_FLEX,elapsedMonth:1,numberOfMonths:1,
weeklyAvg50Label:"",periodLegalTime:{val:"-"},periodFixTime:{val:"-"},weeklyAvg50:{val:"-"},carryforwardFromPrev:{val:"-"},carryforwardToNext:{val:"-"},settlementTime:{val:"-"},periodAmountTime:{val:"-"},curPeriodAmountTime:{val:"-"}},o=(a.fixdays.col=teasp.message.getLabel("fixDays_label"),a.fixdays.val=teasp.message.getLabel("tm10001010",this.getMonthSubValueByKey("workFixedDay")),
a.realdays.col=teasp.message.getLabel("realDays_label"),a.realdays.val=teasp.message.getLabel("tm10001010",this.getMonthSubValueByKey("workRealDay")),a.workLegalHolidays.col=teasp.message.getLabel("legalHolidayWorkDays_label"),a.workLegalHolidays.val=teasp.message.getLabel("tm10001010",this.getMonthSubValueByKey("workLegalHolidayCount")),a.workHolidays.col=teasp.message.getLabel("holidayWorkDays_label"),
a.workHolidays.val=teasp.message.getLabel("tm10001010",this.getMonthSubValueByKey("workHolidayCount")+this.getMonthSubValueByKey("workPublicHolidayCount")),a.workFixedTime.col=teasp.message.getLabel("fixTimeOfDay_label"),a.workFixedTime.val=this.getMonthSubTimeByKey("workFixedTime"),a.workWholeTime.col=teasp.message.getLabel("wholeTime_label"),a.workWholeTime.val=this.getMonthSubTimeByKey("workWholeTime"),
a.workWholeOmitHolidayTime.col=teasp.message.getLabel("tm10009210"),a.workWholeOmitHolidayTime.val=this.getDisplayTime(this.getMonthSubValueByKey("workWholeTime")-this.getMonthSubValueByKey("workHolidayTime")),a.workRealOmitHolidayTime.col=teasp.message.getLabel("tm10009220"),a.workRealOmitHolidayTime.val=this.getDisplayTime(this.getMonthSubValueByKey("workRealTime")-this.getMonthSubValueByKey("workHolidayTime")),
a.workRealTime.col=teasp.message.getLabel("workRealTime_label"),a.workRealTime.val=this.getMonthSubTimeByKey("workRealTime"),a.workRealTimeNoDiscretion.col=teasp.message.getLabel("tm10009230"),a.workRealTimeNoDiscretion.flag=this.isDefaultUseDiscretionary(),a.workRealTimeNoDiscretion.val=a.workRealTimeNoDiscretion.flag?this.getMonthSubTimeByKey("workRealTime",!1,null,teasp.constant.C_REAL):0,
a.legalTime.col=teasp.message.getLabel("legalWorkTime_label"),a.legalTime.val=this.getMonthTimeByKey("legalTime"),this.getMonthSubValueByKey("amountTime")),o=(a.amountTime.col=teasp.message.getLabel("amountTime_label"),a.amountTime.val=(0<o?"+":"")+this.getMonthSubTimeByKey("amountTime"),this.getMonthValueByKey("avg50week")),s=(a.weeklyAvg50Label=teasp.message.getLabel("tf10010420",teasp.util.time.timeValue(o)),
a.weeklyAvg50.col=teasp.message.getLabel("tf10010450"),a.weeklyAvg50.val=teasp.util.time.timeValue(o),a.periodLegalTime.col=teasp.message.getLabel("tf10010270"),a.periodFixTime.col=teasp.message.getLabel("tf10010460"),a.carryforwardFromPrev.col=teasp.message.getLabel("tf10010220"),a.carryforwardToNext.col=teasp.message.getLabel("tf10010210"),a.settlementTime.col=a.weeklyAvg50Label,
a.settlementTime.col+='<br/><span style="font-size:90%;">'+teasp.message.getLabel("tk10004860",teasp.message.getLabel("tf10010190"))+"</span>",a.periodAmountTime.col=teasp.message.getLabel("tf10010280"),a.curPeriodAmountTime.col=teasp.message.getLabel("tf10010280"),a.legalOverTime.col=teasp.message.getLabel(this.getWorkSystem()!=teasp.constant.WORK_SYSTEM_MANAGER&&this.isDefaultUseDiscretionary(
)?"legalOverTimeM_label":"legalOverTime_label"),a.legalOverTime.val=this.getMonthSubTimeByKey("workLegalOverTime"),a.legalOutOverTime.col=teasp.message.getLabel(this.getWorkSystem()!=teasp.constant.WORK_SYSTEM_MANAGER&&this.isDefaultUseDiscretionary()?"legalOutOverTimeM_label":"legalOutOverTime_label"),a.legalOutOverTime.val=this.getMonthSubTimeByKey("workLegalOutOverTime"),
a.workChargeTime.col=teasp.message.getLabel("legalExtWorkTime_label"),a.workChargeTime.val=this.getMonthSubTimeByKey("workChargeTime"),this.getWorkSystem()==teasp.constant.WORK_SYSTEM_FLEX&&(o=this.getMonthValueByKey("carryforwardFromPrev")||0,n=this.getMonthValueByKey("carryforwardToNext")||0,this.getMonthValueByKey("settlementTimePrev"),a.elapsedMonth=this.getElapsedMonth(),a.numberOfMonths=this.getNumberOfMonths()
,a.startDateOfPeriod=this.getStartDateOfPeriod(),a.endDateOfPeriod=this.getEndDateOfPeriod(),1==a.elapsedMonth&&(o=0),e=n,this.isMissFlexPeriod()||(a.periodAmountTime.val=(0<e?"+":"")+this.getDisplayTime(e)),a.elapsedMonth<a.numberOfMonths&&(a.periodAmountTime.atTheMoment='<span style="font-size:0.9em;">'+teasp.message.getLabel("tf10010470")+"</span>",a.legalOverTime.val="-",a.workChargeTime.val="-"),s=this.getToday(
),(i=this.getObj().month.amountTimeDate)&&this.getObj().month.startDate<=s&&s<=this.getObj().month.endDate?(s=this.getMonthSubValueByKey("curAmountTime"),a.curAmountTime.col=teasp.message.getLabel("amountTime_label"),a.curAmountTime.val=(0<s?"+":"")+this.getDisplayTime(s),a.curAmountTime.atTheMoment='<span style="font-size:0.9em;">'+teasp.message.getLabel("tm10001020",teasp.util.date.formatDate(i,"M/d"))+"</span>",
this.isMissFlexPeriod()||(a.curPeriodAmountTime.val=(0<(e=n)?"+":"")+this.getDisplayTime(e)),a.curPeriodAmountTime.atTheMoment=a.curAmountTime.atTheMoment):(a.curAmountTime.col=a.amountTime.col,a.curAmountTime.val=a.amountTime.val,this.isMissFlexPeriod()||(a.curPeriodAmountTime.val=a.periodAmountTime.val),a.elapsedMonth<a.numberOfMonths&&(
a.curPeriodAmountTime.atTheMoment='<span style="font-size:0.9em;">'+teasp.message.getLabel("tf10010470")+"</span>")),a.elapsedMonthJp="",a.elapsedMonth==a.numberOfMonths?a.elapsedMonthJp=teasp.message.getLabel("tf10010260"):1==a.elapsedMonth?a.elapsedMonthJp=teasp.message.getLabel("tf10010240"):2==a.elapsedMonth&&(a.elapsedMonthJp=teasp.message.getLabel("tf10010250")),this.getObj(
).month.startDate<=a.endDateOfPeriod&&a.startDateOfPeriod<=this.getObj().month.endDate?(a.periodParam=this.getPeriodParam(),a.periodJp=teasp.message.getLabel("tm10010100",a.numberOfMonths),a.periodSpan=teasp.util.date.formatDate(a.startDateOfPeriod,"M/d")+"-"+teasp.util.date.formatDate(a.endDateOfPeriod,"M/d"),a.periodLabel=teasp.message.getLabel("tf10010230",a.periodJp,a.periodSpan,a.elapsedMonthJp),
a.periodLegalTime.val=this.getMonthTimeByKey("legalTimeOfPeriod"),a.periodFixTime.val=this.getMonthTimeByKey("fixTimeOfPeriod")):(a.periodLabel="-",a.periodLegalTime.val="-",a.periodFixTime.val="-"),a.settlementTime.val=this.getMonthSubTimeByKey("settlementTime"),1<a.elapsedMonth&&!this.isMissFlexPeriod()&&(a.carryforwardFromPrev.val=(0<o?"+":"")+this.getMonthTimeByKey("carryforwardFromPrev")),
a.elapsedMonth<a.numberOfMonths&&!this.isMissFlexPeriod()&&(a.carryforwardToNext.val=(0<(this.getMonthValueByKey("carryforwardToNext")||0)?"+":"")+this.getMonthTimeByKey("carryforwardToNext"))),a.workHolidayTime.col=teasp.message.getLabel("tm10009300"),a.workHolidayTime.val=this.getMonthSubTimeByKey("workHolidayTime"),a.workNightTime.col=teasp.message.getLabel("nightWorkTime_label"),
a.workNightTime.val=this.getMonthSubTimeByKey("workNightTime",!1,null,teasp.constant.C_REAL),a.workOver45Time.col=teasp.message.getLabel("tm10009311"),a.workOver45Time.val=this.getMonthSubTimeByKey("workOver45Time"),a.workOver60Time.col=teasp.message.getLabel("tm10009310"),a.workOver60Time.val=this.getMonthSubTimeByKey("workOver60Time"),a.lateCount.col=teasp.message.getLabel(this.getWorkSystem(
)==teasp.constant.WORK_SYSTEM_FLEX?"tm10009321":"tm10009320"),a.lateCount.val=teasp.message.getLabel("tm10001670",this.getMonthSubValueByKey("lateCount")),a.lateTime.val=" "+this.getMonthSubTimeByKey("lateTime"),a.lateLostTime.val=teasp.message.getLabel("tm10001680",this.getMonthSubTimeByKey("lateLostTime")),a.earlyCount.col=teasp.message.getLabel(this.getWorkSystem(
)==teasp.constant.WORK_SYSTEM_FLEX?"tm10009331":"tm10009330"),a.earlyCount.val=teasp.message.getLabel("tm10001670",this.getMonthSubValueByKey("earlyCount")),a.earlyTime.val=" "+this.getMonthSubTimeByKey("earlyTime"),a.earlyLostTime.val=teasp.message.getLabel("tm10001680",this.getMonthSubTimeByKey("earlyLostTime")),a.privateInnerCount.col=teasp.message.getLabel(this.getWorkSystem(
)==teasp.constant.WORK_SYSTEM_FLEX?"tm10009341":"tm10009340",this.getWorkSystem()==teasp.constant.WORK_SYSTEM_FLEX?teasp.message.getLabel("core_label"):teasp.message.getLabel("work_label")),a.privateInnerCount.val=teasp.message.getLabel("tm10001670",this.getMonthSubValueByKey("privateInnerCount")),a.privateInnerTime.val=" "+this.getMonthSubTimeByKey("privateInnerTime"),
a.privateInnerLostTime.val=teasp.message.getLabel("tm10001680",this.getMonthSubTimeByKey("privateInnerLostTime")),a.paidRestTime.col=teasp.message.getLabel("tm10009360"),a.paidRestTime.val=this.getMonthSubTimeByKey("paidRestTime"),this.getEmpMonthLastDate()),i=(a.yuqRemain.col=teasp.message.getLabel("tm10009390")+teasp.message.getLabel("tm10009140",teasp.util.date.formatDate(s,"M/d")),
a.yuqRemain.val=this.getDspYuqRemain(s,!0).display,this.getEmpMonth(null,this.getStartDate(),1)),n=teasp.util.date.formatMonth("zv00000020",Math.floor(i.yearMonth/100),i.yearMonth%100,i.subNo),r=(a.plannedRemain.col=teasp.message.getLabel("tm10009150",n),a.plannedRemain.val=teasp.message.getLabel("tm10001010",this.countPlannedHoliday()),a.workOverTime36.col=teasp.message.getLabel("overTimeOfMonth_label"),
a.workOverTime36.val=this.getMonthSubTimeByKey("workOverTime36"),a.totalWorkOverTime36.col=teasp.message.getLabel("overTimeOfYear_label"),a.totalWorkOverTime36.val=this.getMonthSubTimeByKey("totalWorkOverTime36"),a.totalWorkOverCount36.col=teasp.message.getLabel("overCountOfYear_label"),a.totalWorkOverCount36.val=teasp.message.getLabel("tm10001670",this.getMonthSubValueByKey("totalWorkOverCount36")||0),
a.quartWorkOverTime36.col=teasp.message.getLabel("tk10001173"),a.quartWorkOverTime36.val=this.getMonthSubTimeByKey("quartWorkOverTime36"),a.workOver40perWeek.col=teasp.message.getLabel("overTimeSafety_label"),a.workOver40perWeek.val=this.getMonthSubTimeByKey("workOver40perWeek",!1,null,teasp.constant.C_REAL),this.getWorkSystem()==teasp.constant.WORK_SYSTEM_MANAGER&&(a.workWholeOmitHolidayTime.val="-",
a.workRealOmitHolidayTime.val="-",a.legalTime.val="-",a.amountTime.val="-",a.legalOverTime.val="-",a.legalOutOverTime.val="-",a.workHolidayTime.val="-",a.workChargeTime.val="-",a.workOver45Time.val="-",a.workOver60Time.val="-",a.lateCount.val="",a.lateTime.val="-",a.lateLostTime.val="-",a.earlyCount.val="",a.earlyTime.val="-",a.earlyLostTime.val="-",a.privateInnerCount.val="",a.privateInnerTime.val="-",
a.privateInnerLostTime.val="-",a.workOverTime36.val="-",a.totalWorkOverCount36.val="-",a.totalWorkOverTime36.val="-",a.quartWorkOverTime36.val="-"),this.getWorkSystem()==teasp.constant.WORK_SYSTEM_MUTATE&&(a.periodParam=this.getPeriodParam(),0<a.periodParam.period&&(a.periodJp="",0==a.periodParam.period?a.periodJp=teasp.message.getLabel("tm10009020"):12==a.periodParam.period?a.periodJp=teasp.message.getLabel(
"tm10009030"):a.periodJp=a.periodParam.period+teasp.message.getLabel("tm10009040"),s=(e=this.getMonthValueByKey("legalTimeOfPeriod"))<(o=(this.getMonthValueByKey("preWorkLegalTimeOfPeriod")||0)+this.getMonthSubValueByKey("workLegalTime")-this.getMonthSubValueByKey("workChargeTime40H"))?o-e:0,a.periodSpan=teasp.util.date.formatDate(a.periodParam.from,"M/d")+"-"+teasp.util.date.formatDate(a.periodParam.to,"M/d"),
a.currentSpan=teasp.util.date.formatDate(a.periodParam.from,"M/d")+"-"+teasp.util.date.formatDate(a.periodParam.currentEd,"M/d"),a.periodWorkLegalMax.col=teasp.message.getLabel("tm10009050")+"("+a.periodJp+":"+a.periodSpan+")"+teasp.message.getLabel("tm10009060"),a.periodWorkLegalMax.val=teasp.util.time.timeValue(e),a.periodWorkLegalTime.col=teasp.message.getLabel("tm10009070"
)+"("+a.currentSpan+")"+teasp.message.getLabel("tm10009080"),a.periodWorkLegalTime.val=teasp.util.time.timeValue(Number(o)),a.overTimeInPeriod.col="",a.overTimeInPeriod.val=teasp.util.time.timeValue(s),a.overTimeInWeek.val=this.getMonthSubTimeByKey("workChargeTime40H"))),t=this.getWorkSystem()==teasp.constant.WORK_SYSTEM_FIX?(t=["fixdays","realdays",null,"workFixedTime","workWholeTime","workRealTime"],
this.isDiscretionaryOption()&&this.isDefaultUseDiscretionary()&&t.push("workRealTimeNoDiscretion"),t.concat([null,"legalOverTime","legalOutOverTime","workHolidayTime",null,"workNightTime","workChargeTime"])):this.getWorkSystem()==teasp.constant.WORK_SYSTEM_FLEX?["fixdays","realdays",null,"workFixedTime","workWholeTime","amountTime",null,"legalOverTime","legalOutOverTime","workHolidayTime",null,"workNightTime",
"workChargeTime"]:this.getWorkSystem()==teasp.constant.WORK_SYSTEM_MUTATE?["fixdays","realdays","workFixedTime","workWholeTime",null,"workRealTime","legalOverTime","legalOutOverTime","workHolidayTime",null,"workNightTime","workChargeTime"]:["fixdays","realdays","workNightTime"],[]),l=0;l<t.length;l++)r.push(null==t[l]?null:a[t[l]]);var p=this.getVariablePeriod();switch(this.getWorkSystem()){case"0":a.categoryL="fix",
a.categoryS=this.isDefaultUseDiscretionary()?"fixd":"fixn";break;case"1":1<p?(a.categoryL="flexp",a.elapsedMonth==a.numberOfMonths?a.categoryS="flexe":1==a.elapsedMonth?a.categoryS="flexf":a.categoryS="flexm"):(a.categoryL="flex",a.categoryS="flexo");break;case"2":a.categoryL="var",a.categoryS=0==p?"varw":"var"+p;break;default:a.categoryL="man",a.categoryS="man"}return{o:a,tipList:r}},
teasp.data.Pouch.prototype.getHolidayHistory=function(){for(var e,t=this.dataObj.holidayHistory||{},a={},o={},s=[],i=0;i<t.empYuqs.length;i++)t.empYuqs[i].empApplyId&&(o[t.empYuqs[i].empApplyId]=t.empYuqs[i]);for(e in t.empDays)if(t.empDays.hasOwnProperty(e))for(var n=t.empDays[e],i=0;i<2;i++){var r=0==i?n.applyId.holidayApplyId1:n.applyId.holidayApplyId2,l=0==i?n.holiday1:n.holiday2,p=0;l&&(
l.range==teasp.constant.RANGE_ALL?p=1:l.range!=teasp.constant.RANGE_AM&&l.range!=teasp.constant.RANGE_PM||(p=.5)),r&&(a[r]||(a[r]={date:e,days:0}),a[r].days+=p),!r&&0<p&&s.push({startDate:e,endDate:e,subject:l.name,range:l.range,days:p,time:0,note:""})}for(i=0;i<t.empApplys.length;i++){var d,c=t.empApplys[i];c.holiday&&(d=0,c.holiday.range==teasp.constant.RANGE_TIME&&(d=Math.abs(o[c.id]&&o[c.id].totalTime||0)),(
a[c.id]||0<d)&&s.push({startDate:c.startDate,endDate:c.endDate,subject:c.holiday.name,range:c.holiday.range,days:a[c.id]?a[c.id].days:0,time:d||0,note:c.note||""}))}return s=s.sort(function(e,t){return e.startDate==t.startDate?"2"==e.range?-1:1:e.startDate<t.startDate?-1:1}),{startDate:t.startDate,list:s}},teasp.data.Pouch.prototype.isEnableStockHoliday=function(){return this.getObj().config.enableStockHoliday||!1},
teasp.data.Pouch.prototype.isInputWorkingTimeOnWorkTImeView=function(){return!teasp.isNarrow()&&this.getObj().config.inputWorkingTimeOnWorkTimeView||!1},teasp.data.Pouch.prototype.isInputAccessControl=function(e){return(!e||!teasp.isNarrow())&&(!!this.getObj().common.useAccessControlSystem&&(this.isEmpMonthFixed(null,!0)?!!this.getObj().month.inputAccessControlFlag:!(!this.getObj(
).config.useAccessControlSystem||!this.getInputAccessControlFlagByDate())))},teasp.data.Pouch.prototype.getInputAccessControlFlagByDate=function(){var e=this.getObj().month&&this.getObj().month.endDate||null,t=this.getObj().targetEmp;if(!e||t.inputAccessControlFlagLock)return t.inputAccessControlFlag;var a=t.inputAccessControlFlagHistory;if(a&&a.length)for(var o=0;o<a.length;o++){var s=a[o];if(s.date>e
)return s.inputAccessControlFlag}return t.inputAccessControlFlag},teasp.data.Pouch.prototype.isInputAccessControlValid=function(){return this.getObj().common.useAccessControlSystem&&this.getObj().config.useAccessControlSystem},teasp.data.Pouch.prototype.getInputAccessControlStr=function(){return this.isInputAccessControlValid()?1==this.getObj().targetEmp.inputAccessControlFlag?teasp.message.getLabel("em10001150"
):teasp.message.getLabel("em10001160"):""},teasp.data.Pouch.prototype.isMsAccessInfo=function(){return this.isInputAccessControl()&&this.getObj().config.msAccessInfo},teasp.data.Pouch.prototype.isLeavingAcrossNextDay=function(){return"0"!=(this.getObj().config.leavingAcrossNextDay||"0")},teasp.data.Pouch.prototype.isProhibitAcrossNextDayOfHolidayWork=function(){return"2"==(this.getObj(
).config.leavingAcrossNextDay||"0")},teasp.data.Pouch.prototype.getMaxStockHoliday=function(){return this.getObj().config.maxStockHoliday||0},teasp.data.Pouch.prototype.getMaxStockHolidayPerYear=function(){return this.getObj().config.maxStockHolidayPerYear||0},teasp.data.Pouch.prototype.isProhibitApplicantEliminatingLegalHoliday=function(){return this.getObj().config.prohibitApplicantEliminatingLegalHoliday||!1},
teasp.data.Pouch.prototype.isProhibitInputTimeUntilApproved=function(){return this.getObj().config.prohibitInputTimeUntilApproved||!1},teasp.data.Pouch.prototype.isSeparateDailyFixButton=function(){return this.getObj().config.separateDailyFixButton||!1},teasp.data.Pouch.prototype.isSummary36TimePeriod=function(){return this.getObj().config.summary36TimePeriod||!1},teasp.data.Pouch.prototype.getDeptList=function(e){
if(!e)return this.getObj().depts||[];var t=dojo.clone(this.getObj().depts||[]);return teasp.util.levelingDepts(t,e),t},teasp.data.Pouch.prototype.isPermitDeptFixWoMonthFix=function(){return this.getObj().common.permitDeptFixWoMonthFix},teasp.data.Pouch.prototype.getPermitUpdateTimeLevel=function(){return this.getObj().config.permitUpdateTimeLevel},teasp.data.Pouch.prototype.isUpdater=function(){
var e=this.getPermitUpdateTimeLevel();return!e||(1==e&&!this.isOwner()||(!(2!=e||!this.isAdmin(!0))||!(3!=e||!this.isAdmin(!0)&&!this.isAllEditor())))},teasp.data.Pouch.prototype.getOverTimeBorderTime=function(e,t){t=t||this.getObj().config;return t.workSystem==teasp.constant.WORK_SYSTEM_FLEX?Math.max(t.flexEndTime,e):t.overTimeBorderTime},teasp.data.Pouch.prototype.getEarlyWorkBorderTime=function(e,t){
t=t||this.getObj().config;return t.workSystem==teasp.constant.WORK_SYSTEM_FLEX?Math.min(t.flexStartTime,e):t.earlyWorkBorderTime},teasp.data.Pouch.prototype.isNightChargeOnly=function(){return this.getObj().config.nightChargeOnly||!1},teasp.data.Pouch.prototype.isHighlightLateEarly=function(){return this.getObj().config.highlightLateEarly||!1},teasp.data.Pouch.prototype.getLegalTimeOfDay=function(){
return this.getObj().config.legalTimeOfDay||0},teasp.data.Pouch.prototype.isFlexFixTime=function(){return"1"==this.getObj().config.flexFixOption},teasp.data.Pouch.prototype.getLimitedTimeDistance=function(){return 60*(this.dataObj.common.limitedTimeDistance||48)},teasp.data.Pouch.prototype.getRangeMonths=function(e,t){for(var a=this.dataObj.months,o=[],s=0;s<a.length;s++)a[s].startDate<=t&&a[s].endDate>=e&&o.push(
a[s]);return o},teasp.data.Pouch.prototype.isOldDate=function(){for(var e=this.dataObj.months||[],t=[],a=e.length-1;0<=a;a--){var o=e[a];o.apply&&teasp.constant.STATUS_FIX.contains(o.apply.status)&&t.push(""+o.yearMonth)}return teasp.util.isOldDate(t,this.getInitialDateOfMonth(),this.getMarkOfMonth())},teasp.data.Pouch.prototype.getStandardRange=function(e){var t,a,o=this.getObj().config,s=o.defaultPattern;if(
e.st==s.stdStartTime&&e.et==s.stdEndTime)return{from:e.st,to:e.et};if(e.pattern&&e.pattern.disableCoreTime&&e.st==e.pattern.stdStartTime&&e.et==e.pattern.stdEndTime)return{from:e.st,to:e.et};if(e.useCoreTime)t=e.st-(o.coreStartTime-s.stdStartTime),a=e.et+(s.stdEndTime-o.coreEndTime);else{for(var i=e.timeHolidayApplys||[],n=0;n<i.length;n++)i[n].startTime<e.st&&(e.st=i[n].startTime),e.et<i[n].endTime&&(
e.et=i[n].endTime);t=this.getReachTime(e.et,e.pattern.restTimes,e.pattern.standardFixTime,!0),a=this.getReachTime(e.st,e.pattern.restTimes,e.pattern.standardFixTime,!1)}return{from:t<e.st?t:e.st,to:e.et<a?a:e.et}},teasp.data.Pouch.prototype.getReachTime=function(e,t,a,o){var s,i=this.getPushRestTime(a),n=e;return o?(s=e-(n=teasp.logic.EmpTime.getReachTimeReverse(e,t,a))-a)<i&&(
n=teasp.logic.EmpTime.getReachTimeReverse(n,t,i-s)):(s=(n=teasp.logic.EmpTime.getReachTime(e,t,a))-e-a)<i&&(n=teasp.logic.EmpTime.getReachTime(n,t,i-s)),n},teasp.data.Pouch.prototype.getPushRestTime=function(e){for(var t=this.getRestTimeCheck(),a=0,o=0;o<t.length;o++){var s=t[o];s.check&&s.push&&e>s.workTime&&a<s.restTime&&(a=s.restTime)}return a},teasp.data.Pouch.prototype.getPermitDivergenceTime=function(){
return this.getObj().config.permitDivergenceTime||0},teasp.data.Pouch.prototype.isPermitDailyApply=function(){return this.getObj().config.permitDailyApply||!1},teasp.data.Pouch.prototype.isPermitMonthlyApply=function(){return this.getObj().config.permitMonthlyApply||!1},teasp.data.Pouch.prototype.getDiverges=function(){return this.isInputAccessControl()&&this.diverges||[]},
teasp.data.Pouch.prototype.setDiverges=function(e){this.diverges||(this.diverges=[]),this.diverges.push(e)},teasp.data.Pouch.prototype.clearDiverges=function(){this.diverges=null},teasp.data.Pouch.prototype.checkEmpMonthHook=function(t){this.isInputAccessControl()&&!this.getObj().month.id?teasp.manager.request("createEmpMonthHook",{empId:this.getEmpId(),month:this.getYearMonth(),startDate:this.getStartDate()},this,{}
,this,function(){t(!0)},function(e){t(!1,e)}):t(!0)},teasp.data.Pouch.prototype.getSummarySettings=function(){var e=this.dataObj.common.config&&this.dataObj.common.config.summarySettings||null;return e?dojo.clone(e):null},teasp.data.Pouch.prototype.existEmpMonthCustomKeys=function(){return!!(
this.dataObj.common.config&&this.dataObj.common.config.summarySettings&&this.dataObj.common.config.summarySettings.empMonthCustomKeys)},teasp.data.Pouch.prototype.getEmpMonthCustomKeys=function(){return(this.dataObj.common.config&&this.dataObj.common.config.summarySettings&&this.dataObj.common.config.summarySettings.empMonthCustomKeys||"").split(",")},teasp.data.Pouch.prototype.getEmpMonthValueByKey=function(e){
var t=/^(\-)?([\d\.]+)$/.exec(e);if(t)return parseFloat(t[0]);for(var a=e.split("."),o=this.getObj().month||{},s=0;s<a.length;s++){var i=a[s];if(!(s<a.length-1&&o))return o?"number"==typeof o[i]?o[i]:o[i]||null:null;o=o[i]}return null},teasp.data.Pouch.prototype.setFixTimeMap=function(e,t,a){this.dataObj.fixTimeMap[t]=a},teasp.data.Pouch.prototype.getLegalTimeWeek=function(e,t){var a=e.config;if(
a.workSystem==teasp.constant.WORK_SYSTEM_MUTATE&&0<a.variablePeriod&&this.isUseLegacyIrregularLogicUntil(e))return 0;for(var o=a.legalTimeOfWeek,t=teasp.util.date.parseDate(t),s=t.getDay(),i=parseInt(a.initialDayOfWeek,10),s=(i!=s&&(t=teasp.util.date.addDays(t,i-s-(s<i?7:0))),teasp.util.date.addDays(t,7)),n=teasp.util.date.formatDate(t),r=teasp.util.date.formatDate(s),l=(
a.workSystem==teasp.constant.WORK_SYSTEM_MUTATE&&0<a.variablePeriod&&e.periodInfo&&(1==e.periodInfo.elapsedMonth||e.periodInfo.elapsedMonth==e.periodInfo.numberOfMonths)&&(1==e.periodInfo.elapsedMonth&&n<e.startDate&&(n=e.startDate),i=teasp.util.date.addDays(e.endDate,1),e.periodInfo.elapsedMonth==e.periodInfo.numberOfMonths&&i<r&&(r=i),(t=this.getEntryDate())&&n<t&&(n=t),(s=this.getEndDate())&&(
s=teasp.util.date.addDays(s,1))<r&&(r=s),e=teasp.util.date.daysInRange(n,r)-1,i=a.variablePeriod||0,o=Math.floor(e*(1<i?2400:a.legalTimeOfWeek)/7)),0);n<r;)this.isAlive(n)&&(l+=this.dataObj.fixTimeMap[n]||0),n=teasp.util.date.addDays(n,1);return Math.max(o,l)},teasp.data.Pouch.prototype.isUseLegacyIrregularLogicUntil=function(e){var t=(this.dataObj.common&&this.dataObj.common.config||{}).useLegacyIrregularLogicUntil;
return t&&e.yearMonth<=t},teasp.data.Pouch.prototype.getHourlyLeaveLimitOfDay=function(){return(this.dataObj.common&&this.dataObj.common.config||{}).hourlyLeaveLimitOfDay||3},teasp.data.Pouch.prototype.isHourlyLeaveLimitOfDay=function(e){e=this.getObj().days[e];return(e&&e.rack&&e.rack.validApplys&&e.rack.validApplys.holidayTime||[]).length>=this.getHourlyLeaveLimitOfDay()},
teasp.data.Pouch.prototype.getConfigHistory=function(){return this.dataObj.configHistory||[]},teasp.data.Pouch.checkStockBaseTime=function(e,t,a,o,s,i){for(var n=!1,r=0;r<a.length;r++){var l=a[r];if(!(s&&l.type!=s||!s&&"代休"==l.type)&&(l.baseTime||!(l.days<0||new Decimal(l.days).times(2).isInteger()))){var p=null,p=(0<l.days?p=l.startDate:l.days<0&&(p=l.date),teasp.util.getConfigByDate(t||[],p)),d=null,
d=p.config?p.config.BaseTimeForStock__c||null:p.baseTimeForStock||null;if(l.baseTime!=d){n=!0;break}}}return i&&(n?teasp.data.Pouch.rebuildStockWithTime(e,o,s,i):i(0)),n},teasp.data.Pouch.rebuildStockWithTime=function(e,t,a,o){console.log("rebuildStockWithTime empId="+e+", stockType="+(a||"null")+", date="+t),teasp.action.contact.remoteMethods([{funcName:"getExtResult",params:{action:"rebuildStockWithTime",empId:e,
stockType:a,date:t}}],{errorAreaId:null,nowait:!1},function(e){console.log(e),o(1,teasp.logic.convert.convStockObjs(e.stocks),e.mapError)},function(e){console.log(e),o(-1,teasp.message.getErrorMessage(e))},this)},teasp.data.Pouch.getFutureBaseTimeForStockChange=function(e,t){for(var a=teasp.util.getBaseTimeForStock(teasp.util.getConfigByDate(e,t)),o=teasp.util.getFutureConfigs(e,t),s=0;s<o.length;s++)if(
a!=teasp.util.getBaseTimeForStock(o[s]))return o.splice(0,s),o;return[]},teasp.data.Pouch.getSpendStockChangedBaseTime=function(e,t,a){if(!e||!e.stocks||!e.stocks.length)return 0;t=teasp.data.Pouch.getFutureBaseTimeForStockChange(t,a);if(!t.length)return 0;for(var o=t[0].startDate,s=[],i=[],n=0;n<e.stocks.length;n++){var r=e.stocks[n];if(!(r.days<0||a<r.startDate||r.limitDate<=a))for(var l=0;l<r.consumers.length;l++
){var p=r.consumers[l];!p.lostFlag&&p.timeUnit&&(o<=p.date?s:i).push(p)}}return i.length||s.length?s.length?i.length?3:2:1:0},teasp.data.Pouch.getBaseTimeChanges=function(e,t,a){for(var o=e||[],s=t.startDateMin,i=(teasp.util.getBaseTimeForStock(teasp.util.getConfigByDate(o,a)),null),n=null,r=[],l=0;l<o.length;l++){var p=o[l];if(!(p.endDate&&p.endDate<s)){if(p.startDate&&a<p.startDate)break;
var d=teasp.util.getBaseTimeForStock(p);i&&i==d?n.endDate=p.endDate:(n={startDate:p.startDate,endDate:p.endDate,baseTimeForStock:d},r.push(n)),i=d}}return r},teasp.data.Pouch.isZanRoundUp=function(e,t,a){for(var o=teasp.data.Pouch.getBaseTimeChanges(e,t,a),s=new Decimal(0),i={},n=-1,r=0;r<o.length;r++){for(var l,p,d=o[r],c=((!d.startDate||d.startDate<=a)&&(!d.endDate||a<=d.endDate)&&(n=r),s.isZero()||s.times(2
).isInt()||!d.baseTimeForStock||((p=(p=(p=l=s.mod(1)).greaterThan(.5)?p.minus(.5):p).times(d.baseTimeForStock).div(60)).isInt()||(p=p.mod(1).greaterThan(.5)?p.ceil():p.ceil().minus(.5)),s=s.minus(l).plus(l.greaterThan(.5)?.5:0).plus(p.times(60).div(d.baseTimeForStock))),d.beginZan=s.toNumber(),new Decimal(0)),m=new Decimal(0),h=[],u=0;u<t.stocks.length;u++){var g=t.stocks[u];if(!(
g.days<0||d.startDate&&g.limitDate<=d.startDate||d.endDate&&d.endDate<g.startDate)){i[g.id]||(s=s.plus(g.days),i[g.id]=1,c=c.plus(g.days));for(var y=0;y<g.consumers.length;y++){var f=g.consumers[y];f.lostFlag?i[f.consumedByStockId]||(s=s.plus(f.days),m=m.plus(Math.abs(f.days)),h.push(Math.abs(f.days)),i[f.consumedByStockId]=1):d.startDate&&!(d.startDate<=f.date)||d.endDate&&!(f.date<=d.endDate
)||i[f.consumedByStockId]||(s=s.plus(f.days),m=m.plus(Math.abs(f.days)),h.push(Math.abs(f.days)),i[f.consumedByStockId]=1)}}}d.plus=c.toNumber(),d.minus=m.toNumber(),d.minusLst=h,d.zan=s.toNumber(),d.fraction=!s.times(2).isInt()}return console.log(o),!(n<=0)&&o[n-1].fraction},teasp.data.Pouch.prototype.isUseShiftChange=function(){return(this.dataObj.common.config||{}).useShiftChange&&((this.dataObj.config.config||{}
).empApply||{}).useShiftChange||!1},teasp.data.Pouch.prototype.getShiftChangeableDates=function(e){for(var t={},a=this.getObj().month,o=teasp.util.date.getWeekByDate(e,this.getInitialDayOfWeek()),s=null,i=0;i<o.length;i++){var n=o[i],r={own:e==n},n=(t[n]=r,(n<a.startDate||a.endDate<n)&&(r.out=1),(n<this.getEntryDate()||this.getEndDate()<n)&&(r.out=2),this.getEmpDay(n)),l=n.getValidApplys();l&&(r.validShiftSet=!(
!l.shiftSet||!l.shiftSet.dayType),r.validShiftChange=!!l.shiftChange,r.validDailyFix=!!l.dailyFix,!r.validShiftSet||r.validShiftChange||r.validDailyFix||(r.fine=!0,r.dayType=n.getDayType(),!r.out&&r.own&&(s=r.dayType)))}if(null!==s)for(var p in t)!t.hasOwnProperty(p)||(r=t[p]).out||!r.fine||r.own||(!s&&r.dayType||s&&!r.dayType)&&(r.changeable=!0);return t},teasp.data.Pouch.prototype.checkShiftChangeMonth=function(){
for(var e=this.getMonthDateList(),t={},a=0;a<e.length;a++){var o,s=e[a],i=this.getEmpDay(s),n=(this.getObj().month,i.getEmpApplyByKey(teasp.constant.APPLY_KEY_SHIFTCHANGE));n&&!t[n.id]&&(s=this.getEmpDay(s==n.exchangeDate?n.startDate:n.exchangeDate),teasp.util.date.getWeekByDate(n.startDate,this.getInitialDayOfWeek()).indexOf(s.getKey()),this.getEmpMonth(null,s.getKey()),o=i.getDayType(),s=s.getDayType(),t[n.id]=1,(
!o&&!s||o&&s)&&i.getObj().rack.invalidApplys.push({apply:n,reason:teasp.constant.REASON_NG_SHIFTCHANGE1,keep:!0}))}},teasp.data.Pouch.prototype.isUseMonthlyOverTimeApply=function(){var e=this.dataObj.config;return e.workSystem==teasp.constant.WORK_SYSTEM_FLEX&&1==e.variablePeriod&&((e.config||{}).empApply||{}).useMonthlyOverTimeApply||!1},teasp.data.Pouch.prototype.isShowMonthlyOverTimeApplyButton=function(){
return 0<this.getMonthlyOverTimeApplys().length||this.isUseMonthlyOverTimeApply()},teasp.data.Pouch.prototype.isMonthlyOverTimeRequireFlag=function(){return this.isUseMonthlyOverTimeApply()&&((this.dataObj.config.config||{}).empApply||{}).monthlyOverTimeRequireFlag||!1},teasp.data.Pouch.prototype.getMonthlyOverTimeRequireTime=function(){return((this.dataObj.config.config||{}).empApply||{}
).monthlyOverTimeRequireTime||0},teasp.data.Pouch.prototype.isMonthlyOverTimeDupl=function(){return((this.dataObj.config.config||{}).empApply||{}).monthlyOverTimeDupl||!1},teasp.data.Pouch.prototype.isValidMonthlyOverTimeApply=function(e){return this.isUseMonthlyOverTimeApply()},teasp.data.Pouch.prototype.getAmountTimeForApply=function(e){var t=this.dataObj.config;
return t.workSystem==teasp.constant.WORK_SYSTEM_FLEX&&1==t.variablePeriod?this.getMonthSubTimeByKey("amountTime"):"-"},teasp.data.Pouch.prototype.canSelectMonthlyOverTime=function(){return!!this.isUseMonthlyOverTimeApply()&&!(!this.isMonthlyOverTimeDupl()&&0<this.getMonthlyOverTimeApplys().length)},teasp.data.Pouch.prototype.setMonthlyOverTimeApplys=function(e){this.monthlyOverTimeApplys=[];
var t=this.getEmpMonthStartDate(),a=this.getEmpMonthLastDate();dojo.forEach(e||[],function(e){t<=e.startDate&&e.startDate<=a&&this.monthlyOverTimeApplys.push(e)},this),this.monthlyOverTimeApplys=this.monthlyOverTimeApplys.sort(function(e,t){return e.applyTime==t.applyTime?e.id<t.id?-1:1:e.applyTime<t.applyTime?-1:1})},teasp.data.Pouch.prototype.getMonthlyOverTimeApplys=function(){return this.monthlyOverTimeApplys||[]
},teasp.data.Pouch.prototype.getStatusClassOfApplysIcon=function(e){var t=[],a=[],o=[];return dojo.forEach(e||[],function(e){teasp.constant.STATUS_REJECTS.contains(e.status)&&!e.close?t.push(e):teasp.constant.STATUS_WAIT==e.status?a.push(e):teasp.constant.STATUS_APPROVES.contains(e.status)&&o.push(e)}),t.length?"png-sts006":a.length?"png-sts008":o.length?"png-sts005":"png-add"},
teasp.data.Pouch.prototype.getMonthlyOverTimeApplyIds=function(t){var a=[];return dojo.forEach(this.getMonthlyOverTimeApplys(),function(e){t&&e.steps||a.push(e.id)}),a},teasp.data.Pouch.prototype.setMonthlyApplySteps=function(e){for(var t=this.getMonthlyOverTimeApplys(),a=0;a<t.length;a++){var o=t[a];o.steps=[],dojo.forEach((e||{}).steps||[],function(e){teasp.util.equalId(o.id,e.applyId)&&o.steps.push(e)})}},
teasp.data.Pouch.prototype.getEstimatedOverTime=function(){for(var e=this.getMonthlyOverTimeApplys(),t=e.length-1;0<=t;t--){var a=e[t];if(teasp.constant.STATUS_FIX.contains(a.status))return a.estimatedOverTime}return null},teasp.data.Pouch.prototype.getPendingMonthlyOverTimeApplys=function(){for(var e=[],t=this.getMonthlyOverTimeApplys(),a=0;a<t.length;a++){var o=t[a];(teasp.constant.STATUS_REJECTS.contains(o.status
)&&!o.close||o.status==teasp.constant.STATUS_WAIT)&&e.push(o)}return e},teasp.data.Pouch.prototype.checkMonthlyOverTimeApplys=function(){var e={err:0,errmsg:null};if(!this.isMonthlyOverTimeRequireFlag())return e.err=-2,e;var t=this.getMonthlyOverTimeRequireTime(),a=this.getMonthSubValueByKey("amountTime");if(a<t)return e.err=-1,e;var o=this.getEstimatedOverTime();return"number"!=typeof o?(e.err=1,
e.errmsg=teasp.message.getLabel("mo00000011",teasp.util.time.timeValue(t))):a<=o||(e.err=2,e.errmsg=teasp.message.getLabel("mo00000012",teasp.util.time.timeValue(o))),e},teasp.data.Pouch.prototype.isHideAwayTimeInputField=function(){return(this.dataObj.common.config||{}).hideAwayTimeInputField||!1},teasp.data.Pouch.prototype.isHideMonthlySummaryHelpURL=function(){var e=!0,t=this.getWorkSystem();return(0<=t||t<=3)&&(
e=!1),e=this.dataObj.common.permitMonthlySummaryHelpURL?!0:e},teasp.data.Pouch.prototype.getHelpURL=function(){var e,t=this.getWorkSystem();return 0==t?e=this.isDefaultUseDiscretionary(
)?null==this.dataObj.common.discretionaryWorkMSHelpURL?"https://go.teamspirit.com/ts/help/msdw":this.dataObj.common.discretionaryWorkMSHelpURL:null==this.dataObj.common.fixedWorkMSHelpURL?"https://go.teamspirit.com/ts/help/msfixed":this.dataObj.common.fixedWorkMSHelpURL:1==t?e=null==this.dataObj.common.flextimeMSHelpURL?"https://go.teamspirit.com/ts/help/msflex":this.dataObj.common.flextimeMSHelpURL:2==t?e=null==this.dataObj.common.variableWorkMSHelpURL?"https://go.teamspirit.com/ts/help/msvw":this.dataObj.common.variableWorkMSHelpURL:3==t&&(
e=null==this.dataObj.common.managerMSHelpURL?"https://go.teamspirit.com/ts/help/msmanager":this.dataObj.common.managerMSHelpURL),e},teasp.data.Pouch.prototype.getEmpWork=function(e){return new teasp.data.EmpWork(e,this.getExtraItems(e))},teasp.data.Pouch.prototype.getProgressList=function(){return this.dataObj.common.progressList||[]},teasp.data.Pouch.prototype.getProcessList=function(e){
return e&&e.processList?e.processList.split(/\r?\n/)||[]:this.dataObj.common.processList||[]},teasp.data.Pouch.prototype.getWorkInputType=function(){return this.dataObj.targetEmp.workInputType},teasp.data.Pouch.prototype.setWorkInputType=function(e){this.dataObj.targetEmp.workInputType=e},teasp.data.Pouch.prototype.isWorkInputTimeFix=function(e){
return e?this.dataObj.targetEmp.leftoverJobId||this.dataObj.common.leftoverJobId:1==this.dataObj.targetEmp.workInputType||this.dataObj.targetEmp.leftoverJobId||this.dataObj.common.leftoverJobId},teasp.data.Pouch.prototype.getLeftoverJobId=function(e){return!e&&this.dataObj.targetEmp.leftoverJobId||this.dataObj.common.leftoverJobId},teasp.data.Pouch.prototype.setLeftoverJob=function(e){
this.dataObj.targetEmp.leftoverJobId=e.leftoverJobId,this.dataObj.targetEmp.leftoverJobCode=e.leftoverJobCode,this.dataObj.targetEmp.leftoverJobName=e.leftoverJobName,this.dataObj.targetEmp.leftoverJobStartDate=e.leftoverJobStartDate,this.dataObj.targetEmp.leftoverJobEndDate=e.leftoverJobEndDate,this.dataObj.targetEmp.leftoverJobActive=e.leftoverJobActive,
this.dataObj.targetEmp.leftoverJobAssignClass=e.leftoverJobAssignClass},teasp.data.Pouch.prototype.isPermitChangeLeftoverJob=function(){return this.dataObj.common.permitChangeLeftoverJob},teasp.data.Pouch.prototype.getWorkNoteOption=function(){return this.dataObj.targetEmp.workNoteOption},teasp.data.Pouch.prototype.setWorkNoteOption=function(e){this.dataObj.targetEmp.workNoteOption=e},
teasp.data.Pouch.prototype.getWorkNoteTemplate=function(){return this.dataObj.common.workNoteTemplate},teasp.data.Pouch.prototype.getTaskNoteOption=function(){return this.dataObj.targetEmp.taskNoteOption},teasp.data.Pouch.prototype.setTaskNoteOption=function(e){this.dataObj.targetEmp.taskNoteOption=e},teasp.data.Pouch.prototype.isJobMonthFixed=function(){
return this.dataObj.jobApply&&teasp.constant.STATUS_FIX.contains(this.dataObj.jobApply.status)},teasp.data.Pouch.prototype.isJobMonthFixedByDate=function(e){var t=null;if(this.dataObj.jobApplys)for(var a=0;a<this.dataObj.jobApplys.length;a++){var o=this.dataObj.jobApplys[a];if(o.startDate<=e&&e<=o.endDate){t=o;break}}return(t=t||this.dataObj.jobApply)&&teasp.constant.STATUS_FIX.contains(t.status)},
teasp.data.Pouch.prototype.isJobMonthReadOnly=function(){return this.isJobMonthFixed()||this.isReadOnly()},teasp.data.Pouch.prototype.isJobApplyable=function(){return!this.dataObj.jobApply||!teasp.constant.STATUS_FIX.contains(this.dataObj.jobApply.status)},teasp.data.Pouch.prototype.isUseJobWorkFlow=function(){return this.dataObj.common.jobWorkflow},teasp.data.Pouch.prototype.isDontFixJobMonthly=function(){
return this.dataObj.common.dontFixJobMonthly},teasp.data.Pouch.prototype.getCheckWorkingOkTime=function(){return{minus:-60,plus:0}},teasp.data.Pouch.prototype.getJobYearMonth=function(){return this.dataObj.jobApply.yearMonth};teasp.data.Pouch.prototype.getJobYearMonthJp=function(e){var t=this.getObj().jobApply.yearMonth,a=this.getObj().jobApply.subNo;return teasp.util.date.formatMonth(e?"zv00000021":"zv00000020",
Math.floor(t/100),t%100,a)},teasp.data.Pouch.prototype.getJobStartDate=function(){return this.dataObj.jobApply.startDate},teasp.data.Pouch.prototype.getJobSubNo=function(){return this.dataObj.jobApply.subNo||null},teasp.data.Pouch.prototype.getJobApply=function(){return this.dataObj.jobApply},teasp.data.Pouch.prototype.getJobApplyId=function(){return this.dataObj.jobApply&&this.dataObj.jobApply.id||null},
teasp.data.Pouch.prototype.getJobApplyStatus=function(e){var t=this.dataObj.jobApply&&this.dataObj.jobApply.status||null;return(!e||!teasp.constant.STATUS_CANCELS.contains(t))&&t||teasp.constant.STATUS_NOTADMIT},teasp.data.Pouch.prototype.getJobApplyStatusIconClass=function(){return this.getStatusIconClass(this.getJobApplyStatus(!0),!1)},teasp.data.Pouch.prototype.isEmpJobApprover=function(){
return!!this.dataObj.jobApply&&this.isApprover(this.dataObj.jobApply)},teasp.data.Pouch.prototype.getJobInitialDayOfMonth=function(){return this.dataObj.common.jobInitialDayOfMonth},teasp.data.Pouch.prototype.getJobMarkOfMonth=function(){return this.dataObj.common.jobMarkOfMonth},teasp.data.Pouch.prototype.getJobMonthByDate=function(e){return teasp.util.searchYearMonthDate(this.dataObj.common.jobInitialDayOfMonth,
this.dataObj.common.jobMarkOfMonth,null,e)},teasp.data.Pouch.prototype.getWorks=function(){return this.dataObj.works},teasp.data.Pouch.prototype.getJobWorkNote=function(e,t){return this.dataObj.workNotes[e]?t?this.dataObj.workNotes[e].workNote||"":this.convNoteString(teasp.util.entitize(this.dataObj.workNotes[e].workNote)):""},teasp.data.Pouch.prototype.getJobWorkRealTime=function(e){
return this.dataObj.workNotes[e]&&this.dataObj.workNotes[e].workNetTime||0},teasp.data.Pouch.prototype.getZanteiFlag=function(e){e=this.dataObj.workNotes[e];return!(e&&e.startTime&&e.endTime)},teasp.data.Pouch.prototype.isWorked=function(e){e=this.dataObj.workNotes[e];return e&&teasp.util.time.isValidRange(e.startTime,e.endTime)||!1},teasp.data.Pouch.prototype.isMonthFixByDate=function(e){
return!!this.dataObj.workNotes[e]&&teasp.constant.STATUS_FIX.contains(this.dataObj.workNotes[e].monthApplyStatus)},teasp.data.Pouch.prototype.isDailyFixByDate=function(e){return!!this.isMonthFixByDate(e)||!!this.dataObj.workNotes[e]&&teasp.constant.STATUS_FIX.contains(this.dataObj.workNotes[e].dailyApplyStatus)},teasp.data.Pouch.prototype.getJobWorks=function(e,t){var a=e.assignWorks.concat(e.recordWorks),o={
recordWorks:0,assignWorks:1,scheduleWorks:2};if(!t){a.sort(function(e,t){var a=(e.key?o[e.key]:-1)-(t.key?o[t.key]:-1);return a||e.order-t.order});for(var s=0;s<a.length-1;s++)if(a[s].leftover){a.push(a.splice(s,1)[0]);break}}for(var i={},s=0;s<a.length;s++){var n=a[s],r=[n.jobId+":"+(n.process||"")];n.copied=!!i[r],i[r]=n}return a},teasp.data.Pouch.prototype.getAssignWorks=function(e){return e.assignWorks.sort(
function(e,t){return e.order-t.order})},teasp.data.Pouch.prototype.getMemberJobs=function(e){return e.members.sort(function(e,t){return e.jobCode<t.jobCode?-1:1})},teasp.data.Pouch.prototype.absorbAssignJob=function(e,t,a){var o,s=[];for(o in e)if(e.hasOwnProperty(o))for(var i,n=e[o],r=0;r<n.length;r++)teasp.util.equalId(n[r].jobId,t.jobId)&&n[r].process==t.process&&("assignJobs"==o?(i=dojo.clone(n[r])).order=a:((
i=e[o].splice(r,1)[0]).key="assignJobs",i.order=a,i.process=t.process),s.push(i));return s.length<=0&&s.push({jobAssign:null,jobId:t.jobId,jobCode:t.jobCode,jobName:t.jobName,isAssigned:!0,jobLeader:t.jobLeader||null,work:null,workId:null,time:0,volume:0,percent:0,timeFix:this.isWorkInputTimeFix(),progress:null,taskNote:null,process:t.process,extraItem1:null,extraItem2:null,extraItem1Name:null,extraItem2Name:null,
order:a,seq:teasp.sequence.jobWork++}),s},teasp.data.Pouch.prototype.assignJob=function(e,t,a){for(var o in e)if(e.hasOwnProperty(o))for(var s=e[o],i=0;i<s.length;i++)if(teasp.util.equalId(s[i].jobId,t.jobId))if(s[i].process==t.process)return"assignWorks"==o?void(s[i].order=a):((n=e[o].splice(i,1)[0]).key="assignWorks",n.order=a,n.process=t.process,void e.assignWorks.push(n));var n={jobAssign:null,jobId:t.jobId,
jobCode:t.jobCode,jobName:t.jobName,isAssigned:!0,jobLeader:t.jobLeader||null,work:null,workId:null,time:0,volume:0,percent:0,timeFix:this.isWorkInputTimeFix(),progress:null,taskNote:null,extraItem1:null,extraItem2:null,extraItem1Name:null,extraItem2Name:null,process:t.process,order:a,seq:teasp.sequence.jobWork++};e.assignWorks.push(n)},teasp.data.Pouch.prototype.releaseJob=function(e,t){for(var a in e)if(
e.hasOwnProperty(a))for(var o=e[a],s=0;s<o.length;s++)if(teasp.util.equalId(o[s].jobId,t.jobId)){if("assignJobs"!=a)return;var i=e[a].splice(s,1)[0];return void(t.assignLimit&&(i.key="members",e.members.push(i)))}},teasp.data.Pouch.prototype.entryScheduledJob=function(e,t,a,o){for(var s=0,i=null,n=(e.recordWorks||[]).concat(e.assignWorks||[]),r=0;r<n.length;r++){if((l=n[r]).jobCode==t.code){if(!l.process)return n[r];
i=i||l}s<l.order&&(s=l.order)}if(i)return i;if(!t.minutes&&!t.inner)return null;for(n=(e.assignJobs||[]).concat(e.members||[]),r=0;r<n.length;r++)if(n[r].jobCode==t.code)return(l=n[r]).startDate&&o<l.startDate||l.endDate&&l.endDate<o?l.ngFact=teasp.data.Pouch.NG_JOB_OUT_OF_TERM:(l.seq=teasp.sequence.jobWork++,l.key="scheduleWorks",e.recordWorks&&e.recordWorks.length||(e.recordWorks=[]),
e.assignTmps&&e.assignTmps.length||(e.assignTmps=[]),e.recordWorks.push(l),e.assignTmps.push(l)),l;for(var l,p=0,i=null,r=0;r<a.length;r++){var d=a[r];if(d.jobCode==t.code){(i=d).assignLimit&&!d.assignSelf?p=teasp.data.Pouch.NG_JOB_ASSIGN_EMP:d.jobAssignClass&&d.jobAssignClass.indexOf(":"+(this.dataObj.targetEmp.jobAssignClass||"")+":")<0?p=teasp.data.Pouch.NG_JOB_ASSIGN_CLASS:(
d.startDate&&o<d.startDate||d.endDate&&d.endDate<o)&&(p=teasp.data.Pouch.NG_JOB_OUT_OF_TERM);break}}return i?(l={jobAssign:null,jobId:i.jobId,jobCode:i.jobCode,jobName:i.jobName,isAssigned:!1,work:null,workId:null,time:0,volume:0,percent:0,timeFix:this.isWorkInputTimeFix(),progress:null,taskNote:null,extraItem1:null,extraItem2:null,extraItem1Name:null,extraItem2Name:null,process:null,seq:teasp.sequence.jobWork++,
ngFact:p,key:"scheduleWorks",processList:i.processList},p||(l.order=s+1,e.recordWorks&&e.recordWorks.length||(e.recordWorks=[]),e.assignTmps&&e.assignTmps.length||(e.assignTmps=[]),e.recordWorks.push(l),e.assignTmps.push(l)),l):null},teasp.data.Pouch.prototype.replaceWorks=function(e,t){delete this.dataObj.classifyJobWorks;for(var a=this.dataObj.works,o=a.length-1;0<=o;o--)a[o].date==e&&a.splice(o,1);a=a.concat(t),
this.dataObj.works=a.sort(function(e,t){var a=teasp.util.date.compareDate(e.date,t.date);return 0==a?e.order-t.order:a})},teasp.data.Pouch.prototype.isExistWorksByDate=function(e){for(var t=this.dataObj.works||[],a=0;a<t.length;a++)if(t[a].date==e)return!0;return!1},teasp.data.Pouch.prototype.replaceWorkNote=function(e,t){this.dataObj.days&&this.getEmpDay(e).setWorkNote(t),this.dataObj.workNotes&&(
this.dataObj.workNotes[e]||(this.dataObj.workNotes[e]={workRealTime:0}),this.dataObj.workNotes[e].workNote=t)},teasp.data.Pouch.prototype.getAssignableJob=function(e,t){if(!e.active)return-2;if(e.jobAssignClass){for(var a=e.jobAssignClass.split(/:/),o=a.length-1;0<=o;o--)a[o]||a.splice(o,1);if(!a.contains(this.getJobAssignClass()))return-1}return(!e.startDate||teasp.util.date.compareDate(e.startDate,t)<=0)&&(
!e.endDate||teasp.util.date.compareDate(t,e.endDate)<=0)?1:0},teasp.data.Pouch.prototype.getClassifyJobWorks=function(e,t){if(this.dataObj.classifyJobWorks&&e&&this.dataObj.classifyJobWorks[e])return this.dataObj.classifyJobWorks[e];var a=this.dataObj.works||[],o=this.dataObj.jobAssigns||[],s=this.dataObj.targetEmp.leftoverJobId?this.dataObj.targetEmp:this.dataObj.common;if(
s.leftoverJobId&&s.leftoverJobActive&&!this.isJobMonthFixed()){for(var i=-1,n=0;n<o.length;n++)if(teasp.util.equalId(o[n].jobId,s.leftoverJobId)&&!o[n].process){i=n;break}i<0?o.push({id:null,jobId:s.leftoverJobId,job:{code:s.leftoverJobCode,name:s.leftoverJobName,deptId:null,startDate:s.leftoverJobStartDate,endDate:s.leftoverJobEndDate,assignLimit:!1,accountId:null,jobLeaderId:null,jobLeader:"",explain:"",active:!0,
jobAssignClass:s.leftoverJobAssignClass},isAssigned:!0,order:Number.MAX_VALUE,process:null,leftover:!0}):(o[i].order=Number.MAX_VALUE,o[i].leftover=!0,o[i].isAssigned=!0),o=o.sort(function(e,t){return e.order-t.order})}for(var r={},l=[],n=0;n<a.length;n++){var p=a[n];if(!e||p.date==e){l.push(p),p.assign=!1;for(var d=null,c=0;c<o.length;c++){var m=o[c];if(teasp.util.equalId(m.jobId,p.jobId)&&m.process==p.process){d=m;
break}t&&!d&&teasp.util.equalId(m.jobId,p.jobId)&&(d=m)}d&&((f=(f=r[d.id])||(r[d.id]=[])).push(p),p.process=d.process,p.assign=!0,d.leftover&&(p.timeFix=!1,p.volume&&(p.volume=100)))}}for(var h=[],u=[],g=[],y=[],c=0;c<o.length;c++){var f=r[(m=o[c]).id]||[],b=this.getAssignableJob(m.job,e),_=e&&0<b;if(m.isAssigned&&0<=b&&y.push({jobAssign:m,jobId:m.jobId,jobCode:m.job.code,jobName:m.job.name,deptId:m.job.deptId,
deptCode:m.job.deptCode,deptName:m.job.deptName,isAssigned:!0,jobLeader:m.job.jobLeader||null,work:null,workId:null,time:null,volume:m.leftover?100:null,percent:0,timeFix:!m.leftover&&this.isWorkInputTimeFix(),progress:null,taskNote:null,process:m.process,extraItem1:null,extraItem2:null,extraItem1Name:null,extraItem2Name:null,startDate:m.job.startDate,endDate:m.job.endDate,order:m.order,key:"assignJobs",
leftover:m.leftover||!1}),m.isAssigned&&0<=b&&(_||0<f.length))if(f.length<=0)h.push({jobAssign:m,jobId:m.jobId,jobCode:m.job.code,jobName:m.job.name,deptId:m.job.deptId,deptCode:m.job.deptCode,deptName:m.job.deptName,isAssigned:!0,jobLeader:m.job.jobLeader||null,work:null,workId:null,time:null,volume:m.leftover?100:null,percent:0,timeFix:!m.leftover&&this.isWorkInputTimeFix(),progress:null,taskNote:null,
process:m.process,extraItem1:null,extraItem2:null,extraItem1Name:null,extraItem2Name:null,startDate:m.job.startDate,endDate:m.job.endDate,order:m.order,seq:teasp.sequence.jobWork++,key:"assignWorks",leftover:m.leftover||!1});else for(var v=0;v<f.length;v++){p=f[v];!_&&p.time<=0&&p.volume<=0&&!p.progress&&!p.taskNote&&!p.extraItem1&&!p.extraItem2||h.push({jobAssign:m,jobId:m.jobId,jobCode:m.job.code,
jobName:m.job.name,deptId:m.job.deptId,deptCode:m.job.deptCode,deptName:m.job.deptName,isAssigned:!0,jobLeader:m.job.jobLeader||null,work:p,workId:p.id,time:p.time,volume:p.volume,percent:p.percent,timeFix:p.timeFix,progress:p.progress,taskNote:p.taskNote,process:p.process,extraItem1:p.extraItem1,extraItem2:p.extraItem2,extraItem1Name:p.extraItem1Name,extraItem2Name:p.extraItem2Name,startDate:m.job.startDate,
endDate:m.job.endDate,order:m.order,seq:teasp.sequence.jobWork++,key:"assignWorks",leftover:m.leftover||!1})}else if(0<f.length)for(v=0;v<f.length;v++)(p=f[v]).assign=!1;else e&&0<this.getAssignableJob(m.job,e)&&u.push({jobAssign:m,jobId:m.jobId,jobCode:m.job.code,jobName:m.job.name,deptId:m.job.deptId,deptCode:m.job.deptCode,deptName:m.job.deptName,isAssigned:!1,work:null,workId:null,jobLeader:m.job.jobLeader||null,
time:null,volume:null,percent:0,timeFix:this.isWorkInputTimeFix(),progress:null,taskNote:null,process:null,extraItem1:null,extraItem2:null,extraItem1Name:null,extraItem2Name:null,startDate:m.job.startDate,endDate:m.job.endDate,order:m.order,seq:teasp.sequence.jobWork++,key:"members",leftover:m.leftover||!1})}if(0<u.length){for(u=u.sort(function(e,t){return e.jobId<t.jobId?-1:1}),n=0;n<u.length;n++)for(
c=0;c<h.length;c++)if(h[c].jobId==u[n].jobId){u.splice(n,1),n--;break}for(n=0;n<u.length-1;n++)u[n].jobId==u[n+1].jobId&&(u.splice(n,1),n--)}var T=0,j=0;for(n=0;n<l.length;n++)T+=(p=l[n]).time,j+=p.volume,p.assign||g.push({jobAssign:null,jobId:p.jobId,jobCode:p.job.code,jobName:p.job.name,deptId:p.job.deptId,deptCode:p.job.deptCode,deptName:p.job.deptName,isAssigned:!1,jobLeader:p.job.jobLeader||null,work:p,
workId:p.id,time:p.time,volume:p.volume,percent:p.percent,timeFix:p.timeFix,progress:p.progress,taskNote:p.taskNote,process:p.process,extraItem1:p.extraItem1,extraItem2:p.extraItem2,extraItem1Name:p.extraItem1Name,extraItem2Name:p.extraItem2Name,startDate:p.job.startDate,endDate:p.job.endDate,order:p.order,seq:teasp.sequence.jobWork++,key:"recordWorks"});this.dataObj.classifyJobWorks||(
this.dataObj.classifyJobWorks={});var E={assignJobs:y,assignWorks:h,members:u,recordWorks:g,sumTime:T,sumVolume:j};return e?(this.dataObj.classifyJobWorks[e]=E,this.dataObj.classifyJobWorks[e]):E},teasp.data.Pouch.prototype.setClassifyJobWorks=function(e,t){this.dataObj.classifyJobWorks||(this.dataObj.classifyJobWorks={}),this.dataObj.classifyJobWorks[e]=t},teasp.data.Pouch.prototype.clearClassifyJobWorks=function(){
delete this.dataObj.classifyJobWorks;for(var e=(this.dataObj.jobAssigns||[]).length-1;0<=e;e--)this.dataObj.jobAssigns[e].leftover&&this.dataObj.jobAssigns.splice(e,1)},teasp.data.Pouch.prototype.getJobByCode=function(e){for(var t=0;t<this.dataObj.jobAssigns.length;t++){var a=this.dataObj.jobAssigns[t];if(a.job.code==e)return{jobId:a.jobId,jobCode:a.job.code,jobName:a.job.name,startDate:a.job.startDate,
endDate:a.job.endDate}}for(t=0;t<this.dataObj.works.length;t++){var o=this.dataObj.works[t];if(o.job.code==e)return{jobId:o.jobId,jobCode:o.job.code,jobName:o.job.name,startDate:o.job.startDate,endDate:o.job.endDate}}return null},teasp.data.Pouch.prototype.getJobById=function(e,t){for(var a=0;a<this.dataObj.jobAssigns.length;a++){var o=this.dataObj.jobAssigns[a];if(o.jobId==e)return{jobId:o.jobId,jobCode:o.job.code,
jobName:o.job.name,startDate:o.job.startDate,endDate:o.job.endDate}}if(!t)for(a=0;a<this.dataObj.works.length;a++){var s=this.dataObj.works[a];if(s.jobId==e)return{jobId:s.jobId,jobCode:s.job.code,jobName:s.job.name,startDate:s.job.startDate,endDate:s.job.endDate}}return null},teasp.data.Pouch.prototype.adjustJobWorkTimes=function(e,t,a){for(var o=-1,s=0,i=[],n=0,r=0;r<e.length;r++)e[r].timeFix&&(n+=e[r].time);for(
var l=Math.max(t-n,0),r=0;r<e.length;r++)(p=e[r]).timeFix||(a||(0<p.percent&&0<l?p.time=Math.round(l*p.percent/1e3):p.time=null),null!==p.time&&(i.push(r),p.percent>s&&(s=p.percent,o=r)));if(0<=o){for(r=0;r<i.length;r++){var p,d=i[r];d!=o&&((p=e[d]).time>l&&(p.time=l),l-=p.time)}(p=e[o]).time=l}},teasp.data.Pouch.prototype.getExtraItems=function(e){var t=this.dataObj.common||{},a=null,o=null;return(
e&&e.extraItem1||t.useJobExtraItem1)&&(a={name:e&&e.extraItem1Name||t.jobExtraItem1Name,length:t.jobExtraItem1Length,width:t.jobExtraItem1Width,value:e?e.extraItem1:""}),(e&&e.extraItem2||t.useJobExtraItem2)&&(o={name:e&&e.extraItem2Name||t.jobExtraItem2Name,length:t.jobExtraItem2Length,width:t.jobExtraItem2Width,value:e?e.extraItem2:""}),a||o?[a,o]:[]},teasp.data.Pouch.prototype.isPermitDuplicateJobProcess=function(
){return this.dataObj.common.permitDuplicateJobProcess},teasp.data.Pouch.prototype.isDeployJobSearchBox=function(){return this.dataObj.common.config.deployJobSearchBox||!1},teasp.data.Pouch.prototype.getExpLog=function(e){return new teasp.data.EmpExp(e)},teasp.data.Pouch.prototype.getCurrencyTable=function(){return this.dataObj.foreignCurrency},teasp.data.Pouch.prototype.isUseEkitan=function(){
return this.dataObj.common.useEkitan},teasp.data.Pouch.prototype.getTicketPeriod=function(){return this.dataObj.common.ticketPeriod},teasp.data.Pouch.prototype.getEkitanArea=function(){return"number"!=typeof this.dataObj.common.ekitanArea?-1:this.dataObj.common.ekitanArea},teasp.data.Pouch.prototype.isCommuterRouteLock=function(){return this.dataObj.targetEmp.commuterRouteLock||!1},
teasp.data.Pouch.prototype.getCommuterRouteNote=function(){for(var e=this.dataObj.commuterPasses||[],t=null,a=0;a<e.length;a++){var o=e[a];if(teasp.constant.STATUS_APPROVES.contains(o.status)){t=o.routeDescription||teasp.message.getLabel(o.startDate?"tf10000340":"tm10003580");break}}return t||this.dataObj.targetEmp.commuterRouteNote||teasp.message.getLabel("tm10003580")},
teasp.data.Pouch.prototype.setCommuterRouteNote=function(e){this.dataObj.targetEmp.commuterRouteNote=e},teasp.data.Pouch.prototype.getExpConfig=function(){return"string"==typeof this.dataObj.targetEmp.expConfig&&(this.dataObj.targetEmp.expConfig=dojo.fromJson(this.dataObj.targetEmp.expConfig)),this.dataObj.targetEmp.expConfig},teasp.data.Pouch.prototype.setExpConfig=function(e){this.dataObj.targetEmp.expConfig=e},
teasp.data.Pouch.prototype.getExpStatusIconClass=function(e){return e?e==teasp.constant.STATUS_PAYD?"pb_status_pay":teasp.constant.STATUS_CANCELS.contains(e)?"pb_status_cancel":this.getStatusIconClass(e,!1):"pb_status_noapp_dis"},teasp.data.Pouch.prototype.getExpApplyStatusIconClass=function(){return this.getExpStatusIconClass(this.dataObj.expApply?this.dataObj.expApply.status:null)},
teasp.data.Pouch.prototype.getExpLogRouteById=function(e){for(var t=0;t<this.dataObj.expLogs.length;t++)if(teasp.util.equalId(this.dataObj.expLogs[t].id,e))return this.dataObj.expLogs[t].route||null;return null},teasp.data.Pouch.prototype.isUseExpWorkFlow=function(){return this.dataObj.common.expWorkflow},teasp.data.Pouch.prototype.isExpApplyable=function(){return(
!this.dataObj.expApply||!teasp.constant.STATUS_FIX.contains(this.dataObj.expApply.status))&&0<this.getExpLogs().length},teasp.data.Pouch.prototype.isExpApplyFixed=function(e){return!!this.dataObj.expApply&&(teasp.constant.STATUS_FIX.contains(this.dataObj.expApply.status)||e&&teasp.constant.STATUS_REJECTS.contains(this.dataObj.expApply.status))},teasp.data.Pouch.prototype.getExpApply=function(){
return this.dataObj.expApply||null},teasp.data.Pouch.prototype.getExpApplyId=function(){return this.dataObj.expApply&&this.dataObj.expApply.id||null},teasp.data.Pouch.prototype.isEmpExpApprover=function(){if(this.isCancelApplyWait())return this.dataObj.approver&&this.dataObj.approver[this.dataObj.expApply.expCancelApplyId];var e=!1;
return this.dataObj.expApply&&this.dataObj.expApply.statusC==teasp.constant.STATUS_WAIT&&(e=!!this.dataObj.expApply&&this.isApprover(this.dataObj.expApply),e=!!this.dataObj.isJobLeader||e),e},teasp.data.Pouch.prototype.getExpApplyStatus=function(e){return e?this.dataObj.expApply&&this.dataObj.expApply.statusD||null:this.dataObj.expApply&&this.dataObj.expApply.statusC||null},
teasp.data.Pouch.prototype.isCancelApplyWait=function(){return this.dataObj.expApply&&this.dataObj.expApply.expCancelApplyStatus==teasp.constant.STATUS_WAIT},teasp.data.Pouch.prototype.isCancelApproved=function(){return this.dataObj.expApply&&teasp.constant.STATUS_APPROVES.contains(this.dataObj.expApply.expCancelApplyStatus)},teasp.data.Pouch.prototype.getCancelApproverName=function(){return this.isCancelApproved(
)&&this.dataObj.expApply.expCancelApproverName||""},teasp.data.Pouch.prototype.getCancelApproveTime=function(){return this.isCancelApproved()&&this.dataObj.expApply.expCancelApproveTime||""},teasp.data.Pouch.prototype.getExpApplySeqNo=function(){return this.dataObj.expApply&&this.dataObj.expApply.expApplyNo||null},teasp.data.Pouch.prototype.getExpApplyComment=function(){
return this.dataObj.expApply&&this.dataObj.expApply.comment||""},teasp.data.Pouch.prototype.getExpApplyTime=function(){return this.dataObj.expApply&&this.dataObj.expApply.applyTime?teasp.util.date.formatDateTime(this.dataObj.expApply.applyTime,"SLA-HM"):""},teasp.data.Pouch.prototype.getExpApproveTime=function(){var e=this.dataObj.expApplySteps||[];return 0<e.length?teasp.util.date.formatDateTime(
e[e.length-1].createdDate,"SLA-HM"):this.dataObj.expApply&&this.dataObj.expApply.approveTime?teasp.util.date.formatDateTime(this.dataObj.expApply.approveTime,"SLA-HM"):""},teasp.data.Pouch.prototype.getExpPayDate=function(){return this.dataObj.expApply&&this.dataObj.expApply.payDate?teasp.util.date.formatDate(this.dataObj.expApply.payDate,"SLA"):""},teasp.data.Pouch.prototype.getExpApproverName=function(){
var e=this.dataObj.expApplySteps||[];return 0<e.length?e[e.length-1].actorName:this.dataObj.expApply&&this.dataObj.expApply.approverName||""},teasp.data.Pouch.prototype.getExpLogs=function(){return this.dataObj.expLogs||[]},teasp.data.Pouch.prototype.getExpItems=function(){return this.dataObj.expItems||[]},teasp.data.Pouch.prototype.getStationHist=function(){return this.dataObj.stationHist||[]},
teasp.data.Pouch.prototype.setStationHist=function(e){this.dataObj.stationHist=e},teasp.data.Pouch.prototype.getRouteHist=function(){return this.dataObj.routeHist||[]},teasp.data.Pouch.prototype.setRouteHist=function(e){this.dataObj.routeHist=e},teasp.data.Pouch.prototype.getExpApplyHistory=function(){return this.dataObj.expApplyHistory||[]},teasp.data.Pouch.prototype.replaceExpLogs=function(e,t,a){for(
var o=this.dataObj.expLogs||[],s=o.length-1;0<=s;s--)(i=o[s]).date==e&&teasp.util.equalId(i.expApplyId,t)&&o.splice(s,1);o=o.concat(a),this.dataObj.expLogs=o.sort(function(e,t){var a=teasp.util.date.compareDate(e.date,t.date);return 0==a?e.order-t.order:a});for(var i,n=0,r=null,s=0;s<this.dataObj.expLogs.length;s++)(i=this.dataObj.expLogs[s]).date!=r&&(r=i.date,n=1),i.no=n++},
teasp.data.Pouch.prototype.isChangeableByManager=function(e){var t=!1,e=e||this.dataObj.expApply;return t=this.dataObj.common.allowEditManager&&teasp.util.equalId(this.dataObj.sessionInfo.user.id,this.dataObj.targetEmp.managerId)&&(e.status==teasp.constant.STATUS_APPROVING||e.status==teasp.constant.STATUS_WAIT)?!0:t},teasp.data.Pouch.prototype.isChangeableByExpAdmin=function(e){var t=!1,e=e||this.dataObj.expApply;
return this.isExpAdmin()&&e&&(this.dataObj.common.allowEditExpAdmin?this.dataObj.expApply.status!=teasp.constant.STATUS_APPROVING&&this.dataObj.expApply.status!=teasp.constant.STATUS_APPROVE&&this.dataObj.expApply.status!=teasp.constant.STATUS_WAIT||(t=!0):!this.dataObj.common.allowEditManager||this.dataObj.expApply.status!=teasp.constant.STATUS_APPROVING&&this.dataObj.expApply.status!=teasp.constant.STATUS_WAIT||(
t=!0)),t},teasp.data.Pouch.prototype.getExpLogsJobs=function(e,t){for(var a=[],o=this.dataObj.expLogs||[],s={},i=0;i<t.length;i++)t[i].jobId&&(s[t[i].jobId]=1);for(i=0;i<o.length;i++){var n=o[i];e&&n.date!=e||!n.job||s[n.jobId]||(a.push({jobId:n.jobId,jobCode:n.job.code,jobName:n.job.name}),s[n.jobId]=1)}return a},teasp.data.Pouch.prototype.getRingiObj=function(){return this.dataObj.expApply&&(
this.dataObj.expApply.ringi||{})},teasp.data.Pouch.prototype.getExpApplyDeptName=function(e){return(this.dataObj.expApply?this.dataObj.expApply.deptName:e?this.getDeptName():null)||""},teasp.data.Pouch.prototype.getAttachments=function(){return this.dataObj.expApply&&this.dataObj.expApply.attachments||[]},teasp.data.Pouch.prototype.getExpenseType=function(){
return this.dataObj.expApply&&this.dataObj.expApply.expenseType||null},teasp.data.Pouch.prototype.getPayExpItemName=function(){return this.dataObj.expApply&&this.dataObj.expApply.payExpItemName||null},teasp.data.Pouch.prototype.getApplyDate=function(){return this.dataObj.expApply&&this.dataObj.expApply.applyDate||null},teasp.data.Pouch.prototype.getPayDate=function(){
return this.dataObj.expApply&&this.dataObj.expApply.payDate||null},teasp.data.Pouch.prototype.getProvisionalPaymentTitle=function(){return this.dataObj.expApply&&this.dataObj.expApply.provisionalPaymentTitle||null},teasp.data.Pouch.prototype.getExpPreApplyPpAmount=function(){return this.dataObj.expApply&&this.dataObj.expApply.expPreApplyPpAmount||0},teasp.data.Pouch.prototype.getChargeJobName=function(){
var e=this.dataObj.expApply&&this.dataObj.expApply.chargeJobCode||null,t=this.dataObj.expApply&&this.dataObj.expApply.chargeJobName||null;return e||t?(e||"")+" "+(t||""):null},teasp.data.Pouch.prototype.getChargeDeptName=function(){var e=this.dataObj.expApply&&this.dataObj.expApply.chargeDeptCode||null,t=this.dataObj.expApply&&this.dataObj.expApply.chargeDeptName||null;return e||t?(e||"")+" "+(t||""):null},
teasp.data.Pouch.prototype.getExtraItem1=function(){return this.dataObj.expApply&&this.dataObj.expApply.extraItem1||null},teasp.data.Pouch.prototype.getExtraItem2=function(){return this.dataObj.expApply&&this.dataObj.expApply.extraItem2||null},teasp.provide("teasp.hrm.HrmNaviGroup"),teasp.hrm.HrmNaviGroup=function(e,t){this.manager=e,this.obj=t,this.events=[],
this.languageKey="ja"===teasp.message.getLanguageLocaleKey()||"ja_JP"===teasp.message.getLanguageLocaleKey()?"ja_JP":"en_US",t.eventList&&t.eventList.length&&this.setEvents(t.eventList)},teasp.hrm.HrmNaviGroup.prototype.getId=function(){return this.obj.id||null},teasp.hrm.HrmNaviGroup.prototype.getName=function(){return this.obj.name&&this.obj.name[this.languageKey]?this.obj.name[this.languageKey]:null!==this.getId(
)?this.obj.name.ja_JP:teasp.message.getLabel("hr10012020")},teasp.hrm.HrmNaviGroup.prototype.getEvents=function(){return this.events},teasp.hrm.HrmNaviGroup.prototype.setEvents=function(e){e.forEach(function(e){this.events.push(new teasp.hrm.HrmNavi(this,e))},this)},teasp.hrm.HrmNaviGroup.prototype.getEventById=function(e){for(var t=0;t<this.events.length;t++){var a=this.events[t];if(a.getId()==e)return a}return null
},teasp.provide("teasp.hrm.HrmNavi"),teasp.hrm.HrmNavi=function(e,t){this.group=e,this.obj=t,this.startQuestion=this.createQuestionById(t.startQuestionId),this.answerList=[],this.languageKey="ja"===teasp.message.getLanguageLocaleKey()||"ja_JP"===teasp.message.getLanguageLocaleKey()?"ja_JP":"en_US"},teasp.hrm.HrmNavi.prototype.getId=function(){return this.obj.id},teasp.hrm.HrmNavi.prototype.getName=function(){
return this.obj.name&&this.obj.name[this.languageKey]||this.obj.name.ja_JP},teasp.hrm.HrmNavi.prototype.getStartQuestionId=function(){return this.obj.startQuestionId||null},teasp.hrm.HrmNavi.prototype.getStartQuestion=function(){return this.startQuestion||null},teasp.hrm.HrmNavi.prototype.getNextQuestion=function(e){return e?(this.answerList.push(e),e.getNextQuestion()):(this.answerList=[],this.getStartQuestion())},
teasp.hrm.HrmNavi.prototype.getPrevQuestion=function(){var e;return this.answerList.length?((e=this.answerList.pop()).setSelect(null),e):null},teasp.hrm.HrmNavi.prototype.getAnsweredQuestion=function(e){if(this.answerList.length>=e){for(var t,a=this.answerList.length-e+1,o=0;o<a;o++)(t=this.answerList.pop()).setSelect(null);return t}return null},teasp.hrm.HrmNavi.prototype.createQuestionById=function(e){
e=e?this.obj.questions[e]:null;return e?new teasp.hrm.HrmQuestion(this,e):null},teasp.hrm.HrmNavi.prototype.getAnswerList=function(){return this.answerList},teasp.provide("teasp.hrm.HrmQuestion"),teasp.hrm.HrmQuestion=function(e,t){this.navi=e,this.obj=t,this.selects=[],this.selected=null;for(var a=t.selects||[],o=0;o<a.length;o++)this.selects.push(new teasp.hrm.HrmQuestionSelect(this.navi,a[o]));
this.languageKey="ja"===teasp.message.getLanguageLocaleKey()||"ja_JP"===teasp.message.getLanguageLocaleKey()?"ja_JP":"en_US"},teasp.hrm.HrmQuestion.prototype.getId=function(){return this.obj.id},teasp.hrm.HrmQuestion.prototype.getName=function(){return this.obj.name&&this.obj.name[this.languageKey]||this.obj.name.ja_JP},teasp.hrm.HrmQuestion.prototype.getRemarks=function(){
return this.obj.remarks&&this.obj.remarks[this.languageKey]||this.obj.remarks.ja_JP||""},teasp.hrm.HrmQuestion.prototype.getSelects=function(){return this.selects},teasp.hrm.HrmQuestion.prototype.setSelect=function(e){this.selected=null;for(var t=0;t<this.selects.length;t++){var a=this.selects[t];a.getId()==e&&(this.selected=a)}},teasp.hrm.HrmQuestion.prototype.getNextQuestion=function(){
return this.selected?this.selected.getNextQuestion():null},teasp.hrm.HrmQuestion.prototype.getAnswer=function(){return this.selected?this.selected.getName():null},teasp.provide("teasp.hrm.HrmQuestionSelect"),teasp.hrm.HrmQuestionSelect=function(e,t){this.navi=e,this.obj=t,this.nextQuestionId=t.nextQuestionId,this.languageKey="ja"===teasp.message.getLanguageLocaleKey()||"ja_JP"===teasp.message.getLanguageLocaleKey(
)?"ja_JP":"en_US"},teasp.hrm.HrmQuestionSelect.prototype.getId=function(){return this.obj.id},teasp.hrm.HrmQuestionSelect.prototype.getName=function(){return this.obj.name&&this.obj.name[this.languageKey]||this.obj.name.ja_JP},teasp.hrm.HrmQuestionSelect.prototype.getNextQuestionId=function(){return this.nextQuestionId||null},teasp.hrm.HrmQuestionSelect.prototype.getNextQuestion=function(){
return this.nextQuestionId?this.navi.createQuestionById(this.nextQuestionId):null},teasp.provide("teasp.hrm.HrmNaviManager"),teasp.hrm.HrmNaviManager=function(e){var t=e;this.groups=[];for(var a=0;a<t.length;a++){var o=t[a];this.groups.push(new teasp.hrm.HrmNaviGroup(this,o))}},teasp.hrm.HrmNaviManager.prototype.getGroups=function(){return this.groups},teasp.hrm.HrmNaviManager.prototype.getGroupById=function(e){for(
var t=0;t<this.groups.length;t++){var a=this.groups[t];if(a.getId()===e)return a}return null},teasp.hrm.HrmNaviManager.prototype.isSingleGroup=function(){return 1===this.groups.length},teasp.action.contact.loadEmpMonth=function(o,s,i,n,r){var l={params:o};teasp.action.contact.remoteMethod("loadEmpMonth",[o.empId||"",o.month||"",o.mode||"",o.date||"",o.subNo||""],function(e){var t,a;"OK"==e.result?(s.setKeyObj(
"params",l.params),t=a=null,1==e.targetEmp.length?(t=e.targetEmp[0],a=e.targetEmp[0]):1<e.targetEmp.length&&(t=e.targetEmp[teasp.util.equalId(e.targetEmp[0].Id,l.params.empId)?0:1],a=e.targetEmp[teasp.util.equalId(e.targetEmp[0].Id,l.params.empId)?1:0]),s.setKeyObj("sessionInfo",teasp.logic.convert.convSessionInfoObj(a,t,e.rights)),s.setKeyObj("targetEmp",teasp.logic.convert.convTargetEmpObj(t,l.params.mode)),
s.setKeyObj("empTypeInfo",teasp.logic.convert.convEmpTypeInfo(e.empTypeInfo,e.yearMonth,e.startDate)),s.setKeyObj("common",teasp.logic.convert.convCommonObj(e.common,e.borderRevNo)),s.getEmpId()?(s.setKeyObj("empMonthList",e.empMonthList),s.setParams(dojo.mixin({},teasp.action.contact.createParamByEmpMonth(s,e.yearMonth,e.startDate))),s.setKeyObj("deptHist",teasp.logic.convert.convDeptHist(e.deptHist)),s.setKeyObj(
"months",teasp.logic.convert.convEmpMonthObjs(e.empMonths,e.deptMonths,s.getEmpMonthCustomKeys())),s.setKeyObj("configs",teasp.logic.convert.convConfigObjs(e.configs)),s.setKeyObj("applys",teasp.logic.convert.convEmpApplyObjs(e.empApplys)),s.setParams(dojo.mixin({},teasp.action.contact.createParamByEmpApplys(s,s.getKeyObj("applys")))),s.setKeyObj("cals",teasp.logic.convert.convCalendarObjs(e.calendar)),s.setKeyObj(
"empTypePatterns",teasp.logic.convert.convEmpTypePatternObjs(e.empTypePattern)),s.setKeyObj("patterns",teasp.logic.convert.convPatternObjs(e.empTypePattern)),s.setKeyObj("days",teasp.logic.convert.convEmpDayObjs(e.empDays)),s.setKeyObj("infos",teasp.logic.convert.convInfoObjs(e.infos)),s.setKeyObj("sumTime",teasp.logic.convert.convSumTimeObjs(e)),s.setKeyObj("rejects",teasp.logic.convert.convRejectApplyList(e)),
s.setKeyObj("cancels",teasp.logic.convert.convCancelApplyList(e)),s.setKeyObj("approver",teasp.logic.convert.convApprover(e.approver)),s.setKeyObj("stocks",teasp.logic.convert.convStockObjs(e.stocks)),s.setKeyObj("jobAssigns",teasp.logic.convert.convJobAssignObjs(e.jobAssign||[])),s.setKeyObj("works",teasp.logic.convert.convWorkObjs(e.empWorks||[])),s.setKeyObj("jobApplys",teasp.logic.convert.convJobApplysObj(
e.jobApplys||[])),s.setKeyObj("workLocations",e.workLocations||[]),(a=new teasp.logic.EmpTime(s)).mergeCalendar(),a.buildConfig(),a.buildEmpMonth(),n.apply(i,[!!l.params.noDelay]),l.params.noDelay||teasp.action.contact.loadEmpMonthDelay(o,s,i,n,r)):n.apply(i,[!0])):r.apply(i,[e.error])},function(e){r.apply(i,[e])})},teasp.action.contact.loadEmpMonthDelay=function(e,a,o,s,i){var t=teasp.util.date.addYearMonth(
a.getYearMonth(),-13),n=teasp.util.date.addYearMonth(a.getYearMonth(),13),t=a.getEmpMonth(t,null,0,!0),n=a.getEmpMonth(n,null),r={params:{empId:a.getEmpId(),empTypeId:a.getEmpTypeId(),startDate:t.startDate,endDate:n.endDate,baseStartDate:a.getEmpMonthStartDate(),baseEndDate:a.getEmpMonthLastDate(),endLdate:n.endDate}},t=[r.params.empId,r.params.empTypeId,r.params.startDate,r.params.endDate,r.params.baseStartDate,
r.params.baseEndDate,r.params.endLdate];e&&e.date&&t.push(e.date),teasp.action.contact.remoteMethod("loadEmpMonthDelay",t,function(e){var t;"OK"==e.result?(a.setKeyObj("holidays",teasp.logic.convert.convEmpTypeHolidayObjs(e.empTypeHoliday)),a.setKeyObj("yuqRemains",teasp.logic.convert.convYuqRemainObjs(e.yuqRemains)),a.setKeyObj("plannedHolidays",e.plannedHolidays),a.setNextMonth(teasp.logic.convert.convCalendarObjs(
e.calendar),teasp.logic.convert.convSimpleEmpDayObjs(e.simpleDays),teasp.action.createApplyMap(teasp.logic.convert.convEmpApplyObjs(e.empApplys)),r.params.startDate,r.params.endDate,teasp.logic.convert.convConfigMinObjs(e.configMins)),a.setKeyObj("approverSet",teasp.logic.convert.convApproverSetObjs(e.approverSet)),a.setKeyObj("depts",teasp.logic.convert.convDeptList(e.depts)),a.setKeyObj("configHistory",
teasp.logic.convert.convConfigHistory(e.configHistory)),t=teasp.logic.convert.convMixApplySteps(e,!0),s.apply(o,[!0,t])):i.apply(o,[e.error])},function(e){i.apply(o,[e])})},teasp.action.createApplyMap=function(e){for(var t=e||[],a={},o=0;o<t.length;o++){var s=t[o],i=s.holiday&&s.holiday.displayDaysOnCalendar?[]:s.excludeDate,n=s.startDate,r=s.endDate||s.startDate;if(n&&"string"==typeof n){
var l=teasp.util.date.getDateList(n,r);s.exchangeDate&&!l.contains(s.exchangeDate)&&l.push(s.exchangeDate);for(var p=0;p<l.length;p++){var d=l[p];teasp.constant.STATUS_FIX.contains(s.status)&&(n<=d&&d<=r||s.exchangeDate==d)&&!i.contains(d)&&(a[d]||(a[d]=[])).push(s)}}}return a},teasp.action.contact.transEmpMonth=function(a,o,s,i,n){var r={params:a};teasp.action.contact.remoteMethod("transEmpMonth",[a.empId,a.month,
o.getMode(),a.startDate],function(e){var t;"OK"==e.result?(o.setKeyObj("empTypeInfo",teasp.logic.convert.convEmpTypeInfo(e.empTypeInfo,e.yearMonth,e.startDate)),o.setKeyObj("empMonthList",e.empMonthList),o.setParams(dojo.mixin(r.params,teasp.action.contact.createParamByEmpMonth(o,e.yearMonth,e.startDate))),o.setEmpTypeByDate(e.yearMonth,e.startDate),o.setKeyObj("months",teasp.logic.convert.convEmpMonthObjs(
e.empMonths,e.deptMonths,o.getEmpMonthCustomKeys())),o.setKeyObj("configs",teasp.logic.convert.convConfigObjs(e.configs)),o.setKeyObj("applys",teasp.logic.convert.convEmpApplyObjs(e.empApplys)),o.setParams(dojo.mixin({},teasp.action.contact.createParamByEmpApplys(o,o.getKeyObj("applys")))),o.setKeyObj("cals",teasp.logic.convert.convCalendarObjs(e.calendar)),o.setKeyObj("empTypePatterns",
teasp.logic.convert.convEmpTypePatternObjs(e.empTypePattern)),o.setKeyObj("patterns",teasp.logic.convert.convPatternObjs(e.empTypePattern)),o.setKeyObj("days",teasp.logic.convert.convEmpDayObjs(e.empDays)),o.setKeyObj("sumTime",teasp.logic.convert.convSumTimeObjs(e)),o.setKeyObj("rejects",teasp.logic.convert.convRejectApplyList(e)),o.setKeyObj("cancels",teasp.logic.convert.convCancelApplyList(e)),o.setKeyObj(
"approver",teasp.logic.convert.convApprover(e.approver)),o.setKeyObj("stocks",teasp.logic.convert.convStockObjs(e.stocks)),o.setKeyObj("works",teasp.logic.convert.convWorkObjs(e.empWorks||[])),o.setKeyObj("jobApplys",teasp.logic.convert.convJobApplysObj(e.jobApplys||[])),(t=new teasp.logic.EmpTime(o)).mergeCalendar(),t.buildConfig(),t.buildEmpMonth(),i.apply(s,[!!r.params.noDelay,o.getObj()]),
r.params.noDelay?o.getObj().dayMap=null:teasp.action.contact.transEmpMonthDelay(a,o,s,i,n)):n.apply(s,[e.error])},function(e){n.apply(s,[e])})},teasp.action.contact.transEmpMonthDelay=function(e,t,a,o,s){var i=teasp.util.date.addYearMonth(t.getYearMonth(),-13),n=teasp.util.date.addYearMonth(t.getYearMonth(),13),i=t.getEmpMonth(i,null,0,!0),n=t.getEmpMonth(n,null),r={params:{empId:t.getEmpId(),
empTypeId:t.getEmpTypeId(),startDate:i.startDate,endDate:n.endDate,baseStartDate:t.getEmpMonthStartDate(),baseEndDate:t.getEmpMonthLastDate(),endLdate:teasp.util.date.addMonths(i.startDate,12)}};teasp.action.contact.remoteMethod("transEmpMonthDelay",[r.params.empId,r.params.empTypeId,r.params.startDate,r.params.endDate,r.params.baseStartDate,r.params.baseEndDate,r.params.endLdate],function(e){"OK"==e.result?(
t.setKeyObj("yuqRemains",teasp.logic.convert.convYuqRemainObjs(e.yuqRemains)),t.setKeyObj("plannedHolidays",e.plannedHolidays),t.setNextMonth(teasp.logic.convert.convCalendarObjs(e.calendar),teasp.logic.convert.convSimpleEmpDayObjs(e.simpleDays),teasp.action.createApplyMap(teasp.logic.convert.convEmpApplyObjs(e.empApplys)),r.params.startDate,r.params.endDate,teasp.logic.convert.convConfigMinObjs(e.configMins)),
o.apply(a,[!0])):s.apply(a,[e.error])},function(e){s.apply(a,[e])})},teasp.action.contact.loadEmpMonthPrint=function(e,o,s,i,n){var r={params:e};teasp.action.contact.remoteMethod("loadEmpMonthPrint",[e.empId||"",e.month||"","read",e.date||"",e.subNo||""],function(e){var t,a;"OK"==e.result?(o.setKeyObj("params",r.params),t=a=null,1==e.targetEmp.length?(t=e.targetEmp[0],a=e.targetEmp[0]):1<e.targetEmp.length&&(
t=e.targetEmp[teasp.util.equalId(e.targetEmp[0].Id,r.params.empId)?0:1],a=e.targetEmp[teasp.util.equalId(e.targetEmp[0].Id,r.params.empId)?1:0]),o.setKeyObj("sessionInfo",teasp.logic.convert.convSessionInfoObj(a,t,e.rights)),o.setKeyObj("targetEmp",teasp.logic.convert.convTargetEmpObj(t,r.params.mode)),o.setKeyObj("empTypeInfo",teasp.logic.convert.convEmpTypeInfo(e.empTypeInfo,e.yearMonth,e.startDate)),o.setKeyObj(
"common",teasp.logic.convert.convCommonObj(e.common,e.borderRevNo)),o.getEmpId()&&(o.setKeyObj("empMonthList",e.empMonthList),o.setParams(dojo.mixin({},teasp.action.contact.createParamByEmpMonth(o,e.yearMonth,e.startDate))),o.setKeyObj("deptHist",teasp.logic.convert.convDeptHist(e.deptHist)),o.setKeyObj("months",teasp.logic.convert.convEmpMonthObjs(e.empMonths,e.deptMonths,o.getEmpMonthCustomKeys())),o.setKeyObj(
"configs",teasp.logic.convert.convConfigObjs(e.configs)),o.setKeyObj("applys",teasp.logic.convert.convEmpApplyObjs(e.empApplys)),o.setParams(dojo.mixin({},teasp.action.contact.createParamByEmpApplys(o,o.getKeyObj("applys")))),o.setKeyObj("cals",teasp.logic.convert.convCalendarObjs(e.calendar)),o.setKeyObj("empTypePatterns",teasp.logic.convert.convEmpTypePatternObjs(e.empTypePattern)),o.setKeyObj("patterns",
teasp.logic.convert.convPatternObjs(e.empTypePattern)),o.setKeyObj("days",teasp.logic.convert.convEmpDayObjs(e.empDays)),o.setKeyObj("infos",teasp.logic.convert.convInfoObjs(e.infos)),o.setKeyObj("sumTime",teasp.logic.convert.convSumTimeObjs(e)),o.setKeyObj("yuqRemains",teasp.logic.convert.convYuqRemainObjs(e.yuqRemains)),o.setKeyObj("plannedHolidays",e.plannedHolidays),o.setKeyObj("approver",
teasp.logic.convert.convApprover(e.approver)),o.setKeyObj("workLocations",e.workLocations||[]),(a=new teasp.logic.EmpTime(o)).mergeCalendar(),a.buildConfig(),a.buildEmpMonth()),i.apply(s,[!0])):n.apply(s,[e.error])},function(e){n.apply(s,[e])})},teasp.action.contact.loadEmpConfig=function(e,o,s,i,n){var r={params:e};teasp.action.contact.remoteMethod("loadEmpConfig",[e.empId||"","","read"],function(e){var t,a;
"OK"==e.result?(o.setKeyObj("params",r.params),t=a=null,1==e.targetEmp.length?(t=e.targetEmp[0],a=e.targetEmp[0]):1<e.targetEmp.length&&(t=e.targetEmp[teasp.util.equalId(e.targetEmp[0].Id,r.params.empId)?0:1],a=e.targetEmp[teasp.util.equalId(e.targetEmp[0].Id,r.params.empId)?1:0]),o.setKeyObj("sessionInfo",teasp.logic.convert.convSessionInfoObj(a,t,e.rights)),o.setKeyObj("targetEmp",
teasp.logic.convert.convTargetEmpObj(t,r.params.mode)),o.setKeyObj("empTypeInfo",teasp.logic.convert.convEmpTypeInfo(e.empTypeInfo,e.yearMonth,e.startDate)),o.setKeyObj("common",teasp.logic.convert.convCommonObj(e.common,e.borderRevNo)),o.getEmpId()&&(o.setKeyObj("empMonthList",e.empMonthList),o.setParams(dojo.mixin({},teasp.action.contact.createParamByEmpMonth(o,e.yearMonth,e.startDate))),o.setKeyObj("months",
teasp.logic.convert.convEmpMonthObjs(e.empMonths,e.deptMonths,o.getEmpMonthCustomKeys())),o.setKeyObj("configs",teasp.logic.convert.convConfigObjs(e.configs)),o.setKeyObj("applys",teasp.logic.convert.convEmpApplyObjs(e.empApplys)),o.setParams(dojo.mixin({},teasp.action.contact.createParamByEmpApplys(o,o.getKeyObj("applys")))),o.setKeyObj("cals",teasp.logic.convert.convCalendarObjs(e.calendar)),o.setKeyObj(
"empTypePatterns",teasp.logic.convert.convEmpTypePatternObjs(e.empTypePattern)),o.setKeyObj("patterns",teasp.logic.convert.convPatternObjs(e.empTypePattern)),o.setKeyObj("holidays",teasp.logic.convert.convEmpTypeHolidayObjs(e.empTypeHoliday)),o.setKeyObj("days",teasp.logic.convert.convEmpDayObjs(e.empDays)),o.setKeyObj("infos",teasp.logic.convert.convInfoObjs(e.infos)),o.setKeyObj("sumTime",
teasp.logic.convert.convSumTimeObjs(e)),o.setKeyObj("yuqRemains",teasp.logic.convert.convYuqRemainObjs(e.yuqRemains)),o.setKeyObj("stocks",teasp.logic.convert.convStockObjs(e.stocks)),o.setKeyObj("commuterPasses",teasp.logic.convert.convCommuterPasses(e.commuterPasses)),(a=new teasp.logic.EmpTime(o)).mergeCalendar(),a.buildConfig(),a.buildEmpMonth()),i.apply(s,[!0])):n.apply(s,[e.error])},function(e){n.apply(s,[e])})
},teasp.action.contact.loadWidget=function(e,o,s,i,n){var r={params:e};teasp.action.contact.remoteMethod("loadWidget",["",""],function(e){var t,a;"OK"==e.result?(o.setKeyObj("params",r.params),t=a=null,1==e.targetEmp.length?(t=e.targetEmp[0],a=e.targetEmp[0]):1<e.targetEmp.length&&(t=e.targetEmp[teasp.util.equalId(e.targetEmp[0].Id,r.params.empId)?0:1],a=e.targetEmp[teasp.util.equalId(e.targetEmp[0].Id,r.params.empId
)?1:0]),o.setKeyObj("sessionInfo",teasp.logic.convert.convSessionInfoObj(a,t,e.rights)),o.setKeyObj("targetEmp",teasp.logic.convert.convTargetEmpObj(t,r.params.mode)),o.setKeyObj("empTypeInfo",teasp.logic.convert.convEmpTypeInfo(e.empTypeInfo,e.yearMonth,e.startDate)),o.setKeyObj("common",teasp.logic.convert.convCommonObj(e.common,e.borderRevNo)),o.getEmpId()&&(o.setKeyObj("empMonthList",e.empMonthList),o.setParams(
dojo.mixin({},teasp.action.contact.createParamByEmpMonth(o,e.yearMonth,e.startDate))),o.setKeyObj("months",teasp.logic.convert.convEmpMonthObjs(e.empMonths,e.deptMonths,o.getEmpMonthCustomKeys())),o.setKeyObj("configs",teasp.logic.convert.convConfigObjs(e.configs)),o.setKeyObj("applys",teasp.logic.convert.convEmpApplyObjs(e.empApplys)),o.setParams(dojo.mixin({},teasp.action.contact.createParamByEmpApplys(o,
o.getKeyObj("applys")))),o.setKeyObj("cals",teasp.logic.convert.convCalendarObjs(e.calendar)),o.setKeyObj("empTypePatterns",teasp.logic.convert.convEmpTypePatternObjs(e.empTypePattern)),o.setKeyObj("patterns",teasp.logic.convert.convPatternObjs(e.empTypePattern)),o.setKeyObj("days",teasp.logic.convert.convEmpDayObjs(e.empDays)),o.setKeyObj("infos",teasp.logic.convert.convInfoObjs(e.infos)),o.setKeyObj("sumTime",
teasp.logic.convert.convSumTimeObjs(e)),o.setKeyObj("rejects",teasp.logic.convert.convRejectApplyList(e)),o.setKeyObj("cancels",teasp.logic.convert.convCancelApplyList(e)),o.setKeyObj("workLocations",e.workLocations||[]),(a=new teasp.logic.EmpTime(o)).mergeCalendar(),a.buildConfig(),a.buildEmpMonth()),i.apply(s,[!0])):n.apply(s,[e.error])},function(e){n.apply(s,[e])})},teasp.action.contact.loadEmpDay=function(e,o,s,i
,n){var r={params:e};teasp.action.contact.remoteMethod("loadEmpDay",[e.empId||"",e.date||"",e.mode||""],function(e){var t,a;"OK"==e.result?(o.setKeyObj("params",r.params),a=t=null,1==e.targetEmp.length?(a=e.targetEmp[0],t=e.targetEmp[0]):1<e.targetEmp.length&&(a=e.targetEmp[teasp.util.equalId(e.targetEmp[0].Id,r.params.empId)?0:1],t=e.targetEmp[teasp.util.equalId(e.targetEmp[0].Id,r.params.empId)?1:0]),o.setKeyObj(
"sessionInfo",teasp.logic.convert.convSessionInfoObj(t,a,e.rights)),o.setKeyObj("targetEmp",teasp.logic.convert.convTargetEmpObj(a,r.params.mode)),o.setKeyObj("empTypeInfo",teasp.logic.convert.convEmpTypeInfo(e.empTypeInfo,e.yearMonth,teasp.logic.convert.valDate(e.date))),o.setKeyObj("common",teasp.logic.convert.convCommonObj(e.common,e.borderRevNo)),o.getEmpId()?(o.setKeyObj("empMonthList",e.empMonthList),
o.setParams(dojo.mixin({},teasp.action.contact.createParamByEmpMonth(o,e.yearMonth,e.startDate))),o.setKeyObj("deptHist",teasp.logic.convert.convDeptHist(e.deptHist)),o.setKeyObj("months",teasp.logic.convert.convEmpMonthObjs(e.empMonths,e.deptMonths,o.getEmpMonthCustomKeys())),o.setKeyObj("configs",teasp.logic.convert.convConfigObjs(e.configs||[])),o.setKeyObj("applys",teasp.logic.convert.convEmpApplyObjs(
e.empApplys||[])),o.setParams(dojo.mixin({},teasp.action.contact.createParamByEmpApplys(o,o.getKeyObj("applys")))),o.setKeyObj("cals",teasp.logic.convert.convCalendarObjs(e.calendar||[])),o.setKeyObj("empTypePatterns",teasp.logic.convert.convEmpTypePatternObjs(e.empTypePattern||[])),o.setKeyObj("patterns",teasp.logic.convert.convPatternObjs(e.empTypePattern||[])),o.setKeyObj("days",teasp.logic.convert.convEmpDayObjs(
e.empDays||[])),o.setKeyObj("infos",teasp.logic.convert.convInfoObjs(e.infos||[])),o.setKeyObj("sumTime",teasp.logic.convert.convSumTimeObjs(e)),o.setKeyObj("rejects",teasp.logic.convert.convRejectApplyList(e)),o.setKeyObj("cancels",teasp.logic.convert.convCancelApplyList(e)),o.setKeyObj("approver",teasp.logic.convert.convApprover(e.approver)),o.setKeyObj("stocks",teasp.logic.convert.convStockObjs(e.stocks)),
o.setKeyObj("jobApply",teasp.logic.convert.convJobApplyObj(e.jobApply||null)),o.setKeyObj("jobAssigns",teasp.logic.convert.convJobAssignObjs(e.jobAssign||[])),o.setKeyObj("works",teasp.logic.convert.convWorkObjs(e.empWorks||[])),o.setKeyObj("expLogs",teasp.logic.convert.convExpLogObjs(e.expLogs||[])),o.setKeyObj("events",teasp.logic.convert.convEvents(e.events||[])),o.setKeyObj("txsLogs",
teasp.logic.convert.convTxsLogs(e.txsLogs||[])),o.setKeyObj("calAccessService",teasp.logic.convert.convCalAccessService(e.calAccessService||"")),o.setKeyObj("calAuthResult",teasp.logic.convert.convCalAuthResult(e.calAuthResult||{})),o.setKeyObj("workLocations",e.workLocations||[]),tsfManager&&(t=e.empExps||[],teasp.logic.convert.excludeNameSpace(t),tsfManager.showFormT(t,o.getParamDate())),(a=new teasp.logic.EmpTime(
o)).mergeCalendar(),a.buildConfig(),a.buildEmpMonth(),i.apply(s,[!1]),teasp.action.contact.loadEmpDayDelay(o,s,i,n)):i.apply(s,[!0])):n.apply(s,[e.error])},function(e){n.apply(s,[e])})},teasp.action.contact.loadEmpDayDelay=function(t,a,o,s){var e=teasp.util.date.addYearMonth(t.getYearMonth(),-13),i=teasp.util.date.addYearMonth(t.getYearMonth(),13),e=t.getEmpMonth(e,null,0,!0),i=t.getEmpMonth(i,null),n={params:{
empId:t.getEmpId(),date:t.getParamDate(),mode:t.getMode(),empTypeId:t.getEmpTypeId(),startDate:e.startDate,endDate:i.endDate,baseDate:t.getEmpMonthLastDate(),endLdate:teasp.util.date.addMonths(e.startDate,12)}};teasp.action.contact.remoteMethod("loadEmpDayDelay",[n.params.empId,n.params.date,n.params.mode,n.params.empTypeId,n.params.startDate,n.params.endDate,n.params.baseDate,n.params.endLdate],function(e){
"OK"==e.result?(t.setKeyObj("expItems",teasp.logic.convert.convExpItemObjs(e.expItems||[])),t.setKeyObj("foreignCurrency",teasp.logic.convert.convForeignCurrencyObjs(e.foreignCurrency||[])),t.setKeyObj("expHistory",e.expHistory||null),t.setKeyObj("holidays",teasp.logic.convert.convEmpTypeHolidayObjs(e.empTypeHoliday)),t.setKeyObj("yuqRemains",teasp.logic.convert.convYuqRemainObjs(e.yuqRemains)),t.setKeyObj(
"plannedHolidays",e.plannedHolidays),t.setNextMonth(teasp.logic.convert.convCalendarObjs(e.calendar),teasp.logic.convert.convSimpleEmpDayObjs(e.simpleDays),teasp.action.createApplyMap(teasp.logic.convert.convEmpApplyObjs(e.empApplys)),n.params.startDate,n.params.endDate,teasp.logic.convert.convConfigMinObjs(e.configMins)),t.setKeyObj("approverSet",teasp.logic.convert.convApproverSetObjs(e.approverSet)),t.setKeyObj(
"depts",teasp.logic.convert.convDeptList(e.depts)),t.setKeyObj("configHistory",teasp.logic.convert.convConfigHistory(e.configHistory)),o.apply(a,[!0])):s.apply(a,[e.error])},function(e){s.apply(a,[e])})},teasp.action.contact.transEmpDay=function(e,a,o,s,i){var n={params:e};teasp.action.contact.remoteMethod("transEmpDay",[e.empId,e.date,a.getMode()],function(e){var t;"OK"==e.result?(a.resetDailyData(),a.setKeyObj(
"params",n.params),a.setKeyObj("empTypeInfo",teasp.logic.convert.convEmpTypeInfo(e.empTypeInfo,e.yearMonth,e.startDate)),a.setKeyObj("empMonthList",e.empMonthList),a.setParams(dojo.mixin({},teasp.action.contact.createParamByEmpMonth(a,e.yearMonth,e.startDate))),a.setEmpTypeByDate(null,teasp.logic.convert.valDate(e.date)),a.setKeyObj("months",teasp.logic.convert.convEmpMonthObjs(e.empMonths,e.deptMonths,
a.getEmpMonthCustomKeys())),a.setKeyObj("configs",teasp.logic.convert.convConfigObjs(e.configs||[])),a.setKeyObj("applys",teasp.logic.convert.convEmpApplyObjs(e.empApplys||[])),a.setParams(dojo.mixin({},teasp.action.contact.createParamByEmpApplys(a,a.getKeyObj("applys")))),a.setKeyObj("cals",teasp.logic.convert.convCalendarObjs(e.calendar||[])),a.setKeyObj("empTypePatterns",teasp.logic.convert.convEmpTypePatternObjs(
e.empTypePattern||[])),a.setKeyObj("patterns",teasp.logic.convert.convPatternObjs(e.empTypePattern||[])),a.setKeyObj("holidays",teasp.logic.convert.convEmpTypeHolidayObjs(e.empTypeHoliday)),a.setKeyObj("days",teasp.logic.convert.convEmpDayObjs(e.empDays||[])),a.setKeyObj("infos",teasp.logic.convert.convInfoObjs(e.infos||[])),a.setKeyObj("sumTime",teasp.logic.convert.convSumTimeObjs(e)),a.setKeyObj("approver",
teasp.logic.convert.convApprover(e.approver)),a.setKeyObj("stocks",teasp.logic.convert.convStockObjs(e.stocks)),a.setKeyObj("jobApply",teasp.logic.convert.convJobApplyObj(e.jobApply||null)),a.setKeyObj("works",teasp.logic.convert.convWorkObjs(e.empWorks||[])),a.setKeyObj("expLogs",teasp.logic.convert.convExpLogObjs(e.expLogs||[])),a.setKeyObj("events",teasp.logic.convert.convEvents(e.events||[])),a.setKeyObj(
"txsLogs",teasp.logic.convert.convTxsLogs(e.txsLogs||[])),a.setKeyObj("rejects",teasp.logic.convert.convRejectApplyList(e)),a.setKeyObj("cancels",teasp.logic.convert.convCancelApplyList(e)),a.setKeyObj("calAccessService",teasp.logic.convert.convCalAccessService(e.calAccessService||"")),a.setKeyObj("calAuthResult",teasp.logic.convert.convCalAuthResult(e.calAuthResult||"")),tsfManager&&(t=e.empExps||[],
teasp.logic.convert.excludeNameSpace(t),tsfManager.showFormT(t,a.getParamDate())),(t=new teasp.logic.EmpTime(a)).mergeCalendar(),t.buildConfig(),t.buildEmpMonth(),s.apply(o,[!0,a.getObj()])):i.apply(o,[e.error])},function(e){i.apply(o,[e])})},teasp.action.contact.getEmpMonthApplySteps=function(e,t,a,o,s){teasp.action.contact.remoteMethod("getEmpMonthApplySteps",[e.applyId,e.empId,e.month],function(e){
"OK"==e.result?o.apply(a,[!0,teasp.logic.convert.convMixApplySteps(e,!0)]):s.apply(a,[e.error])},function(e){s.apply(a,[e])})},teasp.action.contact.getEmpDayApplySteps=function(e,t,a,o,s){teasp.action.contact.remoteMethod("getEmpDayApplySteps",[e.empId,e.date],function(e){"OK"==e.result?o.apply(a,[!0,teasp.logic.convert.convMixApplySteps(e,!0)]):s.apply(a,[e.error])},function(e){s.apply(a,[e])})},
teasp.action.contact.getApplyStepsById=function(e,t,a,o,s){teasp.action.contact.remoteMethod("getApplyStepsById",e,function(e){"OK"==e.result?o.apply(a,[!0,teasp.logic.convert.convMixApplySteps(e,!0)]):s.apply(a,[e.error])},function(e){s.apply(a,[e])})},teasp.action.contact.applyEmpDay=function(t,a,o,s,i){teasp.action.contact.remoteMethod("applyEmpDay",t,function(e){
"OK"==e.result?t.client==teasp.constant.APPLY_CLIENT_DAILY?teasp.action.contact.transEmpDay(t,a,o,s,i):teasp.action.contact.transEmpMonth(t,a,o,s,i):i.apply(o,[e.error])},function(e){i.apply(o,[e])})},teasp.action.contact.cancelApplyEmpDay=function(t,a,o,s,i){teasp.action.contact.remoteMethod(t.action,t,function(e){"OK"==e.result?t.client==teasp.constant.APPLY_CLIENT_DAILY?teasp.action.contact.transEmpDay(t,a,o,s,i
):teasp.action.contact.transEmpMonth(t,a,o,s,i):i.apply(o,[e.error])},function(e){i.apply(o,[e])})},teasp.action.contact.cleanupEmpReject=function(i,n,r,l,p){var d=i.currMonth||i.month;teasp.action.contact.remoteMethod("cleanupEmpReject",i,function(e){if("OK"==e.result){if(e.lastModifiedDate&&n.getYearMonth()==d&&n.setLastModifiedDate(e.lastModifiedDate),teasp.action.contact.getEmpYuqs(i.empId,n,r,l,p),
n.isInputAccessControl()){var t=e.empDays||[];teasp.logic.convert.excludeNameSpace(t);for(var a=0;a<t.length;a++){var o=t[a],s=teasp.util.date.formatDate(o.Date__c),s=n.getDayObj(s);s.dairyDivergenceJudgement=o.DairyDivergenceJudgement__c,s.enterDivergenceJudgement=teasp.logic.convert.valNumber(o.EnterDivergenceJudgement__c,null),s.enterTime=o.EnterTime__c,s.exitDivergenceJudgement=teasp.logic.convert.valNumber(
o.ExitDivergenceJudgement__c,null),s.exitTime=o.ExitTime__c}}}else p.apply(r,[e.error])},function(e){p.apply(r,[e])})},teasp.action.contact.getEmpYuqs=function(e,t,a,o,s){teasp.action.contact.remoteMethod("getEmpYuqs",e,function(e){"OK"==e.result?(t.setKeyObj("yuqRemains",teasp.logic.convert.convYuqRemainObjs(e.yuqRemains)),t.setKeyObj("stocks",teasp.logic.convert.convStockObjs(e.stocks)),o.apply(a,[!0])):s.apply(a,[
e.error])},function(e){s.apply(a,[e])})},teasp.action.contact.applyEmpMonth=function(t,a,o,s,i){teasp.action.contact.remoteMethod("applyEmpMonth",t,function(e){"OK"==e.result?teasp.action.contact.transEmpMonth(t,a,o,s,i):i.apply(o,[e.error])},function(e){i.apply(o,[e])})},teasp.action.contact.cancelApplyEmpMonth=function(t,a,o,s,i){teasp.action.contact.remoteMethod("cancelApplyEmpMonth",t,function(e){"OK"==e.result?(
e.lastModifiedDate&&a.setLastModifiedDate(e.lastModifiedDate),teasp.action.contact.transEmpMonth(t,a,o,s,i)):i.apply(o,[e.error])},function(e){i.apply(o,[e])})},teasp.action.contact.empExpApproval=function(t,a,o,s,i){teasp.action.contact.remoteMethod("empExpApproval",t,function(e){"OK"==e.result?t.refresh&&"empApply"==t.objKey?(t.empId=a.getEmpId(),t.month=a.getYearMonth(),t.date=a.getStartDate(),t.startDate=t.date,
teasp.action.contact.transEmpMonth(t,a,o,s,i)):t.refresh&&"expApply"==t.objKey?(t.empId=a.getEmpId(),t.expApplyId=a.getExpApplyId(),teasp.action.contact.transEmpExp(t,a,o,s,i)):t.refresh&&"jobApply"==t.objKey?(t.empId=a.getEmpId(),t.month=a.getJobYearMonth(),t.date=a.getJobStartDate(),t.startDate=t.date,teasp.action.contact.transJobMonth(t,a,o,s,i)):s.apply(o,[!0]):i.apply(o,[e.error])},function(e){i.apply(o,[e])})},
teasp.action.contact.closeApplyEmpMonth=function(a,o,s,i,n){teasp.action.contact.remoteMethod("closeApplyEmpMonth",a,function(e){var t;"OK"==e.result?(e.lastModifiedDate&&o.setLastModifiedDate(e.lastModifiedDate),t=teasp.logic.convert.convEmpMonthApplyObjs(e.apply),o.removeReject(t),teasp.action.contact.transEmpMonth(a,o,s,i,n)):n.apply(s,[e.error])},function(e){n.apply(s,[e])})},
teasp.action.contact.inputTimeTable=function(r,l,p,d,c){teasp.action.contact.remoteMethod("inputTimeTable",r,function(e){if("OK"==e.result)if(r.client&&r.dayFix||l.existEmpMonthCustomKeys())r.client==teasp.constant.APPLY_CLIENT_DAILY?teasp.action.contact.transEmpDay(r,l,p,d,c):teasp.action.contact.transEmpMonth(r,l,p,d,c);else{e.lastModifiedDate&&l.setLastModifiedDate(e.lastModifiedDate),e.stocks&&l.setKeyObj(
"stocks",teasp.logic.convert.convStockObjs(e.stocks));var t=e.empDays||[];teasp.logic.convert.excludeNameSpace(t);for(var a=0;a<t.length;a++){var o=t[a],s=teasp.util.date.formatDate(o.Date__c),i=l.getDayObj(s);s==r.date&&(i.startTime=o.StartTime__c,i.endTime=o.EndTime__c,"number"!=typeof i.startTime&&(i.startTime=null),"number"!=typeof i.endTime&&(i.endTime=null),i.timeTable=teasp.util.extractTimes(o.TimeTable__c||""
),l.replaceWorkNote(r.date,o.WorkNote__c||""),i.workLocationId=o.WorkLocationId__c),r.useInputAccessControl&&(i.dairyDivergenceJudgement=o.DairyDivergenceJudgement__c,i.enterDivergenceJudgement=teasp.logic.convert.valNumber(o.EnterDivergenceJudgement__c,null),i.enterDivergenceReason=o.EnterDivergenceReason__c,i.enterTime=o.EnterTime__c,i.exitDivergenceJudgement=teasp.logic.convert.valNumber(
o.ExitDivergenceJudgement__c,null),i.exitDivergenceReason=o.ExitDivergenceReason__c,i.exitTime=o.ExitTime__c)}r.refreshWork&&(l.setKeyObj("jobAssigns",teasp.logic.convert.convJobAssignObjs(e.jobAssign||[])),l.replaceWorks(r.date,teasp.logic.convert.convWorkObjs(e.empWorks||[])));var n=new teasp.logic.EmpTime(l);n.mergeCalendar(),n.buildEmpMonth(),d.apply(p,[!0])}else c.apply(p,[e.error])},function(e){c.apply(p,[e])})
},teasp.action.contact.inputTime=function(a,o,s,i,n){teasp.action.contact.remoteMethod("inputTime",a,function(e){var t;"OK"==e.result?a.client&&a.dayFix?a.client==teasp.constant.APPLY_CLIENT_DAILY?teasp.action.contact.transEmpDay(a,o,s,i,n):teasp.action.contact.transEmpMonth(a,o,s,i,n):(e.lastModifiedDate&&o.setLastModifiedDate(e.lastModifiedDate),o.replaceDays(teasp.logic.convert.convEmpDayObjs(e.empDays||[])),(
t=new teasp.logic.EmpTime(o)).mergeCalendar(),t.buildEmpMonth(),i.apply(s,[!0])):n.apply(s,[e.error])},function(e){n.apply(s,[e])})},teasp.action.contact.saveEmpNoteByDay=function(t,a,o,s,i){teasp.action.contact.remoteMethod("saveEmpNoteByDay",t,function(e){"OK"==e.result?(e.lastModifiedDate&&a.setLastModifiedDate(e.lastModifiedDate),a.getEmpDay(t.date).setDayNote(t.note),new teasp.logic.EmpTime(a).decorateEmpDay(
a.getCommonObj(),a.getConfigObj(),a.getDayObj(t.date)),s.apply(o,[!0])):i.apply(o,[e.error])},function(e){i.apply(o,[e])})},teasp.action.contact.setInfoAgree=function(i,n,r,l,p){teasp.action.contact.remoteMethod("setInfoAgree",i,function(e){if("OK"==e.result){for(var t=n.getInfos(),a=0;a<t.length;a++)for(var o=t[a],s=0;s<i.infoId.length;s++)o.id==i.infoId[s]&&(o.agree=!0);l.apply(r,[!0])}else p.apply(r,[e.error])},
function(e){p.apply(r,[e])})},teasp.action.contact.getEmpIdByName=function(e,t,a,o,s){teasp.action.contact.remoteMethod("getEmpByName",[e],function(e){teasp.logic.convert.excludeNameSpace(e),o.apply(a,[!0,e])},function(e){s.apply(a,[e])})},teasp.action.contact.getEmpMonth=function(e,t,a,o,s){teasp.action.contact.remoteMethod("getEmpMonth",[e.empId,e.month],function(e){o.apply(a,[!0,
teasp.logic.convert.convEmpMonthObj(e)])},function(e){s.apply(a,[e])})},teasp.action.contact.getAllEmpYuqs=function(e,t,a,o,s){teasp.action.contact.remoteMethod("getEmpYuqByEmpId",[e.empId],function(e){e={empYuqs:teasp.logic.convert.convEmpYuqObj(e.empYuqs),empYuqDetails:teasp.logic.convert.convEmpYuqDetailObj(e.empYuqDetails)};o.apply(a,[!0,e])},function(e){s.apply(a,[e])})},
teasp.action.contact.createParamByEmpMonth=function(e,t,a){var o=e.getParams(),a=(t="string"==typeof t?parseInt(t,10):t,o.month=t,o.monthEx=a,e.dataObj.empMonthMap[o.monthEx]||e.dataObj.empMonthMap[t]),e=(o.subNo=a.subNo||null,o.startDate=a.startDate,o.endDate=a.endDate,o.startYm=teasp.util.date.addYearMonth(t,-13),o.endYm=teasp.util.date.addYearMonth(t,13),a.empType.configBase.initialDayOfWeek),
t=teasp.util.date.parseDate(o.startDate),a=t.getDay(),a=e==a?-1:e-a-(a<e?7:0),e=teasp.util.date.addDays(t,a=0==a?-1:a);return o.startLdate=teasp.util.date.formatDate(teasp.util.date.addDays(e,-366)),o.endLdate=teasp.util.date.formatDate(teasp.util.date.addDays(teasp.util.date.parseDate(o.endDate),366)),o},teasp.action.contact.createParamByEmpApplys=function(e,t){var a=e.getParams();a.dateList=[];for(
var o=0;o<t.length;o++){var s=t[o];s.applyType==teasp.constant.APPLY_TYPE_EXCHANGE&&(s.exchangeDate<a.startLdate||a.endLdate<s.exchangeDate?a.dateList.push(s.exchangeDate):(s.startDate<a.startLdate||a.endLdate<s.startDate)&&a.dateList.push(s.startDate))}return a},teasp.action.contact.recalcOneDay=function(e,t){
t.dayType==teasp.constant.DAY_TYPE_NORMAL||t.workFlag||t.autoLH||0<t.rack.validApplys.kyushtu.length?t.rack.worked=teasp.util.time.isValidRange(t.startTime,t.endTime):t.rack.worked=!1;var a=new teasp.logic.EmpTime(e);a.calculateEmpDay(t,dojo.clone(t.period),e.getConfigObj(t.date),e.getCommonObj(),teasp.constant.C_REAL),a.calculateEmpDay(t,dojo.clone(t.period),e.getConfigObj(t.date),e.getCommonObj(),
teasp.constant.C_DISC),a.calculateEmpDay(t,dojo.clone(t.period),e.getConfigObj(t.date),e.getCommonObj(),teasp.constant.C_FREAL),a.calculateEmpDay(t,dojo.clone(t.period),e.getConfigObj(t.date),e.getCommonObj(),teasp.constant.C_FDISC)},teasp.action.contact.getAtkApproverSet=function(e,t,a,o,s){teasp.action.contact.remoteMethod(e.action,e,function(e){"OK"==e.result?(t.setKeyObj("approverSet",
teasp.logic.convert.convApproverSetObjs(e.approverSet)),o.apply(a,[!0])):s.apply(a,[e.error])},function(e){s.apply(a,[e])})},teasp.action.contact.saveDivergenceReason=function(o,s,i,n,r){teasp.action.contact.remoteMethod("saveDivergenceReason",o,function(e){var t,a;"OK"==e.result?(e.lastModifiedDate&&s.setLastModifiedDate(e.lastModifiedDate),a=s.getDayObj(o.date),t=0<e.empDay.length?e.empDay[0]:{},
teasp.logic.convert.excludeNameSpace(t),a.dairyDivergenceJudgement=t.DairyDivergenceJudgement__c,a.enterDivergenceJudgement=teasp.logic.convert.valNumber(t.EnterDivergenceJudgement__c,null),a.enterDivergenceReason=t.EnterDivergenceReason__c,a.enterTime=t.EnterTime__c,a.exitDivergenceJudgement=teasp.logic.convert.valNumber(t.ExitDivergenceJudgement__c,null),a.exitDivergenceReason=t.ExitDivergenceReason__c,
a.exitTime=t.ExitTime__c,(a=new teasp.logic.EmpTime(s)).mergeCalendar(),a.buildEmpMonth(),n.apply(i,[!0])):r.apply(i,[e.error])},function(e){r.apply(i,[e])})},teasp.action.contact.createEmpMonthHook=function(t,a,o,s,i){teasp.action.contact.remoteMethod("createEmpMonthHook",t,function(e){"OK"==e.result?e.monthId?teasp.action.contact.transEmpMonth(t,a,o,s,i):s.apply(o,[!0]):i.apply(o,[e.error])},function(e){i.apply(o,[
e])})},teasp.action.contact.rebuildStockWithTime=function(e,t,a,o,s){teasp.action.contact.remoteMethod("rebuildStockWithTime",e,function(e){"OK"==e.result?o.apply(a,[!0,e]):s.apply(a,[e.error])},function(e){s.apply(a,[e])})},teasp.action.contact.loadEmpExp=function(e,o,s,i,n){var r={params:e};teasp.action.contact.remoteMethod("loadEmpExp",[e.empId,e.expApplyId,e.mode||""],function(e){var t,a;"OK"==e.result?(
r.params.empId=e.empId,o.setKeyObj("params",r.params),t=a=null,1==e.targetEmp.length?(t=e.targetEmp[0],a=e.targetEmp[0]):1<e.targetEmp.length&&(t=e.targetEmp[teasp.util.equalId(e.targetEmp[0].Id,r.params.empId)?0:1],a=e.targetEmp[teasp.util.equalId(e.targetEmp[0].Id,r.params.empId)?1:0]),o.setKeyObj("isJobLeader",e.isJobleader),o.setKeyObj("sessionInfo",teasp.logic.convert.convSessionInfoObj(a,t,e.rights)),
o.setKeyObj("targetEmp",teasp.logic.convert.convTargetEmpObj(t,r.params.mode)),o.setKeyObj("common",teasp.logic.convert.convCommonObj(e.common,e.borderRevNo)),o.setKeyObj("payeeTypeNums",e.payeeTypeNums),o.getEmpId()?(o.setKeyObj("expLogs",teasp.logic.convert.convExpLogObjs(e.expLogs||[])),o.setKeyObj("infos",teasp.logic.convert.convInfoObjs(e.infos)),o.setKeyObj("rejects",teasp.logic.convert.convRejectApplyList(e)),
o.setKeyObj("expApply",teasp.logic.convert.convExpApplyObjs(e.expApplys||[])),o.setKeyObj("expApplyHistory",teasp.logic.convert.convExpApplyHistory(e.history)),o.setKeyObj("approver",teasp.logic.convert.convApprover(e.approver)),e.steps&&(a=teasp.logic.convert.convMixApplySteps(e,!0,!0),o.setKeyObj("expApplySteps",("object"==typeof a?a.steps:a)||[])),o.setKeyObj("atkApplyTypeList",e.atkApplyTypeList),i.apply(s,[!1]),
teasp.action.contact.loadEmpExpDelay(o,s,i,n)):i.apply(s,[!0])):n.apply(s,[e.error])},function(e){n.apply(s,[e])})},teasp.action.contact.loadEmpExpDelay=function(t,a,o,s){teasp.action.contact.remoteMethod("loadEmpExpDelay",[t.getEmpId(),t.getExpApplyId()||""],function(e){"OK"==e.result?(t.setKeyObj("jobAssigns",teasp.logic.convert.convJobAssignObjs(e.jobAssign||[])),t.setKeyObj("works",
teasp.logic.convert.convWorkObjs(e.empWorks||[])),t.setKeyObj("expItems",teasp.logic.convert.convExpItemObjs(e.expItems||[])),t.setKeyObj("foreignCurrency",teasp.logic.convert.convForeignCurrencyObjs(e.foreignCurrency||[])),t.setKeyObj("expHistory",e.expHistory||null),t.setKeyObj("approverSet",teasp.logic.convert.convApproverSetObjs(e.approverSet)),o.apply(a,[!0])):s.apply(a,[e.error])},function(e){})},
teasp.action.contact.transEmpExp=function(e,t,a,o,s){var i={params:e};teasp.action.contact.remoteMethod("transEmpExp",[e.empId,e.expApplyId,t.getMode()],function(e){"OK"==e.result?(t.setKeyObj("params",i.params),t.setKeyObj("expLogs",teasp.logic.convert.convExpLogObjs(e.expLogs||[])),t.setKeyObj("expApply",teasp.logic.convert.convExpApplyObjs(e.expApplys||[])),t.setKeyObj("rejects",
teasp.logic.convert.convRejectApplyList(e)),t.setKeyObj("works",teasp.logic.convert.convWorkObjs(e.empWorks||[])),t.setKeyObj("approver",teasp.logic.convert.convApprover(e.approver)),t.setKeyObj("expApplyHistory",teasp.logic.convert.convExpApplyHistory(e.history)),o.apply(a,[!0])):s.apply(a,[e.error])},function(e){s.apply(a,[e])})},teasp.action.contact.getExpApplySteps=function(e,t,a,o,s){
teasp.action.contact.remoteMethod("getExpApplySteps",[e.expApplyId],function(e){"OK"==e.result?o.apply(a,[!0,teasp.logic.convert.convMixApplySteps(e,!0,!0)]):s.apply(a,[e.error])},function(e){s.apply(a,[e])})},teasp.action.contact.searchRoute=function(e,t,a,o,s){teasp.action.contact.remoteMethod("searchRoute",e,function(e){"OK"==e.result?o.apply(a,[!0,e]):s.apply(a,[e.error])},function(e){s.apply(a,[e])})},
teasp.action.contact.changeEmpExpJob=function(e,t,a,o,s){var i=e.openerClass;delete e.openerClass,teasp.action.contact.remoteMethod("changeEmpExpJob",e,function(e){"OK"==e.result?"Daily"==i?teasp.action.contact.changeEmpExpDJDayDelay(t,a,o,s):"EmpExps"==i&&teasp.action.contact.changeEmpExpDJDelay(t,a,o,s):s.apply(a,[e.error])},function(e){s.apply(a,[e])})},teasp.action.contact.changeEmpExpDate=function(e,t,a,o,s){
var i=e.openerClass;delete e.openerClass,teasp.action.contact.remoteMethod("changeEmpExpDate",e,function(e){"OK"==e.result?"Daily"==i?teasp.action.contact.changeEmpExpDJDayDelay(t,a,o,s):"EmpExps"==i&&teasp.action.contact.changeEmpExpDJDelay(t,a,o,s):s.apply(a,[e.error])},function(e){s.apply(a,[e])})},teasp.action.contact.changeEmpExpDJDayDelay=function(e,t,a,o){teasp.action.contact.transEmpDay({empId:e.getEmpId(),
date:e.getParamDate()},e,t,a,o)},teasp.action.contact.changeEmpExpDJDelay=function(e,t,a,o){teasp.action.contact.transEmpExp({empId:e.getEmpId(),expApplyId:e.getExpApplyId()},e,t,a,o)},teasp.action.contact.saveEmpExp=function(t,a,o,s,i){var e=dojo.clone(t);e.expHistory=null,teasp.action.contact.remoteMethod("saveEmpExp",e,function(e){"OK"==e.result?(a.replaceExpLogs(t.date,t.expApplyId,
teasp.logic.convert.convExpLogObjs(e.expLogs||[])),s.apply(o,[!0]),t.expHistory&&teasp.action.contact.saveEmpExpDelay(t,a,o,s,i)):i.apply(o,[e.error])},function(e){i.apply(o,[e])})},teasp.action.contact.saveEmpExpDelay=function(e,t,a,o,s){teasp.action.contact.remoteMethod("saveEmpExpDelay",[e.empId,e.expHistory],function(e){},function(e){})},teasp.action.contact.saveEmpExpConfig=function(t,e,a,o,s){
teasp.action.contact.remoteMethod("saveEmpExpConfig",t,function(e){"OK"==e.result?o.apply(a,[!0,t]):s.apply(a,[e.error])},function(e){s.apply(a,[e])})},teasp.action.contact.submitExpApply=function(e,t,a,o,s){teasp.action.contact.remoteMethod("submitExpApply",e,function(e){"OK"==e.result?(teasp.logic.convert.excludeNameSpace(e),teasp.action.contact.transEmpExp({empId:t.getEmpId(),
expApplyId:e.expLogs[0].ExpApplyId__r.Id},t,a,o,s)):s.apply(a,[e.error])},function(e){s.apply(a,[e])})},teasp.action.contact.cancelExpApply=function(e,t,a,o,s){teasp.action.contact.remoteMethod("cancelExpApply",e,function(e){"OK"==e.result?(teasp.logic.convert.excludeNameSpace(e),teasp.action.contact.transEmpExp({empId:t.getEmpId(),expApplyId:null},t,a,o,s)):s.apply(a,[e.error])},function(e){s.apply(a,[e])})},
teasp.action.contact.getAtkExpItems=function(e,t,a,o,s){teasp.action.contact.remoteMethod("getAtkExpItems",[],function(e){t.setKeyObj("expItems",teasp.logic.convert.convExpItemObjs(e.expItems||[])),o.apply(a,[!0])},function(e){s.apply(a,[e])})},teasp.action.contact.getExpByDate=function(e,t,a,o,s){teasp.action.contact.remoteMethod("getExpByDate",[e.empId,e.month],function(e){t.setKeyObj("expLogs",
teasp.logic.convert.convExpLogObjs(e.expLogs||[])),t.setKeyObj("jobApply",teasp.logic.convert.convJobApplyObj(e.jobApply||null)),o.apply(a,[!0])},function(e){s.apply(a,[e])})},teasp.action.contact.loadJobMonth=function(e,o,s,i,n){var r={params:e};teasp.action.contact.remoteMethod("loadJobMonth",[e.empId,e.month,e.mode||"",e.date||"",e.subNo||""],function(e){var t,a;"OK"==e.result?(r.params.month=e.jobYearMonth,
r.params.subNo=e.jobSubNo,r.params.startDate=e.jobStartDate,r.params.endDate=e.jobEndDate,r.params.startYm=teasp.util.date.addYearMonth(r.params.month,-13),r.params.endYm=teasp.util.date.addYearMonth(r.params.month,13),o.setKeyObj("params",r.params),a=t=null,1==e.targetEmp.length?(a=e.targetEmp[0],t=e.targetEmp[0]):1<e.targetEmp.length&&(a=e.targetEmp[teasp.util.equalId(e.targetEmp[0].Id,r.params.empId)?0:1],
t=e.targetEmp[teasp.util.equalId(e.targetEmp[0].Id,r.params.empId)?1:0]),o.setKeyObj("sessionInfo",teasp.logic.convert.convSessionInfoObj(t,a,e.rights)),o.setKeyObj("targetEmp",teasp.logic.convert.convTargetEmpObj(a,r.params.mode)),o.setKeyObj("empTypeInfo",teasp.logic.convert.convEmpTypeInfo(e.empTypeInfo,e.yearMonth,e.jobStartDate)),o.setKeyObj("common",teasp.logic.convert.convCommonObj(e.common,e.borderRevNo)),
o.getEmpId()&&(o.setKeyObj("empMonthList",e.empMonthList),o.setKeyObj("deptHist",teasp.logic.convert.convDeptHist(e.deptHist)),o.setKeyObj("monthSimple",teasp.logic.convert.convEmpMonthSimpleObjs(e.empMonthSimple)),o.setKeyObj("infos",teasp.logic.convert.convInfoObjs(e.infos)),o.setKeyObj("rejects",teasp.logic.convert.convRejectApplyList(e)),o.setKeyObj("jobAssigns",teasp.logic.convert.convJobAssignObjs(
e.jobAssign||[])),o.setKeyObj("works",teasp.logic.convert.convWorkObjs(e.empWorks||[])),o.setKeyObj("jobApply",teasp.logic.convert.convJobApplyObj(e.jobApply||null)),o.setKeyObj("workNotes",teasp.logic.convert.convWorkNoteList(e.workNotes||[])),o.setKeyObj("approver",teasp.logic.convert.convApprover(e.approver)),o.setKeyObj("approverSet",teasp.logic.convert.convApproverSetObjs(e.approverSet)),o.setKeyObj("depts",
teasp.logic.convert.convDeptList(e.depts)),o.setKeyObj("empTypePatterns",teasp.logic.convert.convEmpTypePatternObjs(e.empTypePattern)),o.setKeyObj("months",teasp.logic.convert.convEmpMonthObjs(e.empMonths,e.deptMonths,o.getEmpMonthCustomKeys())),o.setKeyObj("configs",teasp.logic.convert.convConfigObjs(e.configs)),o.setKeyObj("cals",teasp.logic.convert.convCalendarObjs(e.calendar)),o.setKeyObj("days",
teasp.logic.convert.convEmpDayObjs(e.empDays)),o.setKeyObj("applys",teasp.logic.convert.convEmpApplyObjs(e.empApplys)),o.mergeCalendar(r.params.startDate,r.params.endDate)),i.apply(s,[!0])):n.apply(s,[e.error])},function(e){n.apply(s,[e])})},teasp.action.contact.transJobMonth=function(e,t,a,o,s){var i={params:e};teasp.action.contact.remoteMethod("transJobMonth",[e.empId,e.month,t.getMode(),e.startDate||""],function(e
){"OK"==e.result?(i.params.month=e.jobYearMonth,i.params.subNo=e.jobSubNo,i.params.startDate=e.jobStartDate,i.params.endDate=e.jobEndDate,i.params.startYm=teasp.util.date.addYearMonth(i.params.month,-13),i.params.endYm=teasp.util.date.addYearMonth(i.params.month,13),t.setKeyObj("params",i.params),t.setEmpTypeByDate(e.yearMonth,e.jobStartDate),t.setKeyObj("monthSimple",teasp.logic.convert.convEmpMonthSimpleObjs(
e.empMonthSimple)),t.setKeyObj("works",teasp.logic.convert.convWorkObjs(e.empWorks||[])),t.setKeyObj("rejects",teasp.logic.convert.convRejectApplyList(e)),t.setKeyObj("jobApply",teasp.logic.convert.convJobApplyObj(e.jobApply||null)),t.setKeyObj("workNotes",teasp.logic.convert.convWorkNoteList(e.workNotes||[])),t.setKeyObj("approver",teasp.logic.convert.convApprover(e.approver)),t.setKeyObj("empMonthList",
e.empMonthList),t.setKeyObj("empTypePatterns",teasp.logic.convert.convEmpTypePatternObjs(e.empTypePattern)),t.setKeyObj("months",teasp.logic.convert.convEmpMonthObjs(e.empMonths,e.deptMonths,t.getEmpMonthCustomKeys())),t.setKeyObj("configs",teasp.logic.convert.convConfigObjs(e.configs)),t.setKeyObj("cals",teasp.logic.convert.convCalendarObjs(e.calendar)),t.setKeyObj("days",teasp.logic.convert.convEmpDayObjs(e.empDays
)),t.setKeyObj("applys",teasp.logic.convert.convEmpApplyObjs(e.empApplys)),t.mergeCalendar(i.params.startDate,i.params.endDate),o.apply(a,[!0])):s.apply(a,[e.error])},function(e){s.apply(a,[e])})},teasp.action.contact.getJobApplySteps=function(e,t,a,o,s){teasp.action.contact.remoteMethod("getJobApplySteps",[e.empId,e.month,e.subNo],function(e){"OK"==e.result?o.apply(a,[!0,teasp.logic.convert.convMixApplySteps(e,!0)]
):s.apply(a,[e.error])},function(e){s.apply(a,[e])})},teasp.action.contact.searchJob=function(e,t,a,o,s){teasp.action.contact.remoteMethod("searchJob",e,function(e){"OK"==e.result?o.apply(a,[!0,teasp.logic.convert.convUnlimitedJobObjs(e.jobs||[])]):s.apply(a,[e.error])},function(e){s.apply(a,[e])})},teasp.action.contact.saveEmpWork=function(t,a,o,s,i){teasp.action.contact.remoteMethod("saveEmpWork",t,function(e){
"OK"==e.result?(e.lastModifiedDate&&a.setLastModifiedDate(e.lastModifiedDate),a.setKeyObj("jobAssigns",teasp.logic.convert.convJobAssignObjs(e.jobAssign||[])),a.replaceWorks(t.startDate,teasp.logic.convert.convWorkObjs(e.empWorks||[])),a.replaceWorkNote(t.startDate,t.workNote),s.apply(o,[!0])):i.apply(o,[e.error])},function(e){i.apply(o,[e])})},teasp.action.contact.saveEmpWorkOption=function(t,e,a,o,s){
teasp.action.contact.remoteMethod("saveEmpWorkOption",t,function(e){"OK"==e.result?o.apply(a,[!0,t,e]):s.apply(a,[e.error])},function(e){s.apply(a,[e])})},teasp.action.contact.submitJobApply=function(t,a,o,s,i){teasp.action.contact.remoteMethod("submitJobApply",t,function(e){"OK"==e.result?teasp.action.contact.transJobMonth(t,a,o,s,i):i.apply(o,[e.error])},function(e){i.apply(o,[e])})},
teasp.action.contact.cancelJobApply=function(e,t,a,o,s){teasp.action.contact.remoteMethod("cancelJobApply",e,function(e){"OK"==e.result?(t.setKeyObj("jobApply",teasp.logic.convert.convJobApplyObj(e.jobApply||null)),o.apply(a,[!0])):s.apply(a,[e.error])},function(e){s.apply(a,[e])})},teasp.action.contact.getJobIdByNames=function(e,t,a,o,s){teasp.action.contact.remoteMethod("getJobIdByNames",[e],function(e){
teasp.logic.convert.excludeNameSpace(e),o.apply(a,[!0,e])},function(e){s.apply(a,[e])})},teasp.action.contact.loadEMEmployee=function(e,o,s,i,n){var r={params:e};teasp.action.contact.remoteMethod("loadEMEmployee",[e.empId||""],function(e){var t,a;"OK"==e.result?(o.setKeyObj("EMEmployee",teasp.logic.convert.convEmployeeMaster(e.employee)),a=t=null,1==e.targetEmp.length?(a=e.targetEmp[0],t=e.targetEmp[0]
):1<e.targetEmp.length&&(a=e.targetEmp[teasp.util.equalId(e.targetEmp[0].Id,r.params.empId)?0:1],t=e.targetEmp[teasp.util.equalId(e.targetEmp[0].Id,r.params.empId)?1:0]),o.setKeyObj("sessionInfo",teasp.logic.convert.convSessionInfoObj(t,a,e.rights)),o.setKeyObj("targetEmp",teasp.logic.convert.convTargetEmpObj(a,r.params.mode)),o.setKeyObj("common",teasp.logic.convert.convCommonObj(e.common,e.borderRevNo)),i.apply(s,[
!0])):n.apply(s,[e.error])},function(e){n.apply(s,[e])})},teasp.action.contact.getRequestList=function(e,t,a,o,s){teasp.action.contact.remoteMethod("getRequestList",[],function(e){var t;"OK"==e.result?(t=teasp.logic.convert.convRequestList(e.requests),o.apply(a,[!0,t])):s.apply(a,[e.error])},function(e){s.apply(a,[e])})},teasp.action.contact.getEmployeeMaster=function(e,t,a,o,s){teasp.action.contact.remoteMethod(
"getEmployeeMaster",e,function(e){var t;"OK"==e.result?(t={},teasp.logic.convert.excludeNameSpace(e),teasp.logic.convert.excludeTSEMNameSpace(e),t.request=e.request,t.events=e.events,t.setting=e.setting,o.apply(a,[!0,t])):s.apply(a,[e.error])},function(e){s.apply(a,[e])})},teasp.action.contact.executeChangeRequest=function(e,t,a,o,s){e=dojo.clone(e);teasp.action.contact.remoteMethod("executeChangeRequest",e,function(
e){"OK"==e.result?o.apply(a,[!0,e]):s.apply(a,[e.error])},function(e){s.apply(a,[e])})},teasp.action.contact.executeAPIChangeRequest=function(e,t,a,o,s){e=dojo.clone(e);teasp.action.contact.remoteMethod("executeAPIChangeRequest",e,function(e){"OK"==e.result?o.apply(a,[!0,e]):s.apply(a,[e.error])},function(e){s.apply(a,[e])})},teasp.action.contact.loadHRMEmployee=function(e,o,s,i,n){var r={params:e};
teasp.action.contact.remoteMethod("loadHRMEmployee",[e.empId||""],function(e){var t,a;"OK"==e.result?(o.setKeyObj("HRMEmployee",teasp.logic.convert.convEmployeeMaster(e.employee)),o.setKeyObj("EMEmployee",teasp.logic.convert.convEmployeeMaster(e.employee)),a=t=null,1==e.targetEmp.length?(a=e.targetEmp[0],t=e.targetEmp[0]):1<e.targetEmp.length&&(a=e.targetEmp[teasp.util.equalId(e.targetEmp[0].Id,r.params.empId)?0:1],
t=e.targetEmp[teasp.util.equalId(e.targetEmp[0].Id,r.params.empId)?1:0]),o.setKeyObj("sessionInfo",teasp.logic.convert.convSessionInfoObj(t,a,e.rights)),o.setKeyObj("targetEmp",teasp.logic.convert.convTargetEmpObj(a,r.params.mode)),o.setKeyObj("common",teasp.logic.convert.convCommonObj(e.common,e.borderRevNo)),i.apply(s,[!0])):n.apply(s,[e.error])},function(e){n.apply(s,[e])})},
teasp.action.contact.getHRMEmployeeMaster=function(e,t,a,o,s){teasp.action.contact.remoteMethod("getHRMEmployeeMaster",e,function(e){var t;"OK"==e.result?(t={},teasp.logic.convert.excludeNameSpace(e),teasp.logic.convert.excludeTSEMNameSpace(e),t.request=e.request,t.events=e.events,t.setting=e.setting,t.pickList=e.pickList,t.fieldSetting=e.fieldSetting,o.apply(a,[!0,t])):s.apply(a,[e.error])},function(e){s.apply(a,[e]
)})},teasp.action.contact.getHRMRequestList=function(e,t,a,o,s){teasp.action.contact.remoteMethod("getHRMRequestList",[],function(e){var t;"OK"==e.result?(t=teasp.logic.convert.convRequestList(e.requests),o.apply(a,[!0,t])):s.apply(a,[e.error])},function(e){s.apply(a,[e])})},teasp.action.contact.loadHRMGuide=function(e,o,s,i,n){var r={params:e};teasp.action.contact.remoteMethod("loadHRMGuide",[e.empId||""],function(e
){var t,a;"OK"==e.result?(t=a=null,1==e.targetEmp.length?(t=e.targetEmp[0],a=e.targetEmp[0]):1<e.targetEmp.length&&(t=e.targetEmp[teasp.util.equalId(e.targetEmp[0].Id,r.params.empId)?0:1],a=e.targetEmp[teasp.util.equalId(e.targetEmp[0].Id,r.params.empId)?1:0]),o.setKeyObj("sessionInfo",teasp.logic.convert.convSessionInfoObj(a,t,e.rights)),o.setKeyObj("targetEmp",teasp.logic.convert.convTargetEmpObj(t,r.params.mode)),
o.setKeyObj("common",teasp.logic.convert.convCommonObj(e.common,e.borderRevNo)),(a={}).naviGroups=e.naviGroups,i.apply(s,[!0,a])):n.apply(s,[e.error])},function(e){n.apply(s,[e])})},teasp.action.contact.loadHRMNaviEvents=function(e,t,a,o,s){teasp.action.contact.remoteMethod("loadHRMNaviEvents",[e],function(e){var t;"OK"==e.result?((t={}).naviEvents=e.naviEvents,o.apply(a,[!0,t])):s.apply(a,[e.error])},function(e){
s.apply(a,[e])})},teasp.action.contact.saveAnswersHRMGuide=function(e,t,a,o,s){teasp.action.contact.remoteMethod("saveAnswersHRMGuide",dojo.toJson(e),function(e){retMap={},"OK"==e.result?(retMap.submissions=e.submissions,o.apply(a,[!0,retMap])):s.apply(a,[e.error])},function(e){s.apply(a,[e])})},teasp.action.Manager.prototype.request=function(t,e,a,o,s,i,n,r){var l=0,p=(
this.option.debugLev>=teasp.constant.LEVEL_WARN&&(console.log("----------------------------------------"),console.log("request ["+t+"]"),console.log(e?dojo.toJson(e):"** no params **"),console.log("----------------------------------------")),this.uiBlock(!0,o),this);teasp.action.contact[t](e,a,s,function(){var e=Array.prototype.shift;p.completeFlag=e.apply(arguments),console.log(
"request ["+t+"] success!, completeFlag="+p.completeFlag),p.uiBlock(!1,o),0==l++?s?i.apply(s,arguments):i(arguments[0]):r&&(s?r.apply(s,arguments):r(arguments[0]))},function(){p.completeFlag=!0,console.log("request ["+t+"] failed!"),p.uiBlock(!1,o),p.option.debugLev>=teasp.constant.LEVEL_ERROR&&console.log(dojo.toJson(arguments[0])),0==l++&&(s?n.apply(s,arguments):n(arguments[0]))})},
teasp.action.Manager.prototype.recalcOneDay=function(e,t){return teasp.action.contact.recalcOneDay(e,t)},teasp.action.Manager.prototype.getApplySelect=function(e,t,a){return this.applySelect||(this.applySelect=new teasp.dialog.ApplySelect),this.applySelect.setEvent(e,t,a),this.applySelect},teasp.action.Manager.prototype.testInit=function(e){this.utilTest=new teasp.util.Test,this.utilTest.init(e)},
teasp.action.Manager.prototype.testReset=function(){this.utilTest&&this.utilTest.reset()},teasp.action.Manager.prototype.testSeed=function(e){this.utilTest&&this.utilTest.addSeed(e)},teasp.action.Manager.prototype.testSignal=function(e){this.utilTest&&this.utilTest.signal(e)},teasp.provide("teasp.dialog.ApplyComment"),teasp.dialog.ApplyComment=function(){this.title=teasp.message.getLabel("applyx_btn_title"),
this.id="applyCommentDialog",this.duration=1,
this.content='<table class="pane_table" id="applyCommentTable"><tr><td style="vertical-align:top;text-align:left;"><div id="applyCommentDescript" style="margin:0px 2px 8px 4px;"></div></td></tr><tr id="applyCommentWarningRow" style="display:none;"><td style="vertical-align:top;text-align:left;"><div id="applyCommentWarning" style="margin:0px 8px 8px 4px;color:red;"></div></td></tr><tr id="applyApproverRow"><td style="vertical-align:top;text-align:left;"><div id="applyApproverLabel" style="margin:2px 16px 2px 4px;float:left;font-weight:bold;"></div><div id="applyApproverName" style="margin:2px;float:left;width:240px;"></div><div style="margin:2px;float:left;"><a id="applyApproverReload" style="margin-left:8px;vertical-align:bottom;color:#000080;text-decoration:underline;cursor:pointer;"></a></div><div id="applyApproverSetLinkArea" style="margin:2px;float:left;" class="normal-width"><a id="applyApproverSetLink" style="margin-left:8px;vertical-align:bottom;color:#000080;text-decoration:underline;cursor:pointer;"></a></div><div style="clear:both;"></div></td></tr><tr><td style="vertical-align:top;text-align:left;"><div id="applyCommentLabel" style="margin:4px;font-weight:bold;"></div></td></tr><tr><td style="vertical-align:top;text-align:center;"><textarea name="applyCommentText" id="applyCommentText" style="width:97%;height:80px;" class="inputran" maxLength="255"></textarea></td></tr><tr id="applyCommentErrorRow" style="display:none;"><td style="vertical-align:top;text-align:center;color:red;"><div id="applyCommentError"></div></td></tr><tr class="ts-buttons-row"><td style="text-align:center;padding-top:10px;"><div><button class="std-button1" style="margin-right:10px;" id="applyCommentOk" ><div></div></button><button class="std-button2" style="margin-left:10px;" id="applyCommentCancel" ><div></div></button></div></td></tr></table>'
,this.approverType=null,this.okLink={id:"applyCommentOk",callback:this.ok},this.cancelLink={id:"applyCommentCancel",callback:this.hide}},teasp.dialog.ApplyComment.prototype=new teasp.dialog.Base,teasp.dialog.ApplyComment.prototype.preStart=function(){dojo.byId("applyCommentOk").firstChild.innerHTML=teasp.message.getLabel("apply_btn_title"),dojo.byId("applyCommentCancel").firstChild.innerHTML=teasp.message.getLabel(
"cancel_btn_title"),dojo.connect(dojo.byId("applyApproverReload"),"onclick",this,this.reloadApproverSet),dojo.connect(dojo.byId("applyApproverSetLink"),"onclick",this,this.openApproverSet)},teasp.dialog.ApplyComment.prototype.ready=function(){
this.args.applyKey==teasp.constant.APPLY_KEY_JOBAPPLY?this.approverType=teasp.constant.APPROVER_TYPE_JOB:this.args.applyKey==teasp.constant.APPLY_KEY_EXPAPPLY?this.approverType=teasp.constant.APPROVER_TYPE_EXP:this.approverType=teasp.constant.APPROVER_TYPE_MONTH},teasp.dialog.ApplyComment.prototype.preShow=function(){dojo.style("applyCommentTable","width",teasp.isNarrow()?"100%":"520px"),dojo.byId(
"applyCommentDialog_title").innerHTML=this.args.title,dojo.byId("applyCommentDescript").innerHTML=this.args.descript,dojo.byId("applyCommentText").value="",!this.args.deptFixMode&&this.pouch.isUseApproverSet(this.args.applyKey)?(dojo.style("applyApproverRow","display",""),dojo.byId("applyApproverLabel").innerHTML=teasp.message.getLabel("tk10000071"),dojo.byId("applyApproverName"
).innerHTML=this.pouch.getApproverSetName(this.approverType),dojo.byId("applyApproverReload").innerHTML=teasp.message.getLabel("tk10004000"),dojo.byId("applyApproverSetLink").innerHTML=teasp.message.getLabel("tk10004010")):dojo.style("applyApproverRow","display","none"),teasp.isMobile()&&dojo.style("applyApproverSetLinkArea","display","none");
var e=this.args.applyKey==teasp.constant.APPLY_KEY_EXPAPPLY?"apply_btn_title":"applyx_btn_title";return dojo.byId("applyCommentOk").firstChild.innerHTML=teasp.message.getLabel(this.args.buttonType?"fix_btn_title":e),dojo.byId("applyCommentLabel").innerHTML=teasp.message.getLabel("comment_head"),this.showError(null),dojo.byId("applyCommentWarning").innerHTML=this.args.warning||"",dojo.style("applyCommentWarningRow",
"display",this.args.warning?"":"none"),teasp.isSforce1()&&dojo.query(".normal-width",this.dialog.domNode).forEach(function(e){dojo.style(e,"display","none")}),!0},teasp.dialog.ApplyComment.prototype.reloadApproverSet=function(){teasp.manager.request("getAtkApproverSet",{action:"getAtkApproverSet",empId:this.pouch.getEmpId(),type:this.approverType},this.pouch,{hideBusy:!1},this,function(){dojo.byId("applyApproverName"
).innerHTML=this.pouch.getApproverSetName(this.approverType)},function(e){teasp.message.alertError(e)})},teasp.dialog.ApplyComment.prototype.openApproverSet=function(){var e=this.pouch.getApproverSetId(this.approverType);if(e)return window.open("/"+e+"/e","_blank"),!1;teasp.manager.request("getAtkApproverSet",{action:"getAtkApproverSet",empId:this.pouch.getEmpId(),type:this.approverType},this.pouch,{hideBusy:!1},this
,function(){return e=this.pouch.getApproverSetId(this.approverType),window.open("/"+e+"/e","_blank"),!1},function(e){teasp.message.alertError(e)})},teasp.dialog.ApplyComment.prototype.ok=function(){var e=dojo.byId("applyCommentText").value||null;this.pouch.isRequireNote(this.args.applyKey)&&!e?this.showError(teasp.message.getLabel("tm10003820")):(this.hide(),this.onfinishfunc({comment:e,targets:this.args.targets,
ringiId:null}))},teasp.dialog.ApplyComment.prototype.showError=function(e){dojo.style("applyCommentErrorRow","display",e?"":"none"),dojo.byId("applyCommentError").innerHTML=e?e.entitize():""},teasp.provide("teasp.dialog.Approval"),teasp.dialog.Approval=function(){this.title=teasp.message.getLabel("tm30004020"),this.duration=1,this.id="dialogApproval",
this.content='<table class="approval_table" id="approvalCommentTable"><tbody><tr><td style="vertical-align:top;text-align:left;"><div id="approvalCommentLabel" style="margin:4px;"></div></td></tr><tr><td style="vertical-align:top;text-align:center;"><textarea id="approvalComment" style="width:97%;height:80px;" maxlength="1000" class="inputran"></textarea></td></tr><tr><td style="text-align:center;padding-top:10px;"><table style="margin-left:auto;margin-right:auto;"><tbody><tr><td><button class="std-button1" id="approvalOk" style="margin:2px 12px;"><div></div></button></td><td><button class="red-button1" id="approvalReject" style="margin:2px 12px;"><div></div></button></td><td><button class="std-button2" id="approvalCancel" style="margin:2px 12px;"><div></div></button></td></tr></tbody></table></td></tr></tbody></table>'
,this.okLink={id:"approvalOk",callback:function(){this.ok(!0)}},this.cancelLink={id:"approvalCancel",callback:this.hide},this.ids=[]},teasp.dialog.Approval.prototype=new teasp.dialog.Base,teasp.dialog.Approval.prototype.preStart=function(){teasp.message.setLabelHtml("approvalCommentLabel","comment_head"),dojo.byId("approvalOk").firstChild.innerHTML=teasp.message.getLabel("tm30004010"),dojo.byId("approvalReject"
).firstChild.innerHTML=teasp.message.getLabel("tm10003490"),dojo.byId("approvalCancel").firstChild.innerHTML=teasp.message.getLabel("close_btn_title"),dojo.connect(dojo.byId("approvalReject"),"onclick",this,function(){this.ok(!1)})},teasp.dialog.Approval.prototype.preShow=function(){return this.ids=this.args.apply||[{id:this.args.id}],dojo.byId("approvalComment").value="",dojo.byId("approvalOk"
).firstChild.innerHTML=teasp.message.getLabel(this.args.isCancelApply?"tf10006260":"tm30004010"),dojo.byId("approvalReject").firstChild.innerHTML=teasp.message.getLabel(this.args.isCancelApply?"tf10006270":"tm10003490"),dojo.query(".dijitDialogTitleBar","dialogApproval").forEach(function(e){e.style.backgroundColor="#88CB7F"}),dojo.style("approvalCommentTable","width",teasp.isNarrow()?"100%":"500px"),!0},
teasp.dialog.Approval.prototype.ok=function(e){var t=dojo.byId("approvalComment").value||null,a=dojo.hitch(this,function(){this.close(),this.onfinishfunc()});teasp.manager.dialogOpen("BusyWait"),teasp.manager.request("empExpApproval",{comment:t,apply:[this.ids],approve:e,objKey:this.args.objKey,refresh:this.args.refresh},this.pouch,{hideBusy:!0},this,function(){teasp.manager.dialogClose("BusyWait"),setTimeout(a,100)}
,function(e){teasp.manager.dialogClose("BusyWait"),teasp.message.alertError(e)})},teasp.provide("teasp.dialog.JobSelect"),teasp.dialog.JobSelect=function(){this.id="dialogJobSelect",this.title=teasp.message.getLabel("tm20004810"),this.duration=1,this.widthHint=600,this.heightHint=300,
this.content='<table border="0" cellpadding="0" cellspacing="0" style="font-size:12px;"><tr><td style="padding: 1em 1em 2em 1em"><div id="_jobListCell"></div></td></tr><tr><td style="text-align:center;padding-top:0px;"><input type="button" class="pb_base pb_btn_cancel" id="_job_cancel" style="font-size:13px;padding:6px 16px;"/></td></tr></table>',this.cancelLink={id:"_job_cancel",callback:this.close},
this.eventHandles=[],this.busy=!1},teasp.dialog.JobSelect.prototype=new teasp.dialog.Base,teasp.dialog.JobSelect.prototype.preShow=function(){for(var e=0;e<this.eventHandles.length;e++)dojo.disconnect(this.eventHandles[e]),delete this.eventHandles[e];this.eventHandles=[],this.busy=!0,dojo.byId("_jobListCell").firstChild&&dojo.destroy(dojo.byId("_jobListCell").firstChild);var t=dojo.create("select",{style:{
width:"588px"},id:"_JobList"},dojo.byId("_jobListCell")),a=(this.pouch.isRequireExpLinkJob()||dojo.create("option",{value:"none",innerHTML:teasp.message.getLabel("tm20004010")},t),this.pouch.getJobWorks(this.pouch.getClassifyJobWorks(this.args.date),!0)),a=teasp.util.deleteHasSameJobId(a),o=this.pouch.getExpLogsJobs(this.args.date,a);a=(a=0<o.length?a.concat(o):a).sort(function(e,t){
return e.jobCode<t.jobCode?-1:e.jobCode>t.jobCode?1:0});for(e=0;e<a.length;e++){var s=a[e];dojo.create("option",{value:s.jobId,innerHTML:s.jobCode+"  "+s.jobName},t)}return t.value=this.args.jobId,this.eventHandles.push(dojo.connect(t,"onchange",this,this.changedJob)),teasp.message.setLabelTitle("_job_cancel","cancel_btn_title"),this.dialog.startup(),!(this.busy=!1)},
teasp.dialog.JobSelect.prototype.changedJob=function(e){this.busy||((e=(e=e.target)[e.selectedIndex]).value==this.args.jobId?alert(teasp.message.getLabel("tm20004820")):confirm(teasp.message.getLabel("tm20004830",this.args.targetNumbers,e.innerHTML))&&(this.dialog.hide(),this.onfinishfunc(e.value)))},teasp.provide("teasp.dialog.EditTime"),teasp.dialog.EditTime=function(){this.title=teasp.message.getLabel(
"restAwayEdit_caption"),this.id="editTimeDialog",this.duration=1,this.widthHint=620,this.heightHint=260,
this.content='<table class="pane_table" id="editTimeArea" width="600px"><tr><td colSpan="2" style="padding-bottom:4px;" width="600px"><table class="pane_table"><tr><td style="padding-left:4px;white-space:nowrap;"><span id="dlgEditTimeDate"></span></td><td style="padding-left:4px;" width="400px"><span id="dlgEditTimeEvent" style="word-break:break-all;"></span></td></tr></table></td></tr><tr><td colSpan="2" style="border:1px solid #78A8B6;" width="600px"><div id="editTimeView" class="overx_scr rel_div" width="600px" height="143px"><table id="editTable" class="pane_table editTable" style="width:2352px;"><thead><tr><th>0</th><th>1</th><th>2</th><th>3</th><th>4</th><th>5</th><th>6</th><th>7</th><th>8</th><th>9</th><th>10</th><th>11</th><th>12</th><th>13</th><th>14</th><th>15</th><th>16</th><th>17</th><th>18</th><th>19</th><th>20</th><th>21</th><th>22</th><th>23</th><th>24</th><th>25</th><th>26</th><th>27</th><th>28</th><th>29</th><th>30</th><th>31</th><th>32</th><th>33</th><th>34</th><th>35</th><th>36</th><th>37</th><th>38</th><th>39</th><th>40</th><th>41</th><th>42</th><th>43</th><th>44</th><th>45</th><th>46</th><th>47</th><th>48</th></tr></thead><tbody><tr><td colSpan="49"></td></tr></tbody></table><div id="movetime" style="display:none;"><table class="movearea"><tr><td style="text-align:left;"><span id="movec1"></span></td></tr><tr><td style="text-align:center;"><span id="movev1"></span>-<span id="movev2"></span></td></tr></table></div></div></td></tr><tr id="dlgEditTimeErrorRow"><td colSpan="2" style="text-align:center;" width="600px"><span id="dlgEditTimeError" style="color:red;padding-top:2px;"></span></td></tr><tr id="dlgEditTimeCtrl1" class="ts-buttons-row"><td colSpan="2" style="text-align:center;padding-top:10px;padding-bottom:8px;" width="600px"><div><button class="std-button1" id="dlgEditTimeOk" ><div></div></button><button class="std-button2" id="dlgEditTimeCancel" ><div></div></button></div></td></tr><tr id="dlgEditTimeCtrl2" style="display:none;" class="ts-buttons-row"><td colSpan="2" style="text-align:center;padding-top:10px;padding-bottom:8px;" width="600px"><div><button class="std-button2" id="dlgEditTimeClose" ><div></div></button></div></td></tr></table>'
,this.okLink={id:"dlgEditTimeOk",callback:this.ok},this.cancelLink={id:"dlgEditTimeCancel",callback:this.close},this.closeLink={id:"dlgEditTimeClose",callback:this.close},this.timerId=null,this.fired=!1,this.graph=null,this.dayWrap=null,this.pattern=null},teasp.dialog.EditTime.prototype=new teasp.dialog.Base,teasp.dialog.EditTime.prototype.ready=function(){this.dayWrap=this.pouch.getEmpDay(this.args.date),
this.pattern=this.dayWrap.getPattern()},teasp.dialog.EditTime.prototype.preShow=function(){this.showError(null),dojo.byId("dlgEditTimeDate").innerHTML=teasp.util.date.formatDate(this.args.date,"JP1"),dojo.byId("dlgEditTimeEvent").innerHTML=this.dayWrap.getCalendarEvent();var e=this.pouch.getTimeFormObj();return this.graph?this.graph.setParam({readOnly:this.isReadOnly()||!this.pouch.isUpdater(),
restFix:this.pouch.isUseReviseTimeApply()||3==this.dayWrap.getInputLimit().flag}):this.graph=new teasp.helper.Graph({widthPerH:48,marginLeft:24,startY:48,sizeType:"large",edgeMark:!0,movable:!0,timeRound:e.round,hideTimeGraphPopup:this.pouch.isHideTimeGraphPopup(),readOnly:this.isReadOnly()||!this.pouch.isUpdater(),restFix:this.pouch.isUseReviseTimeApply()||3==this.dayWrap.getInputLimit().flag}),this.graph.clear(),
this.graph.draw(this.pouch,"editTimeView",[this.dayWrap.getObj()]),dojo.style("dlgEditTimeCtrl1","display",this.isReadOnly()?"none":""),dojo.style("dlgEditTimeCtrl2","display",this.isReadOnly()?"":"none"),dojo.byId("dlgEditTimeOk").firstChild.innerHTML=teasp.message.getLabel("save_btn_title"),dojo.byId("dlgEditTimeCancel").firstChild.innerHTML=teasp.message.getLabel("cancel_btn_title"),dojo.byId("dlgEditTimeClose"
).firstChild.innerHTML=teasp.message.getLabel("close_btn_title"),this.orgHolidayTime=this.dayWrap.getTimeHolidayTime(this.dayWrap.getTimeTable()),!0},teasp.dialog.EditTime.prototype.postShow=function(){dojo.byId("editTimeView").scrollLeft=400},teasp.dialog.EditTime.prototype.cancel=function(){this.hide()},teasp.dialog.EditTime.prototype.ok=function(){for(var e=this.graph.getDayObj(),t=(this.showError(null),
e.startTime),a=e.endTime,o=[],s=this.graph.getAways(),i=this.graph.getRests(),n=0;n<i.length;n++)this.dayWrap.mergeRests(o,i[n]);var o=(o=o.concat(e.rack.hourRests)).sort(function(e,t){return("number"==typeof e.from?e.from:e.to)-("number"==typeof t.from?t.from:t.to)}),s=s.sort(function(e,t){return("number"==typeof e.from?e.from:e.to)-("number"==typeof t.from?t.from:t.to)}),r=this.pouch.isKeepExteriorTime(),
s=checkTimes(o,s,this.getFixRests(),t,a,r);if(s.message)this.showError(s.message);else if(r||!s.over||confirm(teasp.message.getLabel("tm10004010"))){r=this.dayWrap.getTimeHolidayTime(s.timeTable);if(this.orgHolidayTime!=r)this.showError(teasp.message.getLabel("tk10005110"));else if(this.pouch.isProhibitBorderRestTime()&&teasp.logic.EmpTime.checkBorderRestTime(s.startTime,s.endTime,s.timeTable))this.showError(
teasp.message.getLabel("tf10008400"));else{if(this.pouch.isValidRestTimeCheck()){var l=teasp.logic.EmpTime.getWorkAndRestTime(this.pouch.getObj(),this.dayWrap.getKey(),t,a,s.rests);if(0<l.workTime){var p=this.pouch.getRestTimeCheck(),d=0;if(p&&is_array(p))for(n=0;n<p.length;n++){var c=p[n];if(c.check&&l.workTime>c.workTime&&l.restTime<c.restTime){d=c.push?2:1;break}}if(d)if(2==d)alert(teasp.message.getLabel(
"tm10002121"));else if(!confirm(teasp.message.getLabel("tm10002120")))return}}teasp.manager.request("inputTimeTable",{empId:this.pouch.getEmpId(),month:this.pouch.getYearMonth(),startDate:this.pouch.getStartDate(),lastModifiedDate:this.pouch.getLastModifiedDate(),date:e.date,refreshWork:this.pouch.isInputWorkingTimeOnWorkTImeView(),timeTable:[{from:"number"==typeof s.startTime?s.startTime:null,
to:"number"==typeof s.endTime?s.endTime:null,type:1}].concat(s.timeTable)},this.pouch,{hideBusy:!1},this,function(){this.onfinishfunc(),this.hide()},function(e){this.showError(teasp.message.getErrorMessage(e))})}}},teasp.dialog.EditTime.prototype.isReadOnly=function(){return!0},teasp.dialog.EditTime.prototype.showError=function(e){dojo.style("dlgEditTimeErrorRow","display",e?"":"none"),dojo.byId("dlgEditTimeError"
).innerHTML=e?e.entitize():""},teasp.dialog.EditTime.prototype.getFixRests=function(){var e=[];if(this.pattern)for(var t=0;t<this.pattern.restTimes.length;t++){var a=this.pattern.restTimes[t];e.push(a)}return e=0<e.length?e.sort(function(e,t){return("number"==typeof e.from?e.from:e.to)-("number"==typeof t.from?t.from:t.to)}):e},teasp.provide("teasp.dialog.EkitanOption"),teasp.dialog.EkitanOption=function(){
this.widthHint=680,this.heightHint=290,this.id="dialogEkitanSetting",this.title=teasp.message.getLabel("ekitanSetting_btn_title"),this.duration=1,
this.content='<div class="dlg_content" style="width:650px;"><table class="ts_a_frame"><tr><td class="edgelt"></td><td class="edgeht"></td><td class="edgert"></td></tr><tr><td class="edgevl"></td><td><div class="edge_div"><table class="stand_table"><tr><td class="left_m" id="area_label"></td><td class="right"><select class="inputran" id="ekitanOptionArea"></select></td></tr><tr><td class="left_m top_line" id="ekitanOpt_paidExpress_label"></td><td class="right top_line"><table class="ekitan_option_tbl"><tr><td><label><input type="radio" name="ekitanOptionPE" value="1" id="ekitanOptionPE1" /><span id="ekitanOpt_yes"></span></label></td><td style="padding-left:12px;"><label><input type="radio" name="ekitanOptionPE" value="0" id="ekitanOptionPE0" /><span id="ekitanOpt_no"></span></label></td></tr></table></td></tr><tr><td class="left_m top_line" id="ekitanOpt_reservedSheet_label"></td><td class="right top_line"><table class="ekitan_option_tbl"><tr><td><label><input type="radio" name="ekitanOptionRS" value="0" id="ekitanOptionRS0" /><span id="ekitanOpt_reservedSheetNo_label"></span></label></td><td style="padding-left:12px;"><label><input type="radio" name="ekitanOptionRS" value="1" id="ekitanOptionRS1" /><span id="ekitanOpt_reservedSheetYes_label"></span></label></td></tr></table></td></tr><tr><td class="left_m top_line" id="ekitanOpt_preferredAirLine_label"></td><td class="right top_line"><table class="ekitan_option_tbl"><tr><td><label><input type="radio" name="ekitanOptionAL" value="0" id="ekitanOptionAL0" /><span id="ekitanOpt_preferredAirLineNo_label"></span></label></td><td style="padding-left:12px;"><label><input type="radio" name="ekitanOptionAL" value="1" id="ekitanOptionAL1" />JAL</label></td><td style="padding-left:12px;"><label><input type="radio" name="ekitanOptionAL" value="2" id="ekitanOptionAL2" />ANA</label></td><td style="padding-left:12px;"><label><input type="radio" name="ekitanOptionAL" value="4" id="ekitanOptionAL4" />SKY/ADO</label></td></tr></table></td></tr><tr><td class="left_m top_line" id="ekitanOpt_routePreference_label"></td><td class="right top_line"><select class="inputran" id="ekitanOptionSort"><option value="0" id="routeSortTime_opt"></option><option value="1" id="routeSortCost_opt"></option><option value="2" id="routeSortChange_opt"></option><option value="3" id="routeSortCommuter_opt"></option></select></td></tr><tr><td class="left_m top_line" id="ekitanOpt_excludeCommuter_label"></td><td class="right top_line"><table class="ekitan_option_tbl"><tr><td><label><input type="radio" name="ekitanOptionTT" value="0" id="ekitanOptionTT0" /><span id="ekitanOpt_excludeCommuterNo_label"></span></label></td><td style="padding-left:12px;"><label><input type="radio" name="ekitanOptionTT" value="1" id="ekitanOptionTT1" /><span id="ekitanOpt_excludeCommuterYes_label"></span></label></td></tr></table></td></tr><tr><td class="left_m" id="ekitanOpt_commuterRoute_label"></td><td class="right"><table class="ekitan_option_tbl"><tr><td style="white-space:normal;"><div style="width:200px;" id="ekitanOptionCommuterNote"></div><input type="hidden" name="" value="" id="ekitanOptionCommuterCode" /><input type="hidden" name="" value="" id="ekitanOptionCommuterText" /></td></td><td><input type="button" class="pb_base pb_btn_change commuter_route" id="ekitanOptionRouteChange" /><input type="button" class="pb_base pb_btn_clear"  id="ekitanOptionRouteClear" style="margin-left:10px;" /></td></tr><tr id="ekitanOptionCommuterWarnRow" style="display:none;"><td colSpan="2" style="text-align:left;"><div style="color:red;font-size:0.9em;margin-top:4px;white-space:normal;" id="ekitanOptionCommuterWarn"></div></td></tr></table></td></tr></table></div></td><td class="edgevr"></td></tr><tr><td class="edgelb"></td><td class="edgehb"></td><td class="edgerb"></td></tr></table><table border="0" cellpadding="0" cellspacing="0" style="width:100%;"><tr><td colspan="2" style="padding:16px 0px 4px 0px;text-align:center;"><input type="button" class="pb_base  pb_btn_regist"  id="ekitanOptionOk" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<input type="button"  class="pb_base pb_btn_cancel" id="ekitanOptionCancel" /></td></tr></table></div>'
,this.okLink={id:"ekitanOptionOk",callback:this.ok},this.cancelLink={id:"ekitanOptionCancel",callback:this.hide}},teasp.dialog.EkitanOption.prototype=new teasp.dialog.Base,teasp.dialog.EkitanOption.prototype.preStart=function(){teasp.message.setLabelHtml("area_label"),teasp.message.setLabelHtml("ekitanOpt_paidExpress_label","paidExpress_label"),teasp.message.setLabelHtml("ekitanOpt_yes","paidExpressYes_label"),
teasp.message.setLabelHtml("ekitanOpt_no","paidExpressNo_label"),teasp.message.setLabelHtml("ekitanOpt_reservedSheet_label","reservedSheet_label"),teasp.message.setLabelHtml("ekitanOpt_reservedSheetNo_label","reservedSheetNo_label"),teasp.message.setLabelHtml("ekitanOpt_reservedSheetYes_label","reservedSheetYes_label"),teasp.message.setLabelHtml("ekitanOpt_preferredAirLine_label","preferredAirLine_label"),
teasp.message.setLabelHtml("ekitanOpt_preferredAirLineNo_label","preferredAirLineNo_label"),teasp.message.setLabelHtml("ekitanOpt_routePreference_label","routePreference_label"),teasp.message.setLabelHtml("routeSortTime_opt","routeSortTime_label"),teasp.message.setLabelHtml("routeSortCost_opt","routeSortCost_label"),teasp.message.setLabelHtml("routeSortChange_opt","routeSortChange_label"),teasp.message.setLabelHtml(
"routeSortCommuter_opt","routeSortCommuter_label"),teasp.message.setLabelHtml("ekitanOpt_excludeCommuter_label","excludeCommuter_label"),teasp.message.setLabelHtml("ekitanOpt_excludeCommuterNo_label","excludeCommuterNo_label"),teasp.message.setLabelHtml("ekitanOpt_excludeCommuterYes_label","excludeCommuterYes_label"),teasp.message.setLabelHtml("ekitanOpt_commuterRoute_label","commuterRoute_label"),
teasp.message.setLabelTitle("ekitanOptionRouteChange","change_btn_title"),teasp.message.setLabelTitle("ekitanOptionOk","save_btn_title"),teasp.message.setLabelTitle("ekitanOptionCancel","cancel_btn_title");for(var e=dojo.byId("ekitanOptionArea"),t=teasp.constant.getEkitanAreas(),a=0;a<t.length;a++)dojo.create("option",{value:""+t[a].areaNo,innerHTML:t[a].name},e);dojo.connect(dojo.byId("ekitanOptionRouteChange"),
"onclick",this,this.clickRouteChange),dojo.connect(dojo.byId("ekitanOptionRouteClear"),"onclick",this,this.clickRouteClear)},teasp.dialog.EkitanOption.prototype.preShow=function(){var e=(e=this.pouch.getExpConfig())||{preferredAirLine:0,routePreference:0,ekitanArea:this.pouch.getEkitanArea(),commuterRouteCode:"",useReservedSheet:!1,usePaidExpress:!1,commuterRouteNote:"",excludeCommuterRoute:!1,walkLimit:0},t=(
dojo.byId("ekitanOptionArea").value=""+("number"==typeof e.ekitanArea?e.ekitanArea:this.pouch.getEkitanArea()),dojo.byId("ekitanOptionPE1").checked=e.usePaidExpress||!1,dojo.byId("ekitanOptionPE0").checked=!e.usePaidExpress,dojo.byId("ekitanOptionRS0").checked=!e.useReservedSheet,dojo.byId("ekitanOptionRS1").checked=e.useReservedSheet||!1,dojo.byId("ekitanOptionAL0").checked=0==(e.preferredAirLine||0),dojo.byId(
"ekitanOptionAL1").checked=1==e.preferredAirLine,dojo.byId("ekitanOptionAL2").checked=2==e.preferredAirLine,dojo.byId("ekitanOptionAL4").checked=4==e.preferredAirLine,dojo.byId("ekitanOptionSort").value=""+(e.routePreference||0),e.commuterRouteNote||""),a=e.commuterRouteCode||"";return dojo.byId("ekitanOptionCommuterNote").innerHTML=this.pouch.getCommuterRouteNote(),dojo.byId("ekitanOptionCommuterText").value=t,
dojo.byId("ekitanOptionCommuterCode").value=a,dojo.style("ekitanOptionRouteClear","display",this.pouch.isCommuterRouteLock()||!t?"none":""),dojo.byId("ekitanOptionTT0").checked=!e.excludeCommuterRoute,dojo.byId("ekitanOptionTT1").checked=e.excludeCommuterRoute||!1,dojo.byId("ekitanOptionTT0").disabled=this.pouch.isCommuterRouteLock(),dojo.byId("ekitanOptionTT1").disabled=this.pouch.isCommuterRouteLock()||""!=t&&!a,
dojo.query(".commuter_route").forEach(function(e){dojo.style(e,"display",this.pouch.isCommuterRouteLock()?"none":"")},this),dojo.byId("ekitanOptionCommuterWarn").innerHTML=teasp.message.getLabel("tk10005050"),dojo.style("ekitanOptionCommuterWarnRow","display",""==t||a?"none":""),!0},teasp.dialog.EkitanOption.prototype.clickRouteChange=function(){var e=null,t=null,a=null,o=dojo.byId("ekitanOptionCommuterText").value,
s=dojo.byId("ekitanOptionCommuterCode").value,o=/^(.+) ⇔ (.+?)(?:(?:［)(.+)(?:経由］))?$/.exec(o),o=(o&&(e=o[1],t=o[2],a=o[3]),{empId:this.pouch.getEmpId(),date:this.pouch.getToday(),storeSt:this.args.storeSt,storeStFunc:null,roundTrip:!0,readonly:!1,fixed:!1,commuter:!0,from:e,to:t,via:a,commuterCode:s});teasp.manager.dialogOpen("ExpSearch",o,this.pouch,this,function(e){var t=e.route.commuterCode,
e=teasp.util.createCommuterSimpleRoute(e.searchKey);dojo.byId("ekitanOptionCommuterCode").value=t,dojo.byId("ekitanOptionCommuterText").value=e.value,dojo.byId("ekitanOptionCommuterNote").innerHTML=e.name,""==t?(dojo.byId("ekitanOptionTT0").checked=!0,dojo.byId("ekitanOptionTT1").disabled=!0,dojo.style("ekitanOptionCommuterWarnRow","display","")):(dojo.byId("ekitanOptionTT1").disabled=!1,dojo.byId("ekitanOptionTT1"
).checked=!0,dojo.style("ekitanOptionCommuterWarnRow","display","none")),dojo.style("ekitanOptionRouteClear","display","")})},teasp.dialog.EkitanOption.prototype.clickRouteClear=function(){confirm(teasp.message.getLabel("tk10003380"))&&(dojo.byId("ekitanOptionCommuterNote").innerHTML=teasp.message.getLabel("tm10003580"),dojo.byId("ekitanOptionCommuterText").value="",dojo.byId("ekitanOptionCommuterCode").value="",
dojo.byId("ekitanOptionTT1").disabled=!1,dojo.byId("ekitanOptionTT0").checked=!0,dojo.style("ekitanOptionRouteClear","display","none"),dojo.style("ekitanOptionCommuterWarnRow","display","none"))},teasp.dialog.EkitanOption.prototype.ok=function(){var t={};return t.ekitanArea=parseInt(dojo.byId("ekitanOptionArea").value,10),t.usePaidExpress=dojo.byId("ekitanOptionPE1").checked,t.useReservedSheet=dojo.byId(
"ekitanOptionRS1").checked,dojo.query('input[name="ekitanOptionAL"]').forEach(function(e){e.checked&&(t.preferredAirLine=parseInt(e.value,10))}),t.routePreference=parseInt(dojo.byId("ekitanOptionSort").value,10),t.commuterRouteCode=dojo.byId("ekitanOptionCommuterCode").value||"",t.commuterRouteNote=dojo.byId("ekitanOptionCommuterText").value||"",""==t.commuterRouteCode?(dojo.byId("ekitanOptionTT0").checked=!0,
t.excludeCommuterRoute=!1):t.excludeCommuterRoute=dojo.byId("ekitanOptionTT1").checked,teasp.manager.request("saveEmpExpConfig",{empId:this.pouch.getEmpId(),expConfig:t},this.pouch,{hideBusy:!1},this,function(e){this.pouch.setExpConfig(e.expConfig),this.pouch.setCommuterRouteNote(e.expConfig.commuterRouteNote||null),this.close()},function(e){teasp.message.alertError(e)}),!1},teasp.provide("teasp.dialog.EmpApply"),
teasp.dialog.EmpApply=function(){this.id="dialogApply",this.duration=1,
this.content='<table class="dialogApplyTable" id="dialogApplyTable"><tr><td><table id="dialogApplyTop"><tr><td style="width:20%;"><span id="dialogApplyDate"></span></td><td><span id="dialogApplyEvent" style="word-break:break-all;"></span></td></tr></table></td></tr><tr id="dialogApplyInputRow"><td id="empApplyTabArea"></td></tr><tr id="dialogApplyCloseRow" class="ts-buttons-row"><td><div><button id="dialogApplyClose" class="std-button2"><div></div></button></div></td></tr></table>'
,this.readOnlyCnt=0,this.contentSeq=0,this.holidayList=null,this.patternLList=null,this.patternSList=null,this.applyList=null,this.dayWrap=null,this.enableMap=null,this.daiqableMap=null,this.monthFix=!1,this.dayFix=!1,this.daiqZan=null,this.stockZan={},this.timeForm="hh:mm",this.newEntry={},this.appEntry={},this.client=null,this.eventHandles=[],this.valueWidth=Math.min(window.innerWidth-50,370)+"px",
this.applyHandle={},this.initParam()},teasp.dialog.EmpApply.prototype=new teasp.dialog.Base,teasp.dialog.EmpApply.prototype.initParam=function(){this.title=teasp.message.getLabel("dayApply_caption"),this.dialogManageKey="EmpApply",this.initHeight=300,this.applyMenus=["daily",null,"holiday","holidayWork","zangyo","earlyStart","exchange","shiftChange","patternS","patternL","lateStart","earlyEnd","direct","reviseTime"],
this.applyTypes={daily:{name:teasp.constant.APPLY_TYPE_DAILY,title:teasp.message.getLabel("applyDaily_label"),create:this.createDailyForm,descript:teasp.message.getLabel("tm10003375"),getMenuFlag:function(){var e;return this.pouch.isUseDailyApply()?(e=this.dayWrap.canSelectDailyEx(1)).flag||e.active?1:0:-1}},reviseTime:{name:teasp.constant.APPLY_TYPE_REVISETIME,title:teasp.message.getLabel("applyReviseTime_label"),
create:this.createReviseTimeForm,descript:teasp.message.getLabel("tm10003850"),getMenuFlag:function(){return this.pouch.isUseReviseTimeApply()?this.dayWrap.canSelectReviseTime()?1:0:-1}},holiday:{name:teasp.constant.APPLY_TYPE_HOLIDAY,title:teasp.message.getLabel("applyHoliday_label"),create:this.createHolidayForm,descript:teasp.message.getLabel("tm10003380"),getMenuFlag:function(){for(var e=!1,
t=0;t<this.holidayList.length;t++)if(this.holidayList[t].displayDaysOnCalendar){e=!0;break}return this.dayWrap.canSelectHoliday(e)&&0<this.holidayList.length?1:0}},holidayWork:{name:teasp.constant.APPLY_TYPE_KYUSHTU,title:teasp.message.getLabel("applyHolidayWork_label"),create:this.createHolidayWorkForm,descript:teasp.message.getLabel("tm10003390"),getMenuFlag:function(){return this.pouch.getUseHolidayWorkFlag(
)?this.dayWrap.canSelectKyushtu()?1:0:-1}},zangyo:{name:teasp.constant.APPLY_TYPE_ZANGYO,title:teasp.message.getLabel("applyZangyo_label"),create:this.createZangyoForm,descript:teasp.message.getLabel("tm10003400"),getMenuFlag:function(){return this.pouch.getUseOverTimeFlag()?this.dayWrap.canSelectZangyo()?1:0:-1}},earlyStart:{name:teasp.constant.APPLY_TYPE_EARLYSTART,title:teasp.message.getLabel(
"applyEarlyWork_label"),create:this.createEarlyStartForm,descript:teasp.message.getLabel("tm10003410"),getMenuFlag:function(){return this.pouch.getUseEarlyWorkFlag()?this.dayWrap.canSelectZangyo(!0)?1:0:-1}},exchange:{name:teasp.constant.APPLY_TYPE_EXCHANGE,title:teasp.message.getLabel("applyExchange_label"),create:this.createExchangeForm,descript:teasp.message.getLabel("tm10003420"),getMenuFlag:function(){
var e=this.pouch.getDateRangeOfMonth(this.args.date,2,-1);return this.pouch.isUseExchangeDate()?this.dayWrap.canSelectExchange()&&0<=teasp.util.date.compareDate(e.to,this.args.date)?1:0:-1}},shiftChange:{name:teasp.constant.APPLY_TYPE_SHIFTCHANGE,title:teasp.message.getLabel("tf10011260"),create:this.createShiftChangeForm,descript:teasp.message.getLabel("tf10011270"),getMenuFlag:function(){
return this.pouch.isUseShiftChange()?this.dayWrap.canSelectShiftChange(this.args.date)?1:0:-1}},patternS:{name:teasp.constant.APPLY_TYPE_PATTERNS,title:teasp.message.getLabel("applyPatternS_label"),create:this.createChangePatternForm,descript:teasp.message.getLabel("tm10003430"),getMenuFlag:function(){if(this.pouch.isUseChangePattern()){if(
this.patternSList.length<=0&&this.patternLList.length<=0&&!this.pouch.isChangeDayType())return 0;var e=this.dayWrap.getEmpApplyByKey(teasp.constant.APPLY_KEY_PATTERNS),t=this.dayWrap.getEmpApplyByKey(teasp.constant.APPLY_KEY_PATTERNL),a=this.dayWrap.getEmpApplyByKey(teasp.constant.APPLY_KEY_PATTERND);if(this.pouch.isProhibitWorkShiftChange()){if(e||t||a)return 0;if(!this.pouch.isChangeDayType(
)&&!this.pouch.isUseChangeShift())return 0;var o=this.dayWrap.getPattern();if(!(this.pouch.isChangeDayType()||o&&o.id))return 0}return this.pouch.isRegulateHoliday(this.args.date)||!this.dayWrap.isHoliday()||this.pouch.isChangeDayType()||this.pouch.isUseRegulateHoliday()?this.dayWrap.isInterim()||e&&t&&(a||!this.pouch.isChangeDayType()||e.dayType||t.dayType
)?0:e?e.pattern&&this.patternLList.length<=0?0:1:t&&t.pattern&&this.patternSList.length<=0?0:1:0}return-1}},shiftSet:{name:teasp.constant.APPLY_TYPE_PATTERNS,title:teasp.message.getLabel("shiftDisplay_title"),create:this.createShiftSettingForm,descript:null,getMenuFlag:function(){return-1}},patternL:{name:teasp.constant.APPLY_TYPE_PATTERNL,title:teasp.message.getLabel("applyPatternL_label"),
create:this.createChangePatternForm,descript:teasp.message.getLabel("tm10003440"),getMenuFlag:function(){return-1}},lateStart:{name:teasp.constant.APPLY_TYPE_LATESTART,title:teasp.message.getLabel("applyLateStart_label"),create:this.createLateStartForm,descript:teasp.message.getLabel("tm10003450"),getMenuFlag:function(){return this.pouch.isUseLateStartApply()?this.dayWrap.canSelectLateStart()?1:0:-1}},earlyEnd:{
name:teasp.constant.APPLY_TYPE_EARLYEND,title:teasp.message.getLabel("applyEarlyEnd_label"),create:this.createEarlyEndForm,descript:teasp.message.getLabel("tm10003460"),getMenuFlag:function(){return this.pouch.isUseEarlyEndApply()?this.dayWrap.canSelectEarlyEnd()?1:0:-1}},direct:{name:teasp.constant.APPLY_TYPE_DIRECT,title:teasp.message.getLabel("tk10004650"),create:this.createDirectForm,
descript:teasp.message.getLabel("tk10004660"),getMenuFlag:function(){return this.pouch.isUseDirectApply()?this.dayWrap.canSelectDirect()?1:0:-1}}}},teasp.dialog.EmpApply.prototype.ready=function(){this.dayWrap=this.pouch.getEmpDay(this.args.date),this.enableMap=this.pouch.createExchangeEnableMap(this.args.date),this.daiqableMap=this.pouch.createDaiqEnableMap(),this.holidayList=this.pouch.getHolidayList(this.args.date
),this.patternSList=this.pouch.getPatternList(1),this.patternLList=this.pouch.getPatternList(2),this.applyList=this.dayWrap.getEmpApplyList("ALL"),this.monthFix=this.pouch.isEmpMonthFixed(),this.dayFix=this.dayWrap.isDailyFix(),this.monthLastDate=this.pouch.getEmpMonthLastDate(),this.daiqZan=teasp.data.Pouch.getDaiqZan(this.pouch.getStocks(),this.args.date,this.pouch.getEmpMonthStartDate(),null,this.pouch.isOldDate()
);for(var e=0;e<this.holidayList.length;e++){var t=this.holidayList[e];t.managed&&(this.stockZan[t.manageName]=teasp.data.Pouch.getStockZan(this.pouch.getStocks(),t.manageName,this.args.date),this.stockZan[t.manageName].zan<=0&&this.stockZan[t.manageName].valid&&teasp.data.Pouch.getSpendStockChangedBaseTime(this.stockZan[t.manageName],this.pouch.getConfigHistory(),this.args.date)<2&&(
this.stockZan[t.manageName].valid=!1))}this.client=this.args.client,teasp.util.time.setTimeFormat(this.pouch.getTimeFormObj()),this.rangeYear=this.pouch.getDateRangeOfMonth(teasp.util.date.getToday(),13,-12),this.applyable=teasp.util.date.compareDate(this.rangeYear.from,this.args.date)<=0&&0<=teasp.util.date.compareDate(this.rangeYear.to,this.args.date)||this.pouch.isApplyLimitOff()},
teasp.dialog.EmpApply.prototype.deleteTabChild=function(e,t){e.removeChild(t),t.destroyRecursive(),delete t},teasp.dialog.EmpApply.prototype.hide=function(){if(this.dialog){this.tc&&this.tc.destroyRecursive(!1);for(var e=0;e<this.eventHandles.length;e++)dojo.disconnect(this.eventHandles[e]),delete this.eventHandles[e];this.eventHandles=[],this.dialog.hide(),this.free(),this.dialog.destroy(),
teasp.manager.dialogRemove(this.dialogManageKey)}},teasp.dialog.EmpApply.prototype.preStart=function(){this.dialogWidth=Math.min(window.innerWidth-16,690),teasp.isMobile()&&!teasp.isNarrow()&&(this.dialogWidth=690),dojo.style("dialogApplyTop","width",this.dialogWidth+"px");var e=dojo.create("div",{id:"empApplyTab"},dojo.byId("empApplyTabArea")),e=(this.tc=new dijit.layout.TabContainer({style:"height:"+(
this.initHeight||300)+"px;width:"+this.dialogWidth+"px"},e),new dijit.layout.ContentPane({id:"empApplyContent0",title:teasp.message.getLabel("applyMenu_label"),content:'<table class="emp_apply_menu" style="width:100%;"><tbody></tbody></table>'})),t=(this.tc.addChild(e),dojo.connect(e,"onShow",this,this.adjustMenuHeight),dojo.byId("dialogApplyClose")),t=(t.firstChild.innerHTML=teasp.message.getLabel("close_btn_title")
,this.eventHandles.push(dojo.connect(t,"onclick",this,function(){teasp.manager.testSignal(),this.close()})),this.eventHandles.push(dojo.connect(this.dialog,"onCancel",this,this.close)),this.newEntry={},this.appEntry={},this.appWaitReviseTime=null,this.contentSeq=1,dojo.query("table.emp_apply_menu > tbody",e.domNode)[0]);this.showInfo(t)},teasp.dialog.EmpApply.prototype.postShow=function(){dojo.byId("dialogApplyDate"
).innerHTML=teasp.util.date.formatDate(this.args.date,"JP1"),dojo.byId("dialogApplyEvent").innerHTML=this.dayWrap.getCalendarEvent(),this.args.dailyFix&&this.applyHandle.daily&&this.applyHandle.daily.apply(this),teasp.manager.testSignal(),this.tc.startup()},teasp.dialog.EmpApply.prototype.isShowApply=function(e){return this.dayWrap.isShowApply(e)},teasp.dialog.EmpApply.prototype.canCancelApply=function(e){
return this.dayWrap.canCancelDayApply(e)},teasp.dialog.EmpApply.prototype.getApproverType=function(e){return"daily"==e?teasp.constant.APPROVER_TYPE_DAILYFIX:teasp.constant.APPROVER_TYPE_DAILY},teasp.dialog.EmpApply.prototype.showInfo=function(e){this.createApplyMenu(e);var t=null,a=null;if(0<this.applyList.length)for(var o=0;o<this.applyList.length;o++){var s,i=this.applyList[o];this.isShowApply(i)&&(
s=this.getApplyKey(i),this.isNeedPane(s,i)&&s&&(t=this.createContentPane(s,i),this.appEntry[s]||(this.appEntry[s]=[]),this.appEntry[s].push({paneId:t.id,applyObj:i}),this.args.applyId&&this.args.applyId==i.id&&(a=t),"reviseTime"==s&&i.status==teasp.constant.STATUS_WAIT&&(this.appWaitReviseTime=t.id)))}(t||a)&&this.tc.selectChild(a||t)},teasp.dialog.EmpApply.prototype.isNeedPane=function(e,t){return!(
"direct"==e&&t.startDate!=this.args.date&&!teasp.constant.STATUS_FIX.contains(t.status))},teasp.dialog.EmpApply.prototype.getApplyKey=function(e){for(var t in this.applyTypes)if(this.applyTypes.hasOwnProperty(t)&&this.applyTypes[t].name==e.applyType)return"patternL"==t?"patternS":"patternS"==t&&e.decree?"shiftSet":t;return null},teasp.dialog.EmpApply.prototype.isReadOnly=function(e){
return this.monthFix||this.dayFix||this.pouch.isReadOnly()||!e&&!this.applyable},teasp.dialog.EmpApply.prototype.getReadOnlyReason=function(){var e=0;return this.dayFix&&(e|=1),this.monthFix&&(e|=2),this.pouch.isReadOnly()&&(e|=4),e},teasp.dialog.EmpApply.prototype.displayOnOff=function(e,t){e=dojo.byId(e);e&&dojo.style(e,"display",t?"":"none")},teasp.dialog.EmpApply.prototype.getEndOfNormal=function(e){for(var t=e,
a=this.pouch.getEmpMonthLastDate(),o=t;t<=a;){if(!teasp.logic.EmpTime.isFixDay(this.pouch.dataObj.days[t]))return o;o=t,t=teasp.util.date.addDays(t,1)}return o},teasp.dialog.EmpApply.prototype.changeInputAreaView=function(e,t){t&&!t.active&&(e.style.backgroundColor="transparent",e.readOnly="readOnly")},teasp.dialog.EmpApply.prototype.getInputClass=function(e,t){return e||t&&!t.active?"inputro":"inputab"},
teasp.dialog.EmpApply.prototype.createApplyMenu=function(e){for(var t=0;t<this.applyMenus.length;t++){var a,o,s,i,n=this.applyMenus[t];n?(o=(a=this.applyTypes[n]).getMenuFlag?a.getMenuFlag.apply(this):1)<0||(this.isReadOnly()&&(o=0),s=dojo.create("tr",null,e),i=dojo.create("td",{id:"applyNew_"+n,className:"empApplyMenuCellL",style:{cursor:o?"pointer":"default"}},s),dojo.create("div",{
className:o?"empApplyMenuOn":"empApplyMenuOff",innerHTML:a.title,style:teasp.isNarrow()?"width:100%;":"width:160px"},i),teasp.isNarrow()||dojo.create("div",{className:"empApplyDescript",innerHTML:a.descript},dojo.create("td",{className:"empApplyMenuCellR"},s)),1==o&&(this.applyHandle[n]=this.createNewApply(i.id),this.eventHandles.push(dojo.connect(i,"onclick",this,this.applyHandle[n])))):dojo.create("td",{style:{
height:"1px"},colSpan:2},dojo.create("tr",null,e))}},teasp.dialog.EmpApply.prototype.isReapplyType=function(e){if("zangyo"==e&&0!=(4&this.pouch.getUseOverTimeFlag())||"earlyStart"==e&&0!=(4&this.pouch.getUseEarlyWorkFlag())||"holidayWork"==e&&0!=(4&this.pouch.getUseHolidayWorkFlag()))return!0;if("direct"!=e)return!1;for(var t=0;t<this.applyList.length;t++){var a=this.applyList[t];if(
a.applyType==teasp.constant.APPLY_TYPE_DIRECT&&(a.startDate==this.args.date||teasp.constant.STATUS_FIX.contains(a.status)))return!1}return!0},teasp.dialog.EmpApply.prototype.getAfterFlag=function(e,t,a,o){var s=teasp.util.date.getToday();return teasp.util.date.parseDate(teasp.util.date.formatDate(t)+" "+teasp.util.time.timeValue(a)).getTime()<=s.getTime()},teasp.dialog.EmpApply.prototype.createNewApply=function(e){
var a=e.substring(9);return function(){for(var e in this.newEntry)if(this.newEntry.hasOwnProperty(e)){this.deleteTabChild(this.tc,dijit.byId(this.newEntry[e])),delete this.newEntry[e];break}var t;"reviseTime"==a&&this.appWaitReviseTime?this.tc.selectChild(dijit.byId(this.appWaitReviseTime)):(t=this.choiceAppEntry(a),"exchange"!=a&&!this.isReapplyType(a)&&t?this.tc.selectChild(dijit.byId(t.paneId)):(
t=this.createContentPane(a),this.newEntry[a]=t.id,this.tc.selectChild(t)))}},teasp.dialog.EmpApply.prototype.choiceAppEntry=function(e){var t=this.appEntry[e];if(!t||!t.length)return null;if("holiday"==e||"reviseTime"==e||"patternS"==e){for(var a=0;a<t.length;a++)if((o=t[a].applyObj).startDate==this.args.date&&!teasp.constant.STATUS_FIX.contains(o.status))return t[a];return null}if(1==t.length)return t[0];if(
"direct"==e)for(var o,a=0;a<t.length;a++)if((o=t[a].applyObj).startDate==this.args.date||teasp.constant.STATUS_FIX.contains(o.status))return t[a];return t[0]},teasp.dialog.EmpApply.prototype.createContentPane=function(e,t){var a,o,s,i=this.contentSeq++,n="ne",n=(t&&(t.active=!0,n=teasp.constant.STATUS_CANCELS.contains(t.status)?"rm":teasp.constant.STATUS_REJECTS.contains(t.status
)?"ng":teasp.constant.STATUS_APPROVES.contains(t.status)?"ok":"up"),new dijit.layout.ContentPane({id:"empApplyContent"+i,title:this.applyTypes[t&&t.aliasKey||e].title,style:{backgroundColor:t?"#eeeeee":"#ffffff"},iconClass:"ts-status-img ts-ap_tab_"+n,content:'<div class="empApplyContHigh" id="empApplyContHigh'+i+'" style="display:table;width:100%;"></div>'})),r=(this.tc.addChild(n),dojo.byId("empApplyContHigh"+i)),
l=dojo.create("tbody",null,dojo.create("table",{className:"empApply2Table",style:"width:100%;"},r)),l=dojo.create("tr",null,l),p=dojo.create("td",null,l),d=dojo.create("div",{className:teasp.isNarrow()?"empApplyBtnH":"empApplyBtnV"});return t?t.decree&&t.applyType!=teasp.constant.APPLY_TYPE_HOLIDAY||(o=teasp.constant.STATUS_CANCELS.contains(t.status),s=teasp.constant.STATUS_REJECTS.contains(t.status),this.monthFix||(
this.pouch.isApprover(t)?(a=dojo.create("button",{className:"std-button3",style:"margin:4px;margin-left:auto;",id:"empApplyApprove"+i},dojo.create("div",null,d)),dojo.create("div",{innerHTML:teasp.message.getLabel("tf10000270")},a),this.eventHandles.push(dojo.connect(a,"onclick",this,function(){this.approveApply(i,t)}))):this.dayFix||this.isReadOnly()||(r=dojo.create("div",{innerHTML:teasp.message.getLabel(
"tf10000280")},dojo.create("button",{className:"std-button1",style:"margin:4px;margin-left:auto;",id:"empApplyDone"+i},dojo.create("div",null,d))),s||o?(this.checkReapplyable(t)<=0||this.isNotTheDayApply(t,this.args.date))&&(r.parentNode.style.display="none",t.active=!1):r.parentNode.style.display="none"),this.isReadOnly(!0)&&("daily"!=e||1!=this.getReadOnlyReason())||(a=null,
o||s&&t.close?this.pouch.getHandleInvalidApply()||(a=dojo.create("button",{className:"red-button1",style:"margin:4px;margin-left:auto;",id:"empApplyRemove"+i},dojo.create("div",null,d)),dojo.create("div",{innerHTML:teasp.message.getLabel("retractApply_label")},a)):(r=this.canCancelApply(t))&&(a=dojo.create("button",{className:"red-button1",style:"margin:4px;margin-left:auto;",id:"empApplyRemove"+i},dojo.create("div",
null,d)),dojo.create("div",{innerHTML:teasp.message.getLabel(1==r?"cancelApply_btn_title":2==r?"tk10000741":3==r?"cancelFix_btn_title":"retractApply_label")},a)),a&&this.eventHandles.push(dojo.connect(a,"onclick",this,function(){this.cancelApply(i,t)}))))):(dojo.create("div",{innerHTML:teasp.message.getLabel(this.pouch.isUseWorkFlow()?"applyx_btn_title":"fix_btn_title")},dojo.create("button",{className:"std-button1",
style:"margin:4px;margin-left:auto;",id:"empApplyDone"+i},dojo.create("div",null,d))),o=dojo.create("button",{className:"std-button2",style:"margin:4px;margin-left:auto;",id:"empApplyCancel"+i},dojo.create("div",null,d)),dojo.create("div",{innerHTML:teasp.message.getLabel("cancel_btn_title")},o),this.eventHandles.push(dojo.connect(o,"onclick",this,function(){for(var e in this.newEntry)if(this.newEntry.hasOwnProperty(
e)&&this.newEntry[e]=="empApplyContent"+i){delete this.newEntry[e];break}this.deleteTabChild(this.tc,dijit.byId("empApplyContent"+i))}))),teasp.isNarrow()||(s=dojo.create("td",{style:"width:140px;vertical-align:top;",id:"empApplyRight"+i},l),dojo.place(d,s)),this.applyTypes[e].create.apply(this,[e,p,i,t,teasp.isNarrow()?d:null]),t&&this.createHistoryTable(i,t.steps||[]),teasp.manager.testSignal({key:e,contId:i}),
dojo.connect(n,"onShow",this,teasp.dialog.EmpApply.adjustContentHeight),n},teasp.dialog.EmpApply.prototype.checkReapplyable=function(e){e=e?e.applyType:"";if(e==teasp.constant.APPLY_TYPE_DAILY)return this.pouch.isUseDailyApply()?(o=this.dayWrap.canSelectDailyEx(1)).flag||o.active?1:0:-1;if(e==teasp.constant.APPLY_TYPE_REVISETIME)return this.pouch.isUseReviseTimeApply()?!this.dayWrap.existWaitReviseTime(
)&&this.dayWrap.canSelectReviseTime()?1:0:-1;if(e==teasp.constant.APPLY_TYPE_HOLIDAY){for(var t=!1,a=0;a<this.holidayList.length;a++)if(this.holidayList[a].displayDaysOnCalendar){t=!0;break}return this.dayWrap.canSelectHoliday(t)&&0<this.holidayList.length?1:0}if(e==teasp.constant.APPLY_TYPE_KYUSHTU)return this.pouch.getUseHolidayWorkFlag()?this.dayWrap.canSelectKyushtu()?1:0:-1;if(e==teasp.constant.APPLY_TYPE_ZANGYO
)return this.pouch.getUseOverTimeFlag()?this.dayWrap.canSelectZangyo()?1:0:-1;if(e==teasp.constant.APPLY_TYPE_EARLYSTART)return this.pouch.getUseEarlyWorkFlag()?this.dayWrap.canSelectZangyo(!0)?1:0:-1;if(e==teasp.constant.APPLY_TYPE_EXCHANGE)return o=this.pouch.getDateRangeOfMonth(this.args.date,2,-1),this.pouch.isUseExchangeDate()?this.dayWrap.canSelectExchange()&&0<=teasp.util.date.compareDate(o.to,this.args.date
)?1:0:-1;if(e!=teasp.constant.APPLY_TYPE_PATTERNS&&e!=teasp.constant.APPLY_TYPE_PATTERNL)return e==teasp.constant.APPLY_TYPE_LATESTART?this.pouch.isUseLateStartApply()?this.dayWrap.canSelectLateStart()?1:0:-1:e==teasp.constant.APPLY_TYPE_EARLYEND?this.pouch.isUseEarlyEndApply()?this.dayWrap.canSelectEarlyEnd()?1:0:-1:e==teasp.constant.APPLY_TYPE_DIRECT?this.pouch.isUseDirectApply()?this.dayWrap.canSelectDirect(
)?1:0:-1:e==teasp.constant.APPLY_TYPE_SHIFTCHANGE?this.pouch.isUseShiftChange()?this.dayWrap.canSelectShiftChange(this.args.date)?1:0:-1:1;if(this.pouch.isUseChangePattern()){if(this.patternSList.length<=0&&this.patternLList.length<=0)return 0;if(!this.pouch.isRegulateHoliday(this.args.date)&&this.dayWrap.isHoliday()&&!this.pouch.isChangeDayType()&&!this.pouch.isUseRegulateHoliday())return 0;if(
this.dayWrap.isInterim())return 0;var o=this.dayWrap.getEmpApplyByKey(teasp.constant.APPLY_KEY_PATTERNS),e=this.dayWrap.getEmpApplyByKey(teasp.constant.APPLY_KEY_PATTERNL),s=this.dayWrap.getEmpApplyByKey(teasp.constant.APPLY_KEY_PATTERND);return o&&e&&(s||!this.pouch.isChangeDayType())?0:o?o.pattern&&this.patternLList.length<=0?0:1:e&&e.pattern&&this.patternSList.length<=0?0:1}return-1},
teasp.dialog.EmpApply.prototype.createHistoryTable=function(e,t){for(var a=dojo.byId("empApplyContHigh"+e),o=dojo.create("div",{style:"font-weight:bold;text-align:left;margin:4px 0px 0px 4px;",innerHTML:teasp.message.getLabel("approvalHistory_label")},a),a=dojo.create("table",{className:"emp_apply_steps"},a),s=dojo.create("tbody",null,a),a=(dojo.style(o,"width",teasp.isNarrow()?"100%":"650px"),dojo.style(a,"width",
teasp.isNarrow()?"100%":"650px"),dojo.create("td",null,dojo.create("tr",null,s))),i=dojo.create("tbody",null,dojo.create("table",{className:"emp_apply_steps_head"},a)),n=dojo.create("tr",null,i),r=dojo.create("td",{className:"number"},n),l=dojo.create("td",{className:"datetime"},n),p=dojo.create("td",{className:"status"},n),d=dojo.create("td",{className:"actor"},n),c=teasp.isNarrow()?null:dojo.create("td",{
className:"comment"},n),m=(teasp.isNarrow()&&dojo.style(d,"width","auto"),dojo.create("div",{innerHTML:teasp.message.getLabel("number_head")},r),dojo.create("div",{innerHTML:teasp.message.getLabel("dateTime_head")},l),dojo.create("div",{innerHTML:teasp.message.getLabel("statusj_head")},p),dojo.create("div",{innerHTML:teasp.message.getLabel("actor_head")},d),c&&dojo.create("div",{innerHTML:teasp.message.getLabel(
"comment_head")},c),a=dojo.create("td",null,dojo.create("tr",null,s)),o=dojo.create("div",{id:"dialogApplyHistoryDiv"+e,className:"emp_apply_steps_area"},a),teasp.isNarrow()||(dojo.style(o,"width",teasp.isNarrow()?"100%":"650px"),dojo.style(o,"height","100px"),dojo.style(o,"overflow-y","scroll")),dojo.create("tbody",null,dojo.create("table",{id:"dialogApplyHistoryTable"+e,className:"emp_apply_steps_body"},o))),
h=dojo.clone(t).reverse(),u=Math.max(h.length||0,5),g=h.length,y=0;y<u;y++){var f,b,_,v,T=y<h.length?h[y]:null,n=dojo.create("tr",{className:y%2==0?"even":"odd"},m);cr2=teasp.isNarrow()?dojo.create("tr",{className:y%2==0?"even":"odd"},m):null,r=dojo.create("td",{className:"number"},n),l=dojo.create("td",{className:"datetime"},n),p=dojo.create("td",{className:"status"},n),d=dojo.create("td",{className:"actor"},n),
c=dojo.create("td",{className:"comment"},cr2||n),teasp.isNarrow()&&(dojo.attr(r,"rowSpan","2"),dojo.attr(c,"colSpan","3")),T?(f=g--,b=teasp.util.date.formatDateTime(T.createdDate,"SLA-HM"),_=teasp.constant.getDisplayStatus(T.stepStatus),v=dojo.string.substitute(T.stepStatus==teasp.constant.STATUS_REASSIGNED?"(${0}) ${1}":"${1}",[teasp.message.getLabel("reallot_label"),T.actorName||""]),T=teasp.util.entitize(
T.comments,""),dojo.create("div",{innerHTML:f},r),dojo.create("div",{innerHTML:b},l),dojo.create("div",{innerHTML:_},p),dojo.create("div",{innerHTML:v},d),dojo.create("div",{innerHTML:T},c),T||dojo.style(c,"height","1px")):dojo.style(c,"height","1px")}},teasp.dialog.EmpApply.prototype.cancelApply=function(t,a){var e=this.pouch.getEmpApply(a),o=e.isReject(),s=e.isCancel(),i=teasp.message.getLabel(
o||s?"tm10003011":"tm10003010",e.getDisplayApplyType()),n=null,r=!1,l=this.pouch.getClearLevel(),p=!1;if(e.isApplyKyushtu()||e.isApplyExchange()){var d=this.args.date,c=null,m=(d=e.getStartDate(),e.isApplyExchange()&&(c=e.getExchangeDate()),this.pouch.getEmpDay(d)),h=c?this.pouch.getEmpDay(c):null;if(!s){var u=this.pouch.getEmpMonthByDate(d),g=this.pouch.getEmpMonthByDate(c),
y=u&&u.apply&&teasp.constant.STATUS_FIX.contains(u.apply.status),f=g&&g.apply&&teasp.constant.STATUS_FIX.contains(g.apply.status);if(y||f)return k=y&&u.yearMonth!=this.pouch.getYearMonth()?(L=u.yearMonth,u.subNo):(L=g.yearMonth,g.subNo),D=teasp.util.date.formatMonth("zv00000020",Math.floor(L/100),L%100,k),void teasp.dialog.EmpApply.showError(t,teasp.message.getLabel("tm10003020",D));if(o){if(e.isApplyExchange(
)&&this.args.date==c)return void teasp.dialog.EmpApply.showError(t,teasp.message.getLabel("tk10005410"))}else if(e.isApplyExchange()){if(this.args.date==c)return void teasp.dialog.EmpApply.showError(t,teasp.message.getLabel("tk10004810"));var b=[teasp.constant.APPLY_TYPE_PATTERNS,teasp.constant.APPLY_TYPE_PATTERNL,teasp.constant.APPLY_TYPE_REVISETIME],f=[teasp.constant.APPLY_TYPE_PATTERNS,
teasp.constant.APPLY_TYPE_PATTERNL,teasp.constant.APPLY_TYPE_ZANGYO,teasp.constant.APPLY_TYPE_EARLYSTART,teasp.constant.APPLY_TYPE_LATESTART,teasp.constant.APPLY_TYPE_EARLYEND,teasp.constant.APPLY_TYPE_REVISETIME],y=this.pouch.getApplyListByDate(d,(0==m.getDayType()?b:f).concat([teasp.constant.APPLY_TYPE_EXCHANGE])),u=this.pouch.getApplyListByDate(c,0==m.getDayType()?f:b,e.getId());if(0<y.length||0<u.length
)return g=0<y.length?d:c,void teasp.dialog.EmpApply.showError(t,teasp.message.getLabel("tm10003030",teasp.util.date.formatDate(g,"M/d"),teasp.dialog.EmpApply.getApplyTypesName(0<y.length?y:u)))}else{for(var b=[teasp.constant.APPLY_TYPE_KYUSHTU,teasp.constant.APPLY_TYPE_PATTERNS,teasp.constant.APPLY_TYPE_PATTERNL,teasp.constant.APPLY_TYPE_EXCHANGE,teasp.constant.APPLY_TYPE_REVISETIME,
teasp.constant.APPLY_TYPE_SHIFTCHANGE],_=this.pouch.getApplyListByDate(this.args.date,b),v=[],T=0;T<_.length;T++)(A=_[T]).applyType==teasp.constant.APPLY_TYPE_HOLIDAY&&A.holiday&&A.holiday.displayDaysOnCalendar&&v.push(T);for(T=v.length-1;0<=T;T--)_.splice(v[T],1);if(0<_.length)return void teasp.dialog.EmpApply.showError(t,teasp.message.getLabel("tm10003040","",teasp.dialog.EmpApply.getApplyTypesName(_)))}
f=this.pouch.getClassifyJobWorks(d),g=c?this.pouch.getClassifyJobWorks(c):null,y=m.isInputTime()||f&&(0<f.sumTime||0<f.sumVolume)?d:null,u=h&&h.isInputTime()||g&&(0<g.sumTime||0<g.sumVolume)?c:null;o?(y&&m.isInputable(!0)&&m.isInputableEx().inputable&&(y=null),u&&h&&h.isInputable(!0)&&h.isInputableEx().inputable&&(u=null)):(u=u&&(y&&m.isInputable(!0)&&m.isInputableEx().inputable?null:u))&&h&&h.isInputable(!0
)&&h.isInputableEx().inputable&&(y=null),y||u?(r=!0,n=h?teasp.message.getLabel(1==l?"tm10003193":"tm10003191",teasp.util.date.formatDate(u||y,"M/d")):teasp.message.getLabel(1==l?"tm10003193":"tm10003191",teasp.util.date.formatDate(y,"M/d"))):(p=h?!(!h.getWorkLocationId()&&!m.getWorkLocationId()):!!m.getWorkLocationId(),r=p)}}else if(e.isApplyShiftChange()){d=e.getStartDate(),c=e.getExchangeDate(),
m=this.pouch.getEmpDay(d),h=this.pouch.getEmpDay(c);if(!s){if(!o&&!this.checkOtherApplyAtShiftChange(t,a,m,h,!0))return;f=this.pouch.getClassifyJobWorks(d),g=this.pouch.getClassifyJobWorks(c),y=m.isInputTime()||f&&(0<f.sumTime||0<f.sumVolume)?d:null,u=h.isInputTime()||g&&(0<g.sumTime||0<g.sumVolume)?c:null;o?(y&&m.isInputable(!0)&&m.isInputableEx().inputable&&(y=null),u&&h&&h.isInputable(!0)&&h.isInputableEx(
).inputable&&(u=null)):(u=u&&(y&&m.isInputable(!0)&&m.isInputableEx().inputable?null:u))&&h&&h.isInputable(!0)&&h.isInputableEx().inputable&&(y=null),y||u?(r=!0,n=teasp.message.getLabel(1==l?"tm10003193":"tm10003191",teasp.util.date.formatDate(u||y,"M/d"))):(p=!(!h.getWorkLocationId()&&!m.getWorkLocationId()),r=p)}}else if(e.getStartDate()!=e.getEndDate())for(var j=a.holiday&&a.holiday.displayDaysOnCalendar||!1,
E=e.getStartDate();E<=e.getEndDate();)if(!j&&a.excludeDate.contains(E))E=teasp.util.date.addDays(E,1);else{var L,k,D,I=this.pouch.getEmpMonthByDate(E);if(I&&I.apply&&teasp.constant.STATUS_FIX.contains(I.apply.status))return L=I.yearMonth,k=I.subNo,D=teasp.util.date.formatMonth("zv00000020",Math.floor(L/100),L%100,k),void teasp.dialog.EmpApply.showError(t,teasp.message.getLabel("tk10005170",D,e.getApplyType()));var A,
S=this.pouch.getEmpDay(E);if(S.isValid())if((A=S.getEmpApplyByKey(teasp.constant.APPLY_KEY_DAILY))&&teasp.constant.STATUS_FIX.contains(A.status))return void teasp.dialog.EmpApply.showError(t,teasp.message.getLabel("tm10003030",teasp.util.date.formatDate(E,"M/d"),A.applyType));E=teasp.util.date.addDays(E,1)}if((e.isApplyPatternS()||e.isApplyPatternL())&&e.apply.pattern)for(E=e.getStartDate();E<=e.getEndDate();){if((
S=this.pouch.getEmpDay(E)).isValid()){var x=S.getEmpApplyByKey(teasp.constant.APPLY_KEY_PATTERNS),w=S.getEmpApplyByKey(teasp.constant.APPLY_KEY_PATTERNL),w=e.isApplyPatternL()?x:w;if(!w||w!==x){var x=w?w.pattern:this.pouch.getObj().config.defaultPattern,M=S.getEmpApplyByKey(teasp.constant.APPLY_KEY_HOLIDAY_AM),O=S.getEmpApplyByKey(teasp.constant.APPLY_KEY_HOLIDAY_PM),R=S.getEmpApplyByKey(
teasp.constant.APPLY_KEY_HOLIDAY_TIME);if((M||O||R)&&(!M||!O)){R=w&&w.pattern.enableRestTimeShift&&w.startTime!=x.stdStartTime?w.startTime-x.stdStartTime:0;if(S.checkInconsistent(M?teasp.constant.RANGE_AM:O?teasp.constant.RANGE_PM:null,x,R))return void teasp.dialog.EmpApply.showError(t,teasp.message.getLabel("tm10003030",teasp.util.date.formatDate(E,"M/d"),teasp.data.EmpApply.getDisplayApplyType(
teasp.constant.APPLY_TYPE_HOLIDAY)))}}}E=teasp.util.date.addDays(E,1)}var N={action:e.isReject()||e.isCancel()?"closeApplyEmpDay":"cancelApplyEmpDay",empId:this.pouch.getEmpId(),date:this.args.date,month:this.pouch.getYearMonth(),startDate:this.pouch.getStartDate(),lastModifiedDate:this.pouch.getLastModifiedDate(),appId:e.getId(),clearTime:!0,client:this.client,noDelay:!0};e.getApplyType(
)==teasp.constant.APPLY_TYPE_REVISETIME&&teasp.constant.STATUS_APPROVES.contains(a.status)&&(N.timeTable=this.dayWrap.getReviseOldValue(a),this.dayWrap.isConflictTimeHoliay(this.dayWrap.getTimeTable(),N.timeTable))?teasp.dialog.EmpApply.showError(t,teasp.message.getLabel("tm10003040","",teasp.data.EmpApply.getDisplayApplyType(teasp.constant.APPLY_TYPE_HOLIDAY))):(b={},n&&(b.clear={title:n},l||(b.clear.checked=!0)),
!e.isReject()||e.isClose()||this.pouch.getHandleInvalidApply()||(b.nohist={checked:!1,title:teasp.message.getLabel("tk10001177")}),f="",f=e.isApprove()?teasp.message.getLabel("tk10000741"):o||s?teasp.message.getLabel("retractApply_label"):teasp.message.getLabel("cancelApply_btn_title"),teasp.manager.dialogOpen("MessageBox",{title:teasp.message.getLabel("tk10004240",f),message:i,check:b},this.pouch,this,function(e){
N.clearTime=l?r:e.clear&&e.clear.checked||p,this.dayWrap.getInputLimit().directFlag?this.cancelDirectApply.apply(this,[t,N,a]):(N.remove=e.nohist&&e.nohist.checked||!1,teasp.manager.dialogOpen("BusyWait"),teasp.manager.request("cancelApplyEmpDay",N,this.pouch,{hideBusy:!0},this,function(){this.onfinishfunc(),this.close(),teasp.manager.dialogClose("BusyWait")},function(e){teasp.manager.dialogClose("BusyWait"),
teasp.message.alertError(e)}))}))},teasp.dialog.EmpApply.prototype.approveApply=function(e,t){teasp.manager.dialogOpen("Approval",{apply:{id:t.id},objKey:"empApply",refresh:!0,noDelay:!0},this.pouch,this,function(){this.onfinishfunc(!0),this.close()})},teasp.dialog.EmpApply.prototype.createRangeParts=function(e,t,a,o,s){var i=o&&(teasp.constant.STATUS_FIX.contains(o.status)||this.isNotTheDayApply(o,this.args.date)
)||this.isReadOnly(),n=i||o&&!o.active,r=this.getInputClass(i,o),t=dojo.create("div",{id:"dialogApplyRangeRow"+a,className:"empApply2Div"},t),t=(dojo.create("div",{className:"empApply2CL",innerHTML:teasp.message.getLabel("range_label")},t),dojo.create("tbody",null,dojo.create("table",{className:"pane_table"},dojo.create("div",{className:"empApply2VL"},t)))),t=dojo.create("tr",null,t),l=teasp.util.date.formatDate(
o?o.startDate:s.from,"SLA"),p=dojo.create("input",{type:"text",id:"dialogApplyStartDate"+a,readOnly:"readOnly",className:"inpudate inputro",style:{margin:"2px"},value:l},dojo.create("td",null,t)),d=(this.changeInputAreaView(p,o,i),dojo.create("td",{style:"vertical-align:middle;"},t)),d=dojo.create("label",{style:"margin:2px;",id:"dialogApplyRangeLabel"+a},d),c=dojo.create("input",{type:"checkbox",style:"margin:2px;",
id:"dialogApplyRangeOn"+a},d),m=(d.appendChild(dojo.doc.createTextNode(teasp.message.getLabel("kara_label"))),i&&(c.disabled=!0),dojo.create("input",{type:"text",style:"margin:2px;",id:"dialogApplyEndDate"+a,className:"inpudate "+r,maxLength:12},dojo.create("td",null,t))),h=(m.value=l,n?null:dojo.create("input",{type:"button",style:"margin:2px;",id:"dialogApplyEndDateCal"+a,className:"pp_base pp_btn_cal"},
dojo.create("td",null,t)));this.changeInputAreaView(m,o,i),o&&o.startDate!=o.endDate?(c.checked=!0,m.value=teasp.util.date.formatDate(o.endDate,"SLA"),i&&(m.readOnly="readOnly"),h&&(h.className="pp_base "+(i?"pp_btn_cal_dis":"pp_btn_cal")),dojo.toggleClass(m,"inputro",i)):(c.checked=!1,m.disabled=!0,h&&(h.className="pp_base pp_btn_cal_dis"),dojo.toggleClass(m,"inputro",!0)),h&&(this.eventHandles.push(dojo.connect(c,
"onclick",this,function(e){m.value=p.value,m.disabled=!e.target.checked,dojo.toggleClass(m,"inputro",!e.target.checked),h.className="pp_base "+(e.target.checked?"pp_btn_cal":"pp_btn_cal_dis")})),this.eventHandles.push(dojo.connect(h,"onclick",this,function(e){var t;!i&&c.checked&&(t=teasp.util.date.parseDate(m.value),teasp.manager.dialogOpen("Calendar",{date:t||s.from,isDisabledDateFunc:function(e){
return 0<teasp.util.date.compareDate(s.from,e)||teasp.util.date.compareDate(s.to,e)<0}},null,this,function(e){m.value=teasp.util.date.formatDate(e,"SLA"),teasp.dialog.EmpApply.showError(a,null)}))})))},teasp.dialog.EmpApply.prototype.createTimeParts=function(e,t,a,o,s,i){var s=o&&(teasp.constant.STATUS_FIX.contains(o.status)||this.isNotTheDayApply(o,this.args.date))||this.isReadOnly()||s,n=this.getInputClass(s,o),
t=dojo.create("div",{id:"dialogApplyTimeRow"+a,className:"empApply2Div",style:"margin-top:3px;"},t),t=(dojo.create("div",{className:"empApply2CL",innerHTML:teasp.message.getLabel("time_label")},t),dojo.create("div",{className:"empApply2VL"+(teasp.isNarrow()?"":" horizon")},t)),r=dojo.create("tbody",null,dojo.create("table",{className:"pane_table horizon"},t)),r=dojo.create("tr",null,r),l=dojo.create("input",{
type:"text",style:"margin:2px;",id:"dialogApplyStartTime"+a,className:"inputime "+n,maxLength:5},dojo.create("td",{className:"time-parts"},r)),n=(dojo.create("td",{style:"margin:2px 6px;",innerHTML:teasp.message.getLabel("wave_label"),className:"time-parts"},r),dojo.create("input",{type:"text",style:"margin:2px;",id:"dialogApplyEndTime"+a,className:"inputime "+n,maxLength:5},dojo.create("td",{className:"time-parts",
style:"padding-right:8px;"},r)));this.changeInputAreaView(l,o,s),this.changeInputAreaView(n,o,s),dojo.create("div",{id:"dialogApplyTimeNote"+a,className:"horizon",style:"margin:"+(teasp.isNarrow()?"":"5px ")+"2px;color:red;max-width:240px;word-break:break-all;"},t),s||(this.eventHandles.push(dojo.connect(l,"blur",this,function(e){teasp.util.time.onblurTime(e),i&&i.apply(this)})),this.eventHandles.push(dojo.connect(l,
"onkeypress",this,function(e){teasp.util.time.onkeypressTime(e),13===e.keyCode&&i&&i.apply(this)})),this.eventHandles.push(dojo.connect(n,"blur",this,function(e){teasp.util.time.onblurTime(e),i&&i.apply(this)})),this.eventHandles.push(dojo.connect(n,"onkeypress",this,function(e){teasp.util.time.onkeypressTime(e),13===e.keyCode&&i&&i.apply(this)}))),o&&(l.value=teasp.util.time.timeValue(o.startTime,this.timeForm),
n.value=teasp.util.time.timeValue(o.endTime,this.timeForm)),s&&(l.readOnly="readOnly",n.readOnly="readOnly")},teasp.dialog.EmpApply.prototype.createNoteParts=function(e,t,a,o,s){var i=o&&(teasp.constant.STATUS_FIX.contains(o.status)||this.isNotTheDayApply(o,this.args.date))||this.isReadOnly(),n=this.getInputClass(i,o),t=dojo.create("div",{id:"dialogApplyNoteRow"+a,className:"empApply2Div"},t),s=(dojo.create("div",{
className:"empApply2CL noteArea",innerHTML:s||teasp.message.getLabel("note_head")},t),dojo.create("textarea",{id:"dialogApplyNote"+a,style:{width:"97%",height:"42px",margin:"2px",padding:"2px"},className:"noteArea "+n,maxLength:255},dojo.create("div",{className:"empApply2VL",style:dojo.string.substitute("width:${0};",[this.valueWidth])},t)));this.changeInputAreaView(s,o,i),o&&(
o.applyType==teasp.constant.APPLY_TYPE_PATTERNS&&o.decree?s.value=o.content||"":s.value=o.note||"",i&&(s.readOnly="readOnly"))},teasp.dialog.EmpApply.prototype.createContactParts=function(e,t,a,o){var s=o&&(teasp.constant.STATUS_FIX.contains(o.status)||this.isNotTheDayApply(o,this.args.date))||this.isReadOnly(),i=this.getInputClass(s,o),t=dojo.create("div",{id:"dialogApplyContactRow"+a,className:"empApply2Div"},t),
a=(dojo.create("div",{className:"empApply2CL",innerHTML:teasp.message.getLabel("contact_label")},t),dojo.create("input",{id:"dialogApplyContact"+a,type:"text",style:{width:"97%",margin:"2px",padding:"2px"},className:"noteArea "+i,maxLength:"255"},dojo.create("div",{className:"empApply2VL",style:dojo.string.substitute("width:${0};",[this.valueWidth])},t)));this.changeInputAreaView(a,o,s),o&&(a.value=o.contact||"",s&&(
a.readOnly="readOnly"))},teasp.dialog.EmpApply.prototype.createApplySetParts=function(e,t,a,o){var s;this.pouch.isUseApproverSet()&&(s=!o||teasp.constant.STATUS_CANCELS.contains(o.status)||teasp.constant.STATUS_REJECTS.contains(o.status),t=dojo.create("div",{id:"dialogApplyApproverSetRow"+a,className:"empApply2Div"},t),dojo.create("div",{className:"empApply2CL",innerHTML:teasp.message.getLabel("tk10000071")},t),
t=dojo.create("div",{className:"empApply2VL"},t),e=this.getApproverType(e),t=dojo.create("div",{className:"horiz"},t),dojo.create("div",{id:"dialogApplyApproverSetVal"+a,style:{float:"left"},innerHTML:o&&!s?this.pouch.getApproverName(o):this.pouch.getApproverSetName(e)},t),s&&!this.isReadOnly()&&(dojo.create("a",{innerHTML:teasp.message.getLabel("tk10004000"),onclick:this.reloadApproverSet(a,e),style:{
marginLeft:"12px",verticalAlign:"bottom",color:"#000080",textDecoration:"underline",cursor:"pointer"}},dojo.create("div",{style:{float:"left",fontSize:"0.95em"}},t)),teasp.isSforce1()||dojo.create("a",{innerHTML:teasp.message.getLabel("tk10004010"),onclick:this.openApproverSet(e),style:{marginLeft:"12px",verticalAlign:"bottom",color:"#000080",textDecoration:"underline",cursor:"pointer"}},dojo.create("div",{style:{
float:"left",fontSize:"0.95em"}},t))))},teasp.dialog.EmpApply.prototype.reloadApproverSet=function(e,t){var a=e,o=t;return dojo.hitch(this,function(){teasp.dialog.EmpApply.showError(e,null),this.getApproverSet.apply(this,[null,function(){dojo.byId("dialogApplyApproverSetVal"+a).innerHTML=this.pouch.getApproverSetName(o)},function(e){teasp.message.alertError(e)}])})},
teasp.dialog.EmpApply.prototype.openApproverSet=function(e){var t=e;return dojo.hitch(this,function(){var e=this.pouch.getApproverSetId(t);return e?window.open("/"+e+"/e","_blank"):this.getApproverSet.apply(this,[t,function(){return e=this.pouch.getApproverSetId(t),window.open("/"+e+"/e","_blank"),!1},function(e){teasp.message.alertError(e)}]),!1})},teasp.dialog.EmpApply.prototype.getApproverSet=function(e,t,a){
teasp.manager.request("getAtkApproverSet",{action:"getAtkApproverSet",empId:this.pouch.getEmpId(),type:e},this.pouch,{hideBusy:!1},this,t,a)},teasp.dialog.EmpApply.prototype.createApplyTimeParts=function(e,t,a,o){o&&(t=dojo.create("div",{id:"dialogApplyAppTimeRow"+a,className:"empApply2Div"},t),dojo.create("div",{className:"empApply2CL",innerHTML:teasp.message.getLabel("applyTime_label")},t),dojo.create("div",{
id:"dialogApplyAppTime"+a},dojo.create("div",{className:"empApply2VL"},t)).innerHTML=teasp.util.date.formatDateTime(o.applyTime,"SLA-HM"))},teasp.dialog.EmpApply.getWorkItemHref=function(e){return"/p/process/ProcessInstanceWorkitemWizardStageManager?id="+e},teasp.dialog.EmpApply.getApplyTypesName=function(e){var t=[];if(e&&is_array(e))for(var a=0;a<e.length;a++){var o=e[a];o&&o.applyType&&((o=o.applyType
)==teasp.constant.APPLY_TYPE_PATTERNL&&(o=teasp.constant.APPLY_TYPE_PATTERNS),t.push(teasp.data.EmpApply.getDisplayApplyType(o)))}else if("object"==typeof e)for(var s in e)e.hasOwnProperty(s)&&"cnt"!=s&&t.push(teasp.data.EmpApply.getDisplayApplyType(s));return 0<t.length?t.join(", "):""},teasp.dialog.EmpApply.prototype.createStatusParts=function(e,t,a,o){var s;o&&(t=dojo.create("div",{id:"dialogApplyAppStatusRow"+a,
className:"empApply2Div"},t),dojo.create("div",{className:"empApply2CL",innerHTML:teasp.message.getLabel("statusj_head")},t),t=dojo.create("div",{className:"empApply2VL",style:"vertical-align:bottom;"},t),t=dojo.create("div",{className:"horiz"},t),a=dojo.create("div",{id:"dialogApplyAppStatus"+a,style:"float:left;"},t),s=teasp.constant.getDisplayStatus(o.status)||teasp.message.getLabel("notFix_label"),
teasp.constant.STATUS_REJECTS.contains(o.status)&&(s+=" "+teasp.message.getLabel(o.close?"tk10004790":"tk10004780")),a.innerHTML=s,a.style.color=teasp.constant.STATUS_REJECTS.contains(o.status)?"red":"black",teasp.constant.STATUS_WAIT==o.status&&(s=dojo.create("a",{href:"javascript:void(0);",style:{float:"left",marginLeft:"12px",fontSize:"0.9em",verticalAlign:"bottom"},innerHTML:teasp.message.getLabel("tm10001680",
teasp.message.getLabel("tk10004020"))},t),teasp.isSforce1()?this.eventHandles.push(dojo.connect(s,"onclick",this,function(){sforce.one.navigateToURL("/"+o.id)})):(dojo.attr(s,"href","/"+o.id),dojo.attr(s,"target","_blank"))))},teasp.dialog.EmpApply.prototype.createAnnotateParts=function(e,t,a){t=dojo.create("div",{id:"dialogApplyAnnotateRow"+a,style:"display:none;margin-left:-16px;"},t);dojo.create("div",{
id:"dialogApplyAnnotate"+a,style:"marginTop:8px;text-align:center;margin:6px;"},t)},teasp.dialog.EmpApply.prototype.createErrorParts=function(e,t,a){t=dojo.create("div",{id:"dialogApplyErrorRow"+a,style:"display:none;text-align:center;margin-left:-16px;"},t);dojo.create("div",{id:"dialogApplyError"+a,style:"color:red;margin:6px;"},t)},teasp.dialog.EmpApply.prototype.createWarnParts=function(e,t,a){dojo.create("div",{
id:"dialogApplyWarn"+a,style:{textAlign:"left",marginTop:"6px"}},dojo.create("div",{id:"dialogApplyWarnRow"+a,style:"display:none;margin-left:-16px;"},t))},teasp.dialog.EmpApply.showError=function(e,t,a){dojo.style("dialogApplyErrorRow"+e,"display",t?"":"none"),dojo.byId("dialogApplyError"+e).innerHTML=t?a?t:t.entitize():"",teasp.dialog.EmpApply.adjustContentHeight()},teasp.dialog.EmpApply.showWarn=function(e,t){
var a=dojo.byId("dialogApplyWarn"+e);dojo.empty(a),t&&(dojo.create("div",{className:"pp_base pp_icon_caution",style:"display:inline-block;margin:6px;vertical-align:middle;"},a),dojo.create("div",{innerHTML:t,style:"display:inline-block;width:78%;vertical-align:middle;"},a)),dojo.style("dialogApplyWarnRow"+e,"display",t?"":"none"),teasp.dialog.EmpApply.adjustContentHeight()},
teasp.dialog.EmpApply.prototype.requestSend=function(t,e,a){e.client=this.client,e.noDelay=!0;var o=e.apply.note;a||teasp.manager.dialogOpen("BusyWait"),teasp.manager.request("applyEmpDay",e,this.pouch,{hideBusy:!0},this,function(){var e;o&&(e=this.dayWrap.getDayNote(!this.pouch.isSeparateDailyNote()),this.dayWrap.setDayNote((e?e+"\n":"")+o)),teasp.constant.APPLY_CLIENT_DAILY,this.onfinishfunc(!0),this.close()},
function(e){teasp.manager.dialogClose("BusyWait"),teasp.dialog.EmpApply.showError(t,teasp.message.getErrorMessage(e))},function(){this.onfinishfunc(),this.close(),teasp.manager.dialogClose("BusyWait")})},teasp.dialog.EmpApply.prototype.getRangeApplys=function(e,t){for(var a={},o=e;o<=(t||e);){var s,i=this.pouch.getObj().days[o];i||(i={date:o,rack:{}},s=this.pouch.getObj().dayMap[o],i.rack.invalidApplys=[],
i.rack.validApplys=teasp.logic.EmpTime.getValidApplyMap(s&&s.applys||[],i.rack.invalidApplys,o)),a[o]=i,o=teasp.util.date.addDays(o,1)}return a},teasp.dialog.EmpApply.prototype.conflictHoliday=function(e,t,a,o){var s=this.pouch.getEmpMonthByDate(e.date);if(s&&this.pouch.isEmpMonthFixed(s))return n=s.yearMonth,s=s.subNo,n=teasp.util.date.formatMonth("zv00000020",Math.floor(n/100),n%100,s),teasp.message.getLabel(
"tk10005180",n,a.msge1);if((t.displayDaysOnCalendar||!e.rack.validApplys.kyushtu||!e.rack.validApplys.kyushtu.length)&&e.rack.validApplys.dailyFix)return teasp.message.getLabel("tk10005190",teasp.util.date.formatDate(e.date,"M/d"),a.msge1);var s=0,i=(e.rack.validApplys.holidayAm&&(s|=1),e.rack.validApplys.holidayPm&&(s|=2),e.rack.validApplys.holidayAll&&(s|=3),e.rack.validApplys.holidayTime),n=e.pattern||null;if(
t.range==teasp.constant.RANGE_ALL&&(s||0<i.length))return teasp.message.getLabel("tk10004610",a.msge2);if(t.range==teasp.constant.RANGE_AM||t.range==teasp.constant.RANGE_PM){if(3==s||t.range==teasp.constant.RANGE_AM&&1==s||t.range==teasp.constant.RANGE_PM&&2==s||s&&i.length)return teasp.message.getLabel("tk10004610",a.msge2);if(0<i.length&&n&&!e.rack.flexHalfDayTime){for(var s={
from:t.range==teasp.constant.RANGE_AM?n.amHolidayStartTime:n.pmHolidayStartTime,to:t.range==teasp.constant.RANGE_AM?n.amHolidayEndTime:n.pmHolidayEndTime},r=[],l=0;l<i.length;l++)r.push({from:i[l].startTime,to:i[l].endTime});if(0<teasp.util.time.rangeTime(s,r))return teasp.message.getLabel("tk10004610",a.msge2)}}if(this.pouch.isProhibitInputTimeUntilApproved()){var n=e.rack.validApplys.exchangeS;if(
n&&n.status==teasp.constant.STATUS_WAIT)return teasp.message.getLabel("tk10005240",a.msge2,n.applyType);if((n=e.rack.validApplys.exchangeE)&&n.status==teasp.constant.STATUS_WAIT)return teasp.message.getLabel("tk10005240",a.msge2,n.applyType);if((n=e.rack.validApplys.kyushtu&&0<e.rack.validApplys.kyushtu.length?e.rack.validApplys.kyushtu[0]:null)&&n.status==teasp.constant.STATUS_WAIT)return teasp.message.getLabel(
"tk10005240",a.msge2,n.applyType)}if(!this.pouch.getEmpDay(e.date).isFlexHalfDayTimeDay()||t.range!=teasp.constant.RANGE_AM&&t.range!=teasp.constant.RANGE_PM){s=0<e.rack.validApplys.reviseTime.length?e.rack.validApplys.reviseTime[0]:null;if(s&&s.status==teasp.constant.STATUS_WAIT)return teasp.message.getLabel("tf10011300",a.msge2)}return o&&t.range==teasp.constant.RANGE_ALL&&(
n=0<e.rack.validApplys.zangyo.length?e.rack.validApplys.zangyo[0]:null,s=0<e.rack.validApplys.earlyStart.length?e.rack.validApplys.earlyStart[0]:null,a=e.rack.validApplys.lateStart,t=e.rack.validApplys.earlyEnd,n&&(o[n.applyType]=1,o.cnt++),s&&(o[s.applyType]=1,o.cnt++),a&&(o[a.applyType]=1,o.cnt++),t&&(o[t.applyType]=1,o.cnt++)),null},teasp.dialog.EmpApply.prototype.requestDirectApply=function(r,e,t){
e.client=this.client,teasp.manager.dialogOpen("BusyWait");var a,l=teasp.util.date.getDateList(e.apply.startDate,e.apply.endDate),p=0,d=e.client,o=e.apply.note,c=(p=t?(t=this.dayWrap.getEmpApplyByKey(teasp.constant.APPLY_KEY_DIRECT),a=this.dayWrap.getEmpApplyByKey(teasp.constant.APPLY_KEY_KYUSHTU),t&&t.directFlag||a&&a.directFlag||0):e.apply.directFlag,0),m=null,m=dojo.hitch(this,function(){for(
var e=this.pouch.getEmpDay(l[c]),t=e.createTimeTableFix(p),a=-1,o=0;o<t.length;o++)if(1==t[o].type){a=o;break}0<=a&&this.pouch.isProhibitBorderRestTime()&&(s={from:t[a].from,to:t[a].to,rests:teasp.logic.EmpTime.filterTimeTable(t,[teasp.constant.REST_FIX,teasp.constant.REST_FREE],3)},s=teasp.logic.EmpTime.adjustInputTime(s,p),1&p&&t[a].from!=s.from&&(t[a].from=s.from),2&p&&t[a].to!=s.to&&(t[a].to=s.to));
var s=a<0?null:t[a].from,i=a<0?null:t[a].to,n=e.getStartTime(!0,null,teasp.constant.C_REAL),e=e.getEndTime(!0,null,teasp.constant.C_REAL);""===e&&(e=null),(n=""===n?null:n)===s&&e===i?++c<l.length?setTimeout(m,100):(this.onfinishfunc(),this.close(),teasp.manager.dialogClose("BusyWait")):(n={empId:this.pouch.getEmpId(),month:this.pouch.getYearMonth(),startDate:this.pouch.getStartDate(),
lastModifiedDate:this.pouch.getLastModifiedDate(),mode:this.pouch.getMode(),date:l[c],dayFix:!1,client:d,timeTable:t,refreshWork:!0,clearWork:!1,useInputAccessControl:this.pouch.isInputAccessControl()},teasp.manager.request("inputTimeTable",n,this.pouch,{hideBusy:!0},this,function(){++c<l.length?setTimeout(m,100):(this.onfinishfunc(),this.close(),teasp.manager.dialogClose("BusyWait"))},function(e){
teasp.manager.dialogClose("BusyWait"),teasp.dialog.EmpApply.showError(r,teasp.message.getErrorMessage(e))}))});teasp.manager.request("applyEmpDay",e,this.pouch,{hideBusy:!0},this,function(){var e;o&&(e=this.dayWrap.getDayNote(!this.pouch.isSeparateDailyNote()),this.dayWrap.setDayNote((e?e+"\n":"")+o)),setTimeout(m,100)},function(e){teasp.manager.dialogClose("BusyWait"),teasp.dialog.EmpApply.showError(r,
teasp.message.getErrorMessage(e))},function(){})},teasp.dialog.EmpApply.prototype.cancelDirectApply=function(r,e,l){var p=teasp.util.date.getDateList(l.startDate,l.endDate),d=l.directFlag,c=this.client,m=(teasp.manager.dialogOpen("BusyWait"),0),h=null,h=dojo.hitch(this,function(){for(var e=this.pouch.getEmpDay(p[m]),t=e.getStartTime(!0,null,teasp.constant.C_REAL),a=e.getEndTime(!0,null,teasp.constant.C_REAL),o=(
""===t&&(t=null),""===a&&(a=null),null),o=d?e.createTimeTable(1&d?null:t,2&d?null:a):e.createTimeTableFix(e.getInputLimit().directFlag),s=-1,i=0;i<o.length;i++)if(1==o[i].type){s=i;break}0<=s&&this.pouch.isProhibitBorderRestTime()&&(e=d||e.getInputLimit().directFlag,n={from:o[s].from,to:o[s].to,rests:teasp.logic.EmpTime.filterTimeTable(o,[teasp.constant.REST_FIX,teasp.constant.REST_FREE],3)},
n=teasp.logic.EmpTime.adjustInputTime(n,e),1&e&&o[s].from!=n.from&&(o[s].from=n.from),2&e&&o[s].to!=n.to&&(o[s].to=n.to));var e=s<0?null:o[s].from,n=s<0?null:o[s].to;t===e&&a===n?++m<p.length?setTimeout(h,100):(this.onfinishfunc(),this.close(),teasp.manager.dialogClose("BusyWait")):(t={empId:this.pouch.getEmpId(),month:this.pouch.getYearMonth(),startDate:this.pouch.getStartDate(),
lastModifiedDate:this.pouch.getLastModifiedDate(),mode:this.pouch.getMode(),date:p[m],dayFix:!1,client:c,timeTable:o,refreshWork:!0,clearWork:!1,empApplyId:l.id,useInputAccessControl:this.pouch.isInputAccessControl()},teasp.manager.request("inputTimeTable",t,this.pouch,{hideBusy:!0},this,function(){++m<p.length?setTimeout(h,100):(this.onfinishfunc(),this.close(),teasp.manager.dialogClose("BusyWait"))},function(e){
teasp.manager.dialogClose("BusyWait"),teasp.dialog.EmpApply.showError(r,teasp.message.getErrorMessage(e))}))});teasp.manager.request("cancelApplyEmpDay",e,this.pouch,{hideBusy:!0},this,function(){setTimeout(h,100)},function(e){teasp.manager.dialogClose("BusyWait"),teasp.dialog.EmpApply.showError(r,teasp.message.getErrorMessage(e))})},teasp.dialog.EmpApply.getString=function(){for(var e=arguments,t=dojo.clone(e[0]),
a=1;a<e.length;a++)t=t.replace(RegExp("\\{"+(a-1)+"\\}","g"),e[a]);return t},teasp.dialog.EmpApply.prototype.checkExchangeApplys=function(t,a,o){var e=teasp.dialog.EmpApply.getString(
"select Id, Status__c, ApplyType__c, StartDate__c, ExchangeDate__c, OriginalStartDate__c, ApplyTime__c from AtkEmpApply__c where EmpId__c = '{0}' and ApplyType__c = '{1}' and OriginalStartDate__c = {2} and TempFlag__c = false and Removed__c = false",this.pouch.getEmpId(),teasp.constant.APPLY_TYPE_EXCHANGE,t);teasp.action.contact.remoteMethods([{funcName:"getExtResult",params:{soql:e,limit:1e3,offset:0}}],{
errorAreaId:null,nowait:!0},function(e){e=teasp.logic.convert.convEmpApplyObjs(e.records);o(e,t,a)},null,this)},teasp.dialog.EmpApply.prototype.adjustMenuHeight=function(e){setTimeout(dojo.hitch(this,function(){var e=dojo.byId("empApplyTableArea"),t=dojo.query("table.emp_apply_menu",e)[0].clientHeight;dojo.query(".dijitTabPaneWrapper,.dijitTabContainerTopChildWrapper,.dijitTabPane",e).forEach(function(e){dojo.style(e
,"height",t+30+"px")}),dojo.query(".dijitTabContainer",e).forEach(function(e){dojo.style(e,"height",t+60+"px")})}),100)},teasp.dialog.EmpApply.adjustContentHeight=function(){setTimeout(dojo.hitch(this,function(){var t,e=dojo.byId("empApplyTableArea"),a=dijit.byId("empApplyTab").selectedChildWidget;a&&(a=dojo.query("div.empApplyContHigh",a.domNode)).length&&(t=a[0].offsetHeight,dojo.query(
".dijitTabPaneWrapper,.dijitTabContainerTopChildWrapper,.dijitTabPane",e).forEach(function(e){dojo.style(e,"height",t+30+"px")}),dojo.query(".dijitTabContainer",e).forEach(function(e){dojo.style(e,"height",t+60+"px")}))}),100)},teasp.dialog.EmpApply.prototype.drawLast=function(e,t){},teasp.dialog.EmpApply.prototype.disableApplyButton=function(e,t){e=dojo.byId("empApplyDone"+e);e&&(dojo.setAttr(e,"disabled",t),
dojo.toggleClass(e,"std-button1",!t),dojo.toggleClass(e,"std-button1-disabled",t))},teasp.dialog.EmpApply.prototype.isNotTheDayApply=function(e,t){return e.startDate!=t&&e.applyType!=teasp.constant.APPLY_TYPE_SHIFTCHANGE},teasp.dialog.EmpApply.prototype.createHolidayForm=function(e,t,j,E,a){var o,s=E&&(teasp.constant.STATUS_FIX.contains(E.status)||E.startDate!=this.args.date)||this.isReadOnly(),i=this.getInputClass(s
,E),n=dojo.create("div",null,t),r=dojo.create("div",{className:"empApply2Div"},n),l=(dojo.create("div",{className:"empApply2CL",innerHTML:teasp.message.getLabel("holidayType_label")},r),dojo.create("div",{className:"empApply2VL"},r)),i=(!E||!s&&E.active?(h=dojo.create("tbody",null,dojo.create("table",{className:"pane_table",style:"width:"+(teasp.isNarrow()?260:330)+"px;"},l)),h=dojo.create("tr",null,h),dojo.create(
"select",{id:"dialogApplyHolidayList"+j,className:i,style:"margin:0px 2px;width:100%;"},dojo.create("td",null,h))):dojo.create("div",{innerHTML:E.holiday.name,style:"margin:0px 2px;word-break:break-all;"},l),dojo.create("div",{id:"dialogApplyHolidayTip"+j,className:"pp_base pp_ico_info",style:{marginLeft:"12px",display:"none"}},dojo.create("td",{style:"width:22px;"},h)),s||(r=dojo.create("div",{
id:"dialogApplyYuqRow"+j,className:"empApply2Div"},n),dojo.create("div",{className:"empApply2CL",innerHTML:teasp.message.getLabel("remainYuq_label")},r),dojo.create("div",{id:"dialogApplyYuq"+j,style:"margin:0px 4px;",className:"empApply2VL",innerHTML:this.pouch.getDspYuqRemain(this.args.date).display},r)),this.pouch.getDateRangeOfMonth(this.args.date,2,-1)),p=(i.from=this.args.date,
this.pouch.isProhibitAcrossMonthApply()&&(i.to=this.monthLastDate),this.createRangeParts(e,n,j,E,i),function(){dojo.byId("dialogApplyTimeNote"+j).innerHTML="";var e=L.apply(this,[dojo.byId("dialogApplyHolidayList"+j)]);if(e&&e.type&&e.range==teasp.constant.RANGE_TIME){var t=teasp.util.time.clock2minutes(dojo.byId("dialogApplyStartTime"+j).value),a=teasp.util.time.clock2minutes(dojo.byId("dialogApplyEndTime"+j).value)
if(!(void 0===t||void 0===a||a<=t||2880<a)){var o=[];if(this.dayWrap.isInputTime()){var s=this.dayWrap.getTimeTable();if(s&&0<s.length)for(var i=0;i<s.length;i++){var n=s[i];n.type==teasp.constant.REST_FIX&&o.push(n)}}else{var r=this.dayWrap.getPattern();r&&r.restTimes&&(o=r.restTimes)}r=a-t;0<o.length&&(0<(t=teasp.util.time.rangeTime({from:t,to:a},o))&&(r-=t)),e.yuqSpend?(r=Math.ceil(r/60),dojo.byId(
"dialogApplyTimeNote"+j).innerHTML=teasp.message.getLabel("tm10003131",r)):e.managed&&(r=30*Math.ceil(r/30),dojo.byId("dialogApplyTimeNote"+j).innerHTML=teasp.message.getLabel("tm10003135",e.manageName,teasp.util.time.timeValue(r))),teasp.dialog.EmpApply.adjustContentHeight()}}}),d=(this.createTimeParts(e,n,j,E,!1,p),this.createNoteParts(e,n,j,E),this.createContactParts(e,n,j,E),this.createApplySetParts(e,n,j,E),
this.createApplyTimeParts(e,n,j,E),this.createStatusParts(e,n,j,E),this.createAnnotateParts(e,n,j),this.createErrorParts(e,n,j),a&&dojo.place(a,n),!E||E.holiday.type!=teasp.constant.HOLIDAY_TYPE_DAIQ&&!E.holiday.managed||(o=E.holiday.type==teasp.constant.HOLIDAY_TYPE_DAIQ?this.daiqZan:(o=this.stockZan[E.holiday.manageName])||(this.stockZan[E.holiday.manageName]=teasp.data.Pouch.getStockZan(this.pouch.getStocks(),
E.holiday.manageName,this.args.date))).applys[E.id]&&(dojo.byId("dialogApplyAnnotate"+j).innerHTML=o.applys[E.id].status),new dijit.Tooltip({connectId:"dialogApplyHolidayTip"+j,label:teasp.message.getLabel("tm10003080"),position:["below"]})),c=function(e){for(var t=0;t<this.holidayList.length;t++)if(this.holidayList[t].id==e)return this.holidayList[t];return null},L=function(e){return e?c.apply(this,[e.value]):null},
m=function(e,t,a){var o,s=e&&this.pouch.isUseDaiqManage()&&e.type==teasp.constant.HOLIDAY_TYPE_DAIQ,i=s||e&&e.managed,s=(this.displayOnOff("dialogApplyHolidayTip"+j,e&&e.name&&e.description),e&&e.description&&(d.label="<b>"+e.name+'</b><br/><div style="overflow:auto;"><pre class="holiday-descript">'+e.description+"</pre></div>"),s||e&&e.range!=teasp.constant.RANGE_ALL);s&&a&&a.startDate!=a.endDate&&(s=!1),
this.displayOnOff("dialogApplyYuqRow"+j,e&&e.yuqSpend),this.displayOnOff("dialogApplyRangeRow"+j,!s),this.displayOnOff("dialogApplyTimeRow"+j,!(!e||e.range!=teasp.constant.RANGE_TIME)),this.displayOnOff("dialogApplyAnnotateRow"+j,!!i),teasp.dialog.EmpApply.showError(j,null),this.disableApplyButton(j,!1),i&&e.range==teasp.constant.RANGE_TIME&&null==this.pouch.getBaseTimeForStock()?(this.disableApplyButton(j,!0),
teasp.dialog.EmpApply.showError(j,teasp.message.getLabel("tm10011090"),!0)):i&&!t&&(a=!0,e.type==teasp.constant.HOLIDAY_TYPE_DAIQ?o=this.daiqZan:(o=this.stockZan[e.manageName],2<=teasp.data.Pouch.getSpendStockChangedBaseTime(o,this.pouch.getConfigHistory(),this.args.date)&&o.zan<1&&(a=!1)),a&&(s=!!o.startDateMin&&teasp.data.Pouch.isZanRoundUp(this.pouch.getConfigHistory(),o,this.args.date),dojo.byId(
"dialogApplyAnnotate"+j).innerHTML=teasp.message.getLabel(this.pouch.isUseDaiqManage()&&e.type==teasp.constant.HOLIDAY_TYPE_DAIQ?"tm10003760":"tm10003761",teasp.data.Pouch.formatDays(o.zan||0,{baseTime:this.pouch.getBaseTimeForStock(),flag:s?1:0}).disp))),p.apply(this)},l=dojo.byId("dialogApplyHolidayList"+j),h=(l?(this.eventHandles.push(dojo.connect(l,"onchange",this,function(e){m.apply(this,[L.apply(this,[e.target]
)])})),m.apply(this,[L.apply(this,[l])])):E&&m.apply(this,[E.holiday,s,E]),this.drawLast(E,t),teasp.data.Pouch.checkStockBaseTime(this.pouch.getEmpId(),this.pouch.getConfigHistory(),this.pouch.getStocks(),this.args.date,null,dojo.hitch(this,function(e,t,a){if(1<=e){this.pouch.setKeyObj("stocks",t);for(var o=0;o<this.holidayList.length;o++){var s=this.holidayList[o];s.managed&&(
this.stockZan[s.manageName]=teasp.data.Pouch.getStockZan(this.pouch.getStocks(),s.manageName,this.args.date),a&&a[s.manageName]?(this.stockZan[s.manageName].zan=0,this.stockZan[s.manageName].valid=!1):this.stockZan[s.manageName].zan<=0&&this.stockZan[s.manageName].valid&&teasp.data.Pouch.getSpendStockChangedBaseTime(this.stockZan[s.manageName],this.pouch.getConfigHistory(),this.args.date)<2&&(
this.stockZan[s.manageName].valid=!1))}}else e<0&&teasp.dialog.EmpApply.showError(j,t);!function(e,t){var a=dojo.byId("dialogApplyHolidayList"+e);if(a){for(var o=!this.dayWrap.canSelectHoliday(),s=0;s<this.holidayList.length;s++){var i=this.holidayList[s];this.pouch.isUseDaiqManage()&&i.type==teasp.constant.HOLIDAY_TYPE_DAIQ&&(this.daiqZan.zan||0)<=0&&(!t||t.holiday.id!=i.id)||!(
!i.managed||this.stockZan[i.manageName].valid||t&&t.holiday.id==i.id)||o&&!i.displayDaysOnCalendar||dojo.create("option",{value:i.id,innerHTML:i.name},a)}t&&(a.value=t.holiday.id),m.apply(this,[L.apply(this,[a])])}}.apply(this,[j,E])})),dojo.byId("empApplyDone"+j));h&&this.eventHandles.push(dojo.connect(h,"onclick",this,function(e){var t={empId:this.pouch.getEmpId(),month:this.pouch.getYearMonth(),
startDate:this.pouch.getStartDate(),lastModifiedDate:this.pouch.getLastModifiedDate(),date:this.args.date,apply:{id:E?E.id:null,applyType:teasp.constant.APPLY_TYPE_HOLIDAY,patternId:null,holidayId:null,status:null,startDate:null,endDate:null,exchangeDate:null,startTime:null,endTime:null,note:dojo.byId("dialogApplyNote"+j).value||null,contact:dojo.byId("dialogApplyContact"+j).value||null}},a=L.apply(this,[dojo.byId(
"dialogApplyHolidayList"+j)]);if(a&&a.type){var o=this.dayWrap.getEmpApplyByKey(teasp.constant.APPLY_KEY_ZANGYO),s=this.dayWrap.getEmpApplyByKey(teasp.constant.APPLY_KEY_EARLYSTART),i=this.dayWrap.getEmpApplyByKey(teasp.constant.APPLY_KEY_LATESTART),n=this.dayWrap.getEmpApplyByKey(teasp.constant.APPLY_KEY_EARLYEND);if(a.range==teasp.constant.RANGE_ALL&&(o||s||i||n))teasp.dialog.EmpApply.showError(j,
teasp.message.getLabel("tm10003040","",teasp.dialog.EmpApply.getApplyTypesName([o,s,i,n])));else{var o=a.yuqSpend?{dt:this.args.date,days:0,minutes:0}:null,r=a.managed?{}:null,s=a.range!=teasp.constant.RANGE_ALL||this.pouch.isUseDaiqManage()&&a.type==teasp.constant.HOLIDAY_TYPE_DAIQ;if(a.config&&a.config.prohibitOverNightWork){var l,i=this.pouch.getEmpDay(teasp.util.date.addDays(this.args.date,-1));if(i){if(
"number"==typeof i.getObj().endTime&&1440<i.getObj().endTime)return void teasp.dialog.EmpApply.showError(j,teasp.message.getLabel("tf10008380",a.name));if((l=i.getEmpApplyByKey(teasp.constant.APPLY_KEY_REVISETIME))&&l.timeTable){n=teasp.logic.EmpTime.filterTimeTable(l.timeTable,1);if(1440<(p=n.length&&n[0].to||0))return void teasp.dialog.EmpApply.showError(j,teasp.message.getLabel("tf10008390",a.name))}}}if(
t.apply.holidayId=a.id,a.range==teasp.constant.RANGE_TIME){if(this.pouch.isHourlyLeaveLimitOfDay(this.args.date))return void teasp.dialog.EmpApply.showError(j,teasp.message.getLabel("tf10010900"),!0);t.apply.startDate=this.args.date,t.apply.endDate=this.args.date;var i=teasp.util.time.clock2minutes(dojo.byId("dialogApplyStartTime"+j).value),p=teasp.util.time.clock2minutes(dojo.byId("dialogApplyEndTime"+j).value);if(
void 0===i||void 0===p)return void teasp.dialog.EmpApply.showError(j,teasp.message.getLabel("tm10003100"));if(p<=i)return void teasp.dialog.EmpApply.showError(j,teasp.message.getLabel("tm10003110"));if(2880<p)return void teasp.dialog.EmpApply.showError(j,teasp.message.getLabel("tm10003120"));var n=this.dayWrap.getSeparatedRests(),d=n.fix,n=n.free.concat(n.paid).concat(n.unpaid);if(0<n.length)if(0<(
c=teasp.util.time.rangeTime({from:i,to:p},n)))return void teasp.dialog.EmpApply.showError(j,teasp.message.getLabel("tm10003140"));n=p-i;if(0<d.length&&0<(c=teasp.util.time.rangeTime({from:i,to:p},d))&&(n-=c),n<=0)return void teasp.dialog.EmpApply.showError(j,teasp.message.getLabel("tm10003110"));o&&(o.days=0,o.minutes=60*Math.ceil(n/60));d=this.dayWrap.getInputTimeRange();if(d&&(i<d.from||p>d.to)
)return void teasp.dialog.EmpApply.showError(j,teasp.message.getLabel("tm10003141"));if(this.pouch.getWorkSystem()==teasp.constant.WORK_SYSTEM_FLEX){var c=this.pouch.getStandardRange({st:this.dayWrap.getFixStartTime(),et:this.dayWrap.getFixEndTime(),pattern:this.dayWrap.getPattern(),timeHolidayApplys:this.dayWrap.getTimeHolidayApply(),useCoreTime:this.dayWrap.isUseCoreTime()});if(i<c.from||c.to<p
)return void teasp.dialog.EmpApply.showError(j,teasp.message.getLabel("tm10003142"))}else if(i<this.dayWrap.getFixStartTime()||this.dayWrap.getFixEndTime()<p)return void teasp.dialog.EmpApply.showError(j,teasp.message.getLabel("tm10003142"));var d=1;if(o?d=60:r&&(d=30),this.dayWrap.isConflictReviseTime(i,p,d))return void teasp.dialog.EmpApply.showError(j,teasp.message.getLabel("tf10011215"));if(t.apply.startTime=i,
t.apply.endTime=p,r&&(r.spd=n/this.pouch.getBaseTime(),r.ds=[t.apply.startDate]),a.timeUnit)if(0!=n%a.timeUnit)return c=Math.floor(n/60),i=((d=Math.floor(n%60))<10?"0":"")+d,p=60!=a.timeUnit?teasp.message.getLabel("th00000100",a.timeUnit):teasp.message.getLabel("th00000050"),void teasp.dialog.EmpApply.showError(j,teasp.message.getLabel("th00000010",c,i,p))}else{if(!this.dayWrap.isFlexHalfDayTimeDay(
)||a.range!=teasp.constant.RANGE_AM&&a.range!=teasp.constant.RANGE_PM)if((l=this.dayWrap.getEmpApplyByKey(teasp.constant.APPLY_KEY_REVISETIME))&&l.status==teasp.constant.STATUS_WAIT)return void teasp.dialog.EmpApply.showError(j,teasp.message.getLabel("tf10011300",teasp.util.date.formatDate(this.args.date,"M/d")));n=teasp.util.strToDate(dojo.byId("dialogApplyStartDate"+j).value);if(0!=n.failed
)return void teasp.dialog.EmpApply.showError(j,dojo.replace(n.tmpl,[teasp.message.getLabel("rangeStartDate_label")]));dojo.byId("dialogApplyStartDate"+j).value=n.dater;d=n;if(!s){if(1==(d=teasp.util.strToDate(dojo.byId("dialogApplyEndDate"+j).value)).failed)dojo.byId("dialogApplyEndDate"+j).value=n.dater,d=n;else if(0!=d.failed)return void teasp.dialog.EmpApply.showError(j,dojo.replace(d.tmpl,[teasp.message.getLabel(
"rangeEndDate_label")]));dojo.byId("dialogApplyEndDate"+j).value=d.dater}if(n.datef!=d.datef){if(0<=dojo.date.compare(n.date,d.date,"date"))return void teasp.dialog.EmpApply.showError(j,teasp.message.getLabel("tm10003160"));if(this.pouch.isProhibitAcrossMonthApply()&&0<teasp.util.date.compareDate(d.date,this.monthLastDate))return void teasp.dialog.EmpApply.showError(j,teasp.message.getLabel("tk10001185"));
var m=dojo.date.add(n.date,"month",1);if(dojo.date.compare(m,d.date,"date")<=0)return void teasp.dialog.EmpApply.showError(j,teasp.message.getLabel("tm10003170"));if(!this.pouch.isApplyLimitOff()){c=this.pouch.getDateRangeOfMonth(teasp.util.date.getToday(),12,-12);if(teasp.util.date.compareDate(c.to,d.date)<=0)return void teasp.dialog.EmpApply.showError(j,teasp.message.getLabel("tm10003180"))}
i=this.pouch.getMonthDay(d.datef);if(!a.displayDaysOnCalendar&&i.dayType!=teasp.constant.DAY_TYPE_NORMAL)return void teasp.dialog.EmpApply.showError(j,teasp.message.getLabel("tk10005400"))}else if(this.pouch.isUseDaiqManage()&&a.type==teasp.constant.HOLIDAY_TYPE_DAIQ||a.managed){p=a.range==teasp.constant.RANGE_ALL?1:.5;if(a.type==teasp.constant.HOLIDAY_TYPE_DAIQ){if((this.daiqZan.zan||0)<p
)return void teasp.dialog.EmpApply.showError(j,teasp.message.getLabel("tm10003700"))}else if((this.stockZan[a.manageName].zan||0)<p)return void teasp.dialog.EmpApply.showError(j,teasp.message.getLabel("tm10003701",a.name))}t.apply.startDate="string"==typeof n?n:n.datef,t.apply.endDate="string"==typeof d?d:d.datef;for(var h=teasp.util.date.getDateList(t.apply.startDate,t.apply.endDate),u=this.pouch.getPlannedHoldays(
)||[],g=0;g<h.length;g++)if("number"==typeof u[h[g]])return void teasp.dialog.EmpApply.showError(j,teasp.message.getLabel("tk10004600"));for(var y=[],g=0;g<h.length;g++){var f=h[g];(m=this.pouch.getMonthDay(f)).dayType||y.push(m.date)}o&&(o.days=(a.range==teasp.constant.RANGE_ALL?1:.5)*y.length,o.minutes=0),r&&(r.spd=a.range==teasp.constant.RANGE_ALL?1:.5,r.ds=y)}if(this.checkPluginHolidayApply(j,t,a,o,r)){var b=[],
_=[];if(o){for(var v=this.pouch.simulateDspYuqRemain(t.apply.startDate,o),g=0;g<v.spends.length;g++){var T=v.spends[g];if(T.ng)if(1==T.planned)b.push(teasp.util.date.formatDate(T.dt,"M/d"));else{if(2!=T.planned)return void teasp.dialog.EmpApply.showError(j,teasp.message.getLabel("tm11012020"));5==_.length?_.push("..."):_.length<5&&_.push(teasp.util.date.formatDate(T.dt,"M/d"))}}if(0<b.length
)return void teasp.dialog.EmpApply.showError(j,teasp.message.getLabel("tk10005070",b.join(", ")));0<_.length&&teasp.manager.dialogOpen("MessageBox",{title:teasp.message.getLabel("em10002080"),message:teasp.message.getLabel("tk10005080",_.join(", "))},this.pouch,this,function(){this.submitHolidayApply(j,t,a,r)})}_.length||this.submitHolidayApply(j,t,a,r)}}}else teasp.dialog.EmpApply.showError(j,teasp.message.getLabel(
"tm10003090"))}))},teasp.dialog.EmpApply.prototype.submitHolidayApply=function(t,a,e,o){if(o){for(var s=this.stockZan[e.manageName].stocks,i=[],n=0;n<s.length;n++){var r=s[n];0<r.days&&0<r.remainDays&&i.push({remainDays:r.remainDays,startDate:r.startDate,limitDate:r.limitDate})}for(var i=i.sort(function(e,t){return e.limitDate==t.limitDate?e.startDate<t.startDate?-1:1:e.limitDate<t.limitDate?-1:1}),l=o.spd,p=[],d=[],
n=0;n<o.ds.length;n++){for(var c=o.ds[n],m=l,h=0;h<i.length&&0<m;h++){var u,g=i[h];0<g.remainDays&&g.startDate<=c&&c<g.limitDate&&(u=Math.min(g.remainDays,m),g.remainDays-=u,m-=u)}(m<=0?p:d).push(c)}}if(e.range!=teasp.constant.RANGE_TIME){for(var y=this.getRangeApplys(a.apply.startDate,a.apply.endDate),f=a.apply.startDate,b={cnt:0};f<=a.apply.endDate;){var _=y[f],_=this.conflictHoliday(_,e,{
msge1:teasp.message.getLabel("range_label"),msge2:teasp.message.getLabel("tm10009070")},b);if(_)return void teasp.dialog.EmpApply.showError(t,_);f=teasp.util.date.addDays(f,1)}if(b.cnt)return void teasp.dialog.EmpApply.showError(t,teasp.message.getLabel("tk10005230",teasp.message.getLabel("tm10009070"),teasp.dialog.EmpApply.getApplyTypesName(b)))}if(teasp.dialog.EmpApply.showError(t,null),!this.pouch.isRequireNote(
teasp.constant.APPLY_KEY_HOLIDAY)||a.apply.note&&a.apply.note.replace(/[\s　]+$/g,"")){var v=this.dayWrap.getObj().rack.validApplys,T=0,j=(v.holidayAm&&(T|=1),v.holidayPm&&(T|=2),v.holidayAll&&(T|=3),e.range==teasp.constant.RANGE_AM&&(T|=1),e.range==teasp.constant.RANGE_PM&&(T|=2),{});if(e.range==teasp.constant.RANGE_ALL||3==(3&T))if(a.apply.startDate!=a.apply.endDate){for(var c=a.apply.startDate,E=!1,
L=this.pouch.getObj().month.endDate;c<=a.apply.endDate;){var k=this.pouch.getObj().works?this.pouch.getClassifyJobWorks(c):null;if(L<c||k&&(0<k.sumTime||0<k.sumVolume)||this.pouch.getObj().days[c]&&("number"==typeof this.pouch.getObj().days[c].startTime||"number"==typeof this.pouch.getObj().days[c].endTime)){E=!0;break}c=teasp.util.date.addDays(c,1)}E&&(j.clear={bullet:!0,title:teasp.message.getLabel("tm10003195")})
}else{k=this.pouch.getObj().works?this.pouch.getClassifyJobWorks(a.apply.startDate):null;(this.dayWrap.isInputTime()||k&&(0<k.sumTime||0<k.sumVolume))&&(j.clear={bullet:!0,title:teasp.message.getLabel("tm10003194")})}else if((e.range==teasp.constant.RANGE_AM||e.range==teasp.constant.RANGE_PM)&&this.dayWrap.isCheckTimeOnHalfHoliday()){v=this.dayWrap.checkInconsistent(e.range);if(v<0
)return void teasp.dialog.EmpApply.showError(t,teasp.message.getLabel("tm10003200"));0<v&&(j.adjust={bullet:!0,title:teasp.message.getLabel("tm10002091",1==v?teasp.message.getLabel("startTime_label"):teasp.message.getLabel("endTime_label"))})}var D=null;2!=e.range&&3!=e.range||3==(3&T)||(v=this.dayWrap.compareRestsAfterApply({holidayRange:e.range})).diff&&(D=v.note,j.noteBreak={style:{marginBottom:"8px"},bullet:!0,
title:teasp.message.getLabel("tf10009770")},j.resetBreak={style:{paddingLeft:"40px"},title:teasp.message.getLabel("tf10009780"),checked:!0}),0<Object.keys(j).length?setTimeout(dojo.hitch(this,function(){teasp.manager.dialogOpen("MessageBox",{title:teasp.message.getLabel("tf10009760"),message:"",check:j,hint:D,dialogWidth:"560px"},this.pouch,this,function(e){a.apply.resetBreak=e.resetBreak&&e.resetBreak.checked||!1,
this.requestSend(t,a)})}),100):this.requestSend(t,a)}else teasp.dialog.EmpApply.showError(t,teasp.message.getLabel("tm10003680"))},teasp.dialog.EmpApply.prototype.checkPluginHolidayApply=function(e,t,a,o,s){return!0},teasp.dialog.EmpApply.prototype.createHolidayWorkForm=function(e,t,p,d,a){function o(e){var t,a=b.apply(this),o=dojo.byId("dialogApplyTimeRest"+p);o&&(o.innerHTML=teasp.util.time.timeValue(a.restTime)),
h&&(o=this.pouch.getDaiqAllBorderTime(),t=this.pouch.isUseHalfDaiq()?this.pouch.getDaiqHalfBorderTime():-1,(u=0)<=t&&a.workTime>=t&&(u=1),a.workTime>=o&&(u|=2),console.log("o.workTime="+a.workTime+" ("+teasp.util.time.timeValue(a.workTime)+"), daiqFlag="+u),v&&v.apply(this),_&&_.apply(this,[null,e]))}var s,i,n,r,c=!1,l=null,m=!1,h=this.pouch.isUseDaiqManage(),u=3,g=(this.dayWrap.getExplicDayType(
)!=teasp.constant.DAY_TYPE_LEGAL_HOLIDAY||this.pouch.isUseDaiqLegalHoliday()?this.dayWrap.isPlannedHoliday()?(m=!0,this.pouch.isUseDaiqManage()&&!d&&(l=teasp.message.getLabel("tm10003840")),h=!1):this.pouch.isNoDaiqExchanged()&&this.dayWrap.isExchangedEdge()&&(d||(l=teasp.message.getLabel("tm10003960")),h=!1):(this.pouch.isUseDaiqManage()&&!d&&(l=teasp.message.getLabel("tm10003770")),h=!1),
d&&teasp.constant.STATUS_FIX.contains(d.status)||this.isReadOnly()),y=this.getInputClass(g,d),f=dojo.create("div",null,t),b=(this.holidayWorkRests=this.dayWrap.getPattern().restTimes||[],(this.pouch.isHolidayWorkRestChangeable()||g)&&d&&d.timeTable&&(this.holidayWorkRests=teasp.util.extractTimes(d.timeTable)),this.holidayWorkRestChangeable=!1,g||this.pouch.isHideTimeGraphPopup()||(T=dojo.create("div",{
id:"dialogApplyZangyoRow"+p,className:"empApply2Div"},f),dojo.create("div",{className:"empApply2CL",innerHTML:teasp.message.getLabel("zangyoOfMonth_label")},T),dojo.create("div",{className:"empApply2VL",innerHTML:this.pouch.getMonthSubTimeByKey("workLegalOutOverTime"),id:"dialogApplyZangyo"+p,style:"margin:0px 4px;"},T)),function(){var e=teasp.util.time.clock2minutes(dojo.byId("dialogApplyStartTime"+p).value),
t=teasp.util.time.clock2minutes(dojo.byId("dialogApplyEndTime"+p).value),a=0,o=0,s=this.holidayWorkRests;if("number"==typeof e&&"number"==typeof t&&e<t){for(var a=t-e-(o=teasp.util.time.rangeTime({from:e,to:t},s)),i=this.pouch.getRestTimeCheck(),n=0,r=0;r<i.length;r++){var l=i[r];l.check&&l.push&&a>l.workTime&&o<l.restTime&&(n<(l=l.restTime-o)&&(n=l))}o=t-e-(a-=n)}return{workTime:a,restTime:o}}),_=null,v=null;if(
this.createTimeParts(e,f,p,d,this.pouch.isUseRegulateHoliday()||m,o),(this.pouch.isHolidayWorkRestChangeable()||g&&d&&d.timeTable)&&(this.holidayWorkRestChangeable=!0,I=dojo.byId("dialogApplyTimeNote"+p),T=dojo.create("tr",null,dojo.create("tbody",null,dojo.create("table",{className:"pane_table horizon"},I,"before"))),I=dojo.create("td",{style:{paddingTop:"1px"}},T),dojo.create("div",{
style:"margin:5px 6px 5px 2px;font-weight:bold;float:left;",innerHTML:teasp.message.getLabel("restTime_label")},I),dojo.create("div",{id:"dialogApplyTimeRest"+p,style:"margin:5px;float:left;",innerHTML:"0:00"},I),r=dojo.create("button",{id:"dialogApplyTimeRestChange"+p,className:"std-button2",style:"margin:0px 8px 0px 0px;"},I),dojo.create("div",{style:"margin:2px 6px;float:left;",innerHTML:teasp.message.getLabel(
g?"setting_btn_title":"change_btn_title")},r),this.eventHandles.push(dojo.connect(r,"onclick",this,function(){teasp.manager.dialogOpen("RestInput",{rests:this.holidayWorkRests,fxtimes:this.dayWrap.getFixTimeNums(),note:function(){for(var e=this.pouch.getRestTimeCheck(),t=[],a=0;a<e.length;a++){var o=e[a];o.check&&o.push&&t.push(teasp.message.getLabel("tf10007290",teasp.util.time.timeValue(o.workTime),
teasp.util.time.timeValue(o.restTime)))}return 0<t.length?teasp.message.getLabel("tf10007300",t.join(teasp.message.getLabel("tm10001560"))):null}.apply(this),fix:g},this.pouch,this,function(e){this.holidayWorkRests=e,o.apply(this,[!0])})}))),(this.pouch.isUseDirectApply()||g&&d&&(d.directFlag||d.travelTime))&&(T=dojo.create("div",{className:"empApply2Div"},f),dojo.create("div",{className:"empApply2CL",
innerHTML:teasp.message.getLabel("tk10004670")},T),I=dojo.create("div",{className:"empApply2VL",style:"padding:0px;"},T),r=dojo.create("tbody",null,dojo.create("table",{className:"pane_table"},I)),I=dojo.create("tr",null,r),r=dojo.create("td",{style:{paddingTop:"1px"}},I),I=dojo.create("div",{style:{margin:"2px 4px 2px 0px",float:"left"}},r),k=dojo.create("label",null,I),s=dojo.create("input",{type:"checkbox",style:{
margin:"2px"},id:"dialogApplyDirectIn"+p},k),dojo.create("span",{innerHTML:teasp.message.getLabel("tk10004680"),style:{margin:"2px"}},k),I=dojo.create("div",{style:{margin:"2px 4px 2px 0px",float:"left"}},r),k=dojo.create("label",null,I),r=dojo.create("input",{type:"checkbox",style:{margin:"2px"},id:"dialogApplyDirectOut"+p},k),dojo.create("span",{innerHTML:teasp.message.getLabel("tk10004690"),style:{margin:"2px"}},k
),d&&(s.checked=0!=(1&d.directFlag),r.checked=0!=(2&d.directFlag)),s.disabled=d&&(teasp.constant.STATUS_FIX.contains(d.status)||!d.active),r.disabled=d&&(teasp.constant.STATUS_FIX.contains(d.status)||!d.active),teasp.isNarrow()&&(T=dojo.create("div",{className:"empApply2Div"},f)),dojo.create("div",{className:"empApply2CL",style:teasp.isNarrow()?"":"min-width:100px;margin-left:20px;",innerHTML:teasp.message.getLabel(
"tk10004710")},T),I=dojo.create("input",{type:"text",id:"dialogApplyTravelTime"+p,style:"margin:2px;",className:"inputime "+y},dojo.create("div",{className:"empApply2VL"},T)),d&&("number"==typeof d.travelTime&&(I.value=teasp.util.time.timeValue(d.travelTime)),this.changeInputAreaView(I,d,g)),g?I.readOnly="readOnly":(this.eventHandles.push(dojo.connect(I,"blur",this,teasp.util.time.onblurTime)),this.eventHandles.push(
dojo.connect(I,"onkeypress",this,teasp.util.time.onkeypressTime)))),this.pouch.isUseDirectApply()||g&&d&&d.workType){var T=dojo.create("div",{className:"empApply2Div"},f);if(dojo.create("div",{className:"empApply2CL",innerHTML:teasp.message.getLabel("tk10004700")},T),!d||!g&&d.active){var j=dojo.create("select",{id:"dialogApplyWorkType"+p,className:y,style:"width:100%;margin:2px;"},dojo.create("div",{
className:"empApply2VL",style:dojo.string.substitute("width:${0};",[this.valueWidth])},T)),E=this.pouch.getWorkTypeList()||[];dojo.create("option",{value:"",innerHTML:""},j);for(var L=0;L<E.length;L++)dojo.create("option",{value:E[L],innerHTML:E[L]},j);T.style.display=0<E.length?"":"none"}else{var k=d.workType||"";dojo.create("div",{className:"empApply2VL",innerHTML:k,style:"margin:2px;"},T),
T.style.display=k?"":"none"}}this.createNoteParts(e,f,p,d),(h&&this.pouch.isUseDaiqReserve()||d&&d.daiqReserve&&d.daiqDate1)&&(c=this.pouch.isUseHalfDaiq()||d&&d.daiqDate2,T=dojo.create("div",{className:"empApply2Div",id:"dialogApplyDaiqResvRow"+p},f),dojo.create("div",{className:"empApply2CL",innerHTML:teasp.message.getLabel("daiqReserve_label")},T),dojo.create("input",{type:"checkbox",checked:!0,
id:"dialogApplyDaiqResv"+p},dojo.create("div",{className:"empApply2VL"},T)),T=dojo.create("div",{className:"empApply2Div",id:"dialogApplyDaiq1DateRow"+p},f),dojo.create("div",{className:"empApply2CL",innerHTML:teasp.message.getLabel(c?"daiqDate1_label":"daiqDate_label")},T),s=dojo.create("tr",null,dojo.create("tbody",null,dojo.create("table",{className:"pane_table"},dojo.create("div",{className:"empApply2VL"},T)))),
dojo.create("input",{type:"text",id:"dialogApplyDaiq1Date"+p,style:{margin:"2px"},className:"inpudate "+y},dojo.create("td",null,s)),i=g?null:dojo.create("input",{type:"button",id:"dialogApplyDaiq1DateCal"+p,style:{margin:"2px"},className:"pp_base pp_btn_cal_dis"},dojo.create("td",null,s)),D=dojo.create("td",{className:"daiq1-option"},s),(v=function(e){var t,a,e=e||dojo.query(
"#dialogApplyDaiq1DateRow"+p+" td.daiq1-option")[0];e&&(t="1",(a=dojo.byId("dialogApplyDaiq1Option"+p))?t=a.value:a=dojo.create("select",{id:"dialogApplyDaiq1Option"+p,style:"margin-left:4px;",className:"inputran"},e),dojo.empty(a),dojo.create("option",{value:"0",innerHTML:""},a),2&u?dojo.create("option",{value:"1",innerHTML:teasp.message.getLabel("holidayDay_label")},a):"1"==t&&(t="0"),this.pouch.isUseHalfDaiq(
)||d&&d.daiqReserve&&"1"!=d.daiqDate1Range?(dojo.create("option",{value:"2",innerHTML:teasp.message.getLabel("holidayAm_label")},a),dojo.create("option",{value:"3",innerHTML:teasp.message.getLabel("holidayPm_label")},a)):this.pouch.isUseHalfDaiq()||dojo.style(e,"display","none"),a.value=t)}).apply(this,[D]),T=dojo.create("div",{className:"empApply2Div",id:"dialogApplyDaiq2DateRow"+p},f),dojo.create("div",{
className:"empApply2CL",innerHTML:teasp.message.getLabel("daiqDate2_label")},T),s=dojo.create("tr",null,dojo.create("tbody",null,dojo.create("table",{className:"pane_table"},dojo.create("div",{className:"empApply2VL"},T)))),dojo.create("input",{type:"text",id:"dialogApplyDaiq2Date"+p,style:{margin:"2px"},className:"inpudate "+y},dojo.create("td",null,s)),n=g?null:dojo.create("input",{type:"button",
id:"dialogApplyDaiq2DateCal"+p,style:{margin:"2px"},className:"pp_base pp_btn_cal_dis"},dojo.create("td",null,s)),j=dojo.create("select",{id:"dialogApplyDaiq2Option"+p,style:"margin-left:4px;",className:"inputran"},dojo.create("td",null,s)),dojo.create("option",{value:"0",innerHTML:""},j),dojo.create("option",{value:"2",innerHTML:teasp.message.getLabel("holidayAm_label")},j),dojo.create("option",{value:"3",
innerHTML:teasp.message.getLabel("holidayPm_label")},j),j.value="0",c||dojo.style(T,"display","none"),d?(dojo.byId("dialogApplyDaiqResv"+p).checked=d.daiqReserve,dojo.byId("dialogApplyDaiq1Date"+p).value=teasp.util.date.formatDate(d.daiqDate1,"SLA"),i&&(i.className="pp_base pp_btn_cal"),dojo.byId("dialogApplyDaiq1Option"+p).value=d.daiqDate1Range||"1","1"==d.daiqDate1Range?(dojo.byId("dialogApplyDaiq2Date"+p
).value="",n&&(n.className="pp_base pp_btn_cal_dis"),dojo.byId("dialogApplyDaiq2Option"+p).value="0"):(dojo.byId("dialogApplyDaiq2Date"+p).value=teasp.util.date.formatDate(d.daiqDate2,"SLA"),n&&(n.className="pp_base pp_btn_cal"),dojo.byId("dialogApplyDaiq2Option"+p).value=d.daiqDate2Range||"0"),g&&(dojo.byId("dialogApplyDaiqResv"+p).disabled=!0,dojo.byId("dialogApplyDaiq1Date"+p).disabled=!0,dojo.byId(
"dialogApplyDaiq2Date"+p).disabled=!0,dojo.toggleClass(dojo.byId("dialogApplyDaiq1Option"+p),"inputro",!0),dojo.toggleClass(dojo.byId("dialogApplyDaiq2Option"+p),"inputro",!0))):(dojo.byId("dialogApplyDaiq1Date"+p).value="",i&&(i.className="pp_base pp_btn_cal"),dojo.byId("dialogApplyDaiq1Option"+p).value="1",dojo.byId("dialogApplyDaiq2Date"+p).value="",n&&(n.className="pp_base pp_btn_cal_dis"),dojo.byId(
"dialogApplyDaiq2Option"+p).value="0",dojo.byId("dialogApplyDaiq2Date"+p).disabled=!0,dojo.byId("dialogApplyDaiq2Option"+p).disabled=!0,dojo.toggleClass(dojo.byId("dialogApplyDaiq2Option"+p),"inputro",!0)),r=dojo.hitch(this,function(e){var t=e;return dojo.hitch(this,function(e){var a;dojo.byId(t).disabled||(a=(a=teasp.util.date.parseDate(dojo.byId(t).value))||teasp.util.date.parseDate(this.args.date),
teasp.manager.dialogOpen("Calendar",{date:a,isDisabledDateFunc:dojo.hitch(this,function(e){var t=teasp.util.date.formatDate(e);return 0!=teasp.util.date.compareDate(e,a)&&!this.daiqableMap[t]})},null,this,function(e){dojo.byId(t).value=teasp.util.date.formatDate(e,"SLA")}))})}),g||(this.eventHandles.push(dojo.connect(i,"onclick",this,r("dialogApplyDaiq1Date"+p))),c&&this.eventHandles.push(dojo.connect(n,"onclick",
this,r("dialogApplyDaiq2Date"+p)))),_=function(e,t){e||u||t||(dojo.byId("dialogApplyDaiqResv"+p).checked=!1);e=dojo.byId("dialogApplyDaiqResv"+p).checked,t=g||!e||!u,dojo.byId("dialogApplyDaiq1Date"+p).disabled=t,i&&(i.className="pp_base "+(t?"pp_btn_cal_dis":"pp_btn_cal")),dojo.byId("dialogApplyDaiq1Option"+p).disabled=t,dojo.toggleClass(dojo.byId("dialogApplyDaiq1Option"+p),"inputro",t),t=dojo.byId(
"dialogApplyDaiq1Option"+p).value,e=g||!e||!(2&u)||"1"==t||"0"==t;dojo.byId("dialogApplyDaiq2Date"+p).disabled=e,n&&(n.className="pp_base "+(e?"pp_btn_cal_dis":"pp_btn_cal")),dojo.byId("dialogApplyDaiq2Option"+p).disabled=e,dojo.toggleClass(dojo.byId("dialogApplyDaiq2Option"+p),"inputro",e)},this.eventHandles.push(dojo.connect(dojo.byId("dialogApplyDaiqResv"+p),"onclick",this,_)),c&&this.eventHandles.push(
dojo.connect(dojo.byId("dialogApplyDaiq1Option"+p),"onchange",this,function(e){var t=dojo.byId("dialogApplyDaiq1Option"+p).value,t=!(2&u)||"1"==t||"0"==t;dojo.byId("dialogApplyDaiq2Date"+p).disabled=t,n&&(n.className="pp_base "+(t?"pp_btn_cal_dis":"pp_btn_cal")),dojo.byId("dialogApplyDaiq2Option"+p).disabled=t,dojo.toggleClass(dojo.byId("dialogApplyDaiq2Option"+p),"inputro",t)}))),l&&(T=dojo.create("div",{
className:"empApply2Div"},f),dojo.create("div",{className:"empApply2CL"},T),dojo.create("div",{className:"empApply2VL",innerHTML:l},T)),this.createApplySetParts(e,f,p,d),this.createApplyTimeParts(e,f,p,d),this.createStatusParts(e,f,p,d),this.createAnnotateParts(e,f,p),this.createErrorParts(e,f,p),a&&dojo.place(a,f);var D,I=dojo.byId("dialogApplyTimeNote"+p),y=((d?(this.displayOnOff("dialogApplyAnnotateRow"+p,!0),
this.daiqZan.applys[d.id]&&(dojo.byId("dialogApplyAnnotate"+p).innerHTML=this.daiqZan.applys[d.id].status),d.afterFlag):(k=this.dayWrap.getDefaultZangyoRange(!0),dojo.byId("dialogApplyStartTime"+p).value=teasp.util.time.timeValue(k.from,this.timeForm),dojo.byId("dialogApplyEndTime"+p).value=teasp.util.time.timeValue(k.to,this.timeForm),this.displayOnOff("dialogApplyAnnotateRow"+p,!1),D=teasp.util.date.getToday(),
teasp.util.date.compareDate(this.args.date,D)<0))&&this.pouch.isClarifyAfterApply()&&(I.innerHTML=teasp.message.getLabel("tm10001680",teasp.message.getLabel("tk10004030")),I.style.color="black"),o.apply(this,[!0]),this.drawLast(d,t),dojo.byId("empApplyDone"+p));y&&this.eventHandles.push(dojo.connect(y,"onclick",this,function(e){var t=dojo.byId("dialogApplyDaiqResv"+p),a=2&u?1:1&u?.5:0,
o=t?t.checked:this.pouch.isUseDaiqManage()&&h,a={empId:this.pouch.getEmpId(),month:this.pouch.getYearMonth(),startDate:this.pouch.getStartDate(),lastModifiedDate:this.pouch.getLastModifiedDate(),date:this.args.date,apply:{id:d?d.id:null,applyType:teasp.constant.APPLY_TYPE_KYUSHTU,patternId:null,holidayId:null,status:null,startDate:this.args.date,endDate:this.args.date,exchangeDate:null,
startTime:teasp.util.time.clock2minutes(dojo.byId("dialogApplyStartTime"+p).value),endTime:teasp.util.time.clock2minutes(dojo.byId("dialogApplyEndTime"+p).value),note:dojo.byId("dialogApplyNote"+p).value||null,contact:null,daiqReserve:o,daiqProvide:a,daiqDate1:null,daiqDate1Range:null,daiqDate2:null,daiqDate2Range:null,useRegulateHoliday:o&&this.pouch.isUseRegulateHoliday()||m,afterFlag:!1,directFlag:0,workType:null,
travelTime:null,timeTable:function(){if(this.holidayWorkRestChangeable){for(var e=this.holidayWorkRests||[],t=[],a=0;a<e.length;a++){for(var o=e[a],s=""+o.from,i=""+o.to,n=""+o.type;s.length<4;)s="0"+s;for(;i.length<4;)i="0"+i;for(;n.length<2;)n="0"+n;t.push(s+i+n)}return t.join(":")+":"}return null}.apply(this)}};if(void 0===a.apply.startTime||void 0===a.apply.endTime)teasp.dialog.EmpApply.showError(p,
teasp.message.getLabel("tm10003100"));else if(a.apply.startTime>=a.apply.endTime)teasp.dialog.EmpApply.showError(p,teasp.message.getLabel("tm10003110"));else if(1440<=a.apply.startTime)teasp.dialog.EmpApply.showError(p,teasp.message.getLabel("tm10002030"));else if(2880<a.apply.endTime)teasp.dialog.EmpApply.showError(p,teasp.message.getLabel("tm10003120"));else{if(t&&a.apply.daiqReserve){o=teasp.util.strToDate(
dojo.byId("dialogApplyDaiq1Date"+p).value);if(1<o.failed)return void teasp.dialog.EmpApply.showError(p,dojo.replace(o.tmpl,[teasp.message.getLabel(c?"daiqDate1_label":"daiqDate_label")]));t=dojo.byId("dialogApplyDaiq1Option"+p).value;if(0==o.failed&&this.pouch.isUseHalfDaiq()){if("0"==t||!t)return void teasp.dialog.EmpApply.showError(p,teasp.message.getLabel("tm10003232"))}else t="1";var s=dojo.byId(
"dialogApplyDaiq2Date"+p),i=null,n=null;if(s){if(1<(i=teasp.util.strToDate(s.value)).failed)return void teasp.dialog.EmpApply.showError(p,dojo.replace(i.tmpl,[teasp.message.getLabel("daiqDate2_label")]));if(n=dojo.byId("dialogApplyDaiq2Option"+p).value,1==o.failed&&0==i.failed)return void teasp.dialog.EmpApply.showError(p,teasp.message.getLabel("tm10003220"));if("1"!=t&&0==i.failed&&"0"==n
)return void teasp.dialog.EmpApply.showError(p,teasp.message.getLabel("tm10003230"));if(o.datef==i.datef&&t==n)return void teasp.dialog.EmpApply.showError(p,teasp.message.getLabel("tm10003231"))}if(0==o.failed){if(!this.daiqableMap[o.datef])return void teasp.dialog.EmpApply.showError(p,teasp.message.getLabel("tf10007940",teasp.message.getLabel("daiqDate1_label")));a.apply.daiqDate1=o.datef,a.apply.daiqDate1Range=t;
var s=this.getRangeApplys(a.apply.daiqDate1),r={cnt:0},l=this.conflictHoliday(s[a.apply.daiqDate1],{range:t},{msge1:teasp.message.getLabel("tk10005200"),msge2:teasp.message.getLabel("tk10005200")},r);if(l)return void teasp.dialog.EmpApply.showError(p,l);if(r.cnt)return void teasp.dialog.EmpApply.showError(p,teasp.message.getLabel("tk10005230",teasp.message.getLabel("tk10005200"),
teasp.dialog.EmpApply.getApplyTypesName(r)));if("1"!=t&&i&&0==i.failed){if(!this.daiqableMap[i.datef])return void teasp.dialog.EmpApply.showError(p,teasp.message.getLabel("tf10007940",teasp.message.getLabel("daiqDate2_label")));if(a.apply.daiqDate2=i.datef,a.apply.daiqDate2Range=n,s=this.getRangeApplys(a.apply.daiqDate2),r={cnt:0},l=this.conflictHoliday(s[a.apply.daiqDate2],{range:n},{msge1:teasp.message.getLabel(
"tk10005200"),msge2:teasp.message.getLabel("tk10005200")},r))return void teasp.dialog.EmpApply.showError(p,l);if(o.datef==i.datef){t=s[a.apply.daiqDate1];if((t&&t.rack&&t.rack.validApplys&&t.rack.validApplys.holidayTime||[]).length)return void teasp.dialog.EmpApply.showError(p,teasp.message.getLabel("tk10004610",teasp.message.getLabel("tk10005200")))}if(r.cnt)return void teasp.dialog.EmpApply.showError(p,
teasp.message.getLabel("tk10005230",teasp.message.getLabel("tk10005200"),teasp.dialog.EmpApply.getApplyTypesName(r)))}}}!this.pouch.isRequireNote(teasp.constant.APPLY_KEY_KYUSHTU)||a.apply.note&&a.apply.note.replace(/[\s　]+$/g,"")?(a.apply.afterFlag=this.getAfterFlag(teasp.constant.APPLY_KEY_KYUSHTU,a.apply.startDate,a.apply.startTime,a.apply.endTime),teasp.dialog.EmpApply.showError(p,null),
this.pouch.isUseDirectApply()?(dojo.byId("dialogApplyDirectIn"+p).checked&&(a.apply.directFlag|=1),dojo.byId("dialogApplyDirectOut"+p).checked&&(a.apply.directFlag|=2),a.apply.workType=dojo.byId("dialogApplyWorkType"+p).value||null,n=teasp.util.time.clock2minutes(dojo.byId("dialogApplyTravelTime"+p).value),a.apply.travelTime="number"==typeof n?n:null,this.requestDirectApply(p,a)):this.requestSend(p,a)
):teasp.dialog.EmpApply.showError(p,teasp.message.getLabel("tm10003680"))}}))},teasp.dialog.EmpApply.prototype.createZangyoForm=function(e,t,s,i,a){var o=dojo.create("div",null,t),n=(i||this.pouch.isHideTimeGraphPopup()||(l=dojo.create("div",{id:"dialogApplyZangyoRow"+s,className:"empApply2Div"},o),dojo.create("div",{className:"empApply2CL",innerHTML:teasp.message.getLabel("zangyoOfMonth_label")},l),dojo.create("div"
,{id:"dialogApplyZangyo"+s,style:"margin:8px 4px;",className:"empApply2VL",innerHTML:this.pouch.getMonthSubTimeByKey("workLegalOutOverTime")},l)),this.pouch.getOverTimeBorderTime(this.dayWrap.getFixEndTime())),r=this.pouch.getUseOverTimeFlag(),l=(!this.pouch.isUseBulkOverTime()||this.client!=teasp.constant.APPLY_CLIENT_MONTHLY||i&&i.status==teasp.constant.STATUS_WAIT||(l=dojo.create("div",{className:"empApply2Div"},o
),dojo.create("div",{className:"empApply2CL",innerHTML:teasp.message.getLabel("date_head")},l),dojo.create("input",{type:"text",id:"dialogApplyStartDate"+s,readOnly:"readOnly",className:"inputro inpudate",style:"margin:2px;",value:teasp.util.date.formatDate(i?i.startDate:this.args.date,"SLA")},dojo.create("div",{className:"empApply2VL"},l)),teasp.isNarrow()&&(l=dojo.create("div",{className:"empApply2Div"},o),
dojo.create("div",{className:"empApply2CL"},l)),l=dojo.create("a",{innerHTML:teasp.message.getLabel("tf10005110"),style:"color:#000080;text-decoration:underline;cursor:pointer;"},dojo.create("div",{className:"empApply2VL",style:"margin:4px 0px 0px 12px;"},l)),dojo.connect(l,"onclick",this,function(){this.close(),this.onfinishfunc(!1,{date:this.args.date,applyType:teasp.constant.APPLY_TYPE_ZANGYO})})),
this.createTimeParts(e,o,s,i,!1,function(){var e=teasp.util.time.clock2minutes(dojo.byId("dialogApplyStartTime"+s).value),t=this.dayWrap.getDefaultZangyoRange(!1,n,r),a=null;2&r&&t.bdrTime<e&&(dojo.style("dialogApplyWarnRow"+s,"display",""),a=teasp.message.getLabel("tk10001174",teasp.util.time.timeValue(t.bdrTime,this.timeForm),t.bdrFlag?teasp.message.getLabel("tk10001210"):"")),teasp.dialog.EmpApply.showWarn(s,a)}),
this.createNoteParts(e,o,s,i),this.createApplySetParts(e,o,s,i),this.createApplyTimeParts(e,o,s,i),this.createStatusParts(e,o,s,i),this.createErrorParts(e,o,s),this.createWarnParts(e,o,s),a&&dojo.place(a,o),dojo.byId("dialogApplyTimeNote"+s)),o=((i?i.afterFlag:(e=this.dayWrap.getDefaultZangyoRange(!1,n,r),dojo.byId("dialogApplyStartTime"+s).value=teasp.util.time.timeValue(e.from,this.timeForm),dojo.byId(
"dialogApplyEndTime"+s).value=teasp.util.time.timeValue(e.to,this.timeForm),a=teasp.util.date.getToday(),teasp.util.date.compareDate(this.args.date,a)<0))&&this.pouch.isClarifyAfterApply()&&(l.innerHTML=teasp.message.getLabel("tm10001680",teasp.message.getLabel("tk10004030")),l.style.color="black"),this.drawLast(i,t),dojo.byId("empApplyDone"+s));o&&this.eventHandles.push(dojo.connect(o,"onclick",this,function(e){
var t={empId:this.pouch.getEmpId(),month:this.pouch.getYearMonth(),startDate:this.pouch.getStartDate(),lastModifiedDate:this.pouch.getLastModifiedDate(),date:this.args.date,apply:{id:i?i.id:null,applyType:teasp.constant.APPLY_TYPE_ZANGYO,patternId:null,holidayId:null,status:null,startDate:this.args.date,endDate:this.args.date,exchangeDate:null,startTime:teasp.util.time.clock2minutes(dojo.byId("dialogApplyStartTime"+s
).value),endTime:teasp.util.time.clock2minutes(dojo.byId("dialogApplyEndTime"+s).value),note:dojo.byId("dialogApplyNote"+s).value||null,contact:null,afterFlag:!1}};if(void 0===t.apply.startTime||void 0===t.apply.endTime)teasp.dialog.EmpApply.showError(s,teasp.message.getLabel("tm10003100"));else if(t.apply.startTime>=t.apply.endTime)teasp.dialog.EmpApply.showError(s,teasp.message.getLabel("tm10003110"));else{if(
t.apply.startTime<this.dayWrap.getFixStartTime())return o=this.dayWrap.getDayType()==teasp.constant.DAY_TYPE_NORMAL?"tm10003115":"tm10003116",void teasp.dialog.EmpApply.showError(s,teasp.message.getLabel(o));if(2880<t.apply.endTime)teasp.dialog.EmpApply.showError(s,teasp.message.getLabel("tm10003120"));else{var a=this.dayWrap.getDefaultZangyoRange(!1,n,r);if(!(2&r)&&t.apply.startTime!=a.from
)return o=this.dayWrap.getDayType()==teasp.constant.DAY_TYPE_NORMAL?"tm10003111":"tm10003112",void teasp.dialog.EmpApply.showError(s,teasp.message.getLabel(o));if(this.dayWrap.getDayType()==teasp.constant.DAY_TYPE_NORMAL&&!this.dayWrap.isPlannedHoliday())if(0<teasp.util.time.rangeTime({from:t.apply.startTime,to:t.apply.endTime},[{from:a.shiftStartTime,to:a.shiftEndTime}]))return void teasp.dialog.EmpApply.showError(s
,teasp.message.getLabel("tm10003210"));if(!this.pouch.isRequireNote(teasp.constant.APPLY_KEY_ZANGYO)||t.apply.note&&t.apply.note.replace(/[\s　]+$/g,""))if(teasp.dialog.EmpApply.showError(s,null),t.apply.afterFlag=this.getAfterFlag(teasp.constant.APPLY_KEY_ZANGYO,t.apply.startDate,t.apply.startTime,t.apply.endTime),this.dayWrap.getInputLimit().flag){if(1440<t.apply.endTime&&2&this.dayWrap.getInputLimit().flag){
var o=this.pouch.getEmpDay(teasp.util.date.addDays(this.args.date,1)).getProhibitOverNightWorkHoliday();if(o)return void teasp.dialog.EmpApply.showError(s,teasp.message.getLabel("tf10008360",o.name))}this.requestDirectApply(s,t,!0)}else this.requestSend(s,t);else teasp.dialog.EmpApply.showError(s,teasp.message.getLabel("tm10003680"))}}}))},teasp.dialog.EmpApply.prototype.createEarlyStartForm=function(e,t,s,i,a){
var o=dojo.create("div",null,t),n=(i||this.pouch.isHideTimeGraphPopup()||(l=dojo.create("div",{id:"dialogApplyEarlyStartRow"+s,className:"empApply2Div"},o),dojo.create("div",{className:"empApply2CL",innerHTML:teasp.message.getLabel("zangyoOfMonth_label")},l),dojo.create("div",{id:"dialogApplyEarlyStart"+s,style:"margin:8px 4px;",className:"empApply2VL",innerHTML:this.pouch.getMonthSubTimeByKey("workLegalOutOverTime")
},l)),this.pouch.getEarlyWorkBorderTime(this.dayWrap.getFixStartTime())),r=this.pouch.getUseEarlyWorkFlag(),l=(!this.pouch.isUseBulkEarlyWork()||this.client!=teasp.constant.APPLY_CLIENT_MONTHLY||i&&i.status==teasp.constant.STATUS_WAIT||(l=dojo.create("div",{className:"empApply2Div"},o),dojo.create("div",{className:"empApply2CL",innerHTML:teasp.message.getLabel("date_head")},l),dojo.create("input",{type:"text",
id:"dialogApplyStartDate"+s,readOnly:"readOnly",className:"inputro inpudate",style:"margin:2px;",value:teasp.util.date.formatDate(i?i.startDate:this.args.date,"SLA")},dojo.create("div",{className:"empApply2VL"},l)),teasp.isNarrow()&&(l=dojo.create("div",{className:"empApply2Div"},o),dojo.create("div",{className:"empApply2CL"},l)),l=dojo.create("a",{innerHTML:teasp.message.getLabel("tf10005110"),
style:"color:#000080;text-decoration:underline;cursor:pointer;"},dojo.create("div",{className:"empApply2VL",style:"margin:4px 0px 0px 12px;"},l)),dojo.connect(l,"onclick",this,function(){this.close(),this.onfinishfunc(!1,{date:this.args.date,applyType:teasp.constant.APPLY_TYPE_EARLYSTART})})),this.createTimeParts(e,o,s,i,!1,function(){var e=teasp.util.time.clock2minutes(dojo.byId("dialogApplyEndTime"+s).value),
t=this.dayWrap.getDefaultEarlyStartRange(n,r),a=null;2&r&&e<t.bdrTime&&(dojo.style("dialogApplyWarnRow"+s,"display",""),a=teasp.message.getLabel("tk10001175",teasp.util.time.timeValue(t.bdrTime,this.timeForm),t.bdrFlag?teasp.message.getLabel("tk10001210"):"")),teasp.dialog.EmpApply.showWarn(s,a)}),this.createNoteParts(e,o,s,i),this.createApplySetParts(e,o,s,i),this.createApplyTimeParts(e,o,s,i),
this.createStatusParts(e,o,s,i),this.createErrorParts(e,o,s),this.createWarnParts(e,o,s),a&&dojo.place(a,o),dojo.byId("dialogApplyTimeNote"+s)),o=((i?i.afterFlag:(e=this.dayWrap.getDefaultEarlyStartRange(n,r),dojo.byId("dialogApplyStartTime"+s).value=teasp.util.time.timeValue(e.from,this.timeForm),dojo.byId("dialogApplyEndTime"+s).value=teasp.util.time.timeValue(e.to,this.timeForm),a=teasp.util.date.getToday(),
teasp.util.date.compareDate(this.args.date,a)<0))&&this.pouch.isClarifyAfterApply()&&(l.innerHTML=teasp.message.getLabel("tm10001680",teasp.message.getLabel("tk10004030")),l.style.color="black"),this.drawLast(i,t),dojo.byId("empApplyDone"+s));o&&this.eventHandles.push(dojo.connect(o,"onclick",this,function(e){var t={empId:this.pouch.getEmpId(),month:this.pouch.getYearMonth(),startDate:this.pouch.getStartDate(),
lastModifiedDate:this.pouch.getLastModifiedDate(),date:this.args.date,apply:{id:i?i.id:null,applyType:teasp.constant.APPLY_TYPE_EARLYSTART,patternId:null,holidayId:null,status:null,startDate:this.args.date,endDate:this.args.date,exchangeDate:null,startTime:teasp.util.time.clock2minutes(dojo.byId("dialogApplyStartTime"+s).value),endTime:teasp.util.time.clock2minutes(dojo.byId("dialogApplyEndTime"+s).value),
note:dojo.byId("dialogApplyNote"+s).value||null,contact:null,afterFlag:!1}};if(void 0===t.apply.startTime||void 0===t.apply.endTime)teasp.dialog.EmpApply.showError(s,teasp.message.getLabel("tm10003100"));else if(t.apply.startTime>=t.apply.endTime)teasp.dialog.EmpApply.showError(s,teasp.message.getLabel("tm10003110"));else if(2880<t.apply.endTime)teasp.dialog.EmpApply.showError(s,teasp.message.getLabel("tm10003120")
);else{if(t.apply.endTime>this.dayWrap.getFixEndTime())return a=this.dayWrap.getDayType()==teasp.constant.DAY_TYPE_NORMAL?"tm10003117":"tm10003118",void teasp.dialog.EmpApply.showError(s,teasp.message.getLabel(a));var a,o=this.dayWrap.getDefaultEarlyStartRange(n,r);if(!(2&r)&&t.apply.endTime!=o.to)return a=this.dayWrap.getDayType()==teasp.constant.DAY_TYPE_NORMAL?"tm10003113":"tm10003114",
void teasp.dialog.EmpApply.showError(s,teasp.message.getLabel(a));if(this.dayWrap.getDayType()==teasp.constant.DAY_TYPE_NORMAL&&!this.dayWrap.isPlannedHoliday())if(0<teasp.util.time.rangeTime({from:t.apply.startTime,to:t.apply.endTime},[{from:o.shiftStartTime,to:o.shiftEndTime}]))return void teasp.dialog.EmpApply.showError(s,teasp.message.getLabel("tm10003210"));!this.pouch.isRequireNote(
teasp.constant.APPLY_KEY_EARLYSTART)||t.apply.note&&t.apply.note.replace(/[\s　]+$/g,"")?(teasp.dialog.EmpApply.showError(s,null),t.apply.afterFlag=this.getAfterFlag(teasp.constant.APPLY_KEY_EARLYSTART,t.apply.startDate,t.apply.startTime,t.apply.endTime),this.dayWrap.getInputLimit().flag?this.requestDirectApply(s,t,!0):this.requestSend(s,t)):teasp.dialog.EmpApply.showError(s,teasp.message.getLabel("tm10003680"))}}))},
teasp.dialog.EmpApply.prototype.createExchangeForm=function(e,t,h,u,a){var o,s=u&&teasp.constant.STATUS_FIX.contains(u.status)||this.isReadOnly(),s=this.getInputClass(s,u),i=dojo.create("div",null,t),n=dojo.create("div",{id:"dialogApplyExchangeRow"+h,className:"empApply2Div"},i),n=(dojo.create("div",{className:"empApply2CL",innerHTML:teasp.message.getLabel("exchangeDate_label")},n),u?(o=teasp.message.getLabel(
"tm10003240",teasp.util.date.formatDate(u.startDate,"M/d+"),teasp.util.date.formatDate(u.exchangeDate,"M/d+")),u.originalStartDate!=u.startDate&&(o+=teasp.message.getLabel("tm10003800",teasp.util.date.formatDate(u.originalStartDate,"M/d+"))),dojo.create("div",{className:"empApply2VL",innerHTML:o,style:{margin:"4px"}},n)):(o=dojo.create("tbody",null,dojo.create("table",{className:"pane_table"},dojo.create("div",{
className:"empApply2VL"},n))),n=dojo.create("tr",null,o),o=dojo.create("td",null,n),dojo.create("input",{type:"text",id:"dialogApplyExchangeDate"+h,style:{margin:"2px"},className:"inpudate "+s},o),o=dojo.create("td",null,n),s=dojo.create("input",{type:"button",id:"dialogApplyExchangeDateCal"+h,style:{margin:"2px"},className:"pp_base pp_btn_cal"},o),u&&(dojo.byId("dialogApplyExchangeDate"+h
).value=teasp.util.date.formatDate(u.exchangeDate,"SLA")),this.eventHandles.push(dojo.connect(s,"onclick",this,function(e){var a=teasp.util.date.parseDate(dojo.byId("dialogApplyExchangeDate"+h).value)||this.args.date;teasp.manager.dialogOpen("Calendar",{date:a,isDisabledDateFunc:dojo.hitch(this,function(e){var t=teasp.util.date.formatDate(e);return 0!=teasp.util.date.compareDate(e,a)&&(
!this.enableMap||!this.enableMap[t])})},null,this,function(e){dojo.byId("dialogApplyExchangeDate"+h).value=teasp.util.date.formatDate(e,"SLA"),teasp.dialog.EmpApply.showError(h,null)})}))),this.createNoteParts(e,i,h,u),this.createContactParts(e,i,h,u),this.createApplySetParts(e,i,h,u),this.createApplyTimeParts(e,i,h,u),this.createStatusParts(e,i,h,u),this.createErrorParts(e,i,h),a&&dojo.place(a,i),this.drawLast(u,t),
dojo.byId("empApplyDone"+h));n&&this.eventHandles.push(dojo.connect(n,"onclick",this,function(e){var t,a={empId:this.pouch.getEmpId(),month:this.pouch.getYearMonth(),startDate:this.pouch.getStartDate(),lastModifiedDate:this.pouch.getLastModifiedDate(),date:this.args.date,apply:{id:u?u.id:null,applyType:teasp.constant.APPLY_TYPE_EXCHANGE,patternId:null,holidayId:null,status:null,startDate:this.args.date,
endDate:this.args.date,exchangeDate:null,startTime:null,endTime:null,note:dojo.byId("dialogApplyNote"+h).value||null,contact:dojo.byId("dialogApplyContact"+h).value||null}},o=this.dayWrap.getEmpApplyByKey(teasp.constant.APPLY_KEY_EXCHANGEE),s=o?o.originalStartDate:null;if(u)i=u.startDate,t=u.exchangeDate,r=this.pouch.checkExchangable(s||i,t);else{var i=this.args.date,n=teasp.util.strToDate(dojo.byId(
"dialogApplyExchangeDate"+h).value);if(0!=n.failed)return void teasp.dialog.EmpApply.showError(h,dojo.replace(n.tmpl,[teasp.message.getLabel("exchangeDate_label")]));dojo.byId("dialogApplyExchangeDate"+h).value=n.dater,t=n.datef,r=this.enableMap?this.enableMap[t]:null}if(r){var n=this.dayWrap.getEmpApplyByKey(teasp.constant.APPLY_KEY_DIRECT),r=this.dayWrap.getEmpApplyByKey(teasp.constant.APPLY_KEY_KYUSHTU);if(n||r
)teasp.dialog.EmpApply.showError(h,teasp.message.getLabel("tm10003040","",teasp.dialog.EmpApply.getApplyTypesName([n,r])));else if(this.args.date==t)teasp.dialog.EmpApply.showError(h,teasp.message.getLabel("tk10004820"));else{function l(e){for(var t=[],a=0;a<e.length;a++){var o=e[a];o.applyType!=teasp.constant.APPLY_TYPE_PATTERNS&&o.applyType!=teasp.constant.APPLY_TYPE_PATTERNL||o.dayType||t.push(a),
o.applyType==teasp.constant.APPLY_TYPE_REVISETIME&&teasp.constant.STATUS_APPROVES.contains(o.status)&&t.push(a)}for(a=t.length-1;0<=a;a--)e.splice(t[a],1)}var n=this.pouch.getEmpDay(t),r=[teasp.constant.APPLY_TYPE_EXCHANGE],p=[teasp.constant.APPLY_TYPE_ZANGYO,teasp.constant.APPLY_TYPE_EARLYSTART,teasp.constant.APPLY_TYPE_LATESTART,teasp.constant.APPLY_TYPE_EARLYEND,teasp.constant.APPLY_TYPE_EXCHANGE],
d=this.pouch.getApplyListByDate(i,0===this.dayWrap.getDayType()?r:p);if(l(d),0<d.length)return c=teasp.dialog.EmpApply.getApplyTypesName(d),void teasp.dialog.EmpApply.showError(h,teasp.message.getLabel("tm10003040","",c));if(l(d=this.pouch.getApplyListByDate(t,0===this.dayWrap.getDayType()?p:r)),0<d.length)return c=teasp.dialog.EmpApply.getApplyTypesName(d),void teasp.dialog.EmpApply.showError(h,
teasp.message.getLabel("tm10003270",teasp.util.date.formatDate(t,"M/d"),c));var p=this.pouch.getExchangeLimit(),r=this.pouch.getExchangeLimit2(),d=o?o.originalStartDate:i,c=this.pouch.getDayInfoByDate(d),o=this.pouch.getEmpMonth(null,t);if(c.dayType!=teasp.constant.DAY_TYPE_NORMAL){if(0==p){if((m=this.pouch.getYearMonth())!=o.yearMonth)return void teasp.dialog.EmpApply.showError(h,teasp.message.getLabel("tm10003920",
m%100))}else if(this.pouch.getEmpMonth(null,d,p).endDate<t)return void teasp.dialog.EmpApply.showError(h,teasp.message.getLabel("tm10003920",nxm%100))}else if(0==r){if((m=this.pouch.getYearMonth())!=o.yearMonth)return void teasp.dialog.EmpApply.showError(h,teasp.message.getLabel("tm10003920",m%100))}else if(this.pouch.getEmpMonth(null,d,r).endDate<t)return void teasp.dialog.EmpApply.showError(h,
teasp.message.getLabel("tm10003920",nxm%100));c=this.pouch.getEmpMonthByDate(t);if(c&&this.pouch.isEmpMonthFixed(c))return m=c.yearMonth,p=c.subNo,o=teasp.util.date.formatMonth("zv00000020",Math.floor(m/100),m%100,p),void teasp.dialog.EmpApply.showError(h,teasp.message.getLabel("tk10005180",o,teasp.message.getLabel("exchangeDate_label")));if(this.pouch.isProhibitApplicantEliminatingLegalHoliday()){
var d=this.pouch.getInitialDayOfWeek(),r=i,c=teasp.util.date.getWeekByDate(r,d),m=teasp.util.date.getWeekByDate(t,d);if(c[0]!=m[0]){p=this.pouch.getFirstHolidayOfWeek(c,r,t),o=this.pouch.getFirstHolidayOfWeek(m,t,r);if(!p)return void teasp.dialog.EmpApply.showError(h,teasp.message.getLabel("tk10001176",teasp.util.date.formatDate(c[0],"M/d+"),teasp.util.date.formatDate(c[c.length-1],"M/d+")));if(!o
)return void teasp.dialog.EmpApply.showError(h,teasp.message.getLabel("tk10001176",teasp.util.date.formatDate(m[0],"M/d+"),teasp.util.date.formatDate(m[m.length-1],"M/d+")))}}a.apply.startDate=i,a.apply.exchangeDate=t;d=null;n&&(this.pouch.isDayInMonth(i)&&this.pouch.isDayInMonth(t)?(r=this.pouch.getObj().works?this.pouch.getClassifyJobWorks(i):null,p=this.pouch.getObj().works?this.pouch.getClassifyJobWorks(t):null,(
r&&(0<r.sumTime||0<r.sumVolume)||p&&(0<p.sumTime||0<p.sumVolume))&&(d="tm10003280"),(0===this.dayWrap.getDayType()&&0!==n.getDayType()&&this.dayWrap.isInputTime()||0!==this.dayWrap.getDayType()&&0===n.getDayType()&&n.isInputTime())&&(d="tm10003280")):d="tm10003192",d&&teasp.manager.dialogOpen("MessageBox",{title:teasp.message.getLabel("em10002080"),message:teasp.message.getLabel(d)},this.pouch,this,function(){
this.submitExchangeApply(h,a,s)})),d||this.submitExchangeApply(h,a,s)}}else teasp.dialog.EmpApply.showError(h,teasp.message.getLabel("tm10003260"))}))},teasp.dialog.EmpApply.prototype.submitExchangeApply=function(r,l,e){!this.pouch.isRequireNote(teasp.constant.APPLY_KEY_EXCHANGES)||l.apply.note&&l.apply.note.replace(/[\s　]+$/g,"")?e?(teasp.manager.dialogOpen("BusyWait"),this.checkExchangeApplys(e,l.apply.startDate,
dojo.hitch(this,function(e,t,a){var o=t;for(e=e.sort(function(e,t){return e.applyTime<t.applyTime?-1:1});o!=a;){for(var s=o,i=0;i<e.length;i++){var n=e[i];if(n.startDate==o&&teasp.constant.STATUS_FIX.contains(n.status)){o=n.exchangeDate;break}}if(s==o)break}if(o!=a)return teasp.dialog.EmpApply.showError(r,teasp.message.getLabel("tk10005350")),void teasp.manager.dialogClose("BusyWait");this.requestSend(r,l,!0)}))
):this.requestSend(r,l):teasp.dialog.EmpApply.showError(r,teasp.message.getLabel("tm10003680"))},teasp.dialog.EmpApply.prototype.createShiftChangeForm=function(e,t,a,o,s){var i=o&&teasp.constant.STATUS_FIX.contains(o.status)||this.isReadOnly(),n=this.getInputClass(i,o),r=dojo.create("div",null,t),l=dojo.create("div",{id:"dialogApplyShiftChangeRow"+a,className:"empApply2Div"},r),p=(dojo.create("div",{
className:"empApply2CL",innerHTML:teasp.message.getLabel("exchangeDate_label")},l),this.pouch.getShiftChangeableDates(this.args.date)),l=(o&&i?(i=teasp.message.getLabel("tm10003240",teasp.util.date.formatDate(o.startDate,"M/d+"),teasp.util.date.formatDate(o.exchangeDate,"M/d+")),dojo.create("div",{className:"empApply2VL",innerHTML:i,style:{margin:"4px"}},l)):(i=dojo.create("tbody",null,dojo.create("table",{
className:"pane_table"},dojo.create("div",{className:"empApply2VL"},l))),l=dojo.create("tr",null,i),i=dojo.create("td",null,l),n=dojo.create("input",{type:"text",id:"dialogApplyShiftChangeDate"+a,style:{margin:"2px"},className:"inpudate "+n},i),o&&(n.value=teasp.util.date.formatDate(o.exchangeDate,"SLA")),i=dojo.create("td",null,l),n=dojo.create("input",{type:"button",id:"dialogApplyShiftChangeDateCal"+a,style:{
margin:"2px"},className:"pp_base pp_btn_cal"},i),this.eventHandles.push(dojo.connect(n,"onclick",this,function(e){this.calendarShiftChange(a,p)}))),this.createNoteParts(e,r,a,o),this.createContactParts(e,r,a,o),this.createApplySetParts(e,r,a,o),this.createApplyTimeParts(e,r,a,o),this.createStatusParts(e,r,a,o),this.createErrorParts(e,r,a),s&&dojo.place(s,r),this.drawLast(o,t),dojo.byId("empApplyDone"+a));
l&&this.eventHandles.push(dojo.connect(l,"onclick",this,function(e){this.submitShiftChange(a,o,p)}))},teasp.dialog.EmpApply.prototype.calendarShiftChange=function(t,a){var e=teasp.util.date.parseDate(dojo.byId("dialogApplyShiftChangeDate"+t).value)||this.args.date;teasp.manager.dialogOpen("Calendar",{date:e,isDisabledDateFunc:dojo.hitch(this,function(e){e=teasp.util.date.formatDate(e);if(this.args.date==e)return!1;
e=a[e];return!e||!e.changeable})},null,this,function(e){dojo.byId("dialogApplyShiftChangeDate"+t).value=teasp.util.date.formatDate(e,"SLA"),teasp.dialog.EmpApply.showError(t,null)})},teasp.dialog.EmpApply.prototype.submitShiftChange=function(e,t,a){var o,s={empId:this.pouch.getEmpId(),month:this.pouch.getYearMonth(),startDate:this.pouch.getStartDate(),lastModifiedDate:this.pouch.getLastModifiedDate(),
date:this.args.date,apply:{id:t?t.id:null,applyType:teasp.constant.APPLY_TYPE_SHIFTCHANGE,startDate:this.args.date,endDate:this.args.date,note:dojo.byId("dialogApplyNote"+e).value||null,contact:dojo.byId("dialogApplyContact"+e).value||null}},i=teasp.util.strToDate(dojo.byId("dialogApplyShiftChangeDate"+e).value);0!=i.failed?teasp.dialog.EmpApply.showError(e,dojo.replace(i.tmpl,[teasp.message.getLabel(
"exchangeDate_label")])):(dojo.byId("dialogApplyShiftChangeDate"+e).value=i.dater,s.apply.exchangeDate=i.datef,i=this.pouch.getEmpDay(s.apply.exchangeDate),this.checkShiftChangeable(e,this.dayWrap,i,a)&&this.checkOtherApplyAtShiftChange(e,t,this.dayWrap,i)&&(a=null,i&&(this.pouch.isDayInMonth(s.apply.startDate)&&this.pouch.isDayInMonth(s.apply.exchangeDate)?(t=this.pouch.getObj().works?this.pouch.getClassifyJobWorks(
s.apply.startDate):null,o=this.pouch.getObj().works?this.pouch.getClassifyJobWorks(s.apply.exchangeDate):null,(t&&(0<t.sumTime||0<t.sumVolume)||o&&(0<o.sumTime||0<o.sumVolume))&&(a="tm10003280"),(0===this.dayWrap.getDayType()&&0!==i.getDayType()&&this.dayWrap.isInputTime()||0!==this.dayWrap.getDayType()&&0===i.getDayType()&&i.isInputTime())&&(a="tm10003280")):a="tm10003192"),!this.pouch.isRequireNote(
teasp.constant.APPLY_KEY_SHIFTCHANGE)||s.apply.note&&s.apply.note.replace(/[\s　]+$/g,"")?a?teasp.manager.dialogOpen("MessageBox",{title:teasp.message.getLabel("em10002080"),message:teasp.message.getLabel(a)},this.pouch,this,function(){this.requestSend(e,s)}):this.requestSend(e,s):teasp.dialog.EmpApply.showError(e,teasp.message.getLabel("tm10003680"))))},teasp.dialog.EmpApply.prototype.checkShiftChangeable=function(e,
t,a,o){o=o[a.getKey()];return o&&1!=o.out?!!o.changeable||(a="",a=o.out||o.validShiftSet?teasp.message.getLabel("tm10003260"):teasp.message.getLabel("tf10011290"),teasp.dialog.EmpApply.showError(e,a),!1):(teasp.dialog.EmpApply.showError(e,teasp.message.getLabel("tf10011280")),!1)},teasp.dialog.EmpApply.prototype.checkOtherApplyAtShiftChange=function(e,t,a,o,s){var i=this.getApplyListByDate(a,[]),
n=teasp.util.date.formatDate(a.getKey(),"M/d"),r=teasp.util.date.formatDate(o.getKey(),"M/d"),a=this.args.date!=a.getKey();if(i.ngs.length)return l=teasp.dialog.EmpApply.getApplyTypesName(i.ngs),teasp.dialog.EmpApply.showError(e,teasp.message.getLabel(a?"tm10003270":"tm10003040",n,l)),!1;if(i.waits.length)return teasp.dialog.EmpApply.showError(e,teasp.message.getLabel(s?"tf10011310":"tf10011300",n)),!1;var l,
i=this.getApplyListByDate(o,[]);return i.ngs.length?(l=teasp.dialog.EmpApply.getApplyTypesName(i.ngs),teasp.dialog.EmpApply.showError(e,teasp.message.getLabel(a?"tm10003040":"tm10003270",r,l)),!1):!i.waits.length||(teasp.dialog.EmpApply.showError(e,teasp.message.getLabel(s?"tf10011310":"tf10011300",r)),!1)},teasp.dialog.EmpApply.prototype.getApplyListByDate=function(e,t){for(var a={ngs:[],waits:[]},
o=e.getEmpApplyList(),s=0;s<o.length;s++){var i=o[s];t.contains(i.applyType)||i.applyType==teasp.constant.APPLY_TYPE_SHIFTCHANGE||i.applyType==teasp.constant.APPLY_TYPE_REVISETIME&&teasp.constant.STATUS_APPROVES.contains(i.status)||i.applyType==teasp.constant.APPLY_TYPE_PATTERNS&&i.decree||(i.applyType==teasp.constant.APPLY_TYPE_REVISETIME?a.waits.push(i):teasp.constant.STATUS_FIX.contains(i.status)&&a.ngs.push(i))}
e=e.getHolidayExcludes();return e.length&&a.ngs.push(e[0]),a},teasp.dialog.EmpApply.prototype.createChangePatternForm=function(S,e,x,w,t){var a=w&&(teasp.constant.STATUS_FIX.contains(w.status)||w.startDate!=this.args.date)||this.isReadOnly(),o=this.getInputClass(a,w),s=this.patternSList,i=this.patternLList,n=s.concat(i),r=(this.dayWrap.getEmpApplyByKey(teasp.constant.APPLY_KEY_PATTERNS)&&(s=[]),
this.dayWrap.getEmpApplyByKey(teasp.constant.APPLY_KEY_PATTERNL)&&(i=[]),dojo.create("div",null,e)),l=null,M=!1,p=this.dayWrap.getPattern(),d=(a||(!this.pouch.isProhibitWorkShiftChange()||this.pouch.isUseChangeShift()&&p&&p.id||(M=!0),n.length||(M=!0)),!this.dayWrap.isPlannedHoliday()&&(this.pouch.isChangeDayType()||a&&w&&null!==w.dayType)&&(d=dojo.create("div",{className:"empApply2Div"},r),dojo.create("div",{
className:"empApply2CL",innerHTML:teasp.message.getLabel("dayType_label")},d),a&&w?dojo.create("div",{innerHTML:this.pouch.getDisplayDayType(w.dayType,teasp.message.getLabel("tm10003890")),style:"margin:2px;"},dojo.create("div",{className:"empApply2VL"},d)):(h=dojo.create("div",{className:"empApply2VL"},d),u=dojo.create("select",{id:"dlgApplyDayType"+x,className:o,style:"margin:2px 12px 2px 2px;"},h),h=dojo.create(
"div",{id:"dlgApplyDayTypeOption"+x,style:"display:none;margin:0px;"},h),c=dojo.create("label",{style:"margin-right:8px;"},h),h=dojo.create("label",{style:"margin-right:8px;"},h),m=dojo.create("input",{type:"radio",name:"dayTypeOption",style:"margin:2px;",id:"dayTypeRegularHoliday"},c),dojo.create("span",{innerHTML:teasp.message.getLabel("fixHoliday_label")},c),c=dojo.create("input",{type:"radio",
name:"dayTypeOption",style:"margin:2px;",id:"dayTypeLegalHoliday"},h),dojo.create("span",{innerHTML:teasp.message.getLabel("legalHoliday_label")},h),this.pouch.isAllowSelectionOfLegalHoliday()&&(w&&"2"==w.dayType?c.checked=!0:m.checked=!0),dojo.create("option",{value:"-",innerHTML:teasp.message.getLabel("tm10003890")},u),dojo.create("option",{value:"0",innerHTML:teasp.message.getLabel("normalDay_label")},u),
dojo.create("option",{value:"1",innerHTML:teasp.message.getLabel("notWorkDay_label")},u),h=w&&w.dayType||"-",u.value="2"==h?"1":h,l=dojo.hitch(this,function(){var e=dojo.byId("dlgApplyDayType"+x).value;M||(dojo.style(dojo.byId("dlgApplyPatternRow"+x),"display","1"==e?"none":""),dojo.style(dojo.byId("dialogApplyTimeRow"+x),"display","1"==e?"none":"")),teasp.dialog.EmpApply.adjustContentHeight(),
this.pouch.isAllowSelectionOfLegalHoliday()&&dojo.style(dojo.byId("dlgApplyDayTypeOption"+x),"display","1"==e?teasp.isNarrow()?"block":"inline-block":"none")}),this.eventHandles.push(dojo.connect(u,"onchange",this,l)))),dojo.create("div",{id:"dlgApplyPatternRow"+x,className:"empApply2Div"},r)),c=(dojo.create("div",{className:"empApply2CL",innerHTML:teasp.message.getLabel("patterns_label")},d),dojo.create("div",{
className:"empApply2VL"},d));if(!w||!a&&w.active){var m=dojo.create("table",{className:"pane_table",style:"width:"+(teasp.isNarrow()?260:300)+"px;"},c),h=dojo.create("tbody",null,m),d=dojo.create("tr",null,h),u=dojo.create("select",{id:"dlgApplyPatternList"+x,className:o,style:"width:100%;"},dojo.create("td",null,d));if(dojo.create("option",{value:"-",innerHTML:this.pouch.isChangeDayType()?teasp.message.getLabel(
"tm10003890"):""},u),0<s.length){0<i.length&&dojo.create("option",{value:"S",innerHTML:teasp.message.getLabel("tm10003900")},u);for(var g=0;g<s.length;g++)dojo.create("option",{value:s[g].id,innerHTML:"&nbsp;"+s[g].name},u)}if(0<i.length){0<s.length&&dojo.create("option",{value:"L",innerHTML:teasp.message.getLabel("tm10003910")},u);for(g=0;g<i.length;g++)dojo.create("option",{value:i[g].id,
innerHTML:"&nbsp;"+i[g].name},u)}if(this.pouch.isProhibitWorkShiftChange()){if((p=this.dayWrap.getPattern())&&p.id){for(var y=-1,g=0;g<n.length;g++)if(p.id==n[g].id){y=g;break}y<0?dojo.create("option",{value:p.id,innerHTML:"&nbsp;"+p.name},u):u.value=p.id}dojo.setAttr(u,"disabled",!0)}else w&&(u.value=w.pattern?w.pattern.id:"-"),dojo.setAttr(u,"disabled",!1)}else dojo.create("div",{
innerHTML:w.pattern?w.pattern.name:"",style:{margin:"2px"}},c);function O(e){return _.apply(this,[e.value])}function f(e,t){t||(dojo.byId("dialogApplyStartTime"+x).value=e?teasp.util.time.timeValue(e.stdStartTime,this.timeForm):"",dojo.byId("dialogApplyEndTime"+x).value=e?teasp.util.time.timeValue(e.stdEndTime,this.timeForm):""),dojo.byId("dialogApplyStartTime"+x).disabled=!this.pouch.isUseChangeShift(),dojo.byId(
"dialogApplyEndTime"+x).disabled=!this.pouch.isUseChangeShift(),b.apply(this),v(this.pouch.getWorkSystem()!=teasp.constant.WORK_SYSTEM_FLEX||!e||!e.disableCoreTime)}var m=this.pouch.getDateRangeOfMonth(this.args.date,3,-1),b=(m.from=this.args.date,this.pouch.isProhibitAcrossMonthApply()&&(m.to=this.monthLastDate),this.createRangeParts(S,r,x,w,m),this.displayOnOff("dialogApplyRangeRow"+x,
!this.pouch.isProhibitWorkShiftChange()),function(){var e=teasp.util.time.clock2minutes(dojo.byId("dialogApplyStartTime"+x).value),t=teasp.util.time.clock2minutes(dojo.byId("dialogApplyEndTime"+x).value),a=_(dojo.byId("dlgApplyPatternList"+x).value),o="";if(a&&void 0!==e&&void 0!==t&&e<t&&t<=2880){var s=dojo.clone(a&&a.restTimes||[]);if(a.enableRestTimeShift&&e!=a.stdStartTime)for(var i=e-a.stdStartTime,
n=0;n<s.length;n++)s[n].from+=i,s[n].to+=i;var e=t-e-teasp.util.time.rangeTime({from:e,to:t},s),t=(e<0&&(e=0),this.pouch.getLegalTimeOfDay()),r=a.standardFixTime||0,l=this.pouch.getWorkSystem(),o=l==teasp.constant.WORK_SYSTEM_FLEX?this.pouch.isFlexFixTime()||a.disableCoreTime?teasp.message.getLabel("tk10001180",a.disableCoreTime?teasp.message.getLabel("tm10010150"):teasp.util.time.timeValue(e)
):teasp.message.getLabel("tf10004740",teasp.util.time.timeValue(r),teasp.util.time.timeValue(e)):a.useDiscretionary&&l!=teasp.constant.WORK_SYSTEM_MANAGER?a.workTimeChangesWithShift?teasp.message.getLabel("tf10004750",teasp.util.time.timeValue(Math.min(e,r)),teasp.util.time.timeValue(e)):teasp.message.getLabel("tf10004750",teasp.util.time.timeValue(r),teasp.util.time.timeValue(r)):r&&(
e==r||a.workTimeChangesWithShift&&l!=teasp.constant.WORK_SYSTEM_MANAGER)?e!=r&&t<e&&l==teasp.constant.WORK_SYSTEM_FIX?teasp.message.getLabel("tf10004730",teasp.util.time.timeValue(t),teasp.util.time.timeValue(e-t)):teasp.message.getLabel("tk10001161",teasp.util.time.timeValue(e)):teasp.message.getLabel("tf10004720",teasp.util.time.timeValue(r),teasp.util.time.timeValue(e))}dojo.byId("dialogApplyTimeNote"+x
).innerHTML=o,teasp.dialog.EmpApply.adjustContentHeight()}),_=(this.createTimeParts(S,r,x,w,!1,b),a&&w&&(w.pattern||dojo.style(dojo.byId("dlgApplyPatternRow"+x),"display","none"),"number"!=typeof w.startTime&&"number"!=typeof w.endTime&&dojo.style(dojo.byId("dialogApplyTimeRow"+x),"display","none")),this.createNoteParts(S,r,x,w),dojo.byId("dialogApplyTimeNote"+x).style.fontSize="90%",dojo.byId("dialogApplyTimeNote"+x
).style.color="#696969",this.createApplySetParts(S,r,x,w),this.createApplyTimeParts(S,r,x,w),this.createStatusParts(S,r,x,w),this.createErrorParts(S,r,x),t&&dojo.place(t,r),function(e){for(var t=0;t<n.length;t++)if(n[t].id==e)return n[t];return null}),v=function(t){dojo.query("td.time-parts",dojo.byId("dialogApplyTimeRow"+x)).forEach(function(e){dojo.style(e,"display",t?"":"none")})};this.pouch.getWorkSystem(
)==teasp.constant.WORK_SYSTEM_FLEX&&w&&w.pattern&&w.pattern.disableCoreTime?(v(!1),dojo.byId("dialogApplyTimeNote"+x).innerHTML=teasp.message.getLabel("tk10001180",teasp.message.getLabel("tm10010150"))):v(!0);(u=dojo.byId("dlgApplyPatternList"+x))&&(this.eventHandles.push(dojo.connect(u,"onchange",this,function(e){f.apply(this,[O.apply(this,[e.target])])})),h=O.apply(this,[u]),o=!!(w&&w.pattern&&h&&w.pattern.id==h.id
),f.apply(this,[h,o])),!a&&(n.length<=0||M)&&(dojo.style(dojo.byId("dlgApplyPatternRow"+x),"display","none"),dojo.style(dojo.byId("dialogApplyTimeRow"+x),"display","none")),l&&l(),this.drawLast(w,e);d=dojo.byId("empApplyDone"+x);d&&this.eventHandles.push(dojo.connect(d,"onclick",this,function(e){if("S"==(o=dojo.byId("dlgApplyPatternList"+x)).value||"L"==o.value)teasp.dialog.EmpApply.showError(x,
teasp.message.getLabel("tm10003290"));else{var t=null,a=(!this.pouch.isChangeDayType()||(i=dojo.byId("dlgApplyDayType"+x))&&"-"!=i.value&&("1"==(t=i.value)&&this.pouch.isAllowSelectionOfLegalHoliday()&&dojo.byId("dayTypeLegalHoliday").checked&&(t="2"),i=null),"1"==t||"2"==t||M?null:O.apply(this,[o])),o=null,s={empId:this.pouch.getEmpId(),month:this.pouch.getYearMonth(),startDate:this.pouch.getStartDate(),
lastModifiedDate:this.pouch.getLastModifiedDate(),date:this.args.date,apply:{id:w?w.id:null,applyType:a&&a.range==teasp.constant.RANGE_LONG?teasp.constant.APPLY_TYPE_PATTERNL:teasp.constant.APPLY_TYPE_PATTERNS,patternId:a?a.id:null,holidayId:null,status:null,dayType:t,startDate:this.args.date,endDate:this.args.date,exchangeDate:null,startTime:null,endTime:null,note:dojo.byId("dialogApplyNote"+x).value||null,
contact:null}},i=teasp.util.strToDate(dojo.byId("dialogApplyStartDate"+x).value),o=teasp.util.strToDate(dojo.byId("dialogApplyEndDate"+x).value);if(0!=i.failed)teasp.dialog.EmpApply.showError(x,dojo.replace(i.tmpl,[teasp.message.getLabel("rangeStartDate_label")]));else if(dojo.byId("dialogApplyStartDate"+x).value=i.dater,0!=o.failed)teasp.dialog.EmpApply.showError(x,dojo.replace(o.tmpl,[teasp.message.getLabel(
"rangeEndDate_label")]));else{if(dojo.byId("dialogApplyEndDate"+x).value=o.dater,i.datef!=o.datef){if(0<dojo.date.compare(i.date,o.date,"date"))return void teasp.dialog.EmpApply.showError(x,teasp.message.getLabel("tm10003300"));if(a&&a.range==teasp.constant.RANGE_LONG){if(this.pouch.isProhibitAcrossMonthApply()&&0<teasp.util.date.compareDate(o.date,this.monthLastDate))return void teasp.dialog.EmpApply.showError(x,
teasp.message.getLabel("tk10001185"));t=this.pouch.getDateRangeOfMonth(this.args.date,3,-1);if(teasp.util.date.compareDate(t.to,o.date)<0)return void teasp.dialog.EmpApply.showError(x,teasp.message.getLabel("tm10003310"))}else if(0<teasp.util.date.compareDate(o.date,this.monthLastDate))return void teasp.dialog.EmpApply.showError(x,teasp.message.getLabel("tm10003320"))}else o=i;s.apply.startDate=i.datef,
s.apply.endDate=o.datef;var n=a?a.stdStartTime:null,r=a?a.stdEndTime:null;if(a&&this.pouch.isUseChangeShift()){if(n=teasp.util.time.clock2minutes(dojo.byId("dialogApplyStartTime"+x).value),r=teasp.util.time.clock2minutes(dojo.byId("dialogApplyEndTime"+x).value),void 0===n||void 0===r)return void teasp.dialog.EmpApply.showError(x,teasp.message.getLabel("tm10003100"));if(r<=n
)return void teasp.dialog.EmpApply.showError(x,teasp.message.getLabel("tm10003110"));if(1440<=n)return void teasp.dialog.EmpApply.showError(x,teasp.message.getLabel("tm10002030"));if(2880<r)return void teasp.dialog.EmpApply.showError(x,teasp.message.getLabel("tm10003120"));t=!1;if((t=this.pouch.getWorkSystem()!=teasp.constant.WORK_SYSTEM_MANAGER?this.dayWrap.getDayType(
)==teasp.constant.DAY_TYPE_NORMAL?this.dayWrap.isExchangedEdge()?a.prohibitChangeExchangedWorkTime:a.prohibitChangeWorkTime:a.prohibitChangeHolidayWorkTime:t)&&(a.stdStartTime!=n||a.stdEndTime!=r)){var i=a.stdEndTime-a.stdStartTime-teasp.util.time.rangeTime({from:a.stdStartTime,to:a.stdEndTime},a.restTimes),l=dojo.clone(a.restTimes||[]);if(a.enableRestTimeShift&&n!=a.stdStartTime)for(var p=n-a.stdStartTime,
d=0;d<l.length;d++)l[d].from+=p,l[d].to+=p;o=r-n-teasp.util.time.rangeTime({from:n,to:r},l);if(i!=o)return t=teasp.message.getLabel((o-=i)<0?"tk10001162":"tk10001163",teasp.util.time.timeValue(Math.abs(o))),i=teasp.message.getLabel(this.pouch.getWorkSystem()==teasp.constant.WORK_SYSTEM_FLEX?"coreTime_label":"tk10000111"),void teasp.dialog.EmpApply.showError(x,teasp.message.getLabel("tk10001160",i,t))}
s.apply.startTime=n,s.apply.endTime=r}if(this.pouch.isProhibitWorkShiftChange()){if(M&&this.pouch.isChangeDayType()&&!s.apply.dayType)return void teasp.dialog.EmpApply.showError(x,teasp.message.getLabel("tf10011240"))}else if(this.pouch.isChangeDayType()){if(!s.apply.patternId&&!s.apply.dayType)return void teasp.dialog.EmpApply.showError(x,teasp.message.getLabel("tf10011250"))}else if(!s.apply.patternId
)return void teasp.dialog.EmpApply.showError(x,teasp.message.getLabel("tm10003290"));if(!this.pouch.isRequireNote(S)||s.apply.note&&s.apply.note.replace(/[\s　]+$/g,"")){for(var c=this.getRangeApplys(s.apply.startDate,s.apply.endDate),m=s.apply.startDate,h={};m<=s.apply.endDate;){var u=c[m],g=u.rack.validApplys.patternS,y=u.rack.validApplys.patternL,f=u.rack.validApplys.patternD,b=g&&g.dayType?g:y&&y.dayType?y:null,
_=this.pouch.getEmpMonthByDate(m);if(_&&this.pouch.isEmpMonthFixed(_))return j=_.yearMonth,_=_.subNo,j=teasp.util.date.formatMonth("zv00000020",Math.floor(j/100),j%100,_),void teasp.dialog.EmpApply.showError(x,teasp.message.getLabel("tk10005180",j,teasp.message.getLabel("range_label")));if(u.rack.validApplys.dailyFix)return void teasp.dialog.EmpApply.showError(x,teasp.message.getLabel("tk10005190",
teasp.util.date.formatDate(m,"M/d"),teasp.message.getLabel("range_label")));if(a&&(a.range==teasp.constant.RANGE_LONG&&y||a.range==teasp.constant.RANGE_SHORT&&g))return void teasp.dialog.EmpApply.showError(x,teasp.message.getLabel("tk10004630"));_=0<u.rack.validApplys.kyushtu.length?u.rack.validApplys.kyushtu[0]:null;if(s.apply.dayType){if(u.plannedHoliday)return void teasp.dialog.EmpApply.showError(x,
teasp.message.getLabel("tk10004600"));if(f||b)return void teasp.dialog.EmpApply.showError(x,teasp.message.getLabel("tk10004630"));var v=u.rack.validApplys.exchangeS,T=u.rack.validApplys.exchangeE;if(v||T)return void teasp.dialog.EmpApply.showError(x,teasp.message.getLabel("tk10005230",teasp.message.getLabel("tm10009070"),(v||T).applyType));if(
_&&_.status==teasp.constant.STATUS_WAIT&&this.pouch.isProhibitInputTimeUntilApproved())return void teasp.dialog.EmpApply.showError(x,teasp.message.getLabel("tk10005230",teasp.message.getLabel("tm10009070"),_.applyType))}var j=0<u.rack.validApplys.zangyo.length?u.rack.validApplys.zangyo[0]:null,v=0<u.rack.validApplys.earlyStart.length?u.rack.validApplys.earlyStart[0]:null,y=u.rack.validApplys.holidayAll,
f=u.rack.validApplys.holidayAm,b=u.rack.validApplys.holidayPm,E=0<u.rack.validApplys.holidayTime.length?u.rack.validApplys.holidayTime[0]:null;if("1"==s.apply.dayType||"2"==s.apply.dayType){var L=u.rack.validApplys.direct,k=u.rack.validApplys.lateStart,T=u.rack.validApplys.earlyEnd;if(_&&(j=v=null,_.useRegulateHoliday&&(k=T=null)),y||f||b||E||L||k||T||j||v)return void teasp.dialog.EmpApply.showError(x,
teasp.message.getLabel("tk10005230",teasp.message.getLabel("tm10009070"),teasp.dialog.EmpApply.getApplyTypesName([y,f,b,E,L,k,T,j,v])));if(s.apply.startDate!=s.apply.endDate){for(var D=s.apply.startDate,I=!1;D<=s.apply.endDate;){if((A=this.pouch.getObj().works?this.pouch.getClassifyJobWorks(D):null)&&(0<A.sumTime||0<A.sumVolume)||this.pouch.getObj().days[D]&&("number"==typeof this.pouch.getObj(
).days[D].startTime||"number"==typeof this.pouch.getObj().days[D].endTime)){I=!0;break}D=teasp.util.date.addDays(D,1)}I&&(h.clear={bullet:!0,title:teasp.message.getLabel("tm10003195")})}else{var A=this.pouch.getObj().works?this.pouch.getClassifyJobWorks(s.apply.startDate):null;(this.dayWrap.isInputTime()||A&&(0<A.sumTime||0<A.sumVolume))&&(h.clear={bullet:!0,title:teasp.message.getLabel("tm10003194")})}}else{if(
"0"==s.apply.dayType&&_)return void teasp.dialog.EmpApply.showError(x,teasp.message.getLabel("tk10005230",teasp.message.getLabel("tm10009070"),_.applyType));if(j&&n>j.startTime||v&&r<v.endTime)return void teasp.dialog.EmpApply.showError(x,teasp.message.getLabel("tk10004770"));if(!g&&a&&(f||b||E)&&(!f||!b)){p=a.enableRestTimeShift&&n!=a.stdStartTime?n-a.stdStartTime:0,u=this.pouch.getEmpDay(m).checkInconsistent(
f?teasp.constant.RANGE_AM:b?teasp.constant.RANGE_PM:null,a,p);if(u)return void(-2==u?teasp.dialog.EmpApply.showError(x,teasp.message.getLabel("tf10008240")):-3==u?teasp.dialog.EmpApply.showError(x,teasp.message.getLabel("tf10008230")):-4==u?teasp.dialog.EmpApply.showError(x,teasp.message.getLabel("tf10008250")):teasp.dialog.EmpApply.showError(x,teasp.message.getLabel("tm10003200")))}}m=teasp.util.date.addDays(m,1)}
0<Object.keys(h).length?setTimeout(dojo.hitch(this,function(){teasp.manager.dialogOpen("MessageBox",{title:teasp.message.getLabel("tf10009760"),message:"",check:h,hint:null,dialogWidth:"560px"},this.pouch,this,function(e){this.requestSend(x,s)})}),100):this.requestSend(x,s)}else teasp.dialog.EmpApply.showError(x,teasp.message.getLabel("tm10003680"))}}}))},teasp.dialog.EmpApply.prototype.createLateStartForm=function(e
,t,s,i,a){var o,n=i&&teasp.constant.STATUS_FIX.contains(i.status)||this.isReadOnly(),r=this.getInputClass(n,i),l=dojo.create("div",null,t),p=dojo.create("div",{id:"dialogApplyTimeRow"+s,className:"empApply2Div"},l),r=(dojo.create("div",{className:"empApply2CL",innerHTML:teasp.message.getLabel("startTime_label")},p),dojo.create("input",{type:"text",id:"dialogApplyTime"+s,style:{margin:"2px"},className:"inputime "+r},
dojo.create("div",{className:"empApply2VL"},p))),n=(i?(r.value=teasp.util.time.timeValue(i.endTime,this.timeForm),(teasp.constant.STATUS_FIX.contains(i.status)||this.isReadOnly())&&(r.readOnly="readOnly"),this.changeInputAreaView(r,i,n)):(o=this.dayWrap.getStartTime(!0,null,teasp.constant.C_REAL))&&(r.value=teasp.util.time.timeValue(o,this.timeForm)),this.createNoteParts(e,l,s,i,teasp.message.getLabel("reason_label")
),(n&&i&&i.treatDeduct||this.pouch.isUseOwnReasonLateStart())&&(p=dojo.create("div",{id:"dialogApplyLateEscapeRow"+s,className:"empApply2Div"},l),dojo.create("div",{className:"empApply2CL"},p),o=dojo.create("label",{style:{margin:"4px 2px"}},dojo.create("div",{className:"empApply2VL"},p)),r=dojo.create("input",{type:"checkbox",id:"dialogApplyLateEscape"+s},o),o.appendChild(dojo.doc.createTextNode(
teasp.message.getLabel("tm10003330"))),o.title=teasp.message.getLabel("tm10003340"),r.checked=!i||i.ownReason,r.disabled=!!i&&teasp.constant.STATUS_FIX.contains(i.status)),this.createApplySetParts(e,l,s,i),this.createApplyTimeParts(e,l,s,i),this.createStatusParts(e,l,s,i),this.createErrorParts(e,l,s),a&&dojo.place(a,l),dojo.query(".inputime",dojo.byId("dialogApplyTimeRow"+s)).forEach(function(e){
this.eventHandles.push(dojo.connect(e,"blur",this,teasp.util.time.onblurTime)),this.eventHandles.push(dojo.connect(e,"onkeypress",this,teasp.util.time.onkeypressTime))},this),this.drawLast(i,t),dojo.byId("empApplyDone"+s));n&&this.eventHandles.push(dojo.connect(n,"onclick",this,function(e){var t,a,o=teasp.util.time.clock2minutes(dojo.byId("dialogApplyTime"+s).value);void 0===o?teasp.dialog.EmpApply.showError(s,
teasp.message.getLabel("tm10003350")):(t=this.dayWrap.getBorderTime().st)<0||o<=t?teasp.dialog.EmpApply.showError(s,teasp.message.getLabel("tm10003360",teasp.util.time.timeValue(t,this.timeForm))):(a=dojo.byId("dialogApplyLateEscape"+s),t={empId:this.pouch.getEmpId(),month:this.pouch.getYearMonth(),startDate:this.pouch.getStartDate(),lastModifiedDate:this.pouch.getLastModifiedDate(),date:this.args.date,apply:{
id:i?i.id:null,applyType:teasp.constant.APPLY_TYPE_LATESTART,patternId:null,holidayId:null,status:null,startDate:this.args.date,endDate:this.args.date,exchangeDate:null,startTime:t,endTime:o,note:dojo.byId("dialogApplyNote"+s).value||null,contact:null,ownReason:!!a&&a.checked,treatDeduct:this.pouch.getTreatLateStart()}},a=null,!this.pouch.isRequireNote(teasp.constant.APPLY_KEY_LATESTART
)||t.apply.note&&t.apply.note.replace(/[\s　]+$/g,"")?this.dayWrap.getInputLimit().flag?this.requestDirectApply(s,t,!0):this.requestSend(s,t):teasp.dialog.EmpApply.showError(s,teasp.message.getLabel("tm10003690")))}))},teasp.dialog.EmpApply.prototype.createEarlyEndForm=function(e,t,s,i,a){var o,n=i&&teasp.constant.STATUS_FIX.contains(i.status)||this.isReadOnly(),r=this.getInputClass(n,i),l=dojo.create("div",null,t),
p=dojo.create("div",{id:"dialogApplyTimeRow"+s,className:"empApply2Div"},l),r=(dojo.create("div",{className:"empApply2CL",innerHTML:teasp.message.getLabel("endTime_label")},p),dojo.create("input",{type:"text",id:"dialogApplyTime"+s,style:"margin:2px;",className:"inputime "+r},dojo.create("div",{className:"empApply2VL"},p))),n=(i?(r.value=teasp.util.time.timeValue(i.startTime,this.timeForm),(
teasp.constant.STATUS_FIX.contains(i.status)||this.isReadOnly())&&(r.readOnly="readOnly"),this.changeInputAreaView(r,i,n)):(o=this.dayWrap.getEndTime(!0,null,teasp.constant.C_REAL))&&(r.value=teasp.util.time.timeValue(o,this.timeForm)),this.createNoteParts(e,l,s,i,teasp.message.getLabel("reason_label")),(n&&i&&i.treatDeduct||this.pouch.isUseOwnReasonEarlyEnd())&&(p=dojo.create("div",{id:"dialogApplyEarlyEscapeRow"+s,
className:"empApply2Div"},l),dojo.create("div",{className:"empApply2CL"},p),o=dojo.create("label",{style:"margin:4px 2px;"},dojo.create("div",{className:"empApply2VL"},p)),r=dojo.create("input",{type:"checkbox",id:"dialogApplyEarlyEscape"+s},o),o.appendChild(dojo.doc.createTextNode(teasp.message.getLabel("tm10003330"))),o.title=teasp.message.getLabel("tm10003341"),r.checked=!i||i.ownReason,
r.disabled=!!i&&teasp.constant.STATUS_FIX.contains(i.status)),this.createApplySetParts(e,l,s,i),this.createApplyTimeParts(e,l,s,i),this.createStatusParts(e,l,s,i),this.createErrorParts(e,l,s),a&&dojo.place(a,l),dojo.query(".inputime",dojo.byId("dialogApplyTimeRow"+s)).forEach(function(e){this.eventHandles.push(dojo.connect(e,"blur",this,teasp.util.time.onblurTime)),this.eventHandles.push(dojo.connect(e,"onkeypress",
this,teasp.util.time.onkeypressTime))},this),this.drawLast(i,t),dojo.byId("empApplyDone"+s));n&&this.eventHandles.push(dojo.connect(n,"onclick",this,function(e){var t,a,o=teasp.util.time.clock2minutes(dojo.byId("dialogApplyTime"+s).value);void 0===o?teasp.dialog.EmpApply.showError(s,teasp.message.getLabel("tm10003350")):(t=this.dayWrap.getBorderTime().et)<0||t<=o?teasp.dialog.EmpApply.showError(s,
teasp.message.getLabel("tm10003370",teasp.util.time.timeValue(t,this.timeForm))):(a=dojo.byId("dialogApplyEarlyEscape"+s),o={empId:this.pouch.getEmpId(),month:this.pouch.getYearMonth(),startDate:this.pouch.getStartDate(),lastModifiedDate:this.pouch.getLastModifiedDate(),date:this.args.date,apply:{id:i?i.id:null,applyType:teasp.constant.APPLY_TYPE_EARLYEND,patternId:null,holidayId:null,status:null,
startDate:this.args.date,endDate:this.args.date,exchangeDate:null,startTime:o,endTime:t,note:dojo.byId("dialogApplyNote"+s).value||null,contact:null,ownReason:!!a&&a.checked,treatDeduct:this.pouch.getTreatEarlyEnd()}},a=null,!this.pouch.isRequireNote(teasp.constant.APPLY_KEY_EARLYEND)||o.apply.note&&o.apply.note.replace(/[\s　]+$/g,"")?this.dayWrap.getInputLimit().flag?this.requestDirectApply(s,o,!0):this.requestSend(
s,o):teasp.dialog.EmpApply.showError(s,teasp.message.getLabel("tm10003690")))}))},teasp.dialog.EmpApply.prototype.createDailyForm=function(e,t,o,s,a){var i=this.dayWrap.getDaySummary(),n=this.pouch.isInputAccessControl(),r=dojo.create("div",null,t),l=dojo.create("div",{className:"empApply2Div in-out"},r),n=(dojo.create("div",{className:"empApply2CL",innerHTML:teasp.message.getLabel("startEndTime_label")},l),
dojo.create("div",{className:"empApply2VL valfont",style:"vertical-align:top;margin-top:4px;",innerHTML:(i.st||"")+"-"+(i.et||"")},l),l=dojo.create("div",{className:"empApply2Div"},r),dojo.create("div",{className:"empApply2CL",innerHTML:teasp.message.getLabel("restTime_label")},l),dojo.create("div",{className:"empApply2VL valfont",innerHTML:i.restSpan},l),l=dojo.create("div",{className:"empApply2Div"},r),dojo.create(
"div",{className:"empApply2CL",innerHTML:teasp.message.getLabel("wholeTime_label")},l),dojo.create("div",{className:"empApply2VL valfont",innerHTML:teasp.util.time.timeValue(i.workWholeTime)},l),l=dojo.create("div",{className:"empApply2Div"},r),dojo.create("div",{className:"empApply2CL",innerHTML:teasp.message.getLabel(i.workNetTime!=i.workRealTime?"tm10009230":"workRealTime_label")},l),dojo.create("div",{
className:"empApply2VL valfont",innerHTML:teasp.util.time.timeValue(i.workNetTime)},l),this.createNoteParts(e,r,o,s),n&&(l=dojo.create("div",{className:"empApply2Div"},r),dojo.create("div",{className:"empApply2CL",innerHTML:teasp.message.getLabel("ac00000210")},l),dojo.create("div",{className:"empApply2VL valfont",innerHTML:this.dayWrap.getEnterDivergenceReason(!1)},l),l=dojo.create("div",{className:"empApply2Div"},r
),dojo.create("div",{className:"empApply2CL",innerHTML:teasp.message.getLabel("ac00000220")},l),dojo.create("div",{className:"empApply2VL valfont",innerHTML:this.dayWrap.getExitDivergenceReason(!1)},l),i=dojo.query(".in-out",r)[0],n=teasp.isNarrow()?null:dojo.create("div",{className:teasp.isNarrow()?"empApply2Div":"empApply2VL",style:"margin-left:"+(teasp.isNarrow()?20:60)+"px;"},i),l=dojo.create("div",{
className:"empApply2Div"},n||i,n?"last":"after"),i=dojo.create("div",{className:"empApply2CL",innerHTML:teasp.message.getLabel("ac00000250")},l),dojo.create("div",{className:"empApply2VL",style:"width:48px;",innerHTML:this.dayWrap.getEnterTime()},l),dojo.create("div",{className:"empApply2VL",style:"margin-left:20px;",innerHTML:this.dayWrap.getEnterDivergence()},l),teasp.isNarrow()||(dojo.style(i,"width","60px"),
dojo.style(i,"min-width","60px")),l=dojo.create("div",{className:"empApply2Div"},n||l,n?"last":"after"),i=dojo.create("div",{className:"empApply2CL",innerHTML:teasp.message.getLabel("ac00000260")},l),dojo.create("div",{className:"empApply2VL",style:"width:48px;",innerHTML:this.dayWrap.getExitTime()},l),dojo.create("div",{className:"empApply2VL",style:"margin-left:20px;",innerHTML:this.dayWrap.getExitDivergence()},l),
teasp.isNarrow()||(dojo.style(i,"width","60px"),dojo.style(i,"min-width","60px"))),this.createApplySetParts(e,r,o,s),this.createApplyTimeParts(e,r,o,s),this.createStatusParts(e,r,o,s),this.createErrorParts(e,r,o),a&&dojo.place(a,r),this.drawLast(s,t),dojo.byId("empApplyDone"+o));n&&this.eventHandles.push(dojo.connect(n,"onclick",this,function(e){var t,a=this.dayWrap.canSelectDailyEx(1);a.flag?(t={
empId:this.pouch.getEmpId(),month:this.pouch.getYearMonth(),startDate:this.pouch.getStartDate(),lastModifiedDate:this.pouch.getLastModifiedDate(),date:this.args.date,apply:{id:s?s.id:null,applyType:teasp.constant.APPLY_TYPE_DAILY,patternId:null,holidayId:null,status:null,startDate:this.args.date,endDate:this.args.date,exchangeDate:null,startTime:null,endTime:null,note:dojo.byId("dialogApplyNote"+o).value||null,
contact:null}},!this.pouch.isRequireNote(teasp.constant.APPLY_KEY_DAILY)||t.apply.note&&t.apply.note.replace(/[\s　]+$/g,"")?this.requestSend(o,t):teasp.dialog.EmpApply.showError(o,teasp.message.getLabel("tm10003680"))):teasp.dialog.EmpApply.showError(o,a.reason,!0)}))},teasp.dialog.EmpApply.prototype.createReviseTimeForm=function(e,t,C,W,a){var o=W&&teasp.constant.STATUS_FIX.contains(W.status)||this.isReadOnly(),
s=this.getInputClass(o,W),i=dojo.create("div",null,t),n=W?dojo.fromJson(W.timeTable.replace(/\\"/g,'"')):null,r=W?dojo.fromJson(W.oldValue.replace(/\\"/g,'"')):null,l=W?W.reviseType:null,p=l?l.substring(2,3):null,d=l?l.substring(1,2):null,c=l?l.substring(0,1):null,m=null,h=null,u=[],g=[];if(r&&n&&l){for(var y=0;y<r.length;y++)1==r[y].type?m=r[y]:21!=r[y].type&&22!=r[y].type||u.push(r[y]);for(y=0;y<n.length;y++
)1==n[y].type?h=n[y]:21!=n[y].type&&22!=n[y].type||g.push(n[y])}var f,u=teasp.util.sortSpans(u),g=teasp.util.sortSpans(g),l=this.dayWrap.getInputLimit(),b=dojo.create("div",{className:"empApply2Div"},i),_=(dojo.create("div",{className:"empApply2CL",innerHTML:teasp.message.getLabel("startTime_label")},b),!W||!o&&W.active?((v=dojo.create("input",{type:"text",id:"dialogApplyStartTime"+C,style:"margin:2px;",
className:"inputime roundBegin "+s,maxLength:5},dojo.create("div",{className:"empApply2VL"},b))).value=h?teasp.util.time.timeValue(h.from):this.dayWrap.getStartTime(!1,null,teasp.constant.C_REAL),v.disabled=1&l.flag,v.style.backgroundColor=1&l.flag?"#f5f5f5":"#ffffff",this.eventHandles.push(dojo.connect(v,"blur",this,teasp.util.time.onblurTime)),this.eventHandles.push(dojo.connect(v,"onkeypress",this,
teasp.util.time.onkeypressTime))):(f="0"==p?teasp.message.getLabel("tk10004100"):teasp.message.getLabel("tk10004091",teasp.message.getLabel("tk10004130","2"==p?teasp.message.getLabel("tk10004110"):teasp.util.time.timeValue(m.from),"number"!=typeof h.from?teasp.message.getLabel("tk10004120"):teasp.util.time.timeValue(h.from))),dojo.create("div",{innerHTML:f},dojo.create("div",{className:"empApply2VL"},b))),
b=dojo.create("div",{className:"empApply2Div"},i),dojo.create("div",{className:"empApply2CL",innerHTML:teasp.message.getLabel("endTime_label")},b),!W||!o&&W.active?((v=dojo.create("input",{type:"text",id:"dialogApplyEndTime"+C,style:"margin:2px;",className:"inputime roundEnd "+s,maxLength:5},dojo.create("div",{className:"empApply2VL"},b))).value=h?teasp.util.time.timeValue(h.to):this.dayWrap.getEndTime(!1,null,
teasp.constant.C_REAL),v.disabled=2&l.flag,v.style.backgroundColor=2&l.flag?"#f5f5f5":"#ffffff",this.eventHandles.push(dojo.connect(v,"blur",this,teasp.util.time.onblurTime)),this.eventHandles.push(dojo.connect(v,"onkeypress",this,teasp.util.time.onkeypressTime)),v=null):(f="0"==d?teasp.message.getLabel("tk10004100"):teasp.message.getLabel("tk10004091",teasp.message.getLabel("tk10004130",
"2"==d?teasp.message.getLabel("tk10004110"):teasp.util.time.timeValue(m.to),"number"!=typeof h.to?teasp.message.getLabel("tk10004120"):teasp.util.time.timeValue(h.to))),dojo.create("div",{innerHTML:f},dojo.create("div",{className:"empApply2VL"},b))),dojo.hitch(this,function(){var e,t,a,o,s;dojo.byId("dialogApplyReviseRestArea"+C)&&(e=this.dayWrap.getFixTimeNums(),t=dojo.byId("dialogApplyReviseRestBody"+C),
a=dojo.create("tr",null,t),o=dojo.create("td",{style:{paddingTop:"1px"}},a),s=dojo.create("input",{type:"text",value:"",maxlength:"5",style:{margin:"0px"},className:"inputran inputime roundBegin"},o),this.eventHandles.push(dojo.connect(s,"blur",this,teasp.util.time.onblurTime)),this.eventHandles.push(dojo.connect(s,"onkeypress",this,teasp.util.time.onkeypressTime)),dojo.attr(s,"fxtimes",e),dojo.create("td",{
innerHTML:teasp.message.getLabel("wave_label"),width:"20px",style:{paddingTop:"1px",textAlign:"center"}},a),o=dojo.create("td",{style:{paddingTop:"1px"}},a),s=dojo.create("input",{type:"text",value:"",maxlength:"5",style:{margin:"0px"},className:"inputran inputime roundEnd"},o),this.eventHandles.push(dojo.connect(s,"blur",this,teasp.util.time.onblurTime)),this.eventHandles.push(dojo.connect(s,"onkeypress",this,
teasp.util.time.onkeypressTime)),dojo.attr(s,"fxtimes",e),o=dojo.create("td",{width:"66px",style:{paddingTop:"1px",paddingLeft:"12px",textAlign:"center"}},a),dojo.create("div",{className:"pp_base pp_btn_del",style:{cursor:"pointer"},title:teasp.message.getLabel("delete_menu"),onclick:dojo.hitch(this,function(e){var t,a,o=((e=e||window.event).srcElement||e.target).parentNode.parentNode;"TR"==o.tagName&&(
e=o.cells[0].firstChild.value.trim(),t=o.cells[2].firstChild.value.trim(),e=""!=e?teasp.util.time.clock2minutes(e):null,t=""!=t?teasp.util.time.clock2minutes(t):null,a=function(){dojo.byId("dialogApplyReviseRestAdd"+C).className="pb_base pb_btn_plus",dojo.byId("dialogApplyReviseRestAdd"+C).disabled=!1,dojo.byId("dialogApplyReviseRestBody"+C).deleteRow(o.rowIndex),teasp.dialog.EmpApply.adjustContentHeight()},
null!=e||null!=t?teasp.manager.dialogOpen("MessageBox",{title:teasp.message.getLabel("em10002080"),message:teasp.message.getLabel("tm10003940")},this.pouch,this,function(){a()}):a())})},o),t.rows.length>=this.getRestMax()&&(dojo.byId("dialogApplyReviseRestAdd"+C).className="pb_base pb_btn_plus_dis",dojo.byId("dialogApplyReviseRestAdd"+C).disabled=!0),teasp.dialog.EmpApply.adjustContentHeight())}));if(b=dojo.create(
"div",{className:"empApply2Div"},i),dojo.create("div",{className:"empApply2CL",innerHTML:teasp.message.getLabel("restTime_label")},b),!W||!o&&W.active){var v,p=!c||"0"==c,s=dojo.create("tbody",null,dojo.create("table",{className:"pane_tble"},dojo.create("div",{className:"empApply2VL"},b))),b=dojo.create("tr",{id:"dialogApplyReviseRestRow1"+C},s),l=(p||(b.style.display="none"),dojo.create("td",null,b)),d=dojo.create(
"label",null,l),T=dojo.create("input",{type:"checkbox",id:"dialogApplyReviseRestChk"+C},d);d.appendChild(dojo.doc.createTextNode(" "+teasp.message.getLabel("tm10003930"))),this.eventHandles.push(dojo.connect(T,"onclick",this,function(){dojo.style("dialogApplyReviseRestRow1"+C,"display","none"),dojo.style("dialogApplyReviseRestRow2"+C,"display",""),teasp.dialog.EmpApply.adjustContentHeight()})),b=dojo.create("tr",{
id:"dialogApplyReviseRestRow2"+C},s),p&&(b.style.display="none"),l=dojo.create("td",null,b),d=dojo.create("div",{id:"dialogApplyReviseRestArea"+C,style:"width:200px;min-height:24px;padding:0px;margin:0px;border:1px solid #539AC7;overflow-x:hidden;"},l),teasp.isNarrow()||dojo.style(d,"max-height","110px"),dojo.create("tbody",{id:"dialogApplyReviseRestBody"+C},dojo.create("table",{className:"pane_tble",style:{
width:"100%"}},d)),l=dojo.create("td",{style:{paddingLeft:"8px",verticalAlign:"bottom"}},b),(v=dojo.create("input",{type:"button",id:"dialogApplyReviseRestAdd"+C,className:"pb_base pb_btn_plus"},l)).onclick=_}else{if("0"==c)f=teasp.message.getLabel("tk10004100");else{for(var j=[],y=0;y<u.length;y++)j.push(teasp.message.getLabel("tm10010461",teasp.util.time.timeValue(u[y].from),teasp.util.time.timeValue(u[y].to)));
for(var E=[],y=0;y<g.length;y++)E.push(teasp.message.getLabel("tm10010461",teasp.util.time.timeValue(g[y].from),teasp.util.time.timeValue(g[y].to)));f=teasp.message.getLabel("tk10004091",teasp.message.getLabel("tk10004130",j.length?j.join(", "):teasp.message.getLabel("tk10004120"),E.length?E.join(", "):teasp.message.getLabel("tk10004120")))}dojo.create("div",{innerHTML:f},dojo.create("div",{className:"empApply2VL",
style:dojo.string.substitute("width:${0};",[this.valueWidth])},b))}_(),this.createNoteParts(e,i,C,W),this.createApplySetParts(e,i,C,W),this.createApplyTimeParts(e,i,C,W),this.createStatusParts(e,i,C,W),this.createErrorParts(e,i,C),a&&dojo.place(a,i);for(var L=this.dayWrap.getTimeTable()||[],k=dojo.clone(L),y=k.length-1;0<=y;y--)k[y].type!=teasp.constant.REST_FIX&&k[y].type!=teasp.constant.REST_FREE&&k.splice(y,1);
var D=this.dayWrap.getPattern();if(W){if(!o&&g&&W.active){i=dojo.byId("dialogApplyReviseRestBody"+C);for(y=0;y<g.length;y++)y>=i.rows.length&&_(),(b=i.rows[y]).cells[0].firstChild.value=this.pouch.getDisplayTime(g[y].from),b.cells[2].firstChild.value=this.pouch.getDisplayTime(g[y].to)}}else{var I=[];if((""!==this.dayWrap.getStartTime(!1,"",teasp.constant.C_REAL)||""!==this.dayWrap.getEndTime(!1,"",
teasp.constant.C_REAL))&&0<L.length)for(y=0;y<L.length;y++)(A=L[y]).type!=teasp.constant.REST_FIX&&A.type!=teasp.constant.REST_FREE||I.push(A);else if(D)for(y=0;y<D.restTimes.length;y++){var A=D.restTimes[y];I.push(A)}for(I=I.sort(function(e,t){return("number"==typeof e.from?e.from:e.to)-("number"==typeof t.from?t.from:t.to)}),i=dojo.byId("dialogApplyReviseRestBody"+C),y=0;y<I.length;y++)y>=i.rows.length&&_(),(
b=i.rows[y]).cells[0].firstChild.value=this.pouch.getDisplayTime(I[y].from),b.cells[2].firstChild.value=this.pouch.getDisplayTime(I[y].to)}var F=this.dayWrap.getTimeHolidayTime(0<k.length?k:D?D.restTimes:[]),T=(this.drawLast(W,t),dojo.byId("empApplyDone"+C));T&&this.eventHandles.push(dojo.connect(T,"onclick",this,function(H){var e=teasp.util.time.clock2minutes(dojo.byId("dialogApplyStartTime"+C).value),
t=teasp.util.time.clock2minutes(dojo.byId("dialogApplyEndTime"+C).value);if("number"==typeof e||"number"==typeof t){if(!this.dayWrap.isExistApply(teasp.constant.APPLY_KEY_KYUSHTU)){if(this.dayWrap.isHoliday())return void teasp.dialog.EmpApply.showError(C,teasp.message.getLabel("tk10005250",teasp.message.getLabel("confHoliday_label")));if(this.dayWrap.isPlannedHoliday())return void teasp.dialog.EmpApply.showError(C,
teasp.message.getLabel("tk10005250",teasp.message.getLabel("tm10001360")))}if(this.dayWrap.getObj().interim)return void teasp.dialog.EmpApply.showError(C,teasp.message.getLabel("tk10005250",teasp.message.getLabel("tk10005260")))}if("number"==typeof e&&"number"==typeof t&&t<=e)teasp.dialog.EmpApply.showError(C,teasp.message.getLabel("tm10002020"));else if("number"==typeof e&&1440<=e)teasp.dialog.EmpApply.showError(C,
teasp.message.getLabel("tm10002030"));else if("number"==typeof t&&2880<t)teasp.dialog.EmpApply.showError(C,teasp.message.getLabel("tm10002040"));else{var a=this.pouch.getEmpDay(teasp.util.date.addDays(this.args.date,-1)),o=this.pouch.getEmpDay(teasp.util.date.addDays(this.args.date,1));if(a&&"number"==typeof a.getObj().endTime&&1440<a.getObj().endTime){a=a.getObj().endTime-1440;if("number"==typeof e&&e<a
)return void teasp.dialog.EmpApply.showError(C,teasp.message.getLabel("tm10002060"))}if(o&&"number"==typeof t&&1440<t){if("number"==typeof o.getObj().startTime)if(t-1440>o.getObj().startTime)return void teasp.dialog.EmpApply.showError(C,teasp.message.getLabel("tm10002070"));a=o.getProhibitOverNightWorkHoliday();if(a)return void teasp.dialog.EmpApply.showError(C,teasp.message.getLabel("tf10008360",a.name))}
var n=this.dayWrap.getPattern(),o=dojo.hitch(this,function(e){for(var t=[],a=dojo.byId("dialogApplyReviseRestBody"+C),o=0;o<a.rows.length;o++){var s=a.rows[o],i=teasp.util.time.clock2minutes(s.cells[0].firstChild.value),s=teasp.util.time.clock2minutes(s.cells[2].firstChild.value);"number"!=typeof i&&"number"!=typeof s||((i={from:"number"==typeof i?i:null,to:"number"==typeof s?s:null}).type=function(e){if(n)for(
var t=0;t<n.restTimes.length;t++){var a=n.restTimes[t];if(a.from==e.from&&a.to==e.to)return!0}return!1}(i)?teasp.constant.REST_FIX:teasp.constant.REST_FREE,t.push(i))}return t=(t=e?t.concat(this.dayWrap.getHourRests()):t).sort(function(e,t){return("number"==typeof e.from?e.from:e.to)-("number"==typeof t.from?t.from:t.to)})}),s=o(!1),a=this.dayWrap.getInputTimeRange(s),i=0;if("number"==typeof e&&e<a.from&&(
i="number"==typeof t&&t<=a.from?-1:1),(i="number"==typeof t&&t>a.to?"number"==typeof e&&e>=a.to?-1:2:i)<0)teasp.dialog.EmpApply.showError(C,teasp.message.getLabel("tm10002080"));else{i&&(1==i?e=a.from:t=a.to);var r=function(){var e=[];if(n)for(var t=0;t<n.restTimes.length;t++){var a=n.restTimes[t];a.type=teasp.constant.REST_FIX,e.push(a)}return e=0<e.length?e.sort(function(e,t){return(
"number"==typeof e.from?e.from:e.to)-("number"==typeof t.from?t.from:t.to)}):e}(),a=this.pouch.isKeepExteriorTime(),o=checkTimes(o(!0),[],r,e,t,a);if(o.message)teasp.dialog.EmpApply.showError(C,o.message);else{a=this.dayWrap.getTimeHolidayTime(o.timeTable);if(F!=a)teasp.dialog.EmpApply.showError(C,teasp.message.getLabel("tk10005110"));else{var a=this.dayWrap.getStartTime(!0,"",teasp.constant.C_REAL),
l=this.dayWrap.getEndTime(!0,"",teasp.constant.C_REAL),p="number"==typeof o.startTime?o.startTime:null,d=o.endTime||null,a={from:"number"==typeof(a=""===a?null:a)?a:null,to:"number"==typeof(l=""===l?null:l)?l:null,type:1},l=a.from===p?"0":null===a.from?"2":"1",c=a.to===d?"0":null===a.to?"2":"1",m="0",h=[],u=(h.push(a),[]),g=[];if(null===a.from&&null===a.to)h=h.concat(n.restTimes),g=n.restTimes;else{for(
var y=this.dayWrap.getTimeTable(),f=0;f<y.length;f++)y[f].type==teasp.constant.AWAY?u.push(y[f]):y[f].type!=teasp.constant.REST_FIX&&y[f].type!=teasp.constant.REST_FREE||g.push(y[f]);h=h.concat(y)}if(g=g.sort(function(e,t){return("number"==typeof e.from?e.from:e.to)-("number"==typeof t.from?t.from:t.to)}),s.length!=g.length)m="1";else for(f=0;f<s.length;f++)if(s[f].from!==g[f].from||s[f].to!==g[f].to){m="1";break}if(
this.pouch.isProhibitBorderRestTime()&&teasp.logic.EmpTime.checkBorderRestTime(p,d,o.timeTable))teasp.dialog.EmpApply.showError(C,teasp.message.getLabel("tf10008400"));else{var o=[{from:p,to:d,type:1}].concat(o.timeTable).concat(u),b=m+c+l;if("000"==b)teasp.dialog.EmpApply.showError(C,teasp.message.getLabel("tm10003950"));else{var _=!1;if("100"==b&&null===a.from&&null===a.to)teasp.dialog.EmpApply.showError(C,
teasp.message.getLabel("tf10008520"));else{if(null===p&&null===d){var v=!1,T="1"==m?s:g;if(T.length!=r.length)v=!0;else for(f=0;f<T.length;f++){var j=T[f];if(!(E=f<r.length?r[f]:null)||j.from!=E.from||j.to!=E.to){v=!0;break}}if(v){if("0"==m)m="1";else{if(v=!1,(T=g).length!=r.length)v=!0;else for(f=0;f<T.length;f++){var E,j=T[f];if(!(E=f<r.length?r[f]:null)||j.from!=E.from||j.to!=E.to){v=!0;break}}if(!v){if(
"00"==b.substring(1))return void teasp.dialog.EmpApply.showError(C,teasp.message.getLabel("tf10008530"));m="0"}}_=!0,o=[{from:p,to:d,type:1}].concat(s=r).concat(u),b=m+c+l}}var L=null,k=null;if("0"!=m){for(var D=[],I=[],f=0;f<g.length;f++)D.push(teasp.message.getLabel("tm10010461",teasp.util.time.timeValue(g[f].from),teasp.util.time.timeValue(g[f].to)));for(f=0;f<s.length;f++)I.push(teasp.message.getLabel(
"tm10010461",teasp.util.time.timeValue(s[f].from),teasp.util.time.timeValue(s[f].to)));L=D.join(", "),k=I.join(", ")}for(var A=this.pouch.isParallelMessage(),S=teasp.message.getLabel(A?"zw00102200":"zv00102200"),x=teasp.message.getLabel(A?"zw00102190":"zv00102190"),w=teasp.message.getLabel(A?"zw00102210":"zv00102210"),M=[[teasp.message.getLabel(A?"zw00102160":"zv00102160"),
"0"==l?S:null===a.from?x:teasp.util.time.timeValue(a.from),"0"==l?null:null===p?w:teasp.util.time.timeValue(p)],[teasp.message.getLabel(A?"zw00102170":"zv00102170"),"0"==c?S:null===a.to?x:teasp.util.time.timeValue(a.to),"0"==c?null:null===d?w:teasp.util.time.timeValue(d)],[teasp.message.getLabel(A?"zw00102180":"zv00102180"),"0"==m?S:L||w,"0"==m?null:k||w]],O=[],f=0;f<M.length;f++){var R=M[f],
P=A?"zw00102140":"zv00102140";R[2]||(P=A?"zw00102150":"zv00102150"),O.push(teasp.message.getLabel(P,R[0],R[1],R[2]))}var l=O.join("\n"),N={empId:this.pouch.getEmpId(),month:this.pouch.getYearMonth(),startDate:this.pouch.getStartDate(),lastModifiedDate:this.pouch.getLastModifiedDate(),date:this.args.date,apply:{id:W?W.id:null,applyType:teasp.constant.APPLY_TYPE_REVISETIME,patternId:null,holidayId:null,status:null,
startDate:this.args.date,endDate:this.args.date,exchangeDate:null,startTime:null,endTime:null,note:dojo.byId("dialogApplyNote"+C).value||null,contact:null,timeTable:dojo.toJson(o),oldValue:dojo.toJson(h),reviseType:b,content:l}};!this.pouch.isRequireNote(teasp.constant.APPLY_KEY_REVISETIME)||N.apply.note&&N.apply.note.replace(/[\s　]+$/g,"")?_?teasp.manager.dialogOpen("MessageBox",{title:teasp.message.getLabel(
"em10002080"),message:teasp.message.getLabel("tf10008530")},this.pouch,this,function(){this.requestSend(C,N)}):i?teasp.manager.dialogOpen("MessageBox",{title:teasp.message.getLabel("em10002080"),message:teasp.message.getLabel("tm10002090",1==i?teasp.message.getLabel("startTime_label"):teasp.message.getLabel("endTime_label"))},this.pouch,this,function(){1==i?dojo.byId("dialogApplyStartTime"+C
).value=teasp.util.time.timeValue(e):dojo.byId("dialogApplyEndTime"+C).value=teasp.util.time.timeValue(t),this.requestSend(C,N)}):this.requestSend(C,N):teasp.dialog.EmpApply.showError(C,teasp.message.getLabel("tm10003680"))}}}}}}}}))},teasp.dialog.EmpApply.prototype.getRestMax=function(){return 10},teasp.dialog.EmpApply.prototype.createShiftSettingForm=function(e,t,a,o){var t=dojo.create("div",null,t),s=dojo.create(
"div",{className:"empApply2Div"},t);dojo.create("div",{className:"empApply2CL",innerHTML:teasp.message.getLabel("dayType_label")},s),dojo.create("div",{className:"empApply2VL",innerHTML:this.pouch.getDisplayDayType(o.dayType,teasp.message.getLabel("tm10003890")),style:{margin:"2px"}},s),"1"!=o.dayType&&"2"!=o.dayType&&(s=dojo.create("div",{id:"dlgApplyPatternRow"+a,className:"empApply2Div"},t),dojo.create("div",{
className:"empApply2CL",innerHTML:teasp.message.getLabel("patterns_label")},s),dojo.create("div",{className:"empApply2VL",innerHTML:o.pattern?o.pattern.name:teasp.message.getLabel("tm10003890"),style:{margin:"2px"}},s),s=dojo.create("div",{id:"dlgApplyWorkPlaceRow"+a,className:"empApply2Div"},t),dojo.create("div",{className:"empApply2CL",innerHTML:teasp.message.getLabel("workPlace_label")},s),dojo.create("div",{
className:"empApply2VL",innerHTML:o.workPlace&&o.workPlace.Id!=this.pouch.getDeptId()?o.workPlace.name:teasp.message.getLabel("tm10003860"),style:{margin:"2px"}},s)),this.createTimeParts(e,t,a,o),"number"!=typeof o.startTime&&"number"!=typeof o.endTime&&dojo.style(dojo.byId("dialogApplyTimeRow"+a),"display","none"),this.createNoteParts(e,t,a,o),s=dojo.create("div",{id:"dialogApplyAppTimeRow"+a,
className:"empApply2Div"},t),dojo.create("div",{className:"empApply2CL",innerHTML:teasp.message.getLabel("setTime_label")},s),dojo.create("div",{id:"dialogApplyAppTime"+a,innerHTML:teasp.util.date.formatDateTime(o.applyTime,"SLA-HM"),className:"empApply2VL"},s)},teasp.dialog.EmpApply.prototype.createDirectForm=function(e,t,d,c,a){var o=c&&teasp.constant.STATUS_FIX.contains(c.status)||this.isReadOnly(),
s=this.getInputClass(o,c),i=this.dayWrap.existWaitReviseTime()||{},n=this.dayWrap.getStartTime(!0,null,teasp.constant.C_REAL),r=this.dayWrap.getEndTime(!0,null,teasp.constant.C_REAL),n=(i.from="number"==typeof n?n:i.from,i.to="number"==typeof r?r:i.to,dojo.create("div",null,t)),r=dojo.create("div",{className:"empApply2Div"},n),l=(dojo.create("div",{className:"empApply2CL",innerHTML:teasp.message.getLabel("tk10004670"
)},r),dojo.create("div",{className:"empApply2VL"},r)),p=dojo.create("div",{style:"margin:2px 10px 2px 2px;float:left;"},l),m=dojo.create("label",null,p),h=dojo.create("input",{type:"checkbox",style:"margin:2px;",id:"dialogApplyDirectIn"+d},m),p=(dojo.create("span",{innerHTML:teasp.message.getLabel("tk10004680"),style:"margin:2px;"},m),p=dojo.create("div",{style:"margin:2px 10px 2px 2px;float:left"},l),m=dojo.create(
"label",null,p),dojo.create("input",{type:"checkbox",style:"margin:2px;",id:"dialogApplyDirectOut"+d},m)),m=(dojo.create("span",{innerHTML:teasp.message.getLabel("tk10004690"),style:"margin:2px;"},m),dojo.create("div",{style:"clear:both;"},l),c&&(h.checked=0!=(1&c.directFlag),p.checked=0!=(2&c.directFlag)),h.disabled=!!c&&(teasp.constant.STATUS_FIX.contains(c.status)||!c.active),p.disabled=!!c&&(
teasp.constant.STATUS_FIX.contains(c.status)||!c.active),h.disabled||"number"!=typeof i.from||(h.checked=!1,h.disabled=!0),p.disabled||"number"!=typeof i.to||(p.checked=!1,p.disabled=!0),{from:this.args.date,to:this.getEndOfNormal(this.args.date)});if(this.createRangeParts(e,n,d,c,m),r=dojo.create("div",{className:"empApply2Div"},n),dojo.create("div",{className:"empApply2CL",innerHTML:teasp.message.getLabel(
"tk10004700")},r),!c||!o&&c.active){var u=dojo.create("select",{id:"dialogApplyWorkType"+d,className:"inputran",style:"width:"+(teasp.isNarrow()?270:320)+"px;margin:2px;"},dojo.create("div",{className:"empApply2VL"},r)),g=this.pouch.getWorkTypeList()||[];dojo.create("option",{value:"",innerHTML:""},u);for(var y=0;y<g.length;y++)dojo.create("option",{value:g[y],innerHTML:g[y]},u);r.style.display=0<g.length?"":"none"
}else{l=c.workType||"";dojo.create("div",{innerHTML:l,style:"margin:2px;"},dojo.create("div",{className:"empApply2VL"},r)),r.style.display=l?"":"none"}this.createNoteParts(e,n,d,c),r=dojo.create("div",{className:"empApply2Div"},n),dojo.create("div",{className:"empApply2CL",innerHTML:teasp.message.getLabel("tk10004710")},r);h=dojo.create("input",{type:"text",id:"dialogApplyTravelTime"+d,style:"margin:2px;",
className:"inputime "+s},dojo.create("div",{className:"empApply2VL"},r)),c&&"number"==typeof c.travelTime&&(h.value=teasp.util.time.timeValue(c.travelTime)),this.changeInputAreaView(h,c,o),o?h.readOnly="readOnly":(this.eventHandles.push(dojo.connect(h,"blur",this,teasp.util.time.onblurTime)),this.eventHandles.push(dojo.connect(h,"onkeypress",this,teasp.util.time.onkeypressTime))),this.createApplySetParts(e,n,d,c),
this.createApplyTimeParts(e,n,d,c),this.createStatusParts(e,n,d,c),this.createErrorParts(e,n,d),a&&dojo.place(a,n),this.drawLast(c,t),i=dojo.byId("empApplyDone"+d);i&&this.eventHandles.push(dojo.connect(i,"onclick",this,function(e){var t={empId:this.pouch.getEmpId(),month:this.pouch.getYearMonth(),startDate:this.pouch.getStartDate(),lastModifiedDate:this.pouch.getLastModifiedDate(),date:this.args.date,apply:{
id:c?c.id:null,name:teasp.constant.APPLY_TYPE_DIRECT,applyType:teasp.constant.APPLY_TYPE_DIRECT,patternId:null,holidayId:null,status:null,startDate:this.args.date,endDate:this.args.date,exchangeDate:null,startTime:null,endTime:null,note:dojo.byId("dialogApplyNote"+d).value||null,contact:null,directFlag:0,workType:null,travelTime:null}},a=teasp.util.strToDate(dojo.byId("dialogApplyStartDate"+d).value),
o=teasp.util.strToDate(dojo.byId("dialogApplyEndDate"+d).value);if(0!=a.failed)teasp.dialog.EmpApply.showError(d,dojo.replace(a.tmpl,[teasp.message.getLabel("rangeStartDate_label")]));else if(dojo.byId("dialogApplyStartDate"+d).value=a.dater,0!=o.failed)teasp.dialog.EmpApply.showError(d,dojo.replace(o.tmpl,[teasp.message.getLabel("rangeEndDate_label")]));else{if(dojo.byId("dialogApplyEndDate"+d).value=o.dater,
a.datef!=o.datef){var s=this.getEndOfNormal(this.args.date);if(0<dojo.date.compare(a.date,o.date,"date"))return void teasp.dialog.EmpApply.showError(d,teasp.message.getLabel("tm10003300"));if(0<teasp.util.date.compareDate(o.date,this.monthLastDate))return void teasp.dialog.EmpApply.showError(d,teasp.message.getLabel("tm10003320"));if(0<teasp.util.date.compareDate(o.date,s))return void teasp.dialog.EmpApply.showError(
d,teasp.message.getLabel("tk10004730"))}else o=a;if(t.apply.startDate=a.datef,t.apply.endDate=o.datef,!this.pouch.isRequireNote(teasp.constant.APPLY_KEY_DIRECT)||t.apply.note&&t.apply.note.replace(/[\s　]+$/g,""))if(dojo.byId("dialogApplyDirectIn"+d).checked&&(t.apply.directFlag|=1),dojo.byId("dialogApplyDirectOut"+d).checked&&(t.apply.directFlag|=2),t.apply.directFlag){
1==t.apply.directFlag?t.apply.name=teasp.message.getLabel("tk10004760",teasp.message.getLabel("tk10004680")):2==t.apply.directFlag&&(t.apply.name=teasp.message.getLabel("tk10004760",teasp.message.getLabel("tk10004690"))),t.apply.workType=dojo.byId("dialogApplyWorkType"+d).value||null;for(var s=teasp.util.time.clock2minutes(dojo.byId("dialogApplyTravelTime"+d).value),i=(t.apply.travelTime="number"==typeof s?s:null,
t.apply.directFlag),n=teasp.util.date.getDateList(t.apply.startDate,t.apply.endDate),r=0;r<n.length;r++){var l=n[r],l=this.pouch.getEmpDay(l);if(!teasp.logic.EmpTime.isFixDay(l.getObj())||l.getObj().plannedHoliday||l.isHolidayAll())return void teasp.dialog.EmpApply.showError(d,teasp.message.getLabel("tk10004730"));if(1&i&&"number"==typeof l.getObj().startTime)return void teasp.dialog.EmpApply.showError(d,
teasp.message.getLabel("tk10004740"));if(2&i&&"number"==typeof l.getObj().endTime)return void teasp.dialog.EmpApply.showError(d,teasp.message.getLabel("tk10004750"));l=l.existWaitReviseTime();if(l&&1&i&&"number"==typeof l.from)return void teasp.dialog.EmpApply.showError(d,teasp.message.getLabel("tf10005200"));if(l&&2&i&&"number"==typeof l.to)return void teasp.dialog.EmpApply.showError(d,teasp.message.getLabel(
"tf10005210"))}if(2&i){a=this.pouch.getEmpDay(t.apply.endDate);if((p=teasp.logic.EmpTime.filterTimeTable(a.createTimeTableFix(i),1)).length&&"number"==typeof p[0].to&&1440<p[0].to){o=this.pouch.getEmpDay(teasp.util.date.addDays(t.apply.endDate,1)).getProhibitOverNightWorkHoliday();if(o)return void teasp.dialog.EmpApply.showError(d,teasp.message.getLabel("tf10008360",o.name))}}if(1&i){var p,s=this.pouch.getEmpDay(
t.apply.startDate);if((p=teasp.logic.EmpTime.filterTimeTable(s.createTimeTableFix(i),1)).length&&"number"==typeof p[0].from){a=this.pouch.getEmpDay(teasp.util.date.addDays(t.apply.startDate,-1));if(a&&"number"==typeof a.getObj().endTime&&a.getObj().endTime-1440>p[0].from)return void teasp.dialog.EmpApply.showError(d,teasp.message.getLabel("tm10002060"))}}teasp.dialog.EmpApply.showError(d,null),
this.requestDirectApply(d,t)}else teasp.dialog.EmpApply.showError(d,teasp.message.getLabel("tk10004720"));else teasp.dialog.EmpApply.showError(d,teasp.message.getLabel("tm10003680"))}}))},teasp.provide("teasp.dialog.EmpMonthlyApply"),teasp.dialog.EmpMonthlyApply=function(){teasp.dialog.EmpApply.call(this)},teasp.dialog.EmpMonthlyApply.prototype=new teasp.dialog.EmpApply,
teasp.dialog.EmpMonthlyApply.prototype.initParam=function(){this.title=teasp.message.getLabel("mo00000010"),this.dialogManageKey="EmpMonthlyApply",this.initHeight=300,this.applyMenus=["monthlyOverTime"],this.applyTypes={monthlyOverTime:{name:teasp.constant.APPLY_TYPE_MONTHLYOVERTIME,title:teasp.message.getLabel("mo00000001"),create:this.createMonthlyOverTimeForm,descript:teasp.message.getLabel("mo00000005"),
getMenuFlag:function(){return this.pouch.isShowMonthlyOverTimeApplyButton()?this.pouch.canSelectMonthlyOverTime()?1:0:-1}}}},teasp.dialog.EmpMonthlyApply.prototype.ready=function(){this.applyList=this.pouch.getMonthlyOverTimeApplys(),this.monthFix=this.pouch.isEmpMonthFixed()},teasp.dialog.EmpMonthlyApply.prototype.postShow=function(){this.tc.startup()},teasp.dialog.EmpMonthlyApply.prototype.isShowApply=function(e){
return!0},teasp.dialog.EmpMonthlyApply.prototype.getApproverType=function(e){return teasp.constant.APPROVER_TYPE_MONTHLY},teasp.dialog.EmpMonthlyApply.prototype.canCancelApply=function(e){return teasp.constant.STATUS_APPROVES.contains(e.status)?this.pouch.canCancelDayApply()?e.status==teasp.constant.STATUS_ADMIT?3:2:0:teasp.constant.STATUS_REJECTS.contains(e.status)?-1:1},
teasp.dialog.EmpMonthlyApply.prototype.getApplyKey=function(e){for(var t in this.applyTypes)if(this.applyTypes.hasOwnProperty(t)&&this.applyTypes[t].name==e.applyType)return t;return null},teasp.dialog.EmpMonthlyApply.prototype.isReadOnly=function(){return this.monthFix||this.pouch.isReadOnly()},teasp.dialog.EmpMonthlyApply.prototype.getReadOnlyReason=function(){var e=0;return this.monthFix&&(e|=1),
this.pouch.isReadOnly()&&(e|=2),e},teasp.dialog.EmpMonthlyApply.prototype.isReapplyType=function(e){return!0},teasp.dialog.EmpMonthlyApply.prototype.createNewApply=function(e){var a=e.substring(9);return function(){for(var e in this.newEntry)if(this.newEntry.hasOwnProperty(e)){this.deleteTabChild(this.tc,dijit.byId(this.newEntry[e])),delete this.newEntry[e];break}var t=this.createContentPane(a);this.newEntry[a]=t.id,
this.tc.selectChild(t)}},teasp.dialog.EmpMonthlyApply.prototype.checkReapplyable=function(e){return(e?e.applyType:"")!=teasp.constant.APPLY_TYPE_MONTHLYOVERTIME||this.pouch.isUseMonthlyOverTimeApply()?1:0},teasp.dialog.EmpMonthlyApply.prototype.cancelApply=function(e,t){var t=this.pouch.getEmpApply(t),a=t.isReject(),o=t.isCancel(),s=teasp.message.getLabel(a||o?"tm10003011":"tm10003010",t.getDisplayApplyType()),i={
action:t.isReject()||t.isCancel()?"closeApplyEmpDay":"cancelApplyEmpDay",empId:this.pouch.getEmpId(),date:this.args.date,month:this.pouch.getYearMonth(),startDate:this.pouch.getStartDate(),lastModifiedDate:this.pouch.getLastModifiedDate(),appId:t.getId(),clearTime:!1,client:null,noDelay:!0},n={},r=(!t.isReject()||t.isClose()||this.pouch.getHandleInvalidApply()||(n.nohist={checked:!1,title:teasp.message.getLabel(
"tk10001177")}),""),r=t.isApprove()?teasp.message.getLabel("tk10000741"):a||o?teasp.message.getLabel("retractApply_label"):teasp.message.getLabel("cancelApply_btn_title");teasp.manager.dialogOpen("MessageBox",{title:teasp.message.getLabel("tk10004240",r),message:s,check:n},this.pouch,this,function(e){i.clearTime=!1,i.remove=e.nohist&&e.nohist.checked||!1,teasp.manager.dialogOpen("BusyWait"),teasp.manager.request(
"cancelApplyEmpDay",i,this.pouch,{hideBusy:!0},this,function(){this.onfinishfunc(),this.close(),teasp.manager.dialogClose("BusyWait")},function(e){teasp.manager.dialogClose("BusyWait"),teasp.message.alertError(e)})})},teasp.dialog.EmpMonthlyApply.prototype.requestSend=function(t,e,a){a||teasp.manager.dialogOpen("BusyWait"),teasp.manager.request("applyEmpDay",e,this.pouch,{hideBusy:!0},this,function(){
this.onfinishfunc(!0),this.close(),teasp.manager.dialogClose("BusyWait")},function(e){teasp.manager.dialogClose("BusyWait"),teasp.dialog.EmpApply.showError(t,teasp.message.getErrorMessage(e))},function(){this.onfinishfunc(),this.close(),teasp.manager.dialogClose("BusyWait")})},teasp.dialog.EmpMonthlyApply.prototype.isNotTheDayApply=function(e,t){return!1},
teasp.dialog.EmpMonthlyApply.prototype.createMonthlyOverTimeForm=function(e,t,a,o,s){var i=o&&teasp.constant.STATUS_FIX.contains(o.status)||this.isReadOnly(),n=this.getInputClass(i,o),r=dojo.create("div",null,t),l=dojo.create("div",{id:"dialogMonthlyOverTimeRow"+a,className:"empApply2Div"},r),l=(dojo.create("div",{className:"empApply2CL",innerHTML:teasp.message.getLabel("tf10010290")},l),dojo.create("div",{
id:"dialogMonthlyOverTime"+a,style:"margin:4px;",className:"empApply2VL",innerHTML:this.pouch.getAmountTimeForApply(o)},l),dojo.create("div",{id:"dialogApplyTimeRow"+a,className:"empApply2Div"},r)),n=(dojo.create("div",{className:"empApply2CL",innerHTML:teasp.message.getLabel("mo00000006")},l),dojo.create("input",{type:"text",id:"dialogApplyTime"+a,style:"margin:2px;width:60px;",maxLength:6,className:"inputime "+n},
dojo.create("div",{className:"empApply2VL"},l))),l=(o&&(n.value=teasp.util.time.timeValue(o.estimatedOverTime,this.timeForm),(teasp.constant.STATUS_FIX.contains(o.status)||this.isReadOnly())&&(n.readOnly="readOnly"),this.changeInputAreaView(n,o,i)),this.createNoteParts(e,r,a,o),this.createApplySetParts(e,r,a,o),this.createApplyTimeParts(e,r,a,o),this.createStatusParts(e,r,a,o),this.createErrorParts(e,r,a),
this.createWarnParts(e,r,a),o&&!this.pouch.isValidMonthlyOverTimeApply(o)&&teasp.dialog.EmpApply.showError(a,teasp.message.getLabel("mo00000013")),s&&dojo.place(s,r),dojo.query(".inputime",dojo.byId("dialogApplyTimeRow"+a)).forEach(function(e){this.eventHandles.push(dojo.connect(e,"blur",this,teasp.util.time.onblurTime)),this.eventHandles.push(dojo.connect(e,"onkeypress",this,teasp.util.time.onkeypressTime))},this),
this.drawLast(o,t),dojo.byId("empApplyDone"+a));l&&this.eventHandles.push(dojo.connect(l,"onclick",this,function(e){this.submitMonthlyOverTime(a,o)}))},teasp.dialog.EmpMonthlyApply.prototype.submitMonthlyOverTime=function(e,t){var a=teasp.util.time.clock2minutes(dojo.byId("dialogApplyTime"+e).value);void 0===a?teasp.dialog.EmpApply.showError(e,teasp.message.getLabel("mo00000007")
):a<0||59999<a?teasp.dialog.EmpApply.showError(e,teasp.message.getLabel("mo00000008")):(t={empId:this.pouch.getEmpId(),month:this.pouch.getYearMonth(),startDate:this.pouch.getStartDate(),lastModifiedDate:this.pouch.getLastModifiedDate(),apply:{id:t?t.id:null,applyType:teasp.constant.APPLY_TYPE_MONTHLYOVERTIME,estimatedOverTime:a,note:dojo.byId("dialogApplyNote"+e).value||null}},!this.pouch.isRequireNote(
teasp.constant.APPLY_KEY_MONTHLYOVERTIME)||t.apply.note&&t.apply.note.replace(/[\s　]+$/g,"")?this.requestSend(e,t):teasp.dialog.EmpApply.showError(e,teasp.message.getLabel("tm10003680")))},teasp.provide("teasp.dialog.EmpJobAssign"),teasp.dialog.EmpJobAssign=function(){this.widthHint=820,this.heightHint=440,this.id="dialogEmpJobAssign",this.title=teasp.message.getLabel("tm20003010"),this.duration=10,
this.content='<div id="empJobAssignRoot""></div>',this.id="empJobAssign",this.tc=null,this.jobMap={},this.msgmap={empJobLeftTable:{zeromsg:teasp.message.getLabel("tm20003020"),nullmsg:teasp.message.getLabel("tm20003030")},empJobRightTable:{zeromsg:teasp.message.getLabel("tm20003040")}},this.eventHandles=[]},teasp.dialog.EmpJobAssign.prototype=new teasp.dialog.Base,
teasp.dialog.EmpJobAssign.prototype.getLocalStorage=function(){return teasp.getLocalStorage("empJobAssignDialog")},teasp.dialog.EmpJobAssign.prototype.setLocalStorage=function(e){teasp.setLocalStorage("empJobAssignDialog",e)},teasp.dialog.EmpJobAssign.prototype.preInit=function(){require(["dijit/layout/TabContainer","dijit/layout/ContentPane"])},teasp.dialog.EmpJobAssign.prototype.preStart=function(){
this.tc=new dijit.layout.TabContainer({id:"empJobAssignTab"},"empJobAssignRoot"),this.tc.addChild(new dijit.layout.ContentPane({id:"empJobAssignPane1",title:teasp.message.getLabel("tm20003011"),
content:'<table class="eja_frame" style="width:100%;"><tr><td style="vertical-align:top !important;"><table class="pane_table" style="width:100%;"><tbody><tr><td><table class="atk_r_table" style="width:100%;"><tr><td class="head" style="width: 21px;"><input type="checkbox" id="empJobRightCheck0" style="margin:4px;" /></td><td class="head" style="width:110px;"><div id="dlg_jobAssign_code_head"></div></td><td class="head" style="width:auto;"><div id="dlg_jobAssign_jobName_head"></div></td><td class="head" style="width:185px;"><div id="dlg_jobAssign_effortName"></div></td></tr></table></td></tr><tr style="height:1px;"><td></td></tr><tr><td><div class="atk_r_record_area" style="width:100%;" id="empJobRightDiv"><table class="atk_r_record_table" id="empJobRightTable" style="width:100%;"><tbody></tbody></table></div></td></tr></tbody></table></td></tr><tr style="height:54px;vertical-align:middle;"><td><div id="empJobWarn1" style="padding:2px;color:red;"></div><table class="pane_table" style="width:100%;"><tbody><tr><td style="text-align:left;"><table class="pane_table" style="margin-left:10px;"><tbody><tr><td><button class="std-button2" style="margin:4px;" id="empJobDel"><div></div></button></td><td><button class="std-button2" style="margin:4px;" id="empJobReplicate" ><div></div></button></td><td><button class="std-button2" style="margin:4px;" id="empJobDown"><div></div></button></td><td><button class="std-button2" style="margin:4px;" id="empJobUp"><div></div></button></td></tr></tbody></table></td><td></td><td style="text-align:right;"><table class="pane_table" style="margin-right:20px;margin-left:auto;"><tbody><tr><td><button class="std-button1" style="margin:4px 10px;" id="empJobOk" ><div></div></button></td><td><button class="std-button2" style="margin:4px 10px;" id="empJobCancel" ><div></div></button></td></tr></tbody></table></td></tr></tbody></table></td></tr></table>'
})),this.tc.addChild(new dijit.layout.ContentPane({id:"empJobAssignPane2",title:teasp.message.getLabel("tm20003012"),
content:'<table class="eja_frame" style="width:100%;"><tr><td><table style="background-color:#EFEFEF;width:100%;"><tr><td class="edge_gray_tl"></td><td></td><td class="edge_gray_tr"></td></tr><tr><td></td><td><div style="margin:2px 4px;font-weight:bold;float:left;" id="dlg_jobAssign_code_label"></div><input type="text" value="" id="empJobCode" style="width:100px;padding:1px;float:left;" class="inputran" /><div style="margin:2px 4px 2px 8px;font-weight:bold;float:left;" id="dlg_jobAssign_jobName_label"></div><input type="text" value="" id="empJobName" style="width:200px;padding:1px;float:left;" class="inputran" /><div style="margin:2px 4px 2px 8px;font-weight:bold;float:left;" id="dlg_jobAssign_date_label"></div><input type="text" value="" id="empJobDate" class="inputab inpudate" style="float:left;" /><input type="button" id="empJobDateCal" class="pp_base pp_btn_cal" style="margin: 2px 4px;float:left;"><div style="clear:both;"></div><div style="margin:8px 4px 2px 2px;font-weight:bold;float:left;" id="dlg_jobAssign_jobDept_label"></div><select style="margin:6px 4px 2px 2px;float:left;padding:1px;width:320px;" id="empJobDept"></select><button class="std-button1" id="empJobSearch" style="margin:6px 4px 0px 12px;float:left;" ><div style="margin:3px 10px !important;"></div></button><div style="clear:both;"></div></td><td></td></tr><tr><td class="edge_gray_bl"></td><td></td><td class="edge_gray_br"></td></tr></table></td></tr><tr><td><div style="margin:6px 0px 4px 0px;font-weight:bold;" id="dlg_jobAssign_result_head"></div></td></tr><tr><td style="vertical-align:top !important;"><table class="pane_table" style="width:100%;"><tbody><tr><td><table class="atk_r_table" style="width:100%;"><tr><td class="head" style="width: 21px;"><input type="checkbox" id="empJobLeftCheck0" style="margin:4px;" /></td><td class="head" style="width:110px;"><div id="dlg_jobAssign_code_head2"></div></td><td class="head" style="width:auto;"><div id="dlg_jobAssign_jobName_head2"></div></td><td class="head" style="width:110px;"><div id="dlg_jobAssign_jobLeader_head"></div></td><td class="head" style="width:175px;"><div id="dlg_jobAssign_deptName_head"></div></td></tr></table></td></tr><tr style="height:1px;"><td></td></tr><tr><td><div class="atk_r_record_area" style="width:100%;" id="empJobLeftDiv"><table class="atk_r_record_table" id="empJobLeftTable" style="width:100%;"><tbody></tbody></table></div></td></tr></tbody></table></td></tr><tr style="height:54px;vertical-align:middle;"><td><div id="empJobWarn2" style="padding:2px;color:red;"></div><table class="pane_table" style="width:100%;"><tbody><tr><td><table class="pane_table" style="margin-left:auto;margin-right:auto;"><tbody><tr><td><button class="std-button1" style="margin:4px 8px;" id="empJobAdd" ><div></div></button></td><td><button class="std-button2" style="margin:4px 20px;" id="empJobCancel2" ><div></div></button></td></tr></tbody></table></td></tr></tbody></table></td></tr></table>'
})),this.tc.startup();var e=this.tc.getChildren();this.tc.selectChild(e[0]),dojo.create("div",{id:"empJobAssignHandle"},dojo.byId("empJobAssign")),teasp.message.setLabelHtml("dlg_jobAssign_code_head","code_head"),teasp.message.setLabelHtml("dlg_jobAssign_code_head2","code_head"),teasp.message.setLabelHtml("dlg_jobAssign_code_label","code_head"),teasp.message.setLabelHtml("dlg_jobAssign_jobName_head","tm20001030"),
teasp.message.setLabelHtml("dlg_jobAssign_jobName_head2","tm20001030"),teasp.message.setLabelHtml("dlg_jobAssign_jobName_label","tm20001030"),teasp.message.setLabelHtml("dlg_jobAssign_jobLeader_head","jobLeader_head"),teasp.message.setLabelHtml("dlg_jobAssign_effortName","workClass_head"),teasp.message.setLabelHtml("dlg_jobAssign_result_head","tm20003013"),teasp.message.setLabelHtml("dlg_jobAssign_jobDept_label",
"tk10000830"),teasp.message.setLabelHtml("dlg_jobAssign_deptName_head","tk10000830"),teasp.message.setLabelHtml("dlg_jobAssign_date_label","date_head"),dojo.byId("empJobDel").firstChild.innerHTML=teasp.message.getLabel("delete_btn_title"),dojo.byId("empJobReplicate").firstChild.innerHTML=teasp.message.getLabel("clone_btn_title"),dojo.byId("empJobDown").firstChild.innerHTML=teasp.message.getLabel("down_btn_title"),
dojo.byId("empJobUp").firstChild.innerHTML=teasp.message.getLabel("up_btn_title"),dojo.byId("empJobOk").firstChild.innerHTML=teasp.message.getLabel("save_btn_title"),dojo.byId("empJobCancel").firstChild.innerHTML=teasp.message.getLabel("cancel_btn_title"),dojo.byId("empJobSearch").firstChild.innerHTML=teasp.message.getLabel("search_btn_title"),dojo.byId("empJobAdd").firstChild.innerHTML=teasp.message.getLabel(
"tf10000290"),dojo.byId("empJobCancel2").firstChild.innerHTML=teasp.message.getLabel("cancel_btn_title"),dojo.connect(dojo.byId("empJobSearch"),"onclick",this,this.search),dojo.connect(dojo.byId("empJobAdd"),"onclick",this,this.empJobAdd),dojo.connect(dojo.byId("empJobDel"),"onclick",this,this.empJobDel),dojo.connect(dojo.byId("empJobUp"),"onclick",this,this.empJobUp),dojo.connect(dojo.byId("empJobDown"),"onclick",
this,this.empJobDown),dojo.connect(dojo.byId("empJobReplicate"),"onclick",this,this.empJobReplicate),dojo.connect(this.dialog,"onCancel",this,this.hide),dojo.connect(dojo.byId("empJobDateCal"),"onclick",this,function(e){var t=teasp.util.date.parseDate(dojo.byId("empJobDate").value);teasp.manager.dialogOpen("Calendar",{date:t,isDisabledDateFunc:function(e){return!1}},null,this,function(e){dojo.byId("empJobDate"
).value=teasp.util.date.formatDate(e,"SLA")})}),dojo.connect(dojo.byId("empJobOk"),"onclick",this,this.ok),dojo.connect(dojo.byId("empJobCancel"),"onclick",this,this.hide),dojo.connect(dojo.byId("empJobCancel2"),"onclick",this,this.hide),dojo.connect(dojo.byId("empJobLeftCheck0"),"onclick",this,function(){this.checkAll("empJobLeftTable",dojo.byId("empJobLeftCheck0").checked)}),dojo.connect(dojo.byId(
"empJobRightCheck0"),"onclick",this,function(){this.checkAll("empJobRightTable",dojo.byId("empJobRightCheck0").checked)})},teasp.dialog.EmpJobAssign.prototype.preShow=function(){for(var e,t=0;t<this.eventHandles.length;t++)dojo.disconnect(this.eventHandles[t]),delete this.eventHandles[t];for(e in this.eventHandles=[],this.classifyJobWorks=this.args.classifyJobWorks,dojo.byId("empJobLeftCheck0").checked=!1,dojo.byId(
"empJobRightCheck0").checked=!1,dojo.byId("empJobCode").value="",dojo.byId("empJobName").value="",dojo.byId("empJobDate").value=teasp.util.date.formatDate(this.args.date,"SLA"),this.jobMap={},this.classifyJobWorks)if(this.classifyJobWorks.hasOwnProperty(e))for(var a=this.classifyJobWorks[e],o=0;o<a.length;o++)this.jobMap[a[o].jobId]=a[o];this.showWarn1(null),this.showWarn2(null);for(var s=this.pouch.getMemberJobs(
this.classifyJobWorks).concat(),i=(300<s.length&&(this.showWarn2(teasp.message.getLabel("tk10000343",300,300)),s.splice(300,s.length)),this.createTable(s,"empJobLeftTable","empJobLeftDiv"),this.classifyJobWorks.assignJobs||[]),n={},r=[],t=0;t<i.length;t++){var l=i[t].jobId+":"+(i[t].process||"");n[l]?r.push(t):n[l]=i[t]}for(t=r.length-1;0<=t;t--)i.splice(r[t],1);this.createTable(i,"empJobRightTable","empJobRightDiv")
,dijit.byId("empJobAssignTab").selectChild(dijit.byId("empJobAssignPane1"));var p=dojo.byId("empJobDept"),d=(dojo.empty(p),this.pouch.getDeptList(this.args.date));dojo.create("option",{value:"",innerHTML:teasp.message.getLabel("tk10000344")},p),dojo.create("option",{value:"-1",innerHTML:teasp.message.getLabel("tk10000807")},p);for(var c,m,t=0;t<d.length;t++){var h=d[t];h.hidden||dojo.create("option",{value:h.id,
innerHTML:h.displayName},p)}return p.value=this.pouch.getDeptId()||"",this.RIGHT_H=188,this.LEFT_H=this.RIGHT_H+80,this.noDialog()?dojo.style("empJobAssign","height","auto"):(m=s=0,c=dojo.window.getBox(),this.resizeHandle?(s=this.jobDalogHeight,m=this.jobDalogWidth):(this.resizeHandle=new dojox.layout.ResizeHandle({resizeAxis:"xy",activeResize:!0,intermediateChanges:!0,minHeight:this.LEFT_H+26.4,minWidth:726,
constrainMax:!0,maxHeight:.85*c.h,maxWidth:.9*c.w,targetId:"empJobAssign"},dojo.byId("empJobAssignHandle")),dojo.connect(this.resizeHandle,"onResize",this,this.resizeDialog),m=(c=this.getLocalStorage())&&c.height&&c.width?(s=c.height,c.width):(s=550,1226),dojo.style("empJobAssignTab","height",s-53+"px")),dojo.style("empJobAssign","height",s+"px"),dojo.style("empJobAssign","width",m+"px"),c=s-this.RIGHT_H,
m=s-this.LEFT_H,dojo.style("empJobRightDiv","height",c+"px"),dojo.style("empJobLeftDiv","height",m+"px")),dojo.style("empJobAssign","margin","0px"),!0},teasp.dialog.EmpJobAssign.prototype.hide=function(){var e;this.noDialog()||(e=dojo.byId("empJobAssign"),this.jobDalogHeight=e.clientHeight,this.jobDalogWidth=e.clientWidth,this.setLocalStorage({height:e.clientHeight,width:e.clientWidth})),
teasp.dialog.Base.prototype.hide.call(this)},teasp.dialog.EmpJobAssign.prototype.resizeDialog=function(e){var t,a;this.noDialog()||(t=(a=dojo.byId("empJobAssign").clientHeight)-this.RIGHT_H,a=a-this.LEFT_H,dojo.style("empJobRightDiv","height",t+"px"),dojo.style("empJobLeftDiv","height",a+"px"))},teasp.dialog.EmpJobAssign.prototype.ok=function(){for(var e=this.getJobList("empJobRightTable"),t=(
teasp.util.deleteHasSameJobId(e,!0),[]),a=0;a<e.length;a++){var o=e[a];t.push({id:o.jobAssign?o.jobAssign.id:null,jobId:o.jobId,process:o.process})}console.log(t),teasp.action.contact.remoteMethods([{funcName:"getExtResult",params:{action:"saveJobAssign",empId:this.pouch.getEmpId(),jobs:t}}],{errorAreaId:null,nowait:!1},function(e){this.pouch.setKeyObj("jobAssigns",teasp.logic.convert.convJobAssignObjs(e.jobAssign||[
])),this.pouch.clearClassifyJobWorks(),this.onfinishfunc(),this.close()},null,this)},teasp.dialog.EmpJobAssign.prototype.createTable=function(e,t,a){for(var o,s,i=dojo.byId(t).getElementsByTagName("tbody")[0];i.firstChild;)dojo.destroy(i.firstChild);var n=dojo.byId("ruler1");n.style.fontSize="12px",n.style.width="329px";if(e)if(e.length<=0)o=dojo.create("tr",null,i),s=this.msgmap[t].zeromsg,dojo.create("div",{style:{
margin:"4px"},innerHTML:s},dojo.create("td",{style:{textAlign:"left",width:"329px"},colSpan:"3"},o)),s.getExtent(n).height;else{n.style.width="203px";for(var r=0;r<e.length;r++)this.insertRow(e[r],t,i),e[r].jobName.getExtent(n).height}else o=dojo.create("tr",null,i),s=this.msgmap[t].nullmsg,dojo.create("div",{style:{margin:"4px"},innerHTML:s},dojo.create("td",{style:{textAlign:"left",width:"329px"},colSpan:"3"},o)),
s.getExtent(n).height},teasp.dialog.EmpJobAssign.prototype.insertRow=function(e,t,a,o,s){var i=a.rows.length,n={id:t+"Row"+i,className:"sele "+(i%2==0?"even":"odd"),style:{cursor:"pointer"}},n=o?dojo.create("tr",n,o,"before"):dojo.create("tr",n,a),r=dojo.create("td",{style:{width:"21px",textAlign:"center"}},n),l=null,p=("empJobLeftTable"!=t&&e.jobId==this.pouch.getLeftoverJobId()||(l=dojo.create("input",{
type:"checkbox",style:{margin:"4px"}},r)),r=dojo.create("td",{style:{width:"110px",fontSize:"12px",textAlign:"left"}},n),this.eventHandles.push(dojo.connect(r,"onclick",this,this.clickRow)),dojo.create("div",{innerHTML:e.jobCode,style:{margin:"4px",wordBreak:"break-all"}},r),dojo.create("input",{type:"hidden",name:"jobId",value:e.jobId},r),r=dojo.create("td",{style:{width:"auto",fontSize:"12px",textAlign:"left"}},n),
this.eventHandles.push(dojo.connect(r,"onclick",this,this.clickRow)),dojo.create("div",{innerHTML:e.jobName,style:"margin:4px;word-break:break-all;"},r)),d=e.jobAssign&&e.jobAssign.job&&e.jobAssign.job.startDate||e.startDate||null;if((e.jobAssign&&e.jobAssign.job&&e.jobAssign.job.endDate||e.endDate||null)<this.args.date&&dojo.create("div",{innerHTML:teasp.message.getLabel("tf10008290"),
style:"float:right;font-size:90%;color:red;"},p),this.args.date<d&&dojo.create("div",{innerHTML:teasp.message.getLabel("tf10008300"),style:"float:right;font-size:90%;color:#3131de;"},p),"empJobLeftTable"==t){r=dojo.create("td",{style:{width:"110px",fontSize:"12px",textAlign:"left"}},n),this.eventHandles.push(dojo.connect(r,"onclick",this,this.clickRow));d=e.jobLeader||"";dojo.create("div",{innerHTML:d,style:{
margin:"4px",wordBreak:"break-all"}},r),r=dojo.create("td",{style:{width:"158px",fontSize:"12px",textAlign:"left"}},n),this.eventHandles.push(dojo.connect(r,"onclick",this,this.clickRow)),dojo.create("div",{innerHTML:e.deptId?(e.deptCode||"")+"-"+(e.deptName||""):"",style:{margin:"4px",wordBreak:"break-all"}},r)}else if("empJobRightTable"==t&&(r=dojo.create("td",{style:{width:"168px",fontSize:"12px",textAlign:"left",
wordBreak:"break-all"}},n),e.jobId!=this.pouch.getLeftoverJobId())){var c=dojo.create("select",{style:{width:"164px",marginLeft:"4px"}},r),m=this.pouch.getProcessList(e.jobAssign&&e.jobAssign.job||e);for(dojo.create("option",{value:"",innerHTML:""},c),i=0;i<m.length;i++)dojo.create("option",{value:m[i],innerHTML:m[i]},c);for(i=0;i<=c.options.length;i++){if(i==c.options.length){dojo.create("option",{value:e.process,
innerHTML:e.process||""},c),c.value=e.process||"";break}if((e.process||"")==c.options[i].value){c.value=e.process||"";break}}}s&&l&&(l.checked=!0),o&&1<o.cells[0].colSpan&&a.removeChild(o)},teasp.dialog.EmpJobAssign.prototype.insertElement=function(e,t,a,o){for(var s=null,i=a.rows.length-1;0<=i;i--){var n=a.rows[i];(1<n.cells[0].colSpan||!n.cells[0].firstChild)&&(s=n)}this.insertRow(e,t,a,s,!1)},
teasp.dialog.EmpJobAssign.prototype.deleteElement=function(e,t,a){e=a.rows[e];a.removeChild(e),dojo.destroy(e)},teasp.dialog.EmpJobAssign.prototype.insertElements=function(e,t){for(var a=dojo.byId(t).getElementsByTagName("tbody")[0],o=0;o<e.length;o++)this.insertElement(e[o],t,a);this.bulkConfiguration(t,a)},teasp.dialog.EmpJobAssign.prototype.deleteElements=function(e,t){for(var a,o,s=dojo.byId(t
).getElementsByTagName("tbody")[0],i=e.length-1;0<=i;i--)this.deleteElement(e[i],t,s);this.bulkConfiguration(t,s),s.rows.length||(a=dojo.create("tr",null,s),o=this.msgmap[t].zeromsg,dojo.create("div",{style:{margin:"4px"},innerHTML:o},dojo.create("td",{style:{textAlign:"left",width:"329px"},colSpan:"3"},a)))},teasp.dialog.EmpJobAssign.prototype.getJobList=function(e,t){for(var a=[],o=dojo.byId(e
).getElementsByTagName("tbody")[0],s=0;s<o.rows.length;s++){var i=o.rows[s],n=this.getJobIdByRow(i);n&&(!t||i.cells[0].firstChild&&i.cells[0].firstChild.checked)&&("empJobRightTable"!=e||t?a.push(this.jobMap[n]):(i=(i=3<i.cells.length?i.cells[3].firstChild:null)&&i.value||null,a.hasOwnProperty(n+i)?a.push(this.jobMap[n+i]):(a.push(dojo.clone(this.jobMap[n])),a[a.length-1].process=i)))}return a},
teasp.dialog.EmpJobAssign.prototype.getJobIdByRow=function(e){for(var t=1<e.cells.length?e.cells[1].firstChild:null;t;){if("INPUT"==t.tagName&&"hidden"==t.type)return t.value;t=t.nextSibling}return null},teasp.dialog.EmpJobAssign.prototype.getCheckedIndex=function(e,t){for(var a=dojo.byId(e).getElementsByTagName("tbody")[0],o=[],s=0;s<a.rows.length;s++){var i=a.rows[s];
i.cells[0].firstChild&&i.cells[0].firstChild.checked&&o.push(s)}return o},teasp.dialog.EmpJobAssign.prototype.checkAll=function(e,t){for(var a=dojo.byId(e).getElementsByTagName("tbody")[0],o=0;o<a.rows.length;o++){var s=a.rows[o].cells[0].firstChild;s&&"input"==s.tagName.toLowerCase()&&"checkbox"==s.type&&(s.checked=t)}},teasp.dialog.EmpJobAssign.prototype.search=function(){this.showWarn2(null);
var e=teasp.util.strToDate(dojo.byId("empJobDate").value);if(0!=e.failed)teasp.message.alertError(teasp.message.getLabel("tm00000050",teasp.message.getLabel("date_head")));else{dojo.byId("empJobDate").value=e.dater;for(var t=this.getJobList("empJobRightTable"),a=[],o=0;o<t.length;o++)a.push(t[o].jobId);var s=this.pouch.getLeftoverJobId();a.contains(s)||a.push(s),teasp.manager.request("searchJob",{
empId:this.pouch.getEmpId(),date:e.datef,jobCode:dojo.byId("empJobCode").value||null,jobName:dojo.byId("empJobName").value||null,deptId:dojo.byId("empJobDept").value||null,excludes:a,jobAssignClass:this.pouch.getJobAssignClass()},this.pouch,{hideBusy:!1},this,function(e){300<e.length&&(this.showWarn2(teasp.message.getLabel("tk10000343",300,300)),e.splice(300,e.length)),this.setSearchResult(e)},function(e){
teasp.message.alertError(e)})}},teasp.dialog.EmpJobAssign.prototype.empJobAdd=function(){var e=this.getJobList("empJobLeftTable",!0),t=this.getCheckedIndex("empJobLeftTable");e.length<=0||(this.checkAll("empJobRightTable",!1),this.insertElements(e,"empJobRightTable"),this.deleteElements(t,"empJobLeftTable"),dojo.byId("empJobLeftCheck0").checked=!1,dijit.byId("empJobAssignTab").selectChild(dijit.byId(
"empJobAssignPane1")))},teasp.dialog.EmpJobAssign.prototype.empJobDel=function(){var e,t=this.getJobList("empJobRightTable",!0),a=this.getCheckedIndex("empJobRightTable");t.length<=0||(e=this.getUnCheckedJob(!1,0),this.checkAll("empJobLeftTable",!1),this.deleteElements(a,"empJobRightTable"),teasp.util.deleteHasSameJobId(t),this.minusBySameJobId(t,e),this.insertElements(t,"empJobLeftTable"),dojo.byId(
"empJobRightCheck0").checked=!1)},teasp.dialog.EmpJobAssign.prototype.empJobUp=function(){for(var e=dojo.byId("empJobRightTable").getElementsByTagName("tbody")[0],t=0;t<e.rows.length;t++){var a,o=e.rows[t].cells[0].firstChild;!(o&&o.checked&&0<t)||e.rows[t-1].cells[0].firstChild&&e.rows[t-1].cells[0].firstChild.checked||(o=e.removeChild(e.rows[t-1]),(a=e.rows[t])?e.insertBefore(o,a):e.appendChild(o))}
this.bulkConfiguration("empJobRightTable",e)},teasp.dialog.EmpJobAssign.prototype.empJobDown=function(){for(var e=dojo.byId("empJobRightTable").getElementsByTagName("tbody")[0],t=e.rows.length-1;0<=t;t--){var a=e.rows[t].cells[0].firstChild;a&&a.checked&&t<e.rows.length-1&&e.rows[t+1].cells[0].firstChild&&!e.rows[t+1].cells[0].firstChild.checked&&e.insertBefore(e.removeChild(e.rows[t+1]),e.rows[t])}
this.bulkConfiguration("empJobRightTable",e)},teasp.dialog.EmpJobAssign.prototype.empJobReplicate=function(){for(var e=dojo.byId("empJobRightTable").getElementsByTagName("tbody")[0],t=e.rows.length-1;0<=t;t--){var a=e.rows[t].cells[0].firstChild;if(a&&a.checked){var o=e.rows[t].cloneNode(!0),a=e.rows[t+1];a?e.insertBefore(o,a):e.appendChild(o),o.cells[0].firstChild.checked=!1;for(var s=1;s<3;s++){var i=o.cells[s];
this.eventHandles.push(dojo.connect(i,"onclick",this,this.clickRow))}}}this.bulkConfiguration("empJobRightTable",e)},teasp.dialog.EmpJobAssign.prototype.clickRow=function(e){e=teasp.util.getAncestorByTagName(e.target,"TR");e&&dojo.query('input[type="checkbox"]',e).forEach(function(e){e.checked=!e.checked})},teasp.dialog.EmpJobAssign.prototype.setSearchResult=function(e){teasp.util.deleteHasSameJobId(e);for(
var t=0;t<e.length;t++){var a=e[t];this.jobMap[a.jobId]=a}this.createTable(e,"empJobLeftTable","empJobLeftDiv")},teasp.dialog.EmpJobAssign.prototype.showWarn1=function(e){dojo.byId("empJobWarn1").innerHTML=e||""},teasp.dialog.EmpJobAssign.prototype.showWarn2=function(e){dojo.byId("empJobWarn2").innerHTML=e||""},teasp.dialog.EmpJobAssign.prototype.minusBySameJobId=function(e,t){for(var a=[],o=0;o<e.length;o++)for(
var s=0;s<t.length;s++)e[o].jobId==t[s].jobId&&a.push(o);for(o=a.length-1;0<=o;o--)e.splice(a[o],1);return e},teasp.dialog.EmpJobAssign.prototype.bulkConfiguration=function(e,t){for(var a=0;a<t.rows.length;a++)t.rows[a].id=e+"Row"+a,dojo.toggleClass(t.rows[a],"even",a%2==0),dojo.toggleClass(t.rows[a],"odd",a%2!=0)},teasp.dialog.EmpJobAssign.prototype.getUnCheckedJob=function(e,t){for(var a,o,s=dojo.byId(
"empJobRightTable").getElementsByTagName("tbody")[0],i=[],n=0;n<s.rows.length;n++)e&&n==t||(a=s.rows[n],o=this.getJobIdByRow(a),a.cells[0].firstChild&&a.cells[0].firstChild.checked||i.push(this.jobMap[o]));return i=teasp.util.deleteHasSameJobId(i)},teasp.provide("teasp.dialog.EmpWorkOption"),teasp.dialog.EmpWorkOption=function(){this.widthHint=475,this.heightHint=155,this.id="dialogEmpWorkOption",
this.title=teasp.message.getLabel("tm20002010"),this.duration=1,
this.content='<div class="dlg_content" style="width:500px;"><table class="ts_a_frame"><tr><td class="edgelt"></td><td class="edgeht"></td><td class="edgert"></td></tr><tr><td class="edgevl"></td><td><div class="edge_div"><table class="stand_table"><tr><td class="left_s" id="workOpt_defaultInput_label" style="width:156px;"></td><td class="right"><select id="empWorkInputType"><option value="0" id="tm20010010"></option><option value="1" id="tm20010020"></option></select></td></tr><tr><td class="left_s" id="workOpt_workReport_label"></td><td class="right"><label><input type="checkbox" id="empWorkNoteOption" /><span style="margin: 0 0 0 5px;"id="workOpt_input"></span></label></td></tr><tr><td class="left_s" id="workOpt_taskReport_label"></td><td class="right"><label><input type="checkbox" id="empTaskNoteOption" /><span style="margin: 0 0 0 5px;"id="taskOpt_input"></span></label></td></tr><tr class="workOptLeftoverJobArea"><td class="left_s" id="workOpt_LeftoverJob_label" style="white-space:normal;"></td><td class="right"><select id="workOptLeftoverJobName" style="width:280px;"></select></td></tr><tr class="workOptLeftoverJobArea"><td colSpan="2"><div id="workOptCommentLeftoverJob" style="word-break:break-all;margin: 1px 4px 1px 40px;"></div></td></tr></table></div></td><td class="edgevr"></td></tr><tr><td class="edgelb"></td><td class="edgehb"></td><td class="edgerb"></td></tr></table><table border="0" cellpadding="0" cellspacing="0" style="width:100%;"><tr class="ts-buttons-row"><td style="padding:16px 0px 4px 0px;text-align:center;"><div><button class="std-button1" id="empWorkOptionOk" ><div></div></button><button class="std-button2" id="empWorkOptionCancel" ><div></div></button></div></td></tr></table></div>'
,this.okLink={id:"empWorkOptionOk",callback:this.ok},this.cancelLink={id:"empWorkOptionCancel",callback:this.hide}},teasp.dialog.EmpWorkOption.prototype=new teasp.dialog.Base,teasp.dialog.EmpWorkOption.prototype.preStart=function(){teasp.message.setLabelHtml("workOpt_defaultInput_label","defaultInput_label"),teasp.message.setLabelHtml("tm20010010"),teasp.message.setLabelHtml("tm20010020"),teasp.message.setLabelHtml(
"workOpt_workReport_label","workNote_label"),teasp.message.setLabelHtml("workOpt_taskReport_label","taskReport_label"),teasp.message.setLabelHtml("workOpt_input","tm20010030"),teasp.message.setLabelHtml("taskOpt_input","tm20010030"),teasp.message.setLabelHtml("workOpt_LeftoverJob_label","tk10003280"),teasp.message.setLabelHtml("workOptCommentLeftoverJob","tk10003291"),dojo.byId("empWorkOptionOk"
).firstChild.innerHTML=teasp.message.getLabel("save_btn_title"),dojo.byId("empWorkOptionCancel").firstChild.innerHTML=teasp.message.getLabel("cancel_btn_title")},teasp.dialog.EmpWorkOption.prototype.preShow=function(){dojo.byId("empWorkInputType").value=""+this.pouch.getWorkInputType(),dojo.byId("empWorkInputType").disabled=this.pouch.isWorkInputTimeFix(!0),dojo.byId("empWorkNoteOption"
).checked=this.pouch.getWorkNoteOption(),dojo.byId("empTaskNoteOption").checked=this.pouch.getTaskNoteOption();for(var t=this.pouch.isPermitChangeLeftoverJob(),e=(dojo.query(".workOptLeftoverJobArea").forEach(function(e){dojo.style(e,"display",t?"":"none")}),dojo.byId("workOptLeftoverJobName"));e.firstChild;)dojo.destroy(e.firstChild);dojo.create("option",{value:"",innerHTML:teasp.message.getLabel("tm10001680",
teasp.message.getLabel(this.args.comLoJobId?"tk10005310":"tm10010150"))},e);for(var a=this.args.jobs||[],o=0;o<a.length;o++){var s=a[o];dojo.create("option",{value:s.jobId,innerHTML:s.jobName},e)}return this.orgLeftoverJobId=this.args.empLoJobId||this.args.comLoJobId,e.value=this.orgLeftoverJobId||"",!0},teasp.dialog.EmpWorkOption.prototype.ok=function(){var e={empId:this.pouch.getEmpId(),workInputType:parseInt(
dojo.byId("empWorkInputType").value,10),workNoteOption:dojo.byId("empWorkNoteOption").checked,taskNoteOption:dojo.byId("empTaskNoteOption").checked,orgLeftoverJobId:this.orgLeftoverJobId,leftoverJobId:null,changeLeftoverJob:!1},t=!1;this.pouch.isPermitChangeLeftoverJob()&&(e.leftoverJobId=dojo.byId("workOptLeftoverJobName").value||null,this.orgLeftoverJobId!=e.leftoverJobId&&(t=!0,teasp.tsConfirmA(
teasp.message.getLabel("tk10005320"),this,function(){e.changeLeftoverJob=!0,this.ok2(e)}))),t||this.ok2(e)},teasp.dialog.EmpWorkOption.prototype.ok2=function(e){teasp.manager.request("saveEmpWorkOption",e,this.pouch,{hideBusy:!1},this,function(e,t){this.onfinishfunc(e,t),this.close()},function(e){teasp.message.alertError(e)})},teasp.provide("teasp.dialog.ExpApplyList"),teasp.dialog.ExpApplyList=function(){
this.widthHint=760,this.heightHint=250,this.id="dialogExpApplyList",this.title=teasp.message.getLabel("tm30003060"),this.duration=1,
this.content='<table border="0" cellpadding="0" cellspacing="0" style="width:738px;"><tr><td><table class="pane_table"><tbody><tr><td><table class="atk_r_table"><tr><td class="head" style="width: 28px;"><div></div></td><td class="head" style="width:100px;"><div id="expApply_expApplyNo_label"></div></td><td class="head" style="width:110px;"><div id="expApply_applyDate_label"></div></td><td class="head" style="width:200px;"><div id="expApply_applyDate_head"></div></td><td class="head" style="width: 80px;"><div id="expApply_rowCount_head"></div></td><td class="head" style="width:100px;"><div id="expApply_expCost_head"></div></td><td class="head" style="width:120px;"><div id="expApply_status_label"></div></td></tr></table></td></tr><tr style="height:1px;"><td></td></tr><tr><td><div class="atk_r_record_area" style="width:738px;height:140px;" id="expApplyListDiv"><table class="atk_r_record_table" id="expApplyListTable"><tbody></tbody></table></div></td></tr></tbody></table></td></tr><tr><td colspan="2" style="text-align:center;padding-top:16px;"><input type="button" class="pb_base pb_btn_ok" id="expApplyListOk" />&nbsp;&nbsp;&nbsp;&nbsp;<input type="button" class="pb_base pb_btn_close" id="expApplyListCancel" /></td></tr></table>'
,this.cancelLink={id:"expApplyListCancel",callback:this.hide},this.connectOk=null,this.eventHandles=[]},teasp.dialog.ExpApplyList.prototype=new teasp.dialog.Base,teasp.dialog.ExpApplyList.prototype.preStart=function(){teasp.message.setLabelHtml("expApply_expApplyNo_label","expApplyNo_label"),teasp.message.setLabelHtml("expApply_applyDate_label","applyDate_label"),teasp.message.setLabelHtml("expApply_applyDate_head",
"applyDate_head"),teasp.message.setLabelHtml("expApply_rowCount_head","rowCount_head"),teasp.message.setLabelHtml("expApply_expCost_head","expCost_head"),teasp.message.setLabelHtml("expApply_status_label","status_label"),teasp.message.setLabelTitle("expApplyListCancel","close_btn_title")},teasp.dialog.ExpApplyList.prototype.preShow=function(){for(var e=0;e<this.eventHandles.length;e++)dojo.disconnect(
this.eventHandles[e]),delete this.eventHandles[e];return this.eventHandles=[],0<this.args.applyList.length?(this.eventHandles.push(dojo.connect(dojo.byId("expApplyListOk"),"onclick",this,this.ok)),dojo.byId("expApplyListOk").className="pb_base pb_btn_ok"):dojo.byId("expApplyListOk").className="pb_base pb_btn_ok_dis",this.createTable(this.args.applyList,this.args.expApplyId),!0},
teasp.dialog.ExpApplyList.prototype.ok=function(){for(var e=null,t=dojo.byId("expApplyListTable").getElementsByTagName("tbody")[0],a=0;a<t.rows.length;a++){var o=t.rows[a],s=/expApply(.+)/.exec(o.id);if(o.cells[0].firstChild.checked&&s){e=s[1];break}}e&&(this.onfinishfunc(e),this.close())},teasp.dialog.ExpApplyList.prototype.createTable=function(e,t){for(var a=dojo.byId("expApplyListTable").getElementsByTagName(
"tbody")[0];a.firstChild;)dojo.destroy(a.firstChild);for(var o=dojo.byId("ruler1"),s=(o.style.fontSize="13px",o.style.width="661px",0),i=0,n=[],r=0;r<e.length;r++){var l=e[r];(!teasp.constant.STATUS_CANCELS.contains(l.status)||0<l.expDetails.length)&&n.push(l)}if(n.length<=0){var p=dojo.create("tr",null,a),d=teasp.message.getLabel("tm30003070");dojo.create("div",{style:{margin:"4px"},innerHTML:d},dojo.create("td",{
style:{textAlign:"left",width:"738px"},colspan:"7"},p)),s+=d.getExtent(o).height+8}else for(r=0;r<n.length;r++){var l=n[r],p=dojo.create("tr",{id:"expApply"+l.id,className:"sele "+(i++%2==0?"even":"odd"),style:{cursor:"pointer"}},a),c=(this.eventHandles.push(dojo.connect(p,"onclick",this,function(){var e=l.id;return function(){this.clickRow(e)}}())),this.eventHandles.push(dojo.connect(p,"ondblclick",this,function(){
this.dblclickRow()})),dojo.create("td",{style:{width:"28px",textAlign:"center"}},p)),c=dojo.create("input",{type:"radio",style:{margin:"4px"},name:"expApplyListRadio",id:"expApplyListRadio"+(r+1)},c);dojo.create("div",{innerHTML:l.expApplyNo},dojo.create("td",{style:{width:"100px",fontSize:"13px",textAlign:"center"}},p)),dojo.create("div",{innerHTML:teasp.util.date.formatDate(l.applyTime,"SLA")},dojo.create("td",{
style:{width:"110px",fontSize:"13px",textAlign:"center"}},p)),dojo.create("div",{innerHTML:this.getSpanDate(l)},dojo.create("td",{style:{width:"200px",fontSize:"13px",textAlign:"center"}},p)),dojo.create("div",{innerHTML:teasp.message.getLabel("tm30003080",l.count)},dojo.create("td",{style:{width:"80px",fontSize:"13px",textAlign:"center"}},p)),dojo.create("div",{innerHTML:teasp.util.currency.formatMoney(l.totalCost,
"&#165;#,##0")},dojo.create("td",{style:{width:"100px",fontSize:"13px",textAlign:"center"}},p)),dojo.create("div",{innerHTML:l.status},dojo.create("td",{style:{width:"103px",fontSize:"13px",textAlign:"center"}},p)),s+="Z".getExtent(o).height+8,l.id==t&&(c.checked=!0)}for(r=a.rows.length;r<7&&s<140;){p=dojo.create("tr",{className:i++%2==0?"even":"odd"},a);dojo.create("div",{style:{height:"20px"},innerHTML:""},
dojo.create("td",{colspan:"7"},p)),s+=20}140<s&&(s=140),dojo.byId("expApplyListDiv").style.height=s+"px"},teasp.dialog.ExpApplyList.prototype.getSpanDate=function(e){return 0==teasp.util.date.compareDate(e.startDate,e.endDate)?teasp.util.date.formatDate(e.startDate,"SLA"):teasp.message.getLabel("tm10003590",teasp.util.date.formatDate(e.startDate,"SLA"),teasp.util.date.formatDate(e.endDate,"SLA"))},
teasp.dialog.ExpApplyList.prototype.clickRow=function(e){dojo.byId("expApply"+e).cells[0].firstChild.checked=!0},teasp.dialog.ExpApplyList.prototype.dblclickRow=function(){this.ok()},teasp.provide("teasp.dialog.ExpHistory"),teasp.dialog.ExpHistory=function(){this.widthHint=780,this.heightHint=440,this.id="dialogExpHistory",this.title=teasp.message.getLabel("ekitanHistory_caption"),this.duration=1,
this.content='<table class="ekitan_his_frame"><tr><td style="padding-top:10px;"><table class="head" style="width:760px;"><thead><tr><th class="chk" style="width:24px" ></th><th class="from" style="width:60px" id="expHist_from" ></th><th class="arrow" style="width:16px" ></th><th class="to" style="width:60px" id="expHist_to"></th><th class="cost" style="width:82px" id="expHist_cost"></th><th class="route" style="width:515px" id="expHist_route"></th></tr></thead></table></td></tr><tr style="height:1px;"><td></td></tr><tr><td><div class="scroll_area" style="width:758px;" id="expHistoryArea"><table class="data" style="width:756px;"><tbody id="expHistoryTableBody"></tbody></table></div></td></tr><tr><td style="padding-top:4px;"><table class="horiz" style="width:760px;"><tr><td style="width:254px;"></td><td style="width:124px;text-align:center;"><input type="button" class="pb_base pb_btn_select" id="expHistoryOk" /></td><td style="width:124px;text-align:center;"><input type="button" class="pb_base pb_btn_cancel" id="expHistoryCancel" /></td><td style="width:142px;"></td><td style="width:116px;"><div class="pp_base pp_logo_ekitan" style="text-align:right;" ></div></td></tr></table></td></tr></table>'
,this.okLink={id:"expHistoryOk",callback:this.ok},this.cancelLink={id:"expHistoryCancel",callback:this.hide},this.rowMin=8,this.eventHandles=[]},teasp.dialog.ExpHistory.prototype=new teasp.dialog.Base,teasp.dialog.ExpHistory.prototype.preStart=function(){teasp.message.setLabelHtml("expHist_from","tm20006010"),teasp.message.setLabelHtml("expHist_to","tm20006020"),teasp.message.setLabelHtml("expHist_cost",
"expCost_head"),teasp.message.setLabelHtml("expHist_route","route_head"),teasp.message.setLabelTitle("expHistoryOk","select_btn_title"),teasp.message.setLabelTitle("expHistoryCancel","cancel_btn_title")},teasp.dialog.ExpHistory.prototype.preShow=function(){for(var e=0;e<this.eventHandles.length;e++)dojo.disconnect(this.eventHandles[e]),delete this.eventHandles[e];this.eventHandles=[];var t=this.pouch.getRouteHist();
this.routeHist=[];for(var a,e=0;e<t.length;e++)""==t[e]||(a=dojo.fromJson(t[e])).route&&a.searchKey&&a.route.lines&&this.routeHist.push({obj:a,expRoute:teasp.manager.routeHelper(a.route,e,!1,"History","expHistoryCost")});return this.createBody(),!0},teasp.dialog.ExpHistory.prototype.ok=function(){var e=this.getSelectRowIndex(),e=0<=e&&e<this.routeHist.length?this.routeHist[e]:null;e&&(this.onfinishfunc({roundTrip:!1,
searchKey:e.obj.searchKey,route:e.expRoute.getRoute()}),this.close())},teasp.dialog.ExpHistory.prototype.createBody=function(){for(var e=dojo.byId("expHistoryTableBody");e.firstChild;)dojo.destroy(e.firstChild);for(var t=this.rowMin<this.routeHist.length?this.routeHist.length:this.rowMin,a=0;a<t;a++){var o=a<this.routeHist.length?this.routeHist[a]:null;this.createRow(e,a,o)}var s=dojo.create("tr",null,e);dojo.create(
"div",{style:{width:"24px",height:"1px"}},dojo.create("td",null,s)),dojo.create("div",{style:{width:"60px",height:"1px"}},dojo.create("td",null,s)),dojo.create("div",{style:{width:"16px",height:"1px"}},dojo.create("td",null,s)),dojo.create("div",{style:{width:"60px",height:"1px"}},dojo.create("td",null,s)),dojo.create("div",{style:{width:"82px",height:"1px"}},dojo.create("td",null,s)),dojo.create("td",null,s),
e.rows.length<=10&&dojo.style("expHistoryArea","height",26*e.rows.length+"px")},teasp.dialog.ExpHistory.prototype.createRow=function(e,t,a){var o,e=dojo.create("tr",{className:"row "+(t%2==0?"even":"odd")},e),s=dojo.create("td",{className:"cell",style:{width:"24px"}},e);a&&(o=dojo.create("input",{type:"radio",id:"expHistorySel"+t,name:"expHistorySel"},s),0==t&&(o.checked=!0)),s=dojo.create("td",{className:"cell",
style:{width:"60px",borderLeft:"1px dashed #ADA6AD"}},e),a&&(s.style.cursor="pointer",s.innerHTML=a.obj.searchKey.stationFrom.name,this.eventHandles.push(dojo.connect(s,"onclick",this,this.clickHistoryRow(t)))),s=dojo.create("td",{className:"cell",style:{width:"16px"}},e),a&&(s.style.cursor="pointer",s.innerHTML=teasp.message.getLabel("tm20009080"),this.eventHandles.push(dojo.connect(s,"onclick",this,
this.clickHistoryRow(t)))),s=dojo.create("td",{className:"cell",style:{width:"60px"}},e),a&&(s.style.cursor="pointer",s.innerHTML=a.obj.searchKey.stationTo.name,this.eventHandles.push(dojo.connect(s,"onclick",this,this.clickHistoryRow(t)))),s=dojo.create("td",{className:"cell",style:{width:"82px",borderLeft:"1px dashed #ADA6AD"}},e),a&&(s.style.cursor="pointer",s.id="expHistoryCost"+t,s.innerHTML=a.expRoute.getFare(
"#,##0円"),this.eventHandles.push(dojo.connect(s,"onclick",this,this.clickHistoryRow(t)))),s=dojo.create("td",{className:"cell",style:{width:"499px",textAlign:"left",borderLeft:"1px dashed #ADA6AD"}},e),a&&(s.style.cursor="pointer",s.appendChild(a.expRoute.createRouteTable(!0)),this.eventHandles.push(dojo.connect(s,"onclick",this,this.clickHistoryRow(t))))},teasp.dialog.ExpHistory.prototype.clickHistoryRow=function(e
){var t=e;return function(){var e=dojo.byId("expHistoryTableBody").rows[t].cells[0].firstChild;e&&(e.checked=!0)}},teasp.dialog.ExpHistory.prototype.getSelectRowIndex=function(){for(var e=dojo.byId("expHistoryTableBody"),t=0;t<e.rows.length;t++)if(e.rows[t].cells[0].firstChild.checked)return t;return-1},teasp.provide("teasp.dialog.ExpSearch"),teasp.dialog.ExpSearch=function(){this.widthHint=770,this.heightHint=428,
this.id="dialogExpSearch",this.title=teasp.message.getLabel("ekitanResult_caption"),this.duration=1,
this.content='<table class="ekitan_search_frame" style="width:752px;"><tr><td><table class="cond" style="width:644px;"><tr><td class="from" style="width:170px;" id="ekSerch_stationFrom_label"></td><td class="arrow" style="width:24px;" ></td><td class="to" style="width:170px;" id="ekSerch_stationTo_label"></td><td class="route" style="width:190px;"><div class="horizon" style="display:table;margin:0px auto;"><div id="ekSerch_stationVia_label"></div><div id="expSearchViaHelp" class="pp_base pp_icon_help" style="margin:3px 0px 0px 3px;"></div></div></td><td class="search" style="width:90px;" ></td></tr><tr><td class="from"><input type="text" id="expSearchComboSt0" /></td><td class="arrow"><div id="expSearchResultArrow" class="pp_base pp_btn_oneway" style="margin-left:2px;"></div></td><td class="to"><input type="text" id="expSearchComboSt1" /></td><td class="route"><input type="text" value="" class="inputran" style="width:180px;height:17px;" maxlength="20" id="expSearchResultRoute" /></td><td class="search"><input type="button" class="pb_base pb_btn_research" id="expSearchResultSearch" /></td></tr><tr><td colspan="3"></td><td colspan="2" class="transfer" style="text-align:left;padding-left:20px;"><div class="horizon"><div><label><input type="checkbox" id="expSearchTransfer" /> <span id="expSearchTransferLabel"></span></label></div><div id="expSearchTransferHelp" class="pp_base pp_icon_help" style="margin:3px 0px 0px 3px;"></div></div></td></tr></table></td></tr><tr id="expSearchResultErrorRow" style="display:none;"><td style="padding-top:4px;text-align:center;"><span id="expSearchResultError" style="color: red;"></span></td></tr><tr><td style="padding-top:4px;"><table class="head" style="width:752px;"><thead><tr><th class="chk" ></th><th class="cost" id="expSearchColumn2"></th><th class="route" id="ekSerch_route_head"></th></tr></thead></table></td></tr><tr style="height:1px;"><td></td></tr><tr><td><div class="scroll_area" style="width:750px;" id="expSearchResultArea"><table class="data"><tbody id="expSearchResultTableBody"></tbody></table></div></td></tr><tr id="expSearchCtrl1Row" style="display:none;"><td style="padding-top:4px;"><table class="horiz" style="width:752px;"><tr><td style="width:234px;text-align:left"><div id="expSearchPeriodArea" style="display:none;"><span id="expSearchPeriodLabel"></span>&nbsp;<select id="expSearchPeriod"></select></div></td><td style="width:124px;text-align:center;"><input type="button" class="pb_base pb_btn_select" id="expSearchOk" /></td><td style="width:124px;text-align:center;"><input type="button" class="pb_base pb_btn_cancel" id="expSearchCancel" /></td><td style="width:154px;"></td><td style="width:116px;"><div class="pp_base pp_logo_ekitan" style="text-align:right;" ></div></td></tr></table></td></tr><tr id="expSearchCtrl2Row"><td style="padding-top:4px;"><table class="horiz" style="width:752px;"><tr><td style="width:234px;"></td><td style="width:248px;text-align:center;"><input type="button" class="pb_base pb_btn_close" id="expSearchClose" /></td><td style="width:154px;"></td><td style="width:116px;"><div class="pp_base pp_logo_ekitan" style="text-align:right;" ></div></td></tr></table></td></tr><tr id="expSearchCtrlWarnRow" style="display:none;"><td style="text-align:left;"><div id="expSearchCtrlWarn" style="color:blue;font-size:0.9em;padding-top:4px;"></div></td></tr></table>'
,this.okLink={id:"expSearchOk",callback:this.ok},this.cancelLink={id:"expSearchCancel",callback:this.hide},this.closeLink={id:"expSearchClose",callback:this.close},this.rowMin=6,this.comboSt=[],this.expRoutes=null,this.searchKey={},this.eventHandles=[]},teasp.dialog.ExpSearch.prototype=new teasp.dialog.Base,teasp.dialog.ExpSearch.prototype.preStart=function(){teasp.message.setLabelHtml("ekSerch_stationFrom_label",
"stationFrom_label"),teasp.message.setLabelHtml("ekSerch_stationTo_label","stationTo_label"),teasp.message.setLabelHtml("ekSerch_stationVia_label","stationVia_label"),teasp.message.setLabelHtml("expSearchColumn2","expCost_head"),teasp.message.setLabelHtml("ekSerch_route_head","route_head"),teasp.message.setLabelHtml("expSearchTransferLabel","tf10008820"),teasp.message.setLabelTitle("expSearchResultSearch",
"research_btn_title"),teasp.message.setLabelTitle("expSearchOk","select_btn_title"),teasp.message.setLabelTitle("expSearchCancel","cancel_btn_title"),teasp.message.setLabelTitle("expSearchClose","close_btn_title"),teasp.message.setLabelEx("expSearchCtrlWarn","tk10005060"),dojo.connect(dojo.byId("expSearchResultSearch"),"onclick",this,this.search),this.comboSt[0]=new dijit.form.ComboBox({id:"expSearchComboStList0",
name:"comboSt0",value:"",store:this.args.storeSt,fetchProperties:{sort:[{attribute:"score",descending:!0},{attribute:"name",descending:!1}]},searchAttr:"name",style:{width:"160px",border:"1px solid #539AC7"}},"expSearchComboSt0"),this.comboSt[1]=new dijit.form.ComboBox({id:"expSearchComboStList1",name:"comboSt1",value:"",store:this.args.storeSt,fetchProperties:{sort:[{attribute:"score",descending:!0},{
attribute:"name",descending:!1}]},searchAttr:"name",style:{width:"160px",border:"1px solid #539AC7"}},"expSearchComboSt1"),dojo.query(".dijitValidationIcon").forEach(function(e){dojo.style(e,"display","none")}),this.createTooltip({connectId:"expSearchViaHelp",label:teasp.message.getLabel("tf10008840"),position:["below"],showDelay:100}),this.createTooltip({connectId:"expSearchTransferHelp",
label:teasp.message.getLabel("tf10008830"),position:["below"],showDelay:100})},teasp.dialog.ExpSearch.prototype.createTooltip=function(e){new dijit.Tooltip(e).startup()},teasp.dialog.ExpSearch.prototype.preShow=function(){for(var e=0;e<this.eventHandles.length;e++)dojo.disconnect(this.eventHandles[e]),delete this.eventHandles[e];if(this.eventHandles=[],this.showError(null),this.resobj={routes:[]},dojo.style(
"expSearchPeriodArea","display",this.args.commuter?"":"none"),this.args.commuter){dojo.byId("expSearchPeriodLabel").innerHTML=teasp.message.getLabel("tk10005030");for(var t=dojo.byId("expSearchPeriod");t.firstChild;)dojo.destroy(t.firstChild);dojo.create("option",{value:"0",innerHTML:teasp.message.getLabel("tk10005010")},t),dojo.create("option",{value:"1",innerHTML:teasp.message.getLabel("tk10005040",1)},t),
dojo.create("option",{value:"3",innerHTML:teasp.message.getLabel("tk10005040",3)},t),dojo.create("option",{value:"6",innerHTML:teasp.message.getLabel("tk10005040",6)},t),t.value=this.pouch.getTicketPeriod(),this.eventHandles.push(dojo.connect(t,"onchange",this,this.changeTicketPeriod))}else this.eventHandles.push(dojo.connect(dojo.byId("expSearchResultArrow"),"onclick",this,this.checkRoundTrip));this.displayFareName(
),dojo.byId("expSearchResultArrow").className="pp_base "+(this.args.roundTrip?"pp_btn_round":"pp_btn_oneway"),dojo.style("expSearchResultArrow","cursor",this.args.commuter?"default":"pointer"),dojo.style("expSearchCtrl1Row","display",this.args.readonly||this.args.fixed?"none":""),dojo.style("expSearchCtrl2Row","display",this.args.readonly||this.args.fixed?"":"none"),dojo.style("expSearchCtrlWarnRow","display",
!this.args.commuter||this.args.readonly||this.args.fixed?"none":""),this.comboSt[0].store=this.args.storeSt,this.comboSt[1].store=this.args.storeSt;var a=[{name:this.args.from||"",code:null},{name:this.args.to||"",code:null}],o=!1;if(this.args.via){dojo.byId("expSearchResultRoute").value=this.args.via;for(var s=""!=this.args.via?this.args.via.split(/[,、， 　]+/):[],e=0;e<s.length;e++)a.push({name:s[e],code:null});
o=this.args.transfer||!1}else dojo.byId("expSearchResultRoute").value="";var i=null;if(this.args.searchKey)i=this.args.searchKey;else if(""!=a[0].name&&""!=a[1].name){for(var n={},r=0;r<a.length;r++)n[a[r].name]=null;var l=this.args.storeSt;for(p in n)l.fetch({query:{name:p},onItem:function(e){e=l.getValue(e,"code");""!=e&&(n[p]=e)}});this.comboSt[0].setValue(a[0].name),this.comboSt[1].setValue(a[1].name);var p,d=!1;
for(p in n)n[p]||(d=!1);for(i={stationFrom:{name:a[0].name,code:d?n[a[0].name]:null},stationTo:{name:a[1].name,code:d?n[a[1].name]:null},stationVia:[],transfer:o},r=2;r<a.length;r++)i.stationVia.push({name:a[r].name,code:d?n[a[r].name]:null})}if(i){var o=this.args.commuter?parseInt(this.pouch.getTicketPeriod(),10):0,c=this.args.config?dojo.toJson(this.args.config):null;if(this.args.searchRoute){var m=this;
this.args.searchRoute(dojo.mixin({action:"searchRoute",empId:this.args.empId,expDate:this.args.date,mode:o,config:c},i),function(e){m.resobj=e,m.createBody(),m.show()},function(e){m.resobj.routes=[],m.showError(teasp.message.getErrorMessage(e)),m.createBody(),m.show()})}else{this.searchKey=dojo.clone(i),this.searchKey.stationFrom.code=null,this.searchKey.stationTo.code=null;for(
e=0;e<this.searchKey.stationVia.length;e++)this.searchKey.stationVia[e].code=null;teasp.manager.request("searchRoute",dojo.mixin({empId:this.pouch.getEmpId(),expDate:this.args.date,mode:o,config:c},this.searchKey),this.pouch,{hideBusy:!1},this,function(e){this.resobj=e,this.createBody(),this.show()},function(e){this.resobj.routes=[],this.showError(teasp.message.getErrorMessage(e)),this.createBody(),this.show()})}
}else this.comboSt[0].setValue(a[0].name),this.comboSt[1].setValue(a[1].name),this.createBody(),this.show();return!1},teasp.dialog.ExpSearch.prototype.ok=function(){var e,t=this.getSelectRowIndex();t<0||(e="0",this.args.commuter&&(e=dojo.byId("expSearchPeriod").value),this.args.commuter&&"0"==e?this.showError(teasp.message.getLabel("tk10005020")):((t=0<=t&&t<this.expRoutes.getRouteCount()?this.expRoutes.getRoute(t
):null)&&(this.args.commuter&&!t.getCommuterCode()&&alert(teasp.message.getLabel("tk10005050")),this.onfinishfunc({roundTrip:dojo.hasClass("expSearchResultArrow","pp_btn_round"),searchKey:this.searchKey,searchPeriod:e,route:t.getRouteObj()})),this.close()))},teasp.dialog.ExpSearch.prototype.displayFareName=function(){dojo.byId("expSearchColumn2").innerHTML=this.args.commuter&&"0"!=dojo.byId("expSearchPeriod"
).value?teasp.message.getLabel("tm20005010",dojo.byId("expSearchPeriod").value):teasp.message.getLabel("expCost_head")},teasp.dialog.ExpSearch.prototype.createBody=function(){var e,t,a,o,s,i=[],n=[],r=[null,null],l=[this.resobj.stationFromList,this.resobj.stationToList],p=[this.resobj.stationVia1List,this.resobj.stationVia2List,this.resobj.stationVia3List],d=(this.expRoutes&&(this.expRoutes.destroy(),
this.expRoutes=null),this.expRoutes=new teasp.helper.EkitanRoutes(this.resobj.routes),s=dojo.hasClass("expSearchResultArrow","pp_btn_round"),e=dojo.byId("expSearchResultTableBody"),dojo.empty(e),this.displayFareName(),this.args.commuter&&"0"!=dojo.byId("expSearchPeriod").value);if(0<this.resobj.routes.length){for(o=0;o<2;o++)if(l[o])for(m=0;m<l[o].length;m++)s=l[o][m],0<this.expRoutes.getRouteCount()&&0==m&&(
this.comboSt[o].setValue(s.name),r[o]=s),i.push(s);for(this.searchKey.stationFrom=r[0],this.searchKey.stationTo=r[1],this.searchKey.stationVia=[],this.searchKey.transfer=this.resobj.transfer,o=0;o<3;o++)if(p[o])for(m=0;m<p[o].length;m++)s=p[o][m],0==m&&(n.push(s.name),this.searchKey.stationVia.push(s)),i.push(s);dojo.byId("expSearchResultRoute").value=0<n.length?n.join(","):"",dojo.byId("expSearchTransfer"
).checked=this.searchKey.transfer||!1;for(var c=[],m=0;m<i.length;m++)c.push(i[m]);var h=new dojo.store.Memory({data:c});this.comboSt[0].store=h,this.comboSt[1].store=h}for(a=this.rowMin<this.expRoutes.getRouteCount()?this.expRoutes.getRouteCount():this.rowMin,t=0;t<a;t++)this.createRow(e,t,this.expRoutes.getRoute(t),d);h=dojo.create("tr",null,e),dojo.create("div",{className:"clear26x1",width:"26px",height:"1px"},
dojo.create("td",null,h)),dojo.create("div",{className:"clear110x1",width:"110px",height:"1px"},dojo.create("td",null,h)),dojo.create("td",null,h)},teasp.dialog.ExpSearch.prototype.createRow=function(e,a,o,s){var t,e=dojo.create("tr",{className:"row "+(a%2==0?"even":"odd")},e),i=dojo.create("td",{className:"cell chk"},e);null!=o&&(t=dojo.create("input",{type:"radio",id:"expResultSel"+a,name:"expResultSel",style:{
width:"26px"}},i),this.args.commuterCode?t.checked=o.getCommuterCode()==this.args.commuterCode:t.checked=0==a),i=dojo.create("td",{className:"cell cost",style:{fontSize:"95%"}},e),null!=o&&(i.onclick=this.clickSearchResultRow(a),dojo.create("div",{id:"expResultCost"+a,style:"width:110px"},i)),i=dojo.create("td",{className:"cell route"},e),null!=o&&(i.onclick=this.clickSearchResultRow(a),i.appendChild(o.createTable({
tableId:"expResultTbl"+a,changedFare:function(e){var t=dojo.hasClass("expSearchResultArrow","pp_btn_oneway");dojo.byId("expResultCost"+a).innerHTML=s?o.getCommuterFare("#,##0円"):o.getFareEx(!t)}})))},teasp.dialog.ExpSearch.prototype.search=function(){var e,t,a,o,s,i,n=this.comboSt[0].getValue().trim(),r=this.comboSt[1].getValue().trim(),l=dojo.byId("expSearchResultRoute").value.trim();if(""==n)this.showError(
teasp.message.getLabel("tm20005030"));else if(""==r)this.showError(teasp.message.getLabel("tm20005040"));else if(n==r)this.showError(teasp.message.getLabel("tm20005050"));else if(this.showError(null),0<(i=""!=l?l.split(/[,、， 　]+/):[]).length&&(dojo.byId("expSearchResultRoute").value=i.join(","),3<i.length))this.showError(teasp.message.getLabel("tm20005060"));else{if(a=[n,r].concat(i),o=this.codeMapping(a),s=!1)for(
e=0;e<a.length;e++)if(!o[t=a[e]]){s=!1;break}for(this.searchKey={stationFrom:{name:n,code:s?o[n]:null},stationTo:{name:r,code:s?o[r]:null},stationVia:[],transfer:!1},e=0;e<i.length;e++)t=i[e],this.searchKey.stationVia.push({name:t,code:s?o[t]:null});this.searchKey.transfer=this.searchKey.stationVia.length&&dojo.byId("expSearchTransfer").checked||!1;var l=this.args.commuter?parseInt(dojo.byId("expSearchPeriod").value,
10):0,n=this.args.config?dojo.toJson(this.args.config):null,p=this;this.args.searchRoute?this.args.searchRoute(dojo.mixin({action:"searchRoute",empId:this.args.empId,expDate:this.args.date,mode:l,config:n},this.searchKey),function(e){p.resobj=e,p.createBody()},function(e){p.resobj.routes=[],p.showError(teasp.message.getErrorMessage(e)),p.createBody()}):teasp.manager.request("searchRoute",dojo.mixin({
empId:this.pouch.getEmpId(),expDate:this.args.date,mode:l,config:n},this.searchKey),this.pouch,{hideBusy:!1},this,function(e){p.resobj=e,p.createBody()},function(e){p.resobj.routes=[],p.showError(teasp.message.getErrorMessage(e)),p.createBody()})}},teasp.dialog.ExpSearch.prototype.checkRoundTrip=function(){var e=dojo.hasClass("expSearchResultArrow","pp_btn_oneway");dojo.byId("expSearchResultArrow"
).className="pp_base "+(e?"pp_btn_round":"pp_btn_oneway")},teasp.dialog.ExpSearch.prototype.changeTicketPeriod=function(){var e=this.comboSt[0].getValue().trim(),t=this.comboSt[1].getValue().trim();this.showError(null),""!=e&&""!=t&&e!=t&&this.search()},teasp.dialog.ExpSearch.prototype.clickSearchResultRow=function(e){var t=e;return function(){var e=dojo.byId("expSearchResultTableBody").rows[t].cells[0].firstChild;
e&&(e.checked=!0)}},teasp.dialog.ExpSearch.prototype.getSelectRowIndex=function(){for(var e=dojo.byId("expSearchResultTableBody"),t=0;t<e.rows.length;t++){var a=e.rows[t].cells[0].firstChild;if(a&&a.tagName&&"input"==a.tagName.toLowerCase()&&"radio"==a.type&&a.checked)return t}return-1},teasp.dialog.ExpSearch.prototype.codeMapping=function(e){for(var t={},a=this.args.storeSt,o=0;o<e.length;o++){var s=e[o];a.fetch({
query:{name:s},onItem:function(e){e=a.getValue(e,"code");e&&""!=e&&(t[s]=e)}})}return t},teasp.dialog.ExpSearch.prototype.showError=function(e){e?(dojo.style("expSearchResultErrorRow","display",""),dojo.byId("expSearchResultError").innerHTML=e.entitize()):dojo.style("expSearchResultErrorRow","display","none")},teasp.provide("teasp.dialog.Info"),teasp.dialog.Info=function(){this.id="dialogInfo",
this.title=teasp.message.getLabel("info_caption"),this.duration=1,
this.content='<table id="dialogInfoTable"><tr><td id="dialogInfoArea"><table class="info_table"><tbody><tr><td><table class="info_head"><tbody></tbody></table></td></tr><tr><td><div class="info_area" id="infoDiv" tabindex="1"><table class="info_body" id="infoTable"><tbody></tbody></table></div></td></tr></tbody></table></td><td id="dialogInfoRight" style="display:none;"><table><tr><td><label><input type="checkbox" class="check_old" /><span id="dialogInfoPast1"></span></label></td></tr><tr><td><button class="std-button2 close_button"><div></div></button></td></tr></table></td></tr><tr id="dialogInfoBottom"><td colspan="2"><table><tr><td></td><td><button class="std-button2 close_button" ><div></div></button></td><td><label><input type="checkbox" class="check_old" /><span id="dialogInfoPast2"></span></label></td></tr></table></td></tr></table>'
,this.agrees=null,this.eventHandles=[]},teasp.dialog.Info.prototype=new teasp.dialog.Base,teasp.dialog.Info.prototype.preStart=function(){this.args.small&&(this.dialog.maxRatio=1,this.widthHint=0,dojo.query(".dijitDialogTitleBar",this.dialog.id)[0].style.display="none",this.dialog._position=dojo.hitch(this.dialog,function(){var e=this.domNode.style;e.left="10px",e.top="16px"})),dojo.byId("dialogInfoTable"
).parentNode.style.paddingTop="2px",dojo.byId("dialogInfoTable").parentNode.style.paddingBottom="2px",dojo.query(".close_button").forEach(function(e){e.firstChild.innerHTML=teasp.message.getLabel("close_btn_title"),dojo.connect(e,"onclick",this,this.ok)},this),dojo.query(".check_old").forEach(function(e){dojo.connect(e,"onclick",this,this.checkInfoOld)},this),dojo.byId("dialogInfoPast1"
).innerHTML=" "+teasp.message.getLabel("infoPast_label"),dojo.byId("dialogInfoPast2").innerHTML=" "+teasp.message.getLabel("infoPast_label"),this.args.small&&dojo.query("table.info_table",dojo.byId("dialogInfoArea")).forEach(function(e){dojo.toggleClass(e,"info_small",!0)},this)},teasp.dialog.Info.prototype.preShow=function(){for(var e=0;e<this.eventHandles.length;e++)dojo.disconnect(this.eventHandles[e]),
delete this.eventHandles[e];this.eventHandles=[],this.agrees=[],this.args.small&&(dojo.style("dialogInfoRight","display",""),dojo.style("dialogInfoBottom","display","none"),dojo.byId("infoDiv").style.height="84px"),dojo.query(".close_button").forEach(function(e){dojo.toggleClass(e,"std-button2",!0),dojo.toggleClass(e,"std-button2-disabled",!1)}),dojo.query(".check_old").forEach(function(e){e.disabled=!1,e.checked=!1}
),dojo.style("dialogInfoTable","width",teasp.isNarrow()?"100%":this.args.small?"572px":"640px"),dojo.style("infoDiv","width",teasp.isNarrow()?"100%":this.args.small?"572px":"640px"),teasp.isNarrow()||dojo.style("infoDiv","overflow-y","scroll");var t=dojo.query("#dialogInfoTable table.info_head > tbody")[0],t=(dojo.empty(t),dojo.create("tr",null,t)),a=dojo.create("td",{className:"date"},t),o=dojo.create("td",{
className:"info"},t),t=dojo.create("td",{className:"agree"},t);return teasp.isNarrow()&&dojo.style(o,"width","auto"),dojo.create("div",{innerHTML:teasp.message.getLabel("date_head")},a),dojo.create("div",{innerHTML:teasp.message.getLabel("info_head")},o),dojo.create("div",{innerHTML:teasp.message.getLabel("infoAgree_head")},t),this.createInfoTable(),!0},teasp.dialog.Info.prototype.postShow=function(){dojo.byId(
"infoDiv").scrollTop=0},teasp.dialog.Info.prototype.ok=function(){dojo.query(".close_button").forEach(function(e){dojo.toggleClass(e,"std-button2",!1),dojo.toggleClass(e,"std-button2-disabled",!0)}),dojo.query('#infoDiv input[type="checkbox"]:checked').forEach(function(e){e.disabled||(e=teasp.util.getAncestorByTagName(e,"TR"),(e=/^info(.+)$/.exec(e.id))&&this.agrees.push(e[1]))},this),
0<this.agrees.length?teasp.manager.request("setInfoAgree",{empId:this.pouch.getEmpId(),infoId:this.agrees},this.pouch,{hideBusy:!0},this,function(){this.close()},function(e){teasp.message.alertError(e),this.close()}):this.close()},teasp.dialog.Info.prototype.close=function(){this.hide(),this.onfinishfunc&&this.onfinishfunc()},teasp.dialog.Info.prototype.createInfoTable=function(e){for(var t=dojo.query(
"#dialogInfoTable table.info_body > tbody")[0],a=(dojo.empty(t),this.pouch.getInfos()),o=this.pouch.getRejects(),s=this.pouch.getInvalidApplys(),i=2,n=[],r=0;r<o.length;r++){var l,p,d,c=o[r],m="";m=0==c.objectType?(d="",d=c.applyType==teasp.constant.APPLY_TYPE_MONTHLY?(l=c.yearMonth,p=c.subNo,teasp.util.date.formatMonth("zv00000020",Math.floor(l/100),l%100,p)):teasp.util.date.compareDate(c.startDate,c.endDate
)?teasp.util.date.formatDate(c.startDate,"SLA")+"-"+teasp.util.date.formatDate(c.endDate,"SLA"):teasp.util.date.formatDate(c.startDate,"SLA"),teasp.message.getLabel("tm10007020",teasp.data.EmpApply.getDisplayApplyType(c.applyType),d)):1==c.objectType?teasp.message.getLabel("tm10007030",teasp.message.getLabel("tm10007060",c.expApplyNo)):(l=c.yearMonth,p=c.subNo,d=teasp.util.date.formatMonth("zv00000020",Math.floor(
l/100),l%100,p),teasp.message.getLabel("tm10007040",d)),n.push({id:c.id,date:teasp.util.date.formatDate(c.rejectTime,"SLA"),text:m,click:this.clickRejectLink(c),margin:"4px",color:"#983660",cursor:"pointer"})}for(r=0;r<s.length;r++){var h=s[r];n.push({id:h.id,date:teasp.util.date.formatDate(h.date,"SLA"),text:h.text,margin:"4px"})}this.pouch.isDaiqLack()&&n.push({id:null,date:null,text:teasp.message.getLabel(
"tm10003780"),margin:"4px"});var u,g=this.pouch.getStockLack();for(u in g)g.hasOwnProperty(u)&&(b=g[u],n.push({id:null,date:teasp.util.date.formatDate(b.info.date,"SLA"),text:teasp.message.getLabel("tm10003781",b.info.name),margin:"4px"}));for(r=0;r<a.length;r++){var y=a[r];y.agree&&!e||n.push({id:y.id,date:teasp.util.date.formatDate(y.createdDate,"SLA",0),dated:y.createdDate,text:y.text?y.text.replace(/\n/g,"<br/>"
):"",margin:"4px",check:!0,checkDisable:y.agree||this.pouch.isReadOnly(),agree:y.agree})}for(var f=this.pouch.getDiverges(),r=0;r<f.length;r++){var b=f[r];n.push({id:null,date:teasp.util.date.formatDate(b.date,"SLA"),dated:0,text:teasp.message.getLabel("ac00000430"),margin:"4px"})}if((n=n.sort(function(e,t){return e.dated<t.dated?1:e.dated>t.dated||e.date<t.date?-1:e.date>t.date?1:0}))<=0){var _=dojo.create("tr",null
,t);dojo.create("div",{innerHTML:teasp.message.getLabel("tm10007010"),style:"margin:4px;"},dojo.create("td",{style:"text-align:left;"},_))}else for(var v=0,r=0;r<n.length;r++){var T,j=n[r],_=dojo.create("tr",{id:"info"+(j.id||""),className:v++%2==0?"even":"odd"},t),E=(dojo.create("div",{innerHTML:j.date||""},dojo.create("td",{className:"date"},_)),dojo.create("td",{className:"info"},_));teasp.isNarrow()&&dojo.style(E
,"width","auto"),T=dojo.create("div",{innerHTML:j.text},E),j.margin&&(T.style.margin=j.margin),j.color&&(T.style.color=j.color),j.cursor&&(T.style.cursor=j.cursor),this.eventHandles.push(dojo.connect(_,"onclick",this,function(e){"INPUT"==e.target.tagName&&"checkbox"==e.target.type||(e=teasp.util.getAncestorByTagName(e.target,"TR"),dojo.query('input[type="checkbox"]',e).forEach(function(e){e.disabled||(
e.checked=!e.checked)}))})),this.eventHandles.push(dojo.connect(T,"onclick",this,j.click||function(){})),E=dojo.create("td",{className:"agree"},_),j.check&&(T=dojo.create("input",{type:"checkbox",tabindex:i++},E),j.checkDisable&&(T.checked=j.agree,T.disabled=!0))}this.args.small?(dojo.query('input[type="checkbox"].check_old',this.dialog.domNode).forEach(function(e){dojo.setAttr(e,"tabindex",i++)}),dojo.query(
"button.close_button",this.dialog.domNode).forEach(function(e){dojo.setAttr(e,"tabindex",i++)})):(dojo.query("button.close_button",this.dialog.domNode).forEach(function(e){dojo.setAttr(e,"tabindex",i++)}),dojo.query('input[type="checkbox"].check_old',this.dialog.domNode).forEach(function(e){dojo.setAttr(e,"tabindex",i++)})),setTimeout(dojo.hitch(this,function(){var e=dojo.query(
"#dialogInfoTable table.info_body > tbody")[0].offsetHeight;teasp.isNarrow()||(this.args.small?dojo.style("infoDiv","height","84px"):26<e&&dojo.style("infoDiv","height",Math.min(e,300)+"px"))}),100)},teasp.dialog.Info.prototype.clickRejectLink=function(e){var s=e;return function(){var e="",t=s.startDate?teasp.util.date.formatDate(s.startDate,"yyyyMMdd"):"";if(0==s.objectType){if(
!this.args.small&&this.pouch.getStartDate()==s.startDate)return void this.dialog.hide();var a=teasp.viewPoint.viewParams||{},o=a.comp||0;/AtkWorkTimeView/.test(location.pathname)&&teasp.isSforce()&&a.empId==this.pouch.getEmpId()&&a.date==t&&"edit"==a.mode&&o++,e=teasp.getPageUrl("workTimeView")+"?empId="+this.pouch.getEmpId()+"&date="+t+"&mode=edit"+(o?"&comp="+o:"")}else 1==s.objectType?e=teasp.getPageUrl(
"empExpView")+"?empId="+this.pouch.getEmpId()+"&expApplyId="+s.id+"&mode=edit":2==s.objectType&&(e=teasp.getPageUrl("empJobView")+"?empId="+this.pouch.getEmpId()+"&date="+t+"&mode=edit");teasp.locationHref(e,top.location)}},teasp.dialog.Info.prototype.checkInfoOld=function(e){this.createInfoTable(e.target.checked)},teasp.provide("teasp.dialog.InputTime"),teasp.dialog.InputTime=function(){this.widthHint=310,
this.heightHint=380,this.id="dialogInputTime",this.title=teasp.message.getLabel("empTimeEdit_caption"),this.duration=100,
this.content='<table class="pane_table tt_input_area" style="width:382px;"><tr><td style="padding-bottom:4px;"><table class="pane_table" style="width:100%;"><tr><td style="padding-left:4px;white-space:nowrap;width:130px;"><span id="dlgInpTimeDate"></span></td><td style="padding-left:4px;text-align:left;"><span id="dlgInpTimeEvent" style="word-break:break-all;"></span></td><td id="dlgInpTimeLog" style="width:90px;text-align:right;"><button class="std-button2" style="margin-left:auto;margin-right:0px;" ><div></div></button></td></tr></table></td></tr><tr><td style="text-align:center;" id="dlgInputTimeTabs"></td></tr><tr id="dlgInpTimeErrorRow"><td><span id="dlgInpTimeError" style="color:#FF0000;"></span></td></tr><tr id="dlgInpTimeCtrl1" class="ts-buttons-row"><td style="text-align:center;padding-top:10px;padding-bottom:4px;"><div style="position:relative;width:100%;"><div style="margin-left:auto;margin-right:auto;display:table;"><button class="std-button1" id="dlgInpTimeOk" ><div></div></button><button class="std-button2" id="dlgInpTimeCancel" ><div></div></button></div><button class="red-button1-s" id="dlgInpTimeReset" style="position:absolute;right:0px;top:0px;" ><div style="font-size:80%;"></div></button></div></td></tr><tr id="timeInputDayFixRow"><td style="text-align:center;padding:8px 2px 2px 2px;"><label id="timeInputDayFixLabel"><input type="checkbox" id="timeInputDayFix" /> <span id="spanTimeInputDayFix"></span></label></td></tr><tr id="dlgInpTimeCtrl2" class="ts-buttons-row"><td style="text-align:center;padding-top:10px;padding-bottom:4px;"><div><button class="std-button2" id="dlgInpTimeClose" ><div></div></button></div></td></tr></table>'
,this.okLink={id:"dlgInpTimeOk",callback:this.ok},this.cancelLink={id:"dlgInpTimeCancel",callback:this.hide},this.closeLink={id:"dlgInpTimeClose",callback:this.hide},this.dayWrap=null,this.pattern=null,this.zenNum=["１","２","３","４","５","６","７","８","９","１０"],this.outMax=5,this.restMax=10,this.dailyFixable={flag:!1},this.readOnly=!1,this.eventHandles={},this.IO_AREA=1,this.REST_AREA=2,this.OUT_AREA=3},
teasp.dialog.InputTime.prototype=new teasp.dialog.Base,teasp.dialog.InputTime.prototype.hide=function(){for(var e in this.tc&&this.tc.destroyRecursive(!1),this.eventHandles)this.eventHandles.hasOwnProperty(e)&&(dojo.disconnect(this.eventHandles[e]),delete this.eventHandles[e]);this.eventHandles={},this.dialog.hide(),this.free(),this.dialog.destroy(),teasp.manager.dialogRemove("InputTime")},
teasp.dialog.InputTime.prototype.ready=function(){this.dayWrap=this.pouch.getEmpDay(this.args.date),this.pattern=this.dayWrap.getPattern(),this.readOnly=this.pouch.isUseReviseTimeApply()&&"number"!=typeof this.dayWrap.getObj().startTime&&"number"!=typeof this.dayWrap.getObj().endTime},teasp.dialog.InputTime.prototype.preStart=function(){var e;teasp.message.setLabelEx("spanTimeInputDayFix","tk10004050"),
this.eventHandles.dialogEv1=dojo.connect(dojo.byId("dlgInpTimeReset"),"onclick",this,this.reset),this.eventHandles.dialogEv2=dojo.connect(this.dialog,"onCancel",this,this.hide),dojo.byId("dlgInpTimeOk").firstChild.innerHTML=teasp.message.getLabel("save_btn_title"),dojo.byId("dlgInpTimeCancel").firstChild.innerHTML=teasp.message.getLabel("cancel_btn_title"),dojo.byId("dlgInpTimeReset"
).firstChild.innerHTML=teasp.message.getLabel("reset_btn_title"),dojo.byId("dlgInpTimeClose").firstChild.innerHTML=teasp.message.getLabel("close_btn_title"),this.pouch.isInputAccessControl(!0)?(dojo.query("#dlgInpTimeLog > button > div")[0].innerHTML=teasp.message.getLabel("ac00000300"),e=dojo.create("div",{id:"dlgInputTimeDiv"},dojo.byId("dlgInputTimeTabs")),this.tc=new dijit.layout.TabContainer({style:{
height:"328px",width:"430px"}},e),this.tc.addChild(new dijit.layout.ContentPane({id:"dlgInputTimeContent0",title:teasp.message.getLabel("ac00000190"),content:'<table class="pane_table tt_input_table" style="width:400px;"><tbody id="timeInputArea"></tbody></table>',onShow:this.changedPane(0)})),this.tc.addChild(new dijit.layout.ContentPane({id:"dlgInputTimeContent1",title:teasp.message.getLabel("ac00000200"),
content:'<div class="diverge-content"><table class="diverge-table1"><tr><td class="diverge-info"><div class="diverge-form"></div><table><tbody></tbody></table></td><td><div><select></select></div><div><textarea></textarea></div></td></tr></table><table class="diverge-table2"><tr><td class="diverge-info"><div class="diverge-form"></div><table><tbody></tbody></table></td><td><div><select></select></div><div><textarea></textarea></div></td></tr></table></div>',
onShow:this.changedPane(1)}))):(dojo.style("dlgInpTimeLog","display","none"),teasp.isNarrow()?(dojo.style(dojo.query(".tt_input_area",this.dialog.domNode)[0],"width","100%"),dojo.create("tbody",{id:"timeInputArea"},dojo.create("table",{className:"pane_table tt_input_table",style:"width:100%;"},dojo.byId("dlgInputTimeTabs")))):(dojo.style(dojo.query(".tt_input_area",this.dialog.domNode)[0],"width","322px"),
dojo.create("tbody",{id:"timeInputArea"},dojo.create("table",{className:"pane_table tt_input_table",style:"width:320px;"},dojo.byId("dlgInputTimeTabs")))))},teasp.dialog.InputTime.prototype.preShow=function(){this.showError(null),this.dailyFixable=this.dayWrap.canSelectDailyEx(1),dojo.byId("dlgInpTimeDate").innerHTML=teasp.util.date.formatDate(this.args.date,"JP1"),dojo.byId("dlgInpTimeEvent"
).innerHTML=this.dayWrap.getCalendarEvent(),dojo.style("dlgInpTimeCtrl1","display",this.isReadOnly()?"none":""),dojo.style("dlgInpTimeCtrl2","display",this.isReadOnly()?"":"none"),teasp.util.time.setTimeFormat(this.pouch.getTimeFormObj());for(var e=[],t=[],a=dojo.clone(this.dayWrap.getTimeTable()),o=a.length-1;0<=o;o--)a[o].type!=teasp.constant.REST_PAY&&a[o].type!=teasp.constant.REST_UNPAY||a.splice(o,1);if(
this.dayWrap.isInputTime()||0<a.length)for(o=0;o<a.length;o++)(s=a[o]).type==teasp.constant.AWAY?e.push(s):s.type!=teasp.constant.REST_FIX&&s.type!=teasp.constant.REST_FREE||t.push(s);else if(this.pattern)for(o=0;o<this.pattern.restTimes.length;o++){var s=this.pattern.restTimes[o];t.push(s)}t=t.sort(function(e,t){return("number"==typeof e.from?e.from:e.to)-("number"==typeof t.from?t.from:t.to)}),e=e.sort(function(e,t
){return("number"==typeof e.from?e.from:e.to)-("number"==typeof t.from?t.from:t.to)}),this.createInputArea(t.length,e.length),dojo.byId("startTime").value=this.dayWrap.getStartTime(!1,null,teasp.constant.C_REAL),dojo.byId("endTime").value=this.dayWrap.getEndTime(!1,null,teasp.constant.C_REAL),this.isNoEntry(!0)?dojo.style("dlgInpTimeReset","display","none"):dojo.style("dlgInpTimeReset","display",""),this.tc||(
dojo.byId("pushStartTime").innerHTML=this.dayWrap.getStartTimeEmboss(),dojo.byId("pushEndTime").innerHTML=this.dayWrap.getEndTimeEmboss());for(o=0;o<t.length;o++)dojo.byId("startRest"+(o+1)).value=this.pouch.getDisplayTime(t[o].from),dojo.byId("endRest"+(o+1)).value=this.pouch.getDisplayTime(t[o].to);for(o=0;o<e.length;o++)dojo.byId("startOut"+(o+1)).value=this.pouch.getDisplayTime(e[o].from),dojo.byId("endOut"+(o+1)
).value=this.pouch.getDisplayTime(e[o].to);this.pouch.isUseDailyApply()&&!this.isReadOnly()?(dojo.style("timeInputDayFixRow","display",""),(p=this.dailyFixable.flag&&this.dayWrap.isInputable(!0)&&this.isWorkLocationOk())||(dojo.byId("timeInputDayFix").checked=!1),dojo.byId("timeInputDayFix").disabled=!p,dojo.style("timeInputDayFixLabel","color",p?"#222222":"#CCCCCC")):dojo.style("timeInputDayFixRow","display","none")
,this.changedTime(),this.orgHolidayTime=this.dayWrap.getTimeHolidayTime(this.dayWrap.isInputTime()||0<a.length?a:this.pattern.restTimes);var i,n,r,l,p=dojo.byId(this.dialog.id);return this.tc&&(this.eventHandles.diverge0=dojo.connect(dojo.query("#dlgInpTimeLog > button")[0],"onclick",this,this.openAccessLog),n=0<(i=this.pouch.getDivergenceReasonList()).length&&!this.isReadOnly(),dojo.query(
".diverge-table1 .diverge-form",p)[0].innerHTML=teasp.message.getLabel("ac00000210"),r=dojo.query(".diverge-table1 select",p)[0],dojo.empty(r),n&&(dojo.create("option",{innerHTML:"",value:""},r),dojo.forEach(i,function(e){dojo.create("option",{innerHTML:e,value:e},r)}),this.eventHandles.diverge1=dojo.connect(r,"onchange",this,this.changedReason(1))),dojo.style(r,"display",n?"":"none"),dojo.query(
".diverge-table1 textarea",p)[0].readOnly=this.isReadOnly()?"readOnly":"",dojo.toggleClass(dojo.query(".diverge-table1 textarea",p)[0],"inputro",this.isReadOnly()),dojo.query(".diverge-table1 textarea",p)[0].maxLength=teasp.constant.DIVERGE_REASON_MAX,dojo.query(".diverge-table1 textarea",p)[0].value=this.dayWrap.getEnterDivergenceReason(),dojo.query(".diverge-table2 .diverge-form",p
)[0].innerHTML=teasp.message.getLabel("ac00000220"),l=dojo.query(".diverge-table2 select",p)[0],dojo.empty(l),n&&(dojo.create("option",{innerHTML:"",value:""},l),dojo.forEach(i,function(e){dojo.create("option",{innerHTML:e,value:e},l)}),this.eventHandles.diverge2=dojo.connect(l,"onchange",this,this.changedReason(2))),dojo.style(l,"display",n?"":"none"),dojo.query(".diverge-table2 textarea",p
)[0].readOnly=this.isReadOnly()?"readOnly":"",dojo.toggleClass(dojo.query(".diverge-table2 textarea",p)[0],"inputro",this.isReadOnly()),dojo.query(".diverge-table2 textarea",p)[0].maxLength=teasp.constant.DIVERGE_REASON_MAX,dojo.query(".diverge-table2 textarea",p)[0].value=this.dayWrap.getExitDivergenceReason(),this.setDivergenceInfo(),this.setDivergeLeftSide(p),this.tc.selectChild(this.tc.getChildren()[0])),!0},
teasp.dialog.InputTime.prototype.setDivergenceInfo=function(e){var t=this.dayWrap.getEnterTime(),t=(t&&(dojo.byId("pushStartTime").innerHTML="&nbsp;"+teasp.message.getLabel("ac00000450",t)+"&nbsp;&nbsp;&nbsp;"+this.dayWrap.getEnterDivergence(e)),this.dayWrap.getExitTime());t&&(dojo.byId("pushEndTime").innerHTML="&nbsp;"+teasp.message.getLabel("ac00000460",t)+"&nbsp;&nbsp;&nbsp;"+this.dayWrap.getExitDivergence(e))},
teasp.dialog.InputTime.prototype.setDivergeLeftSide=function(e,t){var a,o=dojo.query(".diverge-table1 td.diverge-info tbody",e)[0];dojo.empty(o),a=dojo.create("tr",null,o),dojo.create("td",{innerHTML:teasp.message.getLabel("startTime_head")},a),dojo.create("td",{innerHTML:t?"":this.dayWrap.getStartTime(!1,null,teasp.constant.C_REAL)},a),a=dojo.create("tr",null,o),dojo.create("td",{innerHTML:teasp.message.getLabel(
"ac00000250")},a),dojo.create("td",{innerHTML:this.dayWrap.getEnterTime()},a),a=dojo.create("tr",null,o),dojo.create("td",{innerHTML:this.dayWrap.getEnterDivergence(t),colSpan:2},a),o=dojo.query(".diverge-table2 td.diverge-info tbody",e)[0],dojo.empty(o),a=dojo.create("tr",null,o),dojo.create("td",{innerHTML:teasp.message.getLabel("endTime_head")},a),dojo.create("td",{innerHTML:t?"":this.dayWrap.getEndTime(!1,null,
teasp.constant.C_REAL)},a),a=dojo.create("tr",null,o),dojo.create("td",{innerHTML:teasp.message.getLabel("ac00000260")},a),dojo.create("td",{innerHTML:this.dayWrap.getExitTime()},a),a=dojo.create("tr",null,o),dojo.create("td",{innerHTML:this.dayWrap.getExitDivergence(t),colSpan:2},a)},teasp.dialog.InputTime.prototype.postShow=function(){this.tc&&this.tc.startup(),setTimeout(function(){var e=dojo.byId("startTime");
e.focus(),e.select()},100)},teasp.dialog.InputTime.prototype.ok=function(){var e,t,a=this.checkInput(),o=null,s=null,i=null,n=null;if(a){var a=teasp.util.time.clock2minutes(dojo.byId("startTime").value),r=teasp.util.time.clock2minutes(dojo.byId("endTime").value);if(void 0===a&&void 0===r)return void this.showError(teasp.message.getLabel("tm10002010"));if(void 0!==a&&void 0!==r&&r<=a)return void this.showError(
teasp.message.getLabel("tm10002020"));if(null!=a&&1440<=a)return void this.showError(teasp.message.getLabel("tm10002030"));if(null!=r&&2880<r)return void this.showError(teasp.message.getLabel("tm10002040"));if(null!=a&&null!=r&&r-a>this.pouch.getLimitedTimeDistance())return l=Math.floor(100*this.pouch.getLimitedTimeDistance()/60)/100,void this.showError(teasp.message.getLabel("tm10002050",l));if(
this.pouch.isPastTimeOnly()){var l=teasp.util.date.getToday().getTime(),p=this.dayWrap.getInputLimit();if(null!=a&&p&&!(1&p.directFlag))if(l<teasp.util.date.parseDate(this.args.date+" "+teasp.util.time.timeValue(a)+":00").getTime())return void this.showError(teasp.message.getLabel("tm10002140"));if(null!=r&&p&&!(2&p.directFlag))if(l<teasp.util.date.parseDate(this.args.date+" "+teasp.util.time.timeValue(r)+":00"
).getTime())return void this.showError(teasp.message.getLabel("tm10002140"))}if(this.pouch.isProhibitInputTimeUntilApproved()){p=this.dayWrap.isInputableEx();if(!p.inputable)return void this.showError(teasp.message.getLabel("tk10001152",p.applyName))}l=this.pouch.getEmpDay(teasp.util.date.addDays(this.args.date,-1)),p=this.pouch.getEmpDay(teasp.util.date.addDays(this.args.date,1));if(l&&"number"==typeof l.getObj(
).endTime&&1440<l.getObj().endTime){l=l.getObj().endTime-1440;if(null!=a&&a<l)return void this.showError(teasp.message.getLabel("tm10002060"))}if(this.pouch.isProhibitAcrossNextDayOfHolidayWork()&&this.dayWrap.isHoliday()&&this.dayWrap.isExistApply(teasp.constant.APPLY_KEY_KYUSHTU)&&null!=r&&1440<r)return void this.showError(teasp.message.getLabel("tf10008430"));if(this.pouch.isLeavingAcrossNextDay()&&p&&(
3==this.dayWrap.getDayType()?1:this.dayWrap.getDayType())!=(3==p.getDayType()?1:p.getDayType())&&null!=r&&1440<r)return void this.showError(teasp.message.getLabel("tk10001153",teasp.constant.getDayTypeWord(this.dayWrap.getDayType()),teasp.constant.getDayTypeWord(p.getDayType())));if(p&&null!=r&&1440<r){if("number"==typeof p.getObj().startTime)if(r-1440>p.getObj().startTime)return void this.showError(
teasp.message.getLabel("tm10002070"));l=p.getProhibitOverNightWorkHoliday();if(l)return void this.showError(teasp.message.getLabel("tf10008360",l.name))}var p=this.getRests(!0),l=this.dayWrap.getInputTimeRange(p),d=0;if(null!=a&&a<l.from&&(d=null!=r&&r<=l.from?-1:1),null!=r&&r>l.to&&(d=null!=a&&a>=l.to?-1:2),this.dayWrap.isCheckTimeOnHalfHoliday()){if(d<0)return void this.showError(teasp.message.getLabel("tm10002080"
));d&&(o=teasp.message.getLabel("tm10002090",1==d?teasp.message.getLabel("startTime_label"):teasp.message.getLabel("endTime_label")),1==d?a=l.from:r=l.to)}var c,d=this.getAways(),l=this.getFixRests(),m=this.pouch.isKeepExteriorTime();if((c=checkTimes(p,d,l,a,r,m)).message)return void this.showError(c.message);p=this.dayWrap.getTimeHolidayTime(c.timeTable);if(this.orgHolidayTime!=p)return void this.showError(
teasp.message.getLabel("tk10005110"));if(this.showError(null),!m&&c.over&&(s=teasp.message.getLabel("tm10002100")),this.pouch.isValidRestTimeCheck()||dojo.byId("timeInputDayFix").checked&&(this.pouch.isOverTimeRequireTime()||this.pouch.isEarlyWorkRequireTime()||this.pouch.isRequiredLateStartApply()||this.pouch.isRequiredEarlyEndApply())){var h=teasp.logic.EmpTime.getWorkAndRestTime(this.pouch.getObj(),
this.dayWrap.getKey(),a,r,c.rests);if(this.pouch.isValidRestTimeCheck()&&0<h.workTime){var u=this.pouch.getRestTimeCheck(),g=0;if(u&&is_array(u))for(var y=0;y<u.length;y++){var f=u[y];if(f.check&&h.workTime>f.workTime&&h.restTime<f.restTime){g=f.push?2:1;break}}g&&(2==g?n=teasp.message.getLabel("tm10002121"):i=teasp.message.getLabel("tm10002120"))}if(dojo.byId("timeInputDayFix").checked){d=[];if(
h.missingOverTimeApply&&d.push(teasp.message.getLabel("tf10008740",teasp.message.getLabel("tm10001293"))),h.missingEarlyWorkApply&&d.push(teasp.message.getLabel("tf10008740",teasp.message.getLabel("tm10001294"))),(h.missingOverTimeApplyExist||h.missingEarlyWorkApplyExist)&&d.push(teasp.message.getLabel("tf10008760")),h.missingLateStartApply&&d.push(teasp.message.getLabel("tf10008740",teasp.message.getLabel(
"applyLateStart_label"))),h.missingEarlyEndApply&&d.push(teasp.message.getLabel("tf10008740",teasp.message.getLabel("applyEarlyEnd_label"))),d.length)return d.unshift(teasp.message.getLabel("tf10008750")),void teasp.tsAlert(d.join("\n"),this)}}c.inpTime=!0}else c={inpTime:!1,timeTable:[]};if(dojo.byId("timeInputDayFix").checked&&!(h=this.dayWrap.canSelectDailyEx(3,c,{
enterDivergenceReason:this.getEnterDivergenceReason(),exitDivergenceReason:this.getExitDivergenceReason()})).flag)return void this.showError(h.reason,!0);this.pouch.isProhibitBorderRestTime()&&teasp.logic.EmpTime.checkBorderRestTime(c.startTime,c.endTime,c.timeTable)?this.showError(teasp.message.getLabel("tf10008400")):(this.showError(null),e=dojo.hitch(this,function(){i?teasp.tsConfirmA(i,this,function(){this.save(c
)}):n?teasp.tsAlert(n,this,function(){this.save(c)}):this.save(c)}),t=dojo.hitch(this,function(){s?teasp.tsConfirmA(s,this,function(){e()}):e()}),o?teasp.tsConfirmA(o,this,function(){"number"==typeof c.startTime&&(dojo.byId("startTime").value=teasp.util.time.timeValue(c.startTime)),"number"==typeof c.endTime&&(dojo.byId("endTime").value=teasp.util.time.timeValue(c.endTime)),t()}):t())},
teasp.dialog.InputTime.prototype.save=function(e){var t={from:"number"==typeof e.startTime?e.startTime:null,to:"number"==typeof e.endTime?e.endTime:null,type:1},t={empId:this.pouch.getEmpId(),month:this.pouch.getYearMonth(),startDate:this.pouch.getStartDate(),lastModifiedDate:this.pouch.getLastModifiedDate(),mode:this.pouch.getMode(),date:this.args.date,dayFix:this.pouch.isUseDailyApply(
)&&null!==t.from&&null!==t.to&&dojo.byId("timeInputDayFix").checked,client:this.args.client,timeTable:[t].concat(e.timeTable),refreshWork:this.pouch.isInputWorkingTimeOnWorkTImeView(),useInputAccessControl:this.pouch.isInputAccessControl(),enterDivergenceReason:this.getEnterDivergenceReason(),exitDivergenceReason:this.getExitDivergenceReason()},a=(this.pouch.isUseWorkLocation()&&(
t.workLocationId=this.getSelectedWorkLocationId()),this.execInputTimeTable(t));e.inpTime||!this.dayWrap.isInputTime()?a(!1):(e=null,this.pouch.isExistWorksByDate(t.date)&&(e={clear:{checked:!0,title:teasp.message.getLabel("tk10001166")}}),teasp.manager.dialogOpen("MessageBox",{title:teasp.message.getLabel("tk10001164"),message:teasp.message.getLabel("tk10001165",teasp.util.date.formatDate(t.date,"M/d")),check:e},
this.pouch,this,function(e){a(!!e.clear&&e.clear.checked)}))},teasp.dialog.InputTime.prototype.execInputTimeTable=function(e){var a=e,o=this;return function(e){var t=teasp.timestamp("inputTime start");a.clearWork=e,teasp.manager.request("inputTimeTable",a,o.pouch,{hideBusy:!1},o,function(){if(this.tc){this.dayWrap=this.pouch.getEmpDay(this.args.date);var e=this.dayWrap.getDivergenceJudge();if(0<e.type&&!e.reason
)return this.onfinishfunc(),this.setDivergenceInfo(),this.setDivergeLeftSide(dojo.byId(this.dialog.id)),this.showError(teasp.message.getLabel("ac00000430")),this.tc.selectChild(this.tc.getChildren()[1]),void this.focusReasonTextArea(0<e.dIn.type?1:2)}this.onfinishfunc();e=new Date;teasp.timestamp("inputTime end - "+(e.getTime()-t.getTime())),this.close()},function(e){this.showError(teasp.message.getErrorMessage(e))})
}},teasp.dialog.InputTime.prototype.createInputArea=function(e,t,a){var o=t<2?2:t,s=e<2?2:e,i=dojo.byId("timeInputArea"),e=(dojo.empty(i),this.dayWrap.getInputLimit().flag),n=dojo.create("tr",null,i),r=(dojo.create("td",{className:"edge_gray_tl"},n),dojo.create("td",{colSpan:"5"},n),dojo.create("td",{className:"edge_gray_tr"},n),n=dojo.create("tr",{style:{height:"5px"}},i),dojo.create("td",{colSpan:"7"},n),
n=dojo.create("tr",null,i),dojo.create("td",null,n),dojo.create("td",{style:"width:124px;vertical-align:middle;"},n)),l=(dojo.create("div",{className:"tt_col start-end",innerHTML:teasp.message.getLabel("startTime_head")},r),r=dojo.create("td",{style:"width:49px;"},n),dojo.create("input",{type:"text",className:"inputime roundBegin",id:"startTime"},r));this.isReadOnly(this.IO_AREA)||this.isNoEntry()||1&e?(
l.readOnly="readOnly",dojo.toggleClass(l,"inputro",!0)):(this.eventHandles.startTimeb=dojo.connect(l,"blur",this,function(e){teasp.util.time.onblurTime(e),this.changedTime()}),this.eventHandles.startTimek=dojo.connect(l,"onkeypress",this,function(e){teasp.util.time.onkeypressTime(e),13===e.keyCode&&this.changedTime()})),dojo.create("td",{id:"pushStartTime",colSpan:"4",
style:"padding-left:8px;font-size:0.8em;color:#3333CC;white-space:nowrap;"},n),n=dojo.create("tr",null,i),dojo.create("td",null,n),dojo.create("td",{colSpan:"5",className:"gyokan_dash"},n),dojo.create("td",null,n),n=dojo.create("tr",null,i),dojo.create("td",null,n),r=dojo.create("td",{style:"width:124px;vertical-align:middle;"},n),dojo.create("div",{className:"tt_col start-end",innerHTML:teasp.message.getLabel(
"endTime_head")},r),r=dojo.create("td",{style:"width:49px;"},n),l=dojo.create("input",{type:"text",className:"inputime roundEnd",id:"endTime"},r),this.isReadOnly(this.IO_AREA)||this.isNoEntry()||2&e?(l.readOnly="readOnly",dojo.toggleClass(l,"inputro",!0)):(this.eventHandles.endTimeb=dojo.connect(l,"blur",this,function(e){teasp.util.time.onblurTime(e),this.changedTime()}),this.eventHandles.endTimek=dojo.connect(l,
"onkeypress",this,function(e){teasp.util.time.onkeypressTime(e),13===e.keyCode&&this.changedTime()})),dojo.create("td",{id:"pushEndTime",colSpan:"4",style:"padding-left:8px;font-size:0.8em;color:#3333CC;white-space:nowrap;"},n),n=dojo.create("tr",null,i),dojo.create("td",null,n),dojo.create("td",{colSpan:"5",className:"gyokan_dash"},n),dojo.create("td",null,n);for(var p=0;p<s;p++)this.createRestRow(i,p,-1,0===p,2*s-1
);if(dojo.query(".tt_rest_plus").forEach(function(e){e.firstChild.disabled=s>=this.restMax,e.firstChild.className=s>=this.restMax||this.isReadOnly(this.REST_AREA)||this.isNoEntry()?"pb_btn_plusL_dis":"pb_btn_plusL"},this),n=dojo.create("tr",{className:"tt_rest_end"},i),!this.pouch.isHideAwayTimeInputField()||0<t){for(dojo.create("td",null,n),dojo.create("td",{colSpan:"5",className:"gyokan_dash"},n),dojo.create("td",
null,n),p=0;p<o;p++)this.createOutRow(i,p,-1,0===p,2*o-1);dojo.query(".tt_out_plus").forEach(function(e){e.firstChild.disabled=o>=this.outMax,e.firstChild.className=o>=this.outMax||this.isReadOnly(this.OUT_AREA)?"pb_btn_plusL_dis":"pb_btn_plusL"},this),n=dojo.create("tr",{className:"tt_out_end"},i)}this.pouch.isUseWorkLocation()&&(dojo.create("td",null,n),dojo.create("td",{colSpan:"5",className:"gyokan_dash"},n),
dojo.create("td",null,n),this.createWorkLocationRow(i,a),n=dojo.create("tr",{className:"tt_workLocation_end"},i)),dojo.create("td",null,n),dojo.create("td",{colSpan:"5",className:"tt_gyokan"},n),dojo.create("td",null,n),n=dojo.create("tr",null,i),dojo.create("td",{className:"edge_gray_bl"},n),dojo.create("td",{colSpan:"5"},n),dojo.create("td",{className:"edge_gray_br"},n)},
teasp.dialog.InputTime.prototype.changedTime=function(){var e;this.pouch.isUseDailyApply()&&this.dayWrap.isInputable(!0)&&(e=""==dojo.byId("startTime").value||""==dojo.byId("endTime").value||this.dailyFixable.pending||!this.isWorkLocationOk(),dojo.style("timeInputDayFixLabel","color",e?"#CCCCCC":"#222222"),e?dojo.byId("timeInputDayFix").checked=!1:this.pouch.isCheckDefaultDailyFix()&&(dojo.byId("timeInputDayFix"
).checked=!e),dojo.byId("timeInputDayFix").disabled=e)},teasp.dialog.InputTime.prototype.insertOutArea=function(){var t=null,a=0;dojo.query(".tt_outdoor").forEach(function(e){a++}),dojo.query(".tt_out_end").forEach(function(e){t=e}),this.createOutRow(t.parentNode,a,t.rowIndex),dojo.query(".tt_out_plus").forEach(function(e){var t=parseInt(e.rowSpan,10);e.rowSpan=""+(t+2),e.firstChild.disabled=a>=this.outMax-1,
e.firstChild.className=a>=this.outMax-1||this.isReadOnly(this.OUT_AREA)?"pb_btn_plusL_dis":"pb_btn_plusL"},this)},teasp.dialog.InputTime.prototype.insertRestArea=function(){var t=null,a=0;dojo.query(".tt_rest").forEach(function(e){a++}),dojo.query(".tt_rest_end").forEach(function(e){t=e}),this.createRestRow(t.parentNode,a,t.rowIndex),dojo.query(".tt_rest_plus").forEach(function(e){var t=parseInt(e.rowSpan,10);
e.rowSpan=""+(t+2),e.firstChild.disabled=a>=this.restMax-1,e.firstChild.className=a>=this.restMax-1||this.isReadOnly(this.REST_AREA)||this.isNoEntry()?"pb_btn_plusL_dis":"pb_btn_plusL"},this)},teasp.dialog.InputTime.prototype.createOutRow=function(e,t,a,o,s){o||(i=a<0?dojo.create("tr",null,e):dojo.create("tr",null,e.rows[a],"before"),dojo.create("td",null,i),dojo.create("td",{colSpan:"4",className:"tt_gyokan"},i),
dojo.create("td",null,i),0<=a&&a++);var i=a<0?dojo.create("tr",null,e):dojo.create("tr",null,e.rows[a],"before"),e=(dojo.create("td",null,i),dojo.create("td",null,i)),a=(e.style.verticalAlign="middle",dojo.create("div",{className:"tt_col tt_outdoor",id:"rowOut"+(t+1),innerHTML:teasp.message.getLabel("awayInput_label")+this.zenNum[t]},e),e=dojo.create("td",{style:"width:49px;",className:"input-out-time"},i),
dojo.create("input",{type:"text",className:"inputime roundBegin",id:"startOut"+(t+1)},e));this.isReadOnly(this.OUT_AREA)?(a.readOnly="readOnly",dojo.toggleClass(a,"inputro",!0)):(this.eventHandles["startOutb"+(t+1)]=dojo.connect(a,"blur",teasp.util.time.onblurTime),this.eventHandles["startOutk"+(t+1)]=dojo.connect(a,"onkeypress",teasp.util.time.onkeypressTime)),dojo.create("td",{className:"tt_span",
innerHTML:teasp.message.getLabel("wave_label")},i),e=dojo.create("td",{style:"width:49px;",className:"input-out-time"},i),a=dojo.create("input",{type:"text",className:"inputime roundEnd",id:"endOut"+(t+1)},e),this.isReadOnly(this.OUT_AREA)?(a.readOnly="readOnly",dojo.toggleClass(a,"inputro",!0)):(this.eventHandles["endOutb"+(t+1)]=dojo.connect(a,"blur",teasp.util.time.onblurTime),this.eventHandles["endOutk"+(t+1
)]=dojo.connect(a,"onkeypress",teasp.util.time.onkeypressTime)),o&&((e=dojo.create("td",{rowSpan:s,className:"tt_out_plus",style:"text-align:left;"},i)).style.verticalAlign="bottom",a=dojo.create("input",{type:"button",className:this.isReadOnly(this.OUT_AREA)?"pb_btn_plusL_dis":"pb_btn_plusL",title:teasp.message.getLabel("awayInsert_label"),style:"width:24px;height:24px;margin-left:4px;"},e),this.isReadOnly(
this.OUT_AREA)||(this.eventHandles.awayPlus=dojo.connect(a,"onclick",this,this.insertOutArea))),dojo.create("td",null,i)},teasp.dialog.InputTime.prototype.createWorkLocationRow=function(e,t){var e=dojo.create("tr",null,e),a=(dojo.create("td",null,e),dojo.create("div",{className:"tt_col tt_workLocation",innerHTML:teasp.message.getLabel("tw00000010")},dojo.create("td",{style:"vertical-align:middle;"},e)),
this.pouch.getWorkLocations()),o=this.dayWrap.getWorkLocationId();if(this.isReadOnly()){const n=o?this.pouch.getWorkLocationById(o):null;var s=n&&n.getName()||"";dojo.create("input",{type:"text",id:"workLocationId",style:"width:93%;font-size:12px;padding:1px 4px;border:1px solid #808080;color:black;",disabled:"disabled",value:s,title:s},dojo.create("td",{colSpan:5,style:"text-align:left;"},e))}else{
const r=dojo.create("select",{id:"workLocationId",style:"width:100%;"},dojo.create("td",{colSpan:5},e));dojo.create("option",{value:"",innerHTML:""},r);for(var i=0;i<a.length;i++){const p=a[i];dojo.create("option",{value:p.getId(),innerHTML:p.getName()},r),!o&&p.isInitFlag()&&(o=p.getId())}const l=o?this.pouch.getWorkLocationById(o):null;l&&l.isRemoved()&&dojo.create("option",{value:l.getId(),innerHTML:l.getName()},r
),r.value=!t&&o||"",this.eventHandles.workLocation=dojo.connect(r,"change",this,this.changeWorkLocation)}dojo.create("td",null,e)},teasp.dialog.InputTime.prototype.getSelectedWorkLocationId=function(){var e=dojo.byId("workLocationId");return e&&e.value||null},teasp.dialog.InputTime.prototype.isWorkLocationOk=function(){return!this.pouch.isRequireWorkLocation()||null!=this.getSelectedWorkLocationId()},
teasp.dialog.InputTime.prototype.resetWorkLocation=function(){const e=dojo.byId("workLocationId");e&&(e.value="")},teasp.dialog.InputTime.prototype.changeWorkLocation=function(e){var t=""==dojo.byId("startTime").value||""==dojo.byId("endTime").value||this.dailyFixable.pending||!this.isWorkLocationOk();t&&(dojo.byId("timeInputDayFix").checked=!1),dojo.byId("timeInputDayFix").disabled=t,dojo.style(
"timeInputDayFixLabel","color",t?"#CCCCCC":"#222222")},teasp.dialog.InputTime.prototype.createRestRow=function(e,t,a,o,s){o||(i=a<0?dojo.create("tr",null,e):dojo.create("tr",null,e.rows[a],"before"),dojo.create("td",null,i),dojo.create("td",{colSpan:"4",className:"tt_gyokan"},i),dojo.create("td",null,i),0<=a&&a++);var i=a<0?dojo.create("tr",null,e):dojo.create("tr",null,e.rows[a],"before"),e=(dojo.create("td",null,i)
,dojo.create("td",null,i)),a=(e.style.verticalAlign="middle",dojo.create("div",{className:"tt_col tt_rest",id:"rowRest"+(t+1),innerHTML:teasp.message.getLabel("restInput_label")+this.zenNum[t]},e),e=dojo.create("td",{style:"width:49px;",className:"input-rest-time"},i),dojo.create("input",{type:"text",className:"inputime roundBegin",id:"startRest"+(t+1)},e));this.isReadOnly(this.REST_AREA)||this.isNoEntry()?(
a.readOnly="readOnly",dojo.toggleClass(a,"inputro",!0)):(this.eventHandles["startRestb"+(t+1)]=dojo.connect(a,"blur",teasp.util.time.onblurTime),this.eventHandles["startRestk"+(t+1)]=dojo.connect(a,"onkeypress",teasp.util.time.onkeypressTime),dojo.attr(a,"fxtimes",this.dayWrap.getFixTimeNums())),dojo.create("td",{className:"tt_span",innerHTML:teasp.message.getLabel("wave_label")},i),e=dojo.create("td",{
style:"width:49px;",className:"input-rest-time"},i),a=dojo.create("input",{type:"text",className:"inputime roundEnd",id:"endRest"+(t+1)},e),this.isReadOnly(this.REST_AREA)||this.isNoEntry()?(a.readOnly="readOnly",dojo.toggleClass(a,"inputro",!0)):(this.eventHandles["endRestb"+(t+1)]=dojo.connect(a,"blur",teasp.util.time.onblurTime),this.eventHandles["endRestk"+(t+1)]=dojo.connect(a,"onkeypress",
teasp.util.time.onkeypressTime),dojo.attr(a,"fxtimes",this.dayWrap.getFixTimeNums())),o&&((e=dojo.create("td",{rowSpan:s,className:"tt_rest_plus",style:"text-align:left;"},i)).style.verticalAlign="bottom",a=dojo.create("input",{type:"button",className:this.isReadOnly(this.REST_AREA)||this.isNoEntry()?"pb_btn_plusL_dis":"pb_btn_plusL",title:teasp.message.getLabel("restInsert_label"),
style:"width:24px;height:24px;margin-left:4px;"},e),this.isReadOnly(this.REST_AREA)||this.isNoEntry()||(this.eventHandles.restPlus=dojo.connect(a,"onclick",this,this.insertRestArea))),dojo.create("td",null,i)},teasp.dialog.InputTime.prototype.reset=function(){var e,t,s=[],i=[];if(this.pattern)for(var a=0;a<this.pattern.restTimes.length;a++){var o=this.pattern.restTimes[a];i.push(o)}i=i.sort(function(e,t){return(
"number"==typeof e.from?e.from:e.to)-("number"==typeof t.from?t.from:t.to)}),this.dayWrap.isConflictTimeHoliay(this.dayWrap.getTimeTable(),i)?teasp.tsAlert(teasp.message.getLabel("tm10003040","",teasp.data.EmpApply.getDisplayApplyType(teasp.constant.APPLY_TYPE_HOLIDAY)),this):(e=this.checkInput(),t=this.tc&&this.checkReason(),e||t?teasp.tsConfirmA(teasp.message.getLabel("tm10002110"),this,function(){var e=dojo.byId(
"startTime").value,t=dojo.byId("endTime").value,a=(this.createInputArea(i.length,s.length,!0),this.dayWrap.getInputLimit().flag);1&a&&(dojo.byId("startTime").value=e),2&a&&(dojo.byId("endTime").value=t),this.tc||(dojo.byId("pushStartTime").innerHTML=this.dayWrap.getStartTimeEmboss(),dojo.byId("pushEndTime").innerHTML=this.dayWrap.getEndTimeEmboss());for(var o=0;o<i.length;o++)dojo.byId("startRest"+(o+1)
).value=this.pouch.getDisplayTime(i[o].from),dojo.byId("endRest"+(o+1)).value=this.pouch.getDisplayTime(i[o].to);this.changedTime(),this.resetDivergence(),this.resetWorkLocation()}):this.resetWorkLocation())},teasp.dialog.InputTime.prototype.checkInput=function(){var e;if(""!=dojo.byId("startTime").value||""!=dojo.byId("endTime").value)return!0;if(0<this.getAways().length)return!0;var t=this.getRests(),
a=this.getFixRests();if(t.length!=a.length)return!0;for(e=0;e<t.length;e++){var o=t[e],s=a[e];if(o.from!=s.from||o.to!=s.to||o.type!=s.type)return!0}return!1},teasp.dialog.InputTime.prototype.getFixRests=function(){var e=[];if(this.pattern)for(var t=0;t<this.pattern.restTimes.length;t++){var a=this.pattern.restTimes[t];e.push(a)}return e=0<e.length?e.sort(function(e,t){return("number"==typeof e.from?e.from:e.to)-(
"number"==typeof t.from?t.from:t.to)}):e},teasp.dialog.InputTime.prototype.isReadOnly=function(e){if(this.pouch.isEmpMonthReadOnly()||this.dayWrap.isDailyFix())return!0;if(!this.pouch.isUseReviseTimeApply()&&this.pouch.isUpdater())return!1;if(e==this.IO_AREA||e==this.REST_AREA)return!0;var t="number"!=typeof this.dayWrap.getObj().startTime&&"number"!=typeof this.dayWrap.getObj().endTime;if(e==this.OUT_AREA)return t;
e=!t&&0<this.dayWrap.getAwayTimes().length;return(t||!e&&this.pouch.isHideAwayTimeInputField())&&!this.pouch.isUseWorkLocation()&&!this.pouch.isInputAccessControl(!0)},teasp.dialog.InputTime.prototype.isNoEntry=function(e){return this.isReadOnly(this.IO_AREA)||!e&&3==this.dayWrap.getInputLimit().flag},teasp.dialog.InputTime.prototype.showError=function(e,t){this.tc&&this.tc.selectChild(this.tc.getChildren()[0]),
dojo.style("dlgInpTimeErrorRow","display",e?"":"none"),dojo.byId("dlgInpTimeError").innerHTML=e?t?e:e.entitize():""},teasp.dialog.InputTime.prototype.isFixRest=function(e){if(this.pattern)for(var t=0;t<this.pattern.restTimes.length;t++){var a=this.pattern.restTimes[t];if(a.from==e.from&&a.to==e.to)return!0}return!1},teasp.dialog.InputTime.prototype.getRests=function(e){var t,a,o=[];return dojo.query(".tt_rest"
).forEach(function(e){e=/rowRest(\d+)/.exec(e.id);e&&(a=e[1],t=teasp.util.time.clock2minutes(dojo.byId("startRest"+a).value),a=teasp.util.time.clock2minutes(dojo.byId("endRest"+a).value),null==t&&null==a||((t={from:null!=t?t:null,to:null!=a?a:null}).type=this.isFixRest(t)?21:22,o.push(t)))},this),o=(o=e?o.concat(this.dayWrap.getHourRests()):o).sort(function(e,t){return("number"==typeof e.from?e.from:e.to)-(
"number"==typeof t.from?t.from:t.to)})},teasp.dialog.InputTime.prototype.getAways=function(){var t,a,o=[];return dojo.query(".tt_outdoor").forEach(function(e){e=/rowOut(\d+)/.exec(e.id);e&&(a=e[1],t=teasp.util.time.clock2minutes(dojo.byId("startOut"+a).value),a=teasp.util.time.clock2minutes(dojo.byId("endOut"+a).value),null==t&&null==a||o.push({from:null!=t?t:null,to:null!=a?a:null,type:30}))},this),o=o.sort(
function(e,t){return("number"==typeof e.from?e.from:e.to)-("number"==typeof t.from?t.from:t.to)})},teasp.dialog.InputTime.prototype.changedReason=function(a){return function(e){var t,e=e.target.value;e&&((t=dojo.query(".diverge-table"+a+" textarea",dojo.byId(this.dialog.id))[0]).value=t.value+e,t.value.length>teasp.constant.DIVERGE_REASON_MAX&&(t.value=t.value.substring(0,teasp.constant.DIVERGE_REASON_MAX)))}},
teasp.dialog.InputTime.prototype.openAccessLog=function(e){teasp.manager.dialogOpen("AccessControlLog",{date:this.args.date},this.pouch,this,null)},teasp.dialog.InputTime.prototype.getEnterDivergenceReason=function(){var e;return this.tc?(e=dojo.byId(this.dialog.id),dojo.query(".diverge-table1 textarea",e)[0].value):this.dayWrap.getEnterDivergenceReason()},
teasp.dialog.InputTime.prototype.getExitDivergenceReason=function(){var e;return this.tc?(e=dojo.byId(this.dialog.id),dojo.query(".diverge-table2 textarea",e)[0].value):this.dayWrap.getExitDivergenceReason()},teasp.dialog.InputTime.prototype.focusReasonTextArea=function(e){var t;this.tc&&(t=dojo.query(".diverge-table"+e+" textarea",dojo.byId(this.dialog.id)))&&t.length&&(t=t[0],setTimeout(function(){t.focus()},100))}
,teasp.dialog.InputTime.prototype.checkReason=function(){var e=dojo.byId(this.dialog.id);return dojo.query(".diverge-table1 select",e)[0].value||dojo.query(".diverge-table2 select",e)[0].value||this.getEnterDivergenceReason()||this.getExitDivergenceReason()},teasp.dialog.InputTime.prototype.resetDivergence=function(){this.tc&&(this.setDivergenceInfo(!0),this.setDivergeLeftSide(dojo.byId(this.dialog.id),!0))},
teasp.dialog.InputTime.prototype.changedPane=function(e){return dojo.hitch(this,function(){dojo.style("dlgInpTimeReset","display",this.isNoEntry(!0)||e?"none":"")})},teasp.provide("teasp.dialog.Note"),teasp.dialog.Note=function(){this.widthHint=410,this.heightHint=225,this.id="dialogNote",this.title=teasp.message.getLabel("note_caption"),this.duration=1,
this.content='<table class="pane_table" id="dialogNoteArea" style="width:390px;"><tr><td style="padding-bottom:4px;"><table border="0" cellpadding="0" cellspacing="0"><tr><td style="padding-left:4px;white-space:nowrap;"><span id="dialogNoteDate"></span></td><td style="padding-left:4px;"><span id="dialogNoteEvent" style="word-break:break-all;"></span></td></tr></table></td></tr><tr><td style="vertical-align:top;text-align:left;font-size:0.85em;padding:1px 4px;" id="dialogNoteRevise"></td></tr><tr><td style="vertical-align:top;text-align:center;"><textarea id="dialogNoteText1" disabled=true style="width:97%;height:60px;margin-bottom:6px;background-color:#EBEBE4;" class="inputarea"></textarea></td></tr><tr><td style="vertical-align:top;text-align:center;"><textarea id="dialogNoteText2" style="width:97%;height:80px;" class="inputarea" maxLength="255"></textarea></td></tr><tr id="dialogNoteCtrl1" class="ts-buttons-row"><td style="text-align:center;padding-top:10px;"><div><button class="std-button1" id="dialogNoteOk" ><div></div></button><button class="std-button2" id="dialogNoteCancel" ><div></div></button></div></td></tr><tr id="dialogNoteCtrl2" class="ts-buttons-row"><td style="text-align:center;padding-top:10px;"><div><button class="std-button2" id="dialogNoteClose" ><div></div></button></div></td></tr></table>'
,this.okLink={id:"dialogNoteOk",callback:this.ok},this.cancelLink={id:"dialogNoteCancel",callback:this.hide},this.closeLink={id:"dialogNoteClose",callback:this.hide},this.eventHandles=[]},teasp.dialog.Note.prototype=new teasp.dialog.Base,teasp.dialog.Note.prototype.ready=function(){this.dayWrap=this.pouch.getEmpDay(this.args.date)},teasp.dialog.Note.prototype.preShow=function(){for(
var e=0;e<this.eventHandles.length;e++)dojo.disconnect(this.eventHandles[e]),delete this.eventHandles[e];this.eventHandles=[],dojo.style("dialogNoteCtrl1","display",this.isReadOnly()?"none":""),dojo.style("dialogNoteCtrl2","display",this.isReadOnly()?"":"none"),dojo.byId("dialogNoteDate").innerHTML=teasp.util.date.formatDate(this.args.date,"JP1"),dojo.byId("dialogNoteEvent").innerHTML=this.dayWrap.getCalendarEvent(),
dojo.byId("dialogNoteText2").value=this.dayWrap.getDayNote(!0);var t=this.dayWrap.getTimeCaution();return dojo.byId("dialogNoteRevise").innerHTML=t,dojo.style("dialogNoteRevise","background-color",0<t.length?"#FFFFD6":"#FFFFFF"),this.dayWrap.getApplyNotes()&&this.pouch.isSeparateDailyNote()?(dojo.byId("dialogNoteText1").value=this.dayWrap.getApplyNotes(),dojo.style("dialogNoteText1","display","")):dojo.style(
"dialogNoteText1","display","none"),dojo.byId("dialogNoteOk").firstChild.innerHTML=teasp.message.getLabel("save_btn_title"),dojo.byId("dialogNoteCancel").firstChild.innerHTML=teasp.message.getLabel("cancel_btn_title"),dojo.byId("dialogNoteClose").firstChild.innerHTML=teasp.message.getLabel("close_btn_title"),dojo.byId("dialogNoteText2").readOnly=this.isReadOnly()?"readOnly":"",dojo.toggleClass(dojo.byId(
"dialogNoteText2"),"inputab",!this.isReadOnly()),dojo.toggleClass(dojo.byId("dialogNoteText2"),"inputro",this.isReadOnly()),teasp.isNarrow()&&(dojo.style("dialogNoteArea","width","100%"),dojo.query("textarea",dojo.byId("dialogNoteArea")).forEach(function(e){dojo.style(e,"height","120px")})),!0},teasp.dialog.Note.prototype.ok=function(){teasp.manager.request("saveEmpNoteByDay",{empId:this.pouch.getEmpId(),
month:this.pouch.getYearMonth(),startDate:this.pouch.getStartDate(),lastModifiedDate:this.pouch.getLastModifiedDate(),date:this.args.date,note:dojo.byId("dialogNoteText2").value.trim()},this.pouch,{},this,function(){this.onfinishfunc(),this.close()},function(e){teasp.message.alertError(e)})},teasp.dialog.Note.prototype.isReadOnly=function(){return this.pouch.isEmpMonthReadOnly()||this.dayWrap.isDailyFix()},
teasp.provide("teasp.dialog.ShiftSetting"),teasp.dialog.ShiftSetting=function(){this.widthHint=410,this.heightHint=225,this.id="dialogShiftSetting",this.title="シフト設定",this.duration=1,
this.content='<div class="dlg_content" style="width:540px;"><table class="ts_a_frame"><tr><td class="edgelt"></td><td class="edgeht"></td><td class="edgert"></td></tr><tr><td class="edgevl"></td><td style="background-color:#F3F7FA;"><table class="pane_table" width="510px" style="margin:2px auto;"><tbody><tr><td class="left_s">対象社員・日付</td><td class="right"></td></tr><tr><td colSpan=2><table class="atk_r_table" style="margin-top:4px;"><tbody><tr><td class="head" width="220px"><div>所属部署</div></td><td class="head" width="110px"><div>社員名</div></td><td class="head" width="180px"><div>日付</div></td></tr></tbody></table></td></tr><tr height="1px"><td colSpan=2></td></tr><tr><td colSpan=2><div id="shiftSettingTargetDiv" class="atk_r_record_area" width="500px" style="height:102px;overflow-y:scroll;background-color:white;"><table class="atk_r_record_table"><tbody id="shiftSettingTbody"><tr><td></td></tr></tbody></table></div></td></tr></tbody></table></td><td class="edgevr"></td></tr><tr><td class="edgevl"></td><td><div class="edge_div"><table class="stand_table"><tr class="shift_day_type"><td class="left_s">種別</td><td class="right"><div style="margin:0px;"><select id="shiftSettingDayType"><option value="0">勤務日</option><option value="1">非勤務日</option></select></div><div id="shiftSettingDayTypeOption" style="display:none;margin:1px 0px 0px 12px;"><label style="margin-right:8px;"><input type="radio" name="shiftSettingDayTypeOption" style="margin:2px;" id="shiftSettingDayTypeRegularHoliday"><span>所定休日</span></label><label style="margin-right:8px;"><input type="radio" name="shiftSettingDayTypeOption" style="margin:2px;" id="shiftSettingDayTypeLegalHoliday"><span>法定休日</span></label></div></td></tr><tr class="shift_normal_day"><td class="left_s">勤務パターン</td><td class="right"><div><select id="shiftSettingPatterns" style="width:300px;max-width:320px;"></select></div><div id="shiftSettingPatternIcon" style="margin-left:4px;"></div></td></tr><tr class="shift_normal_day"><td class="left_s">始業終業時刻</td><td class="right"><input type="text" class="inputime inputran" value="" id="shiftSettingSt" />&nbsp;～&nbsp;<input type="text" class="inputime inputran" value="" id="shiftSettingEt" /></td></tr></table></div></td><td class="edgevr"></td></tr><tr><td class="edgelb"></td><td class="edgehb"></td><td class="edgerb"></td></tr></table><table border="0" cellpadding="0" cellspacing="0" style="width:100%;"><tr><td id="shiftSettingErrorRow" style="text-align:center;"></td></tr><tr><td style="padding:16px 0px 4px 0px;text-align:center;"><input type="button" class="normalbtn" value="登録" id="shiftSettingOk" />&nbsp;&nbsp;&nbsp;&nbsp;<input type="button" class="cancelbtn" value="キャンセル" id="shiftSettingCancel" /></td></tr></table></div>'
,this.okLink={id:"shiftSettingOk",callback:this.ok},this.cancelLink={id:"shiftSettingCancel",callback:this.hide},this.defaultVals=null},teasp.dialog.ShiftSetting.prototype=new teasp.dialog.Base,teasp.dialog.ShiftSetting.prototype.ready=function(){this.defaultVals=this.getDefaultValues(this.args.target,this.args.importResultFlag)},teasp.dialog.ShiftSetting.prototype.preStart=function(){dojo.connect(dojo.byId(
"shiftSettingDayType"),"onchange",this,this.changedDayType),dojo.connect(dojo.byId("shiftSettingPatterns"),"onchange",this,this.changedPattern),dojo.query(".inputime").forEach(function(e){dojo.connect(e,"blur",this,teasp.util.time.onblurTime),dojo.connect(e,"onkeypress",this,teasp.util.time.onkeypressTime)},this)},teasp.dialog.ShiftSetting.prototype.preShow=function(){teasp.util.showErrorArea(null,
"shiftSettingErrorRow"),dojo.byId("shiftSettingDayType").value="2"==this.defaultVals.dayTypeSel?"1":this.defaultVals.dayTypeSel,dojo.byId("shiftSettingDayTypeRegularHoliday").checked="2"!=this.defaultVals.dayTypeSel,dojo.byId("shiftSettingDayTypeLegalHoliday").checked="2"==this.defaultVals.dayTypeSel;var e,t,a,o,s,i,n=this.pouch.emps,r=[];for(t in this.args.target)if(e=e||t,this.args.target.hasOwnProperty(t))for(
var l=0;l<n.length;l++)if(n[l].Id==t){r.push(n[l]);break}e&&((a=this.args.target[e].dateList).sort(function(e,t){return t<e?1:-1}),o=60*(new Date).getTimezoneOffset()*1e3*-1,s=teasp.util.date.parseDate(a[0]).getTime(),i=teasp.util.date.parseDate(a[a.length-1]).getTime(),s+=o,i+=o);for(var p=[],d={},l=0;l<r.length;l++)for(var c=r[l].empType.patterns||[],m=0;m<c.length;m++){var h,u=c[m].pattern,g=!0;s&&i&&(
g=u.ValidFrom__c<=s&&s<u.ValidTo__c),u&&u.Id&&(!(h=d[u.Id]||0)&&g&&p.push(u),d[u.Id]=h+1)}this.filterPattern(p,d,r.length),select=dojo.byId("shiftSettingPatterns"),dojo.empty(select),dojo.create("option",{innerHTML:"（通常勤務）",value:"-"},select);for(var y=1==this.defaultVals.patternIdList.length?this.defaultVals.patternIdList[0]:null,l=0;l<p.length;l++)(u=p[l])&&(!u.Removed__c||y&&y==u.Id)&&dojo.create("option",{
innerHTML:u.Name,value:u.Id},select);select.value=y||"*",""===select.value&&(select.value="-"),dojo.byId("shiftSettingSt").readOnly="readOnly",dojo.byId("shiftSettingEt").readOnly="readOnly";var f=this.pouch.empIdIndex,r=r.sort(function(e,t){return f[e.Id]-f[t.Id]}),b=dojo.byId("shiftSettingTbody");dojo.empty(b);for(l=0;l<r.length;l++){var _=r[l],v=dojo.create("tr",{className:l%2==0?"even":"odd"},b);dojo.create("div"
,{innerHTML:_.DeptId__r?_.DeptId__r.DeptCode__c+"-"+_.DeptId__r.Name:"",style:"margin:2px 4px;word-break:break-all;"},dojo.create("td",{style:{height:"20px",width:"220px",fontSize:"12px"}},v)),dojo.create("div",{innerHTML:_.Name,style:"margin:2px 4px;word-break:break-all;"},dojo.create("td",{style:{height:"20px",width:"110px",fontSize:"12px"}},v)),dojo.create("div",{innerHTML:teasp.dialog.ShiftSetting.getDisplayDays(
this.args.target[_.Id].dateList),style:{margin:"2px 4px"}},dojo.create("td",{style:{height:"20px",width:"164px",fontSize:"12px"}},v))}for(;l<5;){v=dojo.create("tr",{className:l%2==0?"even":"odd"},b);dojo.create("div",null,dojo.create("td",{style:{height:"20px",width:"220px"}},v)),dojo.create("div",null,dojo.create("td",{style:{height:"20px",width:"110px"}},v)),dojo.create("div",null,dojo.create("td",{style:{
height:"20px",width:"164px"}},v)),l++}return this.changedDayType(),this.changedPattern(),!0},teasp.dialog.ShiftSetting.prototype.filterPattern=function(e,t,a){if(a)for(var o=e.length-1;0<=o;o--)t[(s=e[o]).Id]<a&&e.splice(o,1);else{for(var s,i=this.pouch.allPatterns,n={},o=0;o<i.length;o++)n[(s=i[o]).Id]=s;for(var r=this.defaultVals.patternIdList||[],o=0;o<r.length;o++){var l=r[o];!t[l]&&n[l]&&e.push(n[l])}}},
teasp.dialog.ShiftSetting.prototype.changedPattern=function(){for(var e=dojo.byId("shiftSettingPatterns").value,t=this.pouch.allPatterns,a=null,o=0;o<t.length;o++)if(t[o].Id==e){a=t[o];break}for(var s,i=dojo.byId("shiftSettingPatternIcon");i.firstChild;)dojo.destroy(i.firstChild);"-"!=e&&"*"!=e?a?(s=a.Symbol__c||a.Name.substring(0,1),dojo.create("div",{className:"pattern dayDiv",style:{marginLeft:"auto",
marginRight:"auto"},innerHTML:s},i),dojo.byId("shiftSettingSt").value=teasp.util.time.timeValue(a.StdStartTime__c),dojo.byId("shiftSettingEt").value=teasp.util.time.timeValue(a.StdEndTime__c)):(dojo.byId("shiftSettingSt").value="",dojo.byId("shiftSettingEt").value=""):1==(s="-"==e?this.defaultVals.normalSEList:this.defaultVals.currentSEList).length?(s=s[0],dojo.byId("shiftSettingSt").value=teasp.util.time.timeValue(
s.st),dojo.byId("shiftSettingEt").value=teasp.util.time.timeValue(s.et)):(dojo.byId("shiftSettingSt").value="",dojo.byId("shiftSettingEt").value="")},teasp.dialog.ShiftSetting.prototype.changedDayType=function(){var t=dojo.byId("shiftSettingDayType").value;dojo.query(".shift_normal_day").forEach(function(e){dojo.style(e,"display","0"==t?"":"none")}),dojo.style("shiftSettingDayTypeOption","display","1"==t?"":"none"),
dojo.query(".shift_both_daytype").forEach(function(e){dojo.style(e,"display","0"==t||"1"==t?"":"none")})},teasp.dialog.ShiftSetting.prototype.getDefaultValues=function(e,t){var a,o=this.pouch.emps,s=null,i={},n={},r=[],l="",p={},d=[],c={},m=[];for(a in e)if(e.hasOwnProperty(a)){for(var h=e[a].dateList,u=null,g=0;g<o.length;g++)o[g].Id==a&&(u=o[g]);if(u&&h&&h.length)for(g=0;g<h.length;g++){var y=h[g],f=u.days[y],y=(
i[(b=f.pattern)?b.Id:"-"]=1,u.empType.days[y].config),b=b||y;c[teasp.util.time.timeValue(y.StdStartTime__c)+"-"+teasp.util.time.timeValue(y.StdEndTime__c)]={st:y.StdStartTime__c,et:y.StdEndTime__c},f.dayType==teasp.constant.DAY_TYPE_NORMAL_HOLIDAY||f.dayType==teasp.constant.DAY_TYPE_PUBLIC_HOLIDAY?n[1]=1:f.dayType==teasp.constant.DAY_TYPE_LEGAL_HOLIDAY?n[2]=1:(n[0]=1,p[teasp.util.time.timeValue(b.StdStartTime__c
)+"-"+teasp.util.time.timeValue(b.StdEndTime__c)]={st:b.StdStartTime__c,et:b.StdEndTime__c})}}for(s in i)i.hasOwnProperty(s)&&r.push(s);for(s in l=!n[0]||n[1]||n[2]?n[0]||!n[1]&&!n[2]?"*":n[1]?"1":"2":"0",p)p.hasOwnProperty(s)&&d.push(p[s]);for(s in c)c.hasOwnProperty(s)&&m.push(c[s]);return{dayTypeSel:l,patternIdList:r,currentSEList:d,normalSEList:m}},teasp.dialog.ShiftSetting.getDisplayDays=function(e){if(!e
)return"";e=e.sort(function(e,t){return e<t?-1:t<e?1:0});for(var t=[],a=null,o=0;o<e.length;o++){var s=teasp.util.date.parseDate(e[o]);!a||2<teasp.util.date.daysInRange(a,s)?t.push({sd:s}):t[t.length-1].ed=s,a=s}a=null;for(var i=[],o=0;o<t.length;o++)var n,r,l,a=t[o].ed?(l=t[o].sd,n=t[o].ed,r=(a&&a.getMonth()==l.getMonth()?l.getDate():l.getMonth()+1+"/"+l.getDate())+"～"+(l.getMonth()!=n.getMonth()?n.getMonth(
)+1+"/"+n.getDate():n.getDate()),console.log(r),i.push(r),n):(l=t[o].sd,i.push(a&&a.getMonth()==l.getMonth()?""+l.getDate():l.getMonth()+1+"/"+l.getDate()),l);return i.join(", ")},teasp.dialog.ShiftSetting.prototype.getDeptIdByEmpId=function(e){for(var t=this.pouch.emps,a=0;a<t.length;a++){var o=t[a];if(o.Id==e)return o.DeptId__c}return null},teasp.dialog.ShiftSetting.prototype.ok=function(){var e=dojo.byId(
"shiftSettingPatterns").value,t="*"==dojo.byId("shiftSettingDayType").value?null:dojo.byId("shiftSettingDayType").value;"1"==t&&dojo.byId("shiftSettingDayTypeLegalHoliday").checked&&(t="2");var a,o="number"==typeof(o=teasp.util.time.clock2minutes(dojo.byId("shiftSettingSt").value))?o:null,o="number"==typeof(o=teasp.util.time.clock2minutes(dojo.byId("shiftSettingEt").value))?o:null,s=this.args.target;for(a in s)if(
s.hasOwnProperty(a)){for(var i={},n=0;n<s[a].dateList.length;n++)i[s[a].dateList[n]]={dayType:t,deptId:this.getDeptIdByEmpId(a),patternId:"1"==t||"2"==t?null:e,startTime:null,endTime:null};s[a]=i}this.onfinishfunc({target:s},"shiftSettingErrorRow",function(e){this.hide()},this)},teasp.provide("teasp.dialog.ShiftOutput"),teasp.dialog.ShiftOutput=function(){this.widthHint=410,this.heightHint=225,
this.id="dialogShiftOutput",this.title="CSV出力",this.duration=1,
this.content='<div class="dlg_content" style="width:340px;"><div style="width:100%;"><div id="shiftOutputTitle" class="inputarea" style="margin-bottom:8px;">出力形式を選択してください</div></div><table class="ts_a_frame"><tr><td class="edgelt"></td><td class="edgeht"></td><td class="edgert"></td></tr><tr><td class="edgevl"></td><td><div class="edge_div"><div style="margin:4px 8px 2px 8px;"><label><input type="radio" name="shiftOutputOption" id="shiftOutputOption1" />社員・日付のマトリックス形式</label></div></div><div class="edge_div"><div style="margin:2px 8px 4px 8px;"><label><input type="radio" name="shiftOutputOption" id="shiftOutputOption2" />社員・日付毎のリスト形式</label></div></div></td><td class="edgevr"></td></tr><tr><td class="edgelb"></td><td class="edgehb"></td><td class="edgerb"></td></tr></table><div style="padding: 8px 0px 0px 18px;"><label><input type="checkbox" id="shiftOutputTimeIn" />&nbsp;始業・終業時刻を出力する</label></div><div style="padding: 8px 0px 0px 18px;"><label><input type="checkbox" id="shiftOutputPattern" />&nbsp;勤務パターン名をフルネームで出力する</label></div><div style="padding: 8px 0px 0px 18px;"><label><input type="checkbox" id="shiftOutputHoliday" />&nbsp;休暇名をフルネームで出力する</label></div><table border="0" cellpadding="0" cellspacing="0" style="width:100%;"><tr><td id="shiftOutputErrorRow" style="text-align:center;"></td></tr><tr><td style="padding:16px 0px 4px 0px;text-align:center;"><input type="button" class="normalbtn" value="OK" id="shiftOutputOk" />&nbsp;&nbsp;&nbsp;&nbsp;<input type="button" class="cancelbtn" value="キャンセル" id="shiftOutputCancel" /></td></tr></table></div>'
,this.okLink={id:"shiftOutputOk",callback:this.ok},this.cancelLink={id:"shiftOutputCancel",callback:this.hide}},teasp.dialog.ShiftOutput.prototype=new teasp.dialog.Base,teasp.dialog.ShiftOutput.prototype.preShow=function(){return dojo.byId("shiftOutputOption1").checked=!0},teasp.dialog.ShiftOutput.prototype.ok=function(){this.onfinishfunc({type:dojo.byId("shiftOutputOption1").checked?0:1,timeIn:dojo.byId(
"shiftOutputTimeIn").checked,patternFull:dojo.byId("shiftOutputPattern").checked,holidayFull:dojo.byId("shiftOutputHoliday").checked},"shiftOutputErrorRow",function(e){this.hide()},this)},teasp.provide("teasp.dialog.ShiftEvent"),teasp.dialog.ShiftEvent=function(){this.widthHint=410,this.heightHint=225,this.id="dialogShiftEvent",this.title="イベントの設定",this.duration=1,
this.content='<div class="dlg_content" style="width:490px;"><div style="width:100%;"><div id="shiftEventTitle" class="inputarea" style="margin-bottom:8px;"></div></div><table class="ts_a_frame"><tr><td class="edgelt"></td><td class="edgeht"></td><td class="edgert"></td></tr><tr><td class="edgevl"></td><td><div class="edge_div"><table class="stand_table"><tr><td class="left_sx">共通のイベント</td><td class="right"><input type="text" id="shiftEventCommon" class="inputran" maxLength="255" style="padding:2px;width:300px;font-size:12px;" /></td></tr><tr class="dept_row"><td class="left_sx"><div id="shiftEventDeptColumn" style="word-break:break-all;">イベント</div></td><td class="right"><input type="text" id="shiftEventDept" class="inputran" maxLength="255" style="padding:2px;width:300px;font-size:12px;" /></td></tr><tr class="dept_row"><td class="left_sx">備考</td><td class="right"><textarea id="shiftEventNote" class="inputran" maxLength="255" style="padding:2px;width:300px;height:32px;"></textarea></td></tr></table></div></td><td class="edgevr"></td></tr><tr><td class="edgelb"></td><td class="edgehb"></td><td class="edgerb"></td></tr></table><table border="0" cellpadding="0" cellspacing="0" style="width:100%;"><tr><td id="shiftEventErrorRow" style="text-align:center;"></td></tr><tr><td style="padding:16px 0px 4px 0px;text-align:center;"><input type="button" class="normalbtn" value="登録" id="shiftEventOk" />&nbsp;&nbsp;&nbsp;&nbsp;<input type="button" class="cancelbtn" value="キャンセル" id="shiftEventCancel" /></td></tr></table></div>'
,this.okLink={id:"shiftEventOk",callback:this.ok},this.cancelLink={id:"shiftEventCancel",callback:this.hide}},teasp.dialog.ShiftEvent.prototype=new teasp.dialog.Base,teasp.dialog.ShiftEvent.prototype.preShow=function(){teasp.util.showErrorArea(null,"shiftEventErrorRow");for(var t=this.pouch.param.deptName,e=(dojo.byId("shiftEventDeptColumn").innerHTML=t?t+" のイベント":"",dojo.query(".dept_row").forEach(function(e){
dojo.style(e,"display",t?"":"none")}),[]),a=[],o=[],s=[],i=0;i<this.args.dateList.length;i++){var n=this.args.dateList[i];e.contains(n.pubEvent)||e.push(n.pubEvent),a.contains(n.commonEvent)||a.push(n.commonEvent),o.contains(n.deptEvent)||o.push(n.deptEvent),s.contains(n.deptNote)||s.push(n.deptNote)}var r=teasp.util.date.formatDate(this.args.dateList[0].dkey,"JP1"),l=teasp.util.date.formatDate(
this.args.dateList[this.args.dateList.length-1].dkey,"JP1");return dojo.byId("shiftEventTitle").innerHTML=r!=l?r+" ～ "+l:r+(0<e.length?" "+(e[0]||""):""),dojo.byId("shiftEventCommon").value=1==a.length&&a[0]||"",dojo.byId("shiftEventDept").value=1==o.length&&o[0]||"",dojo.byId("shiftEventNote").value=1==s.length&&s[0]||"",!0},teasp.dialog.ShiftEvent.prototype.ok=function(){for(var e=[],
t=0;t<this.args.dateList.length;t++)e.push(this.args.dateList[t].dkey);var a=this.pouch.param.deptId;this.onfinishfunc({dkeys:e,deptId:a&&"-1"!=a?a:null,commonEvent:dojo.byId("shiftEventCommon").value,deptEvent:dojo.byId("shiftEventDept").value,deptNote:dojo.byId("shiftEventNote").value},"shiftEventErrorRow",function(e){this.hide()},this)},teasp.provide("teasp.dialog.ShiftCsvImport"),
teasp.dialog.ShiftCsvImport=function(){this.DISP_INIT=0,this.DISP_ING=1,this.DISP_END=2,this.DISP_ERROR_RETRY=3,this.DISP_ERROR_END=4,this.ERROR_PH="エラー: ${0}",this.ERROR_STOP="インポートを中止しました。<br/>アップロードしたファイルにエラーがあります。<br/>エラーの詳細は下記リンクからダウンロードしてご覧ください。",this.id="shiftCsvImportDialog",this.contents=null,this.downloadHandle=null,dojo.byId(this.id+"_title").innerHTML="CSVインポート",dojo.attr("shiftImportStart","disabled",!0)
,dojo.connect(dojo.byId("shiftImportStart"),"click",this,this.importStart),dojo.connect(dojo.byId("shiftImportCancel"),"click",this,this.hide),dojo.connect(dojo.byId("shiftImportClose"),"click",this,this.hide),dojo.connect(dojo.byId("shiftImportResult"),"click",this,this.showImportResult),dojo.connect(dojo.byId("shiftImportChangeRange"),"click",this,this.changedRangeType),dojo.connect(dojo.byId("shiftCsvUpload"),
"change",this,this.upload),dojo.connect(dijit.byId("impYear"),"onChange",this,this.changeYearMonth),dojo.connect(dijit.byId("impMonth"),"onChange",this,this.changeYearMonth),dojo.connect(dijit.byId("impStartYear"),"onChange",this,this.changeRange),dojo.connect(dijit.byId("impStartMonth"),"onChange",this,this.changeRange),dojo.connect(dijit.byId("impStartDate"),"onChange",this,this.changeRange),dojo.connect(
dijit.byId("impEndYear"),"onChange",this,this.changeRange),dojo.connect(dijit.byId("impEndMonth"),"onChange",this,this.changeRange),dojo.connect(dijit.byId("impEndDate"),"onChange",this,this.changeRange),new dijit.Tooltip({connectId:"shiftFileHelp",position:["below"],
label:'<div class="shift-file-help"><div>下記の条件を満たすファイルを指定してください。</div><div>* 文字コード = UTF-8</div><div>* 日付が指定月度（または期間）の範囲内である。</div><div>* 対象社員数が200人以内である。</div></div>'})},teasp.dialog.ShiftCsvImport.prototype.open=function(e,t,a){this.emp=e,this.callback=a,this.showError(),this.displayByStatus(this.DISP_INIT),this.contents=null;var e=new Date,a=t._month,o=a?Math.floor(a/100):e.getFullYear(),a=a?a%100:e.getMonth()+1,
e=null,s=null,i=this.convertYearMonth2Range(100*o+a),e=t.startDate||i?moment(t.startDate||i.startDate,"YYYY-MM-DD"):moment([o,a-1,1]),s=t.endDate||i?moment(t.endDate||i.endDate,"YYYY-MM-DD"):moment([o,a-1,1]).add(1,"M").add(-1,"d");dijit.byId("impYear").setValue(o),dijit.byId("impMonth").setValue(a),dijit.byId("impStartYear").setValue(e.year()),dijit.byId("impStartMonth").setValue(e.month()+1),dijit.byId(
"impStartDate").setValue(e.date()),dijit.byId("impEndYear").setValue(s.year()),dijit.byId("impEndMonth").setValue(s.month()+1),dijit.byId("impEndDate").setValue(s.date()),this.displayRangeOfYearMonth(i),this.displayRangeType(t.rangeType),dijit.byId(this.id).show()},teasp.dialog.ShiftCsvImport.prototype.hide=function(){dijit.byId(this.id).hide()},teasp.dialog.ShiftCsvImport.prototype.showError=function(e){dojo.byId(
"shiftImportError").innerHTML=e||""},teasp.dialog.ShiftCsvImport.prototype.convertYearMonth2Range=function(e){return this.emp?teasp.util.searchYearMonthDate(this.emp.EmpTypeId__r.ConfigBaseId__r.InitialDateOfMonth__c,this.emp.EmpTypeId__r.ConfigBaseId__r.MarkOfMonth__c,e):null},teasp.dialog.ShiftCsvImport.prototype.displayRangeOfYearMonth=function(e){dojo.byId("impYearMonth").innerHTML=e?dojo.string.substitute(
"（${0} ～ ${1}）",[moment(e.startDate,"YYYY-MM-DD").format("YYYY/MM/DD"),moment(e.endDate,"YYYY-MM-DD").format("YYYY/MM/DD")]):""},teasp.dialog.ShiftCsvImport.prototype.displayRangeType=function(e){dojo.style("shiftImportRange1","display",0==e?"":"none"),dojo.style("shiftImportRange2","display",0==e?"none":""),dojo.byId("shiftImportChangeRange").value=0==e?"期間で指定する":"月度で指定する"},
teasp.dialog.ShiftCsvImport.prototype.getRangeType=function(){return"none"!=dojo.style("shiftImportRange1","display")?0:1},teasp.dialog.ShiftCsvImport.prototype.getRangeValue=function(){var e={rangeType:this.getRangeType()};if(e.rangeType){if(!(dijit.byId("impStartYear").isValid()&&dijit.byId("impStartMonth").isValid()&&dijit.byId("impStartDate").isValid()&&dijit.byId("impEndYear").isValid()&&dijit.byId("impEndMonth"
).isValid()&&dijit.byId("impEndDate").isValid()))return null;var t=dijit.byId("impStartYear").getValue(),a=dijit.byId("impStartMonth").getValue(),o=dijit.byId("impStartDate").getValue(),s=dijit.byId("impEndYear").getValue(),i=dijit.byId("impEndMonth").getValue(),n=dijit.byId("impEndDate").getValue(),t=moment([t,a-1,o]),a=moment([s,i-1,n]);e.month=null,e.startDate=t.format("YYYY-MM-DD"),e.endDate=a.format("YYYY-MM-DD"
)}else{if(!dijit.byId("impYear").isValid()||!dijit.byId("impMonth").isValid())return null;o=dijit.byId("impYear").getValue(),s=dijit.byId("impMonth").getValue(),i=(e.month=100*o+s,this.convertYearMonth2Range(e.month));e.startDate=i.startDate,e.endDate=i.endDate}return e},teasp.dialog.ShiftCsvImport.prototype.changedRangeType=function(){var e=this.getRangeType();(e||this.reflectMonthToRange())&&(this.displayRangeType(
e?0:1),this.contents&&dojo.attr("shiftImportStart","disabled",!1))},teasp.dialog.ShiftCsvImport.prototype.changeYearMonth=function(){var e=this.reflectMonthToRange();e&&(this.displayRangeOfYearMonth(e),this.contents&&dojo.attr("shiftImportStart","disabled",!1))},teasp.dialog.ShiftCsvImport.prototype.reflectMonthToRange=function(){if(!dijit.byId("impYear").isValid()||!dijit.byId("impMonth").isValid())return null;
var e=100*parseInt(dojo.byId("impYear").value,10)+parseInt(dojo.byId("impMonth").value,10),e=this.convertYearMonth2Range(e),t=moment(e.startDate,"YYYY-MM-DD"),a=moment(e.endDate,"YYYY-MM-DD");return dijit.byId("impStartYear").setValue(t.year()),dijit.byId("impStartMonth").setValue(t.month()+1),dijit.byId("impStartDate").setValue(t.date()),dijit.byId("impEndYear").setValue(a.year()),dijit.byId("impEndMonth").setValue(
a.month()+1),dijit.byId("impEndDate").setValue(a.date()),e},teasp.dialog.ShiftCsvImport.prototype.changeRange=function(){this.contents&&dojo.attr("shiftImportStart","disabled",!1)},teasp.dialog.ShiftCsvImport.prototype.displayByStatus=function(e){switch(e){case this.DISP_INIT:dojo.byId("shiftCsvUpload").value="",dojo.byId("shiftFileName").innerHTML="",dojo.attr("shiftImportStart","disabled",!0),dojo.style(
"shiftImportCommand","display",""),dojo.style("shiftImportEnd","display","none"),dojo.query(".shift-upload-area",dojo.byId(this.id)).forEach(function(e){dojo.style(e,"display","")}),dojo.query(".shift-importing,.shift-import-end,.shift-import-error",dojo.byId(this.id)).forEach(function(e){dojo.style(e,"display","none")}),this.busy(!1);break;case this.DISP_ING:this.busy(!0),dojo.attr("shiftImportStart","disabled",!0),
dojo.query(".shift-upload-area,.shift-import-error",dojo.byId(this.id)).forEach(function(e){dojo.style(e,"display","none")}),dojo.byId("shiftImportingMsg").innerHTML="CSVファイルをチェックしています。",dojo.query(".shift-importing",dojo.byId(this.id)).forEach(function(e){dojo.style(e,"display","")});break;case this.DISP_END:dojo.style("shiftImportCommand","display","none"),dojo.style("shiftImportEnd","display",""),dojo.query(
".shift-importing",dojo.byId(this.id)).forEach(function(e){dojo.style(e,"display","none")}),dojo.query(".shift-import-end",dojo.byId(this.id)).forEach(function(e){dojo.style(e,"display","")});break;case this.DISP_ERROR_RETRY:this.busy(!1),dojo.attr("shiftImportStart","disabled",!0),dojo.query(".shift-upload-area,.shift-import-error",dojo.byId(this.id)).forEach(function(e){dojo.style(e,"display","")}),dojo.query(
".shift-importing",dojo.byId(this.id)).forEach(function(e){dojo.style(e,"display","none")});break;case this.DISP_ERROR_END:dojo.style("shiftImportCommand","display","none"),dojo.style("shiftImportEnd","display",""),dojo.query(".shift-importing",dojo.byId(this.id)).forEach(function(e){dojo.style(e,"display","none")}),dojo.query(".shift-import-error",dojo.byId(this.id)).forEach(function(e){dojo.style(e,"display","")})}
},teasp.dialog.ShiftCsvImport.prototype.busy=function(e){dojo.attr("shiftImportCancel","disabled",e),dojo.attr("shiftCsvUpload","disabled",e),dojo.attr("shiftImportChangeRange","disabled",e),dijit.byId("impYear").set("disabled",e),dijit.byId("impMonth").set("disabled",e),dijit.byId("impStartYear").set("disabled",e),dijit.byId("impStartMonth").set("disabled",e),dijit.byId("impStartDate").set("disabled",e),dijit.byId(
"impEndYear").set("disabled",e),dijit.byId("impEndMonth").set("disabled",e),dijit.byId("impEndDate").set("disabled",e)},teasp.dialog.ShiftCsvImport.prototype.upload=function(){var e=dojo.byId("shiftCsvUpload").files;if(e.length){this.fileName=e[0].name,this.clearDownloadLink(),dojo.byId("shiftFileName").innerHTML="";var t=this.fileName.lastIndexOf(".");if(t<0||"csv"!=this.fileName.substring(t+1).toLowerCase()
)return this.contents=null,dojo.byId("shiftCsvUpload").value="",this.showError("ファイルの拡張子が csv ではありません。"),void this.displayByStatus(this.DISP_ERROR_RETRY);var a=new FileReader;a.readAsText(e[0]),a.onload=dojo.hitch(this,function(){this.showError(),dojo.attr("shiftImportStart","disabled",!1),this.contents=a.result})}},teasp.dialog.ShiftCsvImport.prototype.createDownloadLink=function(e){this.downloadHandle&&(
dojo.disconnect(this.downloadHandle),this.downloadHandle=null);var t,a,o=dojo.byId("shiftImportErrorLink");dojo.empty(o),e&&"undefined"!=typeof Blob&&(a=new Uint8Array([239,187,191]),t=new Blob([a,e],{type:"text/csv"}),window.navigator.msSaveBlob?(a=dojo.create("a",{innerHTML:this.fileName,target:"_blank"},o),this.downloadHandle=dojo.connect(a,"click",this,function(e){window.navigator.msSaveBlob(t,this.fileName)})
):dojo.create("a",{href:(window.URL||window.webkitURL).createObjectURL(t),download:this.fileName,innerHTML:this.fileName,target:"_blank"},o))},teasp.dialog.ShiftCsvImport.prototype.clearDownloadLink=function(e){this.downloadHandle&&(dojo.disconnect(this.downloadHandle),this.downloadHandle=null);var t=dojo.byId("shiftImportErrorLink");dojo.empty(t)},teasp.dialog.ShiftCsvImport.prototype.importStart=function(){
this.showError();var e=this.getRangeValue();if(e){var t=moment(e.startDate),a=moment(e.endDate);if(a.isBefore(t))return this.showError("期間の設定が正しくありません"),void this.displayByStatus(this.DISP_ERROR_RETRY);if(32<=a.diff(t,"days"))return this.showError("期間の日数が最大32日間を超えないように範囲を指定してください"),void this.displayByStatus(this.DISP_ERROR_RETRY);dojo.byId("shiftCsvUpload").value="",dojo.byId("shiftFileName").innerHTML=this.fileName,
this.range=e,this.empIds=[],this.displayByStatus(this.DISP_ING);a=dojo.toJson({startDate:this.range.startDate,endDate:this.range.endDate,csv:this.contents});console.log("csv check start"),Visualforce.remoting.Manager.invokeAction(tsCONST.API_INIT_SHIFT_CSV,a,dojo.hitch(this,function(e,t){t.status?"NG"==e.result?this.importError(dojo.string.substitute(this.ERROR_PH,[e.error&&e.error.message||""])
):e.isSuccess?this.importLoopStart(e.shift):this.importError(this.ERROR_STOP,e.errorCsv):this.importError(dojo.string.substitute(this.ERROR_PH,[t.message||""]))}),{escape:!1})}},teasp.dialog.ShiftCsvImport.prototype.importLoopStart=function(a){dojo.byId("shiftImportingMsg").innerHTML="インポート実行中です。",this.targets=[];var o={},s=0,i=0;Object.keys(a).forEach(function(e){this.empIds.push(e);var t=a[e];o[e]=t,i++,(465<(
s+=Object.keys(t).length)||30<i)&&(this.targets.push(o),o={},s=i=0)},this),Object.keys(o).length&&this.targets.push(o),this.importLoop(0)},teasp.dialog.ShiftCsvImport.prototype.importError=function(e,t){this.showError(e||""),this.createDownloadLink(t?t.join("\n"):null),this.displayByStatus(this.DISP_ERROR_RETRY)},teasp.dialog.ShiftCsvImport.prototype.importEnd=function(){this.displayByStatus(this.DISP_END)},
teasp.dialog.ShiftCsvImport.prototype.showImportResult=function(){this.callback(this.range,this.empIds),this.hide()},teasp.dialog.ShiftCsvImport.prototype.importLoop=function(a){if(a>=this.targets.length)return console.log("update finish"),void this.importEnd();var e=dojo.toJson({target:this.targets[a],isRealShift:!0});console.log("update shift "+(a+1)+"/"+this.targets.length),
Visualforce.remoting.Manager.invokeAction(tsCONST.API_UPDATE_SHIFT,e,dojo.hitch(this,function(e,t){t.status?"NG"==e.result?this.importError(dojo.string.substitute(this.ERROR_PH,[e.error&&e.error.message||""])):this.importLoop(++a):this.importError(dojo.string.substitute(this.ERROR_PH,[t.message||""]))}),{escape:!1})},teasp.provide("teasp.dialog.SelectDept"),teasp.dialog.SelectDept=function(){
this.id="dialogSelectDept",this.title="部署検索",this.duration=1,
this.content='<div class="dlg_content"><table border="0" cellpadding="0" cellspacing="0" style="width:100%;"><tr><td style="font-weight:bold;">絞り込み検索</td><td><div class="searchbox" style="border:1px solid gray;"><div><div class="loupe"></div></div><div><input type="text" id="selectDeptNameIn" style="width:300px;padding:1px 0px;" maxLength="80" placeholder="" /></div><div><div class="clear" id="selectDeptNameInClear" style="display:none;"></div></div></div></td></tr><tr><td colSpan="2" style="padding:8px 0px;width:500px;"><div id="selectDeptArea" style="overflow-y:scroll;overflow-x:hidden;height:240px;border:1px solid gray;"><table class="pane_table" style="width:100%;"><tbody id="selectDeptTbody"></tbody></table></div></td></tr><tr><td colSpan="2" style="padding:4px 0px;text-align:center;"><input type="button" class="normalbtn" value="選択" id="selectDeptOk" />&nbsp;&nbsp;&nbsp;&nbsp;<input type="button" class="cancelbtn" value="キャンセル" id="selectDeptCancel" /></td></tr></table></div>'
,this.okLink={id:"selectDeptOk",callback:this.ok},this.cancelLink={id:"selectDeptCancel",callback:this.cancel}},teasp.dialog.SelectDept.prototype=new teasp.dialog.Base,teasp.dialog.SelectDept.prototype.preStart=function(){dojo.attr(dojo.byId("selectDeptNameIn"),"placeholder","(全件表示)"),dojo.connect(dojo.byId("selectDeptNameIn"),"input",this,this.filterSelectDeptNameDelay),dojo.connect(dojo.byId("selectDeptNameIn"),
"keypress",this,function(e){13==e.keyCode&&(e.preventDefault(),e.stopPropagation())}),dojo.connect(dojo.byId("selectDeptNameInClear"),"click",this,this.clearFilter)},teasp.dialog.SelectDept.prototype.filterSelectDeptNameDelay=function(e){setTimeout(dojo.hitch(this,this.filterSelectDeptName),10)},teasp.dialog.SelectDept.prototype.filterSelectDeptName=function(){var e=dojo.byId("selectDeptNameIn"),t=dojo.byId(
"selectDeptNameInClear"),e=e.value,a=teasp.util.convertStr(e),o=(dojo.style(t,"display",a?"":"none"),0),s=0,i={};dojo.query("#selectDeptTbody tr").forEach(function(t){s++,dojo.query('input[type="hidden"]',t).forEach(function(e){i[s]||(e=e.value,a&&e.indexOf(a)<0?dojo.style(t,"display","none"):(dojo.style(t,"display",""),dojo.toggleClass(t,"even",o%2==0),dojo.toggleClass(t,"odd",o%2!=0),o++,i[s]=1))})}),
0<s&&this.displayNoMatch(o,e)},teasp.dialog.SelectDept.prototype.clearFilter=function(e){var t=dojo.byId("selectDeptNameIn");t.value="",t.focus(),this.filterSelectDeptName()},teasp.dialog.SelectDept.prototype.preShow=function(){for(var e=this.pouch.depts||[],t=dojo.byId("selectDeptTbody"),a=(dojo.empty(t),0),o=0;o<e.length;o++){var s,i,n=e[o];n.past||n.future||(i=dojo.create("tr",{className:"ts-row-"+(
a++%2==0?"even":"odd"),style:"cursor:pointer;"},t),s=dojo.create("td",{style:"width:24px;padding:1px 4px;"},i),i=dojo.create("td",{innerHTML:n.displayName,style:"padding:1px 4px;word-break:break-all;"},i),dojo.create("input",{type:"radio",name:"selectDeptName",data:n.Id},s),dojo.create("input",{type:"hidden",value:teasp.util.convertStr(n.displayName.replace(/&nbsp;/gi,""))},i))}dojo.byId("selectDeptNameIn").value="",
dojo.style("selectDeptNameInClear","display","none");for(var r=this.selectDeptHandles||[],o=0;o<r.length;o++)dojo.disconnect(r[o]);return this.selectDeptHandles=[],dojo.query("tr",t).forEach(function(e){this.selectDeptHandles.push(dojo.connect(e,"click",this,function(e){e=teasp.util.getAncestorByTagName(e.target,"TR");dojo.query("input",e)[0].checked=!0}))},this),!0},
teasp.dialog.SelectDept.prototype.displayNoMatch=function(e,t){var a=dojo.byId("selectDeptTbody"),o=dojo.query("div.no-match",a),t=e?"":dojo.string.substitute("「${0}」に一致する部署はありません",[teasp.util.entitize(t,"")]);o.length?(e||(o[0].innerHTML=t),o=teasp.util.getAncestorByTagName(o[0],"TR"),dojo.style(o,"display",e?"none":"")):e||dojo.create("div",{innerHTML:t,className:"no-match"},dojo.create("td",{colSpan:2,
style:"text-align:left;"},dojo.create("tr",null,a)))},teasp.dialog.SelectDept.prototype.ok=function(){var e,t=dojo.query('input[type="radio"]:checked',dojo.byId("selectDeptTbody"));t.length&&(e=teasp.util.getAncestorByTagName(t[0],"TR"),"none"!=dojo.style(e,"display")&&(e=dojo.attr(t[0],"data"),this.onfinishfunc({targetId:e},"selectDeptErrorRow",function(e){this.hide()},this)))},
teasp.dialog.SelectDept.prototype.cancel=function(){this.onfinishfunc({},"selectDeptErrorRow",function(e){this.hide()},this)},teasp.provide("teasp.dialog.EmpShift"),teasp.dialog.EmpShift=function(){this.widthHint=410,this.heightHint=225,this.id="dialogEmpShift",this.title="曜日毎の設定",this.duration=1,
this.content='<div class="dlg_content" style="width:540px;"><table class="ts_a_frame"><tr><td class="edgelt"></td><td class="edgeht"></td><td class="edgert"></td></tr><tr><td class="edgevl"></td><td><div class="edge_div"><table class="stand_table"><tr class="shift_setting_list"><td class="left_s">社員名</td><td class="right"><select id="empShiftEmps" style="display:none;max-width:380px;"></select><div id="empShiftEmpName" style="display:none;word-break:break-all;"></div></td></tr><tr><td class="left_s">曜日</td><td class="right"><table class="pane_table" style="margin:8px 0px;"><tbody><tr><td style="padding-right:6px;vertical-align:middle;"><label><input type="checkbox" id="schedW0">&nbsp;日</label></td><td style="padding-right:6px;vertical-align:middle;"><label><input type="checkbox" id="schedW1">&nbsp;月</label></td><td style="padding-right:6px;vertical-align:middle;"><label><input type="checkbox" id="schedW2">&nbsp;火</label></td><td style="padding-right:6px;vertical-align:middle;"><label><input type="checkbox" id="schedW3">&nbsp;水</label></td><td style="padding-right:6px;vertical-align:middle;"><label><input type="checkbox" id="schedW4">&nbsp;木</label></td><td style="padding-right:6px;vertical-align:middle;"><label><input type="checkbox" id="schedW5">&nbsp;金</label></td><td style="padding-right:6px;vertical-align:middle;"><label><input type="checkbox" id="schedW6">&nbsp;土</label></td></tr></tbody></table></td></tr><tr class="shift_day_type"><td class="left_s">種別</td><td class="right"><div style="margin:0px;"><select id="empShiftDayType"><option value="*">(変更なし)</option><option value="0">勤務日</option><option value="1">非勤務日</option></select></div><div id="empShiftDayTypeOption" style="display:none;margin:1px 0px 0px 12px;"><label style="margin-right:8px;"><input type="radio" name="empShiftDayTypeOption" style="margin:2px;" id="empShiftDayTypeRegularHoliday"><span>所定休日</span></label><label style="margin-right:8px;"><input type="radio" name="empShiftDayTypeOption" style="margin:2px;" id="empShiftDayTypeLegalHoliday"><span>法定休日</span></label></div></td></tr><tr class="shift_normal_day"><td class="left_s">勤務パターン</td><td class="right"><div><select id="empShiftPatterns" style="width:300px;"></select></div><div id="empShiftPatternIcon" style="margin-left:4px;"></div></td></tr><tr class="shift_normal_day"><td class="left_s">始業終業時刻</td><td class="right"><input type="text" class="inputime inputran" value="" id="empShiftSt" />&nbsp;～&nbsp;<input type="text" class="inputime inputran" value="" id="empShiftEt" /></td></tr><tr class="shift_normal_day"><td class="left_s">主管部署</td><td class="right"><div><select id="empShiftDepts" style="max-width:300px;"></select></div><div id="empShiftDeptIcon" style="margin-left:4px;"></div><div><input type="button" id="empShiftBrowseDept" class="loupe" /></div></td></tr><tr><td class="left_s">備考</td><td class="right"><textarea id="empShiftNote" class="inputran" style="padding:2px;width:380px;height:32px;"></textarea></td></tr><tr class="shift_setting_list"><td class="left_s">優先度</td><td class="right"><select id="empShiftPriority"></select></td></tr></table></div></td><td class="edgevr"></td></tr><tr><td class="edgelb"></td><td class="edgehb"></td><td class="edgerb"></td></tr></table><table border="0" cellpadding="0" cellspacing="0" style="width:100%;"><tr><td id="empShiftErrorRow" style="text-align:center;"></td></tr><tr><td style="padding:16px 0px 4px 0px;text-align:center;"><input type="button" class="normalbtn" value="登録" id="empShiftOk" />&nbsp;&nbsp;&nbsp;&nbsp;<input   type="button"   class="cancelbtn" value="キャンセル" id="empShiftCancel" /></td></tr></table></div>'
,this.okLink={id:"empShiftOk",callback:this.ok},this.cancelLink={id:"empShiftCancel",callback:this.hide},this.shiftObj=null},teasp.dialog.EmpShift.prototype=new teasp.dialog.Base,teasp.dialog.EmpShift.prototype.ready=function(){this.args.emp&&"number"==typeof this.args.index&&0<=this.args.index?this.shiftObj=this.args.emp.rules[this.args.index]:this.args.emps?this.shiftObj={workPlaceId:null}:this.shiftObj=null},
teasp.dialog.EmpShift.prototype.preStart=function(){dojo.connect(dojo.byId("empShiftDayType"),"onchange",this,this.changedDayType),dojo.connect(dojo.byId("empShiftDepts"),"onchange",this,this.changedDept),dojo.connect(dojo.byId("empShiftPatterns"),"onchange",this,this.changedPattern),dojo.connect(dojo.byId("empShiftBrowseDept"),"click",this,this.openSelectDept),dojo.query(".inputime").forEach(function(e){
dojo.connect(e,"blur",this,teasp.util.time.onblurTime),dojo.connect(e,"onkeypress",this,teasp.util.time.onkeypressTime)},this),dojo.connect(dojo.byId("empShiftEmps"),"onchange",this,function(){var e=dojo.byId("empShiftEmps").value,e=this.getEmpById(e);this.setPriorityList(e),this.setupPatternList(this.getEmps(),e,dojo.byId("empShiftPatterns").value)})},teasp.dialog.EmpShift.prototype.preShow=function(){
this.showError(null);for(var e,t=this.shiftObj,a=0;a<7;a++)dojo.byId("schedW"+a).checked=!1;for(var o=(t&&t.week||"").split(/,/),a=0;a<o.length;a++){var s=dojo.byId("schedW"+o[a]);s&&(s.checked=!0)}e=dojo.byId("empShiftEmps"),dojo.empty(e);var i=this.getEmps(),n=this.args.emp;if(1<i.length&&this.args.index<0){for(a=0;a<i.length;a++)dojo.create("option",{innerHTML:i[a].Name,value:i[a].Id},e);n&&(e.value=n.Id),
dojo.style(e,"display",""),dojo.style("empShiftEmpName","display","none"),this.setPriorityList(this.getEmpById(e.value))}else n?(dojo.byId("empShiftEmpName").innerHTML=n.Name,this.setPriorityList(n),dojo.style(e,"display","none"),dojo.style("empShiftEmpName","display","")):(dojo.style(e,"display","none"),dojo.style("empShiftEmpName","display","none"));for(var r=t&&t.dayType?t.dayType:"*",l=(dojo.byId(
"empShiftDayType").value="2"==r?"1":r,dojo.byId("empShiftDayTypeRegularHoliday").checked="2"!=r,dojo.byId("empShiftDayTypeLegalHoliday").checked="2"==r,e=dojo.byId("empShiftDepts"),dojo.empty(e),dojo.create("option",{innerHTML:"（変更なし）",value:"*"},e),this.pouch.depts),a=0;a<l.length;a++){var p=l[a];dojo.create("option",{innerHTML:p.displayName,value:p.Id},e)}e.value=t&&t.workPlaceId?t.workPlaceId:"*";
r=1<i.length&&this.args.index<0?i[0]:n;return this.setupPatternList(i,r,t&&t.patternId),dojo.byId("empShiftSt").readOnly="readOnly",dojo.byId("empShiftEt").readOnly="readOnly",dojo.query(".shift_setting_list").forEach(function(e){dojo.style(e,"display",t?"":"none")}),this.changedDayType(),this.changedPattern(),this.changedDept(),!0},teasp.dialog.EmpShift.prototype.setupPatternList=function(e,t,a){var o=[];if(t)for(
var s=t.empType.patterns||[],i=0;i<s.length;i++)(p=s[i].pattern)&&p.Id&&o.push(p);else{for(var n={},r=0;r<e.length;r++)for(var l,s=e[r].empType.patterns||[],i=0;i<s.length;i++)(p=s[i].pattern)&&p.Id&&((l=n[p.Id]||0)||o.push(p),n[p.Id]=l+1);for(r=o.length-1;0<=r;r--)n[(p=o[r]).Id]<e.length&&o.splice(r,1)}for(var p,d=dojo.byId("empShiftPatterns"),c=(dojo.empty(d),dojo.create("option",{innerHTML:"（変更なし）",value:"*"},d),
dojo.create("option",{innerHTML:"（通常勤務）",value:"-"},d),null),r=0;r<o.length;r++)(p=o[r])&&!p.Removed__c&&(dojo.create("option",{innerHTML:p.Name,value:p.Id},d),p.Id==a&&(c=p.Id));d.value=c||"*"},teasp.dialog.EmpShift.prototype.setPriorityList=function(e){var t=dojo.byId("empShiftPriority");if(dojo.empty(t),this.shiftObj&&e){for(var a=(e.rules?e.rules.length:0)+(this.args.index<0?1:0),o=0;o<a;o++){var s=""+(o+1);
dojo.create("option",{innerHTML:s,value:s},t)}this.args.index<0?t.value=""+a:t.value=""+(this.args.index+1)}},teasp.dialog.EmpShift.prototype.changedPattern=function(){for(var e=dojo.byId("empShiftPatterns").value,t=this.pouch.allPatterns,a=null,o=0;o<t.length;o++)if(t[o].Id==e){a=t[o];break}var s,i=dojo.byId("empShiftPatternIcon");dojo.empty(i),"-"!=e&&"*"!=e&&a?(s=a.Symbol__c||a.Name.substring(0,1),dojo.create(
"div",{className:"pattern dayDiv",style:{marginLeft:"auto",marginRight:"auto"},innerHTML:s},i),dojo.byId("empShiftSt").value=teasp.util.time.timeValue(a.StdStartTime__c),dojo.byId("empShiftEt").value=teasp.util.time.timeValue(a.StdEndTime__c)):(dojo.byId("empShiftSt").value="",dojo.byId("empShiftEt").value="")},teasp.dialog.EmpShift.prototype.changedDept=function(){for(var e=dojo.byId("empShiftDepts").value,
t=this.pouch.depts,a=null,o=0;o<t.length;o++)if(t[o].Id==e){a=t[o];break}var s,i=dojo.byId("empShiftDeptIcon");dojo.empty(i),"-"!=e&&"*"!=e&&a&&(s=a.Symbol__c||a.Name.substring(0,1),dojo.create("div",{className:"workPlace dayDiv",style:{marginLeft:"auto",marginRight:"auto"},innerHTML:s},i))},teasp.dialog.EmpShift.prototype.changedDayType=function(){var t=dojo.byId("empShiftDayType").value;dojo.query(
".shift_normal_day").forEach(function(e){dojo.style(e,"display","1"==t?"none":"")}),dojo.style("empShiftDayTypeOption","display","1"==t?"":"none")},teasp.dialog.EmpShift.prototype.getEmpById=function(e){for(var t=this.args.emps,a=0;a<t.length;a++)if(t[a].Id==e)return t[a];return null},teasp.dialog.EmpShift.prototype.getEmps=function(){if(this.args.emps)return this.args.emps;var e=[];if(this.args.empIds)for(
var t=this.pouch.emps||[],a=0;a<t.length;a++)this.args.empIds.contains(t[a].Id)&&e.push(t[a]);return e},teasp.dialog.EmpShift.prototype.ok=function(){for(var e=dojo.byId("empShiftDepts").value,t=dojo.byId("empShiftPatterns").value,a=null,o=[],s=0;s<7;s++)dojo.byId("schedW"+s).checked&&o.push(""+s);if(o.length<=0)this.showError("曜日を選択してください");else{var i="*"==dojo.byId("empShiftDayType").value?null:dojo.byId(
"empShiftDayType").value;if(null==i)this.showError("種別を選択してください");else{"1"==i&&dojo.byId("empShiftDayTypeLegalHoliday").checked&&(i="2");teasp.util.time.clock2minutes(dojo.byId("empShiftSt").value),teasp.util.time.clock2minutes(dojo.byId("empShiftEt").value);var n=dojo.byId("empShiftNote").value,r=parseInt(dojo.byId("empShiftPriority").value,10),e="*"==e||"1"==i||"2"==i?null:e,t="-"==t||"*"==t||"1"==i||"2"==i?null:t,
l={};if(this.args.empIds){for(var p=this.pouch.dateList,d=[],s=0;s<p.length;s++){var c=teasp.util.date.parseDate(p[s]);o.contains(""+c.getDay())&&d.push(p[s])}for(s=0;s<this.args.empIds.length;s++)l[this.args.empIds[s]]=[{dateList:d,dayType:i,workPlaceId:e,patternId:t,startTime:null,endTime:null,note:n}];1==this.args.empIds.length&&(a=this.args.empIds[0])}a||(
this.args.emp?a=this.args.emp.Id:this.args.emps&&0<this.args.emps.length&&(a=1==this.args.emps.length?this.args.emps[0].Id:dojo.byId("empShiftEmps").value));a={empId:a,target:l,week:o.join(","),dayType:i,workPlaceId:e,patternId:t,startTime:null,endTime:null,note:n,seqNo:this.shiftObj&&this.shiftObj.seqNo||0,priority:r};this.onfinishfunc(a,"empShiftErrorRow",function(e){this.hide()},this)}}},
teasp.dialog.EmpShift.prototype.showError=function(e){teasp.util.showErrorArea(e,"empShiftErrorRow")},teasp.dialog.EmpShift.prototype.openSelectDept=function(){teasp.manager.dialogOpen("SelectDept",null,{depts:this.pouch.depts},this,function(e,t,a,o){e.targetId&&(dojo.byId("empShiftDepts").value=e.targetId,this.changedDept()),a&&a.apply(o)})},teasp.provide("teasp.dialog.EmpShiftList"),
teasp.dialog.EmpShiftList=function(){this.id="dialogEmpShiftList",this.title="社員毎の設定リスト",this.duration=1,
this.content='<div class="dlg_content"><table class="pane_table" width="724px" style="margin:0px;"><tbody><tr><td><table class="atk_r_table"><tbody><tr><td class="head" width="22px"><input type="checkbox" id="empShiftListChk" /></td><td class="head" width="38px"></td><td class="head" width="38px"></td><td class="head" width="120px"><div>曜日</div></td><td class="head" width="70px"><div>種別</div></td><td class="head" width="160px"><div>勤務パターン</div></td><td class="head" width="100px"><div>始業終業時刻</div></td><td class="head" width="176px"><div>主管部署</div></td></tr></tbody></table></td></tr><tr height="1px"><td></td></tr><tr><td><div id="empShiftListTargetDiv" class="atk_r_record_area" width="714px" style="height:202px;overflow-y:scroll;background-color:white;"><table class="atk_r_record_table"><tbody id="empShiftListTbody"><tr><td></td></tr></tbody></table></div></td></tr></tbody></table><div style="margin:4px 8px 8px 8px;text-align:left;width:100%;"><div class="inputarea">※ 同一社員・同一曜日に設定が重複する場合は、表示順で上位の設定が優先されます。</div></div><table class="pane_table" style="margin:4px;width:100%;"><tr><td style="text-align:center;" colSpan="4"><div id="empShiftListErrorRow"></div></td></tr><tr><td style="text-align:left;width:25%;"><input type="button" class="pb_base pb_btn_plus" style="margin:0px;" id="empShiftListNew" /></td><td style="text-align:right;width:25%;"><input type="button" class="normalbtn" value="上記設定を適用する" style="margin-right:32px;" id="empShiftListOk" /></td><td style="text-align:left;width:25%;"><input type="button" class="cancelbtn" value="閉じる" style="margin-left:48px;" id="empShiftListClose" /></td><td style="width:25%;"></td></tr></table></div>'
,this.okLink={id:"empShiftListOk",callback:this.ok},this.cancelLink={id:"empShiftListClose",callback:this.hide},this.emps=null,this.seqNo=1,this.eventHandles=[]},teasp.dialog.EmpShiftList.prototype=new teasp.dialog.Base,teasp.dialog.EmpShiftList.prototype.contact=function(e,t){teasp.action.contact.remoteMethods(is_array(e)?e:[e],{errorAreaId:e.errorAreaId||"empShiftListErrorRow"},t,null,this)},
teasp.dialog.EmpShiftList.prototype.ready=function(){this.emps=[];for(var e=0;e<this.args.empIds.length;e++){var t=this.getEmpById(this.args.empIds[e]);this.emps.push(t)}},teasp.dialog.EmpShiftList.prototype.preStart=function(){dojo.connect(dojo.byId("empShiftListNew"),"onclick",this,function(){this.openWeeklyShift(null)}),dojo.connect(dojo.byId("empShiftListChk"),"onclick",this,function(){for(var e=dojo.byId(
"empShiftListChk").checked,t=dojo.byId("empShiftListTbody"),a=0;a<t.rows.length;a++){var o=t.rows[a].cells[0].firstChild;"INPUT"==o.tagName&&(o.checked=e)}this.ruleScanning()})},teasp.dialog.EmpShiftList.prototype.preShow=function(){for(var e=0;e<this.eventHandles.length;e++)dojo.disconnect(this.eventHandles[e]),delete this.eventHandles[e];return this.eventHandles=[],this.showError(null),this.createList(),!0},
teasp.dialog.EmpShiftList.prototype.createList=function(){this.showError(null);var e,t=dojo.byId("empShiftListTbody");dojo.empty(t);for(var a=0;a<this.emps.length;a++)(i=this.emps[a]).rules=("string"==typeof i.DefaultRule__c?dojo.fromJson(i.DefaultRule__c):i.DefaultRule__c)||[];for(var o=0,s=0;s<this.emps.length;s++){var i=this.emps[s],n=dojo.create("tr",{className:o++%2==0?"even":"odd"},t);for(dojo.create("div",{
innerHTML:i.Name,style:"margin:3px 8px;font-size:13px;word-break:break-all;"},dojo.create("td",{colSpan:8,style:{textAlign:"left"}},n)),a=0;a<i.rules.length;a++){var r,l=i.rules[a],p=(l.seqNo=this.seqNo++,teasp.util.date.getWeekJpByNumArray(teasp.util.parseNumsText(l.week))),d=this.getPatternById(l.patternId),c=this.getWorkPlaceById(l.workPlaceId),m=(n=dojo.create("tr",{className:o++%2==0?"even":"odd"},t),
e=dojo.create("td",{style:{height:"20px",width:"22px",fontSize:"12px"}},n),dojo.create("input",{type:"checkbox",style:{margin:"2px 4px"}},e)),m=(this.eventHandles.push(dojo.connect(m,"onclick",this,this.ruleScanning)),m.checked=!0,dojo.create("input",{type:"hidden",value:""+l.seqNo},e),m=dojo.create("input",{type:"div",className:"pp_base pp_btn_edit",title:"編集",style:{margin:"1px 2px"}},dojo.create("td",{style:{
height:"20px",width:"38px",fontSize:"12px"}},n)),this.eventHandles.push(dojo.connect(m,"onclick",this,function(){var e=l.seqNo;return function(){this.openWeeklyShift(e)}}())),m=dojo.create("input",{type:"div",className:"pp_base pp_btn_del",title:"削除",style:{margin:"1px 2px"}},dojo.create("td",{style:{height:"20px",width:"38px",fontSize:"12px"}},n)),this.eventHandles.push(dojo.connect(m,"onclick",this,function(){
var e=l.seqNo;return function(){this.deleteEmpShift(e)}}())),e=dojo.create("td",{style:{height:"20px",width:"120px",fontSize:"12px",textAlign:"center"}},n),dojo.create("div",{style:{marginLeft:"auto",marginRight:"auto",display:"table"}},e));dojo.create("div",{className:"pp_base pp_shift_set_warn",style:{float:"left",marginRight:"4px",marginTop:"2px",display:"none"}},m),dojo.create("div",{innerHTML:p,style:{
margin:"2px",whiteSpace:"nowrap"}},m),dojo.create("div",{innerHTML:"0"==l.dayType?"勤務日":"2"==l.dayType?"法定休日":"所定休日",style:{margin:"2px 4px"}},dojo.create("td",{style:{height:"20px",width:"70px",fontSize:"12px",textAlign:"center"}},n)),e=dojo.create("td",{style:{height:"20px",width:"160px",fontSize:"12px"}},n),d&&(r=d.Symbol__c||d.Name.substring(0,1),dojo.create("div",{className:"pattern dayDiv",style:{float:"left",
marginRight:"2px"},innerHTML:r},e)),dojo.create("div",{innerHTML:d?d.Name:"",style:{margin:"2px 4px",wordBreak:"break-all",float:"left"}},e),dojo.create("div",{style:{clear:"both"}},e),dojo.create("div",{innerHTML:teasp.util.time.timeValue(l.st)+" - "+teasp.util.time.timeValue(l.et),style:{margin:"2px 4px"}},dojo.create("td",{style:{height:"20px",width:"100px",fontSize:"12px",textAlign:"center"}},n)),e=dojo.create(
"td",{style:{height:"20px",width:"160px",fontSize:"12px"}},n),c&&(r=c.Symbol__c||c.Name.substring(0,1),dojo.create("div",{className:"workPlace dayDiv",style:{float:"left",marginRight:"2px"},innerHTML:r},e)),dojo.create("div",{innerHTML:c?c.Name:"",style:"margin:2px 4px;word-break:break-all;"},e)}}for(dojo.style("empShiftListChk","display",0<o?"":"none"),dojo.byId("empShiftListChk").checked=0<o;o<10;){n=dojo.create(
"tr",{className:o%2==0?"even":"odd"},t);dojo.create("div",null,dojo.create("td",{style:{height:"20px",width:"22px"}},n)),dojo.create("div",null,dojo.create("td",{style:{height:"20px",width:"38px"}},n)),dojo.create("div",null,dojo.create("td",{style:{height:"20px",width:"38px"}},n)),dojo.create("div",null,dojo.create("td",{style:{height:"20px",width:"120px"}},n)),dojo.create("div",null,dojo.create("td",{style:{
height:"20px",width:"70px"}},n)),dojo.create("div",null,dojo.create("td",{style:{height:"20px",width:"160px"}},n)),dojo.create("div",null,dojo.create("td",{style:{height:"20px",width:"100px"}},n)),dojo.create("div",null,dojo.create("td",{style:{height:"20px",width:"160px"}},n)),o++}this.ruleScanning()},teasp.dialog.EmpShiftList.prototype.ok=function(){this.showError(null);var e,t=this.ruleScanning(),a={},
o=this.pouch.dateList;for(e in t)if(t.hasOwnProperty(e)){var s=this.getEmpById(e);a[s.Id]=[];for(var i=0;i<s.rules.length;i++){var n,r=s.rules[i];r.checked&&((n=this.getDateListByWeek(o,r.week,r.ngweek)).length<=0||a[s.Id].push({dateList:n,dayType:r.dayType,workPlaceId:r.workPlaceId,patternId:r.patternId,st:r.st,et:r.et,note:r.note}))}}this.onfinishfunc({target:a},"empShiftListErrorRow",function(e){this.hide()},this)
},teasp.dialog.EmpShiftList.prototype.getDateListByWeek=function(e,t,a){var o=[];if(!t)return o;for(var s=teasp.util.parseNumsText(t),t=teasp.util.parseNumsText(a),s=teasp.util.date.excludeNums(s,t),i=0;i<e.length;i++){var n=teasp.util.date.parseDate(e[i]);s.contains(n.getDay())&&o.push(e[i])}return o},teasp.dialog.EmpShiftList.prototype.showError=function(e){teasp.util.showErrorArea(e,"empShiftListErrorRow")},
teasp.dialog.EmpShiftList.prototype.getEmpById=function(e){for(var t=this.pouch.emps,a=0;a<t.length;a++)if(t[a].Id==e)return t[a];return null},teasp.dialog.EmpShiftList.prototype.getPatternById=function(e){for(var t=this.pouch.allPatterns,a=0;a<t.length;a++)if(t[a].Id==e)return t[a];return null},teasp.dialog.EmpShiftList.prototype.getWorkPlaceById=function(e){for(var t=this.pouch.depts,a=0;a<t.length;a++)if(
t[a].Id==e)return t[a];return null},teasp.dialog.EmpShiftList.prototype.getShiftBySeqNo=function(e){for(var t=0;t<this.emps.length;t++)for(var a=this.emps[t],o=0;o<a.rules.length;o++){var s=a.rules[o];if(s.seqNo==e)return{obj:s,index:o,emp:a}}return null},teasp.dialog.EmpShiftList.prototype.getCommonDeptId=function(){for(var e={},t=0;t<this.emps.length;t++)e[this.emps[t].DeptId__c]=1;var a,o=[];for(a in e
)e.hasOwnProperty(a)&&o.push(a);return 1==o.length?o[0]:null},teasp.dialog.EmpShiftList.prototype.getMaxRuleCount=function(){for(var e=0,t=0;t<this.emps.length;t++)e<(this.emps[t].rules||[]).length&&(e=this.emps[t].rules.length);return e},teasp.dialog.EmpShiftList.prototype.ruleScanning=function(){for(var e=dojo.byId("empShiftListTbody"),t=0;t<e.rows.length;t++){var a,o=e.rows[t].cells[0].firstChild;
o&&"INPUT"==o.tagName&&o.nextSibling&&(a=parseInt(o.nextSibling.value,10),this.getShiftBySeqNo(a).obj.checked=o.checked)}return this.ruleScan()},teasp.dialog.EmpShiftList.prototype.ruleScan=function(){for(var e={},t=0;t<this.emps.length;t++){for(var a=this.emps[t],o={},s=0;s<a.rules.length;s++){var i=a.rules[s];if(i.checked&&i.week){for(var n=i.week.split(/,/),r=[],l=0,p=0;p<n.length;p++){var d=n[p];o[d]?r.push(d):(
o[d]=i,l++)}0==l?(i.valid=-1,i.ngweek=r.join(",")):l<n.length?(i.valid=0,i.ngweek=r.join(",")):i.valid=1}}e[a.Id]=o}return this.ruleWarn(),e},teasp.dialog.EmpShiftList.prototype.ruleWarn=function(){for(var e=dojo.byId("empShiftListTbody"),t=0;t<e.rows.length;t++){var a,o,s=e.rows[t].cells[0].firstChild;s&&"INPUT"==s.tagName&&s.nextSibling&&(a=e.rows[t].cells[3].firstChild.firstChild,o=parseInt(s.nextSibling.value,10)
,0<(o=this.getShiftBySeqNo(o).obj).valid||!s.checked?(a.style.display="none",a.title=""):(a.className="pp_base pp_shift_set_"+(o.valid<0?"ng":"warn"),a.title=teasp.util.date.getWeekJpByNumArray(teasp.util.parseNumsText(o.ngweek))+"曜日の設定が重複しています",a.style.display=""))}},teasp.dialog.EmpShiftList.prototype.openWeeklyShift=function(e){var e=this.getShiftBySeqNo(e),t=e?e.emp:1==this.emps.length?this.emps[0]:null;
teasp.manager.dialogOpen("EmpShift",{emps:this.emps,emp:t,index:e&&"number"==typeof e.index?e.index:-1},this.pouch,this,this.updateEmpShift)},teasp.dialog.EmpShiftList.prototype.deleteEmpShift=function(e){var t,a=this.getShiftBySeqNo(e);a&&(t=a.emp,teasp.tsConfirmA("設定を削除してもよろしいですか？",this,function(){t.rules.splice(a.index,1);var e={empId:t.Id,defaultRule:dojo.toJson(t.rules)};this.contact({
funcName:"updateDefaultRule",params:e},function(e){t.DefaultRule__c=t.rules,this.createList()})}))},teasp.dialog.EmpShiftList.prototype.updateEmpShift=function(e,t,a,o){var s={week:e.week,dayType:e.dayType,patternId:e.patternId,st:e.st,et:e.et,workPlaceId:e.workPlaceId},i=this.getShiftBySeqNo(e.seqNo),n=null,i=(i?(n=i.emp).rules.splice(i.index,1):n=this.getEmpById(e.empId),e.priority),e=(
n.rules.length<i?n.rules.push(s):n.rules.splice(i-1,0,s),{empId:n.Id,defaultRule:dojo.toJson(n.rules)});this.contact({funcName:"updateDefaultRule",params:e,errorAreaId:t},function(e){n.DefaultRule__c=n.rules,this.createList(),a.apply(o)})},teasp.provide("teasp.dialog.Status"),teasp.dialog.Status=function(){this.id="dialogStatus",this.title=teasp.message.getLabel("status_caption"),this.duration=1,
this.content='<table id="dialogStatusTable"><tr><td><table class="emp_apply_steps"><tbody><tr><td><table class="emp_apply_steps_head"><tbody></tbody></table></td></tr><tr><td><div class="emp_apply_steps_area" id="dialogStatusDiv"><table class="emp_apply_steps_body"><tbody></tbody></table></div></td></tr></tbody></table></td></tr><tr class="ts-buttons-row"><td style="text-align:center;padding-top:10px;"><div><button class="red-button1" id="dialogStatusRemove" ><div></div></button><button class="std-button2" id="dialogStatusClose"  ><div></div></button></div></td></tr></table>'
,this.cancelLink={id:"dialogStatusClose",callback:this.close},this.removeHandle=null},teasp.dialog.Status.prototype=new teasp.dialog.Base,teasp.dialog.Status.prototype.preStart=function(){dojo.byId("dialogStatusRemove").firstChild.innerHTML=teasp.message.getLabel("cancelApply_btn_title"),dojo.byId("dialogStatusClose").firstChild.innerHTML=teasp.message.getLabel("close_btn_title")},
teasp.dialog.Status.prototype.preShow=function(){this.removeHandle&&dojo.disconnect(this.removeHandle),this.args.unknotable?this.setUnknotButton():this.setRemoveButton(this.args.removable),dojo.style("dialogStatusTable","width",teasp.isNarrow()?"100%":"612px"),dojo.style("dialogStatusDiv","width",teasp.isNarrow()?"100%":"612px"),teasp.isNarrow()||(dojo.style("dialogStatusDiv","overflow-y","scroll"),dojo.style(
"dialogStatusDiv","height","105px"));var e=dojo.query("#dialogStatusTable table.emp_apply_steps_head > tbody")[0],e=(dojo.empty(e),dojo.create("tr",null,e)),t=dojo.create("td",{className:"number"},e),a=dojo.create("td",{className:"datetime"},e),o=dojo.create("td",{className:"status"},e),s=dojo.create("td",{className:"actor"},e),e=teasp.isNarrow()?null:dojo.create("td",{className:"comment"},e);return dojo.create("div"
,{innerHTML:teasp.message.getLabel("number_head")},t),dojo.create("div",{innerHTML:teasp.message.getLabel("dateTime_head")},a),dojo.create("div",{innerHTML:teasp.message.getLabel("statusj_head")},o),dojo.create("div",{innerHTML:teasp.message.getLabel("actor_head")},s),e&&dojo.create("div",{innerHTML:teasp.message.getLabel("comment_head")},e),this.createTable(this.args.apply&&this.args.apply.steps||[]),!0},
teasp.dialog.Status.prototype.createTable=function(e){for(var t=dojo.query("#dialogStatusTable table.emp_apply_steps_body > tbody")[0],a=(dojo.empty(t),dojo.clone(e).reverse()),o=Math.max(a.length,5),s=a.length,i=0;i<o;i++){var n,r,l,p=i<a.length?a[i]:null,d=dojo.create("tr",{className:i%2==0?"even":"odd"},t),c=teasp.isNarrow()?dojo.create("tr",{className:i%2==0?"even":"odd"},t):null,m=null,h=null,u=null,g=null,
y=null;i||p?(m=dojo.create("td",{className:"number"},d),h=dojo.create("td",{className:"datetime"},d),u=dojo.create("td",{className:"status"},d),g=dojo.create("td",{className:"actor"},d),y=dojo.create("td",{className:"comment"},c||d),teasp.isNarrow()&&(dojo.attr(m,"rowSpan","2"),dojo.attr(y,"colSpan","3"))):(m=dojo.create("td",{colspan:teasp.isNarrow()?"4":"5",style:"text-align:left;"},d),dojo.create("div",{
innerHTML:teasp.message.getLabel("tm10006010"),style:"margin:4px;"},m)),p?(c=s--,d=p.createdDateS||teasp.util.date.formatDateTime(p.createdDate,"SLA-HM"),n=teasp.constant.getDisplayStatus(p.stepStatus),r=p.actorName,l=teasp.util.entitize(p.comments||"",""),!this.args.showCancelComment&&teasp.constant.STATUS_CANCELS.contains(p.stepStatus)&&(l=""),dojo.create("div",{innerHTML:c},m),dojo.create("div",{innerHTML:d},h),
dojo.create("div",{innerHTML:n},u),dojo.create("div",{innerHTML:r},g),dojo.create("div",{innerHTML:l},y),l||dojo.style(y,"height","1px")):y&&dojo.style(y,"height","1px")}setTimeout(function(){var e=dojo.query("#dialogStatusTable table.emp_apply_steps_body > tbody")[0].offsetHeight;!teasp.isNarrow()&&105<e&&dojo.style("dialogStatusDiv","height",Math.min(e,200)+"px")},100)},
teasp.dialog.Status.prototype.setRemoveButton=function(e){var t,a=teasp.message.getLabel("cancelFix_btn_title"),o=(1==this.args.removeButtonType?a=teasp.message.getLabel("cancelApply_btn_title"):2==this.args.removeButtonType?a=teasp.message.getLabel("tk10000741"):3==this.args.removeButtonType?a=teasp.message.getLabel("retractApply_label"):4==this.args.removeButtonType&&(a=teasp.message.getLabel("cancelFix_btn_title")
),dojo.byId("dialogStatusRemove"));o.className="red-button1"+(e?"":"-disabled"),o.firstChild.innerHTML=a,e&&((t=this).removeHandle=dojo.connect(dojo.byId("dialogStatusRemove"),"onclick",this,function(){this.args.cancelApply.apply(this.thisObject,[this.args.apply,function(e){t.onfinishfunc(e),t.close()},function(e){teasp.message.alertError(e)}])}))},teasp.dialog.Status.prototype.setUnknotButton=function(){
var e=dojo.byId("dialogStatusRemove"),t=(e.className="red-button1",e.firstChild.innerHTML=teasp.message.getLabel("retractApply_label"),this);this.removeHandle=dojo.connect(dojo.byId("dialogStatusRemove"),"onclick",this,function(){this.args.cancelApply.apply(this.thisObject,[this.args.apply,function(e){t.onfinishfunc(e),t.close()},function(e){teasp.message.alertError(e)}])})},teasp.provide("teasp.dialog.WorkBalance"),
teasp.dialog.WorkBalance=function(){this.widthHint=615,this.heightHint=480,this.id="dialogWorkBalance",this.title=teasp.message.getLabel("empWorkEdit_btn_title"),this.duration=1,this.okLink={id:"empWorkOk",callback:this.ok},this.cancelLink={id:"empWorkCancel",callback:this.hide},this.closeLink={id:"empWorkClose",callback:this.hide},this.slider=[],this.sliderRules=[],this.percents=[],this.slideInit=[],this.rowMin=5,
this.sliderBusy=!1,this.sliderEventIgnore=[],this.progressOn=!1,this.taskNoteOn=!1,this.jobWorks=null,this.classifyJobWorks=null,this.eventHandles1=[],this.eventHandles2=[],this.notApprove=null},teasp.dialog.WorkBalance.prototype=new teasp.dialog.Base,teasp.dialog.WorkBalance.prototype.getCookie=function(){return teasp.getCookie("empWorkDialog")},teasp.dialog.WorkBalance.prototype.setCookie=function(e){
teasp.setCookie("empWorkDialog",e)},teasp.dialog.WorkBalance.prototype.getLocalStorage=function(){return teasp.getLocalStorage("empWorkDialog")},teasp.dialog.WorkBalance.prototype.setLocalStorage=function(e){teasp.setLocalStorage("empWorkDialog",e)},teasp.dialog.WorkBalance.prototype.ready=function(){this.progressOn=0<this.pouch.getProgressList().length,this.taskNoteOn=this.pouch.getTaskNoteOption(),
this.duplable=!this.isReadOnly()&&this.pouch.isPermitDuplicateJobProcess()},teasp.dialog.WorkBalance.prototype.preInit=function(){require(["dijit/form/Slider","dojox/layout/ResizeHandle","dojo/cookie"]);var e=this.progressOn?"x":"x_edge";
this.content='<div id="empWorkDialog" style="position:relative;"><table class="emp_work_frame" style="width:100%;"><tr><td style="padding: 0px 6px 6px 6px;"><table class="horiz" style="width:100%;"><tr><td style="text-align:left;"><table class="pane_table"><tr><td><div id="empWorkDate"></div></td><td><div id="empWorkRealTime" style="margin-left:25px;"></div></td></tr></table></td><td style="text-align:right;"><div id="empWorkLockMsg"></div></td></tr></table></td></tr><tr class="emp_work_note_area"><td style="background-color:#CCDDEA;border:1px solid #74A3C5;text-align:left;"><div style="margin-left:12px;color:#4684B2;font-size:13px;font-weight:bold;" id="jobWorks_workReport_label"></div></td></tr><tr class="emp_work_note_area" style="height:1px;"><td><div style="height:1px;"></div></td></tr><tr class="emp_work_note_area"><td style="border:1px solid #74A3C5;text-align:left;"><table class="pane_table" style="width:100%;"><tr><td><textarea id="empWorkTableNote" style="width:99%;height:70px;border:none;margin:0px;line-height:120%;" maxLength="32000"></textarea></td></tr></table></td></tr><tr class="emp_work_note_area" style="height:4px;"><td><div style="height:4px;"></div></td></tr><tr><td><table class="head" style="width:100%;"><thead><tr><th class="num" >#</th><th class="name" id="jobWorks_jobName_head"></th><th class="volume"><table class="meter"><tr><td colspan="13" class="title" id="meterName"></td></tr><tr><td class="edge"></td><td class="mid">0</td><td class="mid">1</td><td class="mid">2</td><td class="mid">3</td><td class="mid">4</td><td class="mid">5</td><td class="mid">6</td><td class="mid">7</td><td class="mid">8</td><td class="mid">9</td><td class="mid" style="width:20px;">10</td><td class="edge"></td></tr></table></th><th class="time XXXXX"></th>\x3c!--$$PROGRESS$$--\x3e</tr></thead></table></td></tr><tr style="height:1px;"><td></td></tr><tr><td><table class="horiz" style="width:100%;"><tr><td><div class="scroll_area disp_block" style="width:auto;" id="empWorkTableArea"><table class="data" style="width:100%;"><tbody id="empWorkTableBody"></tbody></table></div></td></tr></table></td></tr><tr><td><table class="foot" id="empWorkTableFoot" style="width:100%;"><tbody id="empWorkTableFootBody"></tbody></table></td></tr><tr class="exp_table_edit_row" style="display:none;"><td><table class="horiz" style="width:100%;"><tr class="ts-buttons-row"><td style="width:90px;text-align:left;padding-left:10px;padding-bottom:auto;"><input type="button" class="pb_btn_plusL" id="empWorkPlus" /></td><td style="text-align:center;padding-top:12px;padding-bottom:4px;"><div><button class="std-button1" id="empWorkOk" ><div></div></button><button class="std-button2" id="empWorkCancel" ><div></div></button></div></td><td style="width:90px;text-align:right;padding-top:12px;padding-right:8px;"><button class="std-button2" style="margin-left:auto;" id="empWorkOption1" ><div></div></button></td></tr></table></td></tr><tr class="exp_table_ref_row"><td><table class="horiz" style="width:100%;"><tr class="ts-buttons-row"><td style="width:90px;text-align:left;padding-top:0px;padding-bottom:auto;"></td><td style="text-align:center;padding-top:12px;padding-bottom:4px;"><div><button class="std-button2" id="empWorkClose" ><div></div></button></div></td><td style="width:90px;text-align:right;padding-top:12px;padding-right:8px;"><button class="std-button2" style="margin-left:auto;" id="empWorkOption2" ><div></div></button></td></tr></table></td></tr></table><div id="empWorkHandle"></div></div>'
,this.content=this.content.replace("\x3c!--$$PROGRESS$$--\x3e",this.progressOn?'<th class="prog">'+teasp.message.getLabel("progress_head")+"</th>":""),this.content=this.content.replace(" XXXXX",e)},teasp.dialog.WorkBalance.prototype.preStart=function(){dojo.connect(dojo.byId("empWorkOption1"),"onclick",this,this.openEmpWorkOption),dojo.connect(dojo.byId("empWorkOption2"),"onclick",this,this.openEmpWorkOption),
dojo.connect(this.dialog,"onCancel",this,this.hide),teasp.message.setLabelHtml("jobWorks_workReport_label","workReport_label"),teasp.message.setLabelHtml("jobWorks_jobName_head","task_head"),teasp.message.setLabelHtml("meterName","workVolume_head"),teasp.message.setLabelHtml("time_label"),teasp.message.setLabelTitle("empWorkPlus","tm20003010"),teasp.message.setLabelTitle("empWorkOk","save_btn_title"),
teasp.message.setLabelTitle("empWorkCancel","cancel_btn_title"),teasp.message.setLabelTitle("empWorkOption1","tm20002010"),teasp.message.setLabelTitle("empWorkClose","close_btn_title"),teasp.message.setLabelTitle("empWorkOption2","tm20002010"),dojo.byId("empWorkOk").firstChild.innerHTML=teasp.message.getLabel("save_btn_title"),dojo.byId("empWorkCancel").firstChild.innerHTML=teasp.message.getLabel("cancel_btn_title"),
dojo.byId("empWorkClose").firstChild.innerHTML=teasp.message.getLabel("close_btn_title"),dojo.byId("empWorkOption1").firstChild.innerHTML=teasp.message.getLabel("tk10005500"),dojo.byId("empWorkOption2").firstChild.innerHTML=teasp.message.getLabel("tk10005500"),this.pouch.isDeployJobSearchBox()&&this.showSearchBox()},teasp.dialog.WorkBalance.prototype.showSearchBox=function(){var e=dojo.create("div",{
className:"searchbox"},dojo.byId("jobWorks_jobName_head")),t=(dojo.create("div",{className:"loupe"},dojo.create("div",null,e)),dojo.create("input",{type:"text",placeholder:teasp.message.getLabel("tf10008560"),maxLength:80},dojo.create("div",null,e))),e=dojo.create("div",null,e);dojo.create("div",{className:"clear",style:"display:none;"},e),/iPad|iPhone/.test(navigator.userAgent)?(this.watchTimer=null,
this.watchValue=null,dojo.connect(t,"onblur",this,this.watchOff),dojo.connect(t,"onkeyup",this,this.watchOn)):dojo.connect(t,"onkeyup",this,this.filterJob),dojo.connect(t,"onpaste",this,this.filterDelay),dojo.connect(t,"oncut",this,this.filterDelay),dojo.connect(e,"onclick",this,this.clearFilter)},teasp.dialog.WorkBalance.prototype.watchOn=function(){var e=dojo.query("#jobWorks_jobName_head input");
e&&e.length&&e[0].value!=this.watchValue&&(this.filterJob(),this.watchValue=e[0].value,this.watchTimer||(this.watchTimer=window.setInterval(dojo.hitch(this,this.watchOn),500)))},teasp.dialog.WorkBalance.prototype.watchOff=function(){this.watchTimer&&(window.clearInterval(this.watchTimer),this.watchTimer=null)},teasp.dialog.WorkBalance.prototype.preShow=function(){this.dialog.maxRatio=1,this.CAP_MARGIN_H=54,
this.OTHER_H=163,this.NOTE_H=103,this.SCROLLL_W=30,this.inputOk=!0;for(var e,t,a,o,s=0;s<this.eventHandles1.length;s++)dojo.disconnect(this.eventHandles1[s]),delete this.eventHandles1[s];return this.eventHandles1=[],this.clearFilter(),this.isSaveAssignIfOnlyScheduled=this.args.scheduleImport,this.classifyJobWorks=this.args.classifyJobWorks,this.jobWorks=this.pouch.getJobWorks(this.classifyJobWorks),
this.orgLeftoverJobId=this.pouch.getLeftoverJobId(),teasp.util.time.setTimeFormat({form:"h:mm",round:1}),this.notApprove=null,this.pouch.isProhibitInputTimeUntilApproved()&&(e=this.pouch.getEmpDay(this.args.date),this.notApprove=e.isInputableEx()),dojo.query(".emp_work_note_area").forEach(function(e){dojo.style(e,"display",this.pouch.getWorkNoteOption()?"":"none")},this),dojo.query(".exp_table_ref_row").forEach(
function(e){e.style.display=this.isReadOnly()?"":"none"},this),dojo.query(".exp_table_edit_row").forEach(function(e){e.style.display=this.isReadOnly()?"none":""},this),dojo.byId("empWorkDate").innerHTML=teasp.util.date.formatDate(this.args.date,"JP1"),this.args.workRealTime?dojo.byId("empWorkRealTime").innerHTML=teasp.message.getLabel("tm20002030")+teasp.util.time.timeValue(this.args.workRealTime)+(
this.args.zanteiFlag?teasp.message.getLabel("tm20002040"):""):dojo.byId("empWorkRealTime").innerHTML="",dojo.byId("empWorkTableNote").value=this.args.workNote||this.pouch.getWorkNoteTemplate()||"",dojo.byId("empWorkTableNote").readOnly=!!this.isReadOnly(),dojo.style(dojo.byId("empWorkTableNote"),"background-color",this.isReadOnly()?"#eee":"#fff"),dojo.style(dojo.byId("empWorkTableNote").parentNode,"background-color",
this.isReadOnly()?"#eee":"#fff"),this.isReadOnly()||this.eventHandles1.push(dojo.connect(dojo.byId("empWorkPlus"),"onclick",this,this.showEmpJobAssign)),this.createBody(),this.setTopRightMessage(),dojo.style("empWorkDialog","min-width",780-(this.progressOn?0:101)+"px"),this.noDialog()?dojo.style("empWorkTableArea","height","auto"):(a=t=e=0,a=this.resizeHandle?(e=this.workTableHeight,t=this.dialogWidth,
this.workNoteHeight):(this.resizeHandle=new dojox.layout.ResizeHandle({resizeAxis:"xy",activeResize:!0,intermediateChanges:!0,minWidth:780-(this.progressOn?0:101),minHeight:172,targetId:"empWorkDialog"},dojo.byId("empWorkHandle")),dojo.connect(this.resizeHandle,"onResize",this,this.resizeDialog),(o=this.getLocalStorage())&&o.height&&o.width?(e=o.height,t=o.width):(e=300,t=1101-(this.progressOn?0:101),
this.sizeByRow=!0),this.NOTE_H),(o=dojo.window.getBox()).h-=this.CAP_MARGIN_H+this.OTHER_H+(this.pouch.getWorkNoteOption()?a:0),o.h<0&&(o.h=0),e>o.h&&(e=Math.max(34,o.h-10),this.areaMaxHeight=e),dojo.style("empWorkTableArea","height",e+"px"),dojo.style("empWorkDialog","width",t+"px")),dojo.style("empWorkDialog","margin","0px"),dojo.style("empWorkDialog","padding","10px 8px"),dojo.style(dojo.byId("empWorkDialog"
).parentNode,"padding","0px"),!0},teasp.dialog.WorkBalance.prototype.hide=function(){var e,t;this.watchOff(),this.noDialog()||(e=dojo.byId("empWorkTableArea"),t=dojo.byId("empWorkDialog"),this.workTableHeight=e.clientHeight,this.dialogWidth=parseInt(t.style.width,10),this.workNoteHeight=this.getDailyNoteHeight(),this.setLocalStorage({height:this.workTableHeight,width:this.dialogWidth})),
teasp.dialog.Base.prototype.hide.call(this)},teasp.dialog.WorkBalance.prototype.resizeDialog=function(e){var t,a,o,s;this.noDialog()||(t=dojo.byId("empWorkDialog").clientHeight,a=parseInt(dojo.byId("empWorkDialog").style.width,10),(s=(o=dojo.window.getBox()).h-this.CAP_MARGIN_H)<t&&(t=s),t-=this.getDailyNoteHeight()+this.OTHER_H+(dojo.isFF?6:0),(s=o.w-this.SCROLLL_W)<a&&(a=s),dojo.style("empWorkTableArea","height",
t+"px"),dojo.style("empWorkDialog","height","auto"),dojo.style("empWorkDialog","width",a+"px"),this.sizeByRow=!1)},teasp.dialog.WorkBalance.prototype.getDailyNoteHeight=function(){var t=0;return this.pouch.getWorkNoteOption()&&dojo.query(".emp_work_note_area",this.dialog.domNode).forEach(function(e){t+=e.clientHeight}),t},teasp.dialog.WorkBalance.prototype.postShow=function(){this.adjustHeight(),this.noDialog(
)||this.dialog._position()},teasp.dialog.WorkBalance.prototype.isReadOnly=function(){return this.pouch.isJobMonthFixedByDate(this.args.date)||this.pouch.isJobMonthReadOnly()||this.args.monthFix||this.args.dayFix||this.notApprove&&!this.notApprove.inputable},teasp.dialog.WorkBalance.prototype.setTopRightMessage=function(){this.pouch.isJobMonthFixedByDate(this.args.date)?dojo.byId("empWorkLockMsg"
).innerHTML=teasp.message.getLabel("tm20002070"):this.args.monthFix?dojo.byId("empWorkLockMsg").innerHTML=teasp.message.getLabel("tm20002090"):this.args.dayFix?dojo.byId("empWorkLockMsg").innerHTML=teasp.message.getLabel("tm20002080"):this.notApprove&&!this.notApprove.inputable?dojo.byId("empWorkLockMsg").innerHTML=teasp.message.getLabel("tk10001152",this.notApprove.applyName):dojo.byId("empWorkLockMsg").innerHTML=""
,this.isReadOnly()&&dojo.style("empWorkLockMsg","color","#00008b")},teasp.dialog.WorkBalance.prototype.ok=function(){if(this.inputOk){for(var e=[],t=[],a=0,o=(this.collectValue(),this.pouch.getLeftoverJobId()),s=this.jobWorks,i=this.getSumTime(),n=!1,r=0;r<s.length;r++){var l=s[r];l.copied||teasp.util.equalId(l.jobId,o)&&!l.process||!l.isAssigned&&"scheduleWorks"!=l.key||e.push({id:l.jobAssign?l.jobAssign.id:null,
jobId:l.jobId,process:l.process}),l.onlyScheduled&&this.isSaveAssignIfOnlyScheduled&&(n=!0),i<=0&&o&&teasp.util.equalId(l.jobId,o)&&!l.process&&!l.time&&!this.args.zanteiFlag||t.push({id:l.workId||null,jobId:l.jobId,time:(!this.args.zanteiFlag||l.timeFix)&&l.time||0,timeFix:l.timeFix,taskNote:l.taskNote,percent:l.percent,volume:l.volume,progress:l.progress,process:l.process,extraItem1:l.extraItem1,
extraItem2:l.extraItem2,extraItem1Name:l.extraItem1Name,extraItem2Name:l.extraItem2Name,order:++a})}var p=dojo.byId("empWorkTableNote").value.trim();teasp.manager.request("saveEmpWork",{empId:this.pouch.getEmpId(),month:this.args.jobMonth,startDate:this.args.date,jobs:e,works:t,workNote:p||null,isSaveAssign:n},this.pouch,{hideBusy:!1},this,function(){this.onfinishfunc(this.classifyJobWorks,p),this.close()},function(e
){teasp.message.alertError(e)})}},teasp.dialog.WorkBalance.prototype.createBody=function(){for(var e=0;e<this.eventHandles2.length;e++)dojo.disconnect(this.eventHandles2[e]),delete this.eventHandles2[e];this.eventHandles2=[];for(e=0;e<this.slider.length;e++)this.slider[e].destroyRecursive();for(this.slider=[],e=0;e<this.sliderRules.length;e++)this.sliderRules[e].destroyRecursive();this.sliderRules=[];for(
var t=dojo.byId("empWorkTableBody"),a=(dojo.empty(t),this.jobWorks.length),o=0;o<a;o++)this.sliderEventIgnore[o]=!0,this.createRow(t,o,this.jobWorks[o]);for(a||dojo.create("div",{innerHTML:teasp.message.getLabel("tm20003040"),style:"margin:4px;"},dojo.create("td",null,dojo.create("tr",null,t))),this.adjustHeight(),o=0;o<a;o++)this.isReadOnly()?this.slider[o].readOnly=!0:this.eventHandles2.push(dojo.connect(
this.slider[o],"onChange",this,function(){var e=o;return function(){this.sliderChanged(this.slider[e])}}())),this.slideInit[o]||(this.sliderEventIgnore[o]=!1);var s=dojo.byId("empWorkTableFootBody"),s=(dojo.empty(s),dojo.create("tr",null,s)),i=(dojo.create("div",{style:"margin-left:24px;text-align:left;",innerHTML:teasp.message.getLabel("total_label")},dojo.create("td",null,s)),dojo.create("div",{
id:"empWorkTotalTime",style:"text-align:center;"},dojo.create("td",{className:"time"},s)),this.progressOn?"blankr1":"blankr3");dojo.create("td",{className:i},s),this.showTime(),this.filterJob()},teasp.dialog.WorkBalance.prototype.adjustHeight=function(){if(!this.noDialog()&&this.sizeByRow){for(var e=dojo.byId("empWorkTableBody"),t=0,a=0;a<e.rows.length;a++){for(var o=28,s=0;s<e.rows[a].cells.length;s++){
var i=e.rows[a].cells[s].clientHeight;o<i&&(o=i)}t+=o}this.areaMaxHeight&&(t=Math.min(t,this.areaMaxHeight)),dojo.style("empWorkTableArea","height",Math.min(t,300)+"px")}},teasp.dialog.WorkBalance.prototype.createRow=function(e,t,a){this.percents[t]=a.percent;var o=0,s=this.pouch.getLeftoverJobId();this.pouch.getWorkInputType()==teasp.constant.INPUT_VOLUME_FIX||a.jobAssign&&!a.process&&s&&teasp.util.equalId(
a.jobAssign.jobId,s)&&!a.copied?a.timeFix=!(o=2):this.pouch.isWorkInputTimeFix(!0)&&(o=1,a.timeFix=!0);var s=dojo.create("tr",{className:t%2==0?"even":"odd",style:""},e),i=dojo.create("td",{style:"width:auto;"},s),e=dojo.create("div",{style:{margin:"2px",width:"19px",display:"table-cell"},innerHTML:""+(t+1)},i),n=(dojo.create("input",{type:"hidden",id:"empWorkSeq"+t,value:""+a.seq},i),this.duplable&&(n=dojo.create(
"div",{style:{margin:"2px 2px 2px 0px",display:"table-cell"}},i),a.copied?(r=dojo.create("div",{className:"pp_base pp_work_delete",title:teasp.message.getLabel("delete_btn_title")},n),this.eventHandles2.push(dojo.connect(r,"onclick",this,this.deleteCopiedWorkRow(t)))):(r=dojo.create("div",{className:"pp_base pp_work_copy",title:teasp.message.getLabel("tk10000297")},n),this.eventHandles2.push(dojo.connect(r,"onclick",
this,this.copyWorkRow(t))))),a.jobName+(a.process?teasp.message.getLabel("tm10001470")+a.process:"")),r=(e=dojo.create("div",{className:"name",style:{margin:"2px",textAlign:"left",wordBreak:"break-all",display:"table-cell",width:"auto"},innerHTML:n},i),dojo.create("input",{type:"hidden",value:this.convertStr(n)},i),0),n=(r=this.progressOn?501:400,r-=this.noDialog()?0:15,i=dojo.create("td",{style:{width:r+"px"}},s),
dojo.create("div",{style:{margin:"6px 2px",width:"244px",float:"left"}},i)),s=(e=dojo.create("div",{id:"empWorkSlider"+t,style:{width:"238px",marginLeft:"2px",marginRight:"2px"}},n),this.sliderRules[t]=new dijit.form.HorizontalRule({count:11,style:{height:"2px"}},dojo.create("div",null,e)),this.slider[t]=new dijit.form.HorizontalSlider({name:"empWorkSlider"+t,value:0,minimum:0,maximum:a.timeFix?120:1e3,
discreteValues:a.timeFix?121:1001,intermediateChanges:!0,style:{width:"238px",textAlign:"center",marginLeft:"2px",marginRight:"2px"}},e),a.timeFix?(r=Math.round(a.time/5),this.slider[t].setValue(r=120<r?120:r),this.slideInit[t]=0<r):this.slider[t].setValue(a.volume||0),dojo.create("div",{style:{margin:"6px 2px",width:"54px",float:"left"}},i)),l=dojo.create("input",{type:"text",className:"inputime"+(this.isReadOnly(
)?" inputro":""),style:{border:"1px solid #539AC7",fontSize:"12px"},id:"empInputTime"+t,maxLength:"5",value:teasp.util.time.timeValue(a.time)||"0:00"},s),n=(this.isReadOnly()&&(l.readOnly="readOnly"),this.eventHandles2.push(dojo.connect(l,"blur",this,this.onblurTime)),this.eventHandles2.push(dojo.connect(l,"onkeypress",this,this.onkeypressTime)),dojo.create("div",{style:{width:"54px",marginTop:"1px",padding:"0px",
textAlign:"center"},id:"empTimeLabel"+t,innerHTML:teasp.util.time.timeValue(a.time)||""},s)),r=(dojo.style(l,"display",a.timeFix?"":"none"),dojo.style(n,"display",a.timeFix?"none":""),a.timeFix?"pb_btn_clockon":"pb_btn_clock");e=dojo.create("div",{id:"empWorkLock"+t,style:{margin:"2px",float:"left"},className:"change_input_type pb_base "+r},i),this.isReadOnly()||o?e.style.cursor="default":this.eventHandles2.push(
dojo.connect(e,"onclick",this,this.onInputLock));if(e=dojo.create("div",{id:"empWorkNote"+t,style:{margin:"2px",float:"left",display:this.taskNoteOn?"":"none"},className:"change_input_type pb_base pb_btn_tasknote"},i),this.eventHandles2.push(dojo.connect(e,"onclick",this,this.openTaskNote(a,t))),this.progressOn){var p=this.pouch.getProgressList(),s=dojo.create("div",{style:{margin:"2px",width:"92px",float:"left"}},i)
,d=dojo.create("select",{style:{width:"92px"},id:"empWorkProgress"+t,className:this.isReadOnly()?"inputro":""},s);dojo.create("option",{value:"",innerHTML:""},d);for(var c=0;c<p.length;c++)dojo.create("option",{value:p[c],innerHTML:p[c]},d);d.value=a.progress,this.isReadOnly()&&(d.disabled=!0)}e=dojo.create("div",{style:{clear:"both"}},i);for(var m=this.pouch.getExtraItems(a),c=0;c<m.length;c++){var h,u=m[c];u&&(
h=dojo.create("div",{style:{margin:"2px",float:"left"}},i),dojo.create("div",{style:{margin:"4px 4px 4px 2px",float:"left"},innerHTML:u.name||""},h),dojo.create("input",{type:"hidden",id:"empWorkExtName"+(c+1)+t,value:u.name||""},h),l=dojo.create("input",{type:"text",id:"empWorkExtItem"+(c+1)+t,style:{margin:"2px",width:u.width+"px"},maxLength:u.length,className:"inputran"+(this.isReadOnly()?" inputro":""),
value:u.value||""},h),this.isReadOnly()&&(l.readOnly="readOnly"))}0<m.length&&(e=dojo.create("div",{style:{clear:"both"}},i));n=this.pouch.convNoteString(teasp.util.entitize(a.taskNote,""));dojo.create("div",{id:"empWorkTaskNote"+t,style:{margin:"2px",textAlign:"left",display:n?"":"none"},innerHTML:n},i),dojo.create("input",{type:"hidden",id:"empWorkTaskNoteH"+t,value:a.taskNote||""},i)},
teasp.dialog.WorkBalance.prototype.onblurTime=function(e){teasp.util.time.inputSupportTime(e.target),this.moveSlider(e.target)},teasp.dialog.WorkBalance.prototype.onkeypressTime=function(e){""==e.keyChar&&13==e.keyCode&&(teasp.util.time.inputSupportTime(e.target),this.moveSlider(e.target),e.preventDefault(),e.stopPropagation())},teasp.dialog.WorkBalance.prototype.onInputLock=function(e){var t,a,e=e||window.event,
e=e.target||e.srcElement,o=/empWorkLock(\d+)/.exec(e.id);o&&(o=parseInt(o[1],10),a=!this.isLockedRow(o),dojo.toggleClass(e,"pb_btn_clock",!a),dojo.toggleClass(e,"pb_btn_clockon",a),dojo.style("empInputTime"+o,"display",a?"":"none"),dojo.style("empTimeLabel"+o,"display",a?"none":""),e=this.slider[o].getValue(),this.slider[o].maximum=a?120:1e3,this.slider[o].discreteValues=a?121:1001,a?"number"==typeof(
a=teasp.util.time.clock2minutes(dojo.byId("empTimeLabel"+o).innerHTML))?((t=dojo.byId("empInputTime"+o)).value=teasp.util.time.timeValue(a||0),this.moveSlider(t)):(a=Math.round(120*e/1e3),this.slider[o].setValue(a),dojo.byId("empInputTime"+o).value=teasp.util.time.timeValue(a/5),this.showTime()):(this.slider[o].setValue(Math.round(1e3*e/120)),this.showTime()))},
teasp.dialog.WorkBalance.prototype.openTaskNote=function(e,t){var a=e,o=t;return function(){teasp.manager.dialogOpen("TaskNote",{title:a.jobName+(a.process?teasp.message.getLabel("tm10001470")+a.process:""),note:a.taskNote||"",date:this.args.date,readOnly:this.isReadOnly()},this.pouch,this,function(e){a.taskNote=e.note;e=this.pouch.convNoteString(teasp.util.entitize(a.taskNote,""));dojo.byId("empWorkTaskNote"+o
).innerHTML=e,dojo.byId("empWorkTaskNoteH"+o).value=a.taskNote,dojo.style("empWorkTaskNote"+o,"display",e?"":"none"),this.adjustHeight()})}},teasp.dialog.WorkBalance.prototype.copyWorkRow=function(e){var a=e;return function(){this.collectValue();var e=dojo.clone(this.jobWorks[a]);e.work=null,e.workId=null,e.time=0,e.volume=0,e.percent=0,e.progress=null,e.taskNote=null,e.extraItem1=null,e.extraItem2=null,
e.jobAssign&&(e.jobAssign.id=null),e.seq=teasp.sequence.jobWork++,teasp.util.equalId(e.jobId,this.pouch.getLeftoverJobId())&&!e.process&&(e.timeFix=!0),e.copied=!0,this.jobWorks.splice(a+1,0,e);for(var t=0;t<this.jobWorks.length;t++)this.jobWorks[t].order=t+1;this.createBody()}},teasp.dialog.WorkBalance.prototype.deleteCopiedWorkRow=function(e){var t=e;return function(){this.collectValue(),this.jobWorks.splice(t,1);
for(var e=0;e<this.jobWorks.length;e++)this.jobWorks[e].order=e+1;this.createBody()}},teasp.dialog.WorkBalance.prototype.openEmpWorkOption=function(){this.collectValue();var e={},t={},a=[],o=this.pouch.getLeftoverJobId(),s=this.pouch.getLeftoverJobId(!0);this.orgLeftoverJobId=o;for(var i=0;i<this.jobWorks.length;i++){var n=this.jobWorks[i];t[n.jobId]||(t[n.jobId]=1,a.push({jobId:n.jobId,jobName:n.jobName,
flag:e[n.jobId]||0}))}teasp.manager.dialogOpen("EmpWorkOption",{empLoJobId:o,comLoJobId:s,jobs:a},this.pouch,this,function(t,e){dojo.query(".emp_work_note_area").forEach(function(e){dojo.style(e,"display",t.workNoteOption?"":"none")}),this.pouch.setWorkInputType(t.workInputType),this.pouch.setWorkNoteOption(t.workNoteOption),this.pouch.setTaskNoteOption(t.taskNoteOption),this.pouch.setLeftoverJob(e),
this.taskNoteOn=t.taskNoteOption;for(var a=0;a<this.slider.length;a++)dojo.style("empWorkNote"+a,"display",t.taskNoteOption?"":"none");this.args.reflectWorkOption&&this.args.reflectWorkOption.apply(this.args.thisObject),t.changeLeftoverJob&&setTimeout(dojo.hitch(this,this.ok),100)})},teasp.dialog.WorkBalance.prototype.sliderChanged=function(e){if(!this.sliderBusy){this.sliderBusy=!0;e=/empWorkSlider(\d+)/.exec(e.id),
e=parseInt(e?e[1]:null,10);if("number"!=typeof e||isNaN(e))this.sliderBusy=!1;else{if(this.sliderEventIgnore[e])return this.sliderEventIgnore[e]=!1,void(this.sliderBusy=!1);this.isLockedRow(e)&&(dojo.byId("empInputTime"+e).value=teasp.util.time.timeValue(5*this.slider[e].getValue())),this.showTime(),this.sliderBusy=!1}}},teasp.dialog.WorkBalance.prototype.showEmpJobAssign=function(){this.collectValue();
var t=dojo.hitch(this,function(){teasp.manager.dialogOpen("EmpJobAssign",{empId:this.pouch.getEmpId(),date:this.args.date,classifyJobWorks:this.classifyJobWorks},this.pouch,this,function(e){for(var t={},a=0;a<this.jobWorks.length;a++)(e=(e=t[o=(p=this.jobWorks[a]).jobId+(p.process?"\t"+p.process:"")])||(t[o]={jobId:p.jobId,process:p.process,lst:[]})).lst.push({time:p.time,volume:p.volume,timeFix:p.timeFix});
this.classifyJobWorks=dojo.clone(this.pouch.getClassifyJobWorks(this.args.date,!0)),this.onfinishfunc(this.classifyJobWorks,null,!0),this.isSaveAssignIfOnlyScheduled=!1,this.args.reflectJobAssign&&this.args.reflectJobAssign(this.classifyJobWorks),this.jobWorks=this.pouch.getJobWorks(this.classifyJobWorks);var o,s={};for(o in t)for(var i=(e=t[o]).lst||[],n=0;n<i.length;n++)if(!(l=i[n]).done)for(
a=0;a<this.jobWorks.length;a++){var r=(p=this.jobWorks[a]).jobId+(p.process?"\t"+p.process:"");if(!s[a]&&o==r){p.time=l.time,p.volume=l.volume,p.timeFix=l.timeFix,s[a]=1,l.done=!0;break}}for(o in t)for(var l,i=(e=t[o]).lst||[],n=0;n<i.length;n++)if(!(l=i[n]).done)for(a=0;a<this.jobWorks.length;a++){var p=this.jobWorks[a];if(!s[a]&&e.jobId==p.jobId){p.time=l.time,p.volume=l.volume,p.timeFix=l.timeFix,s[a]=1,l.done=!0;
break}}this.createBody()})});this.args.client==teasp.constant.APPLY_CLIENT_EMP_WORK||this.pouch.getObj().dayMap?t():teasp.manager.request("loadEmpMonthDelay",{empId:this.pouch.getEmpId(),date:this.args.date},this.pouch,{hideBusy:!1},this,function(e){t()},function(e){teasp.message.alertError(e)})},teasp.dialog.WorkBalance.prototype.isLockedRow=function(e,t){if(t){var a=this.pouch.getLeftoverJobId();if(a
)return t.jobId!=a}t=dojo.byId("empWorkLock"+e);return dojo.hasClass(t,"pb_btn_clockon")||dojo.hasClass(t,"pb_btn_clockon_dis")},teasp.dialog.WorkBalance.prototype.moveSlider=function(e){var t=/(\d+)/.exec(e.id);t&&(t=parseInt(t[1],10),""==e.value&&(e.value=teasp.util.time.timeValue(0)),120<(e="number"==typeof(e=teasp.util.time.clock2minutes(e.value))&&0<e?Math.round(e/5):0)&&(e=120),this.sliderEventIgnore[t]=!0,
this.slider[t].setValue(e)),this.showTime()},teasp.dialog.WorkBalance.prototype.getSumVolume=function(){for(var e=0,t=0;t<this.slider.length;t++)this.isLockedRow(t)||(e+=this.slider[t].getValue());return e},teasp.dialog.WorkBalance.prototype.getSumTime=function(){for(var e=0,t=0;t<this.slider.length;t++)this.isLockedRow(t)&&(e+=teasp.util.time.clock2minutes(dojo.byId("empInputTime"+t).value));return e},
teasp.dialog.WorkBalance.prototype.getTime=function(e,t,a){return this.isLockedRow(e)?teasp.util.time.clock2minutes(dojo.byId("empInputTime"+e).value):a&&0<a?Math.round(a*t/1e3):null},teasp.dialog.WorkBalance.prototype.getVolume=function(e,t){var a;return this.isLockedRow(e)?(a=teasp.util.time.clock2minutes(dojo.byId("empInputTime"+e).value),0<t?Math.round(1e3*a/t):0):this.slider[e].getValue()},
teasp.dialog.WorkBalance.prototype.getCurrentTotalTime=function(){var e=this.getSumTime(),t=this.getSumVolume();return{total:!(0<this.args.workRealTime&&0<t)||this.args.workRealTime<e?e:this.args.workRealTime,fixTime:e,volume:t}},teasp.dialog.WorkBalance.prototype.showTime=function(){for(var e=this.getCurrentTotalTime(),e=(dojo.byId("empWorkTotalTime").innerHTML=teasp.util.time.timeValue(e.total),
this.args.workRealTime==e.total),t=(this.isReadOnly()||(this.collectValue(),this.pouch.isCheckInputWorkHours()&&this.args.worked&&!this.args.zanteiFlag&&(this.inputOk=e)),this.pouch.isCheckInputWorkHours()&&this.inputBlock(e),!1),a=0;a<this.jobWorks.length;a++)if((o=this.jobWorks[a]).timeFix&&o.time){t=!0;break}for(var o,s,i,a=0;a<this.jobWorks.length;a++)(o=this.jobWorks[a]).timeFix||(s=dojo.byId("empTimeLabel"+a),
i=0,o.timeFix||this.args.worked||this.args.zanteiFlag||(i=!t&&o.perDisp&&0<o.per100?2:1),o.volume?s.innerHTML=0==i?teasp.util.time.timeValue(o.time||0):2==i?o.per100.toFixed(0)+"%":teasp.message.getLabel("tm20002050"):s.innerHTML="-",dojo.toggleClass(s,"time-label",0==i),dojo.toggleClass(s,"volume-label",1==i),dojo.toggleClass(s,"percent-label",2==i))},teasp.dialog.WorkBalance.prototype.inputBlock=function(e){
var e=!e,t=dojo.query("#empWorkTableFootBody .time")[0];dojo.style(t,"background-color",e?"#ffc0cb":"transparent"),dojo.byId("empWorkTotalTime").title=e?teasp.message.getLabel("tf10008580"):"",this.isReadOnly()||(t=dojo.byId("empWorkOk"),dojo.toggleClass(t,"std-button1",this.inputOk),dojo.toggleClass(t,"std-button1-disabled",!this.inputOk),this.inputOk?(t.title=teasp.message.getLabel("save_btn_title"),dojo.byId(
"empWorkLockMsg").innerHTML=""):(t.title=teasp.message.getLabel("tf10008580"),dojo.byId("empWorkLockMsg").innerHTML=teasp.message.getLabel("tf10008580"),dojo.style("empWorkLockMsg","color","red")))},teasp.dialog.WorkBalance.prototype.getJobWorkBySeq=function(e){for(var t=0;t<this.jobWorks.length;t++)if(this.jobWorks[t].seq==e)return this.jobWorks[t];return null},
teasp.dialog.WorkBalance.prototype.getJobWorkByIndex=function(e){for(var t=0;t<this.jobWorks.length;t++)if(this.jobWorks[t].index==e)return this.jobWorks[t];return null},teasp.dialog.WorkBalance.prototype.collectValue=function(){for(var e,t=this.getSumVolume(),a=this.getSumTime(),o=this.args.workRealTime-a,s=[],i={},n=0,r=[],l=0;l<this.slider.length;l++){var p,d=this.progressOn&&dojo.byId("empWorkProgress"+l
).value||null,c=this.taskNoteOn&&dojo.byId("empWorkTaskNoteH"+l).value||null,m=this.getJobWorkBySeq(dojo.byId("empWorkSeq"+l).value),h=dojo.byId("empWorkExtName1"+l),u=dojo.byId("empWorkExtName2"+l),g=dojo.byId("empWorkExtItem1"+l),y=dojo.byId("empWorkExtItem2"+l);g&&(m.extraItem1Name=h.value||null,m.extraItem1=g.value||null),y&&(m.extraItem2Name=u.value||null,m.extraItem2=y.value||null),this.isLockedRow(l,m)?(p=0<(
h=this.getTime(l))?this.getVolume(l,a):0,m.index=l,m.volume=p,m.percent=0,m.per100=0,m.perDisp=!1,m.time=h,m.timeFix=!0,m.progress=d,m.taskNote=c):(p=this.getVolume(l),u=g=0,u=(g=(p=0<a&&!p&&this.pouch.getLeftoverJobId()==m.jobId&&this.pouch.getLeftoverJobId()!=this.orgLeftoverJobId?100:p)?Math.round(1e3*p/t):0)?Math.round(g/10):0,(y=this.getTime(l,g,o))<0&&(y=0),m.index=l,m.volume=p,m.percent=g,m.per100=u,
m.perDisp=!0,m.time=y,m.timeFix=!1,m.progress=d,m.taskNote=c,0<g&&(s.push(l),i[l]={percent:g,per100:u},n+=g,0)),r.push(m)}1<s.length&&((m=r[e=s[s.length-1]]).percent-=n-1e3,m.per100=Math.round(m.percent/10),m.time=this.getTime(e,m.percent,this.args.workRealTime-a)),this.pouch.adjustJobWorkTimes(r,this.args.workRealTime,!0)},teasp.dialog.WorkBalance.prototype.filterDelay=function(e){setTimeout(dojo.hitch(this,
this.filterJob),10)},teasp.dialog.WorkBalance.prototype.filterJob=function(e){var t,a,o,s,i,n,r,l=dojo.query("#jobWorks_jobName_head input");l&&l.length&&(t=dojo.query("#jobWorks_jobName_head div.clear")[0],l=l[0].value,a=(a=this.convertStr(l)).replace(/[.+?^=!:${}()|[\]\/%\\]/g,"\\$&"),i=(s=a).split(" ").filter(Boolean).map(function(e){return e.replace(/^\*+|\*+$/g,"")}).map(function(e){return e.replace(/\*/g,".*")}
).map(function(e){return-1!==s.indexOf(" ")?"(?=.*"+e+")":e}).join(""),-1!==s.indexOf(" ")&&(i+=".*"),o=i,dojo.style(t,"display",a?"":"none"),r=n=0,dojo.query("#empWorkTableBody tr").forEach(function(t){dojo.query('div.name + input[type="hidden"]',t).forEach(function(e){r++;e=e.value;a&&!e.match(o)?dojo.style(t,"display","none"):(dojo.style(t,"display",""),n++)})}),0<r&&this.displayNoMatch(n,l))},
teasp.dialog.WorkBalance.prototype.displayNoMatch=function(e,t){var a=dojo.byId("empWorkTableBody"),o=dojo.query("div.no-match",a),t=e?"":teasp.message.getLabel("tf10008570",t);o.length?(e||(o[0].innerHTML=t),dojo.style(o[0],"display",e?"none":"")):e||dojo.create("div",{innerHTML:t,className:"no-match"},a)},teasp.dialog.WorkBalance.prototype.clearFilter=function(e){var t=dojo.query("#jobWorks_jobName_head input");
t&&t.length&&(t[0].value="",t[0].focus(),this.filterJob())},teasp.dialog.WorkBalance.prototype.convertStr=function(e){var e=e.replace(/(?![＊])[！-～]/g,function(e){return String.fromCharCode(e.charCodeAt(0)-65248)}),t=(e=e.replace(/”/g,'"').replace(/’/g,"'").replace(/‘/g,"`").replace(/￥/g,"\\").replace(/¥/g,"\\").replace(/〜/g,"~").replace(/　/g," ").toUpperCase()).replace(/^\s+|\s+$/g,"");return t||e},teasp.provide(
"teasp.dialog.TaskNote"),teasp.dialog.TaskNote=function(){this.width=530,this.height=210,this.title=teasp.message.getLabel("workReport_label"),this.id="TaskNoteDialog",this.duration=1,
this.content='<table class="pane_table" style="width:460px;"><tr><td style="vertical-align:top;text-align:left;"><div id="TaskNoteLabel" style="margin:4px;"></div></td></tr><tr><td style="vertical-align:top;text-align:center;"><textarea name="TaskNoteText" id="TaskNoteText" style="width:500px;height:100px;" class="inputarea" maxLength="32000"></textarea></td></tr><tr id="TaskNoteCtlRow1" class="ts-buttons-row"><td style="text-align:center;padding-top:10px;"><div><button class="std-button1" id="TaskNoteOk" ><div></div></button><button class="std-button2" id="TaskNoteCancel" ><div></div></button></div></td></tr><tr id="TaskNoteCtlRow2" class="ts-buttons-row"><td style="text-align:center;padding-top:10px;"><div><button class="std-button2" id="TaskNoteClose" ><div></div></button></div></td></tr></table>'
,this.okLink={id:"TaskNoteOk",callback:this.ok},this.cancelLink={id:"TaskNoteCancel",callback:this.hide},this.closeLink={id:"TaskNoteClose",callback:this.hide},this.eventHandles=[]},teasp.dialog.TaskNote.prototype=new teasp.dialog.Base,teasp.dialog.TaskNote.prototype.preShow=function(){for(var e=0;e<this.eventHandles.length;e++)dojo.disconnect(this.eventHandles[e]),delete this.eventHandles[e];
return this.eventHandles=[],dojo.byId("TaskNoteDialog_title").innerHTML=teasp.util.date.formatDate(this.args.date,"M/d")+" "+teasp.message.getLabel("workReport_label"),dojo.style("TaskNoteCtlRow1","display",this.args.readOnly?"none":""),dojo.style("TaskNoteCtlRow2","display",this.args.readOnly?"":"none"),dojo.byId("TaskNoteLabel").innerHTML=this.args.title,dojo.byId("TaskNoteText").value=this.args.note,dojo.byId(
"TaskNoteOk").firstChild.innerHTML=teasp.message.getLabel("ok_btn_title"),dojo.byId("TaskNoteCancel").firstChild.innerHTML=teasp.message.getLabel("cancel_btn_title"),dojo.byId("TaskNoteClose").firstChild.innerHTML=teasp.message.getLabel("close_btn_title"),dojo.byId("TaskNoteText").readOnly=this.args.readOnly?"readOnly":"",dojo.toggleClass(dojo.byId("TaskNoteText"),"inputro",this.args.readOnly),!0},
teasp.dialog.TaskNote.prototype.ok=function(){this.hide(),this.onfinishfunc({note:dojo.byId("TaskNoteText").value})},teasp.provide("teasp.dialog.MessageBox"),teasp.dialog.MessageBox=function(){this.id="messageBoxDialog",this.duration=1,
this.content='<table id="messageBoxTable"><tr><td class="message_area"><div id="messageBoxMessage"></div><div id="messageBoxCheck"></div></td></tr><tr id="messageBoxErrorRow" style="display:none;"><td><div id="messageBoxError"></div></td></tr><tr class="ts-buttons-row"><td><div><button class="std-button1" id="messageBoxOk"><div></div></button><button class="std-button2" id="messageBoxCancel"><div></div></button></div></td></tr></table>'
,this.checkSeq=0,this.okLink={id:"messageBoxOk",callback:this.ok},this.cancelLink={id:"messageBoxCancel",callback:this.cancel}},teasp.dialog.MessageBox.prototype=new teasp.dialog.Base,teasp.dialog.MessageBox.prototype.preShow=function(){dojo.byId("messageBoxMessage").innerHTML=this.args.message||"",this.args.title?(dojo.byId("messageBoxDialog_title").innerHTML=this.args.title,dojo.query(".dijitDialogTitleBar",
"messageBoxDialog").forEach(function(e){this.args.defaultTitleColor||(e.style.backgroundColor=this.args.titleBgColor||"#fef263"),e.title=this.args.title},this)):(this.widthHint=0,dojo.query(".dijitDialogTitleBar",this.dialog.id)[0].style.display="none",this.dialog._position=dojo.hitch(this.dialog,function(){var e=this.domNode.style;e.left="20px",e.top="4px"}));var e,t=dojo.byId("messageBoxCheck"),a=(dojo.empty(t),
this.args.check||{});for(e in a)if(a.hasOwnProperty(e)){var o,s,i=a[e],n=dojo.create("div",{className:void 0===i.checked?"ts_message":"ts_check"},t),r=n;if(i.bullet&&(dojo.create("div",{style:"display:inline-block;vertical-align:top;",innerHTML:teasp.message.getLabel("tf10009790")},n),n=dojo.create("div",{style:"display:inline-block;width:95%;"},n)),void 0===i.checked?n.appendChild(dojo.doc.createTextNode(" "+(
i.title||""))):(i.seq=++this.checkSeq,o=dojo.create("label",null,n),s=dojo.create("input",{type:"checkbox",id:"messageBoxCheck"+i.seq},o),o.appendChild(dojo.doc.createTextNode(" "+(i.title||""))),this.args.hint&&(dojo.create("div",{className:"pp_base pp_icon_help"},dojo.create("div",{style:"display:inline-block;margin-left:10px;",id:"messageBoxHint"+i.seq},n)),new dijit.Tooltip({connectId:"messageBoxHint"+i.seq,
label:this.args.hint,position:["below"]})),s.checked=i.checked),i.style)for(var l in i.style)dojo.style(r,l,i.style[l])}var p=this.args.radios;if(p)for(var d=0;d<p.length;d++){var c=p[d],m=dojo.byId(c.id);if(m&&c.checked){m.checked=!0;break}}return this.args.closeOnly?(dojo.style("messageBoxOk","display","none"),dojo.style("messageBoxCancel","margin-left","0px")):(dojo.style("messageBoxOk","display",""),dojo.style(
"messageBoxCancel","margin-left","16px")),dojo.byId("messageBoxOk").firstChild.innerHTML=teasp.message.getLabel("ok_btn_title"),dojo.byId("messageBoxCancel").firstChild.innerHTML=teasp.message.getLabel(this.args.closeOnly?"close_btn_title":"cancel_btn_title"),dojo.style("messageBoxTable","width",teasp.isNarrow()?"100%":this.args.dialogWidth||"410px"),teasp.isNarrow()&&dojo.style("messageBoxTable","border",
"1px solid #ccc"),this.showError(null),!0},teasp.dialog.MessageBox.prototype.cancel=function(){this.hide(),this.args.closeFunc&&this.args.closeFunc()},teasp.dialog.MessageBox.prototype.ok=function(){if(this.hide(),this.args.radios){for(var e=this.args.radios,t=null,a=0;a<e.length;a++){var o=e[a],s=dojo.byId(o.id);if(s&&s.checked){t=o;break}}this.onfinishfunc(t)}else{var i,n,r,l=this.args.check||{};for(i in l
)l.hasOwnProperty(i)&&(n=l[i],r=dojo.byId("messageBoxCheck"+n.seq),n.checked=r?r.checked:null);this.onfinishfunc(l)}},teasp.dialog.MessageBox.prototype.showError=function(e){dojo.style("messageBoxErrorRow","display",e?"":"none"),dojo.byId("messageBoxError").innerHTML=e?e.entitize():""},teasp.provide("teasp.dialog.BulkInput"),teasp.dialog.BulkInput=function(){this.width=550,this.height=210,this.id="bulkInputDialog",
this.title=teasp.message.getLabel("tk10004040"),this.duration=1,
this.content='<table class="pane_table"><tr><td style="vertical-align:top;text-align:left;width:500px;"><div style="width:240px;display:table-cell;" id="bulkInputL"></div><div style="width:10px;display:table-cell;"></div><div style="width:240px;display:table-cell;" id="bulkInputR"></div></td></tr><tr><td><div id="bulkInputError"></div></td></tr><tr><td style="text-align:center;padding-top:10px;padding-bottom:4px;"><input type="button" value="" id="bulkInputCopy" style="padding:4px 12px;margin-right:8px;" /><label style="margin-right:8px;"><input type="checkbox" id="bulkInputDayFix" /><span id="spanBulkInputDayFix"></span></label><input type="button" value="" id="bulkInputOk" style="padding:4px 12px;margin-right:8px;" /><input type="button" value="" id="bulkInputCancel" style="padding:4px 12px;margin-left:8px;" /></td></tr></table>'
,this.checkSeq=0,this.orgValues={},this.dateList=[],this.okLink={id:"bulkInputOk",callback:this.ok},this.cancelLink={id:"bulkInputCancel",callback:this.hide}},teasp.dialog.BulkInput.prototype=new teasp.dialog.Base,teasp.dialog.BulkInput.prototype.preStart=function(){teasp.message.setLabelEx("spanBulkInputDayFix","tk10004050"),dojo.byId("bulkInputOk").value=teasp.message.getLabel("tk10004060"),dojo.byId(
"bulkInputCancel").value=teasp.message.getLabel("close_btn_title"),dojo.byId("bulkInputCopy").value="先頭値ｺﾋﾟｰ",dojo.connect(dojo.byId("bulkInputCopy"),"click",this,this.copy)},teasp.dialog.BulkInput.prototype.preShow=function(){for(var e=dojo.byId("bulkInputL");e.firstChild;)dojo.destroy(e.firstChild);for(var t=dojo.byId("bulkInputR");t.firstChild;)dojo.destroy(t.firstChild);e.style.border="1px solid #4F8AB6",
t.style.border="1px solid #4F8AB6",this.dateList=this.pouch.getMonthDateList();for(var a=0,o=(this.orgValues={},Math.ceil(this.dateList.length/2)),s=0;s<this.dateList.length;s++){var i=this.dateList[s],n=this.pouch.isAlive(i),r=this.pouch.getEmpDay(i),l=r.isExistApply(teasp.constant.APPLY_KEY_DAILY),p=teasp.util.date.parseDate(i),d=""+p.getDate(),c=(a!=p.getMonth()+1&&(d=p.getMonth()+1+"/"+d,a=p.getMonth()+1),s<o?e:t
),m=r.getDayType(),m=(m=3!=r.getHolidayFlag()&&!r.isPlannedHoliday()?m:4)?"rowcl"+m:s%2==0?"even":"odd",m=dojo.create("div",{className:m},c),c=(dojo.create("div",{innerHTML:d,style:{margin:"4px 2px 2px 2px"}},dojo.create("div",{style:{width:"50px",textAlign:"right",float:"left"}},m)),dojo.create("div",{innerHTML:teasp.util.date.formatDate(i,"JPW"),style:{margin:"4px 2px 2px 2px"}},dojo.create("div",{style:{
width:"24px",textAlign:"center",float:"left"}},m)));0==p.getDay()&&(c.style.color="red"),6==p.getDay()&&(c.style.color="blue"),n&&!l&&r.isInputable()&&(d=dojo.create("input",{type:"text",className:"inputime roundBegin",style:{padding:"1px",border:"1px solid #8C8C8C"},id:"bulkInputS"+i},dojo.create("div",{style:{margin:"2px",float:"left"}},m)),p=dojo.create("input",{type:"text",className:"inputime roundEnd",style:{
padding:"1px",border:"1px solid #8C8C8C"},id:"bulkInputE"+i},dojo.create("div",{style:{margin:"2px",float:"left"}},m)),d.value=this.orgValues["S"+i]=r.getStartTime(!1,null,teasp.constant.C_REAL)||"",p.value=this.orgValues["E"+i]=r.getEndTime(!1,null,teasp.constant.C_REAL)||"",this.colorTimeBackground(d,r,"S"),this.colorTimeBackground(p,r,"E"),dojo.connect(d,"blur",this,function(e){teasp.util.time.onblurTime(e),
this.onchange(e)}),dojo.connect(d,"onkeypress",this,function(e){teasp.util.time.onkeypressTime(e),13===e.keyCode&&this.onchange(e)}),dojo.connect(p,"blur",this,function(e){teasp.util.time.onblurTime(e),this.onchange(e)}),dojo.connect(p,"onkeypress",this,function(e){teasp.util.time.onkeypressTime(e),13===e.keyCode&&this.onchange(e)})),dojo.create("div",{style:{width:"48px",margin:"4px 2px 2px 2px",float:"left"},
id:"bulkInputP"+i},m),dojo.create("div",{style:{clear:"both"}},m)}return teasp.util.showErrorArea(null,"bulkInputError"),!0},teasp.dialog.BulkInput.prototype.onchange=function(e){var t,a=/bulkInput(.)(.+)/.exec(e.target.id);a&&(t=a[1],a=a[2],this.setInputStatus(t,a,e.target))},teasp.dialog.BulkInput.prototype.setInputStatus=function(e,t,a){var o=a.value,o=(a.style.borderColor=this.orgValues[e+t]!=o?"red":"#8C8C8C",
this.colorTimeBackground(a,this.pouch.getEmpDay(t),e),teasp.util.time.clock2minutes(a.value)),a=teasp.util.time.clock2minutes(dojo.byId("bulkInput"+("S"==e?"E":"S")+t).value);"number"==typeof o&&"number"==typeof a&&("S"==e&&a<=o||"E"==e&&o<=a)?this.setLineStatus(t,-1,teasp.message.getLabel("tk10004070")):this.setLineStatus(t)},teasp.dialog.BulkInput.prototype.colorTimeBackground=function(e,t,a){a=("S"==a?t.getObj(
).pushStartTime:t.getObj().pushEndTime)||null,t=teasp.util.time.clock2minutes(e.value);e.style.backgroundColor="number"!=typeof t||"number"==typeof a&&a==t?"#ffffff":"#ffffc6"},teasp.dialog.BulkInput.prototype.setLineStatus=function(e,t,a){t?t<0?(dojo.byId("bulkInputP"+e).innerHTML="error",dojo.byId("bulkInputP"+e).title=a||"",dojo.byId("bulkInputP"+e).style.color="red"):1==t?(dojo.byId("bulkInputP"+e
).innerHTML="inputing",dojo.byId("bulkInputP"+e).style.color="red"):2==t&&(dojo.byId("bulkInputP"+e).innerHTML="ok",dojo.byId("bulkInputP"+e).style.color="blue",dojo.byId("bulkInputS"+e).style.borderColor="#8C8C8C",dojo.byId("bulkInputE"+e).style.borderColor="#8C8C8C",this.orgValues["S"+e]=dojo.byId("bulkInputS"+e).value,this.orgValues["E"+e]=dojo.byId("bulkInputE"+e).value):(dojo.byId("bulkInputP"+e).innerHTML="",
dojo.byId("bulkInputP"+e).title="",dojo.byId("bulkInputP"+e).style.color="black")},teasp.dialog.BulkInput.prototype.copy=function(){for(var e=null,t=null,a=0;a<this.dateList.length;a++){var o,s,i=this.dateList[a],n=dojo.byId("bulkInputS"+i),r=dojo.byId("bulkInputE"+i);n&&r&&(o=n.value,s=r.value,e?(n.value=e,this.setInputStatus("S",i,n)):e=o,t?(r.value=t,this.setInputStatus("E",i,r)):t=s)}},
teasp.dialog.BulkInput.prototype.ok=function(){for(var a=[],e=0;e<this.dateList.length;e++){var t=this.dateList[e],o=this.pouch.getEmpDay(t),s=dojo.byId("bulkInputS"+t),i=dojo.byId("bulkInputE"+t);s&&i&&(s=s.value,i=i.value,dojo.byId("bulkInputP"+t).innerHTML="",this.orgValues["S"+t]==s&&this.orgValues["E"+t]==i||(s=teasp.util.time.clock2minutes(s),(i=teasp.util.time.clock2minutes(i))<=s?this.setLineStatus(t,-1,
teasp.message.getLabel("tk10004080")):(a.push({funcName:"inputTimeTable",params:{empId:this.pouch.getEmpId(),month:this.pouch.getYearMonth(),startDate:this.pouch.getStartDate(),lastModifiedDate:this.pouch.getLastModifiedDate(),mode:this.pouch.getMode(),dayFix:!1,date:t,timeTable:o.createTimeTable(s,i,!0),refreshWork:!1}}),dojo.byId("bulkInputDayFix").checked&&a.push({funcName:"applyEmpDay",params:{
empId:this.pouch.getEmpId(),month:this.pouch.getYearMonth(),startDate:this.pouch.getStartDate(),lastModifiedDate:this.pouch.getLastModifiedDate(),date:t,client:"monthly",apply:{id:null,applyType:teasp.message.getLabel("applyDaily_label"),patternId:null,holidayId:null,status:null,startDate:t,endDate:t,exchangeDate:null,startTime:null,endTime:null,note:null,contact:null}}}))))}a.length<=0?teasp.util.showErrorArea(
teasp.message.getLabel("tk10001133"),"bulkInputError"):(teasp.util.showErrorArea(null,"bulkInputError"),this.setLineStatus(a[0].params.date,1),teasp.manager.dialogOpen("BusyWait"),teasp.action.contact.remoteMethods(a,{nowait:!0,errorAreaId:"bulkInputError"},function(e,t){console.log("------------------("+t+")"),console.log(e),console.log("------------------"),this.setLineStatus(a[t].params.date,2),
this.pouch.setLastModifiedDate(e.lastModifiedDate),t<a.length-1?(a[t+1].params.lastModifiedDate=this.pouch.getLastModifiedDate(),this.setLineStatus(a[t+1].params.date,1)):teasp.manager.request("transEmpMonth",{empId:a[t].params.empId,month:a[t].params.month,startDate:a[t].params.startDate},this.pouch,{hideBusy:!0},this,function(e){teasp.manager.dialogClose("BusyWait"),this.onfinishfunc(),this.hide()},function(e){
teasp.manager.dialogClose("BusyWait"),teasp.util.showErrorArea(e,"bulkInputError")})},function(e,t){teasp.manager.dialogClose("BusyWait"),this.setLineStatus(a[t].params.date,-1,teasp.message.getErrorMessage(e)),teasp.util.showErrorArea(e,"bulkInputError")},this))},teasp.provide("teasp.dialog.BulkOverTime"),teasp.dialog.BulkOverTime=function(){this.id="dialogBulkZangyo",this.title="",this.duration=1,
this.content='<table id="dialogBulkZangyoTable" class="empApply2Table"><tr><td class="bulkZangyoTop"></td></tr><tr><td class="bulkZangyoBody"><div><div class="empApply2Div"><div class="empApply2CL" id="dialogBulkZangyoLabel1"></div><div class="empApply2VL"><table><tbody><tr><td><input type="text" class="inputab inpudate" id="dialogBulkZangyoDate1"></td><td><input type="button" id="dialogBulkZangyoCal1" class="pp_base pp_btn_cal"></td><td style="vertical-align: middle;"><div id="dialogBulkZangyoLabel2"></div></td><td><input type="text" class="inputab inpudate" id="dialogBulkZangyoDate2"></td><td><input type="button" id="dialogBulkZangyoCal2" class="pp_base pp_btn_cal"></td></tr></tbody></table></div></div><div class="empApply2Div"><div class="empApply2CL" id="dialogBulkZangyoLabel3"></div><div class="empApply2VL"><table><tbody><tr><td><input type="text" id="dialogBulkZangyoTime" class="inputime inputab" maxlength="5"></td><td id="dialogBulkZangyoLabel4"></td></tr></tbody></table></div></div><div class="empApply2Div"><div class="empApply2CL" id="dialogBulkZangyoLabel5"></div><div class="empApply2VL" id="dialogBulkZangyoNote"><textarea class="noteArea inputab"></textarea></div></div></div></td></tr><tr id="dialogBulkZangyoError" style="display:none;"><td><div></div></td></tr><tr id="dialogBulkZangyoCtrl1" class="ts-buttons-row"><td><div><button class="std-button1" id="dialogBulkZangyoOk"><div></div></button><button class="std-button2" id="dialogBulkZangyoCancel"><div></div></button></div></td></tr></table>'
,this.okLink={id:"dialogBulkZangyoOk",callback:this.ok},this.cancelLink={id:"dialogBulkZangyoCancel",callback:this.hide},this.eventHandles=[]},teasp.dialog.BulkOverTime.prototype=new teasp.dialog.Base,teasp.dialog.BulkOverTime.prototype.preShow=function(){for(var e=0;e<this.eventHandles.length;e++)dojo.disconnect(this.eventHandles[e]),delete this.eventHandles[e];this.eventHandles=[],this.showError(),
this.valueWidth=Math.min(window.innerWidth-50,370)+"px",dojo.byId("dialogBulkZangyo_title").innerHTML=teasp.message.format(teasp.message.getLabel("tf10005130",this.args.applyType==teasp.constant.APPLY_TYPE_ZANGYO?teasp.message.getLabel("overTime_head"):teasp.message.getLabel("tf10005140"))),dojo.byId("dialogBulkZangyoLabel1").innerHTML=teasp.message.getLabel("range_label"),dojo.byId("dialogBulkZangyoLabel2"
).innerHTML=teasp.message.getLabel("wave_label"),dojo.byId("dialogBulkZangyoLabel3").innerHTML=this.args.applyType==teasp.constant.APPLY_TYPE_ZANGYO?teasp.message.getLabel("tf10005160"):teasp.message.getLabel("tf10005170"),dojo.byId("dialogBulkZangyoLabel4").innerHTML=teasp.message.getLabel("tf10008780"),dojo.byId("dialogBulkZangyoLabel5").innerHTML=teasp.message.getLabel("note_head");
var a=this.range=this.pouch.getDateRangeOfMonth(this.args.date,1,0),t=(dojo.query('input[type="button"].pp_base').forEach(function(e){this.eventHandles.push(dojo.connect(e,"onclick",this,function(e){var e=e.target,t=e.id.substring(e.id.length-1),e=teasp.util.date.parseDate(dojo.byId("dialogBulkZangyoDate"+t).value);teasp.manager.dialogOpen("Calendar",{date:e,isDisabledDateFunc:function(e){
return 0<teasp.util.date.compareDate(a.from,e)||teasp.util.date.compareDate(a.to,e)<0}},null,this,function(e){dojo.byId("dialogBulkZangyoDate"+t).value=teasp.util.date.formatDate(e,"SLA")})}))},this),dojo.byId("dialogBulkZangyoDate1").value=teasp.util.date.formatDate(this.args.date,"SLA"),dojo.byId("dialogBulkZangyoDate2").value=teasp.util.date.formatDate(this.args.date,"SLA"),dojo.byId("dialogBulkZangyoTime"));
return t.value="",this.eventHandles.push(dojo.connect(t,"blur",this,teasp.util.time.onblurTime)),this.eventHandles.push(dojo.connect(t,"onkeypress",this,teasp.util.time.onkeypressTime)),dojo.query("#dialogBulkZangyoNote textarea")[0].value="",dojo.byId("dialogBulkZangyoOk").firstChild.innerHTML=teasp.message.getLabel(this.pouch.isUseWorkFlow()?"applyx_btn_title":"fix_btn_title"),dojo.byId("dialogBulkZangyoCancel"
).firstChild.innerHTML=teasp.message.getLabel("cancel_btn_title"),teasp.isNarrow()?(dojo.style("dialogBulkZangyoTable","width","100%"),dojo.style("dialogBulkZangyoTable","border","1px solid #ccc")):dojo.style("dialogBulkZangyoTable","width","530px"),dojo.style("dialogBulkZangyoNote","width",this.valueWidth),!0},teasp.dialog.BulkOverTime.prototype.showError=function(e){dojo.style("dialogBulkZangyoError","display",
e?"":"none"),dojo.query("#dialogBulkZangyoError div")[0].innerHTML=e},teasp.dialog.BulkOverTime.prototype.getTargets=function(e,t){for(var a=[],o=e,s=this.args.applyType==teasp.constant.APPLY_TYPE_ZANGYO?0:1;o<=(t||e);){var i=this.pouch.getObj().days[o],n=i.rack&&i.rack.holidayJoin&&i.rack.holidayJoin.flag||0,r=i.rack&&i.rack.validApplys||null;(0!=i.dayType||i.plannedHoliday)&&(!r||!r.kyushtu.length
)||!s&&2&n||!s&&r&&r.zangyo.length||!s&&r&&r.earlyEnd||!s&&i.rack&&"number"==typeof i.rack.fixEndTime&&2880<=i.rack.fixEndTime||s&&1&n||s&&r&&r.earlyStart.length||s&&r&&r.lateStart||s&&i.rack&&"number"==typeof i.rack.fixStartTime&&i.rack.fixStartTime<=0||r&&r.dailyFix||i.interim||a.push(i),o=teasp.util.date.addDays(o,1)}return a},teasp.dialog.BulkOverTime.prototype.ok=function(){this.showError();var e,t,
a=teasp.util.strToDate(dojo.byId("dialogBulkZangyoDate1").value),o=teasp.util.strToDate(dojo.byId("dialogBulkZangyoDate2").value);0!=a.failed?this.showError(dojo.replace(a.tmpl,[teasp.message.getLabel("rangeStartDate_label")])):0!=o.failed?this.showError(dojo.replace(o.tmpl,[teasp.message.getLabel("rangeEndDate_label")])):(dojo.byId("dialogBulkZangyoDate1").value=a.dater,dojo.byId("dialogBulkZangyoDate2"
).value=o.dater,a.datef>o.datef?this.showError(teasp.message.getLabel("tm10003300")):teasp.util.date.compareDate(a.date,this.range.from)<0||0<teasp.util.date.compareDate(o.date,this.range.to)?this.showError(teasp.message.getLabel("tk10001185")):void 0===(e=teasp.util.time.clock2minutes(dojo.byId("dialogBulkZangyoTime").value))||e<=0?this.showError(teasp.message.getLabel("tf10005150",teasp.message.getLabel(
this.args.applyType==teasp.constant.APPLY_TYPE_ZANGYO?"tf10005160":"tf10005170"))):(t=dojo.query("#dialogBulkZangyoNote textarea")[0].value,!this.pouch.isRequireNote(teasp.constant.APPLY_TYPE_ZANGYO)||t&&t.replace(/[\s　]+$/g,"")?(a=this.getTargets(a.datef,o.datef)).length?(teasp.manager.dialogOpen("BusyWait"),this.applyBulkZangyo(e,t,a,dojo.hitch(this,function(e,t){e=e?null:t;e&&this.showError(e),this.finish(e)}))
):this.showError(teasp.message.getLabel("tf10005180",teasp.message.getLabel(this.args.applyType==teasp.constant.APPLY_TYPE_ZANGYO?"tm10001293":"tm10001294"))):this.showError(teasp.message.getLabel("tm10003680"))))},teasp.dialog.BulkOverTime.prototype.finish=function(t){teasp.action.contact.transEmpMonth({empId:this.pouch.getEmpId(),month:this.pouch.getYearMonth()},this.pouch,this,function(e){
teasp.manager.dialogClose("BusyWait"),this.onfinishfunc(),t||this.close()},function(e){teasp.manager.dialogClose("BusyWait"),t||this.showError(teasp.message.getErrorMessage(e))})},teasp.dialog.BulkOverTime.prototype.getLastApplyId=function(e,t){for(var a=[],o=e.rack&&e.rack.allApplys||[],s=0;s<o.length;s++){var i=o[s];i.applyType==t&&a.push(i)}return 0<(a=1<a.length?a.sort(function(e,t){
return e.applyTime<t.applyTime?1:-1}):a).length?a[0].id:null},teasp.dialog.BulkOverTime.prototype.getAfterFlag=function(e,t){var a=teasp.util.date.getToday();return teasp.util.date.parseDate(teasp.util.date.formatDate(e)+" "+teasp.util.time.timeValue(t)).getTime()<=a.getTime()},teasp.dialog.BulkOverTime.prototype.applyBulkZangyo=function(e,t,a,o){this.applyEmpDay({time:e,note:t,lst:a,callback:o},0)},
teasp.dialog.BulkOverTime.prototype.applyEmpDay=function(t,a){var e,o,s,i;a>=t.lst.length?t.callback(!0):(e=t.lst[a],i=o=this.args.applyType==teasp.constant.APPLY_TYPE_ZANGYO?e.rack.fixEndTime:e.rack.fixStartTime,this.args.applyType==teasp.constant.APPLY_TYPE_ZANGYO?i=teasp.logic.EmpTime.getReachTime(o,e.pattern.restTimes||[],t.time):o=teasp.logic.EmpTime.getReachTimeReverse(i,e.pattern.restTimes||[],t.time),(
2880<i||i<0)&&(i=2880),o<0&&(o=0),s=this.args.applyType==teasp.constant.APPLY_TYPE_ZANGYO?i:o,i={empId:this.pouch.getEmpId(),month:this.pouch.getYearMonth(),lastModifiedDate:this.pouch.getLastModifiedDate(),date:e.date,apply:{id:this.getLastApplyId(e,this.args.applyType),applyType:this.args.applyType,patternId:null,holidayId:null,status:null,startDate:e.date,endDate:e.date,exchangeDate:null,startTime:o,endTime:i,
note:t.note,contact:null,afterFlag:this.getAfterFlag(e.date,o)}},console.log(i),teasp.action.contact.remoteMethod("applyEmpDay",i,dojo.hitch(this,function(e){"OK"==e.result?(this.pouch.setLastModifiedDate(e.lastModifiedDate),this.checkDirect(t,s,a)):t.callback(!1,teasp.message.getErrorMessage(e))}),dojo.hitch(this,function(e){t.callback(!1,teasp.message.getErrorMessage(e))})))},
teasp.dialog.BulkOverTime.prototype.checkDirect=function(t,e,a){var o,s=t.lst[a],i=this.pouch.getEmpDay(s.date),n=i.getEmpApplyByKey(teasp.constant.APPLY_KEY_DIRECT),r=i.getEmpApplyByKey(teasp.constant.APPLY_KEY_KYUSHTU),n=n&&n.directFlag||r&&r.directFlag||0,r=this.args.applyType==teasp.constant.APPLY_TYPE_ZANGYO?2:1;n&r?(n=i.getStartTime(!0,null,teasp.constant.C_REAL)||null,o=i.getEndTime(!0,null,
teasp.constant.C_REAL)||null,i=i.createTimeTable(1&r?e:n,2&r?e:o),n={empId:this.pouch.getEmpId(),month:this.pouch.getYearMonth(),lastModifiedDate:this.pouch.getLastModifiedDate(),mode:this.pouch.getMode(),date:s.date,dayFix:!1,timeTable:i,refreshWork:!0,clearWork:!1},console.log(n),teasp.action.contact.remoteMethod("inputTimeTable",n,dojo.hitch(this,function(e){"OK"==e.result?(this.pouch.setLastModifiedDate(
e.lastModifiedDate),this.applyEmpDay(t,a+1)):t.callback(!1,teasp.message.getErrorMessage(e))}),dojo.hitch(this,function(e){t.callback(!1,teasp.message.getErrorMessage(e))}))):this.applyEmpDay(t,a+1)},teasp.provide("teasp.dialog.RestInput"),teasp.dialog.RestInput=function(){this.id="dialogRestInput",this.title="",this.duration=1,
this.content='<table id="dialogRestInputTable"><tr><td class="restInputTop"></td></tr><tr><td class="restInputBody"><table><tbody><tr><td><div class="restInputLabel"></div></td><td><table><tbody><tr><td><div class="restInputArea"><table><tbody id="dialogRestInputBody"></tbody></table></div></td><td class="restInputPlus"><input type="button" id="dialogRestInputAdd" class="pb_base pb_btn_plus"></td></tr></tbody></table></td></tr></tbody></table></td></tr><tr id="dialogRestInputError" style="display:none;"><td><div></div></td></tr><tr id="dialogRestInputNote" style="display:none;"><td><div></div><div></div></td></tr><tr class="ts-buttons-row"><td><div><button class="std-button1" id="dialogRestInputOk"><div></div></button><button class="std-button2" id="dialogRestInputCancel"><div></div></button><button class="std-button2" id="dialogRestInputClose"><div></div></button></div></td></tr></table>'
,this.okLink={id:"dialogRestInputOk",callback:this.ok},this.cancelLink={id:"dialogRestInputCancel",callback:this.hide},this.closeLink={id:"dialogRestInputClose",callback:this.hide},this.eventHandles=[]},teasp.dialog.RestInput.prototype=new teasp.dialog.Base,teasp.dialog.RestInput.prototype.preShow=function(){for(var e=0;e<this.eventHandles.length;e++)dojo.disconnect(this.eventHandles[e]),delete this.eventHandles[e];
this.eventHandles=[],this.showError(),dojo.byId("dialogRestInput_title").innerHTML=teasp.message.getLabel("tf10007280"),dojo.query("#dialogRestInputTable div.restInputLabel")[0].innerHTML=teasp.message.getLabel("restTime_label"),dojo.byId("dialogRestInputOk").firstChild.innerHTML=teasp.message.getLabel("ok_btn_title"),dojo.byId("dialogRestInputCancel").firstChild.innerHTML=teasp.message.getLabel("cancel_btn_title"),
dojo.byId("dialogRestInputClose").firstChild.innerHTML=teasp.message.getLabel("close_btn_title"),dojo.style("dialogRestInputOk","display",this.args.fix?"none":""),dojo.style("dialogRestInputCancel","display",this.args.fix?"none":""),dojo.style("dialogRestInputClose","display",this.args.fix?"":"none"),dojo.style(dojo.byId("dialogRestInputTable").parentNode,"background-color",this.args.fix?"#eee":"white"),
this.args.fix?dojo.byId("dialogRestInputAdd").className="pb_base pb_btn_plus_dis":(dojo.byId("dialogRestInputAdd").className="pb_base pb_btn_plus",this.eventHandles.push(dojo.connect(dojo.byId("dialogRestInputAdd"),"onclick",this,this.insertRestRow)));var t=dojo.byId("dialogRestInputBody");dojo.empty(t);for(var a=(a=this.args.rests||[]).sort(function(e,t){return("number"==typeof e.from?e.from:e.to)-(
"number"==typeof t.from?t.from:t.to)}),e=0;e<a.length;e++)e>=t.rows.length&&this.insertRestRow(),(row=t.rows[e]).cells[0].firstChild.value=this.pouch.getDisplayTime(a[e].from),row.cells[2].firstChild.value=this.pouch.getDisplayTime(a[e].to);for(;t.rows.length<5;)this.insertRestRow();return teasp.isNarrow()?dojo.style("dialogRestInputTable","width","100%"):dojo.style("dialogRestInputTable","width","270px"),dojo.style(
"dialogRestInputNote","display",this.args.note?"":"none"),this.args.note&&(dojo.query("#dialogRestInputNote div")[0].innerHTML=teasp.message.getLabel("tk10000611"),dojo.query("#dialogRestInputNote div")[1].innerHTML=this.args.note),!0},teasp.dialog.RestInput.prototype.insertRestRow=function(){var e,t,a,o=this.args.fxtimes,s=dojo.byId("dialogRestInputBody");10<=s.rows.length||(e=dojo.create("tr",null,s),t=dojo.create(
"td",{style:{paddingTop:"1px"}},e),a=dojo.create("input",{type:"text",value:"",maxlength:"5",style:{margin:"0px"},className:(this.args.fix?"inputro":"inputran")+" inputime roundBegin"},t),this.args.fix?a.readOnly=!0:(a.readOnly=!1,this.eventHandles.push(dojo.connect(a,"blur",this,teasp.util.time.onblurTime)),this.eventHandles.push(dojo.connect(a,"onkeypress",this,teasp.util.time.onkeypressTime)),dojo.attr(a,"fxtimes"
,o)),dojo.create("td",{innerHTML:teasp.message.getLabel("wave_label"),width:"20px",style:{paddingTop:"1px",textAlign:"center"}},e),t=dojo.create("td",{style:{paddingTop:"1px"}},e),a=dojo.create("input",{type:"text",value:"",maxlength:"5",style:{margin:"0px"},className:(this.args.fix?"inputro":"inputran")+" inputime roundEnd"},t),this.args.fix?a.readOnly=!0:(a.readOnly=!1,this.eventHandles.push(dojo.connect(a,"blur",
this,teasp.util.time.onblurTime)),this.eventHandles.push(dojo.connect(a,"onkeypress",this,teasp.util.time.onkeypressTime)),dojo.attr(a,"fxtimes",o)),t=dojo.create("td",{width:"66px",style:{paddingTop:"1px",paddingLeft:"12px",textAlign:"center"}},e),dojo.create("input",{type:"button",className:"pp_base pp_btn_del"+(this.args.fix?"_dis":""),style:{cursor:this.args.fix?"pointer":"default"},title:teasp.message.getLabel(
"delete_menu"),onclick:this.args.fix?function(){}:dojo.hitch(this,function(e){var t,a,o=((e=e||window.event).srcElement||e.target).parentNode.parentNode;"TR"==o.tagName&&(e=o.cells[0].firstChild.value.trim(),t=o.cells[2].firstChild.value.trim(),e=""!=e?teasp.util.time.clock2minutes(e):null,t=""!=t?teasp.util.time.clock2minutes(t):null,a=function(){dojo.byId("dialogRestInputAdd").className="pb_base pb_btn_plus",
dojo.byId("dialogRestInputBody").deleteRow(o.rowIndex)},null!=e||null!=t?teasp.manager.dialogOpen("MessageBox",{title:teasp.message.getLabel("em10002080"),message:teasp.message.getLabel("tm10003940")},this.pouch,this,function(){a()}):a())})},t),!this.args.fix&&10<=s.rows.length&&(dojo.byId("dialogRestInputAdd").className="pb_base pb_btn_plus_dis"))},teasp.dialog.RestInput.prototype.showError=function(e){dojo.style(
"dialogRestInputError","display",e?"":"none"),dojo.query("#dialogRestInputError div")[0].innerHTML=e},teasp.dialog.RestInput.prototype.ok=function(){this.showError();for(var e=[],t=dojo.byId("dialogRestInputBody"),a=0,s=0;s<t.rows.length;s++){var i=t.rows[s],n=teasp.util.time.clock2minutes(i.cells[0].firstChild.value),i=teasp.util.time.clock2minutes(i.cells[2].firstChild.value);if(
"number"==typeof n||"number"==typeof i){if((o={from:"number"==typeof n?n:null,to:"number"==typeof i?i:null}).type=teasp.constant.REST_FIX,e.push(o),null===o.from||null===o.to||o.from>=o.to||2880<o.to)return void this.showError(teasp.message.getLabel("tk10001096"));a+=o.to-o.from}}if(e.length){var e=e.sort(function(e,t){return("number"==typeof e.from?e.from:e.to)-("number"==typeof t.from?t.from:t.to)}),
r=teasp.util.time.margeTimeSpans(e);if(teasp.util.time.rangeTime({from:0,to:2880},r)<a)return void this.showError(teasp.message.getLabel("tm10001480"))}this.dialog.hide(),this.onfinishfunc(e)},teasp.provide("teasp.dialog.ApplySelect"),teasp.dialog.ApplySelect=function(){this.title=teasp.message.getLabel("tk10004330"),this.inited=!1,this.opend=!1,this.dialog=null,this.id="dialogApplySelect",
this.content='<div id="applySelectBody"><div style="width:712px;"><div style="float:left;margin-left:4px;margin-right:4px;"><div style="float:left;margin-left:4px;margin-right:4px;padding-top:2px;" id="columnApplySelectApplyNo"></div><div style="float:left;padding-top:1px;margin-right:4px;"><input type="text" id="applySelectApplyNo" value="" class="inputran" style="width:70px;padding:1px 2px;" /></div><div style="clear:both;"></div></div><div style="float:left;margin-left:4px;margin-right:4px;padding-top:2px;"><div style="float:left;margin-left:4px;margin-right:4px;padding-top:2px;" id="columnApplySelectType"></div><div style="float:left;padding-top:1px;margin-right:4px;"><select id="applySelectType" /></select></div><div style="clear:both;"></div></div><div style="float:left;margin-left:4px;margin-right:4px;padding-top:2px;"><div style="float:left;margin-left:4px;margin-right:4px;padding-top:2px;" id="columnApplySelectName"></div><div style="float:left;padding-top:1px;margin-right:4px;"><input type="text" id="applySelectName" value="" class="inputran" style="width:70px;padding:1px 2px;" /></div><div style="clear:both;"></div></div><div style="float:left;margin-left:4px;margin-right:4px;padding-top:2px;"><div style="float:left;margin-left:4px;margin-right:4px;padding-top:2px;" id="columnApplySelectOwner"></div><div style="float:left;padding-top:1px;margin-right:4px;"><input type="text" id="applySelectOwner" value="" class="inputran" style="width:70px;padding:1px 2px;" /></div><div style="clear:both;"></div></div><div style="float:left;"><input type="button" id="applySelectSearch" value="" style="padding:1px 8px;" /></div><div style="clear:both;"></div><div id="applySelectPageArea" style="margin-top:6px;"><div id="applySelectPage" style="margin-left:10px;"></div></div><table class="stone_table" style="margin-top:4px;"><tr><td class="head" style="width:20px;"></td><td class="head" id="applySelectThead1" style="width:100px;"><div style="display:table;margin:auto;"><div style="margin:2px;" id="applySelectHead1"></div></div></td><td class="head" id="applySelectThead2" style="width:110px;"><div style="display:table;margin:auto;"><div style="margin:2px;" id="applySelectHead2"></div></div></td><td class="head" id="applySelectThead3" style="width:170px;"><div style="display:table;margin:auto;"><div style="margin:2px;" id="applySelectHead3"></div></div></td><td class="head" id="applySelectThead4" style="width:90px;"><div style="display:table;margin:auto;"><div style="margin:2px;" id="applySelectHead4"></div></div></td><td class="head" id="applySelectThead5" style="width:120px;"><div style="display:table;margin:auto;"><div style="margin:2px;" id="applySelectHead5"></div></div></td><td class="head" id="applySelectThead6" style="width:100px;"><div style="display:table;margin:auto;"><div style="margin:2px;" id="applySelectHead6"></div></div></td></tr></table><div class="stone_div" id="applySelectDiv" style="width:710px;border:1px solid #cccccc;display:table;"><table class="stone_table"><tbody id="applySelectTbody"></tbody></table></div></div><div id="applySelectErrorArea"></div><table border="0" cellpadding="0" cellspacing="0" style="width:696px;margin-top:8px;margin-bottom:4px;"><tr><td style="text-align:right;"><input type="button" id="applySelectOk" value="" style="width:74px;margin-right:24px;padding:2px 4px;" /></td><td style="text-align:left;"><input type="button" id="applySelectCancel" value="" style="width:74px;margin-left:24px;padding:2px 4px;" /></td></tr></table></div>'
,this.eventHandles={},this.onSearch=null,this.onSelect=null,this.searchObj=null,this.targets=null,this.searchResult=null,this.maxDivH=216,this.rowMax=20,this.sortMap={1:"ApplicationNo__c",2:"Type__c",3:"Name",4:"Owner.Name",5:"CreatedDate",6:"ApplicationDate__c"}},teasp.dialog.ApplySelect.prototype=new teasp.dialog.Base,teasp.dialog.ApplySelect.prototype.ready=function(){this.param=this.args.param,
this.onSearch=this.args.onSearch,this.onSelect=this.args.onSelect},teasp.dialog.ApplySelect.prototype.preStart=function(){dojo.byId("applySelectOk").disabled=!0;var e=dojo.byId("applySelectType"),t=this.param.types;dojo.create("option",{value:"",innerHTML:teasp.message.getLabel("tk10004480")},e);for(var a=0;a<t.length;a++)dojo.create("option",{value:t[a][0],innerHTML:t[a][1]},e);dojo.byId("applySelectSearch"
).value=teasp.message.getLabel("search_btn_title"),dojo.byId("applySelectOk").value=teasp.message.getLabel("select_btn_title"),dojo.byId("applySelectCancel").value=teasp.message.getLabel("cancel_btn_title"),teasp.message.setLabelEx("columnApplySelectApplyNo","tk10004310"),teasp.message.setLabelEx("columnApplySelectType","tk10000262"),teasp.message.setLabelEx("columnApplySelectName","tk10004320"),
teasp.message.setLabelEx("columnApplySelectOwner","tk10000067"),teasp.message.setLabelEx("applySelectHead1","tk10004310"),teasp.message.setLabelEx("applySelectHead2","tk10000262"),teasp.message.setLabelEx("applySelectHead3","tk10004320"),teasp.message.setLabelEx("applySelectHead4","tk10000067"),teasp.message.setLabelEx("applySelectHead5","applyTime_label"),teasp.message.setLabelEx("applySelectHead6","tk10004340"),
dojo.connect(dojo.byId("applySelectSearch"),"onclick",this,function(){teasp.util.showErrorArea(null,"applySelectErrorArea"),this.searchObj={action:"searchApplySimple",applyNo:dojo.byId("applySelectApplyNo").value||null,type:dojo.byId("applySelectType").value||null,name:dojo.byId("applySelectName").value||null,owner:dojo.byId("applySelectOwner").value||null,pageNo:1,rowMax:this.rowMax,
errorAreaId:"applySelectErrorArea"},this.onSearch(this.searchObj,this.searchRes(),this.searchError())}),dojo.connect(dojo.byId("applySelectOk"),"onclick",this,this.ok),dojo.connect(dojo.byId("applySelectCancel"),"onclick",this,function(){this.close()}),dojo.connect(dojo.byId("applySelectThead1"),"onclick",this,this.clickHead(1)),dojo.connect(dojo.byId("applySelectThead2"),"onclick",this,this.clickHead(2)),
dojo.connect(dojo.byId("applySelectThead3"),"onclick",this,this.clickHead(3)),dojo.connect(dojo.byId("applySelectThead4"),"onclick",this,this.clickHead(4)),dojo.connect(dojo.byId("applySelectThead5"),"onclick",this,this.clickHead(5)),dojo.connect(dojo.byId("applySelectThead6"),"onclick",this,this.clickHead(6))},teasp.dialog.ApplySelect.prototype.preShow=function(){return teasp.util.showErrorArea(null,
"applySelectErrorArea"),this.refresh(this.searchResult),!0},teasp.dialog.ApplySelect.prototype.postShow=function(){this.adjustHeight();var e=dojo.byId("applySelectDiv");e.scrollTop&&(e.scrollTop=0)},teasp.dialog.ApplySelect.prototype.ok=function(){for(var e=dojo.byId("applySelectTbody"),t=0;t<e.rows.length;t++){var a=e.rows[t].cells[0].firstChild;if(a.checked){a={targets:this.targets,id:a.nextSibling.value,
applyNo:a.nextSibling.nextSibling.value,type:a.nextSibling.nextSibling.nextSibling.value,name:a.nextSibling.nextSibling.nextSibling.nextSibling.value};this.onSelect(a),this.close();break}}},teasp.dialog.ApplySelect.prototype.searchRes=function(){return dojo.hitch(this,function(e){this.refresh.apply(this,[e])})},teasp.dialog.ApplySelect.prototype.searchError=function(){return dojo.hitch(this,function(e){
this.receiveError.apply(this,[e])})},teasp.dialog.ApplySelect.prototype.refresh=function(e){for(var t=(this.searchResult=e)&&e.applyList||[],e=(teasp.logic.convert.excludeNameSpace(t),dojo.byId("applySelectOk").disabled=!0,dojo.byId("applySelectApplyNo").value=e&&e.applyNo||"",dojo.byId("applySelectType").value=e&&e.type||"",dojo.byId("applySelectName").value=e&&e.name||"",dojo.byId("applySelectOwner"
).value=e&&e.owner||"",e&&(this.setPaging(dojo.byId("applySelectPage"),e),this.displaySort(e)),(e||this).rowMax),a=t.length<e?t.length:e,o=(a<12&&(a=12),dojo.byId("applySelectTbody"));o.firstChild;)dojo.destroy(o.firstChild);for(var s=0;s<a;s++){var i,n=s<t.length?t[s]:null,r=dojo.create("tr",{className:"sele "+(s%2==0?"even":"odd")},o),l=(dojo.connect(r,"ondblclick",this,this.ok),dojo.create("td",{style:{
width:"22px",textAlign:"center",border:"none"}},r));n?(i=dojo.create("input",{type:"radio",name:"applySelectRadio"},l),dojo.connect(i,"onclick",this,function(e){dojo.byId("applySelectOk").disabled=!1}),dojo.create("input",{type:"hidden",value:n.Id},l),dojo.create("input",{type:"hidden",value:n.ApplicationNo__c},l),dojo.create("input",{type:"hidden",value:n.Type__c},l),dojo.create("input",{type:"hidden",value:n.Name},
l)):dojo.create("div",{innerHTML:"&nbsp;"},l),(l=dojo.create("td",{width:"102px",style:{border:"none"}},r)).style.textAlign="left",dojo.create("div",{innerHTML:n&&n.ApplicationNo__c||"",style:{wordBreak:"break-all"}},l),(l=dojo.create("td",{width:"112px",style:{border:"none"}},r)).style.textAlign="left",dojo.create("div",{innerHTML:n&&n.Type__c||"",style:{wordBreak:"break-all"}},l),(l=dojo.create("td",{width:"172px",
style:{border:"none"}},r)).style.textAlign="left",dojo.create("div",{innerHTML:n&&n.Name||"",style:{wordBreak:"break-all"}},l),(l=dojo.create("td",{width:"92px",style:{border:"none"}},r)).style.textAlign="left",dojo.create("div",{innerHTML:n&&n.Owner.Name||"",style:{wordBreak:"break-all"}},l),(l=dojo.create("td",{width:"122px",style:{border:"none"}},r)).style.textAlign="left",dojo.create("div",{
innerHTML:n?teasp.util.date.formatDateTime(teasp.logic.convert.valDateTime(n.CreatedDate),"SLA-HM"):"",style:{wordBreak:"break-all"}},l),(l=dojo.create("td",{width:"86px",style:{border:"none"}},r)).style.textAlign="left",dojo.create("div",{innerHTML:n?teasp.util.date.formatDate(teasp.logic.convert.valDate(n.ApplicationDate__c),"SLA"):"",style:{wordBreak:"break-all"}},l),dojo.connect(r,"onclick",this,function(e){for(
var t=e.target;t&&"TR"!=t.nodeName;)t=t.parentNode;t&&"TR"==t.nodeName&&"INPUT"==t.cells[0].firstChild.tagName&&(t.cells[0].firstChild.checked=!0,dojo.byId("applySelectOk").disabled=!1)})}this.adjustHeight(),dojo.byId("applySelectDiv").scrollTop=0},teasp.dialog.ApplySelect.prototype.adjustHeight=function(){var e=dojo.byId("applySelectTbody");if(dojo.isIE)for(var t=0;t<e.rows.length;t++){for(var a=0,
o=0;o<e.rows[t].cells.length;o++){var s=e.rows[t].cells[o].clientHeight;a<s&&(a=s)}0}else for(t=0;t<e.rows.length;t++)e.rows[t].clientHeight;var i=dojo.byId("applySelectDiv");dojo.style(i,"display","block"),dojo.style(i,"height",this.maxDivH+"px")},teasp.dialog.ApplySelect.prototype.search=function(e){var t=e;return dojo.hitch(this,function(){this.searchObj.pageNo=t,this.onSearch(this.searchObj,this.searchRes(),
this.searchError())})},teasp.dialog.ApplySelect.prototype.clickHead=function(e){var t=e;return dojo.hitch(this,function(){var e;this.searchObj&&(e=this.sortMap[t],this.searchObj.sortKey==e?this.searchObj.sortOrder="desc"==this.searchObj.sortOrder?null:"desc":this.searchObj.sortOrder=null,this.searchObj.pageNo=1,this.searchObj.sortKey=e,this.onSearch(this.searchObj,this.searchRes(),this.searchError()))})},
teasp.dialog.ApplySelect.prototype.setPaging=function(e,t){for(;e.firstChild;)dojo.destroy(e.firstChild);var a=Math.ceil(t.cntAll/t.rowMax),o=dojo.create("div",{className:"pageDiv",innerHTML:"&lt;"},e);1<t.pageNo?(dojo.style(o,"color","blue"),dojo.style(o,"cursor","pointer"),dojo.connect(o,"onclick",this,this.search(t.pageNo-1))):dojo.style(o,"color","gray");for(var s=1;s<=a;s++){var i=dojo.create("div",{
className:"pageDiv",innerHTML:s},e);t.pageNo==s?dojo.style(i,"color","gray"):(dojo.style(i,"color","blue"),dojo.style(i,"cursor","pointer"),dojo.connect(i,"onclick",this,this.search(s)))}var o=dojo.create("div",{className:"pageDiv",innerHTML:"&gt;"},e),o=(t.pageNo<a?(dojo.style(o,"color","blue"),dojo.style(o,"cursor","pointer"),dojo.connect(o,"onclick",this,this.search(t.pageNo+1))):dojo.style(o,"color","gray"),(
t.pageNo-1)*t.rowMax+1),n=o+t.rowMax-1,r=(n>t.cntAll&&(n=t.cntAll),"");0<t.cntAll&&(r=t.cntAll<=t.rowMax?teasp.message.getLabel("tk10003230",t.cntAll):teasp.message.getLabel("tk10003240",t.cntAll,o||1,n||1)),dojo.create("div",{className:"pageDiv",style:{width:"10px",height:"2px"}},e),dojo.create("div",{innerHTML:r,style:{whiteSpace:"nowrap",display:"table",float:"left"}},e),dojo.create("div",{style:{clear:"both"}},e)
},teasp.dialog.ApplySelect.prototype.displaySort=function(o){dojo.query(".head","applySelectBody").forEach(function(e){var t,a;"TD"==e.nodeName&&e.firstChild&&(t=e.firstChild.firstChild)&&(a=t.nextSibling,this.sortMap[e.cellIndex]==o.sortKey?a?a.className="pp_base pp_ico_sort_"+(o.sortOrder?"desc":"asc"):(dojo.style(t,"float","left"),a=dojo.create("div",{className:"pp_base pp_ico_sort_"+(o.sortOrder?"desc":"asc"),
style:{float:"left",marginRight:"auto",marginTop:"4px"}},e.firstChild),dojo.create("div",{style:{clear:"both"}},e.firstChild)):a&&(a.nextSibling&&dojo.destroy(a.nextSibling),dojo.destroy(a),dojo.style(t,"float","none")))},this)},teasp.dialog.ApplySelect.prototype.receiveError=function(e){teasp.util.showErrorArea(e,"applySelectErrorArea")},teasp.provide("teasp.dialog.ChangeEmp"),teasp.dialog.ChangeEmp=function(){
this.widthHint=870,this.heightHint=434,this.id="dialogChangeEmp",this.title=teasp.message.getLabel("em10000000"),this.duration=1,
this.content='<table id="requestEdit_DialogChangeEmpTable" class="dialogApplyTable" border="0" cellspacing="0" cellpadding="0">\x3c!--tr><td id="Request_Title"></td></tr--\x3e<tr><td><div id="ChangeRequestTable"><table style="width: 100%"><tr><td id="GroupCategory" style="display:none;"><div><select style="min-width:200px;"></select></div></td><td id="ChangeRequestInfo"></td><td style="text-align: right;"><table style="margin-left:auto;margin-right:0px;"><tbody id="Buttons"></tbody></table></td></tr><tr><td colspan="2"><table style="width: 100%;"><tbody><tr><td style="width:210px;height:400px;text-align: left; padding: 0px; vertical-align: top;"><div id="RequestView" style="height: 100%; position: relative; overflow-x: hidden"><div id="RequestEvent" style="width: 100%; position: absolute;"><table style="width: 100%;"><tbody id="RequestEventTable"></tbody></table></div><div id="RequestFlow" style="width: 100%; position: absolute;"><table style="width: 100%; height: 400px;"><tbody id="RequestFlowTable"></tbody></table></div></div></td><td style="text-align: left; padding: 0px 0px 0px 10px;"><div id="ChangeRequest"><table class="requestedit_form" style="width: 100%;"><tbody id="RequestEditForm"></tbody></table></div></td></tr></tbody></table></td></tr></table></div><div id="SubmitRequestTable"><table><tbody id="SubmitRequest"></tbody></table></div></td></tr></table>'
,this.client=null,this.eventHandles={},this.applyHandle={},this.editPattern={CLEAR:0,NEW:1,EDIT:2,APPLYING:3,APPROVED:4},this.loadRequestId=null,this.showEvent=null,this.showFlow=null,this.localAutoId=1,this.requestCache={},this.saveBtnDwnFlg=!1,this.mskMyNumber=null,this.fieldList={SelectTarget:{label:teasp.message.getLabel("em10000820"),fields:[{name:"SelectTarget__c",label:teasp.message.getLabel("em10000830"),
type:"SelectTarget",isRequired:!0}]},Name:{label:teasp.message.getLabel("empName_label"),fields:[{name:"EmpName_LastName__c",label:teasp.message.getLabel("em10000910"),dataType:"String",length:80,fieldName:"LastName__c",isRequired:!0},{name:"EmpName_FirstName__c",label:teasp.message.getLabel("empName_label"),dataType:"String",length:40,fieldName:"FirstName__c"},{name:"EmpName_Kana_LastName__c",
label:teasp.message.getLabel("em10000920"),dataType:"String",length:80},{name:"EmpName_Kana_FirstName__c",label:teasp.message.getLabel("em10000260"),dataType:"String",length:40},{name:"EmpName_Document_LastName__c",label:teasp.message.getLabel("em10000930"),dataType:"String",length:80},{name:"EmpName_Document_FirstName__c",label:teasp.message.getLabel("em10000270"),dataType:"String",length:40},{
name:"EmpName_Document_Kana_LastName__c",label:teasp.message.getLabel("em10001910"),dataType:"String",length:80},{name:"EmpName_Document_Kana_FirstName__c",label:teasp.message.getLabel("em10001920"),dataType:"String",length:40}]},Address:{label:teasp.message.getLabel("em10000410"),fields:[{name:"PostalCode__c",label:teasp.message.getLabel("em10000420"),dataType:"String",length:8},{name:"State__c",
label:teasp.message.getLabel("em10000430"),dataType:"String",length:80},{name:"City__c",label:teasp.message.getLabel("em10000440"),dataType:"String",length:80},{name:"Street__c",label:teasp.message.getLabel("em10000450"),type:"TextArea",dataType:"String",length:255},{name:"State_Kana__c",label:teasp.message.getLabel("em10000460"),dataType:"String",length:80},{name:"City_Kana__c",label:teasp.message.getLabel(
"em10000470"),dataType:"String",length:80},{name:"Street_Kana__c",label:teasp.message.getLabel("em10000480"),type:"TextArea",dataType:"String",length:255}]},ResidentAddress:{label:teasp.message.getLabel("em10000840"),fields:[{name:"EqualResident__c",label:teasp.message.getLabel("em10000490"),dataType:"Boolean"},{name:"PostalCode_Resident__c",label:teasp.message.getLabel("em10000520"),dataType:"String",length:8},{
name:"State_Resident__c",label:teasp.message.getLabel("em10000530"),dataType:"String",length:80},{name:"City_Resident__c",label:teasp.message.getLabel("em10000540"),dataType:"String",length:80},{name:"Street_Resident__c",label:teasp.message.getLabel("em10000550"),type:"TextArea",dataType:"String",length:255}]},Contact:{label:teasp.message.getLabel("em10000850"),fields:[{name:"Phone__c",label:teasp.message.getLabel(
"em10000280"),dataType:"String",length:255},{name:"ExtentionNumber__c",label:teasp.message.getLabel("em10000290"),dataType:"String",length:80},{name:"MobilePhone__c",label:teasp.message.getLabel("em10000300"),dataType:"String",length:255},{name:"Email__c",label:teasp.message.getLabel("em10000310"),dataType:"String",length:255}]},SelfContact:{label:teasp.message.getLabel("em10000860"),fields:[{name:"SelfPhone__c",
label:teasp.message.getLabel("em10000350"),dataType:"String",length:255},{name:"SelfMobilePhone__c",label:teasp.message.getLabel("em10000360"),dataType:"String",length:255},{name:"SelfEmail__c",label:teasp.message.getLabel("em10000370"),dataType:"String",length:255}]},Emergency:{label:teasp.message.getLabel("em10000380"),fields:[{name:"EmergencyContact__c",label:teasp.message.getLabel("em10000380"),dataType:"String",
length:255}]},MyNumber1:{label:teasp.message.getLabel("em10000400"),fields:[{name:"MyNumberPurposeUse",type:"label"}]},MyNumber:{label:teasp.message.getLabel("em10000400"),fields:[{name:"MyNumber__c",label:teasp.message.getLabel("em10000400"),type:"text",dataType:"String",length:12,isRequired:!0},{name:"filebody0",label:teasp.message.getLabel("em10000870"),type:"myNumberFile",filedescription:"1",dataType:"File",
isRequired:!0},{name:"filelabel0",label:teasp.message.getLabel("tk10000110"),type:"myNumberLabel",filedescription:"1"},{name:"filebody1",label:teasp.message.getLabel("em10000880"),type:"myNumberFile",filedescription:"2",dataType:"File",isRequired:!0},{name:"filelabel1",label:teasp.message.getLabel("tk10000110"),type:"myNumberLabel",filedescription:"2"}]},Nationality:{label:teasp.message.getLabel("em10000560"),
fields:[{name:"Nationality__c",label:teasp.message.getLabel("em10000570"),dataType:"String",length:80},{name:"ResidencePeriod__c",label:teasp.message.getLabel("em10000580"),dataType:"Date"},{name:"ResidenceStatus__c",label:teasp.message.getLabel("em10000590"),dataType:"String",length:250},{name:"IsPermissionEngage__c",label:teasp.message.getLabel("em10000600"),dataType:"Boolean"},{name:"PermissionEngageDetail__c",
label:teasp.message.getLabel("em10000630"),type:"TextArea",dataType:"String",length:32768}]},InsertDependents:{label:teasp.message.getLabel("em10000640"),fields:[{name:"DependentName_LastName__c",label:teasp.message.getLabel("em10000940"),dataType:"String",length:80,fieldName:"LastName__c",isRequired:!0},{name:"DependentName_FirstName__c",label:teasp.message.getLabel("em10000650"),dataType:"String",length:40,
fieldName:"FirstName__c"},{name:"DependentName_Kana_LastName__c",label:teasp.message.getLabel("em10000950"),dataType:"String",length:80,fieldName:"Name_Kana_LastName__c"},{name:"DependentName_Kana_FirstName__c",label:teasp.message.getLabel("em10000660"),dataType:"String",length:40,fieldName:"Name_Kana_FirstName__c"},{name:"Relation__c",label:teasp.message.getLabel("em10000670"),type:"Select",dataType:"String",
isRequired:!0},{name:"OtherRelation__c",label:teasp.message.getLabel("em10000680"),dataType:"String",length:80},{name:"Gender__c",label:teasp.message.getLabel("em10000330"),type:"Select",dataType:"String"},{name:"Birth__c",label:teasp.message.getLabel("em10000340"),dataType:"Date"},{name:"Job__c",label:teasp.message.getLabel("em10000690"),dataType:"String",length:255},{name:"EqualAddress__c",
label:teasp.message.getLabel("em10000700"),dataType:"Boolean"},{name:"PostalCode__c",label:teasp.message.getLabel("em10000420"),dataType:"String",length:8},{name:"State__c",label:teasp.message.getLabel("em10000430"),dataType:"String",length:80},{name:"City__c",label:teasp.message.getLabel("em10000440"),dataType:"String",length:80},{name:"Street__c",label:teasp.message.getLabel("em10000450"),type:"TextArea",
dataType:"String",length:255},{name:"IsNationalPensionNo3__c",label:teasp.message.getLabel("em10000730"),dataType:"Boolean"},{name:"DisabilityGrade__c",label:teasp.message.getLabel("em10000740"),type:"Select",dataType:"String"},{name:"HealthInsuranceSubscription__c",label:teasp.message.getLabel("em10001900"),type:"Select",dataType:"String"},{name:"SocialInsuranceDivision__c",label:teasp.message.getLabel("em10000970"
),type:"Select",dataType:"String"}]},UpdateDependents:{label:teasp.message.getLabel("em10000640"),fields:[{name:"SelectTarget__c",label:teasp.message.getLabel("em10000900"),type:"SelectDependents",isRequired:!0},{name:"DependentName_LastName__c",label:teasp.message.getLabel("em10000940"),dataType:"String",length:80,fieldName:"LastName__c",isRequired:!0},{name:"DependentName_FirstName__c",label:teasp.message.getLabel(
"em10000650"),dataType:"String",length:40,fieldName:"FirstName__c"},{name:"DependentName_Kana_LastName__c",label:teasp.message.getLabel("em10000950"),dataType:"String",length:80,fieldName:"Name_Kana_LastName__c"},{name:"DependentName_Kana_FirstName__c",label:teasp.message.getLabel("em10000660"),dataType:"String",length:40,fieldName:"Name_Kana_FirstName__c"},{name:"Relation__c",label:teasp.message.getLabel(
"em10000670"),type:"Select",dataType:"String",isRequired:!0},{name:"OtherRelation__c",label:teasp.message.getLabel("em10000680"),dataType:"String",length:80},{name:"Gender__c",label:teasp.message.getLabel("em10000330"),type:"Select",dataType:"String"},{name:"Birth__c",label:teasp.message.getLabel("em10000340"),dataType:"Date"},{name:"Job__c",label:teasp.message.getLabel("em10000690"),dataType:"String",length:255},{
name:"EqualAddress__c",label:teasp.message.getLabel("em10000700"),dataType:"Boolean"},{name:"PostalCode__c",label:teasp.message.getLabel("em10000420"),dataType:"String",length:8},{name:"State__c",label:teasp.message.getLabel("em10000430"),dataType:"String",length:80},{name:"City__c",label:teasp.message.getLabel("em10000440"),dataType:"String",length:80},{name:"Street__c",label:teasp.message.getLabel("em10000450"),
type:"TextArea",dataType:"String",length:255},{name:"IsNationalPensionNo3__c",label:teasp.message.getLabel("em10000730"),dataType:"Boolean"},{name:"DisabilityGrade__c",label:teasp.message.getLabel("em10000740"),type:"Select",dataType:"String"},{name:"HealthInsuranceSubscription__c",label:teasp.message.getLabel("em10001900"),type:"Select",dataType:"String"},{name:"SocialInsuranceDivision__c",
label:teasp.message.getLabel("em10000970"),type:"Select",dataType:"String"}]},DeleteDependents:{label:teasp.message.getLabel("em10000640"),fields:[{name:"SelectTarget__c",label:teasp.message.getLabel("em10000960"),type:"SelectDependents",isRequired:!0}]},DisabilityGrade:{label:teasp.message.getLabel("em10000890"),fields:[{name:"DisabilityGrade__c",label:teasp.message.getLabel("em10000390"),type:"Select",
dataType:"String"}]}},this.optionsList=this.getOptionsList()},teasp.dialog.ChangeEmp.prototype=new teasp.dialog.Base,teasp.dialog.ChangeEmp.prototype.getOptionsList=function(){return{Relation__c:[{value:"妻",label:teasp.message.getLabel("em10001180")},{value:"夫",label:teasp.message.getLabel("em10001190")},{value:"子",label:teasp.message.getLabel("em10001200")},{value:"父",label:teasp.message.getLabel("em10001210")},{
value:"母",label:teasp.message.getLabel("em10001220")},{value:"祖父",label:teasp.message.getLabel("em10001230")},{value:"祖母",label:teasp.message.getLabel("em10001240")},{value:"兄",label:teasp.message.getLabel("em10001250")},{value:"弟",label:teasp.message.getLabel("em10001260")},{value:"姉",label:teasp.message.getLabel("em10001270")},{value:"妹",label:teasp.message.getLabel("em10001280")},{value:"その他",
label:teasp.message.getLabel("em10001290")}],Gender__c:[{value:"女性",label:teasp.message.getLabel("em10001310")},{value:"男性",label:teasp.message.getLabel("em10001300")}],DisabilityGrade__c:[{value:"",label:""},{value:"第14級",label:teasp.message.getLabel("em10001320")},{value:"第13級",label:teasp.message.getLabel("em10001330")},{value:"第12級",label:teasp.message.getLabel("em10001340")},{value:"第11級",
label:teasp.message.getLabel("em10001350")},{value:"第10級",label:teasp.message.getLabel("em10001360")},{value:"第9級",label:teasp.message.getLabel("em10001370")},{value:"第8級",label:teasp.message.getLabel("em10001380")},{value:"第7級",label:teasp.message.getLabel("em10001390")},{value:"第6級",label:teasp.message.getLabel("em10001400")},{value:"第5級",label:teasp.message.getLabel("em10001410")},{value:"第4級",
label:teasp.message.getLabel("em10001420")},{value:"第3級",label:teasp.message.getLabel("em10001430")},{value:"第2級",label:teasp.message.getLabel("em10001440")},{value:"第1級",label:teasp.message.getLabel("em10001450")}],SocialInsuranceDivision__c:[{value:"一般",label:teasp.message.getLabel("em10001460")},{value:"特定",label:teasp.message.getLabel("em10001470")},{value:"老人",label:teasp.message.getLabel("em10001480")},{
value:"対象外",label:teasp.message.getLabel("em10001490")}],HealthInsuranceSubscription__c:[{value:"対象",label:teasp.message.getLabel("em10001150")},{value:"対象外",label:teasp.message.getLabel("em10001160")}],TsDisplayMyNumber__c:[{value:"登録済み",label:teasp.message.getLabel("em10001640")},{value:"未登録",label:teasp.message.getLabel("em10001650")}]}},teasp.dialog.ChangeEmp.prototype.preInit=function(){require([
"dijit/layout/TabContainer","dijit/layout/ContentPane","dijit/Tooltip"]),dojo.require("dojo.fx")},teasp.dialog.ChangeEmp.prototype.ready=function(){this.client=this.args.client,this.loadRequestId=this.args.requestId},teasp.dialog.ChangeEmp.prototype.preStart=function(){dojo.connect(this.dialog,"onCancel",this,function(){this.onfinishfunc(),this.close()}),dojo.style(dojo.byId("requestEdit_DialogChangeEmpTable"),
"width","870px"),dojo.style(dojo.byId("requestEdit_DialogChangeEmpTable"),"height","420px"),dojo.query(".dijitDialogPaneContent",this.dialog.domNode).forEach(function(e){dojo.style(e,"background","#F0F0E1")});var e=dojo.byId("Buttons"),t=dojo.create("tr",null,e),a=(dojo.create("td",null,t),dojo.create("td",{id:"requestEventForm_SubmitBtn"},t));div=dojo.create("div",{innerHTML:teasp.message.getLabel("em10000980")},
dojo.create("button",{className:"std-button1-disabled",style:{margin:"4px 2px"},disabled:!0},a)),dojo.connect(a.firstChild,"onclick",this,this.submitRequestEvent),a=dojo.create("td",{id:"requestEventForm_DeleteBtn"},t),div=dojo.create("div",{innerHTML:teasp.message.getLabel("tf10005040")},dojo.create("button",{className:"red-button1-disabled",style:{margin:"4px 2px"},disabled:!0},a)),dojo.connect(a.firstChild,
"onclick",this,this.deleteRequestEvent),a=dojo.create("td",{id:"requestEventForm_CancelBtn"},t),div=dojo.create("div",{innerHTML:teasp.message.getLabel("cancel_btn_title")},dojo.create("button",{className:"std-button1 gry-button1",style:{margin:"4px 2px"}},a)),dojo.connect(a.firstChild,"onclick",this,function(){this.onfinishfunc(),this.close()}),e=dojo.byId("RequestEditForm"),t=dojo.create("tr",null,e),a=dojo.create(
"td",{colSpan:5},t),div=dojo.create("div",{style:"height: 340px; overflow-y: auto;"},a),dojo.create("tbody",{id:"requestEditForm_tbody"},dojo.create("table",{className:"pane_table"},div)),e=dojo.byId("RequestEditForm"),t=dojo.create("tr",null,e),a=dojo.create("td",null,t),t=dojo.create("tr",null,dojo.create("tbody",null,dojo.create("table",{style:"margin-left:auto;margin-right:0px;"},a))),a=dojo.create("td",{
style:"display:none;",id:"requestFlowForm_SaveBtn"},t),div=dojo.create("div",{innerHTML:teasp.message.getLabel("tk10000289")},dojo.create("button",{className:"std-button1",style:{margin:"4px 2px"}},a)),dojo.connect(a.firstChild,"onclick",this,function(){this.saveRequestFlow(!1)}),a=dojo.create("td",{style:"display:none;",id:"requestFlowForm_SaveNextBtn"},t),div=dojo.create("div",{innerHTML:teasp.message.getLabel(
"em10000990")},dojo.create("button",{className:"std-button1",style:{margin:"4px 2px"}},a)),dojo.connect(a.firstChild,"onclick",this,function(){this.saveRequestFlow(!0)}),a=dojo.create("td",{style:"display:none;",id:"requestFlowForm_NextBtn"},t),div=dojo.create("div",{innerHTML:teasp.message.getLabel("next_btn_title")},dojo.create("button",{className:"std-button1",style:{margin:"4px 2px"}},a)),dojo.connect(
a.firstChild,"onclick",this,this.nextRequestFlow)},teasp.dialog.ChangeEmp.prototype.preShow=function(){return dojo.empty(dojo.query("#GroupCategory select")[0]),dojo.empty(dojo.byId("RequestEventTable")),dojo.empty(dojo.byId("RequestFlowTable")),this.clearInfoArea(!0),dojo.empty(dojo.byId("requestEditForm_tbody")),this.settingVisibleEventButton(),this.employee=this.getMaster("EMEmployee"),this.showEvent=null,
this.showFlow=null,this.requestCache=null,this.saveBtnDwnFlg=!1,this.mskMyNumber=null,this.settingVisibleEventButton(),!0},teasp.dialog.ChangeEmp.prototype.postShow=function(){this.clearEventHandles(),this.getRequestTemplate(),globalAttachedEvent=dojo.hitch(this,this.attachedEvent)},teasp.dialog.ChangeEmp.prototype.getRequestTemplate=function(){teasp.manager.dialogOpen("BusyWait"),teasp.manager.request(
"getEmployeeMaster",[this.loadRequestId],this.pouch,{hideBusy:!1},this,function(e){this.setMaster(e);e=this.getRequestInfo();!e.Id||e.EventId__c?(this.createRequestTemplate(),this.swapEventFlow(!0,!1),this.loadRequestFlowParts(),teasp.manager.dialogClose("BusyWait")):(teasp.manager.dialogClose("BusyWait"),this.close())},function(e){teasp.message.alertError(e),teasp.manager.dialogClose("BusyWait")})},
teasp.dialog.ChangeEmp.prototype.setMaster=function(e){this.master=e;for(var t=this.master.events||[],a=[],o={},s={},i=0;i<t.length;i++){var n=t[i];if(n.Contents__c&&n.Group__c){var r=n.Name,l=(!teasp.message.getLanguageLocaleKey()||"en"!=teasp.message.getLanguageLocaleKey()&&"en_US"!=teasp.message.getLanguageLocaleKey()||(r=n.Name_Eng__c),{id:n.Id,name:r});try{var p=dojo.fromJson(n.Contents__c);l.flows=p.flows||[]
}catch(e){console.log("fromJson failed!"),console.log(n.Contents__c)}l.flows||(l.flows=[]),dojo.forEach(l.flows,function(e,t){e.id="f"+this.localAutoId++,e.index=t},this);r=n.Group__c;(d=s[r=!teasp.message.getLanguageLocaleKey()||"en"!=teasp.message.getLanguageLocaleKey()&&"en_US"!=teasp.message.getLanguageLocaleKey()?r:n.Group_Eng__c])||(d={id:"g"+this.localAutoId++,name:r,events:[]},s[r]=d,a.push(d)),d.events.push(
l),o[l.id]=l,dojo.forEach(l.flows||[],function(e){for(var t=e.flowParts||[],a=0;a<t.length;a++)t[a].id="p"+this.localAutoId++},this)}}this.master.groups=a,this.master.events=o;for(i=0;i<a.length;i++)for(var d=a[i],c=0;c<d.events.length;c++)for(var m=(l=d.events[c]).flows||[],h=0;h<m.length;h++){var u=m[h];h==m.length-1&&(u.last=!0)}},teasp.dialog.ChangeEmp.prototype.getMaster=function(e){
return this.master&&this.master[e]||null||this.pouch.getKeyObj(e)},teasp.dialog.ChangeEmp.prototype.initRequestCache=function(e,t){if(this.requestCache={EventRequestId:null,EmpId:this.getMaster("sessionInfo").emp.id,EMEmpId:this.employee.Id,EventId:null,FlowBody:null,_status:null,_alias:{},_attached:{},_mnAttached:{},_required:{},_requiredAttach:{},_tmp:{}},e){this.requestCache.EventRequestId=e.Id,
this.requestCache.EventId=e.EventId__c,this.requestCache._status=e.TSEM&&e.TSEM.Status__c||null,teasp.constant.STATUS_FIX.contains(this.requestCache._status)&&(this.requestCache._readOnly=!0);var a=e.TSEM&&e.TSEM.FlowBody__c||e.FlowBody__c||null;if(a)try{this.requestCache.FlowBody=dojo.fromJson(a)}catch(e){}for(var o=e.TSEM&&e.TSEM.Attachments&&e.TSEM.Attachments.records||[],s=0;s<o.length;s++){var i=o[s];
i.Description&&(this.requestCache._attached[i.Description]=i)}var n=e.TSEM&&e.TSEM.MyNumberAttachments&&e.TSEM.MyNumberAttachments||null;if(n)for(var r=0;r<n.length;r++){var l=n[r];l&&l.Type&&(this.requestCache._mnAttached[l.Type]=l)}}else t&&(this.requestCache.EventId=t.id);this.storeRequiredAttach()},teasp.dialog.ChangeEmp.prototype.storeRequiredAttach=function(){var e;this.requestCache&&(
this.requestCache._requiredAttach={},e=this.getMaster("events")[this.requestCache.EventId],dojo.forEach(e.flows||[],function(e){for(var t=e.flowParts||[],a=0;a<t.length;a++){var o=t[a];switch(o.recordType){case"Attachment":o.isRequired&&(this.requestCache._requiredAttach[o.attachmentDescription]={type:"file"});break;case"EmployeeEdit":for(var s=this.fieldList[o.showSection],i=0;i<s.fields.length;i++){
var n=s.fields[i],r=(n.type||n.dataType||"").toLowerCase();!n.isRequired||"file"!=r&&"mynumberfile"!=r||(this.requestCache._requiredAttach[n.filedescription]={type:r})}}}},this))},teasp.dialog.ChangeEmp.prototype.isLackAttach=function(e){var t,a=(e||this.requestCache)._requiredAttach||{};for(t in a)if(0!=this.checkShowIdentityDocument(a[t].type,t))if(a.hasOwnProperty(t))if(!("file"==a[t].type?this.getAttachObj(t
):this.getMnAttachObj(t)))return!0;return!1},teasp.dialog.ChangeEmp.prototype.getRequestInfo=function(){var e=this.getMaster("request");return e&&e.TSEM||{}},teasp.dialog.ChangeEmp.prototype.getApplyDatetime=function(e){var t=this.getMaster("request"),a=t&&t.ApplyDatetime__c;return(a=!a&&t&&t.TSEM&&(teasp.constant.STATUS_FIX.contains(e)||teasp.constant.STATUS_REJECTS.contains(e))&&t.TSEM.ApplyDatetime__c?(a=moment(
t.TSEM.ApplyDatetime__c.replace("T"," ")),teasp.util.date.formatDateTime(a.toDate(),"SLA-HM",!0)):a&&teasp.util.date.formatDateTime(a,"SLA-HM"))||""},teasp.dialog.ChangeEmp.prototype.getProcessInstanceStep=function(){var e=this.getMaster("request");return teasp.logic.convert.convTSEMApplySteps(e&&e.TSEM&&e.TSEM.ProcessInstanceStep||[])},teasp.dialog.ChangeEmp.prototype.clearInfoArea=function(e){var t=dojo.byId(
"ChangeRequestInfo");dojo.empty(t),e&&(dojo.style("GroupCategory","display","none"),dojo.style(t,"display",""))},teasp.dialog.ChangeEmp.prototype.getRequestCache=function(e){if(e){var t,a=dojo.clone(this.requestCache);for(t in a)a.hasOwnProperty(t)&&"_"==t.substring(0,1)&&delete a[t];return a.FlowBody&&a.FlowBody.MyNumber__c&&this.mskMyNumber&&(a.FlowBody.MyNumber__c=this.mskMyNumber),a.connectIP=connectIP,a}
return this.requestCache},teasp.dialog.ChangeEmp.prototype.setApiName=function(e,t){e&&t&&(this.requestCache._alias[e]=t)},teasp.dialog.ChangeEmp.prototype.getApiName=function(e){return this.requestCache._alias[e]||e},teasp.dialog.ChangeEmp.prototype.isSaved=function(){return this.requestCache&&this.requestCache.EventRequestId},teasp.dialog.ChangeEmp.prototype.isMyNumberAttachable=function(){return!!(
this.requestCache&&this.requestCache.EventRequestId&&this.requestCache.FlowBody&&this.requestCache.FlowBody.MyNumberId__c)},teasp.dialog.ChangeEmp.prototype.isLock=function(){return this.requestCache&&this.requestCache.EventRequestId&&teasp.constant.STATUS_FIX.contains(this.requestCache._status)},teasp.dialog.ChangeEmp.prototype.canRequest=function(){if(
!this.showEvent||!this.requestCache||!this.requestCache.EventRequestId||this.isLock())return!1;for(var e=0;e<this.showEvent.flows.length;e++)if(this.showEvent.flows[e].isRequired&&!this.isFlowSaved(e))return!1;return!this.isLackAttach()},teasp.dialog.ChangeEmp.prototype.canDelete=function(){return this.requestCache&&this.requestCache.EventRequestId&&!teasp.constant.STATUS_FIX.contains(this.requestCache._status)},
teasp.dialog.ChangeEmp.prototype.canCancel=function(){return this.requestCache&&this.requestCache.EventRequestId&&teasp.constant.STATUS_WAIT==this.requestCache._status},teasp.dialog.ChangeEmp.prototype.getAttachObj=function(e){return this.requestCache&&this.requestCache._attached&&this.requestCache._attached[e]||null},teasp.dialog.ChangeEmp.prototype.getMnAttachObj=function(e){
return this.requestCache&&this.requestCache._mnAttached&&this.requestCache._mnAttached[e]||null},teasp.dialog.ChangeEmp.prototype.setFlowSaved=function(e,t){t=t||this.requestCache;t&&(t.FlowBody||(t.FlowBody={}),t.FlowBody._flowSaved||(t.FlowBody._flowSaved=[]),t.FlowBody._flowSaved.indexOf(e)<0&&t.FlowBody._flowSaved.push(e))},teasp.dialog.ChangeEmp.prototype.isFlowSaved=function(e,t){t=t||this.requestCache;
return!!(t&&t.FlowBody&&t.FlowBody._flowSaved)&&0<=t.FlowBody._flowSaved.indexOf(e)},teasp.dialog.ChangeEmp.prototype.canFlowSave=function(e){return!this.isLack()&&!!(this.showFlow&&!this.isFlowSaved(this.showFlow.index)||e)},teasp.dialog.ChangeEmp.prototype.getOrgValue=function(e){var t=this.employee||{},a=this.getSavedValue(e);if(a)return a.value||"boolean"!=typeof a.value&&null;a=this.getApiName(e);if(
"MyNumber__c"!=e)return t[a];e=this.getSavedValue("SelectTarget__c");if(e){if(t.Id==e.value)return t[a];t=this.getRefer("Dependents__r",e.value);if(t)return t[a]}return""},teasp.dialog.ChangeEmp.prototype.getSavedValue=function(e){var t=this.requestCache.FlowBody||{};return e?t[e]:t},teasp.dialog.ChangeEmp.prototype.setSavedValue=function(e,t,a){this.requestCache.FlowBody||(this.requestCache.FlowBody={}),
this.requestCache.FlowBody[e]={dataType:t,value:a}},teasp.dialog.ChangeEmp.prototype.getRefer=function(e,t){for(var a=((this.employee||{})[e]||{}).records||[],o=0;o<a.length;o++)if(a[o].Id==t)return a[o];return{}},teasp.dialog.ChangeEmp.prototype.getDispValue=function(e,t,a){a=a?a[this.getApiName(e)]:this.getOrgValue(e),a&&"object"==typeof a&&(a=a.value||null),e=t.toLowerCase();return"date"==e?(t="","???"==(
t=a?teasp.util.date.formatDate(a,"SLA"):t)?a:t):"boolean"==e?!!a:a||""},teasp.dialog.ChangeEmp.prototype.resetTemporary=function(){this.requestCache._tmp={FlowBody:{}}},teasp.dialog.ChangeEmp.prototype.getTemporary=function(){return this.requestCache._tmp&&this.requestCache._tmp.FlowBody},teasp.dialog.ChangeEmp.prototype.getTempValue=function(e){var t=this.getTemporary();return t&&t[e]&&t[e].value||null},
teasp.dialog.ChangeEmp.prototype.setDispValue=function(e,t,a){var o=a||null,s=t.toLowerCase();"date"==s&&o?"???"==(o=teasp.util.date.formatDate(o))&&(o=a):"boolean"==s&&(o=!!o),this.getTemporary()[e]={type:t,value:o}},teasp.dialog.ChangeEmp.prototype.isChanged=function(){if(!this.showFlow)return!1;var e,t=this.getTemporary();for(e in t)if(t.hasOwnProperty(e))if((t[e]&&t[e].value)!=this.getOrgValue(e))return!0;
return!1},teasp.dialog.ChangeEmp.prototype.isLack=function(){if(!this.showFlow)return!1;var e,t=this.getTemporary();for(e in t)if(t.hasOwnProperty(e)&&this.isRequiredField(e))if(!(t[e]&&t[e].value))return!0;return!1},teasp.dialog.ChangeEmp.prototype.clearRequiredField=function(){this.requestCache._required={}},teasp.dialog.ChangeEmp.prototype.setRequiredField=function(e){this.requestCache._required[e]=1},
teasp.dialog.ChangeEmp.prototype.isRequiredField=function(e){return!!this.requestCache._required[e]},teasp.dialog.ChangeEmp.prototype.resetMyNumber=function(){var t,a,o=this.getTemporary();o.IsChangeMyNumber=!1,this.requestCache.FlowBody&&(t=this.requestCache.FlowBody.MyNumberId__c,a=this.requestCache.FlowBody.MyNumber__c,dojo.query('input[fieldName="MyNumber__c"]').forEach(function(e){t&&a.value!=e.value&&(
o.IsChangeMyNumber=!0,this.mskMyNumber=null)}))},teasp.dialog.ChangeEmp.prototype.resetMyNumberAttachment=function(){var e,t,a;this.requestCache.FlowBody&&(e=this.requestCache.FlowBody.MyNumberId__c,t=this.requestCache.FlowBody.MyNumber__c,(a=dojo.query('input[fieldName="MyNumber__c"]')[0])&&e&&t.value!=a.value&&(this.requestCache._mnAttached={}))},teasp.dialog.ChangeEmp.prototype.mergeValue=function(e,t){
var a=e||this.requestCache;if(a){a.FlowBody||(a.FlowBody={});var o=this.getTemporary();for(s in o)o.hasOwnProperty(s)&&(a.FlowBody[s]=o[s]||null);if(t)for(var s in t)"result"!=s&&t.hasOwnProperty(s)&&(a.FlowBody[s]=t[s])}},teasp.dialog.ChangeEmp.prototype.blurField=function(e){this.settingFlowValue(),this.settingVisibleEventButton(this.isChanged())},teasp.dialog.ChangeEmp.prototype.keypressField=function(e){
""===e.keyChar&&13===e.keyCode?(this.settingFlowValue(),this.settingVisibleEventButton(this.isChanged())):(this.settingFlowValue(),this.settingVisibleEventButton(!0))},teasp.dialog.ChangeEmp.prototype.setEventHandles=function(e,t){(this.eventHandles[e]||(this.eventHandles[e]=[])).push(t)},teasp.dialog.ChangeEmp.prototype.clearEventHandles=function(e){if(e){for(var t=this.eventHandles[e]||[],a=t.length-1;0<=a;a--
)dojo.disconnect(t[a]),delete t[a];delete this.eventHandles[e]}else for(var o in this.eventHandles)o&&this.eventHandles.hasOwnProperty(o)&&this.clearEventHandles(o)},teasp.dialog.ChangeEmp.prototype.loadRequestFlowParts=function(){var e,t,a,o=dojo.byId("ChangeRequestInfo");dojo.empty(o),dojo.style("GroupCategory","display",this.loadRequestId?"none":""),dojo.style(o,"display",this.loadRequestId?"":"none"),
this.loadRequestId?(e=this.getMaster("request"),this.initRequestCache(e),e=this.getRequestInfo(),a=teasp.message.getLabel("tm10001590"),t=dojo.create("div",{className:"request-info-group"},o),dojo.create("div",{className:"request-info-c",innerHTML:teasp.message.getLabel("em10001110")+a},t),dojo.create("span",{innerHTML:e.Name||"&nbsp;"},dojo.create("div",{className:"request-info-v"},t)),t=dojo.create("div",{
className:"request-info-group"},o),dojo.create("div",{className:"request-info-c",innerHTML:teasp.message.getLabel("applyDate_label")+a},t),dojo.create("span",{innerHTML:this.getApplyDatetime(e.Status__c)||"&nbsp;"},dojo.create("div",{className:"request-info-v"},t)),dojo.create("div",{className:"request-info-c",innerHTML:teasp.message.getLabel("statusj_head")+a},t),o=dojo.create("button",{className:"std-button2"},
dojo.create("div",{className:"request-info-btn"},t)),dojo.create("div",{innerHTML:teasp.constant.getDisplayStatus(e.Status__c)||"&nbsp;"},o),this.setEventHandles("top",dojo.connect(o,"onclick",this,this.showSteps)),(a=this.getMaster("events")[this.requestCache.EventId])&&dojo.hitch(this,this.openRequestEvent(a,!1))(),this.settingVisibleEventButton(),this.lockEventButton(!0)):this.lockEventButton(!1)},
teasp.dialog.ChangeEmp.prototype.createRequestTemplate=function(){for(var e=dojo.query("#GroupCategory select")[0],t=(dojo.create("option",{value:"",innerHTML:teasp.message.getLabel("em10001000")},e),dojo.byId("RequestEventTable")),a=this.getMaster("groups"),o={},s=0;s<a.length;s++){var i=a[s];dojo.create("option",{value:i.id,innerHTML:i.name},e);for(var n=0;n<i.events.length;n++){var r=i.events[n];o[r.id]||(
this.settingEvent(t,r),o[r.id]=!0)}}this.setEventHandles("top",dojo.connect(e,"onchange",this,this.changeGroup))},teasp.dialog.ChangeEmp.prototype.changeGroup=function(){for(var e=dojo.query("#GroupCategory select")[0].value,t=new Array,a={},o=!1,s=this.getMaster("groups"),i=0;i<s.length;i++){var n=s[i];if(n.id==e||""==e){for(var r=0;r<n.events.length;r++)a[(p=n.events[r]).id]||(t.push(p),a[p.id]=!0);o=!0}}if(o){
var l=dojo.byId("RequestEventTable");dojo.empty(l),this.clearEventHandles("group");for(r=0;r<t.length;r++){var p=t[r];this.settingEvent(l,p)}}},teasp.dialog.ChangeEmp.prototype.settingEvent=function(e,t){e=dojo.create("tr",null,e),e=dojo.create("span",{innerHTML:t.name},dojo.create("td",{className:"SelectEvent",id:"event_"+t.id},e));this.setEventHandles("group",dojo.connect(e,"onclick",this,this.openRequestEvent(t,!0
)))},teasp.dialog.ChangeEmp.prototype.openRequestEvent=function(p,d){return function(){this.clearEventHandles("group2"),this.requestCache&&!d||this.initRequestCache(null,p);var e=this.getMaster("events"),t=p.flows,a=dojo.byId("RequestFlowTable"),o=(dojo.empty(a),dojo.create("tr",null,a)),s=dojo.create("span",{innerHTML:teasp.message.getLabel("em10001010")},dojo.create("td",{className:"RequestReturnEvent",
id:"RequestReturnEvent"},o)),i=(this.setEventHandles("group2",dojo.connect(s,"onclick",this,function(){this.swapEventFlow(!0,!0),dojo.hitch(this,this.openRequestFlow(null))()})),o=dojo.create("tr",null,a),dojo.create("div",{innerHTML:p.name},dojo.create("td",{className:"RequestEventTitle"},o))),s=(o=dojo.create("tr",{style:"height: 100%;"},a),dojo.create("div",{className:"RequestFlowList"},dojo.create("td",{
style:"vertical-align:top;"},o)));o=dojo.create("tr",null,a),(i=dojo.create("div",null,dojo.create("td",{className:"RequestFlowRequiredAnnotation",colspan:4},o))).innerHTML=teasp.message.getLabel("em10001020",teasp.message.getLabel("em10001030"));for(var a=dojo.create("tbody",null,dojo.create("table",{style:"width: 100%;"},s)),n=0;n<t.length;n++){var r=t[n],o=dojo.create("tr",null,a),l=dojo.create("td",{
style:"vertical-align: top; height: 24px;"},o),l=(r.isRead||(i=dojo.create("div",{className:"RequestFlowCheck",id:"flowCheck_"+r.id},l),this.isFlowSaved(n)&&dojo.addClass(i,"png-sts005")),l=dojo.create("td",{style:"vertical-align: top;"},o),r.isRead||(i=dojo.create("div",{innerHTML:r.isRequired?"*":"",className:"RequestFlowRequired"},l)),"");r.name_msgId?l=teasp.message.getLabel(r.name_msgId):(l=r.name,
!teasp.message.getLanguageLocaleKey()||"en"!=teasp.message.getLanguageLocaleKey()&&"en_US"!=teasp.message.getLanguageLocaleKey()||(l=r.name_eng)),i=dojo.create("div",{innerHTML:n+1+" "+l},dojo.create("td",{className:"RequestSelectFlow",id:"FlowName_"+r.id,style:"vertical-align: top; text-align: left;"},o)),this.setEventHandles("group2",dojo.connect(i,"onclick",this,this.openRequestFlow(r))),i=dojo.create("div",{
innerHTML:"▶",style:"visibility: hidden;"},dojo.create("td",{className:"RequestSelectMarkFlow",id:"FlowSelect_"+r.id,style:"text-align: right;"},o))}this.swapEventFlow(!1,d),this.showEvent=e[p.id],dojo.hitch(this,this.openRequestFlow(this.getFirstFlow()))()}},teasp.dialog.ChangeEmp.prototype.openRequestFlow=function(o){return function(){this.clearEventHandles("flow"),this.clearRequiredField(),this.showFlow=o;
var e=dojo.byId("requestEditForm_tbody");if(dojo.empty(e),dojo.query(".RequestSelectMarkFlow div",dojo.byId("RequestFlowList")).forEach(function(e){dojo.style(e,"visibility","hidden")}),o){dojo.style(dojo.byId("FlowSelect_"+o.id).firstChild,"visibility","visible");for(var t=o.flowParts||[],a=0;a<t.length;a++)this.createRequestEditForm(e,t[a])}this.settingVisibleEventButton()}},
teasp.dialog.ChangeEmp.prototype.createRequestEditForm=function(e,t){1==t.isShowParts&&(a=dojo.create("tr",null,e),(o=dojo.create("td",{style:"padding-bottom: 2px; text-align: left;"},a)).innerHTML=teasp.message.getLabel("tf10006410",t.name),!teasp.message.getLanguageLocaleKey()||"en"!=teasp.message.getLanguageLocaleKey()&&"en_US"!=teasp.message.getLanguageLocaleKey()||(o.innerHTML=teasp.message.getLabel("tf10006410"
,t.name_eng)));var a=dojo.create("tr",null,e),o=dojo.create("td",{style:"padding-bottom: 8px;"},a),s=dojo.create("tbody",null,dojo.create("table",{className:"request_Form",style:"border-collapse:separate;border-spacing:3px;"},o));switch(t.recordType){case"InputParts":a=dojo.create("tr",null,s),o=dojo.create("td",{className:"RequestFieldRequired"},a),t.isRequired&&(dojo.create("div",{innerHTML:"*"},o),
this.setRequiredField(t.name)),t.labelName&&dojo.create("div",{innerHTML:t.labelName},dojo.create("td",{className:"left",style:"padding-bottom:2px;text-align:left;"},a)),o=dojo.create("td",{className:"right",colSpan:t.labelName?"1":"2",style:"padding-bottom:2px;text-align:left;"},a);var i=dojo.create("div",null,o);switch(h=(t.inputType||"text").toLowerCase()){case"text":dojo.create("input",{type:h,
style:"width:300px;",id:t.id,fieldName:t.name,dataType:"String"},i);break;case"checkbox":dojo.create("input",{type:h,id:t.id,fieldName:t.name,dataType:"Boolean"},i);break;case"textarea":dojo.create("textarea",{rows:5,cols:75,style:"width:300px;",maxlength:32768,id:t.id,fieldName:t.name,dataType:"String"},i);break;case"selectlist":var n=dojo.create("select",{id:t.id,fieldName:t.name,dataType:"String"},i),
r=t.selectValueList||[];dojo.create("option",{value:"",label:teasp.message.getLabel("em10001050")},n);for(var l=0;l<r.length;l++){var p=r[l];dojo.create("option",{value:p,label:p},n)}break;case"date":dojo.create("input",{type:"text",style:"width:96px;text-align:center;",id:t.id,fieldName:t.name,dataType:"Date"},i),this.isLock()||(u=dojo.create("input",{type:"button",style:"margin:2px;",className:"pp_base pp_btn_cal"}
,i),this.setEventHandles("flow",dojo.connect(u,"onclick",this,this.settingCalendar(t.id))))}this.setApiName(t.name,t.fieldName);break;case"Attachment":a=dojo.create("tr",null,s),o=dojo.create("td",{className:"RequestFieldRequired"},a),t.isRequired&&(dojo.create("div",{innerHTML:"*"},o),this.setRequiredField(t.name)),t.labelName&&dojo.create("div",{innerHTML:t.labelName},dojo.create("td",{className:"left",
style:"padding-bottom:2px;text-align:left;"},a)),o=dojo.create("td",{className:"right",colSpan:t.labelName?"1":"2",style:"padding-bottom:2px;text-align:left;"},a);i=dojo.create("div",null,o);this.settingFileAttach(i,t.attachmentDescription),this.setApiName(t.name,t.fieldName);break;case"EmployeeEdit":if(t.showSection)for(var d=this.fieldList[t.showSection],c=0;c<d.fields.length;c++){var m=d.fields[c],h=m.type;if(
0!=this.checkShowIdentityDocument(h,m.filedescription)){this.setApiName(m.name,m.fieldName),a=dojo.create("tr",null,s),o=dojo.create("td",{className:"RequestFieldRequired"},a),m.isRequired&&(dojo.create("div",{innerHTML:"*"},o),this.setRequiredField(m.name)),m.label&&dojo.create("div",{innerHTML:m.label},dojo.create("td",{className:"left",style:"padding-bottom:2px;text-align:left;"},a)),o=dojo.create("td",{
className:"right",colSpan:m.label?"1":"2",style:"padding-bottom:2px;text-align:left;"},a);var u,g,i=dojo.create("div",null,o);if(h)h=h.toLowerCase();else switch(m.dataType){case"Boolean":h="checkbox";break;case"Date":h="date";break;default:h="text"}switch(h){case"selecttarget":var n=dojo.create("select",{id:m.name,fieldName:m.name,dataType:"String"},i),y=this.getDispListValue("TsDisplayMyNumber__c",
this.employee.TsDisplayMyNumber__c);if(dojo.create("option",{value:this.employee.Id,innerHTML:teasp.message.getLabel("em10001060",this.employee.Name,y||"")},n),_=this.employee.Dependents__r)for(l=0;l<_.records.length;l++){var f=_.records[l],y=this.getDispListValue("TsDisplayMyNumber__c",f.TsDisplayMyNumber__c),b=this.getDispListValue("Relation__c",f.Relation__c);dojo.create("option",{value:f.Id,
innerHTML:teasp.message.getLabel("em10001070",f.Name,b||"",y||"")},n)}this.isFlowSaved(this.showFlow.index)||(n.value=this.employee.Id,this.setSavedValue(m.name,"String",this.employee.Id));break;case"selectdependents":for(var n=dojo.create("select",{id:m.name,fieldName:m.name,dataType:"String"},i),_=this.employee.Dependents__r&&this.employee.Dependents__r.records||[],l=0;l<_.length;l++){f=_[l],
b=this.getDispListValue("Relation__c",f.Relation__c);dojo.create("option",{value:f.Id,innerHTML:teasp.message.getLabel("em10001500",f.Name,b||"")},n)}_.length&&(this.setEventHandles("flow",dojo.connect(n,"onchange",this,function(){this.settingDependentField("Dependents__r","SelectTarget__c")})),this.isFlowSaved(this.showFlow.index)||(n.value=_[0].Id,this.setSavedValue(m.name,"String",_[0].Id)));break;case"select":
for(var n=dojo.create("select",{id:m.name,fieldName:m.name,dataType:"String"},i),v=this.optionsList[m.name]||[],l=0;l<v.length;l++){var T=v[l];dojo.create("option",{value:T.value,innerHTML:T.label},n)}!this.isFlowSaved(this.showFlow.index)&&v.length&&(n.value=v[0].value,this.setSavedValue(m.name,"String",v[0].value||null));break;case"date":dojo.create("input",{type:"text",style:"width:96px;text-align:center;",
id:m.name,fieldName:m.name,dataType:"Date"},i),this.isLock()||(u=dojo.create("input",{type:"button",style:"margin:2px;",className:"pp_base pp_btn_cal"},i),this.setEventHandles("flow",dojo.connect(u,"onclick",this,this.settingCalendar(m.name))));break;case"file":this.settingFileAttach(i,m.filedescription);break;case"mynumberfile":this.settingMyNumberFileAttach(i,m.filedescription);break;case"mynumberlabel":
this.settingMyNumberLabelAttach(i,m.filedescription);break;case"textarea":dojo.create("textarea",{rows:5,cols:75,style:"width:300px;",id:m.name,fieldName:m.name,maxlength:m.length,dataType:"String"},i);break;case"label":"MyNumberPurposeUse"==m.name&&(g=this.master.setting.MyNumberPurposeUse||"",g=(g=(g=(g=teasp.message.getLabel("em10001630")+":<br />"+g).replace(/\r\n/g,"<br />")).replace(/\n/g,"<br />")).replace(
/\r/g,"<br />"),dojo.create("div",{id:m.name,innerHTML:g,style:"font-size: 125%;"},i));break;default:n=dojo.create("input",{type:h,id:m.name,fieldName:m.name,maxlength:m.length,dataType:m.dataType},i);"MyNumber__c"==m.name&&(this.setEventHandles("flow",dojo.connect(n,"onkeyup",this,function(){this.changedMyNumber()})),dojo.create("div",{id:"myNumberInfo",style:"display: none;"},i))}}}break;case"Description":var j="";
t.description_msgId?j=teasp.message.getLabel(t.description_msgId):(j=t.description,!teasp.message.getLanguageLocaleKey()||"en"!=teasp.message.getLanguageLocaleKey()&&"en_US"!=teasp.message.getLanguageLocaleKey()||(j=t.description_eng)),a=dojo.create("tr",null,s),dojo.create("td",{style:"width:8px;"},a),dojo.create("div",{innerHTML:j},dojo.create("td",{className:"right",colSpan:"2",
style:"padding-bottom:2px;text-align:left;"},a))}"InsertDependents"!=t.showSection||this.isFlowSaved(this.showFlow.index)?this.settingLoadDataFlowParts():this.settingLoadDataFlowParts(this.getSavedValue()),"UpdateDependents"!=t.showSection||this.isFlowSaved(this.showFlow.index)?this.settingFlowValue():this.settingDependentField("Dependents__r","SelectTarget__c"),this.settingVisibleEventButton()},
teasp.dialog.ChangeEmp.prototype.selectDependent=function(e){var t=null;if(e&&this.employee.Dependents__r)for(var a=0;a<this.employee.Dependents__r.records.length;a++)this.employee.Dependents__r.records[a].Id==e&&(t=this.employee.Dependents__r.records[a]);return t},teasp.dialog.ChangeEmp.prototype.checkShowIdentityDocument=function(e,t){var a=null;
return this.requestCache.FlowBody&&this.requestCache.FlowBody.SelectTarget__c&&(a=this.selectDependent(this.requestCache.FlowBody.SelectTarget__c.value)),!e||"2"!=t||!(0==this.master.setting.IsRequiredIdentityDocument&&!a||0==this.master.setting.IsRequiredIdentityDocumentDependent&&a&&0==a.IsNationalPensionNo3__c||0==this.master.setting.IsRequiredIdentityDocumentDependentNo3&&a&&1==a.IsNationalPensionNo3__c)},
teasp.dialog.ChangeEmp.prototype.settingDependentField=function(e,o){this.settingFlowValue();var s=this.getRefer(e,this.getTempValue(o)),e=dojo.byId("requestEditForm_tbody");dojo.query('input[type="text"],input[type="date"],select,textarea',e).forEach(function(e){var t=dojo.getAttr(e,"fieldName"),a=dojo.getAttr(e,"dataType");t&&a&&t!=o&&(e.value=this.getDispValue(t,a,s))},this),dojo.query('input[type="checkbox"]',e
).forEach(function(e){var t=dojo.getAttr(e,"fieldName"),a=dojo.getAttr(e,"dataType");t&&a&&(e.checked=this.getDispValue(t,a,s))},this)},teasp.dialog.ChangeEmp.prototype.changedMyNumber=function(){var e=dojo.byId("MyNumber__c").value,t=dojo.query(".myNumberAttachment"),a=dojo.query(".myNumberAttachmentHide");if(
this.requestCache.FlowBody&&this.requestCache.FlowBody.MyNumber__c&&this.requestCache.FlowBody.MyNumber__c.value==e&&this.isMyNumberAttachable()){for(var o=0;o<t.length;o++)dojo.style(t[o],"display","");for(o=0;o<a.length;o++)dojo.style(a[o],"display","none")}else{for(o=0;o<t.length;o++)dojo.style(t[o],"display","none");for(o=0;o<a.length;o++)dojo.style(a[o],"display","")}this.settingFlowValue(),
this.settingVisibleEventButton(!0)},teasp.dialog.ChangeEmp.prototype.settingFileAttach=function(e,t){var a;this.isSaved()?((a=this.getAttachObj(t))?dojo.create("span",{innerHTML:a.Name||"",style:"margin-right:8px;color:#666;"},e):this.isLock()&&dojo.create("div",{innerHTML:teasp.message.getLabel("em10001140"),style:"color:#666;"},e),this.isLock()||(a=dojo.create("input",{type:"button",value:teasp.message.getLabel(
"em10001080")},e),this.setEventHandles("flow",dojo.connect(a,"onclick",this,this.openAttachmentWindow(t))))):dojo.create("div",{innerHTML:teasp.message.getLabel("em10001090"),style:"color:#666;"},e)},teasp.dialog.ChangeEmp.prototype.settingMyNumberFileAttach=function(e,t){var a=this.isMyNumberAttachable(),o=this.getMnAttachObj(t),s=dojo.create("div",{className:"myNumberAttachment"},e);o?dojo.create("span",{
innerHTML:o.Name||"",style:a?"margin-right:8px;color:#666;":NaN},s):this.isLock()&&dojo.create("div",{innerHTML:teasp.message.getLabel("em10001140"),style:a?"color:#666;":"color:#666;display: none;"},s),this.isLock()||(o=dojo.create("input",{type:"button",value:teasp.message.getLabel("em10001080"),style:a?"":"display: none;"},s),this.setEventHandles("flow",dojo.connect(o,"onclick",this,
this.openMyNumberAttachmentWindow(t)))),dojo.create("div",{className:"myNumberAttachmentHide",innerHTML:teasp.message.getLabel("em10001580"),style:a?"color:#666;display: none;":"color:#666;"},e)},teasp.dialog.ChangeEmp.prototype.settingMyNumberLabelAttach=function(e,t){this.isMyNumberAttachable(),this.getMnAttachObj(t);1==t?dojo.create("div",{className:"myNumberAttachmentHide",innerHTML:teasp.message.getLabel(
"em10001670"),style:"color:#666;"},e):dojo.create("div",{className:"myNumberAttachmentHide",innerHTML:teasp.message.getLabel("em10001680"),style:"color:#666;"},e)},teasp.dialog.ChangeEmp.prototype.openAttachmentWindow=function(e){return function(){openAttachmentWindow(e,this.requestCache.EventRequestId)}},teasp.dialog.ChangeEmp.prototype.openMyNumberAttachmentWindow=function(t){return function(){var e;
this.requestCache.EventRequestId&&this.requestCache.FlowBody.MyNumberId__c&&this.employee.Id&&(e="",this.requestCache.FlowBody&&this.requestCache.FlowBody.SelectTarget__c&&(e=this.requestCache.FlowBody.SelectTarget__c.value),openMyNumberAttachmentWindow(t,this.requestCache.EventRequestId,this.requestCache.FlowBody.MyNumberId__c,this.employee.Id,e))}},teasp.dialog.ChangeEmp.prototype.attachedEvent=function(e){
console.log(e),this.requestCache&&this.requestCache.EventRequestId==e.requestId&&((e.isMyNumber?this.requestCache._mnAttached||(this.requestCache._mnAttached={}):this.requestCache._attached||(this.requestCache._attached={}))[e.description]={Name:e.fname},dojo.hitch(this,this.openRequestFlow(this.showFlow))()),this.settingVisibleEventButton()},teasp.dialog.ChangeEmp.prototype.settingCalendar=function(a){
return function(e){var t=teasp.util.date.parseDate(dojo.byId(a).value)||this.args.date||new Date;teasp.manager.dialogOpen("Calendar",{date:t,isDisabledDateFunc:function(e){return!1}},null,this,function(e){dojo.byId(a).value=teasp.util.date.formatDate(e,"SLA"),this.blurField()})}},teasp.dialog.ChangeEmp.prototype.settingLoadDataFlowParts=function(o){var s=this.isLock(),e=dojo.byId("requestEditForm_tbody");dojo.query(
'input[type="text"],input[type="date"],select,textarea',e).forEach(function(e){var t=dojo.getAttr(e,"fieldName"),a=dojo.getAttr(e,"dataType");this.setEventHandles("flow",dojo.connect(e,"onblur",this,this.blurField)),"SELECT"==e.nodeName?this.setEventHandles("flow",dojo.connect(e,"onchange",this,this.blurField)):this.setEventHandles("flow",dojo.connect(e,"onkeypress",this,this.keypressField)),t&&a&&("MyNumber__c"==t?(
this.requestCache&&this.requestCache.FlowBody&&this.requestCache.FlowBody.MyNumber__c?(this.saveBtnDwnFlg?(e.value=this.requestCache.FlowBody.MyNumber__c.value,this.requestCache.FlowBody.MskMyNumber&&(this.mskMyNumber=this.requestCache.FlowBody.MskMyNumber)):(this.mskMyNumber=this.requestCache.FlowBody.MyNumber__c,e.value=""),dojo.byId("myNumberInfo").innerHTML=teasp.message.getLabel("em10001640"),dojo.style(
"myNumberInfo","display","")):(this.mskMyNumber=null,e.value="",dojo.style("myNumberInfo","display","none")),this.requestCache.FlowBody.MskMyNumber&&delete this.requestCache.FlowBody.MskMyNumber):e.value=this.getDispValue(t,a,o)),s&&(e.disabled=!0,"INPUT"!=e.nodeName&&"TEXTAREA"!=e.nodeName||(dojo.style(e,"background-color","#EEEEEE"),dojo.style(e,"border","1px solid #EEEEEE"),dojo.style(e,"padding","1px 2px")))},
this),dojo.query('input[type="checkbox"]',e).forEach(function(e){var t=dojo.getAttr(e,"fieldName"),a=dojo.getAttr(e,"dataType");this.setEventHandles("flow",dojo.connect(e,"onclick",this,this.blurField)),t&&a&&(e.checked=this.getDispValue(t,a,o)),s&&(e.disabled=!0)},this)},teasp.dialog.ChangeEmp.prototype.settingFlowValue=function(){var e;this.requestCache&&(this.resetTemporary(),e=dojo.byId("requestEditForm_tbody"),
dojo.query('input[type="text"],input[type="date"],select,textarea',e).forEach(function(e){var t=dojo.getAttr(e,"fieldName"),a=dojo.getAttr(e,"dataType");t&&a&&this.setDispValue(t,a,e.value)},this),dojo.query('input[type="checkbox"]',e).forEach(function(e){var t=dojo.getAttr(e,"fieldName"),a=dojo.getAttr(e,"dataType");t&&a&&this.setDispValue(t,a,e.checked)},this))},
teasp.dialog.ChangeEmp.prototype.submitRequestEvent=function(){var r=this.getRequestCache(!0);r.Action="checksubmit",teasp.manager.request("executeAPIChangeRequest",r,this.pouch,{hideBusy:!1},this,function(e){teasp.manager.dialogOpen("Comment",{dialogTitle:teasp.message.getLabel("applyx_btn_title"),okButtonTitle:teasp.message.getLabel("applyx_btn_title"),okButtonCss:"std-button1"},this.pouch,this,function(e){
r.Action="eventsubmit",r.Comment=e.comment;for(var t=[],a=this.showEvent.flows[this.showFlow.index].flowParts||[],o=0;o<a.length;o++)for(var s=this.fieldList[a[o].showSection],i=0;i<s.fields.length;i++){var n=s.fields[i];t.push(this.getApiName(n.name))}r.FieldNameList=t,console.log(r),teasp.manager.request("executeChangeRequest",r,this.pouch,{hideBusy:!1},this,function(e){0==e.isExecuteProcess?teasp.manager.request(
"executeAPIChangeRequest",r,this.pouch,{hideBusy:!1},this,function(e){this.onfinishfunc(),this.close()},function(e){teasp.message.alertError(e)}):(this.onfinishfunc(),this.close())},function(e){teasp.message.alertError(e)})})},function(e){teasp.message.alertError(e)})},teasp.dialog.ChangeEmp.prototype.deleteRequestEvent=function(){teasp.tsConfirmA(teasp.message.getLabel("em10001130"),this,function(){
var t=this.getRequestCache(!0);t.FlowBody=null,t.Action="eventdelete",teasp.manager.request("executeAPIChangeRequest",t,this.pouch,{hideBusy:!1},this,function(e){teasp.manager.request("executeChangeRequest",t,this.pouch,{hideBusy:!1},this,function(e){this.onfinishfunc(),this.close()},function(e){teasp.message.alertError(e)})},function(e){teasp.message.alertError(e)})})},
teasp.dialog.ChangeEmp.prototype.saveRequestFlow=function(t){teasp.manager.dialogOpen("BusyWait"),this.settingFlowValue(),this.resetMyNumber(),this.lockEventButton(!0);for(var a=this.getRequestCache(!0),o=(this.mergeValue(a),this.setFlowSaved(this.showFlow.index,a),a.Action="eventsave",!a.EventRequestId),e=this.showEvent.flows[this.showFlow.index].flowParts||[],s=0;s<e.length;s++)if("MyNumber"==e[s].showSection){
this.saveBtnDwnFlg=!0;break}teasp.manager.request("executeChangeRequest",a,this.pouch,{hideBusy:!0},this,function(e){this.requestCache.EventRequestId=e.requestEventId,a.EventRequestId=e.requestEventId,a.Action="eventsave",teasp.manager.request("executeAPIChangeRequest",a,this.pouch,{hideBusy:!0},this,function(e){this.resetMyNumberAttachment(),this.mergeValue(null,e),this.setFlowSaved(this.showFlow.index),
this.finishSaveFlow(t)},function(t){1==o?(a.Action="eventdelete",teasp.manager.request("executeChangeRequest",a,this.pouch,{hideBusy:!1},this,function(e){this.requestCache.EventRequestId=null,teasp.message.alertError(t),teasp.manager.dialogClose("BusyWait")},function(e){teasp.message.alertError(e),teasp.manager.dialogClose("BusyWait")})):(teasp.message.alertError(t),teasp.manager.dialogClose("BusyWait"))})},function(
e){null==this.requestCache.EventRequestId&&this.lockEventButton(!1),teasp.message.alertError(e),teasp.manager.dialogClose("BusyWait")})},teasp.dialog.ChangeEmp.prototype.finishSaveFlow=function(e){dojo.addClass(dojo.byId("flowCheck_"+this.showFlow.id),"png-sts005"),this.settingVisibleEventButton(),teasp.manager.dialogClose("BusyWait"),(e?dojo.hitch(this,this.openRequestFlow(this.getNextFlow())):dojo.hitch(this,
this.openRequestFlow(this.showFlow)))()},teasp.dialog.ChangeEmp.prototype.nextRequestFlow=function(){dojo.hitch(this,this.openRequestFlow(this.getNextFlow()))()},teasp.dialog.ChangeEmp.prototype.getNextFlow=function(){for(var e=0;e<this.showEvent.flows.length;e++){var t=this.showEvent.flows[e];if(t.id==this.showFlow.id&&this.showEvent.flows.length>e+1)return this.showEvent.flows[e+1]}return null},
teasp.dialog.ChangeEmp.prototype.getFirstFlow=function(){return 0<this.showEvent.flows.length?this.showEvent.flows[0]:null},teasp.dialog.ChangeEmp.prototype.swapEventFlow=function(e,t){var a,o,s=dojo.byId("RequestView"),i=dojo.byId("RequestEvent"),n=dojo.byId("RequestFlow"),s=s.clientWidth;0==t?1==e?(dojo.style(i,"left","0px"),dojo.style(i,"display",""),dojo.style(n,"left",s+"px"),dojo.style(n,"display","none")):(
dojo.style(i,"left","-"+s+"px"),dojo.style(i,"display","none"),dojo.style(n,"left","0px"),dojo.style(n,"display","")):(1==e?(a=dojo.fx.slideTo({node:i,duration:350,left:0,unit:"px",onBegin:function(){dojo.style(i,"display","")}}),this.setEventHandles("group",dojo.connect(a,"onBegin",function(){dojo.style(i,"display","")})),o=dojo.fx.slideTo({node:n,duration:350,left:s,unit:"px",onEnd:function(){dojo.style(n,"display"
,"none")}}),this.setEventHandles("group",dojo.connect(o,"onEnd",function(){dojo.style(n,"display","none")}))):(a=dojo.fx.slideTo({node:i,duration:350,left:-1*s,unit:"px"}),this.setEventHandles("group",dojo.connect(a,"onEnd",function(){dojo.style(i,"display","none")})),o=dojo.fx.slideTo({node:n,duration:350,left:0,unit:"px"}),this.setEventHandles("group",dojo.connect(o,"onBegin",function(){dojo.style(n,"display","")})
)),a.play(),o.play())},teasp.dialog.ChangeEmp.prototype.lockEventButton=function(e){var t=dojo.query("#GroupCategory select")[0],a=dojo.byId("RequestReturnEvent");t&&(t.disabled=e),a&&dojo.style(a,"visibility",e?"hidden":"")},teasp.dialog.ChangeEmp.activeButton=function(e,t,a){"number"==typeof t&&t<0?dojo.style(e,"display","none"):(dojo.style(e,"display",""),dojo.query("button","string"==typeof nodeId?dojo.byId(e):e
).forEach(function(e){dojo.toggleClass(e,a,t),dojo.toggleClass(e,a+"-disabled",!t),e.disabled=!t}))},teasp.dialog.ChangeEmp.prototype.settingVisibleEventButton=function(e){var t=this.isLock(),a=this.showFlow&&this.showFlow.last||!1,o=this.canFlowSave(e),s=this.canDelete()?1:0,e=!e&&this.canRequest()?1:0,i=t?-1:o?1:0,o=t||a?-1:o?1:0,t=t&&!a?1:-1;teasp.dialog.ChangeEmp.activeButton("requestEventForm_DeleteBtn",s,
"red-button1"),teasp.dialog.ChangeEmp.activeButton("requestEventForm_SubmitBtn",e,"std-button1"),teasp.dialog.ChangeEmp.activeButton("requestFlowForm_SaveBtn",i,"std-button1"),teasp.dialog.ChangeEmp.activeButton("requestFlowForm_SaveNextBtn",o,"std-button1"),teasp.dialog.ChangeEmp.activeButton("requestFlowForm_NextBtn",t,"std-button1")},teasp.dialog.ChangeEmp.prototype.showSteps=function(){teasp.manager.dialogOpen(
"Status",{apply:{steps:this.getProcessInstanceStep()},removable:this.canCancel(),removeButtonType:1,cancelApply:this.cancelRequest,showCancelComment:!0},this.pouch,this,function(e){this.doCancelRequest(e.comment)})},teasp.dialog.ChangeEmp.prototype.cancelRequest=function(e,t){teasp.manager.dialogOpen("Comment",{dialogTitle:teasp.message.getLabel("cancelApply_btn_title"),okButtonTitle:teasp.message.getLabel(
"cancelApply_btn_title"),okButtonCss:"red-button1"},this.pouch,this,function(e){t(e)})},teasp.dialog.ChangeEmp.prototype.doCancelRequest=function(e){var t=this.getRequestCache(!0);t.Action="eventremove",t.Comment=e,this.employee.Id&&this.requestCache.FlowBody&&this.requestCache.FlowBody.SelectTarget__c&&(t.EMEmp=this.employee.Id==this.requestCache.FlowBody.SelectTarget__c.value?"true":"false"),
this.requestCache.FlowBody&&this.requestCache.FlowBody.MyNumberId__c&&(t.MyNumberId=this.requestCache.FlowBody.MyNumberId__c),teasp.manager.request("executeChangeRequest",t,this.pouch,{hideBusy:!1},this,function(e){teasp.manager.request("executeAPIChangeRequest",t,this.pouch,{hideBusy:!1},this,function(e){this.onfinishfunc(),this.close()},function(e){teasp.message.alertError(e)})},function(e){
teasp.message.alertError(e)})},teasp.dialog.ChangeEmp.prototype.getDispListValue=function(e,t){for(var a=this.getOptionsList()[e],o=0;o<a.length;o++){var s=a[o];if(s.value==t)return s.label}return t},teasp.dialog.ChangeEmp.prototype.hide=function(){this.free(),this.dialog.destroy(),teasp.manager.dialogRemove("ChangeEmp")},teasp.provide("teasp.dialog.ChangeHRMEmp"),teasp.dialog.ChangeHRMEmp=function(){console.log(
teasp),this.widthHint=870,this.heightHint=434,this.id="dialogChangeHRMEmp",this.title=teasp.message.getLabel("em10000000"),this.duration=1,
this.content='<table id="requestEdit_DialogChangeHRMEmpTable" class="dialogApplyTable" border="0" cellspacing="0" cellpadding="0">\x3c!--tr><td id="Request_Title"></td></tr--\x3e<tr><td><div id="ChangeRequestTable"><table style="width: 100%"><tr><td id="GroupCategory" style="display:none;"><div><select style="min-width:200px;"></select></div></td><td id="ChangeRequestInfo"></td><td style="text-align: right;"><table style="margin-left:auto;margin-right:0px;"><tbody id="Buttons"></tbody></table></td></tr><tr><td colspan="2"><table style="width: 100%;"><tbody><tr><td style="width:210px;height:400px;text-align: left; padding: 0px; vertical-align: top;"><div id="RequestView" style="height: 100%; position: relative; overflow-x: hidden"><div id="RequestEvent" style="width: 100%; position: absolute;"><table style="width: 100%;"><tbody id="RequestEventTable"></tbody></table></div><div id="RequestFlow" style="width: 100%; position: absolute;"><table style="width: 100%; height: 400px;"><tbody id="RequestFlowTable"></tbody></table></div></div></td><td style="text-align: left; padding: 0px 0px 0px 10px;"><div id="ChangeRequest"><table class="requestedit_form" style="width: 100%;"><tbody id="RequestEditForm"></tbody></table></div></td></tr></tbody></table></td></tr></table></div><div id="SubmitRequestTable"><table><tbody id="SubmitRequest"></tbody></table></div></td></tr></table>'
,this.client=null,this.eventHandles={},this.applyHandle={},this.editPattern={CLEAR:0,NEW:1,EDIT:2,APPLYING:3,APPROVED:4},this.loadRequestId=null,this.showEvent=null,this.showFlow=null,this.localAutoId=1,this.requestCache={},this.saveBtnDwnFlg=!1,this.mskMyNumber=null,this.isMynumberAttached=!1,this.constInvalidValuePickListFields=[],this.invalidValuePickListFields=[],this.hasOpenedRequestFlow=!1,
this.isPickListLimitedRelease=!1,this.activatePickListLimitedRelease&&this.activatePickListLimitedRelease(),this.OLD_PEOPLE_ENGLISH_LABEL="Old people",this.isPickListAlertInNewChangeRequest,this.SECTION_LIST_TO_REMOVE_TARGET=["RemoveAccounts"],this.CHANGE_REQUEST_FIELD_NAME_MAP={Dependents__r:{DependentsDisabilityKbn__c:"DisabilityKbn__c"}},this.fieldList={MyNumber1:{label:teasp.message.getLabel("em10000400"),
fields:[{name:"MyNumberPurposeUse",type:"label"}],foreignKey:"1"},SelectTarget:{label:teasp.message.getLabel("em10000820"),fields:[{name:"SelectTarget__c",label:teasp.message.getLabel("em10000830"),type:"SelectTarget",isRequired:!0}],foreignKey:"1"},MyNumber:{label:teasp.message.getLabel("em10000400"),fields:[{name:"MyNumber__c",label:teasp.message.getLabel("em10000400"),type:"text",dataType:"String",length:12,
isRequired:!0},{name:"MyNumberAttachment0",label:teasp.message.getLabel("em10000870"),type:"myNumberFile",filedescription:"1",dataType:"File",isRequired:!0},{name:"MyNumberAttachmentLabel0",label:teasp.message.getLabel("tk10000110"),type:"myNumberLabel",filedescription:"1"},{name:"MyNumberAttachment1",label:teasp.message.getLabel("em10000880"),type:"myNumberFile",filedescription:"2",dataType:"File",isRequired:!0},{
name:"MyNumberAttachmentLabel1",label:teasp.message.getLabel("tk10000110"),type:"myNumberLabel",filedescription:"2"}],foreignKey:"1"},AverableDateforName:{label:teasp.message.getLabel("em10003700"),fields:[{name:"AverableDate__c",label:teasp.message.getLabel("em10003700"),dataType:"Date",isRequired:!0}],foreignKey:"3"},Name:{label:teasp.message.getLabel("empName_label"),fields:[{name:"EmpName_LastName__c",
label:teasp.message.getLabel("em10000910"),dataType:"String",length:80,fieldName:"LastName__c",isRequired:!0},{name:"EmpName_FirstName__c",label:teasp.message.getLabel("empName_label"),dataType:"String",length:40,fieldName:"FirstName__c"},{name:"EmpName_Kana_LastName__c",label:teasp.message.getLabel("em10000920"),dataType:"String",length:80},{name:"EmpName_Kana_FirstName__c",label:teasp.message.getLabel("em10000260"
),dataType:"String",length:40},{name:"EmpName_Document_LastName__c",label:teasp.message.getLabel("em10000930"),dataType:"String",length:80},{name:"EmpName_Document_FirstName__c",label:teasp.message.getLabel("em10000270"),dataType:"String",length:40},{name:"EmpName_Document_Kana_LastName__c",label:teasp.message.getLabel("em10001910"),dataType:"String",length:80},{name:"EmpName_Document_Kana_FirstName__c",
label:teasp.message.getLabel("em10001920"),dataType:"String",length:40},{name:"BusinessLastName__c",label:teasp.message.getLabel("em10003710"),dataType:"String",length:80},{name:"BusinessFirstName__c",label:teasp.message.getLabel("em10003720"),dataType:"String",length:40},{name:"BusinessLastNameKana__c",label:teasp.message.getLabel("em10003730"),dataType:"String",length:80},{name:"BusinessFirstNameKana__c",
label:teasp.message.getLabel("em10003740"),dataType:"String",length:40},{name:"EmpName_English_LastName__c",label:teasp.message.getLabel("em10004330"),dataType:"String",length:80},{name:"EmpName_English_FirstName__c",label:teasp.message.getLabel("em10004340"),dataType:"String",length:40},{name:"Reason_ChangeName__c",label:teasp.message.getLabel("em10003180"),type:"TextArea",dataType:"String",length:255}],
foreignKey:"3"},PublicDeed:{label:teasp.message.getLabel("em10003750"),fields:[{name:"PublicDeed__c",label:teasp.message.getLabel("em10003750"),type:"File",filedescription:"1",dataType:"File"}],foreignKey:"3"},ReissueInfo:{label:teasp.message.getLabel("em10003760"),fields:[{name:"ReissueIdCard__c",label:teasp.message.getLabel("em10003770"),type:"SelectReissue"},{name:"ReissueNameTag__c",label:teasp.message.getLabel(
"em10003780"),type:"SelectReissue"},{name:"ReissueBusinessCard__c",label:teasp.message.getLabel("em10003790"),type:"SelectReissue"},{name:"ReissueRemarks__c",label:teasp.message.getLabel("em10003800"),type:"TextArea",dataType:"String",length:255}],foreignKey:"3"},Contact:{label:teasp.message.getLabel("em10000850"),fields:[{name:"AverableDate__c",label:teasp.message.getLabel("em10003700"),dataType:"Date",isRequired:!0
},{name:"Phone__c",label:teasp.message.getLabel("em10000280"),dataType:"String",length:255},{name:"ExtentionNumber__c",label:teasp.message.getLabel("em10000290"),dataType:"String",length:80},{name:"MobilePhone__c",label:teasp.message.getLabel("em10000300"),dataType:"String",length:255},{name:"CellularPhone__c",label:teasp.message.getLabel("em10003190"),dataType:"String",length:255},{name:"Email__c",
label:teasp.message.getLabel("em10000310"),dataType:"String",length:255}],foreignKey:"2"},SelfContact:{label:teasp.message.getLabel("em10000860"),fields:[{name:"AverableDate__c",label:teasp.message.getLabel("em10003700"),dataType:"Date",isRequired:!0},{name:"SelfPhone__c",label:teasp.message.getLabel("em10000350"),dataType:"String",length:255},{name:"SelfMobilePhone__c",label:teasp.message.getLabel("em10000360"),
dataType:"String",length:255},{name:"SelfEmail__c",label:teasp.message.getLabel("em10000370"),dataType:"String",length:255}],foreignKey:"5"},AverableDateforAddress:{label:teasp.message.getLabel("em10003700"),fields:[{name:"AverableDate__c",label:teasp.message.getLabel("em10003700"),dataType:"Date",isRequired:!0}],foreignKey:"4"},Address:{label:teasp.message.getLabel("em10000410"),fields:[{name:"PostalCode__c",
label:teasp.message.getLabel("em10000420"),dataType:"String",length:8},{name:"State__c",label:teasp.message.getLabel("em10000430"),dataType:"String",length:80},{name:"City__c",label:teasp.message.getLabel("em10000440"),dataType:"String",length:80},{name:"Street__c",label:teasp.message.getLabel("em10000450"),type:"TextArea",dataType:"String",length:255},{name:"State_Kana__c",label:teasp.message.getLabel("em10000460"),
dataType:"String",length:80},{name:"City_Kana__c",label:teasp.message.getLabel("em10000470"),dataType:"String",length:80},{name:"Street_Kana__c",label:teasp.message.getLabel("em10000480"),type:"TextArea",dataType:"String",length:255},{name:"CompanyHouse__c",label:teasp.message.getLabel("em10003200"),dataType:"String",length:255}],foreignKey:"4"},ResidentAddress:{label:teasp.message.getLabel("em10000840"),fields:[{
name:"EqualResident__c",label:teasp.message.getLabel("em10000490"),dataType:"Boolean"},{name:"copyAddressbutton",label:" ",buttonlabel:teasp.message.getLabel("em10004730"),type:"button",dataType:"button",eventHandlesRegisterFnc:function(e,t){e.setEventHandles("flow",dojo.connect(t,"onclick",e,e.copyToInputFormResidentAddressInfo))}},{name:"PostalCode_Resident__c",label:teasp.message.getLabel("em10000520"),
dataType:"String",length:8},{name:"State_Resident__c",label:teasp.message.getLabel("em10000530"),dataType:"String",length:80},{name:"City_Resident__c",label:teasp.message.getLabel("em10000540"),dataType:"String",length:80},{name:"Street_Resident__c",label:teasp.message.getLabel("em10000550"),type:"TextArea",dataType:"String",length:255},{name:"State_Resident_Kana__c",label:teasp.message.getLabel("em10004390"),
dataType:"String",length:250},{name:"City_Resident_Kana__c",label:teasp.message.getLabel("em10004400"),dataType:"String",length:250},{name:"Street_Resident_Kana__c",label:teasp.message.getLabel("em10004410"),type:"TextArea",dataType:"String",length:255},{name:"HeadOfFamilyLastName__c",label:teasp.message.getLabel("em10003810"),dataType:"String",length:80},{name:"HeadOfFamilyFirstName__c",label:teasp.message.getLabel(
"em10003820"),dataType:"String",length:40},{name:"HeadOfFamilyLastNameKana__c",label:teasp.message.getLabel("em10003830"),dataType:"String",length:80},{name:"HeadOfFamilyFirstNameKana__c",label:teasp.message.getLabel("em10003840"),dataType:"String",length:40},{name:"Rel_HeadOfFamily__c",label:teasp.message.getLabel("em10003230"),dataType:"String",length:255}],foreignKey:"4"},HomecomingAddress:{
label:teasp.message.getLabel("em10003850"),fields:[{name:"HometownFlg__c",label:teasp.message.getLabel("em10003240"),dataType:"Boolean"},{name:"PostalCode_Hometown__c",label:teasp.message.getLabel("em10003250"),dataType:"String",length:8},{name:"State_Hometown__c",label:teasp.message.getLabel("em10003260"),dataType:"String",length:80},{name:"City_Hometown__c",label:teasp.message.getLabel("em10003270"),
dataType:"String",length:80},{name:"Street_Hometown__c",label:teasp.message.getLabel("em10003280"),type:"TextArea",dataType:"String",length:255}],foreignKey:"4"},PersonalInfo:{label:teasp.message.getLabel("em10000320"),fields:[{name:"AverableDate__c",label:teasp.message.getLabel("em10003700"),dataType:"Date",isRequired:!0},{name:"SpouseFlg__c",label:teasp.message.getLabel("em10004450"),dataType:"Boolean"},{
name:"DeductionSpouse__c",label:teasp.message.getLabel("em10004460"),dataType:"Boolean"},{name:"WidowKbn__c",label:teasp.message.getLabel("em10004470"),type:"Select",dataType:"String"},{name:"DisabilityGrade__c",label:teasp.message.getLabel("em10000390"),type:"Select",dataType:"String"},{name:"DisabilityKbn__c",label:teasp.message.getLabel("em10004350"),type:"Select",dataType:"String"},{name:"HandicappedKbn__c",
label:teasp.message.getLabel("em10004480"),type:"Select",dataType:"String"},{name:"Disability__c",label:teasp.message.getLabel("em10004380"),type:"File",filedescription:"1",dataType:"File"},{name:"WorkingStudent__c",label:teasp.message.getLabel("em10004490"),dataType:"Boolean"},{name:"StudentCard__c",label:teasp.message.getLabel("em10004500"),type:"File",filedescription:"2",dataType:"File"}],foreignKey:"16"},
Emergency:{label:teasp.message.getLabel("em10000380"),fields:[{name:"AverableDate__c",label:teasp.message.getLabel("em10003700"),dataType:"Date",isRequired:!0},{name:"LastName_Emergency__c",label:teasp.message.getLabel("em10003860"),dataType:"String",length:80},{name:"FirstName_Emergency__c",label:teasp.message.getLabel("em10003870"),dataType:"String",length:80},{name:"LastNameKana_Emergency__c",
label:teasp.message.getLabel("em10003880"),dataType:"String",length:80},{name:"FirstNameKana_Emergency__c",label:teasp.message.getLabel("em10003890"),dataType:"String",length:80},{name:"Rel_Emergency__c",label:teasp.message.getLabel("em10003320"),dataType:"String",length:255},{name:"EmergencyContact__c",label:teasp.message.getLabel("em10003330"),dataType:"String",length:255},{name:"Tel_Emergency__c",
label:teasp.message.getLabel("em10004220"),dataType:"String",length:255},{name:"PostalCode_Emergency__c",label:teasp.message.getLabel("em10003340"),dataType:"String",length:8},{name:"State_Emergency__c",label:teasp.message.getLabel("em10003350"),dataType:"String",length:80},{name:"City_Emergency__c",label:teasp.message.getLabel("em10003360"),dataType:"String",length:80},{name:"Street_Emergency__c",
label:teasp.message.getLabel("em10003370"),type:"TextArea",dataType:"String",length:255},{name:"State_Emergency_Kana__c",label:teasp.message.getLabel("em10004420"),dataType:"String",length:250},{name:"City_Emergency_Kana__c",label:teasp.message.getLabel("em10004430"),dataType:"String",length:250},{name:"Street_Emergency_Kana__c",label:teasp.message.getLabel("em10004440"),type:"TextArea",dataType:"String",length:255}
],foreignKey:"6"},BusinessTrip:{label:teasp.message.getLabel("em10003380"),fields:[{name:"AverableDate__c",label:teasp.message.getLabel("em10003700"),dataType:"Date",isRequired:!0},{name:"DestinationPostalCode__c",label:teasp.message.getLabel("em10003390"),dataType:"String",length:8},{name:"DestinationState__c",label:teasp.message.getLabel("em10003400"),dataType:"String",length:80},{name:"DestinationCity__c",
label:teasp.message.getLabel("em10003410"),dataType:"String",length:80},{name:"DestinationStreet__c",label:teasp.message.getLabel("em10003420"),type:"TextArea",dataType:"String",length:255},{name:"DestinationPhone__c",label:teasp.message.getLabel("em10003430"),dataType:"String",length:255}],foreignKey:"11"},AverableDateforNationality:{label:teasp.message.getLabel("em10003700"),fields:[{name:"AverableDate__c",
label:teasp.message.getLabel("em10003700"),dataType:"Date",isRequired:!0}],foreignKey:"7"},Nationality:{label:teasp.message.getLabel("em10000560"),fields:[{name:"ResidencePeriod__c",label:teasp.message.getLabel("em10000580"),dataType:"Date"},{name:"ResidenceStatus__c",label:teasp.message.getLabel("em10000590"),dataType:"String",length:250},{name:"IsPermissionEngage__c",label:teasp.message.getLabel("em10000600"),
dataType:"Boolean"},{name:"PermissionEngageDetail__c",label:teasp.message.getLabel("em10000630"),type:"TextArea",dataType:"String",length:32768}],foreignKey:"7"},ResidenceCard:{label:teasp.message.getLabel("em10003900"),fields:[{name:"ResidenceCardObverse__c",label:teasp.message.getLabel("em10003910"),type:"File",filedescription:"1",dataType:"File"},{name:"ResidenceCardReverse__c",label:teasp.message.getLabel(
"em10003920"),type:"File",filedescription:"2",dataType:"File"}],foreignKey:"7"},AverableDateforPassport:{label:teasp.message.getLabel("em10003700"),fields:[{name:"AverableDate__c",label:teasp.message.getLabel("em10003700"),dataType:"Date",isRequired:!0}],foreignKey:"12"},Passport:{label:teasp.message.getLabel("em10003440"),fields:[{name:"PassportLastName__c",label:teasp.message.getLabel("em10003930"),
dataType:"String",length:80},{name:"PassportFirstName__c",label:teasp.message.getLabel("em10003940"),dataType:"String",length:80},{name:"PassportPublishCountry__c",label:teasp.message.getLabel("em10003460"),dataType:"String",length:250},{name:"PassportNo__c",label:teasp.message.getLabel("em10003470"),dataType:"String",length:80},{name:"PermanentResidence__c",label:teasp.message.getLabel("em10003480"),
dataType:"String",length:80},{name:"Nationality__c",label:teasp.message.getLabel("em10003490"),dataType:"String",length:80},{name:"PassportPublishDate__c",label:teasp.message.getLabel("em10003500"),dataType:"Date"},{name:"PassportAvailable__c",label:teasp.message.getLabel("em10003510"),dataType:"Date"}],foreignKey:"12"},PassportPic:{label:teasp.message.getLabel("em10003950"),fields:[{name:"Passport__c",
label:teasp.message.getLabel("em10003950"),type:"File",filedescription:"1",dataType:"File"}],foreignKey:"12"},AverableDateforInsertDependents:{label:teasp.message.getLabel("em10003700"),fields:[{name:"AverableDate__c",label:teasp.message.getLabel("em10003700"),dataType:"Date",isRequired:!0}],foreignKey:"8"},InsertDependents:{label:teasp.message.getLabel("em10003960"),fields:[{name:"DependentName_LastName__c",
label:teasp.message.getLabel("em10003970"),dataType:"String",length:80,fieldName:"LastName__c",isRequired:!0},{name:"DependentName_FirstName__c",label:teasp.message.getLabel("em10003980"),dataType:"String",length:40,fieldName:"FirstName__c"},{name:"DependentName_Kana_LastName__c",label:teasp.message.getLabel("em10003990"),dataType:"String",length:80,fieldName:"Name_Kana_LastName__c"},{
name:"DependentName_Kana_FirstName__c",label:teasp.message.getLabel("em10004000"),dataType:"String",length:40,fieldName:"Name_Kana_FirstName__c"},{name:"Relation__c",label:teasp.message.getLabel("em10000670"),type:"Select",dataType:"String",isRequired:!0},{name:"OtherRelation__c",label:teasp.message.getLabel("em10000680"),dataType:"String",length:80},{name:"NotificationDate__c",label:teasp.message.getLabel(
"em10003520"),dataType:"Date"},{name:"DivorceBereavementKbn__c",label:teasp.message.getLabel("em10003530"),type:"Select",dataType:"String"},{name:"Gender__c",label:teasp.message.getLabel("em10000330"),type:"Select",dataType:"String"},{name:"Birth__c",label:teasp.message.getLabel("em10000340"),dataType:"Date"},{name:"Job__c",label:teasp.message.getLabel("em10000690"),dataType:"String",length:255},{
name:"EqualAddress__c",label:teasp.message.getLabel("em10000700"),dataType:"Boolean"},{name:"copyAddressbutton",label:" ",buttonlabel:teasp.message.getLabel("em10004720"),type:"button",dataType:"button",eventHandlesRegisterFnc:function(e,t){e.setEventHandles("flow",dojo.connect(t,"onclick",e,e.copyToInputFormAddressInfo))}},{name:"PostalCode__c",label:teasp.message.getLabel("em10000420"),dataType:"String",length:8},{
name:"State__c",label:teasp.message.getLabel("em10000430"),dataType:"String",length:80},{name:"City__c",label:teasp.message.getLabel("em10000440"),dataType:"String",length:80},{name:"Street__c",label:teasp.message.getLabel("em10000450"),type:"TextArea",dataType:"String",length:255},{name:"State_Kana__c",label:teasp.message.getLabel("em10000460"),dataType:"String",length:250},{name:"City_Kana__c",
label:teasp.message.getLabel("em10000470"),dataType:"String",length:250},{name:"Street_Kana__c",label:teasp.message.getLabel("em10000480"),type:"TextArea",dataType:"String",length:255},{name:"IsNonresident__c",label:teasp.message.getLabel("em10004740"),dataType:"Boolean"},{name:"DependentsPhone__c",label:teasp.message.getLabel("em10003540"),dataType:"String",length:80},{name:"Income__c",label:teasp.message.getLabel(
"em10004230"),type:"Integer",dataType:"String",length:10},{name:"FamilyAllowance__c",label:teasp.message.getLabel("em10004240"),type:"Select",dataType:"String"},{name:"IsNationalPensionNo3__c",label:teasp.message.getLabel("em10000730"),dataType:"Boolean"},{name:"HealthInsuranceSubscription__c",label:teasp.message.getLabel("em10001900"),type:"Select",dataType:"String"},{name:"SocialInsuranceDivision__c",
label:teasp.message.getLabel("em10000970"),type:"Select",dataType:"String",isRequired:!0},{name:"DisabilityGrade__c",label:teasp.message.getLabel("em10000740"),type:"Select",dataType:"String"},{name:"DependentsDisabilityKbn__c",label:teasp.message.getLabel("em10004350"),type:"Select",dataType:"String"},{name:"Reason__c",label:teasp.message.getLabel("em10004310"),type:"TextArea",dataType:"String",length:255}],
foreignKey:"8"},InsertSpousePublicDeed:{label:teasp.message.getLabel("em10003750"),fields:[{name:"DependentsPublicDeed__c",label:teasp.message.getLabel("em10003750"),type:"File",filedescription:"1",dataType:"File"},{name:"DependentsDisability__c",label:teasp.message.getLabel("em10004380"),type:"File",filedescription:"2",dataType:"File"}],foreignKey:"8"},AverableDateforUpdateDependents:{label:teasp.message.getLabel(
"em10003700"),fields:[{name:"AverableDate__c",label:teasp.message.getLabel("em10003700"),dataType:"Date",isRequired:!0}],foreignKey:"9"},UpdateDependents:{label:teasp.message.getLabel("em10004010"),fields:[{name:"SelectTarget__c",label:teasp.message.getLabel("em10004010"),type:"SelectDependents",isRequired:!0},{name:"DependentName_LastName__c",label:teasp.message.getLabel("em10003970"),dataType:"String",length:80,
fieldName:"LastName__c",isRequired:!0},{name:"DependentName_FirstName__c",label:teasp.message.getLabel("em10003980"),dataType:"String",length:40,fieldName:"FirstName__c"},{name:"DependentName_Kana_LastName__c",label:teasp.message.getLabel("em10003990"),dataType:"String",length:80,fieldName:"Name_Kana_LastName__c"},{name:"DependentName_Kana_FirstName__c",label:teasp.message.getLabel("em10004000"),dataType:"String",
length:40,fieldName:"Name_Kana_FirstName__c"},{name:"Relation__c",label:teasp.message.getLabel("em10000670"),type:"Select",dataType:"String",isRequired:!0},{name:"OtherRelation__c",label:teasp.message.getLabel("em10000680"),dataType:"String",length:80},{name:"NotificationDate__c",label:teasp.message.getLabel("em10003520"),dataType:"Date"},{name:"DivorceBereavementKbn__c",label:teasp.message.getLabel("em10003530"),
type:"Select",dataType:"String"},{name:"Gender__c",label:teasp.message.getLabel("em10000330"),type:"Select",dataType:"String"},{name:"Birth__c",label:teasp.message.getLabel("em10000340"),dataType:"Date"},{name:"Job__c",label:teasp.message.getLabel("em10000690"),dataType:"String",length:255},{name:"EqualAddress__c",label:teasp.message.getLabel("em10000700"),dataType:"Boolean"},{name:"copyAddressbutton",label:" ",
buttonlabel:teasp.message.getLabel("em10004720"),type:"button",dataType:"button",eventHandlesRegisterFnc:function(e,t){e.setEventHandles("flow",dojo.connect(t,"onclick",e,e.copyToInputFormAddressInfo))}},{name:"PostalCode__c",label:teasp.message.getLabel("em10000420"),dataType:"String",length:8},{name:"State__c",label:teasp.message.getLabel("em10000430"),dataType:"String",length:80},{name:"City__c",
label:teasp.message.getLabel("em10000440"),dataType:"String",length:80},{name:"Street__c",label:teasp.message.getLabel("em10000450"),type:"TextArea",dataType:"String",length:255},{name:"State_Kana__c",label:teasp.message.getLabel("em10000460"),dataType:"String",length:250},{name:"City_Kana__c",label:teasp.message.getLabel("em10000470"),dataType:"String",length:250},{name:"Street_Kana__c",label:teasp.message.getLabel(
"em10000480"),type:"TextArea",dataType:"String",length:255},{name:"IsNonresident__c",label:teasp.message.getLabel("em10004740"),dataType:"Boolean"},{name:"DependentsPhone__c",label:teasp.message.getLabel("em10003540"),dataType:"String",length:80},{name:"Income__c",label:teasp.message.getLabel("em10004230"),type:"Integer",dataType:"String",length:10},{name:"FamilyAllowance__c",label:teasp.message.getLabel("em10004240"
),type:"Select",dataType:"String"},{name:"IsNationalPensionNo3__c",label:teasp.message.getLabel("em10000730"),dataType:"Boolean"},{name:"HealthInsuranceSubscription__c",label:teasp.message.getLabel("em10001900"),type:"Select",dataType:"String"},{name:"SocialInsuranceDivision__c",label:teasp.message.getLabel("em10000970"),type:"Select",dataType:"String",isRequired:!0},{name:"DisabilityGrade__c",
label:teasp.message.getLabel("em10000740"),type:"Select",dataType:"String"},{name:"DependentsDisabilityKbn__c",label:teasp.message.getLabel("em10004350"),type:"Select",dataType:"String"},{name:"Reason__c",label:teasp.message.getLabel("em10004310"),type:"TextArea",dataType:"String",length:255}],foreignKey:"9"},UpdateSpousePublicDeed:{label:teasp.message.getLabel("em10003750"),fields:[{name:"DependentsPublicDeed__c",
label:teasp.message.getLabel("em10003750"),type:"File",filedescription:"1",dataType:"File"},{name:"DependentsDisability__c",label:teasp.message.getLabel("em10004380"),type:"File",filedescription:"2",dataType:"File"}],foreignKey:"9"},AverableDateforInsertAccounts:{label:teasp.message.getLabel("em10003700"),fields:[{name:"AverableDate__c",label:teasp.message.getLabel("em10003700"),dataType:"Date",isRequired:!0}],
foreignKey:"13"},InsertAccounts:{label:teasp.message.getLabel("em10003550"),fields:[{name:"Kbn__c",label:teasp.message.getLabel("em10003560"),type:"Select",dataType:"String",isRequired:!0},{name:"BankName__c",label:teasp.message.getLabel("em10003570"),dataType:"String",length:80,fieldName:"Name",isRequired:!0},{name:"BankCode__c",label:teasp.message.getLabel("em10003580"),dataType:"String",length:80},{
name:"BranchName__c",label:teasp.message.getLabel("em10003590"),dataType:"String",length:80},{name:"BranchCode__c",label:teasp.message.getLabel("em10003600"),dataType:"String",length:80},{name:"AccountType__c",label:teasp.message.getLabel("em10003610"),type:"Select",dataType:"String"},{name:"AccountNo__c",label:teasp.message.getLabel("em10003620"),dataType:"String",length:80},{name:"AccountHolder__c",
label:teasp.message.getLabel("em10003630"),dataType:"String",length:80},{name:"BankAccountMemo__c",label:teasp.message.getLabel("em10003650"),type:"TextArea",dataType:"String",length:255},{name:"MaximumAmount__c",label:teasp.message.getLabel("em10003660"),type:"Integer",dataType:"String",length:17}],foreignKey:"13"},InsertAccountDocs:{label:teasp.message.getLabel("em10004030"),fields:[{name:"BankAccountsDocument__c",
label:teasp.message.getLabel("em10004030"),type:"File",filedescription:"1",dataType:"File"}],foreignKey:"13"},AverableDateforUpdateAccounts:{label:teasp.message.getLabel("em10003700"),fields:[{name:"AverableDate__c",label:teasp.message.getLabel("em10003700"),dataType:"Date",isRequired:!0}],foreignKey:"14"},UpdateAccounts:{label:teasp.message.getLabel("em10004040"),fields:[{name:"SelectTarget__c",
label:teasp.message.getLabel("em10004040"),type:"SelectAccounts",isRequired:!0},{name:"Kbn__c",label:teasp.message.getLabel("em10003560"),type:"Select",dataType:"String",isRequired:!0},{name:"BankName__c",label:teasp.message.getLabel("em10003570"),dataType:"String",length:80,fieldName:"Name",isRequired:!0},{name:"BankCode__c",label:teasp.message.getLabel("em10003580"),dataType:"String",length:80},{
name:"BranchName__c",label:teasp.message.getLabel("em10003590"),dataType:"String",length:80},{name:"BranchCode__c",label:teasp.message.getLabel("em10003600"),dataType:"String",length:80},{name:"AccountType__c",label:teasp.message.getLabel("em10003610"),type:"Select",dataType:"String"},{name:"AccountNo__c",label:teasp.message.getLabel("em10003620"),dataType:"String",length:80},{name:"AccountHolder__c",
label:teasp.message.getLabel("em10003630"),dataType:"String",length:80},{name:"BankAccountMemo__c",label:teasp.message.getLabel("em10003650"),type:"TextArea",dataType:"String",length:255},{name:"MaximumAmount__c",label:teasp.message.getLabel("em10003660"),type:"Integer",dataType:"String",length:17}],foreignKey:"14"},UpdateAccountDocs:{label:teasp.message.getLabel("em10004030"),fields:[{name:"BankAccountsDocument__c",
label:teasp.message.getLabel("em10004030"),type:"File",filedescription:"1",dataType:"File"}],foreignKey:"14"},RemoveAccounts:{label:teasp.message.getLabel("em10004050"),fields:[{name:"AverableDate__c",label:teasp.message.getLabel("em10003700"),dataType:"Date",isRequired:!0},{name:"SelectTarget__c",label:teasp.message.getLabel("em10004050"),type:"SelectAccounts",isRequired:!0}],foreignKey:"15"}}},
teasp.dialog.ChangeHRMEmp.prototype=new teasp.dialog.Base,teasp.dialog.ChangeHRMEmp.prototype.getOptionsList=function(){var e;return this.isPickListLimitedRelease?(e=this.getMaster("pickList")).TsDisplayMyNumber__c=[{value:"登録済み",label:teasp.message.getLabel("em10001640")},{value:"未登録",label:teasp.message.getLabel("em10001650")}]:e={Relation__c:[{value:"妻",label:teasp.message.getLabel("em10001180")},{value:"夫",
label:teasp.message.getLabel("em10001190")},{value:"子",label:teasp.message.getLabel("em10001200")},{value:"父",label:teasp.message.getLabel("em10001210")},{value:"母",label:teasp.message.getLabel("em10001220")},{value:"祖父",label:teasp.message.getLabel("em10001230")},{value:"祖母",label:teasp.message.getLabel("em10001240")},{value:"兄",label:teasp.message.getLabel("em10001250")},{value:"弟",label:teasp.message.getLabel(
"em10001260")},{value:"姉",label:teasp.message.getLabel("em10001270")},{value:"妹",label:teasp.message.getLabel("em10001280")},{value:"その他",label:teasp.message.getLabel("em10001290")}],Gender__c:[{value:"",label:""},{value:"女性",label:teasp.message.getLabel("em10001310")},{value:"男性",label:teasp.message.getLabel("em10001300")}],DisabilityGrade__c:[{value:"",label:""},{value:"第14級",label:teasp.message.getLabel(
"em10001320")},{value:"第13級",label:teasp.message.getLabel("em10001330")},{value:"第12級",label:teasp.message.getLabel("em10001340")},{value:"第11級",label:teasp.message.getLabel("em10001350")},{value:"第10級",label:teasp.message.getLabel("em10001360")},{value:"第9級",label:teasp.message.getLabel("em10001370")},{value:"第8級",label:teasp.message.getLabel("em10001380")},{value:"第7級",label:teasp.message.getLabel("em10001390")},{
value:"第6級",label:teasp.message.getLabel("em10001400")},{value:"第5級",label:teasp.message.getLabel("em10001410")},{value:"第4級",label:teasp.message.getLabel("em10001420")},{value:"第3級",label:teasp.message.getLabel("em10001430")},{value:"第2級",label:teasp.message.getLabel("em10001440")},{value:"第1級",label:teasp.message.getLabel("em10001450")}],DependentsDisabilityKbn__c:[{value:"",label:""},{value:"一般",
label:teasp.message.getLabel("em10001460")},{value:"特別",label:teasp.message.getLabel("em10004360")},{value:"同居特別",label:teasp.message.getLabel("em10004370")}],SocialInsuranceDivision__c:[{value:"対象外",label:teasp.message.getLabel("em10001490")},{value:"一般",label:teasp.message.getLabel("em10001460")},{value:"特定",label:teasp.message.getLabel("em10001470")},{value:"同居老親等",label:teasp.message.getLabel("em10004190")},{
value:"同居老親等以外の者",label:teasp.message.getLabel("em10004200")},{value:"配偶者特別控除",label:teasp.message.getLabel("em10004210")}],HealthInsuranceSubscription__c:[{value:"",label:""},{value:"対象",label:teasp.message.getLabel("em10001150")},{value:"対象外",label:teasp.message.getLabel("em10001160")}],DivorceBereavementKbn__c:[{value:"",label:""},{value:"結婚",label:teasp.message.getLabel("em10004080")},{value:"離縁",
label:teasp.message.getLabel("em10004090")},{value:"死別",label:teasp.message.getLabel("em10004100")},{value:"失踪",label:teasp.message.getLabel("em10004110")}],FamilyAllowance__c:[{value:"",label:""},{value:"対象",label:teasp.message.getLabel("em10001150")},{value:"対象外",label:teasp.message.getLabel("em10001160")}],TsDisplayMyNumber__c:[{value:"登録済み",label:teasp.message.getLabel("em10001640")},{value:"未登録",
label:teasp.message.getLabel("em10001650")}],ReissueIdCard__c:[{value:"",label:""},{value:"不要",label:teasp.message.getLabel("em10004070")},{value:"必要",label:teasp.message.getLabel("em10004060")}],ReissueNameTag__c:[{value:"",label:""},{value:"不要",label:teasp.message.getLabel("em10004070")},{value:"必要",label:teasp.message.getLabel("em10004060")}],ReissueBusinessCard__c:[{value:"",label:""},{value:"不要",
label:teasp.message.getLabel("em10004070")},{value:"必要",label:teasp.message.getLabel("em10004060")}],Kbn__c:[{value:"給与",label:teasp.message.getLabel("em10004120")},{value:"賞与",label:teasp.message.getLabel("em10004130")},{value:"経費",label:teasp.message.getLabel("em10004140")},{value:"キャッシュレス",label:teasp.message.getLabel("em10004150")},{value:"その他",label:teasp.message.getLabel("em10004160")}],AccountType__c:[{
value:"",label:""},{value:"普通",label:teasp.message.getLabel("em10004170")},{value:"当座",label:teasp.message.getLabel("em10004180")}],WidowKbn__c:[{value:"",label:""},{value:"寡婦・寡夫",label:teasp.message.getLabel("em10004510")},{value:"特別の寡婦",label:teasp.message.getLabel("em10004520")}],DisabilityKbn__c:[{value:"",label:""},{value:"一般",label:teasp.message.getLabel("em10001460")},{value:"特別",label:teasp.message.getLabel(
"em10004360")}],HandicappedKbn__c:[{value:"",label:""},{value:"区分1",label:teasp.message.getLabel("em10004530")},{value:"区分2",label:teasp.message.getLabel("em10004540")},{value:"区分3",label:teasp.message.getLabel("em10004550")},{value:"区分4",label:teasp.message.getLabel("em10004560")},{value:"区分5",label:teasp.message.getLabel("em10004570")},{value:"区分6",label:teasp.message.getLabel("em10004580")}]},e},
teasp.dialog.ChangeHRMEmp.prototype.ready=function(){this.client=this.args.client,this.loadRequestId=this.args.requestId,this.firstForeignKey=this.args.firstForeignKey},teasp.dialog.ChangeHRMEmp.prototype.preInit=function(){require(["dijit/layout/TabContainer","dijit/layout/ContentPane","dijit/Tooltip"]),dojo.require("dojo.fx")};teasp.dialog.ChangeHRMEmp.prototype.preStart=function(){dojo.connect(this.dialog,
"onCancel",this,function(){this.onfinishfunc(),this.close()}),dojo.style(dojo.byId("requestEdit_DialogChangeHRMEmpTable"),"width","870px"),dojo.style(dojo.byId("requestEdit_DialogChangeHRMEmpTable"),"height","420px"),dojo.query(".dijitDialogPaneContent",this.dialog.domNode).forEach(function(e){dojo.style(e,"background","#F0F0E1")});var e=dojo.byId("Buttons"),t=dojo.create("tr",null,e),a=(dojo.create("td",null,t),
dojo.create("td",{id:"requestEventForm_SubmitBtn"},t));div=dojo.create("div",{innerHTML:teasp.message.getLabel("em10000980")},dojo.create("button",{className:"std-button1-disabled",style:{margin:"4px 2px"},disabled:!0},a)),dojo.connect(a.firstChild,"onclick",this,this.submitRequestEvent),a=dojo.create("td",{id:"requestEventForm_DeleteBtn"},t),div=dojo.create("div",{innerHTML:teasp.message.getLabel("tf10005040")},
dojo.create("button",{className:"red-button1-disabled",style:{margin:"4px 2px"},disabled:!0},a)),dojo.connect(a.firstChild,"onclick",this,this.deleteRequestEvent),a=dojo.create("td",{id:"requestEventForm_CancelBtn"},t),div=dojo.create("div",{innerHTML:teasp.message.getLabel("cancel_btn_title")},dojo.create("button",{className:"std-button1 gry-button1",style:{margin:"4px 2px"}},a)),dojo.connect(a.firstChild,"onclick",
this,function(){this.onfinishfunc(),this.close()}),e=dojo.byId("RequestEditForm"),t=dojo.create("tr",null,e),a=dojo.create("td",{colSpan:5},t),div=dojo.create("div",{style:"height: 340px; overflow-y: auto;"},a),dojo.create("tbody",{id:"requestEditForm_tbody"},dojo.create("table",{className:"pane_table"},div)),e=dojo.byId("RequestEditForm"),t=dojo.create("tr",null,e),a=dojo.create("td",null,t),t=dojo.create("tr",null,
dojo.create("tbody",null,dojo.create("table",{style:"margin-left:auto;margin-right:0px;"},a))),a=dojo.create("td",{style:"display:none;",id:"requestFlowForm_SaveBtn"},t),div=dojo.create("div",{innerHTML:teasp.message.getLabel("tk10000289")},dojo.create("button",{className:"std-button1",style:{margin:"4px 2px"}},a)),dojo.connect(a.firstChild,"onclick",this,function(){this.saveRequestFlow(!1)}),a=dojo.create("td",{
style:"display:none;",id:"requestFlowForm_SaveNextBtn"},t),div=dojo.create("div",{innerHTML:teasp.message.getLabel("em10000990")},dojo.create("button",{className:"std-button1",style:{margin:"4px 2px"}},a)),dojo.connect(a.firstChild,"onclick",this,function(){this.saveRequestFlow(!0)}),a=dojo.create("td",{style:"display:none;",id:"requestFlowForm_NextBtn"},t),div=dojo.create("div",{innerHTML:teasp.message.getLabel(
"next_btn_title")},dojo.create("button",{className:"std-button1",style:{margin:"4px 2px"}},a)),dojo.connect(a.firstChild,"onclick",this,this.nextRequestFlow)},teasp.dialog.ChangeHRMEmp.prototype.preShow=function(){return dojo.empty(dojo.query("#GroupCategory select")[0]),dojo.empty(dojo.byId("RequestEventTable")),dojo.empty(dojo.byId("RequestFlowTable")),this.clearInfoArea(!0),dojo.empty(dojo.byId(
"requestEditForm_tbody")),this.employee=this.getMaster("HRMEmployee"),this.showEvent=null,this.showFlow=null,this.requestCache=null,this.saveBtnDwnFlg=!1,this.mskMyNumber=null,this.settingVisibleEventButton(),!0},teasp.dialog.ChangeHRMEmp.prototype.clearInfoArea=function(e){var t=dojo.byId("ChangeRequestInfo");dojo.empty(t),e&&(dojo.style("GroupCategory","display","none"),dojo.style(t,"display",""))},
teasp.dialog.ChangeHRMEmp.prototype.postShow=function(){this.clearEventHandles(),this.getRequestTemplate(),globalAttachedEvent=dojo.hitch(this,this.attachedEvent)},teasp.dialog.ChangeHRMEmp.prototype.getRequestTemplate=function(){teasp.manager.dialogOpen("BusyWait"),teasp.manager.request("getHRMEmployeeMaster",[this.loadRequestId],this.pouch,{hideBusy:!1},this,function(e){this.setMaster(e),
this.optionsList=this.getOptionsList();e=this.getRequestInfo();!e.Id||e.EventId__c?(this.createRequestTemplate(),this.swapEventFlow(!0,!1),this.loadRequestFlowParts(),this.firstForeignKey&&this.openRequestEventFromForeignKey(this.firstForeignKey),teasp.manager.dialogClose("BusyWait")):(teasp.manager.dialogClose("BusyWait"),this.close())},function(e){teasp.message.alertError(e),teasp.manager.dialogClose("BusyWait")})}
,teasp.dialog.ChangeHRMEmp.prototype.setMaster=function(e){this.master=e;for(var t=this.master.events||[],a=[],o={},s={},i=0;i<t.length;i++){var n=t[i];if(n.Contents__c&&n.Group__c){var r=n.Name,l=(!teasp.message.getLanguageLocaleKey()||"en"!=teasp.message.getLanguageLocaleKey()&&"en_US"!=teasp.message.getLanguageLocaleKey()||(r=n.Name_Eng__c),{id:n.Id,name:r,foreignKey:n.ForeignKey__c});try{var p=dojo.fromJson(
n.Contents__c);l.flows=p.flows||[]}catch(e){console.log("fromJson failed!"),console.log(n.Contents__c)}l.flows||(l.flows=[]),dojo.forEach(l.flows,function(e,t){e.id="f"+this.localAutoId++,e.index=t},this);r=n.Group__c;(d=s[r=!teasp.message.getLanguageLocaleKey()||"en"!=teasp.message.getLanguageLocaleKey()&&"en_US"!=teasp.message.getLanguageLocaleKey()?r:n.Group_Eng__c])||(d={id:"g"+this.localAutoId++,name:r,events:[]
},s[r]=d,a.push(d)),d.events.push(l),o[l.id]=l,dojo.forEach(l.flows||[],function(e){for(var t=e.flowParts||[],a=0;a<t.length;a++)t[a].id="p"+this.localAutoId++},this)}}this.master.groups=a,this.master.events=o,this.master.pickList=this.master.pickList[0];for(i=0;i<a.length;i++)for(var d=a[i],c=0;c<d.events.length;c++)for(var m=(l=d.events[c]).flows||[],h=0;h<m.length;h++){var u=m[h];h==m.length-1&&(u.last=!0)}},
teasp.dialog.ChangeHRMEmp.prototype.getMaster=function(e){return this.master&&this.master[e]||null||this.pouch.getKeyObj(e)},teasp.dialog.ChangeHRMEmp.prototype.initRequestCache=function(e,t){if(this.requestCache={EventRequestId:null,EmpId:this.getMaster("sessionInfo").emp.id,EMEmpId:this.employee.Id,EventId:null,FlowBody:null,_status:null,_alias:{},_attached:{},_mnAttached:{},_required:{},_requiredAttach:{},_tmp:{}}
,e){this.requestCache.EventRequestId=e.Id,this.requestCache.EventId=e.HRMEventId__c,this.requestCache._status=e.TSHRM&&e.TSHRM.Status__c||null,teasp.constant.STATUS_FIX.contains(this.requestCache._status)&&(this.requestCache._readOnly=!0);var a=e.TSHRM&&e.TSHRM.FlowBody__c||e.FlowBody__c||null;if(a)try{this.requestCache.FlowBody=dojo.fromJson(a)}catch(e){}for(var o=e.TSHRM&&e.TSHRM.Attachments||[],s=0;s<o.length;s++
){var i=o[s];i.Description&&(this.requestCache._attached[i.Description]=i)}var n=e.TSHRM&&e.TSHRM.MyNumberAttachments&&e.TSHRM.MyNumberAttachments||null;if(n)for(var r=0;r<n.length;r++){var l=n[r];l&&l.Type&&(this.requestCache._mnAttached[l.Type]=l)}}else t&&(this.requestCache.EventId=t.id);this.storeRequiredAttach()},teasp.dialog.ChangeHRMEmp.prototype.storeRequiredAttach=function(){var e;this.requestCache&&(
this.requestCache._requiredAttach={},e=this.getMaster("events")[this.requestCache.EventId],dojo.forEach(e.flows||[],function(e){for(var t=e.flowParts||[],a=0;a<t.length;a++){var o=t[a];switch(o.recordType){case"Attachment":o.isRequired&&(this.requestCache._requiredAttach[o.attachmentDescription]={type:"file"});break;case"EmployeeEdit":for(var s=this.fieldList[o.showSection],i=0;i<s.fields.length;i++){
var n=s.fields[i],r=(n.type||n.dataType||"").toLowerCase();!n.isRequired||"file"!=r&&"mynumberfile"!=r||(this.requestCache._requiredAttach[n.filedescription]={type:r})}}}},this))},teasp.dialog.ChangeHRMEmp.prototype.isLackAttach=function(e){var t,a=(e||this.requestCache)._requiredAttach||{};for(t in a)if(0!=this.checkShowIdentityDocument(a[t].type,t))if(a.hasOwnProperty(t))if(!("file"==a[t].type?this.getAttachObj(t
):this.getMnAttachObj(t)))return!0;return!1},teasp.dialog.ChangeHRMEmp.prototype.getRequestInfo=function(){var e=this.getMaster("request");return e&&e.TSHRM||{}},teasp.dialog.ChangeHRMEmp.prototype.getApplyDatetime=function(e){var t=this.getMaster("request"),a=t&&t.ApplyDatetime__c;return(a=!a&&t&&t.TSHRM&&(teasp.constant.STATUS_FIX.contains(e)||teasp.constant.STATUS_REJECTS.contains(e))&&t.TSHRM.ApplyDatetime__c?(
a=moment(t.TSHRM.ApplyDatetime__c.replace("T"," ")),teasp.util.date.formatDateTime(a.toDate(),"SLA-HM",!0)):a&&teasp.util.date.formatDateTime(a,"SLA-HM"))||""},teasp.dialog.ChangeHRMEmp.prototype.getProcessInstanceStep=function(){var e=this.getMaster("request");return teasp.logic.convert.convTSEMApplySteps(e&&e.TSHRM&&e.TSHRM.ProcessInstanceStep||[])},teasp.dialog.ChangeHRMEmp.prototype.getRequestCache=function(e){
if(e){var t,a=dojo.clone(this.requestCache);for(t in a)a.hasOwnProperty(t)&&"_"==t.substring(0,1)&&delete a[t];return a.FlowBody&&a.FlowBody.MyNumber__c&&this.mskMyNumber&&(a.FlowBody.MyNumber__c=this.mskMyNumber),a.connectIP=connectIP,a}return this.requestCache},teasp.dialog.ChangeHRMEmp.prototype.setApiName=function(e,t){e&&t&&(this.requestCache._alias[e]=t)},teasp.dialog.ChangeHRMEmp.prototype.getApiName=function(
e){return this.requestCache._alias[e]||e},teasp.dialog.ChangeHRMEmp.prototype.isSaved=function(){return this.requestCache&&this.requestCache.EventRequestId},teasp.dialog.ChangeHRMEmp.prototype.isMyNumberAttachable=function(){return!!(this.requestCache&&this.requestCache.EventRequestId&&this.requestCache.FlowBody&&this.requestCache.FlowBody.MyNumberId__c)},teasp.dialog.ChangeHRMEmp.prototype.isLock=function(){
return this.requestCache&&this.requestCache.EventRequestId&&teasp.constant.STATUS_FIX.contains(this.requestCache._status)},teasp.dialog.ChangeHRMEmp.prototype.canRequest=function(){if(!this.showEvent||!this.requestCache||!this.requestCache.EventRequestId||this.isLock())return!1;for(var e=0;e<this.showEvent.flows.length;e++)if(this.showEvent.flows[e].isRequired&&!this.isFlowSaved(e))return!1;return!this.isLackAttach()
},teasp.dialog.ChangeHRMEmp.prototype.canDelete=function(){return this.requestCache&&this.requestCache.EventRequestId&&!teasp.constant.STATUS_FIX.contains(this.requestCache._status)},teasp.dialog.ChangeHRMEmp.prototype.canCancel=function(){return this.requestCache&&this.requestCache.EventRequestId&&teasp.constant.STATUS_WAIT==this.requestCache._status},teasp.dialog.ChangeHRMEmp.prototype.getAttachObj=function(e){
return this.requestCache&&this.requestCache._attached&&this.requestCache._attached[e]||null},teasp.dialog.ChangeHRMEmp.prototype.getMnAttachObj=function(e){return this.requestCache&&this.requestCache._mnAttached&&this.requestCache._mnAttached[e]||null},teasp.dialog.ChangeHRMEmp.prototype.setFlowSaved=function(e,t){t=t||this.requestCache;t&&(t.FlowBody||(t.FlowBody={}),t.FlowBody._flowSaved||(t.FlowBody._flowSaved=[])
,t.FlowBody._flowSaved.indexOf(e)<0&&t.FlowBody._flowSaved.push(e))},teasp.dialog.ChangeHRMEmp.prototype.isFlowSaved=function(e,t){t=t||this.requestCache;return!!(t&&t.FlowBody&&t.FlowBody._flowSaved)&&0<=t.FlowBody._flowSaved.indexOf(e)},teasp.dialog.ChangeHRMEmp.prototype.canFlowSave=function(e){return this.isLack()?-1:this.showFlow&&!this.isFlowSaved(this.showFlow.index)||e?1:0},
teasp.dialog.ChangeHRMEmp.prototype.getOrgValueMap=function(e){if(this.requestCache&&this.requestCache.FlowBody)return this.requestCache.FlowBody;var t={},a=[];return e.flowParts.forEach(function(e){this.fieldList[e.showSection].fields.forEach(function(e){a.push(e)},this)},this),a.forEach(function(e){this.employee.hasOwnProperty(e.name)&&(t[e.name]={dataType:e.dataType,value:this.employee[e.name]})},this),t},
teasp.dialog.ChangeHRMEmp.prototype.getOrgValue=function(e){var t=this.employee||{},a=this.getSavedValue(e);if(a)return a.value||"boolean"!=typeof a.value&&null;a=this.getApiName(e);if("MyNumber__c"!=e)return t[a];e=this.getSavedValue("SelectTarget__c");if(e){if(t.Id==e.value)return t[a];t=this.getRefer("Dependents__r",e.value);if(t)return t[a];t=this.getRefer("Bank__r",e.value);if(t)return t[a]}return""},
teasp.dialog.ChangeHRMEmp.prototype.getSavedValue=function(e){var t=this.requestCache.FlowBody||{};return e?t[e]:t},teasp.dialog.ChangeHRMEmp.prototype.setSavedValue=function(e,t,a){this.requestCache.FlowBody||(this.requestCache.FlowBody={}),this.requestCache.FlowBody[e]={dataType:t,value:a}},teasp.dialog.ChangeHRMEmp.prototype.getRefer=function(e,t){for(var a=((this.employee||{})[e]||{}).records||[],
o=0;o<a.length;o++)if(a[o].Id==t)return a[o];return{}},teasp.dialog.ChangeHRMEmp.prototype.getDispValue=function(e,t,a){a=a?a[this.getApiName(e)]:this.getOrgValue(e),a&&"object"==typeof a&&(a=a.value||null),e=t.toLowerCase();return"date"==e?(t="","???"==(t=a?teasp.util.date.formatDate(a,"SLA"):t)?a:t):"boolean"==e?!!a:null!=a?a:""},teasp.dialog.ChangeHRMEmp.prototype.resetTemporary=function(){this.requestCache._tmp={
FlowBody:{}}},teasp.dialog.ChangeHRMEmp.prototype.getTemporary=function(){return this.requestCache._tmp&&this.requestCache._tmp.FlowBody},teasp.dialog.ChangeHRMEmp.prototype.getTempValue=function(e){var t=this.getTemporary();return t&&t[e]&&t[e].value||null},teasp.dialog.ChangeHRMEmp.prototype.setDispValue=function(e,t,a){var o=a||null,s=t.toLowerCase();"date"==s&&o?"???"==(o=teasp.util.date.formatDate(o))&&(o=a
):"boolean"==s&&(o=!!o),this.getTemporary()[e]={type:t,value:o}},teasp.dialog.ChangeHRMEmp.prototype.isChanged=function(){if(!this.showFlow)return!1;var e,t=this.getTemporary();for(e in t)if(t.hasOwnProperty(e))if((t[e]&&t[e].value)!=this.getOrgValue(e))return!0;return!1},teasp.dialog.ChangeHRMEmp.prototype.isLack=function(){if(!this.showFlow)return!1;var e,t=this.getTemporary();for(e in t)if(t.hasOwnProperty(e
)&&this.isRequiredField(e)&&t[e]&&null==t[e].value)return!0;return!1},teasp.dialog.ChangeHRMEmp.prototype.clearRequiredField=function(){this.requestCache._required={}},teasp.dialog.ChangeHRMEmp.prototype.setRequiredField=function(e){this.requestCache._required[e]=1},teasp.dialog.ChangeHRMEmp.prototype.isRequiredField=function(e){return!!this.requestCache._required[e]},
teasp.dialog.ChangeHRMEmp.prototype.resetMyNumber=function(){var t,a,o=this.getTemporary();o.IsChangeMyNumber=!1,this.requestCache.FlowBody&&(t=this.requestCache.FlowBody.MyNumberId__c,a=this.requestCache.FlowBody.MyNumber__c,dojo.query('input[fieldName="MyNumber__c"]').forEach(function(e){t&&a.value!=e.value&&(o.IsChangeMyNumber=!0,this.mskMyNumber=null)}))},
teasp.dialog.ChangeHRMEmp.prototype.resetMyNumberAttachment=function(){var e,t,a;this.requestCache.FlowBody&&(e=this.requestCache.FlowBody.MyNumberId__c,t=this.requestCache.FlowBody.MyNumber__c,(a=dojo.query('input[fieldName="MyNumber__c"]')[0])&&e&&t.value!=a.value&&(this.requestCache._mnAttached={}))},teasp.dialog.ChangeHRMEmp.prototype.mergeValue=function(e,t){var a=e||this.requestCache;if(a){a.FlowBody||(
a.FlowBody={});var o=this.getTemporary();for(s in o)o.hasOwnProperty(s)&&(a.FlowBody[s]=o[s]||null);if(t)for(var s in t)"result"!=s&&t.hasOwnProperty(s)&&(a.FlowBody[s]=t[s])}},teasp.dialog.ChangeHRMEmp.prototype.blurField=function(e){this.settingFlowValue(),this.settingVisibleEventButton(this.isChanged())},teasp.dialog.ChangeHRMEmp.prototype.keypressField=function(e){""===e.keyChar&&13===e.keyCode?(
this.settingFlowValue(),this.settingVisibleEventButton(this.isChanged())):(this.settingFlowValue(),this.settingVisibleEventButton(!0))},teasp.dialog.ChangeHRMEmp.prototype.setEventHandles=function(e,t){(this.eventHandles[e]||(this.eventHandles[e]=[])).push(t)},teasp.dialog.ChangeHRMEmp.prototype.clearEventHandles=function(e){if(e){for(var t=this.eventHandles[e]||[],a=t.length-1;0<=a;a--)dojo.disconnect(t[a]),
delete t[a];delete this.eventHandles[e]}else for(var o in this.eventHandles)o&&this.eventHandles.hasOwnProperty(o)&&this.clearEventHandles(o)},teasp.dialog.ChangeHRMEmp.prototype.loadRequestFlowParts=function(){var e,t,a,o=dojo.byId("ChangeRequestInfo");dojo.empty(o),dojo.style("GroupCategory","display",this.loadRequestId?"none":""),dojo.style(o,"display",this.loadRequestId?"":"none"),this.loadRequestId?(
e=this.getMaster("request"),this.initRequestCache(e),e=this.getRequestInfo(),a=teasp.message.getLabel("tm10001590"),t=dojo.create("div",{className:"request-info-group"},o),dojo.create("div",{className:"request-info-c",innerHTML:teasp.message.getLabel("em10001110")+a},t),dojo.create("span",{innerHTML:e.Name||"&nbsp;"},dojo.create("div",{className:"request-info-v"},t)),t=dojo.create("div",{
className:"request-info-group"},o),dojo.create("div",{className:"request-info-c",innerHTML:teasp.message.getLabel("applyDate_label")+a},t),dojo.create("span",{innerHTML:this.getApplyDatetime(e.Status__c)||"&nbsp;"},dojo.create("div",{className:"request-info-v"},t)),dojo.create("div",{className:"request-info-c",innerHTML:teasp.message.getLabel("statusj_head")+a},t),o=dojo.create("button",{className:"std-button2"},
dojo.create("div",{className:"request-info-btn"},t)),dojo.create("div",{innerHTML:teasp.constant.getDisplayStatus(e.Status__c)||"&nbsp;"},o),this.setEventHandles("top",dojo.connect(o,"onclick",this,this.showSteps)),(a=this.getMaster("events")[this.requestCache.EventId])&&dojo.hitch(this,this.openRequestEvent(a,!1))(),this.settingVisibleEventButton(),this.lockEventButton(!0)):this.lockEventButton(!1)},
teasp.dialog.ChangeHRMEmp.prototype.createRequestTemplate=function(){for(var e=dojo.query("#GroupCategory select")[0],t=(dojo.create("option",{value:"",innerHTML:teasp.message.getLabel("em10001000")},e),dojo.byId("RequestEventTable")),a=this.getMaster("groups"),o={},s=0;s<a.length;s++){var i=a[s];dojo.create("option",{value:i.id,innerHTML:i.name},e);for(var n=0;n<i.events.length;n++){var r=i.events[n];o[r.id]||(
this.settingEvent(t,r),o[r.id]=!0)}}this.setEventHandles("top",dojo.connect(e,"onchange",this,this.changeGroup))},teasp.dialog.ChangeHRMEmp.prototype.changeGroup=function(){for(var e=dojo.query("#GroupCategory select")[0].value,t=new Array,a={},o=!1,s=this.getMaster("groups"),i=0;i<s.length;i++){var n=s[i];if(n.id==e||""==e){for(var r=0;r<n.events.length;r++)a[(p=n.events[r]).id]||(t.push(p),a[p.id]=!0);o=!0}}if(o){
var l=dojo.byId("RequestEventTable");dojo.empty(l),this.clearEventHandles("group");for(r=0;r<t.length;r++){var p=t[r];this.settingEvent(l,p)}}},teasp.dialog.ChangeHRMEmp.prototype.settingEvent=function(e,t){e=dojo.create("tr",null,e),e=dojo.create("span",{innerHTML:t.name},dojo.create("td",{className:"SelectEvent",id:"event_"+t.id},e));this.setEventHandles("group",dojo.connect(e,"onclick",this,this.openRequestEvent(t
,!0)))},teasp.dialog.ChangeHRMEmp.prototype.openRequestEvent=function(p,d){return function(){this.clearEventHandles("group2"),this.requestCache&&!d||this.initRequestCache(null,p);var e=this.getMaster("events"),t=p.flows,a=dojo.byId("RequestFlowTable"),o=(dojo.empty(a),dojo.create("tr",null,a)),s=dojo.create("span",{innerHTML:teasp.message.getLabel("em10001010")},dojo.create("td",{className:"RequestReturnEvent",
id:"RequestReturnEvent"},o)),i=(this.setEventHandles("group2",dojo.connect(s,"onclick",this,function(){this.swapEventFlow(!0,!0),dojo.hitch(this,this.openRequestFlow(null))()})),o=dojo.create("tr",null,a),dojo.create("div",{innerHTML:p.name},dojo.create("td",{className:"RequestEventTitle"},o))),s=(o=dojo.create("tr",{style:"height: 100%;"},a),dojo.create("div",{className:"RequestFlowList"},dojo.create("td",{
style:"vertical-align:top;"},o)));o=dojo.create("tr",null,a),(i=dojo.create("div",null,dojo.create("td",{className:"RequestFlowRequiredAnnotation",colspan:4},o))).innerHTML=teasp.message.getLabel("em10001020",teasp.message.getLabel("em10001030"));for(var a=dojo.create("tbody",null,dojo.create("table",{style:"width: 100%;"},s)),n=0;n<t.length;n++){var r=t[n],o=dojo.create("tr",null,a),l=dojo.create("td",{
style:"vertical-align: top; height: 24px;"},o),l=(r.isRead||(i=dojo.create("div",{className:"RequestFlowCheck",id:"flowCheck_"+r.id},l),this.isFlowSaved(n)&&dojo.addClass(i,"png-sts005")),l=dojo.create("td",{style:"vertical-align: top;"},o),r.isRead||(i=dojo.create("div",{innerHTML:r.isRequired?"*":"",className:"RequestFlowRequired"},l)),"");r.name_msgId?l=teasp.message.getLabel(r.name_msgId):(l=r.name,
!teasp.message.getLanguageLocaleKey()||"en"!=teasp.message.getLanguageLocaleKey()&&"en_US"!=teasp.message.getLanguageLocaleKey()||(l=r.name_eng)),i=dojo.create("div",{innerHTML:n+1+" "+l},dojo.create("td",{className:"RequestSelectFlow",id:"FlowName_"+r.id,style:"vertical-align: top; text-align: left;"},o)),this.setEventHandles("group2",dojo.connect(i,"onclick",this,this.openRequestFlow(r))),i=dojo.create("div",{
innerHTML:"▶",style:"visibility: hidden;"},dojo.create("td",{className:"RequestSelectMarkFlow",id:"FlowSelect_"+r.id,style:"text-align: right;"},o))}this.swapEventFlow(!1,d),this.showEvent=e[p.id],this.isPickListLimitedRelease&&this.validatePickListField(this.getSavedValue(),this.master.pickList),dojo.hitch(this,this.openRequestFlow(this.getFirstFlow()))()}},
teasp.dialog.ChangeHRMEmp.prototype.openRequestEventFromForeignKey=function(e){for(var t=this.getMaster("events"),a=Object.keys(t),o=0;o<a.length;o++){var s=t[a[o]];if(s.foreignKey===e){dojo.hitch(this,this.openRequestEvent(s,!1))();break}}dojo.style(dojo.query("#RequestReturnEvent span")[0],"display","none"),dojo.style(dojo.query("#GroupCategory select")[0],"display","none")},
teasp.dialog.ChangeHRMEmp.prototype.openRequestFlow=function(s){return function(){this.clearEventHandles("flow"),this.clearRequiredField(),this.showFlow=s,this.hasSelectedTargetRecord=!1,s&&0===Object.keys(this.getSavedValue()).length?this.validatePickListField(this.getOrgValueMap(s),this.getOptionsList()):this.isPickListAlertInNewChangeRequest&&(this.invalidValuePickListFields=[],this.validatePickListField(
this.getSavedValue(),this.getOptionsList()));var e=dojo.byId("requestEditForm_tbody");if(dojo.empty(e),dojo.query(".RequestSelectMarkFlow div",dojo.byId("RequestFlowList")).forEach(function(e){dojo.style(e,"visibility","hidden")}),s){dojo.style(dojo.byId("FlowSelect_"+s.id).firstChild,"visibility","visible");for(var t,a=s.flowParts||[],o=0;o<a.length;o++)this.createRequestEditForm(e,a[o]);
this.isPickListLimitedRelease&&(this.validateInvalidFieldForm(this.constInvalidValuePickListFields),0!==this.invalidValuePickListFields.length&&(!this.hasOpenedRequestFlow||this.invalidFlow&&this.invalidFlow.showSection===this.showFlow.flowParts[0].showSection)&&(t=teasp.manager.dialogs.BusyWait?200:0,setTimeout(function(){this.openInvalidFieldAlert(this.invalidValuePickListFields)}.bind(this),t)),
this.hasOpenedRequestFlow||(this.hasOpenedRequestFlow=!0))}this.settingVisibleEventButton()}},teasp.dialog.ChangeHRMEmp.prototype.createRequestEditForm=function(e,t){var a=!teasp.message.getLanguageLocaleKey()||"en"!==teasp.message.getLanguageLocaleKey()&&"en_US"!==teasp.message.getLanguageLocaleKey()?"ja_JP":"en_US",o=(1==t.isShowParts&&(o=dojo.create("tr",null,e),(s=dojo.create("td",{
style:"padding-bottom: 2px; text-align: left;"},o)).innerHTML=teasp.message.getLabel("tf10006410",t.name),"en_US"==a&&(s.innerHTML=teasp.message.getLabel("tf10006410",t.name_eng))),dojo.create("tr",null,e)),s=dojo.create("td",{style:"padding-bottom: 8px;"},o),i=dojo.create("tbody",null,dojo.create("table",{className:"request_Form",style:"border-collapse:separate;border-spacing:3px;"},s));switch(
this.showSection=t.showSection,t.recordType){case"EmployeeEdit":if(dijit.Tooltip.showDelay=0,dijit.Tooltip.hideDelay=0,!t.showSection)break;for(var n=this.fieldList[t.showSection],r=(this.foreignKey=n.foreignKey,this.master.fieldSetting&&this.master.fieldSetting[n.foreignKey]?this.master.fieldSetting[n.foreignKey]:null),l=0;l<n.fields.length;l++){var p=n.fields[l],d=p.type,c=r&&r[p.name]?r[p.name].tooltip[a]:"",
c=c?teasp.util.entitize(c).replace(/\n/g,"<br>"):"";if(0!=this.checkShowIdentityDocument(d,p.filedescription)){this.setApiName(p.name,p.fieldName),o=dojo.create("tr",null,i),s=dojo.create("td",{className:"RequestFieldRequired"},o),p.isRequired&&(dojo.create("div",{innerHTML:"*"},s),this.setRequiredField(p.name)),p.label&&dojo.create("div",{innerHTML:p.label},dojo.create("td",{className:"left",
style:"padding-bottom:2px;text-align:left;"},o));var m,h=dojo.create("td",null,o),u=(c&&(h=dojo.create("div",{className:"common-set-help-on"},h),new dijit.Tooltip({connectId:[h],label:c,position:["below"],hideDelay:10,style:"margin: 20px;background-color:blue;"})),s=dojo.create("td",{className:"right",colSpan:p.label?"1":"2",style:"padding-bottom:2px;text-align:left;"},o),dojo.create("div",null,s));if(d
)d=d.toLowerCase();else switch(p.dataType){case"Boolean":d="checkbox";break;case"Date":d="date";break;default:d="text"}switch(d){case"label":"MyNumberPurposeUse"==p.name&&(m=this.master.setting.MyNumberPurposeUse||"",m=(m=(m=(m=teasp.message.getLabel("em10001630")+":<br />"+m).replace(/\r\n/g,"<br />")).replace(/\n/g,"<br />")).replace(/\r/g,"<br />"),dojo.create("div",{id:p.name,innerHTML:m,style:"font-size: 125%;"}
,u));break;case"selecttarget":var g=dojo.create("select",{id:p.name,fieldName:p.name,dataType:"String"},u),y=this.getDispListValue("TsDisplayMyNumber__c",this.employee.TsDisplayMyNumber__c);if(dojo.create("option",{value:this.employee.Id,innerHTML:teasp.message.getLabel("em10001060",this.employee.Name,y||"")},g),j=this.employee.Dependents__r)for(var f=0;f<j.records.length;f++){var b=j.records[f],
y=this.getDispListValue("TsDisplayMyNumber__c",b.TsDisplayMyNumber__c),_=this.getDispListValue("Relation__c",b.Relation__c);dojo.create("option",{value:b.Id,innerHTML:teasp.message.getLabel("em10001070",b.Name,_||"",y||"")},g)}this.isFlowSaved(this.showFlow.index)||(g.value=this.employee.Id,this.setSavedValue(p.name,"String",this.employee.Id));break;case"mynumberfile":this.settingMyNumberFileAttach(u,
p.filedescription);break;case"mynumberlabel":this.settingMyNumberLabelAttach(u,p.filedescription);break;case"selectreissue":for(var g=dojo.create("select",{id:p.name,fieldName:p.name,dataType:"String"},u),v=this.optionsList[p.name]||[],f=0;f<v.length;f++){var T=v[f];dojo.create("option",{value:T.value,innerHTML:T.label},g)}!this.isFlowSaved(this.showFlow.index)&&v.length&&(g.value=v[0].value,this.setSavedValue(p.name
,"String",v[0].value||null));break;case"selectdependents":for(var g=dojo.create("select",{id:p.name,fieldName:p.name,dataType:"String"},u),j=this.employee.Dependents__r&&this.employee.Dependents__r.records||[],f=0;f<j.length;f++){b=j[f],_=this.getDispListValue("Relation__c",b.Relation__c);dojo.create("option",{value:b.Id,innerHTML:teasp.message.getLabel("em10001500",b.Name,_||"")},g)}j.length&&(this.setEventHandles(
"flow",dojo.connect(g,"onchange",this,function(){this.settingSelectTargetField("Dependents__r","SelectTarget__c")})),this.isFlowSaved(this.showFlow.index)||(g.value=j[0].Id,this.setSavedValue(p.name,"String",j[0].Id)));break;case"selectaccounts":var g=dojo.create("select",{id:p.name,fieldName:p.name,dataType:"String"},u),E=this.employee.Bank__r&&this.employee.Bank__r.records||[];
0!==E.length&&"承認待ち"!==this.requestCache._status&&"承認済み"!==this.requestCache._status&&(E=E.filter(function(e){return e.ValidFlag__c}));for(f=0;f<E.length;f++){var L=E[f],k=this.getDispListValue("Kbn__c",L.Kbn__c),k=L.Name+" "+(L.BranchName__c||"")+(k?"："+k:"");dojo.create("option",{value:L.Id,innerHTML:k},g)}E.length&&(this.setEventHandles("flow",dojo.connect(g,"onchange",this,function(){
this.settingSelectTargetField("Bank__r","SelectTarget__c")})),this.isFlowSaved(this.showFlow.index)||(g.value=E[0].Id,this.setSavedValue(p.name,"String",E[0].Id)));break;case"date":dojo.create("input",{type:"text",style:"width:96px;text-align:center;",id:p.name,fieldName:p.name,dataType:"Date"},u),this.isLock()||(m=dojo.create("input",{type:"button",style:"margin:2px;",className:"pp_base pp_btn_cal"},u),
this.setEventHandles("flow",dojo.connect(m,"onclick",this,this.settingCalendar(p.name))));break;case"integer":g=dojo.create("input",{type:"text",id:p.name,fieldName:p.name,maxlength:p.length,dataType:p.dataType},u);this.setEventHandles("flow",dojo.connect(g,"onchange",this,function(e){var t=parseInt(e.target.value,10);e.target.value=t==t?t:""}));break;case"select":for(g=dojo.create("select",{id:p.name,
fieldName:p.name,dataType:"String"},u),v=this.optionsList[p.name]||[],f=0;f<v.length;f++){T=v[f];dojo.create("option",{value:T.value,innerHTML:T.label},g)}!this.isFlowSaved(this.showFlow.index)&&v.length&&(g.value=v[0].value);break;case"file":this.settingFileAttachNoSave(u,p.filedescription);break;case"textarea":dojo.create("textarea",{rows:5,cols:75,style:"width:300px;",id:p.name,fieldName:p.name,maxlength:p.length,
dataType:"String"},u);break;case"button":this.isLock()?(dojo.query(".common-set-help-on",o).forEach(function(e){dojo.destroy(e)}),dojo.style(o,"height","0")):p.eventHandlesRegisterFnc(this,dojo.create("input",{type:p.type,value:p.buttonlabel,id:p.name},u));break;default:g=dojo.create("input",{type:d,id:p.name,fieldName:p.name,maxlength:p.length,dataType:p.dataType},u);"MyNumber__c"==p.name&&(this.setEventHandles(
"flow",dojo.connect(g,"onkeyup",this,function(){this.changedMyNumber()})),dojo.create("div",{id:"myNumberInfo",style:"display: none;"},u))}}}break;case"Description":var D="";t.description_msgId?D=teasp.message.getLabel(t.description_msgId):(D=t.description,!teasp.message.getLanguageLocaleKey()||"en"!=teasp.message.getLanguageLocaleKey()&&"en_US"!=teasp.message.getLanguageLocaleKey()||(D=t.description_eng)),
o=dojo.create("tr",null,i),dojo.create("td",{style:"width:8px;"},o),dojo.create("div",{innerHTML:D},dojo.create("td",{className:"right",colSpan:"2",style:"padding-bottom:2px;text-align:left;"},o))}switch(t.showSection){case"InsertDependents":this.isFlowSaved(this.showFlow.index)?this.settingLoadDataFlowParts():this.settingLoadDataFlowParts(this.getSavedValue()),this.settingFlowValue();break;case"UpdateDependents":
this.settingLoadDataFlowParts(),this.isFlowSaved(this.showFlow.index)?this.settingFlowValue():this.settingSelectTargetField("Dependents__r","SelectTarget__c");break;case"InsertAccounts":this.isFlowSaved(this.showFlow.index)?this.settingLoadDataFlowParts():this.settingLoadDataFlowParts(this.getSavedValue()),this.settingFlowValue();break;case"UpdateAccounts":this.settingLoadDataFlowParts(),this.isFlowSaved(
this.showFlow.index)?this.settingFlowValue():this.settingSelectTargetField("Bank__r","SelectTarget__c");break;case"MyNumber":this.settingLoadDataFlowParts();default:this.settingLoadDataFlowParts(),this.settingFlowValue()}this.settingVisibleEventButton()},teasp.dialog.ChangeHRMEmp.prototype.selectDependent=function(e){var t=null;if(e&&this.employee.Dependents__r)for(
var a=0;a<this.employee.Dependents__r.records.length;a++)this.employee.Dependents__r.records[a].Id==e&&(t=this.employee.Dependents__r.records[a]);return t},teasp.dialog.ChangeHRMEmp.prototype.checkShowIdentityDocument=function(e,t){var a=null;return this.requestCache.FlowBody&&this.requestCache.FlowBody.SelectTarget__c&&(a=this.selectDependent(this.requestCache.FlowBody.SelectTarget__c.value)),
!e||"mynumberlabel"!=e.toLowerCase()&&"mynumberfile"!=e.toLowerCase()||"2"!=t||!(0==this.master.setting.IsRequiredIdentityDocument&&!a||0==this.master.setting.IsRequiredIdentityDocumentDependent&&a&&0==a.IsNationalPensionNo3__c||0==this.master.setting.IsRequiredIdentityDocumentDependentNo3&&a&&1==a.IsNationalPensionNo3__c)},teasp.dialog.ChangeHRMEmp.prototype.settingSelectTargetField=function(o,s){var i,e;
0<=this.SECTION_LIST_TO_REMOVE_TARGET.indexOf(this.showSection)||(this.settingFlowValue(),i=this.getRefer(o,this.getTempValue(s)),e=dojo.byId("requestEditForm_tbody"),dojo.query("select",e).forEach(function(e){var a=dojo.getAttr(e,"fieldName");dojo.query("option",e).forEach(function(t){this.constInvalidValuePickListFields.forEach(function(e){e.value===t.value&&e.fieldName===a&&dojo.destroy(t)})},this)},this),
this.invalidValuePickListFields=[],this.isPickListAlertInNewChangeRequest=!1,this.validatePickListField(i,this.getOptionsList(),!0),dojo.query("select",e).forEach(function(a){var o=dojo.getAttr(a,"fieldName");this.invalidValuePickListFields.forEach(function(e){var t;e.fieldName===o&&(this.isPickListAlertInNewChangeRequest=!0,t=this.isEnglishAndOldPeople(e)?this.OLD_PEOPLE_ENGLISH_LABEL:e.value,dojo.create("option",{
value:e.value,innerHTML:t},a))},this)},this),dojo.query('input[type="text"],input[type="date"],select,textarea',e).forEach(function(e){var t=dojo.getAttr(e,"fieldName"),a=dojo.getAttr(e,"dataType");t&&a&&t!=s&&(t=this.convertChangeRequestFieldNameToMaster(t,o),e.value=this.getDispValue(t,a,i))},this),dojo.query('input[type="checkbox"]',e).forEach(function(e){var t=dojo.getAttr(e,"fieldName"),a=dojo.getAttr(e,
"dataType");t&&a&&(e.checked=this.getDispValue(t,a,i))},this),0===this.invalidValuePickListFields.length||!this.hasSelectedTargetRecord&&!this.isFlowSaved(this.showFlow.index)&&this.isPickListLimitedRelease||setTimeout(function(){this.openInvalidFieldAlert(this.invalidValuePickListFields)}.bind(this),50),this.hasSelectedTargetRecord||(this.hasSelectedTargetRecord=!0))},
teasp.dialog.ChangeHRMEmp.prototype.changedMyNumber=function(){var e=dojo.byId("MyNumber__c").value,t=dojo.query(".myNumberAttachment"),a=dojo.query(".myNumberAttachmentHide");if(this.requestCache.FlowBody&&this.requestCache.FlowBody.MyNumber__c&&this.requestCache.FlowBody.MyNumber__c.value==e&&this.isMyNumberAttachable()){for(var o=0;o<t.length;o++)dojo.style(t[o],"display","");for(o=0;o<a.length;o++)dojo.style(a[o]
,"display","none")}else{for(o=0;o<t.length;o++)dojo.style(t[o],"display","none");for(o=0;o<a.length;o++)dojo.style(a[o],"display","")}this.settingFlowValue(),this.settingVisibleEventButton(!0)},teasp.dialog.ChangeHRMEmp.prototype.settingFileAttachNoSave=function(e,t){dojo.attr(e,"filedescription",t);var a=this.getAttachObj(t);a?dojo.create("span",{innerHTML:a.Name||"",style:"margin-right:8px;color:#666;"},e
):this.isLock()&&dojo.create("div",{innerHTML:teasp.message.getLabel("em10001140"),style:"color:#666;"},e),this.isLock()||(a=dojo.create("input",{type:"button",value:teasp.message.getLabel("em10001080")},e),this.setEventHandles("flow",dojo.connect(a,"onclick",this,this.openAttachmentWindow(t))))},teasp.dialog.ChangeHRMEmp.prototype.settingFileAttach=function(e,t){var a;this.isSaved()?((a=this.getAttachObj(t)
)?dojo.create("span",{innerHTML:a.Name||"",style:"margin-right:8px;color:#666;"},e):this.isLock()&&dojo.create("div",{innerHTML:teasp.message.getLabel("em10001140"),style:"color:#666;"},e),this.isLock()||(a=dojo.create("input",{type:"button",value:teasp.message.getLabel("em10001080")},e),this.setEventHandles("flow",dojo.connect(a,"onclick",this,this.openAttachmentWindow(t))))):dojo.create("div",{
innerHTML:teasp.message.getLabel("em10001090"),style:"color:#666;"},e)},teasp.dialog.ChangeHRMEmp.prototype.settingMyNumberFileAttach=function(e,t){var a=this.isMyNumberAttachable(),o=this.getMnAttachObj(t),s=dojo.create("div",{className:"myNumberAttachment"},e);o?dojo.create("span",{innerHTML:o.Name||"",style:a?"margin-right:8px;color:#666;":NaN},s):this.isLock()&&dojo.create("div",{innerHTML:teasp.message.getLabel(
"em10001140"),style:a?"color:#666;":"color:#666;display: none;"},s),this.isLock()||(o=dojo.create("input",{type:"button",value:teasp.message.getLabel("em10001080"),style:a?"":"display: none;"},s),this.setEventHandles("flow",dojo.connect(o,"onclick",this,this.openMyNumberAttachmentWindow(t)))),dojo.create("div",{className:"myNumberAttachmentHide",innerHTML:teasp.message.getLabel("em10001580"),
style:a?"color:#666;display: none;":"color:#666;"},e)},teasp.dialog.ChangeHRMEmp.prototype.settingMyNumberLabelAttach=function(e,t){this.isMyNumberAttachable(),this.getMnAttachObj(t);1==t?dojo.create("div",{className:"myNumberAttachmentHide",innerHTML:teasp.message.getLabel("em10001670"),style:"color:#666;"},e):dojo.create("div",{className:"myNumberAttachmentHide",innerHTML:teasp.message.getLabel("em10001680"),
style:"color:#666;"},e)},teasp.dialog.ChangeHRMEmp.prototype.openAttachmentWindow=function(e){return function(){openAttachmentWindow(e,this.requestCache.EventRequestId,this.requestCache.EventId,this.requestCache.EmpId)}},teasp.dialog.ChangeHRMEmp.prototype.openMyNumberAttachmentWindow=function(t){return function(){var e;this.requestCache.EventRequestId&&this.requestCache.FlowBody.MyNumberId__c&&this.employee.Id&&(
e="",this.requestCache.FlowBody&&this.requestCache.FlowBody.SelectTarget__c&&(e=this.requestCache.FlowBody.SelectTarget__c.value),openMyNumberAttachmentWindow(t,this.requestCache.EventRequestId,this.requestCache.FlowBody.MyNumberId__c,this.employee.Id,e))}},teasp.dialog.ChangeHRMEmp.prototype.attachedEvent=function(e){var t;this.isMynumberAttached=!1,this.requestCache&&(
this.requestCache.EventRequestId==e.requestId||e.requestId)&&(null==this.requestCache.EventRequestId&&(this.requestCache.EventRequestId=e.requestId),e.isMyNumber?(t=(t=this.requestCache._mnAttached)||(this.requestCache._mnAttached={}),this.isMynumberAttached=!0,t[e.description]={Name:e.fname},dojo.hitch(this,this.openRequestFlow(this.showFlow))()):((t=(t=this.requestCache._attached)||(this.requestCache._attached={})
)[e.description]={Name:e.fname},this.showAttachedFileName(e.description,e.fname))),this.settingVisibleEventButton(!0)},teasp.dialog.ChangeHRMEmp.prototype.showAttachedFileName=function(e,t){var a,e=dojo.query('div[filedescription="'+e+'"]',dojo.byId("requestEditForm_tbody"))[0];e&&((a=dojo.query("span",e)).length?a[0].textContent=t:dojo.create("span",{textContent:t},e,"first"))},
teasp.dialog.ChangeHRMEmp.prototype.settingCalendar=function(a){return function(e){var t=teasp.util.date.parseDate(dojo.byId(a).value)||this.args.date||new Date;teasp.manager.dialogOpen("Calendar",{date:t,isDisabledDateFunc:function(e){return!1}},null,this,function(e){dojo.byId(a).value=teasp.util.date.formatDate(e,"SLA"),this.blurField()})}},teasp.dialog.ChangeHRMEmp.prototype.settingLoadDataFlowParts=function(i){
var n=this.isLock(),e=dojo.byId("requestEditForm_tbody");dojo.query('input[type="text"],input[type="date"],select,textarea',e).forEach(function(e){var t,a,o=dojo.getAttr(e,"fieldName"),s=dojo.getAttr(e,"dataType");this.setEventHandles("flow",dojo.connect(e,"onblur",this,this.blurField)),"SELECT"==e.nodeName?this.setEventHandles("flow",dojo.connect(e,"onchange",this,this.blurField)):this.setEventHandles("flow",
dojo.connect(e,"onkeypress",this,this.keypressField)),o&&s&&("MyNumber__c"==o?(this.requestCache&&this.requestCache.FlowBody&&this.requestCache.FlowBody.MyNumber__c?(this.saveBtnDwnFlg?(e.value=this.requestCache.FlowBody.MyNumber__c.value,this.requestCache.FlowBody.MskMyNumber&&(this.mskMyNumber=this.requestCache.FlowBody.MskMyNumber)):(this.mskMyNumber=this.requestCache.FlowBody.MyNumber__c,e.value=""),dojo.byId(
"myNumberInfo").innerHTML=teasp.message.getLabel("em10001640"),dojo.style("myNumberInfo","display","")):(this.mskMyNumber=null,e.value="",dojo.style("myNumberInfo","display","none")),this.requestCache.FlowBody.MskMyNumber&&delete this.requestCache.FlowBody.MskMyNumber):"SELECT"==e.nodeName&&"SelectTarget__c"!=o?(t=this.getDispValue(o,s,i),this.isPickListLimitedRelease&&t&&(a=!1,dojo.query("option",e).forEach(
function(e){e.innerHTML===t&&(a=!0)}),a||dojo.create("option",{value:t,innerHTML:t},e)),e.value=t||dojo.query("option",e)[0].value):e.value=this.getDispValue(o,s,i)),n&&(e.disabled=!0,"INPUT"!=e.nodeName&&"TEXTAREA"!=e.nodeName||(dojo.style(e,"background-color","#EEEEEE"),dojo.style(e,"border","1px solid #EEEEEE"),dojo.style(e,"padding","1px 2px")))},this),dojo.query('input[type="checkbox"]',e).forEach(function(e){
var t=dojo.getAttr(e,"fieldName"),a=dojo.getAttr(e,"dataType");this.setEventHandles("flow",dojo.connect(e,"onclick",this,this.blurField)),t&&a&&(e.checked=this.getDispValue(t,a,i)),n&&(e.disabled=!0)},this)},teasp.dialog.ChangeHRMEmp.prototype.settingFlowValue=function(){var e;this.requestCache&&(this.resetTemporary(),e=dojo.byId("requestEditForm_tbody"),dojo.query(
'input[type="text"],input[type="date"],select,textarea',e).forEach(function(e){var t=dojo.getAttr(e,"fieldName"),a=dojo.getAttr(e,"dataType");t&&a&&this.setDispValue(t,a,e.value)},this),dojo.query('input[type="checkbox"]',e).forEach(function(e){var t=dojo.getAttr(e,"fieldName"),a=dojo.getAttr(e,"dataType");t&&a&&this.setDispValue(t,a,e.checked)},this))},teasp.dialog.ChangeHRMEmp.prototype.submitRequestEvent=function(
){var r;this.isLock()||!this.isPickListLimitedRelease&&!this.isPickListAlertInNewChangeRequest||(this.validateInvalidFieldForm(this.constInvalidValuePickListFields),0===this.invalidValuePickListFields.length)?((r=this.getRequestCache(!0)).Action="checksubmit",teasp.manager.request("executeAPIChangeRequest",r,this.pouch,{hideBusy:!1},this,function(e){teasp.manager.dialogOpen("Comment",{
dialogTitle:teasp.message.getLabel("applyx_btn_title"),okButtonTitle:teasp.message.getLabel("applyx_btn_title"),okButtonCss:"std-button1"},this.pouch,this,function(e){r.Action="eventsubmit",r.Comment=e.comment;for(var t=[],a=this.showEvent.flows[this.showFlow.index].flowParts||[],o=0;o<a.length;o++)for(var s=this.fieldList[a[o].showSection],i=0;i<s.fields.length;i++){var n=s.fields[i];t.push(this.getApiName(n.name))}
r.FieldNameList=t,console.log(r),teasp.manager.request("executeChangeRequest",r,this.pouch,{hideBusy:!1},this,function(e){0==e.isExecuteProcess?teasp.manager.request("executeAPIChangeRequest",r,this.pouch,{hideBusy:!1},this,function(e){this.onfinishfunc(),this.close()},function(e){teasp.message.alertError(e)}):(this.onfinishfunc(),this.close())},function(e){teasp.message.alertError(e)})})},function(e){
teasp.message.alertError(e)})):this.openInvalidFieldAlert(this.invalidValuePickListFields)},teasp.dialog.ChangeHRMEmp.prototype.deleteRequestEvent=function(){teasp.tsConfirmA(teasp.message.getLabel("em10001130"),this,function(){var t=this.getRequestCache(!0);t.FlowBody=null,t.Action="eventdelete",teasp.manager.request("executeAPIChangeRequest",t,this.pouch,{hideBusy:!1},this,function(e){teasp.manager.request(
"executeChangeRequest",t,this.pouch,{hideBusy:!1},this,function(e){this.onfinishfunc(),this.close()},function(e){teasp.message.alertError(e)})},function(e){teasp.message.alertError(e)})})},teasp.dialog.ChangeHRMEmp.prototype.saveRequestFlow=function(t){if(this.isLock()||!this.isPickListLimitedRelease&&!this.isPickListAlertInNewChangeRequest||(this.validateInvalidFieldForm(this.constInvalidValuePickListFields),
0===this.invalidValuePickListFields.length)){teasp.manager.dialogOpen("BusyWait"),this.settingFlowValue(),this.resetMyNumber(),this.lockEventButton(!0);for(var a=this.getRequestCache(!0),o=(this.mergeValue(a),this.setFlowSaved(this.showFlow.index,a),a.Action="eventsavehrm",!a.EventRequestId),e=this.showEvent.flows[this.showFlow.index].flowParts||[],s=0;s<e.length;s++)if("MyNumber"==e[s].showSection){
this.saveBtnDwnFlg=!0;break}teasp.manager.request("executeChangeRequest",a,this.pouch,{hideBusy:!0},this,function(e){this.requestCache.EventRequestId=e.requestEventId,a.EventRequestId=e.requestEventId,a.Action="eventsave",teasp.manager.request("executeAPIChangeRequest",a,this.pouch,{hideBusy:!0},this,function(e){this.resetMyNumberAttachment(),this.mergeValue(null,e),this.setFlowSaved(this.showFlow.index),
this.finishSaveFlow(t)},function(t){1==o?(a.Action="eventdelete",teasp.manager.request("executeChangeRequest",a,this.pouch,{hideBusy:!1},this,function(e){this.requestCache.EventRequestId=null,teasp.message.alertError(t),teasp.manager.dialogClose("BusyWait")},function(e){teasp.message.alertError(e),teasp.manager.dialogClose("BusyWait")})):(teasp.message.alertError(t),teasp.manager.dialogClose("BusyWait"))})},function(
e){null==this.requestCache.EventRequestId&&this.lockEventButton(!1),teasp.message.alertError(e),teasp.manager.dialogClose("BusyWait")})}else this.openInvalidFieldAlert(this.invalidValuePickListFields)},teasp.dialog.ChangeHRMEmp.prototype.finishSaveFlow=function(e){dojo.addClass(dojo.byId("flowCheck_"+this.showFlow.id),"png-sts005"),this.settingVisibleEventButton(),teasp.manager.dialogClose("BusyWait"),(e?dojo.hitch(
this,this.openRequestFlow(this.getNextFlow())):dojo.hitch(this,this.openRequestFlow(this.showFlow)))()},teasp.dialog.ChangeHRMEmp.prototype.nextRequestFlow=function(){dojo.hitch(this,this.openRequestFlow(this.getNextFlow()))()},teasp.dialog.ChangeHRMEmp.prototype.getNextFlow=function(){for(var e=0;e<this.showEvent.flows.length;e++){var t=this.showEvent.flows[e];if(
t.id==this.showFlow.id&&this.showEvent.flows.length>e+1)return this.showEvent.flows[e+1]}return null},teasp.dialog.ChangeHRMEmp.prototype.getFirstFlow=function(){return 0<this.showEvent.flows.length?this.showEvent.flows[0]:null},teasp.dialog.ChangeHRMEmp.prototype.swapEventFlow=function(e,t){var a,o,s=dojo.byId("RequestView"),i=dojo.byId("RequestEvent"),n=dojo.byId("RequestFlow"),s=s.clientWidth;0==t?1==e?(
dojo.style(i,"left","0px"),dojo.style(i,"display",""),dojo.style(n,"left",s+"px"),dojo.style(n,"display","none")):(dojo.style(i,"left","-"+s+"px"),dojo.style(i,"display","none"),dojo.style(n,"left","0px"),dojo.style(n,"display","")):(1==e?(a=dojo.fx.slideTo({node:i,duration:350,left:0,unit:"px",onBegin:function(){dojo.style(i,"display","")}}),this.setEventHandles("group",dojo.connect(a,"onBegin",function(){
dojo.style(i,"display","")})),o=dojo.fx.slideTo({node:n,duration:350,left:s,unit:"px",onEnd:function(){dojo.style(n,"display","none")}}),this.setEventHandles("group",dojo.connect(o,"onEnd",function(){dojo.style(n,"display","none")}))):(a=dojo.fx.slideTo({node:i,duration:350,left:-1*s,unit:"px"}),this.setEventHandles("group",dojo.connect(a,"onEnd",function(){dojo.style(i,"display","none")})),o=dojo.fx.slideTo({node:n,
duration:350,left:0,unit:"px"}),this.setEventHandles("group",dojo.connect(o,"onBegin",function(){dojo.style(n,"display","")}))),a.play(),o.play())},teasp.dialog.ChangeHRMEmp.prototype.lockEventButton=function(e){var t=dojo.query("#GroupCategory select")[0],a=dojo.byId("RequestReturnEvent");t&&(t.disabled=e),a&&dojo.style(a,"visibility",e?"hidden":"")},teasp.dialog.ChangeHRMEmp.activeButton=function(e,t,a){
"number"==typeof t&&t<0?dojo.style(e,"display","none"):(dojo.style(e,"display",""),dojo.query("button","string"==typeof nodeId?dojo.byId(e):e).forEach(function(e){dojo.toggleClass(e,a,t),dojo.toggleClass(e,a+"-disabled",!t),e.disabled=!t}))},teasp.dialog.ChangeHRMEmp.prototype.settingVisibleEventButton=function(e){var t=this.isLock(),a=this.showFlow&&this.showFlow.last||!1,o=this.canFlowSave(e),s=this.canDelete()?1:0
,e=!e&&this.canRequest()?1:0,i=t&&!a?1:-1,n=!1,r=(-1==o?(n=!1,e=0,dojo.byId("myNumberInfo")&&(r=this.requestCache&&this.requestCache.FlowBody&&this.requestCache.FlowBody.MyNumber__c,l=0===dojo.query(".myNumberAttachment").filter(function(e){return"none"===dojo.getStyle(e,"display")}).length,("未申請"===this.requestCache._status||"却下"===this.requestCache._status||"申請取消"===this.requestCache._status)&&this.canRequest(
)&&r&&l&&(e=1))):1==o?(n=!0,e=0):n=!1,t?-1:n?1:0),l=t||a?-1:n?1:0;this.isMynumberAttached&&(e=1),this.isMynumberAttached=!1,teasp.dialog.ChangeHRMEmp.activeButton("requestEventForm_DeleteBtn",s,"red-button1"),teasp.dialog.ChangeHRMEmp.activeButton("requestEventForm_SubmitBtn",e,"std-button1"),teasp.dialog.ChangeHRMEmp.activeButton("requestFlowForm_SaveBtn",r,"std-button1"),teasp.dialog.ChangeHRMEmp.activeButton(
"requestFlowForm_SaveNextBtn",l,"std-button1"),teasp.dialog.ChangeHRMEmp.activeButton("requestFlowForm_NextBtn",i,"std-button1")},teasp.dialog.ChangeHRMEmp.prototype.showSteps=function(){teasp.manager.dialogOpen("Status",{apply:{steps:this.getProcessInstanceStep()},removable:this.canCancel(),removeButtonType:1,cancelApply:this.cancelRequest,showCancelComment:!0},this.pouch,this,function(e){this.doCancelRequest(
e.comment)})},teasp.dialog.ChangeHRMEmp.prototype.cancelRequest=function(e,t){teasp.manager.dialogOpen("Comment",{dialogTitle:teasp.message.getLabel("cancelApply_btn_title"),okButtonTitle:teasp.message.getLabel("cancelApply_btn_title"),okButtonCss:"red-button1"},this.pouch,this,function(e){t(e)})},teasp.dialog.ChangeHRMEmp.prototype.doCancelRequest=function(e){var t=this.getRequestCache(!0);t.Action="eventremove",
t.Comment=e,this.employee.Id&&this.requestCache.FlowBody&&this.requestCache.FlowBody.SelectTarget__c&&(t.EMEmp=this.employee.Id==this.requestCache.FlowBody.SelectTarget__c.value?"true":"false"),this.requestCache.FlowBody&&this.requestCache.FlowBody.MyNumberId__c&&(t.MyNumberId=this.requestCache.FlowBody.MyNumberId__c),teasp.manager.request("executeChangeRequest",t,this.pouch,{hideBusy:!1},this,function(e){
teasp.manager.request("executeAPIChangeRequest",t,this.pouch,{hideBusy:!1},this,function(e){this.onfinishfunc(),this.close()},function(e){teasp.message.alertError(e)})},function(e){teasp.message.alertError(e)})},teasp.dialog.ChangeHRMEmp.prototype.getDispListValue=function(e,t){for(var a=this.optionsList[e],o=0;o<a.length;o++){var s=a[o];if(s.value==t)return s.label}return null!=t?t:""},
teasp.dialog.ChangeHRMEmp.prototype.hide=function(){this.free(),this.dialog.destroy(),teasp.manager.dialogRemove("ChangeHRMEmp")},teasp.dialog.ChangeHRMEmp.prototype.validateInvalidFieldForm=function(e){var t=dojo.byId("requestEditForm_tbody");dojo.query("select",t).forEach(function(i){var n,r=dojo.getAttr(i,"fieldName");"SelectTarget__c"!==r&&(n=!1,e.forEach(function(t,e){var a,o,s;
t.fieldName===r&&t.value===i.value&&(n=!0,a=this.showFlow.flowParts[0].showSection,o=this.showFlow.name,s=!(this.invalidFlow={showSection:a,name:o}),this.invalidValuePickListFields.forEach(function(e){e.fieldName===t.fieldName&&(s=!0)}),s||this.invalidValuePickListFields.push(t))},this),n||this.invalidValuePickListFields.forEach(function(e,t){e.fieldName===r&&this.invalidValuePickListFields.splice(t,1)},this))},this)
},teasp.dialog.ChangeHRMEmp.prototype.openInvalidFieldAlert=function(e){var t=teasp.message.getLabel("em10004300"),a=[],o=(Object.keys(this.fieldList).forEach(function(e){this.fieldList[e].foreignKey===this.foreignKey&&this.fieldList[e].fields.forEach(function(e){a.push(e)})},this),[]);a.forEach(function(t){e.forEach(function(e){t.fieldName!==e.fieldName&&t.name!==e.fieldName||(this.isEnglishAndOldPeople(e)?o.push({
label:t.label,value:this.OLD_PEOPLE_ENGLISH_LABEL}):o.push({label:t.label,value:e.value}))},this)},this),o.forEach(function(e){t+=e.label+" : "+e.value+"\n"}),window.alert(t)},teasp.dialog.ChangeHRMEmp.prototype.validatePickListField=function(s,i,n){var e,t,r;this.isLock()||(r=(t=(e=s.attributes&&s.attributes.type&&2<s.attributes.type.split("__").length?(t=s.attributes.type).substring(t.indexOf("__")+"__".length):e
)?e.slice(3):s.attributes&&s.attributes.type&&s.attributes.type.slice(3))&&t.slice(0,t.length-1)+"r",Object.keys(s).forEach(function(e){var t,a,o=this.convertMasterFieldNameToChangeRequest(e,r);i[o]&&"TsDisplayMyNumber__c"!==e&&(t=!1,a=n?s[e]:s[e].value,i[o].forEach(function(e){e.value!==a&&null!==a||(t=!0)}),t||this.invalidValuePickListFields.push({fieldName:o,value:a}))},this),
this.constInvalidValuePickListFields=dojo.clone(this.invalidValuePickListFields))},teasp.dialog.ChangeHRMEmp.prototype.isEnglishAndOldPeople=function(e){return"ja"!==teasp.message.getLanguageLocaleKey()&&"ja_JP"!==teasp.message.getLanguageLocaleKey()&&"SocialInsuranceDivision__c"===e.fieldName&&"老人"===e.value},teasp.dialog.ChangeHRMEmp.prototype.convertMasterFieldNameToChangeRequest=function(a,o){var e,
s=this.CHANGE_REQUEST_FIELD_NAME_MAP;return s.hasOwnProperty(o)&&(e=Object.keys(s[o]).reduce(function(e,t){return s[o][t]===a?t:e},null),a=e||a),a},teasp.dialog.ChangeHRMEmp.prototype.convertChangeRequestFieldNameToMaster=function(e,t){var a=this.CHANGE_REQUEST_FIELD_NAME_MAP;return e=a.hasOwnProperty(t)&&a[t].hasOwnProperty(e)?a[t][e]:e},teasp.dialog.ChangeHRMEmp.prototype.copyToInputFormAddressInfo=function(){
dojo.byId("PostalCode__c").value=this.getEmployeeAddressInfo("PostalCode__c"),dojo.byId("State__c").value=this.getEmployeeAddressInfo("State__c"),dojo.byId("City__c").value=this.getEmployeeAddressInfo("City__c"),dojo.byId("Street__c").value=this.getEmployeeAddressInfo("Street__c"),dojo.byId("State_Kana__c").value=this.getEmployeeAddressInfo("State_Kana__c"),dojo.byId("City_Kana__c").value=this.getEmployeeAddressInfo(
"City_Kana__c"),dojo.byId("Street_Kana__c").value=this.getEmployeeAddressInfo("Street_Kana__c"),this.blurField()},teasp.dialog.ChangeHRMEmp.prototype.copyToInputFormResidentAddressInfo=function(){dojo.byId("PostalCode_Resident__c").value=this.getDispValue("PostalCode__c","String"),dojo.byId("State_Resident__c").value=this.getDispValue("State__c","String"),dojo.byId("City_Resident__c").value=this.getDispValue(
"City__c","String"),dojo.byId("Street_Resident__c").value=this.getDispValue("Street__c","String"),dojo.byId("State_Resident_Kana__c").value=this.getDispValue("State_Kana__c","String"),dojo.byId("City_Resident_Kana__c").value=this.getDispValue("City_Kana__c","String"),dojo.byId("Street_Resident_Kana__c").value=this.getDispValue("Street_Kana__c","String"),this.blurField()},
teasp.dialog.ChangeHRMEmp.prototype.getEmployeeAddressInfo=function(e){var t,a=this.employee;return null!=(t=a&&a.hasOwnProperty(e)?a[e]:t)?t:""},teasp.provide("teasp.dialog.RequestList"),teasp.dialog.RequestList=function(){this.widthHint=588,this.heightHint=334,this.id="dialogRequestList",this.title=teasp.message.getLabel("applyList_btn_title"),this.duration=1,
this.content='<table id="requestList_DialogRequestListTable" class="dialogApplyTable" border="0" cellspacing="0" cellpadding="0" style="padding:0px 10px;"><tr><td id="RequestList_Title"></td></tr><tr><td><div><table style="width:548px; border-collapse: collapse;"><tbody id="RequestListTable_Header"></tbody></table></div><div style="width:548px;overflow-y:scroll;height:280px;"><table style="width:100%; border-collapse: collapse;"><tbody id="RequestListTable_Body"></tbody></table></div></td></tr></table>'
,this.readOnlyCnt=0,this.contentSeq=0,this.client=null,this.eventHandles=[],this.applyHandle={},this.requests=[],this.colList=[{width:320,label:teasp.message.getLabel("em10001110"),type:"text",align:"left",field:"name"},{width:130,label:teasp.message.getLabel("applyDate_label"),type:"dateTime",align:"center",field:"applyDatetime"},{width:80,label:teasp.message.getLabel("statusj_head"),type:"text",align:"center",
field:"status"}]},teasp.dialog.RequestList.prototype=new teasp.dialog.Base,teasp.dialog.RequestList.prototype.preInit=function(){require(["dijit/layout/TabContainer","dijit/layout/ContentPane","dijit/Tooltip"])},teasp.dialog.RequestList.prototype.ready=function(){this.client=this.args.client},teasp.dialog.RequestList.prototype.preStart=function(){dojo.query(".dijitDialogPaneContent",this.dialog.domNode).forEach(
function(e){dojo.style(e,"background","#F0F0E1")});var e=dojo.byId("RequestList_Title"),t=dojo.create("tbody",null,dojo.create("table",{style:"margin-left:auto;margin-right:0px;"},e)),a=dojo.create("tr",null,t),e=dojo.create("td",{style:"text-align: right;"},a);(div=dojo.create("div",null,dojo.create("button",{className:"std-button1 gry-button1",style:{width:"100%",margin:"4px",marginLeft:"auto"}},e))
).innerHTML=teasp.message.getLabel("close_btn_title"),dojo.connect(e.firstChild,"onclick",this,this.close);for(var a=dojo.create("tr",null,dojo.byId("RequestListTable_Header")),o=0;o<this.colList.length;o++){var s=this.colList[o];dojo.create("th",{className:this.colList.length==o+1?"last":o?"":"first",innerHTML:s.label||"",style:"width:"+(s.width+(this.colList.length==o+1?16:0))+"px"},a)}},
teasp.dialog.RequestList.prototype.postShow=function(){var e=dojo.byId("RequestListTable_Body");dojo.empty(e);for(var t=0;t<this.eventHandles.length;t++)dojo.disconnect(this.eventHandles[t]),delete this.eventHandles[t];this.eventHandles=[],this.getRequestList()},teasp.dialog.RequestList.prototype.getRequestList=function(){teasp.manager.request("getRequestList",[],this.pouch,{hideBusy:!1},this,function(e){
this.createRequestList(e)},function(e){teasp.message.alertError(e)})},teasp.dialog.RequestList.prototype.createRequestList=function(e){this.requests=e;for(var t=dojo.byId("RequestListTable_Body"),a=0;a<10||a<this.requests.length;a++)for(var o=dojo.create("tr",{className:a%2==1?"odd":"even"},t),s=0;s<this.colList.length;s++){var i=this.colList[s],n=0==s?"first":"",r=(this.colList.length==s+1&&(n="last"),
this.requests.length==a+1&&(n+=" lastRow"),dojo.create("td",{className:n,style:"text-align: "+i.align},o));if(dojo.style(r,"width",i.width+"px"),"action"!=i.type){var l=a<this.requests.length?this.requests[a]:null;if(l&&l[i.field])switch(i.field){case"name":var p=dojo.create("div",null,r),p=dojo.create("a",null,p);p.innerHTML=l.name,p.href="javascript: void( 0 );",this.eventHandles.push(dojo.connect(p,"onclick",this,
this.openRequestEdit(l.id)));break;case"applyDatetime":p=l[i.field];r.innerHTML=p?teasp.util.date.formatDateTime(p,"SLA-HM"):"";break;case"status":r.innerHTML=teasp.constant.getDisplayStatus(l[i.field]);break;default:r.innerHTML=l[i.field]}else"name"==i.field&&dojo.create("div",{innerHTML:"&nbsp;"},r)}}},teasp.dialog.RequestList.prototype.openRequestEdit=function(e){return function(){var t={
client:teasp.constant.APPLY_CLIENT_CHANGE_EMP,requestId:e};dojo.hitch(this,function(e){e&&(e.preventDefault(),e.stopPropagation()),dojo.hitch(this,function(){teasp.manager.dialogOpen("ChangeEmp",t,this.pouch,this,function(){this.postShow()})})()})()}},teasp.provide("teasp.dialog.RequestHRMList"),teasp.dialog.RequestHRMList=function(){this.widthHint=588,this.heightHint=334,this.id="dialogRequestHRMList",
this.title=teasp.message.getLabel("applyList_btn_title"),this.duration=1,
this.content='<table id="requestList_DialogRequestListTable" class="dialogApplyTable" border="0" cellspacing="0" cellpadding="0" style="padding:0px 10px;"><tr><td id="RequestList_Title"></td></tr><tr><td><div><table style="width:548px; border-collapse: collapse;"><tbody id="RequestListTable_Header"></tbody></table></div><div style="width:548px;overflow-y:scroll;height:280px;"><table style="width:100%; border-collapse: collapse;"><tbody id="RequestListTable_Body"></tbody></table></div></td></tr></table>'
,this.readOnlyCnt=0,this.contentSeq=0,this.client=null,this.eventHandles=[],this.applyHandle={},this.requests=[],this.colList=[{width:320,label:teasp.message.getLabel("em10001110"),type:"text",align:"left",field:"name"},{width:130,label:teasp.message.getLabel("applyDate_label"),type:"dateTime",align:"center",field:"applyDatetime"},{width:80,label:teasp.message.getLabel("statusj_head"),type:"text",align:"center",
field:"status"}]},teasp.dialog.RequestHRMList.prototype=new teasp.dialog.Base,teasp.dialog.RequestHRMList.prototype.preInit=function(){require(["dijit/layout/TabContainer","dijit/layout/ContentPane","dijit/Tooltip"])},teasp.dialog.RequestHRMList.prototype.ready=function(){this.client=this.args.client},teasp.dialog.RequestHRMList.prototype.preStart=function(){dojo.query(".dijitDialogPaneContent",this.dialog.domNode
).forEach(function(e){dojo.style(e,"background","#F0F0E1")});var e=dojo.byId("RequestList_Title"),t=dojo.create("tbody",null,dojo.create("table",{style:"margin-left:auto;margin-right:0px;"},e)),a=dojo.create("tr",null,t),e=dojo.create("td",{style:"text-align: right;"},a);(div=dojo.create("div",null,dojo.create("button",{className:"std-button1 gry-button1",style:{width:"100%",margin:"4px",marginLeft:"auto"}},e))
).innerHTML=teasp.message.getLabel("close_btn_title"),dojo.connect(e.firstChild,"onclick",this,this.close);for(var a=dojo.create("tr",null,dojo.byId("RequestListTable_Header")),o=0;o<this.colList.length;o++){var s=this.colList[o];dojo.create("th",{className:this.colList.length==o+1?"last":o?"":"first",innerHTML:s.label||"",style:"width:"+(s.width+(this.colList.length==o+1?16:0))+"px"},a)}},
teasp.dialog.RequestHRMList.prototype.postShow=function(){var e=dojo.byId("RequestListTable_Body");dojo.empty(e);for(var t=0;t<this.eventHandles.length;t++)dojo.disconnect(this.eventHandles[t]),delete this.eventHandles[t];this.eventHandles=[],this.getRequestList()},teasp.dialog.RequestHRMList.prototype.getRequestList=function(){teasp.manager.request("getHRMRequestList",[],this.pouch,{hideBusy:!1},this,function(e){
this.createRequestList(e)},function(e){teasp.message.alertError(e)})},teasp.dialog.RequestHRMList.prototype.createRequestList=function(e){this.requests=e;for(var t=dojo.byId("RequestListTable_Body"),a=0;a<10||a<this.requests.length;a++)for(var o=dojo.create("tr",{className:a%2==1?"odd":"even"},t),s=0;s<this.colList.length;s++){var i=this.colList[s],n=0==s?"first":"",r=(this.colList.length==s+1&&(n="last"),
this.requests.length==a+1&&(n+=" lastRow"),dojo.create("td",{className:n,style:"text-align: "+i.align},o));if(dojo.style(r,"width",i.width+"px"),"action"!=i.type){var l=a<this.requests.length?this.requests[a]:null;if(l&&l[i.field])switch(i.field){case"name":var p=dojo.create("div",null,r),p=dojo.create("a",null,p);p.innerHTML=l.name,p.href="javascript: void( 0 );",this.eventHandles.push(dojo.connect(p,"onclick",this,
this.openRequestEdit(l.id,l.isHRMversion1)));break;case"applyDatetime":p=l[i.field];r.innerHTML=p?teasp.util.date.formatDateTime(p,"SLA-HM"):"";break;case"status":r.innerHTML=teasp.constant.getDisplayStatus(l[i.field]);break;default:r.innerHTML=l[i.field]}else"name"==i.field&&dojo.create("div",{innerHTML:"&nbsp;"},r)}}},teasp.dialog.RequestHRMList.prototype.openRequestEdit=function(e,a){return function(){var t={
client:teasp.constant.APPLY_CLIENT_CHANGE_HRM_EMP,requestId:e,isHRMversion1:a};dojo.hitch(this,function(e){e&&(e.preventDefault(),e.stopPropagation()),(a?dojo.hitch(this,function(){teasp.manager.dialogOpen("ChangeEmp",t,this.pouch,this,function(){this.postShow()})}):dojo.hitch(this,function(){teasp.manager.dialogOpen("ChangeHRMEmp",t,this.pouch,this,function(){this.postShow()})}))()})()}},teasp.provide(
"teasp.dialog.HRMGuide"),teasp.dialog.HRMGuide=function(){this.widthHint=588,this.heightHint=334,this.id="dialogHRMGuide",this.title="",this.duration=1,
this.content='<table id="dlgHrmGuideTable"><tbody><tr><td class="hrm-guide-dlg-head"><div id="dlgHrmGuideHead"></div></td><td class="hrm-guide-dlg-cancel"><input type="button" class="gray-button" id="dlgHrmGuideCancel" /></td></tr><tr><td colspan="2" class="hrm-guide-dlg-body"><div><div id="dlgHrmGuideQuest"><div class="hrm-guide-dlg-backlink"><a href="#"></a></div><div class="hrm-guide-dlg-content"><p></p></div><div class="hrm-guide-dlg-spc"><p></p></div><div class="hrm-guide-dlg-select"><ul id="dlgHrmGuideSelect"></ul></div></div><div id="dlgHrmGuideResult" style="display:none;"><table><thead></thead><tbody></tbody></table></div></div></td></tr><tr id="dlgHrmGuideDone" style="display:none;"><td colspan="2"><div><input type="button" class="blue-button" id="dlgHrmGuideBuild" /></div></td></tr></tbody></table>'
},teasp.dialog.HRMGuide.prototype=new teasp.dialog.Base,teasp.dialog.HRMGuide.prototype.preStart=function(){dojo.query(".dijitDialogPaneContent",this.dialog.domNode).forEach(function(e){dojo.style(e,"background","#F0F0E1"),dojo.style(e,"padding","16px 20px 20px 20px")}),dojo.byId("dlgHrmGuideCancel").value=teasp.message.getLabel("hr10010060"),dojo.byId("dlgHrmGuideBuild").value=teasp.message.getLabel("hr10010070"),
dojo.connect(dojo.byId("dlgHrmGuideCancel"),"onclick",this,this.quitQuest),dojo.connect(dojo.byId("dlgHrmGuideBuild"),"onclick",this,this.finishQuest)},teasp.dialog.HRMGuide.prototype.preShow=function(){return this.navi=this.args.navi,null===this.navi.getNextQuestion(null)?(this.finishQuest(),!1):(this.question=null,this.questEvents=[],dojo.query(".dijitDialogTitleBar .dijitDialogTitle",this.id
)[0].innerHTML=this.navi.getName(),dojo.query(".dijitDialogTitleBar .dijitDialogCloseIcon",this.id)[0].title=teasp.message.getLabel("hr10010060"),this.changeView(!1),this.nextQuest(),!0)},teasp.dialog.HRMGuide.prototype.postShow=function(){},teasp.dialog.HRMGuide.prototype.clearQuestEvents=function(){for(var e=0;e<this.questEvents.length;e++)dojo.disconnect(this.questEvents[e]);this.questEvents=[]},
teasp.dialog.HRMGuide.prototype.nextQuest=function(){this.question=this.navi.getNextQuestion(this.question),console.log("this.navi",this.navi),console.log("this.question",this.question),this.question?(this.setQuest(),teasp.util.fadeInOut(!0,{node:"dlgHrmGuideQuest"})):this.showResult()},teasp.dialog.HRMGuide.prototype.prevQuest=function(){this.changeView(!1),this.question=this.navi.getPrevQuestion(),this.setQuest(),
teasp.util.fadeInOut(!0,{node:"dlgHrmGuideQuest"})},teasp.dialog.HRMGuide.prototype.backToQuest=function(e){this.changeView(!1),this.question=this.navi.getAnsweredQuestion(e),this.setQuest(),teasp.util.fadeInOut(!0,{node:"dlgHrmGuideQuest"})},teasp.dialog.HRMGuide.prototype.setQuest=function(){dojo.query(".hrm-guide-dlg-content p",this.dialog.domNode)[0].textContent=this.question.getName(),dojo.query(
".hrm-guide-dlg-spc p",this.dialog.domNode)[0].innerHTML=teasp.util.entitize(this.question.getRemarks(),"").replace(/\n/g,"<br>");dojo.query(".hrm-guide-dlg-content",this.dialog.domNode)[0];var e=dojo.byId("dlgHrmGuideSelect"),t=(dojo.empty(e),this.question.getSelects());if(t.length)for(var a=0;a<t.length;a++){var o=t[a],o=dojo.create("button",{innerHTML:o.getName(),selectId:o.getId()},dojo.create("li",null,e));
this.questEvents.push(dojo.connect(o,"onclick",this,this.setAnswer))}else{dojo.create("li",{innerHTML:teasp.message.getLabel("hr10011060")},e);var s=dojo.create("button",{innerHTML:teasp.message.getLabel("hr10010065"),className:"gray"},dojo.create("li",null,e));this.questEvents.push(dojo.connect(s,"onclick",this,this.quitQuest))}s=dojo.query(".hrm-guide-dlg-backlink a",this.dialog.domNode)[0];
this.navi.answerList.length?(s.innerHTML=teasp.message.getLabel("hr10011080"),dojo.style(s,"display",""),this.questEvents.push(dojo.connect(s,"onclick",this,function(){this.backToPreviousQuestion(!1)}.bind(this)))):dojo.style(s,"display","none")},teasp.dialog.HRMGuide.prototype.setAnswer=function(e){e=dojo.attr(e.target,"selectId");e&&this.question.setSelect(e),this.clearQuestEvents(),teasp.util.fadeInOut(!1,{
node:"dlgHrmGuideQuest",onEnd:dojo.hitch(this,this.nextQuest)})},teasp.dialog.HRMGuide.prototype.backToPreviousQuestion=function(){this.clearQuestEvents(),teasp.util.fadeInOut(!1,{node:"dlgHrmGuideQuest",onEnd:function(){this.prevQuest()}.bind(this)})},teasp.dialog.HRMGuide.prototype.backToQuestion=function(e){this.clearQuestEvents(),teasp.util.fadeInOut(!1,{node:"dlgHrmGuideResult",onEnd:function(){this.backToQuest(
e)}.bind(this)})},teasp.dialog.HRMGuide.prototype.changeView=function(e){dojo.style("dlgHrmGuideQuest","display",e?"none":""),dojo.style("dlgHrmGuideResult","display",e?"":"none"),dojo.style("dlgHrmGuideDone","display",e?"":"none"),dojo.byId("dlgHrmGuideHead").innerHTML=e?teasp.message.getLabel("hr10010050"):teasp.message.getLabel("hr10010040"),teasp.util.fadeInOut(e,{node:"dlgHrmGuideResult"}),teasp.util.fadeInOut(e
,{node:"dlgHrmGuideDone"})},teasp.dialog.HRMGuide.prototype.showResult=function(){for(var e=dojo.query("#dlgHrmGuideResult thead")[0],t=dojo.query("#dlgHrmGuideResult tbody")[0],a=(dojo.empty(e),dojo.empty(t),dojo.create("tr",null,e)),o=(dojo.create("th",{innerHTML:teasp.message.getLabel("hr10010110")},a),dojo.create("th",{innerHTML:teasp.message.getLabel("hr10010120")},a),this.navi.getAnswerList()),
s=0;s<o.length;s++){var i=o[s],a=dojo.create("tr",null,t),n=dojo.create("a",{innerHTML:"("+(s+1)+") "+i.getName(),href:"#",answerNumber:s+1},dojo.create("td",null,a));this.questEvents.push(dojo.connect(n,"onclick",this,function(e){e=parseInt(dojo.attr(e.target,"answerNumber"));this.backToQuestion(e)})),dojo.create("td",{innerHTML:i.getAnswer()||""},a)}this.changeView(!0)},
teasp.dialog.HRMGuide.prototype.quitQuest=function(){this.clearQuestEvents(),this.hide()},teasp.dialog.HRMGuide.prototype.finishQuest=function(){this.onfinishfunc(this.navi.getId(),this.navi.getAnswerList()),this.quitQuest()},teasp.provide("teasp.dialog.Comment"),teasp.dialog.Comment=function(){this.width=400,this.height=210,this.title=teasp.message.getLabel("applyx_btn_title"),this.id="commentDialog",this.duration=1
,
this.content='<table class="pane_table" style="width:400px;"><tr><td style="vertical-align:top;text-align:left;"><div id="commentDescript" style="margin:0px 2px 8px 4px;display:none;"></div></td></tr><tr id="commentWarningRow" style="display:none;"><td style="vertical-align:top;text-align:left;"><div id="commentWarning" style="margin:0px 8px 8px 4px;color:red;"></div></td></tr><tr><td style="vertical-align:top;text-align:left;"><div id="commentLabel" style="margin:0px 4px;font-weight:bold;"></div></td></tr><tr><td style="vertical-align:top;text-align:center;"><textarea id="commentText" style="width:390px;height:80px;margin-left:6px;margin-right:6px" class="inputran" maxLength="4000"></textarea></td></tr><tr id="commentErrorRow" style="display:none;"><td style="vertical-align:top;text-align:center;color:red;"><div id="commentError"></div></td></tr><tr class="ts-buttons-row"><td style="text-align:center;padding-top:10px;"><div><button class="std-button1" style="margin-right:10px;" id="commentOk" ><div></div></button><button class="std-button2" style="margin-left:10px;" id="commentCancel" ><div></div></button></div></td></tr></table>'
,this.okLink={id:"commentOk",callback:this.ok},this.cancelLink={id:"commentCancel",callback:this.hide}},teasp.dialog.Comment.prototype=new teasp.dialog.Base,teasp.dialog.Comment.prototype.preStart=function(){dojo.byId("commentOk").firstChild.innerHTML=teasp.message.getLabel("apply_btn_title"),dojo.byId("commentCancel").firstChild.innerHTML=teasp.message.getLabel("cancel_btn_title")},
teasp.dialog.Comment.prototype.preShow=function(){return dojo.byId("commentDialog_title").innerHTML=this.args.dialogTitle||"",dojo.byId("commentText").value="",dojo.byId("commentLabel").innerHTML=teasp.message.getLabel("comment_head"),this.args.okButtonTitle&&(dojo.byId("commentOk").firstChild.innerHTML=this.args.okButtonTitle),this.args.okButtonCss&&(dojo.byId("commentOk").className=this.args.okButtonCss),
this.showError(null),!0},teasp.dialog.Comment.prototype.ok=function(){this.hide(),this.onfinishfunc({comment:dojo.byId("commentText").value||null})},teasp.dialog.Comment.prototype.showError=function(e){dojo.style("commentErrorRow","display",e?"":"none"),dojo.byId("commentError").innerHTML=e?e.entitize():""},teasp.provide("teasp.dialog.DivergenceReason"),teasp.dialog.DivergenceReason=function(){this.widthHint=410,
this.heightHint=225,this.id="dialogDivergenceReason",this.title=teasp.message.getLabel("ac00000290"),this.duration=1,
this.content='<table class="diverge-reason"><tr><td class="diverge-head"><table><tr><td class="diverge-date"><span></span></td><td class="diverge-event"><span></span></td></tr></table></td></tr><tr><td><table class="diverge-table1"><tr><td class="diverge-info"><div class="diverge-form"></div><table><tbody></tbody></table></td><td><div><select></select></div><div><textarea></textarea></div></td></tr></table><table class="diverge-table2"><tr><td class="diverge-info"><div class="diverge-form"></div><table><tbody></tbody></table></td><td><div><select></select></div><div><textarea></textarea></div></td></tr></table></td></tr><tr class="diverge-ctrl1"><td><div><button class="std-button1"><div></div></button><button class="std-button2"><div></div></button></div></td></tr><tr class="diverge-ctrl2"><td><div><button class="std-button2"><div></div></button></div></td></tr></table>'
,this.eventHandles=[]},teasp.dialog.DivergenceReason.prototype=new teasp.dialog.Base,teasp.dialog.DivergenceReason.prototype.ready=function(){this.dayWrap=this.pouch.getEmpDay(this.args.date)},teasp.dialog.DivergenceReason.prototype.preStart=function(){var e=dojo.byId(this.dialog.id),t=dojo.query(".diverge-ctrl1 .std-button1",e)[0],a=dojo.query(".diverge-ctrl1 .std-button2",e)[0],e=dojo.query(
".diverge-ctrl2 .std-button2",e)[0];dojo.query("div",t)[0].innerHTML=teasp.message.getLabel("save_btn_title"),dojo.query("div",a)[0].innerHTML=teasp.message.getLabel("cancel_btn_title"),dojo.query("div",e)[0].innerHTML=teasp.message.getLabel("close_btn_title"),dojo.connect(t,"onclick",this,this.ok),dojo.connect(a,"onclick",this,this.hide),dojo.connect(e,"onclick",this,this.hide)},
teasp.dialog.DivergenceReason.prototype.preShow=function(){for(var e=0;e<this.eventHandles.length;e++)dojo.disconnect(this.eventHandles[e]),delete this.eventHandles[e];this.eventHandles=[];var t,a,o,s=dojo.byId(this.dialog.id),i=this.isSingle(),n=(dojo.style(dojo.query(".diverge-ctrl1",s)[0],"display",this.isReadOnly()?"none":""),dojo.style(dojo.query(".diverge-ctrl2",s)[0],"display",this.isReadOnly()?"":"none"),
dojo.style(dojo.query(".diverge-table2",s)[0],"display",i?"none":""),dojo.query(".diverge-date",s)[0].innerHTML=teasp.util.date.formatDate(this.args.date,"JP1"),dojo.query(".diverge-event",s)[0].innerHTML=this.dayWrap.getCalendarEvent(),this.pouch.getDivergenceReasonList()),r=0<n.length&&!this.isReadOnly(),l=dojo.query(".diverge-table1 select",s)[0];return dojo.empty(l),r&&(dojo.create("option",{innerHTML:"",value:""
},l),dojo.forEach(n,function(e){dojo.create("option",{innerHTML:e,value:e},l)}),this.eventHandles.push(dojo.connect(l,"onchange",this,this.changedReason(1)))),dojo.style(l,"display",r?"":"none"),dojo.query(".diverge-table1 div.diverge-form",s)[0].innerHTML=teasp.message.getLabel(i?"ac00000230":"ac00000210"),dojo.query(".diverge-table1 textarea",s)[0].readOnly=this.isReadOnly()?"readOnly":"",dojo.toggleClass(
dojo.query(".diverge-table1 textarea",s)[0],"inputro",this.isReadOnly()),dojo.query(".diverge-table1 textarea",s)[0].maxLength=teasp.constant.DIVERGE_REASON_MAX,dojo.query(".diverge-table1 textarea",s)[0].value=this.dayWrap.getEnterDivergenceReason(),dojo.style(dojo.query(".diverge-table1 td.diverge-info",s)[0],"min-width","100px"),t=dojo.query(".diverge-table1 td.diverge-info tbody",s)[0],dojo.empty(t),i||(
a=dojo.create("tr",null,t),dojo.create("td",{innerHTML:teasp.message.getLabel("startTime_head")},a),dojo.create("td",{innerHTML:this.dayWrap.getStartTime(!1,null,teasp.constant.C_REAL)},a)),a=dojo.create("tr",null,t),dojo.create("td",{innerHTML:teasp.message.getLabel("ac00000250")},a),dojo.create("td",{innerHTML:this.dayWrap.getEnterTime()},a),i?(a=dojo.create("tr",null,t),dojo.create("td",{
innerHTML:teasp.message.getLabel("ac00000260")},a),dojo.create("td",{innerHTML:this.dayWrap.getExitTime()},a)):(a=dojo.create("tr",null,t),dojo.create("td",{innerHTML:this.dayWrap.getEnterDivergence(),colSpan:2},a)),i||(o=dojo.query(".diverge-table2 select",s)[0],dojo.empty(o),r&&(dojo.create("option",{innerHTML:"",value:""},o),dojo.forEach(n,function(e){dojo.create("option",{innerHTML:e,value:e},o)}),
this.eventHandles.push(dojo.connect(o,"onchange",this,this.changedReason(2)))),dojo.style(o,"display",r?"":"none"),dojo.query(".diverge-table2 div.diverge-form",s)[0].innerHTML=teasp.message.getLabel("ac00000220"),dojo.query(".diverge-table2 textarea",s)[0].readOnly=this.isReadOnly()?"readOnly":"",dojo.toggleClass(dojo.query(".diverge-table2 textarea",s)[0],"inputro",this.isReadOnly()),dojo.query(
".diverge-table2 textarea",s)[0].maxLength=teasp.constant.DIVERGE_REASON_MAX,dojo.query(".diverge-table2 textarea",s)[0].value=this.dayWrap.getExitDivergenceReason(),t=dojo.query(".diverge-table2 td.diverge-info tbody",s)[0],dojo.empty(t),a=dojo.create("tr",null,t),dojo.create("td",{innerHTML:teasp.message.getLabel("endTime_head")},a),dojo.create("td",{innerHTML:this.dayWrap.getEndTime(!1,null,teasp.constant.C_REAL)}
,a),a=dojo.create("tr",null,t),dojo.create("td",{innerHTML:teasp.message.getLabel("ac00000260")},a),dojo.create("td",{innerHTML:this.dayWrap.getExitTime()},a),a=dojo.create("tr",null,t),dojo.create("td",{innerHTML:this.dayWrap.getExitDivergence(),colSpan:2},a)),!0},teasp.dialog.DivergenceReason.prototype.ok=function(){teasp.manager.request("saveDivergenceReason",{empId:this.pouch.getEmpId(),mode:this.pouch.getMode(),
date:this.args.date,lastModifiedDate:this.pouch.getLastModifiedDate(),enterDivergenceReason:this.getEnterDivergenceReason(),exitDivergenceReason:this.getExitDivergenceReason()},this.pouch,{},this,function(){this.onfinishfunc(),this.close()},function(e){teasp.message.alertError(e)})},teasp.dialog.DivergenceReason.prototype.isReadOnly=function(){return this.pouch.isEmpMonthReadOnly()||this.dayWrap.isDailyFix()},
teasp.dialog.DivergenceReason.prototype.changedReason=function(a){return function(e){var t,e=e.target.value;e&&((t=dojo.query(".diverge-table"+a+" textarea",dojo.byId(this.dialog.id))[0]).value=t.value+e,t.value.length>teasp.constant.DIVERGE_REASON_MAX&&(t.value=t.value.substring(0,teasp.constant.DIVERGE_REASON_MAX)))}},teasp.dialog.DivergenceReason.prototype.isSingle=function(){return!this.dayWrap.isInputable()},
teasp.dialog.DivergenceReason.prototype.getEnterDivergenceReason=function(){var e=dojo.byId(this.dialog.id);return dojo.query(".diverge-table1 textarea",e)[0].value},teasp.dialog.DivergenceReason.prototype.getExitDivergenceReason=function(){if(this.isSingle())return this.getEnterDivergenceReason();var e=dojo.byId(this.dialog.id);return dojo.query(".diverge-table2 textarea",e)[0].value},teasp.provide(
"teasp.dialog.AccessControlLog"),teasp.dialog.AccessControlLog=function(){this.widthHint=410,this.heightHint=225,this.id="dialogAccessControlLog",this.title=teasp.message.getLabel("ac00000300"),this.duration=1,
this.content='<table class="acclog-view"><tr><td class="acclog-head"><table><tr><td class="acclog-date"><span></span></td><td class="acclog-event"><span></span></td></tr></table></td></tr><tr><td><table><tr><td><button class="std-button2 acclog-prevd"><div></div></button></td><td><button class="std-button2 acclog-nextd"><div></div></button></td></tr></table></td></tr><tr><td><div class="acclog-logs"></div></td></tr><tr class="acclog-ctrl"><td><div><button class="std-button2"><div></div></button></div></td></tr></table>'
,this.eventHandles=[];var e={0:teasp.message.getLabel("ac00000330"),1:teasp.message.getLabel("ac00000250"),2:teasp.message.getLabel("ac00000260"),9:teasp.message.getLabel("ac00000340")};this.cols=[{label:teasp.message.getLabel("dateTime_head"),apiKey:"LogDate__c",width:150,align:"center",type:"dateTime"},{label:teasp.message.getLabel("tk10000262"),apiKey:"LogType__c",width:80,align:"center",type:"select",pickMap:e},{
label:teasp.message.getLabel("ac00000310"),apiKey:"LogKey__c",width:130,align:"center",type:"string"},{label:teasp.message.getLabel("ac00000320"),apiKey:"ProcessedFlag__c",width:90,align:"center",type:"boolean"},{label:teasp.message.getLabel("note_head"),apiKey:"Note__c",width:180,align:"left",type:"string"}]},teasp.dialog.AccessControlLog.prototype=new teasp.dialog.Base,
teasp.dialog.AccessControlLog.prototype.ready=function(){},teasp.dialog.AccessControlLog.prototype.preStart=function(){var e=dojo.byId(this.dialog.id),e=dojo.query(".acclog-ctrl .std-button2",e)[0];dojo.query("div",e)[0].innerHTML=teasp.message.getLabel("close_btn_title"),dojo.connect(e,"onclick",this,this.hide)},teasp.dialog.AccessControlLog.prototype.preShow=function(){for(var e=0;e<this.eventHandles.length;e++
)dojo.disconnect(this.eventHandles[e]),delete this.eventHandles[e];this.eventHandles=[],this.sortKeys=[{apiKey:"LogDate__c"}],this.date=this.args.date,this.showDate();for(var t=dojo.byId(this.dialog.id),t=(dojo.query(".acclog-prevd > div",t)[0].innerHTML=teasp.message.getLabel("ac00000350"),dojo.query(".acclog-nextd > div",t)[0].innerHTML=teasp.message.getLabel("ac00000360"),this.eventHandles.push(dojo.connect(
dojo.query(".acclog-prevd",t)[0],"onclick",this,this.moveDate(-1))),this.eventHandles.push(dojo.connect(dojo.query(".acclog-nextd",t)[0],"onclick",this,this.moveDate(1))),dojo.query(".acclog-logs",t)[0]),a=(dojo.empty(t),dojo.create("table",null,t)),a=dojo.create("thead",null,a),o=dojo.create("tr",null,a),e=0;e<this.cols.length;e++){var s=dojo.create("th",{data:this.cols[e].apiKey,style:"width:"+(this.cols[e].width+(
e==this.cols.length-1?17:0))+"px;"},o),i=(this.eventHandles.push(dojo.connect(s,"onclick",this,this.clickHead)),dojo.create("div",null,s));dojo.create("div",{innerHTML:this.cols[e].label},i),dojo.create("div",{className:"pp_base"},i)}i=dojo.create("div",null,t);return dojo.create("tbody",null,dojo.create("table",null,i)),this.drawData([]),setTimeout(dojo.hitch(this,function(){this.search(this.date)}),100),!0},
teasp.dialog.AccessControlLog.prototype.showDate=function(){var e=this.pouch.getEmpDay(this.date),t=dojo.byId(this.dialog.id);dojo.query(".acclog-date",t)[0].innerHTML=teasp.util.date.formatDate(this.date,"JP1"),dojo.query(".acclog-event",t)[0].innerHTML=e.getCalendarEvent()},teasp.dialog.AccessControlLog.prototype.drawData=function(e){for(var t=dojo.byId(this.dialog.id),t=dojo.query(".acclog-logs",t)[0],
a=dojo.query("table tbody",t)[0],o=(dojo.empty(a),Math.max(e.length,10)),s=0;s<o;s++)for(var i=s<e.length?e[s]:null,n=dojo.create("tr",{className:s%2==0?"ts-row-even":"ts-row-odd"},a),r=0;r<this.cols.length;r++){var l=this.cols[r],p=i&&i[l.apiKey]||"";i&&("dateTime"==l.type?p=teasp.util.date.formatDateTime(p,"SLA-HM"):"boolean"==l.type?p=p?"○":"":"select"==l.type&&(p=l.pickMap[p]||"")),dojo.create("div",{innerHTML:p}
,dojo.create("td",{style:"width:"+l.width+"px;text-align:"+l.align+";"},n))}for(var d=0<this.sortKeys.length?this.sortKeys[0]:null,n=dojo.query("table thead tr",t)[0],s=0;s<n.cells.length;s++){var c=n.cells[s],m=d&&dojo.attr(c,"data")==d.apiKey,h=d&&d.desc?1:0;dojo.query("div.pp_base",c).forEach(function(e){dojo.toggleClass(e,"pp_ico_sort_asc",m&&!h),dojo.toggleClass(e,"pp_ico_sort_desc",m&&h)})}this.showDate()},
teasp.dialog.AccessControlLog.prototype.search=function(t){var e="select Id, LogDate__c, LogKey__c, LogType__c, Note__c, ProcessedFlag__c from AtkAccessControlLog__c where EmpId__c = '"+this.pouch.getEmpId()+"' and LogDate__c >= "+teasp.util.date.convDateTimeZone(t)+" and LogDate__c < "+teasp.util.date.convDateTimeZone(teasp.util.date.addDays(t,1)),a=[];dojo.forEach(this.sortKeys,function(e){a.push(e.apiKey+(
e.desc?" desc nulls last":""))}),a.length&&(e+=" order by "+a.join(", ")),console.log(e),teasp.action.contact.remoteMethods([{funcName:"getExtResult",params:{soql:e,limit:1e3,offset:0}}],{errorAreaId:null,nowait:!1},function(e){console.log(e),this.date=t,this.drawData(e.records)},null,this)},teasp.dialog.AccessControlLog.prototype.clickHead=function(e){var e=e.target,e=teasp.util.getAncestorByTagName(e,"TH"),
t=dojo.attr(e,"data"),a=this.sortKeys;if(a.length&&a[0].apiKey==t)a[0].desc=!a[0].desc;else{for(var o=a.length-1;0<=o;o--)a[o].apiKey==t&&a.splice(o,1);a.unshift({apiKey:t}),3<a.length&&a.splice(3,a.length-3)}this.search(this.date)},teasp.dialog.AccessControlLog.prototype.moveDate=function(a){return function(e){var t=teasp.util.date.addDays(this.date,a);this.search(t)}},teasp.provide("teasp.dialog.EmpSelect"),
teasp.dialog.EmpSelect=function(e,t,a,o,s,i,n){this.thisObject=e,this.depts=t,this.titles=a,this.getRangeValue=o,this.searchEmp=s,this.setCahceEmps=i,this.getEmpSelected=n,this.inited=!1,this.opend=!1,this.dialog=null,this.id="tooltipEmpSelect",
this.content='<div class="dlg_content"><table class="ts_a_frame" id="empSelectArea" style="margin-bottom:12px;"><tr><td class="edgelt"></td><td class="edgeht"></td><td class="edgert"></td></tr><tr><td class="edgevl"></td><td><div class="edge_div"><table class="stand_table" style="width:594px;margin:4px;"><tr><td style="text-align:left;white-space:nowrap;"><div style="margin:6px 4px;font-weight:bold;color: #4A4A56;">部署</div></td><td class="right"><select class="inputran" style="width:340px;vertical-align:middle;" id="empSelectDepts"></select><input type="button" id="empSelectBrowseDept" class="loupe" style="vertical-align:middle;" /></td></tr><tr><td></td><td class="right"><label><input type="checkbox" id="empSelectDeptBelow" />下位部署を含める</label></td></tr><tr><td style="text-align:left;white-space:nowrap;"><div style="margin:6px 4px;font-weight:bold;color: #4A4A56;">役職</div></td><td class="right"><select class="inputran" id="empSelectTitle" style="max-width:400px;"></select></td></tr><tr id="empSelectWarnRow" style="display:none;"><td colspan="2"><div id="empSelectWarn" style="color:red;margin:4px;"></div></td></tr><tr><td colspan="2"><table class="stone_area" style="margin:4px;"><tr><td><table class="stone_table"><tr><td class="head" style="width:22px;" ><input type="checkbox" id="empSelectCheck" /></td><td class="head" style="width:180px;"><div>部署名</div></td><td class="head" style="width:150px;"><div>役職</div></td><td class="head" style="width:100px;"><div>社員コード</div></td><td class="head" style="width:140px;"><div>社員名</div></td></tr></table><div class="stone_div" style="height:176px;"><table class="stone_table"><tbody id="empSelectTbody"></tbody></table></div></td></tr></table></td></tr></table></div></td><td class="edgevr"></td></tr><tr><td class="edgelb"></td><td class="edgehb"></td><td class="edgerb"></td></tr></table><div id="empSelectErrorArea"></div><table border="0" cellpadding="0" cellspacing="0" style="width:100%;"><tr><td style="padding:4px 0px;text-align:right;"><input type="button" class="deletebtn" value="クリア" id="empSelectClear" style="margin-right:24px;" /></td><td style="padding:4px 0px;text-align:left;"><input type="button" class="cancelbtn" value="閉じる" id="empSelectCancel" style="margin-left:24px;" /></td></tr></table></div>'
,this.targetEmps={},this.clickRowEvent=null,this.eventHandles=[]},teasp.dialog.EmpSelect.prototype.getDialog=function(){return this.dialog},teasp.dialog.EmpSelect.prototype._init=function(){var o,e;this.inited||(this.inited=!0,e={id:(o=this).id,content:this.content,onBlur:function(e){dijit.popup.close(o.dialog)}},this.dialog=new dijit.TooltipDialog(e),this.dialog.startup(),dojo.connect(this.dialog,"onOpen",this,
function(){if(console.log("dialog-onOpen"),!this.opened){this.setDeptPulldown();var e=dojo.byId("empSelectDepts");e.value="x",dojo.connect(e,"change",this,this.search),e=dojo.byId("empSelectTitle"),dojo.empty(e),dojo.create("option",{innerHTML:"（すべて）",value:"-"},e),dojo.create("option",{innerHTML:"（役職なし）",value:"-1"},e);for(var t=0;t<this.titles.length;t++)dojo.create("option",{innerHTML:this.titles[t],value:t},e);
e.value="-",dojo.connect(e,"change",this,this.search),dojo.connect(dojo.byId("empSelectDeptBelow"),"onclick",this,this.search),dojo.connect(dojo.byId("empSelectCancel"),"onclick",this,function(){console.log("empSelectCancel-onclick"),dijit.popup.close(o.dialog)}),dojo.connect(dojo.byId("empSelectClear"),"onclick",this,function(){dojo.byId("empSelectCheck").checked=!1;for(var e=dojo.byId("empSelectTbody"),
t=0;t<e.rows.length;t++){var a=e.rows[t];/empSelectRow(.+)/.exec(a.id)&&(e.rows[t].cells[0].firstChild.checked=!1)}this.clearAll()}),dojo.connect(dojo.byId("empSelectCheck"),"onclick",this,this.checkedAll),dojo.connect(dojo.byId("empSelectBrowseDept"),"onclick",this,this.openSelectDept);for(t=0;t<this.eventList.length;t++){var a=this.eventList[t];dojo.connect(dojo.byId(a.id),a.event,this,function(){dijit.popup.close(
o.dialog),a.method.apply(a.thisObject)})}}this.opened=!0,dojo.byId("empSelectCheck").checked=!1,this.createEmpTable()}))},teasp.dialog.EmpSelect.prototype.ready=function(e,t,a,o){this.eventList=e||[],this.clickRowEvent=t,this.clickAllRowEvent=a,this.clearAll=o,this._init()},teasp.dialog.EmpSelect.prototype.setEmps=function(e){this.targetEmps=e||{}},teasp.dialog.EmpSelect.prototype.showWarn=function(e){dojo.style(
"empSelectWarnRow","display",e?"":"none"),dojo.byId("empSelectWarn").innerHTML=e?e.entitize():""},teasp.dialog.EmpSelect.prototype.search=function(){this.showWarn(null);var e,t,a=dojo.byId("empSelectDepts").value;"x"!=a&&(e="-","-1"==(t=dojo.byId("empSelectTitle").value)?e=null:"-"!=t&&(e=this.titles[t]),dojo.byId("empSelectDeptBelow").disabled="-"==a||"-1"==a,t=this.getRangeValue(),this.searchEmp.apply(
this.thisObject,[{deptId:"-"==a?null:a,deptOption:dojo.byId("empSelectDeptBelow").checked,title:e,startDate:t.startDate,endDate:t.endDate,excludeIdList:[]},"empSelectErrorArea",function(e){this.setCahceEmps(e.emps),this.targetEmps.list=e.emps,this.createEmpTable()},this]))},teasp.dialog.EmpSelect.prototype.createEmpTable=function(){var e,t;if(dojo.byId("empSelectCheck")){for(var a=0;a<this.eventHandles.length;a++
)dojo.disconnect(this.eventHandles[a]),delete this.eventHandles[a];this.eventHandles=[],e=dojo.byId("empSelectTbody"),dojo.empty(e);var o=this.targetEmps.list||[],s=(dojo.style("empSelectArea","display",""),8<o.length?o.length:8);for(100<s&&(100<o.length?this.showWarn("該当件数が 100 件を超えました。上位 100 件のみ表示します。"):this.showWarn(null),s=100),t=0;t<s;t++){var i=t<o.length?o[t]:null,n=dojo.create("tr",{style:{height:"22px",
cursor:"pointer"},className:"sele "+(t%2==0?"even":"odd")},e),r=(i&&(n.id="empSelectRow"+i.Id),l=dojo.create("td",{style:{width:"22px",borderLeft:"none"}},n),i&&((l=dojo.create("input",{type:"checkbox"},l)).checked=this.getEmpSelected(i.Id),this.eventHandles.push(dojo.connect(l,"onclick",this,function(e){var e=(e=e||window.event).target,t=e.parentNode.parentNode,t=/empSelectRow(.+)/.exec(t.id);t&&this.clickRowEvent(
t[1],e.checked)}))),this),l=i&&i.DeptId__c?(i.DeptId__r.DeptCode__c||"")+"-"+(i.DeptId__r.Name||""):"";dojo.create("div",{innerHTML:l},dojo.create("td",{style:{width:"179px",textAlign:"left"},onclick:function(){r.clickRow(this)}},n)),dojo.create("div",{innerHTML:i&&i.Title__c||""},dojo.create("td",{style:{width:"149px",textAlign:"left"},onclick:function(){r.clickRow(this)}},n)),dojo.create("div",{
innerHTML:i&&i.EmpCode__c||""},dojo.create("td",{style:{width:"99px",textAlign:"left"},onclick:function(){r.clickRow(this)}},n)),dojo.create("div",{innerHTML:i?i.Name:""},dojo.create("td",{style:{width:"122px",textAlign:"left",borderRight:"none"},onclick:function(){r.clickRow(this)}},n))}}},teasp.dialog.EmpSelect.prototype.checkedAll=function(){for(var e=dojo.byId("empSelectCheck").checked,t=dojo.byId(
"empSelectTbody"),a=[],o=0;o<t.rows.length;o++){var s=t.rows[o],s=/empSelectRow(.+)/.exec(s.id);s&&(t.rows[o].cells[0].firstChild.checked=e,a.push(s[1]))}this.clickAllRowEvent(a,e)},teasp.dialog.EmpSelect.prototype.clickRow=function(e){var t,e=e.parentNode;!e.id||(t=/empSelectRow(.+)/.exec(e.id))&&((e=e.cells[0].firstChild).checked=!e.checked,this.clickRowEvent(t[1],e.checked))},
teasp.dialog.EmpSelect.prototype.setDeptPulldown=function(){var e=this.getRangeValue();if(e){var t=dojo.byId("empSelectDepts");if(t){dojo.attr(t,"disabled",!0),this.levelDepts=teasp.view.Shift.processingDepts(this.depts,e.startDate,e.endDate);e=t.value;dojo.empty(t),dojo.create("option",{innerHTML:"※※※選択してください※※※",value:"x"},t),dojo.create("option",{innerHTML:"（すべて）",value:"-"},t),dojo.create("option",{
innerHTML:"（部署未設定の社員）",value:"-1"},t);for(var a=0;a<this.levelDepts.length;a++){var o=this.levelDepts[a];o.past||o.future||dojo.create("option",{innerHTML:o.displayName,value:o.Id},t)}t.value=e||"-",setTimeout(function(){dojo.attr("empSelectDepts","disabled",!1)},1e3)}}},teasp.dialog.EmpSelect.prototype.openSelectDept=function(){teasp.manager.dialogOpen("SelectDept",null,{depts:this.levelDepts},this,function(e,t,a,o
){e.targetId&&(dojo.byId("empSelectDepts").value=e.targetId,this.search()),a&&a.apply(o),dijit.popup.open({popup:this.dialog,around:dojo.byId("entriedEmp")})})},teasp.provide("teasp.dialog.EmpDay"),teasp.dialog.EmpDay=function(e){this.inited=!1,this.opend=!1,this.dialog=null,this.id="tooltipEmpDay",
this.content='<div class="dlg_content"><table class="tooltip" style="width:300px;"><tbody id="EmpDayTbody"></tbody></table><table class="tooltip" style="margin-top:8px;width:100%;"><tr><td style="padding:2px 0px;text-align:center;"><input type="button" value="閉じる" id="EmpDayCancel" /></td></tr></table></div>',this.targetEmps={},this.clickRowEvent=null,this.eventHandles={},this.localObj=e},
teasp.dialog.EmpDay.prototype.getDialog=function(){return this.dialog},teasp.dialog.EmpDay.prototype._init=function(){var e,t;this.inited||(this.inited=!0,t={id:(e=this).id,content:this.content,onMouseLeave:function(){dijit.popup.close(e.dialog)}},this.dialog=new dijit.TooltipDialog(t),this.dialog.startup(),dojo.connect(this.dialog,"onOpen",this,function(){this.opened||dojo.connect(dojo.byId("EmpDayCancel"),"onclick"
,this,function(){dijit.popup.close(e.dialog)}),this.opened=!0,e.createContent()}))},teasp.dialog.EmpDay.prototype.ready=function(e){this._init()},teasp.dialog.EmpDay.prototype.setEmpDay=function(e,t,a){this.emp=e,this.dkey=t,this.normalPatternSymbol=a},teasp.dialog.EmpDay.prototype.getDisplayDayType=function(e){switch(e){case"0":return"勤務日";case"1":return"非勤務日(所定休日)";case"2":return"非勤務日(法定休日)";default:return""}},
teasp.dialog.EmpDay.prototype.createContent=function(){for(var e=dojo.byId("EmpDayTbody");e.firstChild;)dojo.destroy(e.firstChild);var t,a=this.emp.days[this.dkey],o=this.emp.DeptId__r?this.emp.DeptId__r.DeptCode__c+"-"+this.emp.DeptId__r.Name:null,o=(o&&(r=dojo.create("tr",null,e),dojo.create("div",{innerHTML:o},dojo.create("td",null,r))),r=dojo.create("tr",null,e),dojo.create("div",{innerHTML:(
this.emp.EmpCode__c||"")+"  "+this.emp.Name},dojo.create("td",null,r)),r=dojo.create("tr",null,e),dojo.create("div",{innerHTML:teasp.util.date.formatDate(this.dkey,"JP1")},dojo.create("td",null,r)),[]),s=null,i=!1;if(a.dayType==teasp.constant.DAY_TYPE_NORMAL_HOLIDAY?o.push("所定休日"):a.dayType==teasp.constant.DAY_TYPE_PUBLIC_HOLIDAY?o.push("祝日"):a.dayType==teasp.constant.DAY_TYPE_LEGAL_HOLIDAY?o.push("法定休日"
):!a.plannedHoliday||a.applys.kyushtu&&a.applys.kyushtu.length?a.applys.holidayAll?o.push(a.applys.holidayAll.HolidayId__r.Name+" (終日)"):(o.push("勤務日"),i=!0,s=a.pattern,a.applys.holidayAm&&o.push(a.applys.holidayAm.HolidayId__r.Name+" (午前休)"),a.applys.holidayPm&&o.push(a.applys.holidayPm.HolidayId__r.Name+" (午後休)")):o.push("有休計画付与日"),r=dojo.create("tr",null,e),dojo.create("div",{innerHTML:o.join(", ")},dojo.create(
"td",null,r)),!i||s||((s=this.emp.empType.days[this.dkey].config).Name=" 通常勤務",s.Symbol__c=this.normalPatternSymbol),s){var n,r=dojo.create("tr",null,e),l=dojo.create("td",null,r);a.pattern&&(n=s.Symbol__c||s.Name.substring(0,1),dojo.create("div",{className:"pattern dayDiv",style:{float:"left"},innerHTML:n},l)),dojo.create("div",{innerHTML:s.Name},l),r=dojo.create("tr",null,e);for(var p=teasp.util.time.timeValue(
s.StdStartTime__c)+"～"+teasp.util.time.timeValue(s.StdEndTime__c),d=(dojo.create("div",{innerHTML:p},dojo.create("td",null,r)),r=dojo.create("tr",null,e),s.RestTimes__c&&0<s.RestTimes__c.length?s.RestTimes__c.split(/,/):[]),c=(a.applys.holidayAm&&!a.applys.holidayPm&&s.UseHalfHolidayRestTime__c?d=s.AmHolidayRestTimes__c&&0<s.AmHolidayRestTimes__c.length?s.AmHolidayRestTimes__c.split(/,/):[
]:!a.applys.holidayAm&&a.applys.holidayPm&&s.UseHalfHolidayRestTime__c&&(d=s.PmHolidayRestTimes__c&&0<s.PmHolidayRestTimes__c.length?s.PmHolidayRestTimes__c.split(/,/):[]),[]),m=0;m<d.length;m++){var h=/(\d+)\-(\d+)/.exec(d[m]);h&&c.push(teasp.util.time.timeValue(h[1])+"～"+teasp.util.time.timeValue(h[2]))}dojo.create("div",{innerHTML:"(休憩："+(0<c.length?c.join(", "):"なし")+")"},dojo.create("td",null,r)),
s.UseDiscretionary__c&&(r=dojo.create("tr",null,e),dojo.create("div",{innerHTML:"裁量"},dojo.create("td",null,r)))}for(t in a.workPlace&&a.workPlace.Id!=this.emp.DeptId__c&&(n=a.workPlace.Symbol__c||a.workPlace.Name.substring(0,1),r=dojo.create("tr",null,e),l=dojo.create("td",null,r),dojo.create("div",{innerHTML:"主管部署：",style:{float:"left"}},l),dojo.create("div",{className:"workPlace dayDiv",style:{float:"left",
marginRight:"2px"},innerHTML:n},l),dojo.create("div",{innerHTML:" "+a.workPlace.Name},l)),a.applys)if(a.applys.hasOwnProperty(t))for(var u=is_array(a.applys[t])?a.applys[t]:[a.applys[t]],g=0;g<u.length;g++){var y=u[g],p=(r=dojo.create("tr",null,e),l=dojo.create("td",null,r),dojo.create("div",{className:"pp_base pp_ap_"+teasp.view.Shift.getApplyStyleKey(t)+teasp.constant.getStatusStyleSuffix(y.Status__c),style:{
float:"left",marginTop:"2px",marginRight:"2px"}},l),y.ApplyType__c);y.ApplyType__c==teasp.constant.APPLY_TYPE_HOLIDAY?y.HolidayId__r.Range__c==teasp.constant.RANGE_TIME?p+="("+y.HolidayId__r.Name+"/"+teasp.util.time.timeValue(y.StartTime__c)+"-"+teasp.util.time.timeValue(y.EndTime__c
)+")":p+="("+y.HolidayId__r.Name+")":y.ApplyType__c==teasp.constant.APPLY_TYPE_PATTERNS||y.ApplyType__c==teasp.constant.APPLY_TYPE_PATTERNL?p+="("+(y.PatternId__r?y.PatternId__r.Name:this.getDisplayDayType(y.DayType__c))+")":y.ApplyType__c==teasp.constant.APPLY_TYPE_EXCHANGE&&(p+="("+teasp.util.date.formatDate(y.StartDate__c,"M/d")+"⇔"+teasp.util.date.formatDate(y.ExchangeDate__c,"M/d")+")"),p+="("+y.Status__c+")",
dojo.create("div",{innerHTML:p},l)}a.memo&&(r=dojo.create("tr",null,e),dojo.create("div",{innerHTML:teasp.util.entitize(a.memo).replace(/\n/g,"<br/>")},dojo.create("td",null,r)))},teasp.provide("teasp.helper.Graph"),teasp.helper.Graph=function(e){this.toolTips=[],this.pouch=null,this.TIME_TABLE_NORMAL=1,this.TIME_TABLE_LZAN=2,this.TIME_TABLE_LOUT=3,this.TIME_TABLE_CHARGE=4,this.TIME_TABLE_HOLYWORK=5,
this.TIME_TABLE_HOLYAM=6,this.TIME_TABLE_HOLYPM=7,this.TIME_TABLE_LATE=8,this.TIME_TABLE_EARLY=9,this.TIME_TABLE_REST_FIX=21,this.TIME_TABLE_REST_FREE=22,this.TIME_TABLE_REST_PAY=23,this.TIME_TABLE_AWAY=30,this.MARKER_ID_PREFIX="atkmarker",this.TOOLTIP_ID_PREFIX="atktooltip",this.OUT_COUNT_MAX=5,this.REST_COUNT_MAX=10,this.startY=e&&e.startY||48,this.areaWidth=e&&e.areaWidth||0,this.marginLeft=e&&e.marginLeft||10,
this.widthPerH=e&&e.widthPerH||24,this.edgeMark=e&&e.edgeMark||!1,this.movable=e&&e.movable||!1,this.setDialogMode(),this.clickedEvent=e&&e.clickedEvent||null,this.clickedApply=e&&e.clickedApply||null,this.sizeType=e&&e.sizeType||"small",this.timeRound=e&&e.timeRound||1,this.readOnly=e&&e.readOnly||!1,this.restFix=e&&e.restFix||!1,this.hideTimeGraphPopup=e&&e.hideTimeGraphPopup||!1,this.that=e.that,this.lineHeight=24
,this.impactMakers={},this.restMarkers=[],this.awayMarkers=[],this.tempMarker={},this.dragObj=null,this.eventHandles=[],this.baseDivId=null,this.typeStyleMap=[],this.typeStyleMap[this.TIME_TABLE_NORMAL]="marker_work",this.typeStyleMap[this.TIME_TABLE_LZAN]="marker_lzan",this.typeStyleMap[this.TIME_TABLE_CHARGE]="marker_lext",this.typeStyleMap[this.TIME_TABLE_LOUT]="marker_lout",
this.typeStyleMap[this.TIME_TABLE_REST_FIX]="marker_rest",this.typeStyleMap[this.TIME_TABLE_REST_FREE]="marker_rest",this.typeStyleMap[this.TIME_TABLE_REST_PAY]="marker_line",this.typeStyleMap[this.TIME_TABLE_AWAY]="marker_away",this.typeStyleMap[this.TIME_TABLE_HOLYWORK]="marker_holy",this.markerSizeSet={small:{shadow_fix:{h:10,zIndex:100},shadow_rest:{h:10,zIndex:105},marker_work:{h:10,zIndex:110},marker_lzan:{
h:10,zIndex:120},marker_lout:{h:10,zIndex:130},marker_holy:{h:10,zIndex:140},marker_away:{h:6,zIndex:150},marker_lext:{h:4,zIndex:160},marker_night:{h:3,zIndex:170},marker_rest:{h:10,zIndex:175},marker_line:{h:2,zIndex:200}},middle:{shadow_fix:{h:16,zIndex:100},shadow_rest:{h:16,zIndex:105},marker_work:{h:16,zIndex:110},marker_lzan:{h:16,zIndex:120},marker_lout:{h:16,zIndex:130},marker_holy:{h:16,zIndex:140},
marker_away:{h:10,zIndex:150},marker_lext:{h:7,zIndex:160},marker_night:{h:4,zIndex:170},marker_rest:{h:16,zIndex:175},marker_line:{h:3,zIndex:200}},large:{shadow_fix:{h:30,zIndex:1e3},shadow_rest:{h:30,zIndex:1050},marker_work:{h:30,zIndex:1100},marker_lzan:{h:30,zIndex:1200},marker_lout:{h:30,zIndex:1300},marker_holy:{h:30,zIndex:1400},marker_away:{h:25,zIndex:1500},marker_lext:{h:12,zIndex:1600},marker_night:{h:9,
zIndex:1700},marker_rest:{h:20,zIndex:1750,eh:30},marker_line:{h:5,zIndex:2e3}}},this.MARK_APPS=[{elementKey:"patternL",className:"patl",applyType:teasp.message.getLabel("applyPatternL_label"),title:teasp.message.getLabel("applyPatternL_label")},{elementKey:"patternS",className:"pats",applyType:teasp.message.getLabel("applyPatternS_label"),title:teasp.message.getLabel("applyPatternS_label")},{elementKey:"patternD",
className:"patd",applyType:teasp.message.getLabel("applyPatternS_label"),title:teasp.message.getLabel("applyPatternS_label")},{elementKey:"exchangeS",className:"exch",applyType:teasp.message.getLabel("applyExchange_label"),title:teasp.message.getLabel("applyExchange_label")},{elementKey:"exchangeE",className:"exch",applyType:teasp.message.getLabel("applyExchange_label"),title:teasp.message.getLabel(
"applyExchange_label")},{elementKey:"shiftChange",className:"exch",applyType:teasp.message.getLabel("tf10011260"),title:teasp.message.getLabel("tf10011260")},{elementKey:"holidayAll",className:"kyun",applyType:teasp.message.getLabel("applyHoliday_label"),title:teasp.message.getLabel("applyHoliday_label")},{elementKey:"holidayAm",className:"kyun",applyType:teasp.message.getLabel("applyHoliday_label"),
title:teasp.message.getLabel("tm10001270")},{elementKey:"holidayPm",className:"kyun",applyType:teasp.message.getLabel("applyHoliday_label"),title:teasp.message.getLabel("tm10001280")},{elementKey:"holidayTime",className:"kyut",applyType:teasp.message.getLabel("applyHoliday_label"),title:teasp.message.getLabel("tm10001290")},{elementKey:"kyushtu",className:"hwrk",applyType:teasp.message.getLabel(
"applyHolidayWork_label"),title:teasp.message.getLabel("applyHolidayWork_label")},{elementKey:"zangyo",className:"zanw",applyType:teasp.message.getLabel("applyZangyo_label"),title:teasp.message.getLabel("applyZangyo_label")},{elementKey:"earlyStart",className:"east",applyType:teasp.message.getLabel("applyEarlyWork_label"),title:teasp.message.getLabel("applyEarlyWork_label")},{elementKey:"lateStart",className:"late",
applyType:teasp.message.getLabel("applyLateStart_label"),title:teasp.message.getLabel("applyLateStart_label")},{elementKey:"earlyEnd",className:"earl",applyType:teasp.message.getLabel("applyEarlyEnd_label"),title:teasp.message.getLabel("applyEarlyEnd_label")},{elementKey:"reviseTime",className:"revt",applyType:teasp.message.getLabel("applyReviseTime_label"),title:teasp.message.getLabel("applyReviseTime_label")},{
elementKey:"direct",className:"drct",applyType:teasp.message.getLabel("tk10004650"),title:teasp.message.getLabel("tk10004650")}],this.setStartY=function(e){this.startY=e},this.setAreaWidth=function(e){this.areaWidth=e},this.setMarginLeft=function(e){this.marginLeft=e},this.setWidthPerH=function(e){this.widthPerH=e},this.setEdgeMark=function(e){this.edgeMark=e},this.setMovable=function(e){this.movable=e},
this.setClickedEvent=function(e){this.clickedEvent=e},this.setSizeType=function(e){this.sizeType=e},this.setTimeRound=function(e){this.timeRound=e},this.setReadOnly=function(e){this.readOnly=e}},teasp.helper.Graph.prototype.setDialogMode=function(){this.dialogMode=this.movable,this.movable=!1},teasp.helper.Graph.prototype.clear=function(){if(this.baseDivId){for(var e=0;e<this.toolTips.length;e++){var t=dijit.byId(
this.toolTips[e]);t&&(t.destroyRecursive(),t.domNode=null,t=null)}for(this.toolTips=[],e=0;e<this.eventHandles.length;e++)dojo.disconnect(this.eventHandles[e]),delete this.eventHandles[e];this.eventHandles=[];var a=dojo.byId(this.baseDivId);dojo.query(".marker_div",a).forEach(function(e){dojo.destroy(e)})}this.impactMakers={},this.restMarkers=[],this.awayMarkers=[]},teasp.helper.Graph.prototype.draw=function(e,t,a){
this.pouch=e,this.baseDivId=t,30==this.timeRound?this.minW=24:15==this.timeRound?this.minW=12:10==this.timeRound?this.minW=8:this.minW=4;var o,s=this.startY;if(this.dialogMode)this.movable&&(o=dojo.byId("editTable"),this.eventHandles.push(dojo.connect(o,"onmousedown",this,function(e){return this.extraMouseDown(o,e||window.event),!1})),this.eventHandles.push(dojo.connect(o,"onmouseup",this,function(e){
this.extraMouseUp(o,e||window.event)})),this.eventHandles.push(dojo.connect(o,"onmousemove",this,function(e){return this.extraMouseMove(o,e||window.event),!1})),this.loadMenu()),this.targetDayObj=dojo.clone(this.pouch.getEmpDay(a[0]).getObj()),this.createDivs(this.targetDayObj,s);else for(var i=0;i<a.length;i++)this.createDivs(this.pouch.getEmpDay("string"==typeof a[i]?a[i]:a[i].date).getObj(),s,1==a.length),
s+=this.lineHeight},teasp.helper.Graph.prototype.setParam=function(e){this.readOnly=e&&e.readOnly||!1,this.restFix=e&&e.restFix||!1},teasp.helper.Graph.prototype.createMarkerId=function(){return this.MARKER_ID_PREFIX+ ++teasp.sequence.marker},teasp.helper.Graph.prototype.createDivs=function(e,t,H){var a=null,P=null,o=[],s=null,i=this.pouch.getCalcMode(),n=(this.dialogMode&&i==teasp.constant.C_DISC&&(
i=teasp.constant.C_REAL),this.pouch.getEmpDay(e.date));if(this.pouch.isAlive(e.date)){var r=n.getPattern(),C=n.getStartTime(!0,null,i,!0),W=n.getEndTime(!0,null,i,!0),F={from:C,to:W},l=this.dialogMode?{from:0,to:2880}:{from:C,to:W},Y="number"==typeof C&&"number"==typeof W&&C<W||e[i].discReal,q=n.getTimeTable(!0),p=[],d=this.markerSizeSet[this.sizeType],c="large"==this.sizeType?13:"middle"==this.sizeType?7:4,
m=dojo.byId(this.baseDivId),B=null,V=e.rack.hourRests||[],K=[];for(this.tempMarker={},E=0;E<q.length;E++)(I=q[E]).type!=teasp.constant.REST_FIX&&I.type!=teasp.constant.REST_FREE&&I.type!=teasp.constant.AWAY||(teasp.util.time.isValidRange(I.from,I.to)?K.push(I):"number"!=typeof I.from&&"number"!=typeof I.to||K.push({from:"number"==typeof I.from?I.from:I.to-5,to:"number"==typeof I.to?I.to:I.from+5,type:I.type,
temporary:I}));var h,u,U=e.rack.validApplys.holidayAll,g=null,J=(U&&(U.holiday.type==teasp.constant.HOLIDAY_TYPE_PAID||e.rack.plannedHolidayReal?g=teasp.constant.HOLIDAY_TYPE_PAID:U.holiday.type==teasp.constant.HOLIDAY_TYPE_DAIQ?g=teasp.constant.HOLIDAY_TYPE_DAIQ:U.holiday.type==teasp.constant.HOLIDAY_TYPE_FREE&&(g=teasp.constant.HOLIDAY_TYPE_FREE)),n.isPlannedHoliday()&&!n.isExistApply(
teasp.constant.APPLY_KEY_KYUSHTU)&&(g=teasp.constant.HOLIDAY_TYPE_PAID),!1),y=n.getDiscretionaryLevel(),G=(Y&&!this.dialogMode&&0<y&&(J=!0),h=null,0<e.rack.validApplys.kyushtu.length?h={st:e.rack.validApplys.kyushtu[0].startTime,et:e.rack.validApplys.kyushtu[0].endTime}:teasp.util.time.isValidRange(e.rack.fixStartTime2,e.rack.fixEndTime2)?h={st:e.rack.fixStartTime2,et:e.rack.fixEndTime2}:teasp.util.time.isValidRange(
e.rack.fixStartTime,e.rack.fixEndTime)?h={st:e.rack.fixStartTime,et:e.rack.fixEndTime}:(h={st:r.stdStartTime,et:r.stdEndTime},U&&0<(e.rack.paidHolySpans||[]).length&&(h={st:e.rack.paidHolySpans[0].from,et:e.rack.paidHolySpans[0].to})),h&&(a=this.calcPosWidth(h.st,h.et,this.widthPerH)),this.pouch.getWorkSystem()==teasp.constant.WORK_SYSTEM_FLEX&&n.isNormalDay()&&this.pouch.isCoreTimeGraph()&&(
y=this.pouch.getConfigObj(),r.id&&e.rack.useCoreTime||(P={},e.rack.useCoreTime&&(P.zone=this.calcPosWidth(y.coreStartTime,y.coreEndTime,this.widthPerH)))),e[i].workSpan);if(0<G.length)for(E=0;E<G.length;E++)o.push(this.calcPosWidth(G[E].from,G[E].to,this.widthPerH));if(this.areaWidth&&(a||0<o.length)&&(s=0<o.length?(y=o[0].begX,b=o[o.length-1].endX,h={begX:y<a.begX?y:a.begX,endX:b>a.endX?b:a.endX},
this.calcAbsolutePos(y,h.begX,b-y,h.endX-h.begX,this.areaWidth,this.marginLeft)):this.calcAbsolutePos(a.begX,a.begX,a.endX-a.begX,a.endX-a.begX,this.areaWidth,this.marginLeft),m.style.backgroundPosition="-"+s.x+"px -3px"),!this.dialogMode){for(var z,f,b=n.getStartTime(!0,null,teasp.constant.C_REAL),y=n.getEndTime(!0,null,teasp.constant.C_REAL),X=[],_=("number"==typeof b&&(L=b*this.widthPerH/60,te=t-4,(
!s||s.leftX<=L&&L<s.rightX)&&(L+=this.marginLeft-(s?s.x:0)-2,z=1&n.getInputLimit().flag?"yellow":"blue",0<n.getObj().real.lateTime&&(z="red"),k=dojo.create("div",{className:"marker_div abs_div pp_base pp_inout_"+z,style:{left:L+"px",top:te+"px",zIndex:202}},m),1&n.getInputLimit().flag&&(k.title=teasp.message.getLabel("tk10004680")),X.push({sx:L,ex:L+5}),k=null)),"number"==typeof y&&(L=y*this.widthPerH/60,te=t-3,(
!s||s.leftX<=L&&L<s.rightX)&&(L+=this.marginLeft-(s?s.x:0)-2,z=2&n.getInputLimit().flag?"yellow":"blue",0<n.getObj().real.earlyTime&&(z="red"),k=dojo.create("div",{className:"marker_div abs_div pp_base pp_inout_"+z,style:{left:L+"px",top:te+"px",zIndex:202}},m),X.push({sx:L,ex:L+5}),2&n.getInputLimit().flag&&(k.title=teasp.message.getLabel("tk10004690")),k=null)),{zangyo:{applys:[],
x:r?r.stdEndTime*this.widthPerH/60:a.endX},other:{applys:[],x:r?r.stdStartTime*this.widthPerH/60:a.begX}}),v=0;v<this.MARK_APPS.length;v++){var T=[],j=e.rack.validApplys[this.MARK_APPS[v].elementKey];if(j&&(is_array(j)?T=j:T.push(j)),e.rack.validApplys.rejects&&(j=e.rack.validApplys.rejects[this.MARK_APPS[v].elementKey])&&(is_array(j)?T=T.concat(j):T.push(j)),T.length){var Z=(
"zangyo"==this.MARK_APPS[v].elementKey?_.zangyo:_.other).applys;if(is_array(T))for(E=0;E<T.length;E++)Z.push({an:T[E],cn:this.MARK_APPS[v].className,cnfx:teasp.constant.getStatusStyleSuffix(T[E].status),title:this.MARK_APPS[v].title+"("+teasp.constant.getDisplayStatus(T[E].status)+")"});else Z.push({an:T,cn:this.MARK_APPS[v].className,cnfx:teasp.constant.getStatusStyleSuffix(T.status),
title:this.MARK_APPS[v].title+"("+teasp.constant.getDisplayStatus(T.status)+")"})}}for(f in _)for(var Q=_[f].x,E=0;E<_[f].applys.length;E++){var L=Q;if(!s||s.leftX<=L&&L<s.rightX){L+=this.marginLeft-(s?s.x:0)+2;for(var $,ee=0;ee<X.length;ee++)L<=X[ee].ex&&X[ee].sx<=L+11&&(Q+=$=X[ee].ex+1-L,L+=$);Q+=12;var te=t-3,k=dojo.create("div",{style:{cursor:"pointer",lineHeight:"11px",left:L+"px",top:te+"px",zIndex:201},
className:"marker_div abs_div pp_base pp_ap_"+_[f].applys[E].cn+_[f].applys[E].cnfx,title:_[f].applys[E].title,width:"11px"},m);this.clickedApply&&this.eventHandles.push(dojo.connect(k,"onclick",this.that,this.clickedApply.apply(this.that,[e.date,_[f].applys[E].an.id]))),k=null}}}if(!(!a&&o.length<=0||!n.isInputTime()&&n.isHoliday()&&!e.rack.validApplys.kyushtu.length)){if(a){for((u=this.calcMakerPos(a,s,
this.marginLeft,t))&&(w="",w=n.isPlannedHoliday()&&!n.isExistApply(teasp.constant.APPLY_KEY_KYUSHTU)||g==teasp.constant.HOLIDAY_TYPE_PAID?"marker_work":g==teasp.constant.HOLIDAY_TYPE_DAIQ?"marker_rest":(P&&(u=P.zone?this.calcMakerPos(P.zone,s,this.marginLeft,t):null),"shadow_fix"),u&&((h=dojo.clone(d[w])).eh&&(h.h=h.eh),O=this.createMarkerId(),(k=dojo.create("div",{style:this.getStyleSize(u.x,u.y,u.w,h),
width:u.w+"px",className:"marker_div "+w,id:O},m)).style.left=u.x+"px",k.style.top=u.y+"px",k.style.width=u.w+"px",k.style.height=h.h+"px",p.push(O),g&&((x=dojo.create("div",{style:this.getStyleSize(u.x,u.y+c,u.w,d.marker_line),className:"marker_div marker_line"},m)).style.left=u.x+"px",x.style.top=u.y+c+"px",x.style.width=u.w+"px",x.style.height=d.marker_line.h+"px",x=null),this.movable&&!this.readOnly&&(
this.eventHandles.push(dojo.connect(k,"onmousedown",this,function(e){return this.extraMouseDown(k,e||window.event),!1})),this.eventHandles.push(dojo.connect(k,"onmouseup",this,function(e){this.extraMouseUp(k,e||window.event)})),this.eventHandles.push(dojo.connect(k,"onmousemove",this,function(e){return this.extraMouseMove(k,e||window.event),!1})),this.pMenu.bindDomNode(k.id)),k=null)),
E=0;E<e.rack.validApplys.zangyo.length;E++){var D=e.rack.validApplys.zangyo[E];h=this.calcPosWidth(D.startTime,D.endTime,this.widthPerH),(u=this.calcMakerPos(h,s,this.marginLeft,t))&&(O=this.createMarkerId(),(k=dojo.create("div",{style:this.getStyleSize(u.x,u.y,u.w,d.shadow_fix),className:"marker_div shadow_fix",id:O},m)).style.left=u.x+"px",k.style.top=u.y+"px",k.style.width=u.w+"px",
k.style.height=d.shadow_fix.h+"px",p.push(O),k=null)}for(E=0;E<e.rack.validApplys.earlyStart.length;E++)D=e.rack.validApplys.earlyStart[E],h=this.calcPosWidth(D.startTime,D.endTime,this.widthPerH),(u=this.calcMakerPos(h,s,this.marginLeft,t))&&(O=this.createMarkerId(),(k=dojo.create("div",{style:this.getStyleSize(u.x,u.y,u.w,d.shadow_fix),className:"marker_div shadow_fix",id:O},m)).style.left=u.x+"px",
k.style.top=u.y+"px",k.style.width=u.w+"px",k.style.height=d.shadow_fix.h+"px",p.push(O),k=null);if(g!=teasp.constant.HOLIDAY_TYPE_DAIQ)for(E=0;E<r.restTimes.length;E++){var I=r.restTimes[E];h=g==teasp.constant.HOLIDAY_TYPE_PAID?this.calcPosWidth(r.stdStartTime<=I.from?I.from:r.stdStartTime,I.to<=r.stdEndTime?I.to:r.stdEndTime,this.widthPerH):this.calcPosWidth(I.from,I.to,this.widthPerH),(u=this.calcMakerPos(h,s,
this.marginLeft,t))&&0<u.w&&(w=g==teasp.constant.HOLIDAY_TYPE_PAID||g==teasp.constant.HOLIDAY_TYPE_FREE?"marker_rest":"shadow_rest",O=this.createMarkerId(),(k=dojo.create("div",{style:this.getStyleSize(u.x,u.y,u.w,d[w]),className:"marker_div "+w,id:O},m)).style.left=u.x+"px",k.style.top=u.y+"px",k.style.width=u.w+"px",k.style.height=d[w].h+"px",p.push(O),this.movable&&!this.readOnly&&(this.eventHandles.push(
dojo.connect(k,"onmousedown",this,function(e){return this.extraMouseDown(k,e||window.event),!1})),this.eventHandles.push(dojo.connect(k,"onmouseup",this,function(e){this.extraMouseUp(k,e||window.event)})),this.eventHandles.push(dojo.connect(k,"onmousemove",this,function(e){return this.extraMouseMove(k,e||window.event),!1})),this.pMenu.bindDomNode(k.id)),k=null)}if(!U&&(
e.rack.validApplys.holidayAm||e.rack.validApplys.holidayPm)&&!n.isFlexHalfDayTimeDay())for(E=0;E<2;E++)if(D=0==E?e.rack.validApplys.holidayAm:e.rack.validApplys.holidayPm){var A={},B=D.holiday.range==teasp.constant.RANGE_AM?(A.from=r.amHolidayStartTime,A.to=r.amHolidayEndTime,{from:0,to:A.to}):(A.from=r.pmHolidayStartTime,A.to=r.pmHolidayEndTime,{from:A.from,to:2880});if(A.from<l.from&&(l.from=A.from),l.to<A.to&&(
l.to=A.to),h=this.calcPosWidth(A.from,A.to,this.widthPerH),(u=this.calcMakerPos(h,s,this.marginLeft,t))&&(D.holiday.type!=teasp.constant.HOLIDAY_TYPE_PAID&&D.holiday.type!=teasp.constant.HOLIDAY_TYPE_DAIQ||(w=D.holiday.type==teasp.constant.HOLIDAY_TYPE_PAID?"marker_work":"marker_rest",(h=dojo.clone(d[w])).eh&&(h.h=h.eh),O=this.createMarkerId(),(k=dojo.create("div",{style:this.getStyleSize(u.x,u.y,u.w,h),
className:"marker_div "+w,id:O},m)).style.left=u.x+"px",k.style.top=u.y+"px",k.style.width=u.w+"px",k.style.height=h.h+"px",p.push(O),k=null),dojo.create("div",{style:this.getStyleSize(u.x,u.y+c,u.w,d.marker_line),className:"marker_div marker_line"},m)),D.holiday.type==teasp.constant.HOLIDAY_TYPE_PAID||D.holiday.type==teasp.constant.HOLIDAY_TYPE_FREE){for(var ae=[],S=0;S<r.restTimes.length;S++){I=r.restTimes[S];
var oe={from:(A.from<=I.from?I:A).from,to:(I.to<=A.to?I:A).to};h=this.calcPosWidth(oe.from,oe.to,this.widthPerH),(u=this.calcMakerPos(h,s,this.marginLeft,t))&&(ae.push(oe),O=this.createMarkerId(),(k=dojo.create("div",{style:this.getStyleSize(u.x,u.y,u.w,d.marker_rest),className:"marker_div marker_rest",id:O},m)).style.left=u.x+"px",k.style.top=u.y+"px",k.style.width=u.w+"px",k.style.height=d.marker_rest.h+"px",
p.push(O))}0<ae.length&&(K=teasp.helper.Graph.excludeRanges(K,ae))}}}if(Y&&0<o.length){for(E=0;E<o.length;E++)(u=this.calcMakerPos(o[E],s,this.marginLeft,t))&&(O=this.createMarkerId(),(k=dojo.create("div",{style:this.getStyleSize(u.x,u.y,u.w,d.marker_work),className:"marker_div marker_work",id:O},m)).style.left=u.x+"px",k.style.top=u.y+"px",k.style.width=u.w+"px",k.style.height=d.marker_work.h+"px",p.push(O),
this.movable&&!this.readOnly&&(this.eventHandles.push(dojo.connect(k,"onmousedown",this,function(e){return this.extraMouseDown(k,e||window.event),!1})),this.eventHandles.push(dojo.connect(k,"onmouseup",this,function(e){this.extraMouseUp(k,e||window.event)})),this.eventHandles.push(dojo.connect(k,"onmousemove",this,function(e){return this.extraMouseMove(k,e||window.event),!1})),this.pMenu.bindDomNode(k.id)),k=null);
J&&(b={begX:o[0].begX,endX:o[o.length-1].endX},(u=this.calcMakerPos(b,s,this.marginLeft,t))&&((x=dojo.create("div",{style:this.getStyleSize(u.x,u.y+c,u.w,d.marker_line),className:"marker_div marker_line"},m)).style.left=u.x+"px",x.style.top=u.y+c+"px",x.style.width=u.w+"px",x.style.height=d.marker_line.h+"px",x=null));var x,se=[];for(E=0;E<e[i].workHolidaySpan.length;E++)se.push({span:e[i].workHolidaySpan[E],
key:this.TIME_TABLE_HOLYWORK});for(E=0;E<e[i].workLegalOverSpan.length;E++)se.push({span:e[i].workLegalOverSpan[E],key:this.TIME_TABLE_LZAN});for(E=0;E<e[i].workLegalOutOverSpan.length;E++)se.push({span:e[i].workLegalOutOverSpan[E],key:this.TIME_TABLE_LOUT});for(E=0;E<e[i].workChargeSpan.length;E++)se.push({span:e[i].workChargeSpan[E],key:this.TIME_TABLE_CHARGE});for(E=0;E<se.length;E++)(M=se[E].span)&&(
w=this.typeStyleMap[se[E].key],h=this.calcPosWidth(M.from,M.to,this.widthPerH),(u=this.calcMakerPos(h,s,this.marginLeft,t))&&(O=this.createMarkerId(),(k=dojo.create("div",{style:this.getStyleSize(u.x,u.y,u.w,d[w]),className:"marker_div "+w,id:O},m)).style.left=u.x+"px",k.style.top=u.y+"px",k.style.width=u.w+"px",k.style.height=d[w].h+"px",p.push(O),"marker_lout"!=w&&"marker_lzan"!=w&&"marker_lext"!=w||(
this.impactMakers[w]=O),this.movable&&!this.readOnly&&(this.eventHandles.push(dojo.connect(k,"onmousedown",this,function(e){return this.extraMouseDown(k,e||window.event),!1})),this.eventHandles.push(dojo.connect(k,"onmouseup",this,function(e){this.extraMouseUp(k,e||window.event)})),this.eventHandles.push(dojo.connect(k,"onmousemove",this,function(e){return this.extraMouseMove(k,e||window.event),!1}))),k=null));for(
E=0;E<V.length;E++){var ie=V[E];h=this.calcPosWidth(ie.from,ie.to,this.widthPerH),(u=this.calcMakerPos(h,s,this.marginLeft,t))&&(O=this.createMarkerId(),(k=dojo.create("div",{style:this.getStyleSize(u.x,u.y,u.w,d.marker_work),className:"marker_div "+(ie.type==teasp.constant.REST_PAY?"marker_work":"shadow_fix"),id:O},m)).style.left=u.x+"px",k.style.top=u.y+"px",k.style.width=u.w+"px",
k.style.height=d.marker_work.h+"px",p.push(O),(k=dojo.create("div",{style:this.getStyleSize(u.x,u.y+c,u.w,d.marker_line),className:"marker_div marker_line"},m)).style.left=u.x+"px",k.style.top=u.y+c+"px",k.style.width=u.w+"px",k.style.height=d.marker_line.h+"px",this.movable&&!this.readOnly&&(this.eventHandles.push(dojo.connect(k,"onmousedown",this,function(e){return this.extraMouseDown(k,e||window.event),!1})),
this.eventHandles.push(dojo.connect(k,"onmouseup",this,function(e){this.extraMouseUp(k,e||window.event)})),this.eventHandles.push(dojo.connect(k,"onmousemove",this,function(e){return this.extraMouseMove(k,e||window.event),!1}))),ie.from<l.from&&(l.from=ie.from),l.to<ie.to&&(l.to=ie.to))}if(!r.igonreNightWork){var ne=e[teasp.constant.C_REAL].realWorkNightSpans||[];if(0<ne.length)for(E=0;E<ne.length;E++)I=ne[E],
h=this.calcPosWidth(I.from,I.to,this.widthPerH),(u=this.calcMakerPos(h,s,this.marginLeft,t))&&((k=dojo.create("div",{style:this.getStyleSize(u.x,u.y,u.w,d.marker_night),className:"marker_div marker_night"},m)).style.left=u.x+"px",k.style.top=u.y+"px",k.style.width=u.w+"px",k.style.height=d.marker_night.h+"px",k=null)}}else for(E=0;E<e.rack.validApplys.holidayTime.length;E++)if(D=e.rack.validApplys.holidayTime[E],
h=this.calcPosWidth(D.startTime,D.endTime,this.widthPerH),(u=this.calcMakerPos(h,s,this.marginLeft,t))&&(O=this.createMarkerId(),(k=dojo.create("div",{style:this.getStyleSize(u.x,u.y,u.w,d.marker_work),className:"marker_div "+(D.holiday.type==teasp.constant.HOLIDAY_TYPE_PAID?"marker_work":"shadow_fix"),id:O},m)).style.left=u.x+"px",k.style.top=u.y+"px",k.style.width=u.w+"px",k.style.height=d.marker_work.h+"px",
p.push(O),(k=dojo.create("div",{style:this.getStyleSize(u.x,u.y+c,u.w,d.marker_line),className:"marker_div marker_line"},m)).style.left=u.x+"px",k.style.top=u.y+c+"px",k.style.width=u.w+"px",k.style.height=d.marker_line.h+"px",k=null),"number"!=typeof C&&"number"!=typeof W)for(S=0;S<r.restTimes.length;S++){I=r.restTimes[S];var re=this.calcPosWidth(D.startTime<=I.from?I.from:D.startTime,I.to<=D.endTime?I.to:D.endTime,
this.widthPerH);(u=this.calcMakerPos(re,s,this.marginLeft,t))&&(O=this.createMarkerId(),(k=dojo.create("div",{style:this.getStyleSize(u.x,u.y,u.w,d.marker_rest),className:"marker_div marker_rest",id:O},m)).style.left=u.x+"px",k.style.top=u.y+"px",k.style.width=u.w+"px",k.style.height=d.marker_rest.h+"px",p.push(O),k=null)}var w,M,O,le,R,N,pe=[];for(E=0;E<K.length;E++)I=K[E],pe.push(I);for(J&&(pe=r.restTimes),
E=0;E<pe.length;E++)I=pe[E],!(w=this.typeStyleMap[I.type])||I.type==this.TIME_TABLE_REST_FIX&&"number"!=typeof C&&"number"!=typeof W||(M=2==I.moveflg?I:{from:I.from,to:I.to,type:I.type,moveflg:I.moveflg},!Y||2==M.moveflg||this.pouch.isKeepExteriorTime()&&!teasp.logic.EmpTime.isFixRest(I,r&&r.restTimes)||(le=Math.min(l.from,F.from),R=Math.max(l.to,F.to),M.from=(le<=I.from?I:F).from,M.to=(I.to<=R?I:F).to),B&&(
B.from?M.to=B.from<M.to?B.from:M.to:M.from=M.from<B.to?B.to:M.from),M.from>=M.to||(this.dialogMode&&I.type==this.TIME_TABLE_REST_FIX&&(M.from=I.from,M.to=I.to),h=this.calcPosWidth(M.from,M.to,this.widthPerH),(u=this.calcMakerPos(h,s,this.marginLeft,t))&&(O=this.createMarkerId(),(k=dojo.create("div",{className:"marker_div "+w,id:O},m)).style.left=u.x+"px",k.style.top=u.y+"px",k.style.width=u.w+"px",
k.style.height=d[w].h+"px",k.style.zIndex=d[w].zIndex,p.push(O),I.type==teasp.constant.REST_FREE||I.type==teasp.constant.REST_FIX?this.restMarkers.push(O):I.type==teasp.constant.AWAY&&this.awayMarkers.push(O),I.temporary&&(this.tempMarker[O]=I.temporary),this.movable&&!this.readOnly&&2!=I.moveflg&&(this.restFix&&I.type!=teasp.constant.AWAY||(dojo.style(k,"cursor","pointer"),this.eventHandles.push(dojo.connect(k,
"onmousedown",this,this.onMouseDown(k)))),this.eventHandles.push(dojo.connect(k,"onmouseup",this,function(e){this.mouseUp(k,e||window.event)})),this.eventHandles.push(dojo.connect(k,"onmousemove",this,function(e){return this.mouseMove(k,e||window.event),!1})),this.pMenu.bindDomNode(k.id),this.restFix&&I.type!=teasp.constant.AWAY||(le=9<=u.w?Math.round(u.w/3):2,(R=dojo.create("div",{className:"marker_div "+w,id:O+"-L"
},k)).style.cursor="w-resize",R.style.left="0px",R.style.top="0px",R.style.width=le+"px",R.style.height=d[w].h+"px",R.style.zIndex=d[w].zIndex,this.eventHandles.push(dojo.connect(R,"onmousedown",this,this.onMouseDown(R))),(N=dojo.create("div",{className:"marker_div "+w,id:O+"-R"},k)).style.cursor="w-resize",N.style.left=u.w-le+"px",N.style.top="0px",N.style.width=le+"px",N.style.height=d[w].h+"px",
N.style.zIndex=d[w].zIndex,this.eventHandles.push(dojo.connect(N,"onmousedown",this,this.onMouseDown(N))))),k=null)));if(this.clickedEvent&&navigator.userAgent.indexOf("Mobile")<0)for(E=0;E<p.length;E++)I=dojo.byId(p[E]),this.eventHandles.push(dojo.connect(dojo.byId(p[E]),"onclick",this.that,this.clickedEvent(e.date)));if(this.movable&&(this.pMenu.getChildren()[0].setDisabled(
this.readOnly||this.restFix||this.restMarkers.length>=this.REST_COUNT_MAX),this.pMenu.getChildren()[1].setDisabled(this.readOnly||this.awayMarkers.length>=this.OUT_COUNT_MAX),this.pMenu.getChildren()[3].setDisabled(!0)),(!this.movable||this.readOnly)&&!this.hideTimeGraphPopup){y=this.pouch.getWorkSystem()==teasp.constant.WORK_SYSTEM_FLEX&&this.pouch.isFlexGraph();try{var de,ce=this.getPatternTip(n,y,H);ce&&(
de=this.TOOLTIP_ID_PREFIX+ ++teasp.sequence.toolTip,new dijit.Tooltip({connectId:p,label:ce,position:["above"],id:de}),this.toolTips.push(de))}catch(e){console.log(e.message)}}}}},teasp.helper.Graph.prototype.getPatternTip=function(e,t,a){var o=e.getDaySummary(),s='<table border="0" class="tip_table">';if(o.discretionary||this.pouch.getWorkSystem()==teasp.constant.WORK_SYSTEM_MANAGER){e="";if((o.st||o.et)&&(
e+='<tr><td colspan="2">'+teasp.message.getLabel("startEndTime_label")+'</td><td class="tip_right">'+(o.st||"")+"-"+(o.et||"")+"</td></tr>"),o.restSpan&&(e+='<tr><td colspan="2">'+teasp.message.getLabel("restTime_label")+'</td><td class="tip_right">'+o.restSpan+"</td></tr>"),o.workRealTime&&(e+='<tr><td colspan="2">'+teasp.message.getLabel("workRealTime_label")+'</td><td class="tip_right">'+teasp.util.time.timeValue(
o.workNetTime)+"</td></tr>"),(o.legalext||o.nightTime)&&(e+='<tr style="height:2px;"><td colspan="3"><hr style="border-style: solid none none none;border-width:1px;border-color:#888888;" /></td></tr>'),o.legalext&&(e+='<tr><td><div class="tip_lext" ></div></td><td>'+teasp.message.getLabel("legalExtWorkTime_label")+'</td><td class="tip_right">'+teasp.util.time.timeValue(o.legalext)+"</td></tr>"),o.nightTime&&(
e+='<tr><td><div class="tip_night"></div></td><td>'+teasp.message.getLabel("nightWorkEx_label")+'</td><td class="tip_right">'+teasp.util.time.timeValue(o.nightTime)+"</td></tr>"),!e)return null;s+=e}else{if(s=(s+='<tr><td colspan="3">'+o.title+"</td></tr>")+('<tr><td><div class="tip_sfix"></div></td><td>'+o.fixTimeTitle+'</td><td class="tip_right">'+o.fixTimeSpan+"</td></tr>"),this.pouch.getWorkSystem(
)==teasp.constant.WORK_SYSTEM_FLEX&&o.core&&(s+='<tr><td><div class="tip_sfix"></div></td><td>'+teasp.message.getLabel("coreTime_label")+'</td><td class="tip_right">'+o.core+"</td></tr>"),o.fixRestSpan&&(s+='<tr><td><div class="tip_rfix"></div></td><td>'+teasp.message.getLabel("fixRestTime_label")+'</td><td class="tip_right">'+o.fixRestSpan+"</td></tr>"),(o.st||o.et||o.holys&&o.holys.length||o.restSpan)&&(
s+='<tr style="height:2px;"><td colspan="3"><hr style="border-style: solid none none none;border-width:1px;border-color:#888888;" /></td></tr>'),o.holys&&o.holys.length)for(var i=0;i<o.holys.length;i++)s+='<tr><td colspan="3" style="color:red;">'+o.holys[i].name+"</td></tr>";if((o.st||o.et)&&(s+='<tr><td colspan="2">'+teasp.message.getLabel("startEndTime_label")+'</td><td class="tip_right">'+(o.st||"")+"-"+(o.et||""
)+"</td></tr>"),o.restSpan&&(s+='<tr><td colspan="2">'+teasp.message.getLabel("restTime_label")+'</td><td class="tip_right">'+o.restSpan+"</td></tr>"),o.workWholeTime&&(s+='<tr><td colspan="2">'+teasp.message.getLabel("wholeTime_label")+'</td><td class="tip_right">'+teasp.util.time.timeValue(o.workWholeTime)+"</td></tr>"),o.workRealTime&&(s+='<tr><td colspan="2">'+teasp.message.getLabel("workRealTime_label"
)+'</td><td class="tip_right">'+teasp.util.time.timeValue(o.workRealTime)+"</td></tr>"),o.restTime&&(s+='<tr><td><div class="tip_rest" ></div></td><td>'+teasp.message.getLabel("tm10001220")+'</td><td class="tip_right">'+teasp.util.time.timeValue(o.restTime)+"</td></tr>"),o.workFixTime&&(s+='<tr><td><div class="tip_fixt" ></div></td><td>'+teasp.message.getLabel("workFixTime_label"
)+'</td><td class="tip_right">'+teasp.util.time.timeValue(o.workFixTime)+"</td></tr>"),o.legalzan&&(s+='<tr><td><div class="tip_lzan" ></div></td><td>'+(t?teasp.message.getLabel("tm10001230"):teasp.message.getLabel("legalOverTime_label"))+'</td><td class="tip_right">'+teasp.util.time.timeValue(o.legalzan)+"</td></tr>"),o.legalout&&(s+='<tr><td><div class="tip_lout" ></div></td><td>'+(t?teasp.message.getLabel(
"tm10001240"):teasp.message.getLabel("legalOutOverTime_label"))+'</td><td class="tip_right">'+teasp.util.time.timeValue(o.legalout)+"</td></tr>"),o.hwrkTime&&(s+='<tr><td><div class="tip_holy" ></div></td><td>'+teasp.message.getLabel("legalHolidayWorkTime_label")+'</td><td class="tip_right">'+teasp.util.time.timeValue(o.hwrkTime)+"</td></tr>"),(o.legalext||o.nightTime)&&(
s+='<tr style="height:2px;"><td colspan="3"><hr style="border-style: solid none none none;border-width:1px;border-color:#888888;" /></td></tr>'),o.legalext&&(s+='<tr><td><div class="tip_lext" ></div></td><td>'+teasp.message.getLabel("legalExtWorkTime_label")+'</td><td class="tip_right">'+teasp.util.time.timeValue(o.legalext)+"</td></tr>"),o.nightTime&&(
s+='<tr><td><div class="tip_night"></div></td><td>'+teasp.message.getLabel("nightWorkEx_label")+'</td><td class="tip_right">'+teasp.util.time.timeValue(o.nightTime)+"</td></tr>"),o.awaySpan&&(s=(s+='<tr style="height:2px;"><td colspan="3"><hr style="border-style: solid none none none;border-width:1px;border-color:#888888;" /></td></tr>')+'<tr><td colspan="2">'+teasp.message.getLabel("awayInput_label"
)+'</td><td class="tip_right">'+o.awaySpan+"</td></tr>",o.awayTime&&(s+='<tr><td><div class="tip_away" ></div></td><td>'+teasp.message.getLabel("tm10001250")+'</td><td class="tip_right">'+teasp.util.time.timeValue(o.awayTime)+"</td></tr>")),a)for(var s=(s+='<tr style="height:2px;"><td colspan="3"><hr style="border-style: solid none none none;border-width:1px;border-color:#888888;" /></td></tr>')+(
'<tr><td colspan="3">'+teasp.message.getLabel("tm10001660",this.pouch.getYearMonthJp())+"</td></tr>"),n=this.pouch.getMonthSummary(),i=0;i<n.tipList.length;i++)n.tipList[i]?s+='<tr><td colspan="2">'+n.tipList[i].col+'</td><td class="tip_right">'+n.tipList[i].val+"</td></tr>":s+='<tr style="height:2px;"><td colspan="3"><div style="height:2px;"></div></td></tr>'}return s+="</table>"},
teasp.helper.Graph.prototype.calcPosWidth=function(e,t,a){return{begX:e*a/60,endX:t*a/60}},teasp.helper.Graph.prototype.calcBackPos=function(e,t,a,o,s){var i;return o<s?(i=t-(s-o)/2)<0?0:i:a<s?(i=e-(s-a)/2)<0?0:i:e+a-s+10},teasp.helper.Graph.prototype.calcAbsolutePos=function(e,t,a,o,s,i){e=this.calcBackPos(e,t,a,o,s);return{x:e=10*Math.floor(e/10)+i,leftX:e-i,rightX:e-i+teasp.constant.GRAPH_AREA_WIDTH}},
teasp.helper.Graph.prototype.calcMakerPos=function(e,t,a,o){if(t&&(e.endX>t.rightX&&(e.endX=t.rightX),e.begX<t.leftX&&(e.begX=t.leftX),e.endX<=t.leftX||t.rightX<=e.begX||e.endX-e.begX<=0))return null;a=e.begX+a-(t?t.x:0),t=e.endX-e.begX;return t<0?null:{x:a,y:o,w:t,style:"width:"+t+"px;left:"+a+"px;top:"+o+"px;"}},teasp.helper.Graph.prototype.getStyleSize=function(e,t,a,o){
return"left:"+e+"px;top:"+t+"px;width:"+a+"px;"+(o.h?"height:"+o.h+"px;":"")+(o.zIndex?"z-index:"+o.zIndex+";":"")},teasp.helper.Graph.prototype.getStyleSize2=function(e,t,a,o){e={left:e+"px",top:t+"px",width:a+"px"};return o.h&&(e.height=o.h+"px"),o.zIndex&&(e.zIndex=o.zIndex),e},teasp.helper.Graph.prototype.insertDiv=function(e,t){var a=dojo.byId(this.baseDivId),o=this.markerSizeSet[this.sizeType],
s=this.createMarkerId(),e=this.calcMakerPos({begX:e,endX:e+this.widthPerH},null,this.marginLeft,this.startY),i=dojo.create("div",{className:"marker_div "+t,id:s},a),a=(i.style.cursor="pointer",i.style.left=e.x+"px",i.style.top=e.y+"px",i.style.width=e.w+"px",i.style.height=o[t].h+"px",i.style.zIndex=o[t].zIndex,("marker_rest"==t?this.restMarkers:this.awayMarkers).push(s),this.eventHandles.push(dojo.connect(i,
"onmousedown",this,this.onMouseDown(i))),this.eventHandles.push(dojo.connect(i,"onmouseup",this,function(e){this.mouseUp(i,e||window.event)})),this.eventHandles.push(dojo.connect(i,"onmousemove",this,function(e){return this.mouseMove(i,e||window.event),!1})),this.pMenu.bindDomNode(i.id),9<=e.w?Math.round(e.w/3):2),n=dojo.create("div",{className:"marker_div "+t,id:s+"-L"},i),n=(n.style.cursor="w-resize",
n.style.left="0px",n.style.top="0px",n.style.width=a+"px",n.style.height=o[t].h+"px",n.style.zIndex=o[t].zIndex,this.eventHandles.push(dojo.connect(n,"onmousedown",this,this.onMouseDown(n))),dojo.create("div",{className:"marker_div "+t,id:s+"-R"},i));n.style.cursor="w-resize",n.style.left=e.w-a+"px",n.style.top="0px",n.style.width=a+"px",n.style.height=o[t].h+"px",n.style.zIndex=o[t].zIndex,this.eventHandles.push(
dojo.connect(n,"onmousedown",this,this.onMouseDown(n))),"marker_rest"==t?this.pMenu.getChildren()[0].setDisabled(this.readOnly||this.restMarkers.length>=this.REST_COUNT_MAX):this.pMenu.getChildren()[1].setDisabled(this.readOnly||this.awayMarkers.length>=this.OUT_COUNT_MAX),this.focus(i.id),this.movedRefresh()},teasp.helper.Graph.prototype.deleteFocusDiv=function(){var e=this.getFocusId();if(e){for(
var t=0;t<this.restMarkers.length;t++)if(this.restMarkers[t]==e){this.restMarkers.splice(t,1);break}for(t=0;t<this.awayMarkers.length;t++)if(this.awayMarkers[t]==e){this.awayMarkers.splice(t,1);break}this.tempMarker[e]&&delete this.tempMarker[e],dojo.destroy(dojo.byId(e)),this.pMenu.getChildren()[3].setDisabled(!0)}},teasp.helper.Graph.prototype.movedRefresh=function(){for(var e=dojo.byId(this.baseDivId),
t=this.markerSizeSet[this.sizeType],a=(this.recalc(),this.pouch.getCalcMode()),o=(this.dialogMode&&a==teasp.constant.C_DISC&&(a=teasp.constant.C_REAL),[]),s=0;s<this.targetDayObj[a].workLegalOverSpan.length;s++)o.push({span:this.targetDayObj[a].workLegalOverSpan[s],key:this.TIME_TABLE_LZAN});for(s=0;s<this.targetDayObj[a].workLegalOutOverSpan.length;s++)o.push({span:this.targetDayObj[a].workLegalOutOverSpan[s],
key:this.TIME_TABLE_LOUT});for(s=0;s<this.targetDayObj[a].workChargeSpan.length;s++)o.push({span:this.targetDayObj[a].workChargeSpan[s],key:this.TIME_TABLE_CHARGE});for(s=0;s<o.length;s++){var i,n,r=o[s].span,l=this.typeStyleMap[o[s].key],p=this.impactMakers[l];r?(r=this.calcPosWidth(r.from,r.to,this.widthPerH),(r=this.calcMakerPos(r,null,this.marginLeft,this.startY))&&(p?dojo.style(p,this.getStyleSize2(r.x,r.y,r.w,
t[l])):(i=this.createMarkerId(),(n=dojo.create("div",{style:this.getStyleSize(r.x,r.y,r.w,t[l]),className:"marker_div "+l,id:i},e)).style.left=r.x+"px",n.style.top=r.y+"px",n.style.width=r.w+"px",n.style.height=t[l].h+"px",p=this.impactMakers[l]=i)),dojo.style(p,"display",r?"":"none")):p&&dojo.style(p,"display","none")}},teasp.helper.Graph.prototype.recalc=function(){for(var e=[],t=[],
a=0;a<this.restMarkers.length;a++)this.tempMarker[this.restMarkers[a]]||(i=(s=(o=dojo.byId(this.restMarkers[a])).offsetLeft)+o.offsetWidth-(dojo.hasClass(o,"marker_focus")?2:0),n={from:this.pixel2time(s-this.marginLeft),to:this.pixel2time(i-this.marginLeft)},e.push(n));for(var o,s,i,n,a=0;a<this.awayMarkers.length;a++)this.tempMarker[this.awayMarkers[a]]||(i=(s=(o=dojo.byId(this.awayMarkers[a])).offsetLeft
)+o.offsetWidth-(dojo.hasClass(o,"marker_focus")?2:0),n={from:this.pixel2time(s-this.marginLeft),to:this.pixel2time(i-this.marginLeft),type:this.TIME_TABLE_AWAY},t.push(n));this.targetDayObj.rack.fixRests=e,teasp.manager.recalcOneDay(this.pouch,this.targetDayObj)},teasp.helper.Graph.prototype.getRests=function(){for(var e=[],t=0;t<this.restMarkers.length;t++){var a,o=this.tempMarker[this.restMarkers[t]];o?e.push(o):(
o=(a=(o=dojo.byId(this.restMarkers[t])).offsetLeft)+o.offsetWidth-(dojo.hasClass(o,"marker_focus")?2:0),e.push({from:this.pixel2time(a-this.marginLeft),to:this.pixel2time(o-this.marginLeft)}))}return e},teasp.helper.Graph.prototype.getAways=function(){for(var e=[],t=0;t<this.awayMarkers.length;t++){var a,o=this.tempMarker[this.awayMarkers[t]];o?e.push(o):(o=(a=(o=dojo.byId(this.awayMarkers[t])).offsetLeft
)+o.offsetWidth-(dojo.hasClass(o,"marker_focus")?2:0),e.push({from:this.pixel2time(a-this.marginLeft),to:this.pixel2time(o-this.marginLeft),type:this.TIME_TABLE_AWAY}))}return e},teasp.helper.Graph.prototype.loadMenu=function(){this.unloadMenu(),this.pMenu=new dijit.Menu({targetNodeIds:["editTable"],style:"font-size:12px;z-index:1000;",refocus:!1});var t=this;this.pMenu.addChild(new dijit.MenuItem({
label:teasp.message.getLabel("tm10001210"),onClick:function(e){e=e||window.event,e=(e.pageX||e.x)-t.getAreaLeft()+dojo.byId("editTimeView").scrollLeft;t.insertDiv(t.roundTime(e),"marker_rest")}})),this.pMenu.addChild(new dijit.MenuItem({label:teasp.message.getLabel("tm10001260"),onClick:function(e){e=e||window.event,e=(e.pageX||e.x)-t.getAreaLeft()+dojo.byId("editTimeView").scrollLeft;t.insertDiv(t.roundTime(e),
"marker_away")}})),this.pMenu.addChild(new dijit.MenuSeparator),this.pMenu.addChild(new dijit.MenuItem({label:teasp.message.getLabel("delete_btn_title"),onClick:function(e){t.deleteFocusDiv(),t.movedRefresh()}})),this.pMenu.startup()},teasp.helper.Graph.prototype.unloadMenu=function(){this.pMenu&&(this.pMenu.destroyDescendants(),this.pMenu.destroyRecursive(),this.pMenu.domNode=null,delete this.pMenu,this.pMenu=null)}
,teasp.helper.Graph.prototype.onMouseDown=function(e){var i=e.id;return function(e){var t,a,o,s,e=e||window.event;2!=e.button&&(e.preventDefault(),e.stopPropagation(),t=0,(a=/^(.+)-([LR])$/.exec(o=i))&&(o=a[1],t="L"==a[2]?-1:1),o=(a=dojo.byId(o)).offsetLeft,s=a.offsetWidth-(dojo.hasClass(a,"marker_focus")?2:0),this.dragObj={id:a.id,left:a.offsetLeft,x:e.pageX||e.x,w:a.offsetWidth,face:t,x1:o,x2:o+s,
from:this.pixel2time(o-this.marginLeft),to:this.pixel2time(o+s-this.marginLeft),minW:this.minW},this.focus(a.id),this.mouseMove(a,e))}},teasp.helper.Graph.prototype.mouseMove=function(e,t){if(this.dragObj){var a=dojo.byId(this.dragObj.id),o=t.pageX||t.x,s=a.offsetLeft,i=this.dragObj.w,n=dojo.clone(this.dragObj),r=48*this.widthPerH;if(o!=this.dragObj.x){var l=n.x1,p=n.x2,d=this.dragObj.face<=0?this.dragObj.left+(
o-this.dragObj.x):s;if(n.x1!=d&&(n.x1=this.roundTime(d)),n.x1<this.marginLeft&&(n.x1=this.marginLeft),0!==this.dragObj.face){if(this.dragObj.face<0){if((i=n.x2-n.x1)<n.minW)return;a.style.left=n.x1+"px"}else{if(i=this.roundTime(Number(this.dragObj.w)+(o-this.dragObj.x)),(i-=n.x1-this.roundTime(d))<n.minW)return;n.x2=n.x1+i}n.x2>r+this.marginLeft&&(n.x2=r+this.marginLeft,i=n.x2-n.x1),a.style.width=i+"px";
d=9<=i?Math.round(i/3):2;dojo.byId(a.id+"-L").style.width=d+"px",dojo.byId(a.id+"-R").style.width=d+"px",dojo.byId(a.id+"-R").style.left=i-d+"px",n.x1!=l&&(n.from=this.pixel2time(n.x1-this.marginLeft)),n.x2!=p&&(n.to=this.pixel2time(n.x2-this.marginLeft))}else{n.x2=n.x1+i,n.x2>r+this.marginLeft&&(n.x1=r+this.marginLeft-i),a.style.left=n.x1+"px";d=n.to-n.from;n.from=this.pixel2time(n.x1-this.marginLeft),n.to=n.from+d}
dojo.hasClass(a,"marker_rest")&&this.movedRefresh(),this.tempMarker[a.id]&&delete this.tempMarker[a.id]}this.movable&&!this.readOnly&&((s=0<this.dragObj.face?n.x2-this.widthPerH:n.x1)<(l=o-t.clientX+1)&&(s=l),dojo.byId("movetime").style.top="82px",dojo.byId("movetime").style.left=s+"px",dojo.hasClass(a,"marker_away")?(dojo.byId("movec1").innerHTML=teasp.message.getLabel("awayInput_label"),dojo.byId("movetime"
).style.backgroundColor="#83BDED"):dojo.hasClass(a,"marker_rest")&&(dojo.byId("movec1").innerHTML=teasp.message.getLabel("rest_head"),dojo.byId("movetime").style.backgroundColor="#1A69AB"),dojo.byId("movev1").innerHTML=teasp.util.time.timeValue(n.from),dojo.byId("movev2").innerHTML=teasp.util.time.timeValue(n.to),dojo.byId("movetime").style.display="block",this.eventHandles.push(dojo.connect(dojo.byId("movetime"),
"onmouseup",this,function(e){this.dragOff()})))}},teasp.helper.Graph.prototype.mouseUp=function(e,t){this.dragOff()},teasp.helper.Graph.prototype.extraMouseDown=function(e,t){this.dragOff(),this.focus(null)},teasp.helper.Graph.prototype.extraMouseMove=function(e,t){this.dragObj&&this.mouseMove(dojo.byId(this.dragObj.id),t)},teasp.helper.Graph.prototype.extraMouseUp=function(e,t){this.dragOff()},
teasp.helper.Graph.prototype.dragOff=function(){this.dragObj=null,dojo.byId("movetime").style.display="none"},teasp.helper.Graph.prototype.focus=function(t){var e,a,o;dojo.query(".marker_focus").forEach(function(e){t&&e.id==t||dojo.removeClass(e,"marker_focus")}),t?(e=dojo.byId(t),a=0,o=!1,dojo.hasClass(e,"marker_rest")?(a=this.getMaxZindex("marker_rest"),o=!!this.restFix):dojo.hasClass(e,"marker_away")&&(
a=this.getMaxZindex("marker_away")),a&&(e.style.zIndex=a+1),dojo.addClass(e,"marker_focus"),this.pMenu.getChildren()[3].setDisabled(o)):this.pMenu.getChildren()[3].setDisabled(!0)},teasp.helper.Graph.prototype.getFocusId=function(){var t=null;return dojo.query(".marker_focus").forEach(function(e){t=e.id}),t},teasp.helper.Graph.prototype.getMaxZindex=function(e){var t=0;return dojo.query("."+e).forEach(function(e){
e=parseInt(e.style.zIndex,10);t<e&&(t=e)}),t},teasp.helper.Graph.prototype.getAreaLeft=function(){return dojo.byId("editTimeDialog").offsetLeft+dojo.byId("editTimeArea").offsetLeft+this.marginLeft},teasp.helper.Graph.prototype.roundTime=function(e){return Math.floor(e/this.minW)*this.minW},teasp.helper.Graph.prototype.pixel2time=function(e){return Math.round(60*e/this.widthPerH)},
teasp.helper.Graph.prototype.getDayObj=function(){return this.targetDayObj},teasp.helper.Graph.excludeRanges=function(e,t){for(var a=[],o=0;o<e.length;o++){var s=e[o],i=teasp.util.time.excludeRanges([s],t);if(0<i.length){for(var n in s)if(s.hasOwnProperty(n)&&"from"!=n&&"to"!=n)for(var r=0;r<i.length;r++)i[r][n]=s[n];a=a.concat(i)}}return a},teasp.provide("teasp.helper.ScheduleTxsLog"),
teasp.helper.ScheduleTxsLog=function(e){this.pouch=null,this.MARKER_ID_PREFIX="logmarker",this.leftX=e&&e.leftX||182,this.marginTop=e&&e.marginLeft||0,this.heightPerH=e&&e.heightPerH||teasp.helper.Schedule.HEIGHT_PER_HOUR,this.dragObj=null,this.markerZindex=150,this.txsLogs=[],this.markMap={},this.eventHandles=[],this.colorMap={AtkJob__c:["#98fb98","#90ee90","#00ff7f","#7cfc00","#adff2f","#00ff00","#32cd32","#9acd32"
],Task:["#87ceeb","#add8e6","#b0e0e6","#afeeee","#48d1cc","#00ffff","#40e0d0","#00ced1"],Event:["#c0a2c7","#dbd0e6","#867ba9","#a59aca","#68699b","#9079ad","#706caa","#cca6bf"],Opportunity:["#f6b894","#f4b3c2","#f7b977","#f19072","#eebbcb","#eb9b6f","#f9c89b","#e4ab9b"],Account:["#ffd900","#ffec47","#fcd575","#fbd26b","#f5e56b","#eec362","#ebd842","#ffdb4f"],other:["#d3d3d3"]}},
teasp.helper.ScheduleTxsLog.prototype.draw=function(e,t){this.pouch=e,this.baseDivId=t,this.minH=3;for(var a=0;a<this.eventHandles.length;a++)dojo.disconnect(this.eventHandles[a]),delete this.eventHandles[a];this.eventHandles=[];var e=this.pouch.getParamDate(),o=(this.txsLogs=this.getTxsLogs(this.pouch.getEmpDay(e).getEndTime(!0)),dojo.byId("editTable"));o&&(this.eventHandles.push(dojo.connect(o,"onmousedown",this,
function(e){return this.extraMouseDown(o,e||window.event),!1})),this.eventHandles.push(dojo.connect(o,"onmouseup",this,function(e){this.extraMouseUp(o,e||window.event)})),this.eventHandles.push(dojo.connect(o,"onmousemove",this,function(e){return this.extraMouseMove(o,e||window.event),!1}))),this.createDivs()},teasp.helper.ScheduleTxsLog.prototype.createMarkerId=function(){
return this.MARKER_ID_PREFIX+ ++teasp.sequence.marker},teasp.helper.ScheduleTxsLog.prototype.createDivs=function(){for(var e=dojo.byId(this.baseDivId),t=(dojo.query(".txslog_marker").forEach(function(e){dojo.destroy(e)}),{}),a=0;a<this.txsLogs.length;a++){var o=this.txsLogs[a],s=o.st,i=o.et,n=teasp.util.time.timeValue(s)+"-"+teasp.util.time.timeValue(i),r=this.createMarkerId(),s=this.calcMakerPos(this.calcPosWidth(s,
i),this.marginTop,this.leftX),i=o.target.name||"???",l=null,l=("Task"==o.target.type?i+="\n "+teasp.message.getLabel("tm20001330"):"Event"==o.target.type?i+="\n "+teasp.message.getLabel("tm20001340"):"Account"==o.target.type?i+="\n "+teasp.message.getLabel("tm20001350"):"Opportunity"==o.target.type?i+="\n "+teasp.message.getLabel("tm20001360"):"AtkJob__c"==o.target.type?i+="\n "+teasp.message.getLabel("tm20001370"
):l="other",l||o.target.type),p=this.colorMap[l],d=t[l],c=(void 0===d&&(d=t[l]=0),t[l]++,o.target.what&&"AtkJob__c"==o.target.what.type&&(i+="\n "+teasp.message.getLabel("tm20001380",o.target.what.name||"???")),s.y=Math.round(s.y),s.h=Math.round(s.h),dojo.create("div",{className:"txslog_marker",style:{width:"136px",left:s.x+"px",top:s.y+"px",height:s.h+"px",backgroundColor:p[d],zIndex:this.markerZindex},id:r,title:i}
,e)),l=(("AtkJob__c"==o.target.type||o.target.what&&"AtkJob__c"==o.target.what.type)&&dojo.create("div",{className:"pp_base pp_txlog_job2",style:{position:"absolute",left:"116px",top:"2px"}},c),dojo.create("div",{id:r+"-T",style:{margin:"1px 2px 0px 2px",padding:"0px",color:"black"},innerHTML:n},c),dojo.create("div",{style:{margin:"0px 2px 1px 2px",padding:"0px",color:"black"},innerHTML:o.target.name||"???"},c),
this.markMap[r]={log:o,moved:!1,orgTop:s.y,orgHeight:s.h},this.eventHandles.push(dojo.connect(c,"onmousedown",this,this.onMouseDown(c))),this.eventHandles.push(dojo.connect(c,"onmouseup",this,function(e){this.mouseUp(c,e||window.event)})),this.eventHandles.push(dojo.connect(c,"onmousemove",this,function(e){return this.mouseMove(c,e||window.event),!1})),this.eventHandles.push(dojo.connect(c,"ondblclick",this,
this.clickDblMarker(o))),5<=s.h?Math.round(s.h/3):1),p=this.getStyleSize(0,0,l,{w:136,zIndex:100}),d=(p.cursor="n-resize",p.position="absolute",p.backgroundColor="transparent",dojo.create("div",{style:p,id:r+"-U",title:i},c)),n=(this.eventHandles.push(dojo.connect(d,"onmousedown",this,this.onMouseDown(d))),(p=this.getStyleSize(0,s.h-l,l,{w:136,zIndex:100})).cursor="s-resize",p.position="absolute",
p.backgroundColor="transparent",dojo.create("div",{style:p,id:r+"-D",title:i},c));this.eventHandles.push(dojo.connect(n,"onmousedown",this,this.onMouseDown(n))),this.markerZindex++}},teasp.helper.ScheduleTxsLog.prototype.backPos=function(){dojo.query(".txslog_marker").forEach(function(e){var t=this.markMap[e.id];t&&t.moved&&(e=(e=dojo.byId(e.id+"-T")).textContent||e.innerText,(
e=/^(\d+):(\d+)\s*\-\s*(\d+):(\d+)$/.exec(e))&&0<e.length&&(t.log.st=60*parseInt(e[1],10)+parseInt(e[2],10),t.log.et=60*parseInt(e[3],10)+parseInt(e[4],10),t.log.moved=!0))},this)},teasp.helper.ScheduleTxsLog.prototype.calcPosWidth=function(e,t,a){e=e*(a||this.heightPerH)/60,t=t*(a||this.heightPerH)/60;return{begY:e,endY:t,h:t-e}},teasp.helper.ScheduleTxsLog.prototype.calcMakerPos=function(e,t,a){t=e.begY+t,
e=e.endY-e.begY;return{x:a,y:t,h:e,style:{height:e+"px",top:t+"px",left:a+"px"}}},teasp.helper.ScheduleTxsLog.prototype.getStyleSize=function(e,t,a,o){e={left:e+"px",top:t+"px",height:a+"px"};return o.w&&(e.width=o.w+"px"),o.zIndex&&(e.zIndex=o.zIndex),e},teasp.helper.ScheduleTxsLog.prototype.clickDblMarker=function(e){var t=e;return function(){console.log(dojo.toJson(t)),window.open("/"+t.target.id)}},
teasp.helper.ScheduleTxsLog.prototype.onMouseDown=function(e){var i=e.id;return function(e){var t,a,o,s,e=e||window.event;2!=e.button&&(e.preventDefault(),e.stopPropagation(),t=0,(a=/^(.+)-([UD])$/.exec(o=i))&&(o=a[1],t="U"==a[2]?-1:1),o=(a=dojo.byId(o)).offsetTop,s=a.offsetHeight-(dojo.hasClass(a,"txslog_focus")?2:0),this.dragObj={id:a.id,top:a.offsetTop,y:e.pageY||e.y,h:a.offsetHeight,face:t,y1:o,y2:o+s,
from:this.pixel2time(o-this.marginTop),to:this.pixel2time(o+s-this.marginTop),minH:this.minH},this.focus(a.id),this.mouseMove(a,e))}},teasp.helper.ScheduleTxsLog.prototype.mouseMove=function(e,t){if(this.dragObj){var a=dojo.byId(this.dragObj.id),t=t.pageY||t.y,o=a.offsetTop,s=this.dragObj.h,i=dojo.clone(this.dragObj),n=48*this.heightPerH;if(t!=this.dragObj.y){var r=i.y1,l=i.y2,
o=this.dragObj.face<=0?this.dragObj.top+(t-this.dragObj.y):o;if(i.y1!=o&&(i.y1=this.roundTime(o)),i.y1<this.marginTop&&(i.y1=this.marginTop),0!==this.dragObj.face){if(this.dragObj.face<0){if((s=i.y2-i.y1)<i.minH)return;a.style.top=i.y1+"px"}else{if(s=this.roundTime(Number(this.dragObj.h)+(t-this.dragObj.y)),(s-=i.y1-this.roundTime(o))<i.minH)return;i.y2=i.y1+s}i.y2>n+this.marginTop&&(i.y2=n+this.marginTop,s=i.y2-i.y1
),a.style.height=s+"px";t=9<=s?Math.round(s/3):2;dojo.byId(a.id+"-U").style.height=t+"px",dojo.byId(a.id+"-D").style.height=t+"px",dojo.byId(a.id+"-D").style.top=s-t+"px",i.y1!=r&&(i.from=this.pixel2time(i.y1-this.marginTop)),i.y2!=l&&(i.to=this.pixel2time(i.y2-this.marginTop))}else{i.y2=i.y1+s,i.y2>n+this.marginTop&&(i.y1=n+this.marginTop-s),a.style.top=i.y1+"px";o=i.to-i.from;i.from=this.pixel2time(
i.y1-this.marginTop),i.to=i.from+o}dojo.byId(a.id+"-T").innerHTML=teasp.util.time.timeValue(i.from)+"-"+teasp.util.time.timeValue(i.to);t=this.markMap[a.id];t&&(t.moved=!0)}}},teasp.helper.ScheduleTxsLog.prototype.mouseUp=function(e,t){this.dragOff(),this.backPos()},teasp.helper.ScheduleTxsLog.prototype.extraMouseDown=function(e,t){this.dragOff(),this.focus(null)},
teasp.helper.ScheduleTxsLog.prototype.extraMouseMove=function(e,t){this.dragObj&&this.mouseMove(dojo.byId(this.dragObj.id),t)},teasp.helper.ScheduleTxsLog.prototype.extraMouseUp=function(e,t){this.dragOff()},teasp.helper.ScheduleTxsLog.prototype.dragOff=function(){this.dragObj=null},teasp.helper.ScheduleTxsLog.prototype.focus=function(t){var e;dojo.query(".txslog_focus").forEach(function(e){
t&&e.id==t||dojo.removeClass(e,"txslog_focus")}),t&&((e=dojo.byId(t)).style.zIndex=this.markerZindex++,dojo.addClass(e,"txslog_focus"))},teasp.helper.ScheduleTxsLog.prototype.getFocusId=function(){var t=null;return dojo.query(".txslog_focus").forEach(function(e){t=e.id}),t},teasp.helper.ScheduleTxsLog.prototype.roundTime=function(e){return Math.floor(e/this.minH)*this.minH},
teasp.helper.ScheduleTxsLog.prototype.pixel2time=function(e){return Math.round(60*e/this.heightPerH)},teasp.helper.ScheduleTxsLog.prototype.getTxsLogs=function(e){var t=this.pouch.getObj().txsLogs;if(0<t.length){for(var a=1;a<t.length;a++)t[a-1].moved||t[a-1].et||(t[a-1].et=t[a].st);t[a-1].moved||t[a-1].et||("number"==typeof e&&0<a?e<t[a-1].st?t[a-1].et=t[a-1].st+20:t[a-1].et=e:0<a&&(t[a-1].et=t[a-1].st+20))}return t
},teasp.helper.ScheduleTxsLog.prototype.getTxsLogJobs=function(e,t,a){for(var o=this.getTxsLogs(e),s=0;s<o.length;s++){var i,n,r=o[s];!("AtkJob__c"==r.target.type||r.target.what&&"AtkJob__c"==r.target.what.type)||r.st<t.st||t.et<=r.st||(i=teasp.util.time.rangeTime({from:r.st,to:r.et},t.rests),(i=r.et-r.st-i)<0&&(i=0),n={sdt:(n=moment(r.date,teasp.constant.DATE_F)).clone().add(r.st,"m"),edt:n.clone().add(r.et,"m")},
r="AtkJob__c"==r.target.type?r.target:r.target.what,a.add(r.id,null,[n],{minutes:i,inner:!0,orgSdt:n.sdt},!1,!0))}return 0<o.length},teasp.provide("teasp.helper.ScheduleEvent"),teasp.helper.ScheduleEvent=function(e,t,a,o){this.event=e,this.cdt=t,this.markerId=a,this.zIndex=o,this.event.isAllDayEvent||(this.sdt=moment(this.event.startDateTime,teasp.constant.DATETIME_F),this.edt=moment(this.event.endDateTime,
teasp.constant.DATETIME_F),this.st=60*this.sdt.hour()+this.sdt.minute(),this.et=60*this.edt.hour()+this.edt.minute(),this.sdt.isBefore(this.cdt,"day")?this.st=0:this.sdt.isAfter(this.cdt,"day")&&(this.st+=1440),this.edt.isAfter(this.cdt,"day")&&(e=this.cdt.clone().add(2,"d"),this.edt.isSameOrAfter(e)?this.et=2880:this.et+=1440),this.subject="<span>"+teasp.message.getLabel("tm10010460",(this.sdt.isSame(this.cdt,"day"
)?"":"("+this.sdt.format("M/D")+")")+this.sdt.format("H:mm"),(this.edt.isSame(this.cdt,"day")||this.edt.isSame(this.sdt,"day")?"":"("+this.edt.format("M/D")+")")+this.edt.format("H:mm"))+"</span>"+(this.et-this.st<=45?" ":"<br/>")+teasp.util.entitizf(this.event.subject),t=[],this.event.subject&&t.push(this.event.subject),this.event.what&&"AtkJob__c"==this.event.what.type&&t.push(teasp.message.getLabel("tm20001380",
this.event.what.name||"???")),this.title=t.join("\n"),this.y1=teasp.helper.Schedule.HEIGHT_PER_HOUR*(this.st/60),a=teasp.helper.Schedule.HEIGHT_PER_HOUR*(this.et/60),this.h=Math.max(a-this.y1,teasp.helper.Schedule.MARKER_MIN_HEIGHT),this.y2=this.y1+this.h,this.pos=0,this.endPos=-1)},teasp.helper.ScheduleEvent.prototype.getStartLongTime=function(){return this.sdt.toDate().getTime()},
teasp.helper.ScheduleEvent.prototype.getEndLongTime=function(){return this.edt.toDate().getTime()},teasp.helper.ScheduleEvent.prototype.getY1=function(){return this.y1},teasp.helper.ScheduleEvent.prototype.getY2=function(){return this.y2},teasp.helper.ScheduleEvent.prototype.getSubject=function(){return this.event.subject||""},teasp.helper.ScheduleEvent.prototype.getSubjectDom=function(){return this.subject},
teasp.helper.ScheduleEvent.prototype.getTitle=function(){return this.title},teasp.helper.ScheduleEvent.prototype.getMarkerId=function(){return this.markerId},teasp.helper.ScheduleEvent.prototype.getPos=function(){return this.pos},teasp.helper.ScheduleEvent.prototype.setPos=function(e){this.pos=e},teasp.helper.ScheduleEvent.prototype.getEndPos=function(){return this.endPos},
teasp.helper.ScheduleEvent.prototype.setEndPos=function(e){this.endPos=e},teasp.helper.ScheduleEvent.prototype.isAllDayEvent=function(){return this.event.isAllDayEvent},teasp.helper.ScheduleEvent.prototype.getId=function(){return this.event.id},teasp.helper.ScheduleEvent.prototype.isOverlap=function(e){return e.getY1()<=this.getY1()&&this.getY1()<e.getY2()||e.getY1()<this.getY2()&&this.getY2()<=e.getY2()||this.getY1(
)<=e.getY1()&&e.getY2()<=this.getY2()},teasp.helper.ScheduleEvent.prototype.createDom=function(e,t,a,o){a=dojo.create("div",{className:"event_marker",style:dojo.string.substitute("width:${0}px;left:${1}px;top:${2}px;height:${3}px;z-index:${4};",[a,t,this.y1,this.h+1,this.zIndex]),id:this.getMarkerId(),title:this.getTitle()},e),t=dojo.create("div",null,a);return o&&this.getId()&&!teasp.isSforce()?((e=this.cdt
).isBefore(this.sdt,"day")&&(e=this.sdt),dojo.create("a",{href:this.getLink(e),innerHTML:this.getSubjectDom(),target:"_blank"},t)):t.innerHTML=this.getSubjectDom(),a},teasp.helper.ScheduleEvent.prototype.getLink=function(e){e=e||this.cdt;return dojo.string.substitute("/00U/c?md0=${0}&md3=${1}",[e.format("YYYY"),e.dayOfYear()])},teasp.helper.ScheduleEvent.prototype.isRange=function(e){return!!this.isAllDayEvent()||(
e.st<=this.st&&this.st<e.et||e.st<this.et&&this.et<=e.et||this.st<e.st&&e.et<this.et)},teasp.helper.ScheduleEvent.prototype.getRangeInfo=function(e){var t={st:Math.max(this.st,e.st),et:Math.min(this.et,e.et),orgSdt:this.sdt||this.cdt,minutes:0};return this.isRange(e)&&(t.inner=!0,t.st<t.et&&(e=teasp.util.time.rangeTime({from:t.st,to:t.et},e.rests),t.minutes=Math.max(t.et-t.st-e,0))),t.sdt=this.cdt.clone().add(t.st,
"m"),t.edt=this.cdt.clone().add(t.et,"m"),t},teasp.helper.ScheduleEvent.prototype.isRelayJob=function(){return!!(/\[.+?\]/.test(this.event.subject||"")||this.event.what&&"AtkJob__c"==this.event.what.type)},teasp.helper.ScheduleEvent.prototype.collectJobs=function(e,t){var e=this.getRangeInfo(e),a={sdt:e.sdt,edt:e.edt};if(this.event.what&&"AtkJob__c"==this.event.what.type)t.add(this.event.what.id,null,[a],e,
this.isAllDayEvent(),!1);else if(/\[.+?\]/.test(this.event.subject||"")){for(var o,s=[],i=this.event.subject;o=/\[(.+?)\](.*)$/.exec(i);)s.push(o[1]),i=o[2];if(s.length)for(var n={minutes:e.minutes?Math.round(e.minutes/s.length):0,inner:e.inner,orgSdt:e.orgSdt},r=0;r<s.length;r++)t.add(null,s[r],[a],n,this.isAllDayEvent(),!1)}},teasp.provide("teasp.helper.ScheduleLanes"),teasp.helper.ScheduleLane=function(e,t){
this.pos=e,this.evs=[],t&&this.addEv(t)},teasp.helper.ScheduleLane.prototype.getPos=function(){return this.pos},teasp.helper.ScheduleLane.prototype.addEv=function(e){e.setPos(this.pos),this.evs.push(e)},teasp.helper.ScheduleLane.prototype.isOverlaps=function(e){for(var t=0;t<this.evs.length;t++)if(this.evs[t].isOverlap(e))return!0;return!1},teasp.helper.ScheduleLane.prototype.searchEndPos=function(e){for(
var t=0;t<this.evs.length;t++){var a=this.evs[t];a.getEndPos()<0&&e.isOverlaps(a)&&a.setEndPos(e.getPos()-1)}},teasp.provide("teasp.helper.ScheduleGroup"),teasp.helper.ScheduleGroup=function(e){this.evs=[],this.lanes=[],e&&this.addEv(e)},teasp.helper.ScheduleGroup.prototype.getEvs=function(){return this.evs},teasp.helper.ScheduleGroup.prototype.getLaneSize=function(){return this.lanes.length},
teasp.helper.ScheduleGroup.prototype.addEv=function(e){if(this.evs.push(e),this.lanes.length){for(var t=0;t<this.lanes.length;){if(!this.lanes[t].isOverlaps(e)){this.lanes[t].addEv(e);break}t++}t>=this.lanes.length&&this.lanes.push(new teasp.helper.ScheduleLane(t,e))}else this.lanes.push(new teasp.helper.ScheduleLane(0,e))},teasp.helper.ScheduleGroup.prototype.isOverlap=function(e){for(var t=0;t<this.evs.length;t++
)if(this.evs[t].isOverlap(e))return!0;return!1},teasp.helper.ScheduleGroup.prototype.buildEndPos=function(){for(var e=0;e<this.lanes.length;e++)for(var t=this.lanes[e],a=e+1;a<this.lanes.length;)t.searchEndPos(this.lanes[a]),a++;for(e=0;e<this.evs.length;e++){var o=this.evs[e];o.getEndPos()<0&&o.setEndPos(this.getLaneSize()-1)}},teasp.helper.ScheduleGroup.buildEndPosAll=function(e){for(var t=0;t<e.length;t++
)e[t].buildEndPos()},teasp.provide("teasp.helper.ScheduleJob"),teasp.helper.ScheduleJob=function(e,t,a,o,s,i){this.id=e,this.code=t,this.spans=a,this.minutes=o.minutes,this.inner=o.inner,this.orgSdt=o.orgSdt,this.isAllDayEvent=s,this.txflag=i},teasp.helper.ScheduleJob.prototype.getId=function(){return this.id},teasp.helper.ScheduleJob.prototype.getCode=function(){return this.code},
teasp.helper.ScheduleJob.prototype.getSpans=function(){return this.spans},teasp.helper.ScheduleJob.prototype.getMinutes=function(){return this.minutes},teasp.helper.ScheduleJob.prototype.getInner=function(){return this.inner},teasp.helper.ScheduleJob.prototype.getOrgSdt=function(){return this.orgSdt},teasp.helper.ScheduleJob.prototype.isAllDayEvent=function(){return this.isAllDayEvent},
teasp.helper.ScheduleJob.prototype.getObj=function(){return{id:this.id,code:this.code,spans:this.spans,minutes:this.minutes,inner:this.inner,orgSdt:this.orgSdt,isAllDayEvent:this.isAllDayEvent,txflag:this.txflag}},teasp.helper.ScheduleJob.prototype.add=function(e,t,a){this.spans=this.spans.concat(e).sort(function(e,t){var a=e.sdt.toDate().getTime()-t.sdt.toDate().getTime();return a||e.edt.toDate().getTime(
)-t.edt.toDate().getTime()}),this.minutes+=t.minutes,t.inner&&(this.inner=t.inner),t.orgSdt.isBefore(this.orgSdt)&&(this.orgSdt=t.orgSdt),a&&(this.isAllDayEvent=!0)},teasp.helper.ScheduleJob.prototype.supplement=function(e){for(var t=0;t<e.length;t++){var a=e[t];if(this.id){if(this.id==a.jobId){this.code=a.jobCode;break}}else if(this.code==a.jobCode){this.id=a.jobId;break}}return this},teasp.provide(
"teasp.helper.ScheduleJobs"),teasp.helper.ScheduleJobs=function(){this.idMap={},this.codeMap={}},teasp.helper.ScheduleJobs.prototype.get=function(e,t){return e?this.idMap[e]:this.codeMap[t]},teasp.helper.ScheduleJobs.prototype.set=function(e,t,a){e?this.idMap[e]=a:this.codeMap[t]=a},teasp.helper.ScheduleJobs.prototype.add=function(e,t,a,o,s,i){var n=this.get(e,t);n?n.add(a,o,s):this.set(e,t,
new teasp.helper.ScheduleJob(e,t,a,o,s,i))},teasp.helper.ScheduleJobs.prototype.getJobIds=function(){var e,t=[];for(e in this.idMap)t.push(e);return t},teasp.helper.ScheduleJobs.prototype.getJobCodes=function(){var e,t=[];for(e in this.codeMap)t.push(e);return t},teasp.helper.ScheduleJobs.prototype.mapByCode=function(e,t){var a=e[t.getCode()];a?a.add(t.getSpans(),{minutes:t.getMinutes(),inner:t.getInner()},
t.isAllDayEvent()):e[t.getCode()]=t},teasp.helper.ScheduleJobs.prototype.getJobCodeList=function(e){var t,a={};for(t in this.idMap)this.mapByCode(a,this.idMap[t].supplement(e));for(o in this.codeMap)this.mapByCode(a,this.codeMap[o].supplement(e));var o,s=[];for(o in a)s.push(a[o].getObj());return s=s.sort(function(e,t){var a=0;return(a=e.spans[0].sdt.isSame(t.spans[0].sdt)?e.orgSdt.toDate().getTime()-t.orgSdt.toDate(
).getTime():e.spans[0].sdt.toDate().getTime()-t.spans[0].sdt.toDate().getTime())?a:e.spans[0].edt.toDate().getTime()-t.spans[0].edt.toDate().getTime()})},teasp.provide("teasp.helper.ScheduleImport"),teasp.helper.ScheduleImport=function(){},teasp.helper.ScheduleImport.prototype.getImportRange=function(e){var t=e.getObj(),a={from:t.rack.startTimeEx,to:t.rack.endTimeEx,rests:[],border:{from:Math.max((e.getFixStartTime(
)||0)-240,0),to:Math.max((e.getFixStartTime()||0)+1200,1440)},nowork:!1};if(null===a.from&&null===a.to){var o=[];dojo.forEach(t.rack.validApplys.holidayTime||[],function(e){o.push({from:e.startTime,to:e.endTime})}),a.rests=teasp.util.time.margeTimeSpans(o.concat(t.pattern.restTimes))}else for(var s=t.timeTable||[],i=0;i<s.length;i++){var n=s[i];
n.type!=teasp.constant.REST_FIX&&n.type!=teasp.constant.REST_FREE&&n.type!=teasp.constant.REST_PAY&&n.type!=teasp.constant.REST_UNPAY||a.rests.push(n)}t.rack.holidayJoin&&3==t.rack.holidayJoin.flag?a.nowork=!0:t.rack.validApplys.holidayAm?a.border.from<t.pattern.amHolidayEndTime&&(a.border.from=t.pattern.amHolidayEndTime):t.rack.validApplys.holidayPm&&a.border.to>t.pattern.pmHolidayStartTime&&(
a.border.to=t.pattern.pmHolidayStartTime),a.st=(null!==a.from?a:a.border).from,a.et=(null!==a.to?a:a.border).to;for(var r=moment(e.getKey(),teasp.constant.DATE_F),l=(a.sdt=r.clone().add(a.st,"m"),a.edt=r.clone().add(a.et,"m"),console.log(dojo.string.substitute("RANGE)${0}～${1}",[a.sdt.format("YYYY/MM/DD HH:mm"),a.edt.format("YYYY/MM/DD HH:mm")])),a.rests||[]),i=0;i<l.length;i++){var p=l[i];console.log(
dojo.string.substitute("REST-${0})${1}～${2}",[i+1,r.clone().add(p.from,"m").format("YYYY/MM/DD HH:mm"),r.clone().add(p.to,"m").format("YYYY/MM/DD HH:mm")]))}return a},teasp.helper.ScheduleImport.prototype.import=function(e,t,a,o){this.callback=e,this.pouch=t,this.helperSche=a,this.helperTxsLog=o,this.helperJobs=new teasp.helper.ScheduleJobs;var e=this.pouch.getEmpDay(this.pouch.getParamDate()),
s=this.helperSche.getAllEvs(),i=this.getImportRange(e),n=0;if(!this.helperTxsLog.getTxsLogJobs(e.getEndTime(!0),i,this.helperJobs)){if(!s.length)return void teasp.tsAlert(teasp.message.getLabel("tm20001240"),this);for(var r=0;r<s.length;r++){var l=s[r];l.isRelayJob()&&n++,i.nowork||l.collectJobs(i,this.helperJobs)}if(!n)return void teasp.tsAlert(teasp.message.getLabel("tm20001250"),this)}t=this.helperJobs.getJobIds()
,a=this.helperJobs.getJobCodes();a.length||t.length?teasp.manager.request("searchJob",{empId:this.pouch.getEmpId(),jobCodes:a,jobIds:t},this.pouch,{},this,function(e){this.openEmpWorkEx(e)},function(e){teasp.message.alertError(e)}):teasp.tsAlert(teasp.message.getLabel("tm20001241"),this)},teasp.helper.ScheduleImport.prototype.openEmpWorkEx=function(e){for(var t=this.pouch.getParamDate(),a=dojo.clone(
this.pouch.getClassifyJobWorks(t)),o=this.helperJobs.getJobCodeList(e),s=[],i=[],n=[],r=0,l=0,p=0;p<o.length;p++){var d=o[p],c=this.pouch.entryScheduledJob(a,d,e,t);c&&!c.ngFact?(c.isAssigned||"scheduleWorks"!=c.key||(c.onlyScheduled=!0),d.isAllDayEvent?(c.timeFix=!1,c.volume=1e3):(c.timeFix=!0,c.time=d.minutes),(d.isAllDayEvent||d.inner||c.onlyScheduled)&&r++,l++):c&&c.ngFact&&(
c.ngFact==teasp.data.Pouch.NG_JOB_ASSIGN_EMP&&s.push(teasp.message.getLabel("tf10003670",c.jobCode,c.jobName)),c.ngFact==teasp.data.Pouch.NG_JOB_ASSIGN_CLASS&&i.push(teasp.message.getLabel("tf10003670",c.jobCode,c.jobName)),c.ngFact==teasp.data.Pouch.NG_JOB_OUT_OF_TERM&&n.push(teasp.message.getLabel("tf10003670",c.jobCode,c.jobName)))}var m=null;if(s.length||i.length||n.length){var h=[];if(n.length&&h.push(
teasp.message.getLabel("tf10003640",n.join(","))),s.length&&h.push(teasp.message.getLabel("tf10003641",s.join(","))),i.length&&h.push(teasp.message.getLabel("tf10003642",i.join(","))),!r)return h.push(teasp.message.getLabel("tm20001241")),void teasp.tsAlert(h.join("\n"),this);m=h.join("\n")}l?(a.assignTmps&&(a.assignJobs?a.assignJobs=a.assignJobs.concat(a.assignTmps):a.assignJobs=a.assignTmps),m?teasp.tsAlert(m,this,
function(){this.callback(a,!0)}):this.callback(a,!0)):teasp.tsAlert(teasp.message.getLabel("tm20001241"),this)},teasp.provide("teasp.helper.Schedule"),teasp.helper.Schedule=function(){this.pouch=null,this.markerZindex=100,this.eventHandles=[],this.evs=[],this.grps=[],this.importLogic=new teasp.helper.ScheduleImport},teasp.helper.Schedule.MARKER_X=43,teasp.helper.Schedule.RIGHT_MARGIN=12,
teasp.helper.Schedule.HEIGHT_PER_HOUR=35,teasp.helper.Schedule.MARKER_MIN_HEIGHT=17,teasp.helper.Schedule.MARKER_MIN_WIDTH=120,teasp.helper.Schedule.prototype.createMarkerId=function(){return"evmarker"+ ++teasp.sequence.marker},teasp.helper.Schedule.prototype.draw=function(e,t){this.pouch=e,this.baseDivId=t,this.cdt=moment(this.pouch.getParamDate(),teasp.constant.DATE_F);for(var a=0;a<this.eventHandles.length;a++
)dojo.disconnect(this.eventHandles[a]),delete this.eventHandles[a];this.eventHandles=[],this.eventHandles.push(dojo.connect(dojo.byId(this.baseDivId),"onscroll",this,this.scrollArea)),this.evs=[],this.allDayEvs=[],this.grps=[],this.loadEvents(),this.showAllDayEvent(),this.createDivs()},teasp.helper.Schedule.prototype.getEvs=function(){return this.evs},teasp.helper.Schedule.prototype.getAllEvs=function(){
return this.evs.concat(this.allDayEvs)},teasp.helper.Schedule.prototype.loadEvents=function(){for(var e=this.pouch.getEvents(),t=this.cdt.clone().add(1,"d"),a=this.cdt.clone().add(2,"d"),o=0;o<e.length;o++){var s=e[o],i=moment(s.startDateTime,teasp.constant.DATETIME_F);moment(s.endDateTime,teasp.constant.DATETIME_F).isBefore(this.cdt)||i.isSameOrAfter(a)||s.isAllDayEvent&&i.isSameOrAfter(t)||(
s.isAllDayEvent?this.allDayEvs.push(new teasp.helper.ScheduleEvent(s,this.cdt)):this.evs.push(new teasp.helper.ScheduleEvent(s,this.cdt,this.createMarkerId(),this.markerZindex)))}if(this.evs.length){this.evs=this.evs.sort(function(e,t){return e.getStartLongTime()==t.getStartLongTime()?e.getEndLongTime()==t.getEndLongTime()?e.getSubject()<t.getSubject()?-1:1:e.getEndLongTime()-t.getEndLongTime():e.getStartLongTime(
)-t.getStartLongTime()}),this.grps.push(new teasp.helper.ScheduleGroup(this.evs[0]));for(o=1;o<this.evs.length;o++){for(var n=this.evs[o],r=0;r<this.grps.length;){var l=this.grps[r];if(l.isOverlap(n)){l.addEv(n);break}r++}r>=this.grps.length&&this.grps.push(new teasp.helper.ScheduleGroup(n))}teasp.helper.ScheduleGroup.buildEndPosAll(this.grps)}},teasp.helper.Schedule.prototype.getAreaWidth=function(){
return dojo.byId(this.baseDivId).clientWidth-teasp.helper.Schedule.MARKER_X-teasp.helper.Schedule.RIGHT_MARGIN},teasp.helper.Schedule.prototype.createDivs=function(){for(var e=dojo.byId(this.baseDivId),t=(dojo.query(".event_marker",e).forEach(function(e){dojo.destroy(e)}),teasp.helper.Schedule.MARKER_X),a=this.getAreaWidth(),o=0;o<this.evs.length;o++)this.evs[o].createDom(e,t,a,this.pouch.isOwner());
this.arrangePosition(),this.adjustSubject()},teasp.helper.Schedule.prototype.arrangePosition=function(){for(var o=this.getAreaWidth(),e=0;e<this.grps.length;e++){var s=this.grps[e],t=o/s.getLaneSize(),i=t;t<teasp.helper.Schedule.MARKER_MIN_WIDTH&&(i=(o-teasp.helper.Schedule.MARKER_MIN_WIDTH)/(s.getLaneSize()-1)),s.getEvs().forEach(function(e){var t=o,a=teasp.helper.Schedule.MARKER_X;1<s.getLaneSize()&&(t=Math.max(i*(
e.getEndPos()-e.getPos()+1),teasp.helper.Schedule.MARKER_MIN_WIDTH),a+=o-i*(s.getLaneSize()-e.getEndPos()-1)-t,e.getPos()&&(--a,t+=1)),dojo.style(e.getMarkerId(),"left",a+"px"),dojo.style(e.getMarkerId(),"width",t+"px")})}},teasp.helper.Schedule.prototype.adjustSubject=function(){for(var e=dojo.byId(this.baseDivId).scrollTop,t=0;t<this.evs.length;t++){var a,o=this.evs[t],o=dojo.byId(o.getMarkerId()),s=dojo.query(
"div",o);s.length&&(s=s[0],o=(a=o.offsetTop)+o.offsetHeight-1,dojo.style(s,"top",(a<e&&e<o?e-a:0)+"px"))}},teasp.helper.Schedule.prototype.onresize=function(){this.arrangePosition()},teasp.helper.Schedule.prototype.scrollArea=function(){this.adjustSubject()},teasp.helper.Schedule.prototype.showAllDayEvent=function(){if(0<this.allDayEvs.length){for(var e=[],t=0;t<this.allDayEvs.length;t++)e.push(
this.allDayEvs[t].getSubject());var a=this.pouch.isOwner()&&this.allDayEvs[0].getId()&&!teasp.isSforce()?'<a href="'+this.allDayEvs[0].getLink()+'" style="text-decoration:none;" target="_blank">{0}</a>':"{0}",o=teasp.message.getLabel("tm20001090")+teasp.util.entitize(e[0]),s=(dojo.style("ruler2","font-size","12px"),o=o.truncateTailInWidth(1<this.allDayEvs.length?270:320,dojo.byId("ruler2")),
1<this.allDayEvs.length?teasp.message.getLabel("tm20001100",this.allDayEvs.length-1):"");dojo.style("timeGridTopRow","display",""),dojo.byId("timeGridTop").style.height="30px",dojo.byId("timeGridTop").innerHTML='<div style="padding:0px;margin:8px 2px 8px 8px;white-space:nowrap;overflow-x:hidden;" id="allDayEvent">'+dojo.replace(a,[o+s])+"</div>",dojo.byId("timeGridTop").title=[teasp.message.getLabel("tm20001110")
].concat(e).join("\n"),dojo.byId("timeGridView").style.height="401px"}else dojo.style("timeGridTopRow","display","none"),dojo.byId("timeGridTop").innerHTML="",dojo.byId("timeGridTop").title="",dojo.byId("timeGridView").style.height="436px";dojo.byId("timeGridView").scrollTop=280},teasp.helper.Schedule.prototype.import=function(e,t){this.importLogic.import(e,this.pouch,this,t)},teasp.provide("teasp.helper.Diverge"),
teasp.helper.Diverge=function(e){this.date=e.date,this.dIn=new teasp.helper.DivergeOne({logt:e.enterTime,judge:e.enterDivergenceJudgement,reason:e.enterDivergenceReason,stamp:e.st}),this.dOut=new teasp.helper.DivergeOne({logt:e.exitTime,judge:e.exitDivergenceJudgement,reason:e.exitDivergenceReason,stamp:e.et})},teasp.helper.Diverge.prototype.getJudge=function(){var e,t,a=this.dIn.getJudge(),o=this.dOut.getJudge();
return(e=0===a.type&&0===o.type?{type:0,reason:e=a.reason|o.reason,css:e?"pp_base pp_acc_03":"png-add",title:teasp.message.getLabel(e?"ac00000420":"ac00000410"),summ:teasp.message.getLabel(e?"ac00000390":"ac00000400")}:0<a.type||0<o.type?(e=0<a.type&&!a.reason||0<o.type&&!o.reason?0:1,{type:(a.type||0)|(o.type||0),reason:e,css:e?"pp_base pp_acc_01":"pp_base pp_acc_02",title:teasp.message.getLabel(
e?"ac00000370":"ac00000380"),summ:teasp.message.getLabel(e?"ac00000370":"ac00000380")}):(e=a.reason|o.reason,t=a.stampd|o.stampd,{type:-1,reason:e,css:e?"pp_base pp_acc_03":"png-add",title:teasp.message.getLabel(e?"ac00000420":"ac00000410"),summ:"",stampd:t})).date=this.date,e.dIn=a,e.dOut=o,e},teasp.helper.DivergeOne=function(e){this.logt=e.logt,this.judge=e.judge,this.reason=e.reason,this.stamp=e.stamp},
teasp.helper.DivergeOne.prototype.getJudge=function(){var e="number"==typeof this.judge?{type:this.judge}:{type:null,stampd:"number"==typeof this.stamp?1:0};return e.reason=this.reason?1:0,e},teasp.provide("teasp.helper.Summary"),teasp.helper.Summary=function(e){this.pouch=e,this.monSum=this.pouch.getMonthSummary(),this.categoryL=this.monSum.o.categoryL,this.categoryS=this.monSum.o.categoryS},
teasp.helper.Summary.prototype.getSummaryContentsByCategory=function(e,t,a){var o=this.pouch.getSummarySettings();if(!o)return null;var s=o[e]||null;if(!s)return null;var i,n=[];for(i in s)this.isLocalCondition(o,i)&&n.push(i);for(var r=(o.orderLocalCondition||"").split(","),l={},p=0;p<r.length;p++){var d=r[p];d&&(l[d]=p)}for(n=n.sort(function(e,t){
return void 0!==l[e]&&void 0===l[t]?-1:void 0===l[e]&&void 0!==l[t]?1:void 0!==l[e]&&void 0!==l[t]?l[e]-l[t]:e<t?-1:1}),p=0;p<n.length;p++){var c=n[p];if(this.matchLocalCondition(o[c]))return s[c]}return s[a]||s[t]||s.default},teasp.helper.Summary.prototype.isLocalCondition=function(e,t){return e&&t&&(/^local.+$/.test(t)||/^L_.+$/.test(t))&&e.hasOwnProperty(t)},
teasp.helper.Summary.prototype.matchLocalConditionByKey=function(e){var t=this.pouch.getSummarySettings();return!!this.isLocalCondition(t,e)&&this.matchLocalCondition(t[e])},teasp.helper.Summary.prototype.matchLocalCondition=function(e){if(!e)return!1;if(e.workSystem&&this.isMatchStrict(e.workSystem))return!0;var t=this.pouch.getTargetEmpObj(),a=null;if("EmpType"==e.target?a=t.empTypeName||"":"Dept"==e.target&&(
a=t.deptName||""),null===a)return!1;if(e.names&&0<e.names.length){for(var o=!1,s=0;s<e.names.length&&!o;s++){var i,n=e.names[s];o=e.matchType?!((i=a.indexOf(n))<0)&&(1==e.matchType?0==i:2!=e.matchType||i==a.length-n.length):a==e.name}return o}return e.matchType?!((i=a.indexOf(e.name))<0)&&(1==e.matchType?0==i:2!=e.matchType||i==a.length-e.name.length):a==e.name},
teasp.helper.Summary.prototype.getSummaryBottomContents=function(){var e=this.getDefaultSummaryBottomContents(this.monSum.o),t=!(t=this.getSummaryContentsByCategory("summaryBottom",this.categoryL,this.categoryS))||t.useOriginal?e:this.mergeFields(e,t);return(t=this.buildFields(this.setDefaultSummaryValues(t))).numberOfColumns=t.numberOfColumns||0,t},teasp.helper.Summary.prototype.getTimeViewBottomContents=function(){
var e=this.getDefaultTimeViewBottomContents(this.monSum.o),t=!(t=this.getSummaryContentsByCategory("timeViewBottom",this.categoryL,this.categoryS))||t.useOriginal?e:this.mergeFields(e,t);return(t=this.buildFields(this.setDefaultSummaryValues(t))).numberOfColumns=t.numberOfColumns||0,t},teasp.helper.Summary.prototype.getDefaultSummaryBottomContents=function(e){return{numberOfColumns:3,column1:[{key:"fixdays",
label:e.fixdays.col},{key:"realdays",label:e.realdays.col},{key:"workLegalHolidays",label:e.workLegalHolidays.col},{key:"workHolidays",label:e.workHolidays.col},{separator:!0},{key:"workFixedTime",label:e.workFixedTime.col},{key:"workWholeTime",filter:"fix,flex,flexp,var",label:e.workWholeTime.col+'<span style="font-size:85%;">'+teasp.message.getLabel("tm10009240")+"</span>"},{key:"workWholeOmitHolidayTime",
filter:"flex,flexp",label:e.workWholeOmitHolidayTime.col+'<br/><span style="font-size:85%;">'+teasp.message.getLabel("tm10009240")+"</span>"},{key:"workRealOmitHolidayTime",filter:"flexp",label:e.workRealOmitHolidayTime.col+'<br/><span style="font-size:85%;">'+teasp.message.getLabel("tm10009250")+"</span>"},{key:"workRealTime",filter:"fix,var",
label:e.workRealTime.col+'<span style="font-size:85%;">'+teasp.message.getLabel("tm10009250")+"</span>",label2:teasp.message.getLabel("tm10009231")+'<span style="font-size:85%;">'+teasp.message.getLabel("tm10009250")+"</span>",label2Shift:"fixd"},{key:"workRealTimeNoDiscretion",filter:"fixd,man",label:e.workRealTime.col+'<span style="font-size:85%;">'+teasp.message.getLabel("tm10009250")+"</span>"},{key:"amountTime",
filter:"flex",label:e.amountTime.col},{key:"amountTime",filter:"flexp",label:teasp.message.getLabel("tf10010290")},{separator:!0,filter:"var1,var3,var6,var12"},{key:"periodWorkLegalMax",filter:"var1,var3,var6,var12",label:teasp.message.getLabel("tm10009050")+'<span style="font-size:0.9em;"> ('+e.periodJp+":"+e.periodSpan+")</span><br/>"+teasp.message.getLabel("tm10009060")},{key:"periodWorkLegalTime",
filter:"var1,var3,var6,var12",label:teasp.message.getLabel("tm10009070")+'<span style="font-size:0.9em;"> ('+e.currentSpan+")</span><br/>"+teasp.message.getLabel("tm10009080")},{key:"overTimeInWeek",filter:"reserve",label:teasp.message.getLabel("tf10010430")},{key:"overTimeInPeriod",filter:"var1,var3,var6,var12",label:teasp.message.getLabel("tm10009420")},{separator:!0},{key:"workOverTime36",
label:e.workOverTime36.col},{key:"quartWorkOverTime36",label:e.quartWorkOverTime36.col},{key:"totalWorkOverTime36",label:e.totalWorkOverTime36.col},{key:"totalWorkOverCount36",label:e.totalWorkOverCount36.col},{key:"workOver40perWeek",label:e.workOver40perWeek.col}],column2:[{key:"settlementPeriod",filter:"flexp",labelOnly:!0,label:e.periodLabel},{key:"legalTime",filter:"flex",label:e.legalTime.col},{
key:"periodLegalTime",filter:"flexp",label:e.periodLegalTime.col},{key:"periodFixTime",filter:"reserve",label:e.periodFixTime.col},{key:"weeklyAvg50",filter:"reserve",label:e.weeklyAvg50.col},{key:"carryforwardFromPrev",filter:"flexp",label:e.carryforwardFromPrev.col},{key:"carryforwardToNext",filter:"flexf,flexm",label:e.carryforwardToNext.col},{key:"periodAmountTime",filter:"flexe",label:e.periodAmountTime.col},{
key:"workRealOmitHolidayTime",filter:"flex",label:e.workRealOmitHolidayTime.col+'<br/><span style="font-size:85%;">'+teasp.message.getLabel("tm10009250")+"</span>"},{key:"legalOverTime",label:e.legalOverTime.col},{key:"legalOutOverTime",label:e.legalOutOverTime.col},{key:"workHolidayTime",label:e.workHolidayTime.col},{key:"settlementTime",filter:"flexp",label:e.weeklyAvg50Label},{separator:!0},{key:"workNightTime",
label:e.workNightTime.col},{key:"workChargeTime",label:e.workChargeTime.col},{key:"workOver45Time",label:e.workOver45Time.col},{key:"workOver60Time",label:e.workOver60Time.col},{separator:!0},{key:"lateCount",label:e.lateCount.col},{key:"earlyCount",label:e.earlyCount.col},{key:"privateInnerCount",label:e.privateInnerCount.col}],column3:[{key:"holidayPaid",label:teasp.message.getLabel("tm10009350")},{
key:"paidRestTime",label:teasp.message.getLabel("tm10009360")},{separator:!0},{key:"holidayDaiq",label:teasp.message.getLabel("tm10009370")},{separator:!0},{key:"holidayFree",label:teasp.message.getLabel("tm10009380")},{separator:!0},{key:"yuqRemain",label:teasp.message.getLabel("tm10009390")+'<span style="font-size:85%;">'+teasp.message.getLabel("tm10009140",teasp.util.date.formatDate(this.pouch.getEmpMonthLastDate(
),"M/d"))+"</span>"},{key:"plannedRemain",label:e.plannedRemain.col}]}},teasp.helper.Summary.prototype.getDefaultTimeViewBottomContents=function(e){return{numberOfColumns:2,column1:[{key:"fixdays",label:e.fixdays.col},{key:"realdays",label:e.realdays.col},{key:"workFixedTime",label:e.workFixedTime.col},{key:"workWholeTime",label:e.workWholeTime.col,filter:"fix,flex,flexp,var"},{key:"workHolidayTime",filter:"flexp",
label:teasp.message.getLabel("legalHolidayWorkTime_label")}],column2:[{key:"settlementPeriod",filter:"flexp",labelOnly:!0,label:e.periodLabel},{key:"curAmountTime",label:e.curAmountTime.col,filter:"flex",atTheMoment:e.curAmountTime.atTheMoment},{key:"carryforwardFromPrev",filter:"flexp",label:e.carryforwardFromPrev.col},{key:"carryforwardToNext",filter:"flexf,flexm",label:e.carryforwardToNext.col},{
key:"periodAmountTime",label:e.periodAmountTime.col,filter:"flexe"},{key:"workHolidayTime",exclude:"flexp",label:teasp.message.getLabel("legalHolidayWorkTime_label")},{key:"legalOverTime",label:e.legalOverTime.col},{key:"legalOutOverTime",label:e.legalOutOverTime.col},{key:"settlementTime",filter:"flexp",label:e.weeklyAvg50Label},{fixValue:"",filter:"fix,var"}]}},
teasp.helper.Summary.prototype.getDefaultLabel=function(){var e=this.monSum.o;return{fixdays:e.fixdays.col,realdays:e.realdays.col,workLegalHolidays:e.workLegalHolidays.col,workHolidays:e.workHolidays.col,workFixedTime:e.workFixedTime.col,workWholeTime:e.workWholeTime.col,workWholeOmitHolidayTime:e.workWholeOmitHolidayTime.col,workRealTime:e.workRealTime.col,workRealTimeNoDiscretion:e.workRealTime.col,
amountTime:e.amountTime.col,curAmountTime:e.curAmountTime.col,curAmountTime_atTheMoment:e.curAmountTime.atTheMoment,periodAmountTime:e.periodAmountTime.col,curPeriodAmountTime:e.curPeriodAmountTime.col,curPeriodAmountTime_atTheMoment:e.curPeriodAmountTime.atTheMoment,periodLegalTime:e.periodLegalTime.col,periodFixTime:e.periodFixTime.col,weeklyAvg50:e.weeklyAvg50.col,carryforwardFromPrev:e.carryforwardFromPrev.col,
carryforwardToNext:e.carryforwardToNext.col,settlementTime:e.settlementTime.col,periodWorkLegalMax:teasp.message.getLabel("tm10009050")+teasp.message.getLabel("tm10009060"),periodWorkLegalTime:teasp.message.getLabel("tm10009070")+teasp.message.getLabel("tm10009080"),overTimeInPeriod:teasp.message.getLabel("tm10009420"),overTimeInWeek:teasp.message.getLabel("tf10010430"),workOverTime36:e.workOverTime36.col,
quartWorkOverTime36:e.quartWorkOverTime36.col,totalWorkOverTime36:e.totalWorkOverTime36.col,totalWorkOverCount36:e.totalWorkOverCount36.col,workOver40perWeek:e.workOver40perWeek.col,legalTime:e.legalTime.col,workRealOmitHolidayTime:e.workRealOmitHolidayTime.col,legalOverTime:e.legalOverTime.col,legalOutOverTime:e.legalOutOverTime.col,workHolidayTime:e.workHolidayTime.col,workNightTime:e.workNightTime.col,
workChargeTime:e.workChargeTime.col,workOver45Time:e.workOver45Time.col,workOver60Time:e.workOver60Time.col,lateCount:e.lateCount.col,earlyCount:e.earlyCount.col,privateInnerCount:e.privateInnerCount.col,holidayPaid:teasp.message.getLabel("tm10009350"),paidRestTime:teasp.message.getLabel("tm10009360"),holidayDaiq:teasp.message.getLabel("tm10009370"),holidayFree:teasp.message.getLabel("tm10009380"),
yuqRemain:teasp.message.getLabel("tm10009390"),plannedRemain:e.plannedRemain.col}},teasp.helper.Summary.prototype.setDefaultSummaryValues=function(e){var t=this.monSum.o,a=t.holidaySummary;return this.setSummaryValue(e,"fixdays",t.fixdays.val),this.setSummaryValue(e,"realdays",t.realdays.val),this.setSummaryValue(e,"workLegalHolidays",t.workLegalHolidays.val),this.setSummaryValue(e,"workHolidays",t.workHolidays.val),
this.setSummaryValue(e,"workFixedTime",t.workFixedTime.val),this.setSummaryValue(e,"workWholeTime",t.workWholeTime.val),this.setSummaryValue(e,"workWholeOmitHolidayTime",t.workWholeOmitHolidayTime.val),this.setSummaryValue(e,"workRealTime",t.workRealTime.val),this.setSummaryValue(e,"workRealTimeNoDiscretion",t.workRealTimeNoDiscretion.val),this.setSummaryValue(e,"amountTime",t.amountTime.val),this.setSummaryValue(e,
"curAmountTime",t.curAmountTime.val),this.setSummaryValue(e,"periodAmountTime",t.periodAmountTime.val),this.setSummaryValue(e,"curPeriodAmountTime",t.curPeriodAmountTime.val),this.setSummaryValue(e,"periodLegalTime",t.periodLegalTime.val),this.setSummaryValue(e,"periodFixTime",t.periodFixTime.val),this.setSummaryValue(e,"weeklyAvg50",t.weeklyAvg50.val),this.setSummaryValue(e,"carryforwardFromPrev",
t.carryforwardFromPrev.val),this.setSummaryValue(e,"carryforwardToNext",t.carryforwardToNext.val),this.setSummaryValue(e,"settlementTime",t.settlementTime.val),this.setSummaryValue(e,"periodWorkLegalMax",t.periodWorkLegalMax.val),this.setSummaryValue(e,"periodWorkLegalTime",t.periodWorkLegalTime.val),this.setSummaryValue(e,"overTimeInPeriod",t.overTimeInPeriod.val),this.setSummaryValue(e,"overTimeInWeek",
t.overTimeInWeek.val),this.setSummaryValue(e,"workOverTime36",t.workOverTime36.val),this.setSummaryValue(e,"quartWorkOverTime36",t.quartWorkOverTime36.val),this.setSummaryValue(e,"totalWorkOverTime36",t.totalWorkOverTime36.val),this.setSummaryValue(e,"totalWorkOverCount36",t.totalWorkOverCount36.val),this.setSummaryValue(e,"workOver40perWeek",t.workOver40perWeek.val),this.setSummaryValue(e,"legalTime",t.legalTime.val
),this.setSummaryValue(e,"workRealOmitHolidayTime",t.workRealOmitHolidayTime.val),this.setSummaryValue(e,"legalOverTime",t.legalOverTime.val),this.setSummaryValue(e,"legalOutOverTime",t.legalOutOverTime.val),this.setSummaryValue(e,"workHolidayTime",t.workHolidayTime.val),this.setSummaryValue(e,"workNightTime",t.workNightTime.val),this.setSummaryValue(e,"workChargeTime",t.workChargeTime.val),this.setSummaryValue(e,
"workOver45Time",t.workOver45Time.val),this.setSummaryValue(e,"workOver60Time",t.workOver60Time.val),this.setSummaryValue(e,"lateCount",t.lateCount.val+" "+t.lateTime.val+(t.flex?"":"<br/>"+t.lateLostTime.val)),this.setSummaryValue(e,"earlyCount",t.earlyCount.val+" "+t.earlyTime.val+(t.flex?"":"<br/>"+t.earlyLostTime.val)),this.setSummaryValue(e,"privateInnerCount",t.privateInnerCount.val+" "+t.privateInnerTime.val+(
t.flex?"":"<br/>"+t.privateInnerLostTime.val)),this.setSummaryValue(e,"holidayPaid",this.getHolidayDaysAndHours(a.sums[teasp.constant.HOLIDAY_TYPE_PAID],a.sumh[teasp.constant.HOLIDAY_TYPE_PAID])),this.setSummaryValue(e,"paidRestTime",this.pouch.getMonthSubTimeByKey("paidRestTime")),this.setSummaryValue(e,"holidayDaiq",this.getHolidayDaysAndHours(a.sums[teasp.constant.HOLIDAY_TYPE_DAIQ],
a.sumh[teasp.constant.HOLIDAY_TYPE_DAIQ])),this.setSummaryValue(e,"holidayFree",this.getHolidayDaysAndHours(a.sums[teasp.constant.HOLIDAY_TYPE_FREE],a.sumh[teasp.constant.HOLIDAY_TYPE_FREE])),this.setSummaryValue(e,"yuqRemain",t.yuqRemain.val),this.setSummaryValue(e,"plannedRemain",t.plannedRemain.val),this.setSummaryElement(e,"holidayPaid","lines",this.getHolidayItems(a.items[teasp.constant.HOLIDAY_TYPE_PAID])),
this.setSummaryElement(e,"holidayDaiq","lines",this.getHolidayItems(a.items[teasp.constant.HOLIDAY_TYPE_DAIQ])),this.setSummaryElement(e,"holidayFree","lines",this.getHolidayItems(a.items[teasp.constant.HOLIDAY_TYPE_FREE])),e},teasp.helper.Summary.prototype.getHolidayDaysAndHours=function(e,t){return t?teasp.message.getLabel("tf10007630",e,teasp.util.time.timeValue(t)):teasp.message.getLabel("tm10001010",e)},
teasp.helper.Summary.prototype.getHolidayItems=function(e){var t,a=[];for(t in e)e.hasOwnProperty(t)&&(e[t].name=t,a.push(e[t]));for(var a=a.sort(function(e,t){return e.order-t.order}),o=[],s=0,i=0;i<a.length;i++){var n=a[i];o.push({head:0==s++?teasp.message.getLabel("tm10009160"):"",label:n.name,value:n.time?teasp.util.time.timeValue(n.time):teasp.message.getLabel("tm10001010",n.cnt)})}return s||o.push({
head:teasp.message.getLabel("tm10009160"),label:teasp.message.getLabel("tm10009170"),value:teasp.message.getLabel("tm10009180")}),o},teasp.helper.Summary.prototype.buildFields=function(e){for(var t=e.numberOfColumns||0,a=1;a<=t;){for(var o=e["column"+a]||[],s=0;s<o.length;s++){var i=o[s];if(i.filter&&"default"!=i.filter&&!this.isMatchLoosely(i.filter
)||!i.key&&!i.apiKey&&void 0===i.fixValue&&!i.separator||i.removed||this.isMatchStrict(i.exclude))i.skip=!0;else{var n=this.isMatchStrict(i.label2Shift),r=n?i.label2MsgId:i.labelMsgId,r=(r=r?teasp.message.getLabel(r):null)||(n?this.isEngMode()?i.label2En:i.label2:this.isEngMode()?i.labelEn:i.label),l=(i.label&&!r||(i.label=r||""),i.label&&i.atTheMoment&&!i.omitAtTheMoment&&(i.label+=i.atTheMoment),[]);if(
void 0!==i.fixValue)l.push(i.fixValue);else if(i.apiKey){for(var p=i.apiKey.split(","),d=[],c=0;c<p.length;c++){var m=p[c];d.push(this.pouch.getEmpMonthValueByKey(m))}if(1==p.length)l.push(d[0]);else if(i.operator){for(var h=0,u=0,g=i.operator.split(","),y=g[u++]||"+",c=0;c<d.length;c++){var f=d[c]||0;if(c)switch(y){case"+":h+=f;break;case"-":h-=f;break;case"*":h*=f;break;case"/":h/=f}else h=f;u<g.length&&(
y=g[u++]||"+")}l.push(h)}else l=d}else l.push(i.value);for(var b,_,v=i.unit&&i.unit.split(",")||[],T=i.format&&i.format.split(",")||[],j=Math.min(v.length,T.length),c=0;c<j;c++)c<l.length&&(b=v[c],_=T[c],f=l[c],"d"==b?l[c]=f?moment(f).format(_):"":"hmm"==_&&("m"==b?l[c]=teasp.util.time.timeValue(f):"h"==b&&(l[c]=teasp.util.time.timeValue(60*f))));n=!1,r=(l.length&&(1!=l.length||null!==teasp.util.dspVal(l[0])
)||void 0===i.nullValueFix&&void 0===i.nullValue||(l=[i.nullValueFix||i.nullValue],i.nullValueFix&&(n=!0)),null),r=i.placeholderMsgId?teasp.message.getLabel(i.placeholderMsgId):this.isEngMode()?i.placeholderEn:i.placeholder;i.value=r&&!n?this.format(r,l):"number"==typeof l[0]?l[0]:l[0]||""}}a++}return e},teasp.helper.Summary.prototype.mergeFields=function(e,t){for(var a=t.numberOfColumns,o=1;o<=a;){for(
var s=t["column"+o]||[],i=0;i<s.length;i++){var n,r=s[i];r.key&&((n=this.getSummaryFieldsByKey(e,r.key,o)).length&&(r=dojo.mixin(dojo.clone(n[0]),r),s.splice(i,1,r)),r.key&&!r.hasOwnProperty("label")&&(r.label=this.getDefaultLabel()[r.key]||""),this.getDefaultLabel()[r.key+"_atTheMoment"]&&(r.atTheMoment=this.getDefaultLabel()[r.key+"_atTheMoment"]))}o++}return t},
teasp.helper.Summary.prototype.setSummaryValue=function(e,t,a){this.setSummaryElement(e,t,"value",a)},teasp.helper.Summary.prototype.setSummaryElement=function(e,t,a,o){for(var s=this.getSummaryFieldsByKey(e,t),i=0;i<s.length;i++)s[i][a]=o},teasp.helper.Summary.prototype.getSummaryFieldsByKey=function(e,t,a){var o=[];if(void 0!==a)for(var s=e["column"+a]||[],i=0;i<s.length;i++)(r=s[i]).key==t&&this.isMatchLoosely(
r.filter)&&o.push(r);for(var n=1;n<=5;)if(void 0!==a&&n==a)n++;else for(var r,s=e["column"+n++]||[],i=0;i<s.length;i++)(r=s[i]).key==t&&o.push(r);return o},teasp.helper.Summary.prototype.isMatchFilter=function(e,t){if(!e)return t;for(var a=e.split(","),o=0;o<a.length;o++){var s=a[o];if(this.matchLocalConditionByKey(s))return!0;if(s==this.categoryS||s==this.categoryL)return!0}return!1},
teasp.helper.Summary.prototype.isMatchLoosely=function(e){return this.isMatchFilter(e,!0)},teasp.helper.Summary.prototype.isMatchStrict=function(e){return this.isMatchFilter(e,!1)},teasp.helper.Summary.prototype.isEngMode=function(){return"ja"!=teasp.message.languageLocaleKey},teasp.helper.Summary.prototype.format=function(e,t){for(var a=e||"",o=0;o<t.length;o++){var s=t[o];null==s&&(s=""),a=a.replace(RegExp(
"\\{"+o+"\\}","g"),s)}return a},teasp.provide("teasp.view.Daily"),teasp.view.Daily=function(){this.workRealTime=0,this.toolTips=[],this.toolTipSeq=0,this.eventHandles={},this.dateList=null,this.jobWorks=null,this.helperTxsLog=new teasp.helper.ScheduleTxsLog,this.helperSche=new teasp.helper.Schedule,this.COMMENT_QUEST=null,this.COMMENT_QUEST_COLOR="#999999",this.graph=null},
teasp.view.Daily.prototype=new teasp.view.Base,teasp.view.Daily.prototype.init=function(e,t){this.COMMENT_QUEST=teasp.message.getLabel("tm20001050"),this.readParams({target:"empDay"}),this.viewParams.date?this.viewParams.date=teasp.util.date.formatDate(this.viewParams.date):this.viewParams.date=teasp.util.date.formatDate(teasp.util.date.getToday()),teasp.manager.request("loadEmpDay",this.viewParams,this.pouch,{
hideBusy:!0},this,function(){this.pouch.isOldRevision()?teasp.locationHref(teasp.getPageUrl("convertView")+"?forwardURL="+encodeURIComponent(teasp.getPageUrl("workTimeView"))):this.pouch.getEmpId()?this.initDaily():teasp.locationHref(teasp.getPageUrl("empRegistView")+"?forwardURL="+encodeURIComponent(teasp.getPageUrl("workTimeView"))),e()},function(e){t(e)})},teasp.view.Daily.prototype.initDaily=function(){
teasp.message.setLabelHtml("section_label"),teasp.message.setLabelHtml("empName_label"),teasp.message.setLabelHtml("chatter_Info_1"),teasp.message.setLabelHtml("chatter_Info_2"),teasp.message.setLabelHtml("schedule_label","schedule_label"),teasp.message.setLabelHtml("empWork_label","empWork_label"),teasp.message.setLabelHtml("importFromSchedule_Info"),teasp.message.setLabelHtml("workReport_label","workReport_label"),
teasp.message.setLabelHtml("atkWorlInfo_label","empTime_label"),teasp.message.setLabelHtml("expAdjustment_label","empExp_caption"),teasp.message.setLabelHtml("tr_type_head","expItem_head"),teasp.message.setLabelHtml("tr_route_head","expRoute_head"),teasp.message.setLabelHtml("tr_cost_head","expCost_head"),teasp.message.setLabelHtml("tr_detail_head","expNote_head"),teasp.message.setLabelHtml("totalCost_foot_2",
"total_label"),teasp.message.setLabelTitle("buttonDateSelect","calendar_btn_title"),teasp.message.setLabelTitle("clearComment"),teasp.message.setLabelTitle("empWorkEdit","empWorkEdit_btn_title"),teasp.message.setLabelTitle("jumpToEmpJob","empWorkView_btn_title"),teasp.message.setLabelTitle("jumpToEmpWorkTime","empTimeView_btn_title"),teasp.message.setLabelTitle("empExpInsert","empExpNew_btn_title"),
teasp.message.setLabelTitle("tr_btn_tomon","empExpView_btn_title"),dojo.query("td.ts-top-title > div.main-title").forEach(function(e){e.innerHTML=teasp.message.getLabel("tk10000238")},this),dojo.query("td.ts-top-title > div.sub-title").forEach(function(e){e.innerHTML=teasp.message.getLabel("tf10004560")},this),dojo.byId("buttonPrevDate").firstChild.innerHTML=teasp.message.getLabel("tf10000320"),dojo.byId(
"buttonCurrDate").firstChild.innerHTML=teasp.message.getLabel("nextDay_btn_title"),dojo.byId("buttonNextDate").firstChild.innerHTML=teasp.message.getLabel("tf10000330"),dojo.byId("toggleWorkEnd").firstChild.innerHTML=teasp.message.getLabel("endTime_head"),dojo.byId("clearComment").firstChild.innerHTML=teasp.message.getLabel("clearLabel"),dojo.query("#endAndDayFixLabel > span").forEach(function(e){
e.innerHTML=teasp.message.getLabel("tk10004050")}),teasp.permitPushTime?teasp.message.setLabelTitle("toggleWorkEnd","pushEnd_btn_title"):teasp.message.setLabelTitle("toggleWorkEnd","tk10005330"),dojo.byId("buttonWorkEnd").value=teasp.message.getLabel("tw00000280"),dojo.byId("buttonFixEnd").value=teasp.message.getLabel("tw00000300"),dojo.toggleClass("buttonFixEnd","pw_btn_english",teasp.isEnglish()),dojo.byId(
"empTypeTitle").innerHTML=teasp.message.getLabel("empType_label"),dojo.connect(dojo.byId("empWorkEdit"),"onclick",this,this.openEmpWork),dojo.connect(dojo.byId("empWorkFromSche"),"onclick",this,this.openEmpWorkImp),dojo.connect(dojo.byId("buttonPrevDate"),"onclick",this,this.changePrevDate),dojo.connect(dojo.byId("buttonCurrDate"),"onclick",this,this.changeCurrDate),dojo.connect(dojo.byId("buttonNextDate"),"onclick",
this,this.changeNextDate);var e=dojo.query("td.ts-top-button3 > a",dojo.byId("expTopView")),e=(0<e.length&&(e[0].href=this.pouch.getHelpLink()),dojo.query(".emp_work_note_area").forEach(function(e){dojo.style(e,"display",this.pouch.getWorkNoteOption()?"":"none")},this),this.pouch.isTimeReportDedicatedToJob()?dojo.style("empWorkDiv","height",this.pouch.getWorkNoteOption()?"275px":"392px"):(dojo.style("empWorkDiv",
"height",this.pouch.getWorkNoteOption()?"183px":"300px"),dojo.byId("tsfFormArea")&&dojo.style("tsfFormArea","display",""),dojo.query("#timeAreaR > table > tbody > tr:nth-child(2)").forEach(function(e){dojo.style(e,"display","")})),dojo.query("#expTopView td.ts-top-photo > div")[0]),t=this.pouch.getSmallPhotoUrl(),a=null,a=t?dojo.create("img",{src:t,className:"smallPhoto"},e):dojo.create("img",{
className:"pp_base pp_default_photo"},e),o=(this.pouch.isTimeReportDedicatedToJob()||(dojo.connect(a,"onclick",this,this.openEmpView),a.title=teasp.message.getLabel("personal_link_title"),dojo.style(a,"cursor","pointer")),this.dateList=new dijit.form.Select({id:"dateList",maxHeight:480,name:"selectdate",style:{fontSize:"12px",width:"108px"},className:"dojo_date_list"},"dateListArea"),dojo.connect(this.dateList,
"onChange",this,this.changedDateSelect),this.createSfcalTable(),dojo.style("endAndDayFixLabel","display",this.pouch.isUseDailyApply()?"":"none"),this.createWorkLocationArea(),this.refreshDaily(!0),dojo.connect(dojo.byId("clearComment"),"onclick",this,this.clearComment),dojo.byId("endComment"));o.value=this.COMMENT_QUEST,dojo.style(o,"color",this.COMMENT_QUEST_COLOR),dojo.connect(o,"onfocus",this,function(e){
o.value==this.COMMENT_QUEST&&(o.value=""),dojo.style(o,"color","#222222")}),dojo.connect(o,"onblur",this,function(e){""==o.value&&(o.value=this.COMMENT_QUEST,dojo.style(o,"color",this.COMMENT_QUEST_COLOR))}),this.viewPlus(),this.pouch.isTimeReportDedicatedToJob()||this.clock()},teasp.view.Daily.prototype.openEmpView=function(){var e=screen.availHeight||800,t=(800<e&&(e=800),window.open(teasp.getPageUrl("workEmpView"
)+"?empId="+this.pouch.getEmpId()+"&mode=read","empInfo","width=700,height="+e+",resizable=yes,scrollbars=yes"));setTimeout(function(){t.resizeTo(710,e)},100)},teasp.view.Daily.prototype.openHolidayView=function(){var e=screen.availHeight||800,t=(800<e&&(e=800),window.open(teasp.getPageUrl("holidayView")+"?empId="+this.pouch.getEmpId()+"&mode=read","empInfo","width=800,height="+e+",resizable=yes,scrollbars=yes"));
setTimeout(function(){t.resizeTo(810,e)},100)},teasp.view.Daily.prototype.createSfcalTable=function(){for(var e=dojo.byId("timeGridBody");e.firstChild;)dojo.destroy(e.firstChild);for(var t=0;t<48;t++){var a=dojo.create("tr",{style:{height:"35px"}},e);dojo.create("td",{className:"time",innerHTML:t},a),dojo.create("td",{className:"event"},a)}},teasp.view.Daily.prototype.refreshDaily=function(e){this.showError(null),
this.showCalendarError(null);var t,a=this.pouch.getParamDate(),o=this.pouch.getEmpDay(a),s=this.pouch.getClassifyJobWorks(a);for(t in this.reflectTsfJobAssign(s),this.jobWorks=this.pouch.getJobWorks(s),this.rangeYear=this.pouch.getDateRangeOfMonth(teasp.util.date.getToday(),13,-12),dijit.byId("calendarSelect").setValue(a),this.eventHandles)this.eventHandles.hasOwnProperty(t)&&(dojo.disconnect(this.eventHandles[t]),
delete this.eventHandles[t]);this.pouch.isAlive(a)?(dojo.style("empWorkEdit","display",""),dojo.style("empWorkFromSche","display",""),dojo.style("empWorkTime","display",""),dojo.style("empExpInsert","display",""),dojo.style("openEmpApply","display",""),dojo.byId("empWorkFromSche").disabled=this.pouch.isJobMonthReadOnly(),dojo.toggleClass("empWorkFromSche","pb_btn_schejob",!this.pouch.isJobMonthReadOnly()),
dojo.toggleClass("empWorkFromSche","pb_btn_schejob_dis",this.pouch.isJobMonthReadOnly()),dojo.style("empWorkFromSche","cursor",this.pouch.isJobMonthReadOnly()?"default":"pointer"),s=!0,n="",this.pouch.isProhibitInputTimeUntilApproved()&&!(i=o.isInputableEx()).inputable&&(s=!1,n=teasp.message.getLabel("tk10001152",i.applyName)),s&&(o.isInputable()?(n=teasp.message.getLabel("empTimeEdit_btn_title"),
this.eventHandles.empWorkTime=dojo.connect(dojo.byId("empWorkTime"),"onclick",this,this.openInputTime)):(s=!1,n=0==o.getDayType()||o.getObj().workFlag||o.isExistApply(teasp.constant.APPLY_KEY_KYUSHTU)?(i=o.getEmpApplyByKey(teasp.constant.APPLY_KEY_HOLIDAY_ALL))?i.holiday&&i.holiday.name||"":teasp.message.getLabel("empTimeEdit_btn_title"):teasp.message.getLabel("tm20001060",teasp.util.date.formatDate(a,"JP1"),
o.isPlannedHoliday()?teasp.message.getLabel("tm20001070"):teasp.message.getLabel("tm20001080")))),this.setWorkLocation(o,!0),dojo.byId("empWorkTime").disable=!s,dojo.byId("empWorkTime").title=n,dojo.toggleClass("empWorkTime","pb_btn_pen2",s),dojo.toggleClass("empWorkTime","pb_btn_pen2a_dis",!s),dojo.style("empWorkTime","cursor",s?"pointer":"default"),teasp.util.date.compareDate(this.rangeYear.from,a
)<=0&&0<=teasp.util.date.compareDate(this.rangeYear.to,a)||this.pouch.isApplyLimitOff()?this.eventHandles.openEmpApply=dojo.connect(dojo.byId("openEmpApply"),"onclick",this,this.openEmpApply(a)):this.eventHandles.openEmpApply=dojo.connect(dojo.byId("openEmpApply"),"onclick",this,function(){teasp.tsAlert(teasp.message.getLabel("tm10001050"),this)}),dojo.byId("openEmpApply").title=teasp.message.getLabel(
"dayApply_caption"),this.pouch.isReadOnly(teasp.constant.TARGET_EXP)?dojo.style("empExpInsert","display","none"):(dojo.style("empExpInsert","display",""),this.eventHandles.empExpInsert=dojo.connect(dojo.byId("empExpInsert"),"onclick",this,function(){this.openDialogEmpExp(null)}))):(dojo.style("empWorkEdit","display","none"),dojo.style("empWorkFromSche","display","none"),dojo.style("empWorkTime","display","none"),
dojo.style("empExpInsert","display","none"),dojo.style("openEmpApply","display","none"),this.setWorkLocation(o,!1)),this.createDateList(),dojo.byId("jumpToEmpWorkTime").href=teasp.getPageUrl("workTimeView")+"?empId="+this.pouch.getEmpId()+"&month="+this.pouch.getYearMonth()+"&subNo="+(this.pouch.getSubNo()||"")+"&mode="+this.pouch.getMode(),dojo.byId("jumpToEmpJob").href=teasp.getPageUrl("empJobView"
)+"?empId="+this.pouch.getEmpId()+"&month="+this.pouch.getJobYearMonth()+"&subNo="+(this.pouch.getJobSubNo()||"")+"&mode="+this.pouch.getMode(),dojo.byId("jumpToEmpExp").href=teasp.getPageUrl("empExpView")+"?empId="+this.pouch.getEmpId()+"&mode="+this.pouch.getMode(),dojo.byId("department").innerHTML=this.pouch.getDeptName(),dojo.byId("empTypeName").innerHTML=this.pouch.getEmpTypeName(),dojo.byId("empName"
).innerHTML=this.pouch.getName(),dojo.byId("empWorkNote").value=o.getWorkNote();var i=dojo.byId("ruler1"),n=(i.style.width="170px",o.getCalendarEvent()),s=n.getExtent(i),i=46<s.height?46:s.height;dojo.byId("dispEvent").style.height=i+"px",dojo.byId("dispEvent").innerHTML=n,dojo.byId("dispEvent").title=n,this.showDayFixButton(o),this.controlDayFix(o),this.showCalendarService(),this.showCalendarStatus(),
this.setPushButton(),this.pouch.isAlive(a)&&this.showWorkBalance(),this.createExpTable(),this.createTimeGraph(),this.helperTxsLog.draw(this.pouch,"timeGridView"),this.helperSche.draw(this.pouch,"timeGridView"),e&&this.disposeInit(function(){teasp.manager.dialogClose("BusyWait")})},teasp.view.Daily.prototype.disposeInit=function(t){var e=[],a=0,o=!1,s=dojo.hitch(this,function(){a>=e.length?(0<a&&(o?this.changeDate(
this.pouch.getParamDate(),!0):(this.refreshDaily(),setTimeout(function(){teasp.manager.dialogClose("BusyWait")},500))),t(!0)):(0==a&&teasp.manager.dialogOpen("BusyWait",null,null),e[a++]())}),i=this.pouch.getDirtyApplys(),o=i.reload;0<i.directs.length&&e.push(dojo.hitch(this,function(){var e=i.directs;return dojo.hitch(this,function(){this.cleanupDirectApply(e,function(){setTimeout(dojo.hitch(this,s),100)},function(e
){teasp.message.alertError(e),t(!1)})})})()),0<i.lst.length&&e.push(dojo.hitch(this,function(){var e=i;return dojo.hitch(this,function(){this.cleanupEmpReject(e,function(){setTimeout(dojo.hitch(this,s),100)},function(e){teasp.message.alertError(e),t(!1)})})})());for(var n=this.pouch.getReviseTimeApplys(),r=0;r<n.length;r++)e.push(dojo.hitch(this,function(){var e=n[r];return dojo.hitch(this,function(){
this.reviseApplyEnter(e,function(){setTimeout(dojo.hitch(this,s),100)},function(e){teasp.message.alertError(e),t(!1)})})})());s()},teasp.view.Daily.prototype.cleanupEmpReject=function(e,t,a){teasp.manager.request("cleanupEmpReject",{empId:this.pouch.getEmpId(),month:e.month,currMonth:this.pouch.getYearMonth(),currSubNo:this.pouch.getSubNo(),accLog:this.pouch.isInputAccessControl()},this.pouch,{hideBusy:!0},this,t,a)}
,teasp.view.Daily.prototype.cleanupDirectApply=function(e,t,a){for(var o,s,i=[],n={},r=0;r<e.length;r++){var l=e[r];if(l.directFlag&&!l.entered)for(var p=teasp.util.date.getDateList(l.startDate,l.endDate),d=l.directFlag,c=0;c<p.length;c++){var m=p[c];(h=this.pouch.getEmpDay(m)).isValid()&&(""===(u=h.getStartTime(!0,null,teasp.constant.C_REAL))&&(u=null),""===(g=h.getEndTime(!0,null,teasp.constant.C_REAL))&&(g=null),
b=2&d?null:g,u==(f=1&d?null:u)&&g==b||(y=h.createTimeTable(f,b),i.push({date:m,timeTable:y,empApplyId:l.id,clearWorkLocation:!(l.applyType!=teasp.constant.APPLY_TYPE_KYUSHTU||!h.getWorkLocationId()||f||b)}),n[m]=1))}}for(r=0;r<e.length;r++){var h,l=e[r];if(!l.directFlag&&!n[l.startDate])if((h=this.pouch.getEmpDay(l.startDate)).isValid()){""===(u=h.getStartTime(!0,null,teasp.constant.C_REAL))&&(u=null),""===(
g=h.getEndTime(!0,null,teasp.constant.C_REAL))&&(g=null);for(var u,g,d=h.getInputLimit().flag,y=h.createTimeTableFix(d),f=null,b=null,c=0;c<y.length;c++)if(1==y[c].type){f=y[c].from,b=y[c].to;break}u==f&&g==b||(i.push({date:l.startDate,timeTable:y,clearWorkLocation:!(l.applyType!=teasp.constant.APPLY_TYPE_KYUSHTU||!h.getWorkLocationId()||f||b)}),n[l.startDate]=1)}}i.length<=0?t.apply(this):(o=0,s=null,(s=dojo.hitch(
this,function(){var e={empId:this.pouch.getEmpId(),month:this.pouch.getYearMonth(),lastModifiedDate:this.pouch.getLastModifiedDate(),mode:this.pouch.getMode(),date:i[o].date,dayFix:!1,client:teasp.constant.APPLY_CLIENT_MONTHLY,timeTable:i[o].timeTable,refreshWork:!0,clearWork:!1,empApplyId:i[o].empApplyId||null,useInputAccessControl:this.pouch.isInputAccessControl()};i[o].clearWorkLocation&&(e.workLocationId=null),
teasp.manager.request("inputTimeTable",e,this.pouch,{hideBusy:!0},this,function(){++o<i.length?setTimeout(s,100):t.apply(this)},a)}))())},teasp.view.Daily.prototype.reviseApplyEnter=function(e,t,a){var o=this.pouch.getEmpDay(e.startDate).getReviseTimeTable(e);teasp.manager.request("inputTimeTable",{empId:this.pouch.getEmpId(),month:this.pouch.getYearMonth(),lastModifiedDate:this.pouch.getLastModifiedDate(),
mode:this.pouch.getMode(),date:e.startDate,dayFix:!1,client:teasp.constant.APPLY_CLIENT_MONTHLY,timeTable:o,empApplyId:e.id,refreshWork:this.pouch.isInputWorkingTimeOnWorkTImeView(),useInputAccessControl:this.pouch.isInputAccessControl()},this.pouch,{hideBusy:!0},this,t,a)},teasp.view.Daily.prototype.createDateList=function(){for(var e=[],t=this.pouch.getMonthDateList(),a=0;a<t.length;a++){var o=this.pouch.getEmpDay(
t[a]),o=o.getDayType()==teasp.constant.DAY_TYPE_NORMAL_HOLIDAY||o.getDayType()==teasp.constant.DAY_TYPE_PUBLIC_HOLIDAY?teasp.constant.NORMAL_HOLIDAY_COLOR:o.getDayType()==teasp.constant.DAY_TYPE_LEGAL_HOLIDAY?teasp.constant.LEGAL_HOLIDAY_COLOR:o.isPlannedHoliday()?teasp.constant.PRIVATE_HOLIDAY_COLOR:"#FFFFFF";e.push({value:t[a],name:'<span style="background-color:'+o+';">&nbsp;'+teasp.util.date.formatDate(t[a],"JP2"
)+"&nbsp;</span>"})}var s=new dojo.data.ItemFileWriteStore({data:{identifier:"value",label:"name",items:e}});this.dateList.setStore(s,this.pouch.getParamDate(),{sort:[{attribute:"value",descending:!1}]})},teasp.view.Daily.prototype.showCalendarService=function(){var e="";switch(this.pouch.getCalAccessService()){case"GSUITE":e="ca10002020";break;case"OFFICE365":e="ca10002030";break;default:e="ca10002010"}
var t=teasp.message.getLabel(e),t=teasp.message.getLabel("schedule_label")+" "+t;dojo.byId("schedule_label").innerHTML=t},teasp.view.Daily.prototype.showCalendarStatus=function(){var e=this.pouch.getCalAuthResult(),t="";switch(e.status){case"NO_AUTH_SETTING":t=teasp.message.getLabel("ca10002101");break;case"FIELD_SETTING_INVALID":t=teasp.message.getLabel("ca10002102");break;case"EMAIL_ADDRESS_EMPTY":
t=teasp.message.getLabel("ca10002103");break;case"REMOTE_SITE_SETTINGS_INACTIVE":t=teasp.message.getLabel("ca10002104");break;case"API_CONNECTION_FAILED":t=teasp.message.getLabel("ca10002105",e.statusDetail||"");break;case"ACCOUNT_NOT_FOUND":t=teasp.message.getLabel("ca10002106");break;case"UNAUTHORIZED":t=teasp.message.getLabel("ca10002107")}t&&this.showCalendarError(t="Error: "+t)},
teasp.view.Daily.prototype.getTimeInfo=function(){var e=teasp.util.date.getToday(),t=teasp.util.date.formatDate(e),a=this.pouch.getParamDate();if(t!=a&&teasp.util.date.addDays(t,-1)!=a)return null;var a=t,t=teasp.util.date.addDays(a,-1),o=this.pouch.getEmpDay(a),s=this.pouch.getEmpDay(t),i=o.getObj(),n=s.getObj(),e=60*e.getHours()+e.getMinutes(),r=i&&"number"==typeof i.startTime?i.startTime:-1,
l=i&&"number"==typeof i.endTime?i.endTime:-1,p=n&&"number"==typeof n.startTime?n.startTime:-1,d=n&&"number"==typeof n.endTime?n.endTime:-1,c=i&&"number"==typeof i.rack.fixStartTime?i.rack.fixStartTime:-1,m=i&&"number"==typeof i.rack.fixEndTime?i.rack.fixEndTime:-1,h=i&&"number"==typeof n.rack.fixStartTime?n.rack.fixStartTime:-1,u=n&&"number"==typeof n.rack.fixEndTime?n.rack.fixEndTime:-1,g=(0===l&&(l=r=-1),0===d&&(
d=p=-1),this.pouch.getEmpMonthByDate(a)),y=this.pouch.getEmpMonthByDate(t),g=this.pouch.isEmpMonthFixed(g,!0)||o.isDailyFix(),y=this.pouch.isEmpMonthFixed(y,!0)||s.isDailyFix(),s=this.pouch.isProhibitInputTimeUntilApproved(),g=teasp.view.Widget.isWorkDay(i,s)&&i&&!g,s=teasp.view.Widget.isWorkDay(n,s)&&n&&!y,y=(g&&!this.pouch.isAlive(a)&&(g=!1),s&&!this.pouch.isAlive(t)&&(s=!1),this.pouch.isPermitStartBtnDateChange())
,o=o.getInputLimit().flag,o=this.pouch.isUseRestartable()&&!(2&o),f=this.pouch.isLeavingAcrossNextDay(),b=this.pouch.getLimitedTimeDistance(),_=!1;return f&&i&&n&&(f=n.dayType==teasp.constant.DAY_TYPE_LEGAL_HOLIDAY&&(n.workFlag||n.autoLH)?teasp.constant.DAY_TYPE_NORMAL:n.dayType,n=i.dayType==teasp.constant.DAY_TYPE_LEGAL_HOLIDAY&&(i.workFlag||i.autoLH)?teasp.constant.DAY_TYPE_NORMAL:i.dayType,(
f=f==teasp.constant.DAY_TYPE_PUBLIC_HOLIDAY?teasp.constant.DAY_TYPE_NORMAL_HOLIDAY:f)!=(n=n==teasp.constant.DAY_TYPE_PUBLIC_HOLIDAY?teasp.constant.DAY_TYPE_NORMAL_HOLIDAY:n)&&(_=!0)),teasp.view.Widget.judgePushTime(a,t,g,s,e,p,d,r,l,c,m,h,u,this.pouch.isPermitLeavingPush24hours(),y,o,b,_)},teasp.view.Daily.prototype.setPushButton=function(){var e,t,a,o;this.pouch.isOwner()&&!this.pouch.isTimeReportDedicatedToJob()&&(
e=this.pouch.getParamDate(),o=a=!1,(t=this.getTimeInfo())&&!this.pouch.isEmpMonthReadOnly()&&(e==t.tkey?(a=t.etFlag,o=t.tetFlag):e==t.pkey&&(a=t.petFlag,o=t.ptetFlag)),dojo.style("toggleWorkEnd","display","block"),a&&teasp.permitPushTime?(dojo.byId("toggleWorkEnd").className="std-button1 pp_btn_end",this.eventHandles.toggleWorkEnd||(this.eventHandles.toggleWorkEnd=dojo.connect(dojo.byId("toggleWorkEnd"),"onclick",
this,this.toggleWorkEndArea))):(dojo.byId("toggleWorkEnd").className="std-button1-disabled pp_btn_end",this.eventHandles.toggleWorkEnd&&(dojo.disconnect(this.eventHandles.toggleWorkEnd),this.eventHandles.toggleWorkEnd=null)),dojo.setAttr("buttonWorkEnd","disabled",!a),a?this.eventHandles.buttonWorkEnd||(this.eventHandles.buttonWorkEnd=dojo.connect(dojo.byId("buttonWorkEnd"),"onclick",this,this.clickEndCurrentTime)
):this.eventHandles.buttonWorkEnd&&(dojo.disconnect(this.eventHandles.buttonWorkEnd),this.eventHandles.buttonWorkEnd=null),this.pouch.isUseFixedButton()?(dojo.style("endFixedTimeRow","display",""),dojo.setAttr("buttonFixEnd","disabled",!o),o?this.eventHandles.buttonFixEnd||(this.eventHandles.buttonFixEnd=dojo.connect(dojo.byId("buttonFixEnd"),"onclick",this,this.clickEndFixedTime)):this.eventHandles.buttonFixEnd&&(
dojo.disconnect(this.eventHandles.buttonFixEnd),this.eventHandles.buttonFixEnd=null)):dojo.style("endFixedTimeRow","display","none"))},teasp.view.Daily.prototype.createEmpWorkTable=function(e,t,a){this.pouch.adjustJobWorkTimes(this.jobWorks,e);var e=dojo.query("#empWorkHead tbody")[0],o=(dojo.empty(e),dojo.create("tr",null,e)),e=(dojo.create("div",{style:{margin:"2px"},innerHTML:"#"},dojo.create("td",{
className:"sharp"},o)),dojo.create("div",{style:{margin:"2px"},innerHTML:teasp.message.getLabel("task_head")},dojo.create("td",{className:"name"+(0<this.pouch.getProgressList().length?"":"w")},o)),dojo.create("div",{style:{margin:"2px"},innerHTML:teasp.message.getLabel("tm20001130")},dojo.create("td",{className:"time"},o)),0<this.pouch.getProgressList().length&&dojo.create("div",{style:{margin:"2px"},
innerHTML:teasp.message.getLabel("tm20001140")},dojo.create("td",{className:"progress"},o)),dojo.create("td",{className:"spcr"+(0<this.pouch.getProgressList().length?"":"w")},o),dojo.query("#empWorkArea .emp_work_foot tbody")[0]),o=(dojo.empty(e),dojo.create("tr",null,e));dojo.create("div",{innerHTML:teasp.message.getLabel("total_label"),style:"margin-right:12px;"},dojo.create("td",{
style:"text-align:right;width:50%;"},o)),dojo.create("div",null,dojo.create("div",{id:"empWorkSumTime",className:"time",style:"margin-left:12px;width:56px;text-align:center;"},dojo.create("td",{style:"text-align:left;width:50%;"},o)));for(var s=0;s<this.toolTips.length;s++)dijit.byId(this.toolTips[s]).destroy(!0);this.toolTips=[];for(var i=dojo.byId("empWorkTable").getElementsByTagName("tbody")[0];i.firstChild;
)dojo.destroy(i.firstChild);for(var n=1,r=!1,l=0;l<this.jobWorks.length;l++)if((p=this.jobWorks[l]).time&&p.timeFix){r=!0;break}for(l=0;l<this.jobWorks.length;l++){var p=this.jobWorks[l],d=0<this.pouch.getProgressList().length,c=(o=dojo.create("tr",{id:"work"+p.jobId,className:l%2==0?"even":"odd"},i),this.pouch.getExtraItems(p)),m=(dojo.create("div",{className:"sharp",innerHTML:n++},dojo.create("td",{
className:"sharp",rowSpan:0<c.length?3:2},o)),p.jobName+(p.process?teasp.message.getLabel("tm10001470")+p.process:"")),m=(dojo.create("div",{className:"name",innerHTML:m},dojo.create("td",{className:"name"+(d?"":"w"),id:"workJob"+p.jobId+p.process},o)),this.convTime(p,a,t,r)),m=(dojo.create("div",{className:m.className,innerHTML:m.value},dojo.create("td",{className:"time"},o)),3);if(d&&(dojo.create("div",{
className:"progress",innerHTML:p.progress||""},dojo.create("td",{className:"progress"},o)),m++),dojo.create("td",{className:"spcr"+(d?"":"w")},o),this.setJobToolTip(p,"workJob"+p.jobId+p.process),0<c.length){o=dojo.create("tr",{className:l%2==0?"even":"odd"},i);for(var h=dojo.create("td",{className:"extraItem",colSpan:m},o),s=0;s<c.length;s++){var u=c[s];u&&(dojo.create("div",{className:"extraItem",style:{
float:"left"},innerHTML:u.name+" : "},h),u=dojo.create("div",{className:"extraItem",style:{float:"left",textAlign:"left"},innerHTML:teasp.util.entitize(u.value,"&nbsp;")},h),0==s&&c[1]&&(u.style.marginRight="10px"))}dojo.create("div",{style:{clear:"both"}},h)}o=dojo.create("tr",{className:l%2==0?"even":"odd"},i),dojo.create("div",{className:"tasknote",innerHTML:this.pouch.convNoteString(teasp.util.entitize(p.taskNote
,""))},dojo.create("td",{className:"tasknote",colSpan:m},o))}this.showStrip()},teasp.view.Daily.prototype.showStrip=function(){var e=dojo.query("#empWorkTable tbody")[0],t=dojo.byId("empWorkDiv").clientHeight,a=0<this.pouch.getProgressList().length,o=0,s=[];dojo.query("tr",e).forEach(function(e){dojo.hasClass(e,"empty")?s.push(e.rowIndex):o+=e.offsetHeight});for(var i=s.length-1;0<=i;i--)e.removeChild(e.rows[s[i]]);
for(var n=this.jobWorks.length;o<t;){var r=Math.min(25,t-o),l=dojo.create("tr",{className:(n%2==0?"even":"odd")+" empty",style:"height:"+r+"px;"},e);dojo.create("div",{innerHTML:""},dojo.create("td",{className:"sharp"},l)),dojo.create("div",{innerHTML:""},dojo.create("td",{className:"name"+(a?"":"w")},l)),dojo.create("div",{innerHTML:""},dojo.create("td",{className:"time"},l)),a&&dojo.create("div",{style:{
margin:"1px 2px"},innerHTML:""},dojo.create("td",{className:"progress"},l)),dojo.create("td",{className:"spcr"+(a?"":"w")},l),o+=r,n++}},teasp.view.Daily.prototype.setJobToolTip=function(e,t){var a='<table class="pane_table" style="font-size:12px;">',a=(a=(a=(a+='<tr><td style="padding-right:8px;">'+teasp.message.getLabel("tm20001020")+"</td><td>")+(e.jobCode||""))+(
'</td></tr><tr><td style="padding-right:8px;">'+teasp.message.getLabel("tm20001030")+"</td><td>"))+e.jobName;e.process&&e.process.length&&(a=(a+='</td></tr><tr><td style="padding-right:8px;">'+teasp.message.getLabel("tm20001040")+"</td><td>")+e.process),a=(a+='</td></tr><tr><td style="padding-right:8px;">'+teasp.message.getLabel("tm20001031")+"</td><td>")+(e.jobLeader||"")+"</td></tr></table>",new dijit.Tooltip({
connectId:t,label:a,position:["above"],id:"empWorkToolTip"+ ++this.toolTipSeq}),this.toolTips.push("empWorkToolTip"+this.toolTipSeq)},teasp.view.Daily.prototype.showWorkBalance=function(){for(var e,t=dojo.clone(this.pouch.getDayObj(this.pouch.getParamDate())),a=(this.workRealTime=0,t.rack.worked),o=(a?this.workRealTime=t.real.workRealTime:"number"==typeof t.startTime&&(e=this.pouch.getEmpDay(t.date),
this.workRealTime=e.getZanteiRealTime(teasp.util.date.getToday())||0,0<this.workRealTime&&(a=!0)),0),s=0;s<this.jobWorks.length;s++)this.jobWorks[s].timeFix&&(o+=this.jobWorks[s].time);this.createEmpWorkTable(this.workRealTime,o,a);for(var i=0,s=0;s<this.jobWorks.length;s++)i+=this.jobWorks[s].time;dojo.query("#empWorkSumTime > div")[0].innerHTML=teasp.util.time.timeValue(i),this.showDiffMarker(t,this.workRealTime,i)
},teasp.view.Daily.prototype.showDiffMarker=function(e,t,a){this.pouch.isCheckInputWorkHours()&&(t=t!=a,dojo.style("empWorkSumTime","background-color",t?"#ffc0cb":"transparent"),dojo.byId("empWorkSumTime").title=t?teasp.message.getLabel("tf10008580"):"")},teasp.view.Daily.prototype.createExpTable=function(){for(var e=dojo.byId("expTable").getElementsByTagName("tbody")[0];e.firstChild;)dojo.destroy(e.firstChild);for(
var t=this.pouch.getExpLogs(),a={},o={},s=[],i={},n=0;n<t.length;n++)(a[p=(_=t[n]).date+":"+(_.expApplyId||"")+":"+(_.jobId||"")]||(a[p]=[])).push(_),s.contains(p)||s.push(p),o.hasOwnProperty(p)||(o[p]=_.job?{name:_.job.name,code:_.job.code}:""),i.hasOwnProperty(p)||(i[p]=_.expApply||{},_.expApply&&(i[p].iconClass=this.pouch.getExpStatusIconClass(_.expApply.status)));for(var r=0,l=0,n=0;n<s.length;n++)for(var p,
t=a[p=s[n]],d=o[p],c=dojo.create("tr",{className:r%2==0?"even":"odd"},e),m=dojo.create("td",{className:"job",style:{width:"759px",height:"22px"},colSpan:"5"},c),h=dojo.create("table",{className:"contents_area d_job_table"},m),u=dojo.create("tr",null,h),g=dojo.create("td",{style:{width:"655px",paddingLeft:"4px",wordBreak:"break-all"}},u),y=(dojo.create("span",{innerHTML:(d&&d.code||"")+"  "+(d&&d.name||"")},g),
g=dojo.create("td",{style:{width:"69px",paddingLeft:"4px"}},u),i[p].iconClass&&(y=dojo.create("input",{type:"button",className:"pb_base "+i[p].iconClass,id:"empExpLotStatus"+p,title:teasp.message.getLabel("tm20001150")},g),this.eventHandles["empExpLotStatus"+p]=dojo.connect(y,"onclick",this,this.clickedExpStatus(p))),g=dojo.create("td",{style:{width:"34px",paddingLeft:"4px"}},u),dojo.create("input",{type:"button",
className:"pb_base pb_btn_pen",id:"empExpLotEdit"+p,title:teasp.message.getLabel("tm20001160")},g)),f=(this.eventHandles["empExpLotEdit"+p]=dojo.connect(y,"onclick",this,this.clickedExpLot(p)),this.getStatusSimply(i[p].iconClass)),b=0;b<t.length;b++){var _=t[b],c=dojo.create("tr",{className:r%2==0?"even":"odd"},e),v=(dojo.create("div",{innerHTML:_.no},dojo.create("td",{className:"sharp",style:{width:"25px",
height:"22px"}},c)),dojo.create("div",{innerHTML:_.expItem.name,style:{marginLeft:"4px"}},dojo.create("td",{className:"type",style:{width:"99px",height:"22px"}},c)),0==_.transportType?"":teasp.message.getLabel(_.roundTrip?"tm20009040":"tm20009060",_.startName||"",_.endName||"")),m=dojo.create("td",{className:"route",style:{width:"279px",height:"22px"}},c),h=dojo.create("table",{className:"contents_area",style:{
width:"272px",marginLeft:"4px",tableLayout:"fixed"}},m),u=dojo.create("tr",null,h),T="",j="";if(_.foreignFlag&&(E=teasp.util.currency.formatDecimal(_.currencyRate||0,teasp.constant.CU_DEC_POINT_MIN,teasp.constant.CU_DEC_POINT_MAX),k=teasp.util.currency.formatDecimal(_.foreignAmount||0,0,teasp.constant.CU_DEC_POINT_MAX,!0),T=teasp.message.getLabel("tm20001170",_.currencyName,E.str,k.str)),_.taxFlag){var E="",L="";
switch(_.taxAuto||(E=teasp.message.getLabel("tm20001200")),_.taxType){case"1":L=teasp.message.getLabel("tm20001210");break;case"2":L=teasp.message.getLabel("tm20001220");break;case"0":L=teasp.message.getLabel("tm20001230")}j=L+" : "+teasp.util.currency.formatMoney(_.tax,"&#165;#,##0")+E}var k="",D=(_.useExtraItem1&&(k=(k+='<span style="white-space: nowrap;">'+_.expItem.extraItem1Name+":</span>")+_.extraItem1+"<br />"
),_.useExtraItem2&&(k=(k+='<span style="white-space: nowrap;">'+_.expItem.extraItem2Name+":</span>")+_.extraItem2),new Array);0<v.length&&D.push(v),0<T.length&&D.push('<span style="font-size:90%;">'+T+"</span>"),0<j.length&&D.push('<span style="font-size:90%;">'+j+"</span>"),0<k.length&&D.push(k);for(var I=0;I<D.length||0==I;I++){var A,S="";0<D.length&&(S=D[I]),0==I?(g=dojo.create("td",{style:{width:"228px",
wordWrap:"break-word"},innerHTML:S},u),g=dojo.create("td",{style:{width:"44px",textAlign:"right"}},u),_.icInfo?dojo.create("div",{className:"pp_base pp_ico_ic",style:{float:_.receipt?"left":"right"}},g):1==_.transportType&&(A=dojo.create("div",{className:"pp_base pp_ico_ekitan",title:teasp.message.getLabel("showEkitanRoute_title"),style:{float:_.receipt?"left":"right"}},g),
this.eventHandles["empExpRoute"+n+"-"+b]=dojo.connect(A,"onclick",this,this.clickedExpRoute(_.route))),_.receipt&&(A=dojo.create("div",{className:_.attachments?"pp_base pp_btn_receipt_i":"pp_base pp_btn_receipt",style:{marginLeft:"2px",float:"right",cursor:f||_.attachments?"pointer":""},title:_.attachments?teasp.message.getLabel("attachedReceipt"):teasp.message.getLabel("nonReceipt")},g),
f?this.eventHandles["empExpReceipt"+n+"-"+b]=dojo.connect(A,"onclick",this,function(){var e=_;return function(){this.openEmpAttachReceipt(!0,e)}}()):_.attachments&&(this.eventHandles["empExpReceipt"+n+"-"+b]=dojo.connect(A,"onclick",this,function(){var e=_;return function(){this.openEmpAttachReceipt(!1,e)}}())))):(u=dojo.create("tr",null,h),dojo.create("td",{colspan:2,style:{width:"272px",wordWrap:"break-word"},
innerHTML:D[I]},u))}dojo.create("div",{innerHTML:teasp.util.currency.formatMoney(_.cost,"&#165;#,##0"),style:{marginRight:"4px"}},dojo.create("td",{className:"cost",style:{width:"89px",height:"22px"}},c)),dojo.create("div",{innerHTML:_.detail||"",style:{marginLeft:"4px",wordBreak:"break-all"}},dojo.create("td",{className:"detail",style:{width:"262px",height:"22px"}},c)),l+=_.cost,r++}for(;e.offsetHeight<150&&r<6;
)c=dojo.create("tr",{className:r%2==0?"even":"odd"},e),dojo.create("td",{className:"sharp",style:{width:"25px",height:"22px"}},c),dojo.create("td",{className:"type",style:{width:"99px",height:"22px"}},c),dojo.create("td",{className:"route",style:{width:"279px",height:"22px"}},c),dojo.create("td",{className:"cost",style:{width:"89px",height:"22px"}},c),dojo.create("td",{className:"detail",style:{width:"262px",
height:"22px"}},c),r++;dojo.byId("expFootCost").innerHTML=teasp.util.currency.formatMoney(l,"&#165;#,##0",!0)},teasp.view.Daily.prototype.createTimeGraph=function(){this.graph||(this.graph=new teasp.helper.Graph({areaWidth:dojo.byId("empWorkGraph").offsetWidth,widthPerH:24,startY:24,sizeType:"middle",edgeMark:!0,movable:!1,clickedApply:this.openEmpApply,hideTimeGraphPopup:this.pouch.isHideTimeGraphPopup(),that:this})
),this.graph.clear(),this.graph.draw(this.pouch,"empWorkGraph",[this.pouch.getEmpDay(this.pouch.getParamDate()).getObj()]),this.setCurrentTimeBar()},teasp.view.Daily.prototype.toggleWorkEndArea=function(){var e,t,a=0==dojo.byId("commentArea").clientHeight;a&&(e=dojo.byId("endComment")).value==this.COMMENT_QUEST&&0<(t=dojo.byId("empWorkNote").value.trim()).length&&(e.value=990<t.length?t.substring(0,990):t,dojo.style(
e,"color","#222222")),this.openCommentArea(a)},teasp.view.Daily.prototype.openCommentArea=function(e){this.showError(null);var t=this.pouch.isUseWorkLocation()?98:90;dojo.animateProperty({node:"commentArea",properties:{height:e?{end:t,start:0}:{end:0,start:t}},duration:1e3}).play()},teasp.view.Daily.prototype.clearComment=function(){var e=dojo.byId("endComment");e.value=this.COMMENT_QUEST,dojo.style(e,"color",
this.COMMENT_QUEST_COLOR)},teasp.view.Daily.prototype.changePrevDate=function(){return this.changeDate(teasp.util.date.addDays(this.pouch.getParamDate(),-1))},teasp.view.Daily.prototype.changeCurrDate=function(){return this.changeDate(teasp.util.date.getToday())},teasp.view.Daily.prototype.changeNextDate=function(){return this.changeDate(teasp.util.date.addDays(this.pouch.getParamDate(),1))},
teasp.view.Daily.prototype.changedDateSelect=function(){var e=this.dateList.getValue();return e!=this.pouch.getParamDate()&&this.changeDate(teasp.util.date.parseDate(e))},teasp.view.Daily.prototype.changeByCalendar=function(){var e=this.dateList.getValue();teasp.manager.dialogOpen("Calendar",{date:teasp.util.date.parseDate(e),isDisabledDateFunc:function(e){return!1}},null,this,function(e){this.changeDate(e)})},
teasp.view.Daily.prototype.changeDate=function(e,t){var a=this.pouch.getParamDate();return(t||0!=teasp.util.date.compareDate(e,a))&&(dojo.style("commentArea","height","0px"),dojo.style("timeReportContents","margin-top","0px"),document.body.style.cursor="wait",teasp.manager.request("transEmpDay",{empId:this.pouch.getEmpId(),date:teasp.util.date.formatDate(e)},this.pouch,{hideBusy:!1},this,function(){this.refreshDaily(
!0),document.body.style.cursor="default"},function(e){document.body.style.cursor="default",teasp.message.alertError(e)})),!1},teasp.view.Daily.prototype.openInputTime=function(){var a={date:this.pouch.getParamDate(),client:teasp.constant.APPLY_CLIENT_DAILY};this.pouch.checkEmpMonthHook(dojo.hitch(this,function(e,t){e?teasp.manager.dialogOpen("InputTime",a,this.pouch,this,this.refreshDaily):teasp.tsAlert(
teasp.message.getErrorMessage(t),this)}))},teasp.view.Daily.prototype.openEditTime=function(){var e={date:this.pouch.getParamDate()};teasp.manager.dialogOpen("EditTime",e,this.pouch,this,this.refreshDaily)},teasp.view.Daily.prototype.openEmpApply=function(s,e){var i={date:s,applyId:e||null,client:teasp.constant.APPLY_CLIENT_DAILY};return dojo.hitch(this,function(e){e.preventDefault(),e.stopPropagation(),
this.pouch.checkEmpMonthHook(dojo.hitch(this,function(e,t){var a,o;e?(a=dojo.hitch(this,function(){teasp.manager.dialogOpen("EmpApply",i,this.pouch,this,this.refreshDaily)}),o=this.pouch.getEmpDay(s),this.pouch.getObj().dayMap?0<o.getEmpApplyList("ALL").length?teasp.manager.request("getEmpDayApplySteps",{empId:this.pouch.getEmpId(),date:s},this.pouch,{hideBusy:!1},this,function(e){o.setEmpApplySteps(e.steps,e.items),
a()},function(e){teasp.message.alertError(e)}):a():teasp.manager.request("loadEmpMonthDelay",{empId:this.pouch.getEmpId(),date:s},this.pouch,{hideBusy:!1},this,function(e){o.setEmpApplySteps(e.steps,e.items),a()},function(e){teasp.message.alertError(e)})):teasp.tsAlert(teasp.message.getErrorMessage(t),this)}))})},teasp.view.Daily.prototype.openEmpWorkImp=function(){this.helperSche.import(dojo.hitch(this,
this.openEmpWorkDialog),this.helperTxsLog)},teasp.view.Daily.prototype.openEmpWork=function(){this.openEmpWorkDialog(dojo.clone(this.pouch.getClassifyJobWorks(this.pouch.getParamDate())))},teasp.view.Daily.prototype.openEmpWorkDialog=function(e,t){var a,s=this.pouch.getParamDate(),o=this.pouch.getEmpDay(s),i=o.getDaySubTimeByKey("workRealTime",!0,0,0,teasp.constant.C_REAL),n=o.getWorkNote(),r=!1;i||(
a=o.getZanteiRealTime(teasp.util.date.getToday()))&&(r=!0,i=a),teasp.manager.dialogOpen("WorkBalance",{date:s,jobMonth:this.pouch.getJobYearMonth(),classifyJobWorks:dojo.clone(e),workRealTime:i,worked:o.isWorked(),workNote:n,zanteiFlag:r,reflectWorkOption:this.reflectWorkOption,thisObject:this,monthFix:o.isMonthFix(),dayFix:o.isDailyFix(),client:teasp.constant.APPLY_CLIENT_DAILY,scheduleImport:t||!1,
reflectJobAssign:dojo.hitch(this,this.reflectTsfJobAssign)},this.pouch,this,function(e,t,a){var o=this.pouch.getClassifyJobWorks(s);this.reflectTsfJobAssign(o),this.jobWorks=this.pouch.getJobWorks(o),a||(dojo.byId("empWorkNote").value=t),this.showWorkBalance()})},teasp.view.Daily.prototype.reflectTsfJobAssign=function(e){if(tsfManager&&tsfManager.info&&tsfManager.info.targetEmp){
var t=tsfManager.info.targetEmp.jobAssigns;(t=t||(tsfManager.info.targetEmp.jobAssigns=[])).splice(0,t.length);for(var a=(e.assignWorks||[]).concat(e.recordWorks||[]).concat(e.assignJobs||[]),o={},s=0;s<a.length;s++){var i=a[s];o[i.jobId]||(t.push(new teasp.Tsf.Job({Id:i.jobId,JobCode__c:i.jobCode,Name:i.jobName,IsAssigned__c:i.isAssigned,JobAssignId:i.jobAssign&&i.jobAssign.id||null,StartDate__c:i.startDate,
EndDate__c:i.endDate,Active__c:!0})),o[i.jobId]=1)}}},teasp.view.Daily.prototype.reflectWorkOption=function(){var e;dojo.query(".emp_work_note_area").forEach(function(e){dojo.style(e,"display",this.pouch.getWorkNoteOption()?"":"none")},this),this.pouch.isTimeReportDedicatedToJob()?dojo.style("empWorkDiv","height",this.pouch.getWorkNoteOption()?"275px":"392px"):(e=(this.pouch.getWorkNoteOption()?183:300)-(
this.pouch.isUseWorkLocation()?27:0),dojo.style("empWorkDiv","height",e+"px")),this.showStrip()},teasp.view.Daily.prototype.clickedExpLot=function(e){var t=e;return function(){this.openDialogEmpExp(t)}},teasp.view.Daily.prototype.clickedExpStatus=function(e){var t=e;return function(){var e=t.split(":");teasp.locationHref(teasp.getPageUrl("empExpView")+"?empId="+this.pouch.getEmpId(
)+"&expApplyId="+e[1]+"&mode="+this.pouch.getMode())}},teasp.view.Daily.prototype.clickedExpRoute=function(e){var t=e;return function(){""==t?teasp.tsAlert(teasp.message.getLabel("tm20001260"),this):teasp.manager.dialogOpen("ExpRoute",{routeInfo:t},this.pouch,this,function(e){})}},teasp.view.Daily.prototype.openEmpAttachReceipt=function(e,t){var t=t.id,a="",a=e?teasp.getPageUrl("expImageView"
)+"?expLogId="+t+"&mode=edit&openerObj=view":teasp.getPageUrl("expImageView")+"?expLogId="+t+"&mode=view&openerObj=view",o=screen.availHeight||800,s=(800<o&&(o=800),window.open(a,"attachments","width=800,height="+o+",resizable=yes,scrollbars=yes"));setTimeout(function(){s.resizeTo(810,o)},100)},teasp.view.Daily.prototype.openDialogEmpExp=function(e){var t=this;teasp.manager.completeCheck(function(){
teasp.manager.dialogOpen("EmpExp",{tagKey:e,date:t.pouch.getParamDate(),openerClass:"Daily"},t.pouch,t,t.refreshDaily)})},teasp.view.Daily.prototype.clickEndCurrentTime=function(){this.pushTimeStep1(!1)},teasp.view.Daily.prototype.clickEndFixedTime=function(){this.pushTimeStep1(!0)},teasp.view.Daily.prototype.showBusyWait=function(){teasp.manager.dialogOpen("BusyWait2",{message:teasp.message.getLabel("tm20001310"),
nomove:!0},this.pouch)},teasp.view.Daily.prototype.pushTimeStep1=function(e){var t={flag:e,prevFlag:!1,et:null,stdStartTime:-1,stdEndTime:-1,dayFix:!1,comment:dojo.byId("endComment").value.trim()};if(t.comment==this.COMMENT_QUEST&&(t.comment=""),990<t.comment.length)this.showError(teasp.message.getLabel("tm20001270"));else{var e=this.pouch.getParamDate(),a=this.getTimeInfo();if(a&&!this.pouch.isEmpMonthReadOnly()&&(
e==a.tkey?(t.et=t.flag?a.stdEndTime:a.tTime,t.stdStartTime=a.stdStartTime,t.stdEndTime=a.stdEndTime):e==a.pkey&&(t.et=t.flag?a.pstdEndTime:a.pTime,t.prevFlag=!0,t.stdStartTime=a.pstdStartTime,t.stdEndTime=a.pstdEndTime)),null!==t.et){var a=this.pouch.getEmpDay(e),o=a.getStartTime(!0,null,teasp.constant.C_REAL),s=a.getInputTimeRange(),i=null;if(s&&t.et>s.to&&(i=teasp.message.getLabel("tm20001280"),t.et=s.to),1440<t.et
){s=this.pouch.getEmpDay(teasp.util.date.addDays(e,1)).getProhibitOverNightWorkHoliday();if(s)return void teasp.tsAlert(teasp.message.getLabel("tf10008360",s.name),this)}if(t.dayFix=this.pouch.isUseDailyApply()&&null!==o&&dojo.byId("endAndDayFix").checked,t.dayFix&&(this.pouch.isOverTimeRequireTime()||this.pouch.isEarlyWorkRequireTime()||this.pouch.isRequiredLateStartApply()||this.pouch.isRequiredEarlyEndApply())){
s=teasp.logic.EmpTime.getWorkAndRestTime(this.pouch.getObj(),e,o,t.et,a.getObj().timeTable),e=[];if(s.missingOverTimeApply&&e.push(teasp.message.getLabel("tf10008740",teasp.message.getLabel("tm10001293"))),s.missingEarlyWorkApply&&e.push(teasp.message.getLabel("tf10008740",teasp.message.getLabel("tm10001294"))),(s.missingOverTimeApplyExist||s.missingEarlyWorkApplyExist)&&e.push(teasp.message.getLabel("tf10008760")),
s.missingLateStartApply&&e.push(teasp.message.getLabel("tf10008740",teasp.message.getLabel("applyLateStart_label"))),s.missingEarlyEndApply&&e.push(teasp.message.getLabel("tf10008740",teasp.message.getLabel("applyEarlyEnd_label"))),e.length)return e.unshift(teasp.message.getLabel("tf10008750")),void teasp.tsAlert(e.join("\n"),this)}this.showError(null),t.comment=(t.flag?teasp.message.getLabel("tm20001290"
):teasp.message.getLabel("tm20001300"))+t.comment,i?teasp.tsConfirmA(i,this,function(){this.showBusyWait(),this.pushTimeStep2(t)}):(this.showBusyWait(),this.pushTimeStep2(t))}}},teasp.view.Daily.prototype.pushTimeStep2=function(t){var a=this.token;this.pouch.isPushTimeWithLocationWeb()&&navigator.geolocation?navigator.geolocation.getCurrentPosition(dojo.hitch(this,function(e){a==this.token&&(this.token++,
this.pushTimeStep3(t,e.coords))}),dojo.hitch(this,function(e){a==this.token&&(this.token++,this.pushTimeStep3(t,null,e))}),{enableHighAccuracy:!0,timeout:3e4,maximumAge:0}):this.pushTimeStep3(t)},teasp.view.Daily.prototype.pushTimeStep3=function(e,t,a){e={empId:this.pouch.getEmpId(),month:this.pouch.getYearMonth(),lastModifiedDate:this.pouch.getLastModifiedDate(),mode:this.pouch.getMode(),
date:this.pouch.getParamDate(),dayFix:e.dayFix,client:teasp.constant.APPLY_CLIENT_DAILY,prevFlag:e.prevFlag,stdStartTime:e.stdStartTime,stdEndTime:e.stdEndTime,input:{time:e.et,face:1,type:10,fix:e.flag,comment:e.comment},device:"TSW",latitude:t?t.latitude:null,longitude:t?t.longitude:null};this.pouch.isUseWorkLocation()&&(e.input.workLocationId=this.getSelectedWorkLocationId()),teasp.manager.request("inputTime",e,
this.pouch,{hideBusy:!0},this,function(){teasp.manager.dialogClose("BusyWait2"),this.pushTimeStep4(a,dojo.hitch(this,function(){this.openCommentArea(!1);var e=dojo.byId("endComment");e.value=this.COMMENT_QUEST,dojo.style(e,"color",this.COMMENT_QUEST_COLOR),this.refreshDaily()}))},function(e){teasp.manager.dialogClose("BusyWait2"),teasp.message.alertError(e)})},teasp.view.Daily.prototype.pushTimeStep4=function(e,t){
e?(e=teasp.view.Widget.getGetLocationError(e),this.showMessage(e,t)):t()},teasp.view.Daily.prototype.showMessage=function(e,t){e.msg&&teasp.manager.dialogOpen("MessageBox",{title:e.msg,message:e.sub1+"<br/>"+e.sub2,defaultTitleColor:!0,closeOnly:!0,closeFunc:t},this.pouch,this,t)},teasp.view.Daily.prototype.clock=function(){var t=this;setInterval(function(){var e=teasp.util.date.getToday();dojo.byId("clock")&&(
dojo.byId("clock").innerHTML=e.getHours()+":"+(e.getMinutes()<10?"0":"")+e.getMinutes()),0==e.getSeconds()&&t.setPushButton()},1e3)},teasp.view.Daily.prototype.convPercent=function(e){return""+(0<e.percent?Math.round(e.percent/10):0)},teasp.view.Daily.prototype.convTime=function(e,t,a,o){var s={className:"time",value:null},i=0;return e.timeFix||t||(i=o?1:2),0==(i=e.leftover&&!e.percent?1:i
)?s.value=e.volume?teasp.util.time.timeValue(e.time||0):"-":e.time||e.volume?1==i?s.value="* *":(s.value=Math.round(e.percent/10)+"%",s.className="percent"):s.value="-",s},teasp.view.Daily.prototype.convExpCost=function(e){if(null==e.cost)return teasp.message.getLabel("tm00000107");e=teasp.util.currency.formatMoney(e.cost);return 0<e.length?"&yen;"+e:""},teasp.view.Daily.prototype.summaryExpCost=function(e){for(
var t=0,a=0;a<e.length;a++)null!=e[a].cost&&(t+=e[a].cost);var o=teasp.util.currency.formatMoney(t);return 0<o.length?"&yen;"+o:""},teasp.view.Daily.prototype.setCurrentTimeBar=function(){var e,t,a,o=teasp.util.date.getToday();teasp.util.date.formatDate(o)==this.pouch.getParamDate()?(e=dojo.byId("empWorkGraph"),(t=/\-?(\d+)px\s+\-?\d+px/.exec(e.style.backgroundPosition))&&(t={x:t=parseInt(t[1],10),leftX:t-10,
rightX:t-10+teasp.constant.GRAPH_AREA_WIDTH},o=60*o.getHours()+o.getMinutes(),t.leftX<=(o=24*o/60)&&o<t.rightX&&((a=dojo.query(".pp_v_dashbar")[0])?a.style.left=10+o-t.x+"px":dojo.create("div",{className:"pp_base pp_v_dashbar",style:{left:Math.round(10+o-t.x)+"px",top:"15px"}},e)))):0<(a=dojo.query(".pp_v_dashbar")).length&&dojo.destroy(a[0])},teasp.view.Daily.prototype.showError=function(e){dojo.style(
"timeReportErrorRow","display",e?"":"none"),dojo.byId("timeReportError").innerHTML=e||""},teasp.view.Daily.prototype.showCalendarError=function(e){dojo.style("timeAreaErrorRow","display",e?"":"none"),dojo.byId("calenderErrorMsg").innerHTML=e||""},teasp.view.Daily.prototype.appliedReceipt=function(e,t,a){var o=this.getObjectById(this.pouch.getExpLogs(),e);o&&(e={id:e},t?(o.attachments=[],o.attachments.push(e)
):o.attachments=null,"EmpExp"==a&&window.teasp.manager.dialogs[a].createBody(),this.refreshDaily())},teasp.view.Daily.prototype.getObjectById=function(e,t){for(var a=0;a<e.length;a++)if(e[a].id==t)return e[a];return null},teasp.view.Daily.prototype.getStatusSimply=function(e){switch(e){case"pb_status_noapp_dis":case"pb_status_rejct":return!0;case"pb_status_aprv":case"pb_status_wait":return!1;default:return!0}},
teasp.view.Daily.prototype.resizeArea=function(){try{this.helperSche&&this.helperSche.onresize()}catch(e){}},teasp.view.Daily.prototype.createWorkLocationArea=function(){dojo.byId("endWorkLocationLabel").innerHTML=teasp.message.getLabel("tw00000010"),dojo.byId("empWorkLocation").innerHTML=teasp.message.getLabel("tw00000010")},teasp.view.Daily.prototype.setWorkLocationSelect=function(t){var e="workLocationSelect";
this.eventHandles.hasOwnProperty(e)&&(dojo.disconnect(this.eventHandles[e]),delete this.eventHandles[e]);const a=dojo.byId("endWorkLocationSelect");if(dojo.empty(a),this.pouch.isUseWorkLocation()){var o=t.getWorkLocationId(),s=!1;if(dojo.create("option",{value:"",innerHTML:""},a),dojo.forEach(this.pouch.getWorkLocations(),function(e){dojo.create("option",{value:e.getId(),innerHTML:e.getName()},a),o&&o==e.getId()&&(
s=!0)},this),s)a.value=o;else{const i=this.pouch.getDefaultWorkLocation();i&&(a.value=i.getId())}this.eventHandles[e]=dojo.connect(a,"change",this,function(e){this.controlDayFix(t)})}},teasp.view.Daily.prototype.setWorkLocationOnOff=function(){var e;this.pouch.isTimeReportDedicatedToJob()?dojo.style("empWorkDiv","height",this.pouch.getWorkNoteOption()?"275px":"392px"):(e=this.pouch.isUseWorkLocation(),dojo.style(
"endWorkLocationArea","display",e?"":"none"),dojo.style("empWorkLocationArea","display",e?"":"none"),dojo.toggleClass("endCommentArea","comment-area",!e),dojo.toggleClass("endCommentArea","comment-area2",e),dojo.toggleClass("endAndDayFixRow","plus_top2",e),dojo.toggleClass("endWorkLocationSelect","english",teasp.isEnglish()),e=(this.pouch.getWorkNoteOption()?183:300)-(e?27:0),dojo.style("empWorkDiv","height",e+"px"))
},teasp.view.Daily.prototype.setWorkLocation=function(e,t){this.setWorkLocationOnOff(),this.setWorkLocationSelect(e),t&&(e.isInputTime()||e.isInputable())?dojo.byId("workLocationValue").innerHTML=e.getWorkLocationName():dojo.byId("workLocationValue").innerHTML=""},teasp.view.Daily.prototype.getSelectedWorkLocationId=function(){return dojo.byId("endWorkLocationSelect").value||null},
teasp.view.Daily.prototype.showDayFixButton=function(e){var t,a,o="dayLock";this.eventHandles.hasOwnProperty(o)&&(dojo.disconnect(this.eventHandles[o]),delete this.eventHandles[o]),this.pouch.isAlive(e.getKey())&&(t=dojo.byId("dayLock"),(a=e.getEmpApplyByKey(teasp.constant.APPLY_KEY_DAILY))?(t.className="ts-status-img ts-ap_day"+teasp.constant.getStatusStyleSuffix(e.getApplyStatus(teasp.constant.APPLY_KEY_DAILY)),
t.style.cursor="pointer",t.title=teasp.message.getLabel("tm10001690")+teasp.message.getLabel("tm10001680",teasp.constant.getDisplayStatus(e.getApplyStatus(teasp.constant.APPLY_KEY_DAILY))),this.eventHandles[o]=dojo.connect(t,"onclick",this,this.openEmpApply(e.getKey(),a.id))):(t.className="",t.title=""))},teasp.view.Daily.prototype.controlDayFix=function(e){var t=e.getObj(),a=!1,o=(this.workRealTime=0,
this.pouch.isAlive(e.getKey())&&(t.rack.worked?this.workRealTime=t.real.workRealTime:"number"==typeof t.startTime&&(t=dojo.clone(t),o=teasp.util.date.getToday(),t.endTime=60*o.getHours()+o.getMinutes(),teasp.action.contact.recalcOneDay(this.pouch,t),this.workRealTime=t.real.workRealTime,a=!this.pouch.isRequireWorkLocation()||!!dojo.byId("endWorkLocationSelect").value)),e.canSelectDailyEx(2));a&&!o.flag&&(a=!1),
this.pouch.isCheckDefaultDailyFix()&&a?dojo.byId("endAndDayFix").checked=!0:a||(dojo.byId("endAndDayFix").checked=!1),dojo.byId("endAndDayFix").disabled=!a,dojo.style("endAndDayFixLabel","color",a?"#222222":"#cccccc")},teasp.provide("teasp.view.EmpConfig"),teasp.view.EmpConfig=function(){this.today=teasp.util.date.getToday()},teasp.view.EmpConfig.prototype=new teasp.view.Base,
teasp.view.EmpConfig.prototype.init=function(e,t,a){teasp.message.mergeLabels(globalMessages||{}),teasp.message.mergeLabels(e&&e[teasp.message.getLanguageLocaleKey()]||{}),this.readParams({target:"empMonth"}),(this.viewParams.narrow||teasp.isMobile())&&dojo.query("td.buttons").forEach(function(e){dojo.style(e,"display","none")}),teasp.isAndroid()&&(dojo.style("areaBody","padding-right","70px"),dojo.style("areaBody",
"padding-bottom","100px")),teasp.manager.request("loadEmpConfig",this.viewParams,this.pouch,{hideBusy:!0},this,function(){this.displayValue(),t()},function(e){a(e)})},teasp.view.EmpConfig.prototype.displayValue=function(){this.displayValue1(),this.displayValue2(),this.displayValue3(),this.displayValue4(),this.displayValue5(),this.createPatternTable(this.pouch.getPatternObjs(),"patternArea"),this.createHolidayTable(
this.pouch.getHolidayObjs(),"holidayArea"),dojo.style("empViewInputFlagRow","display",this.pouch.isPermitDeptFixWoMonthFix()?"":"none"),dojo.style("empViewAccFlagRow","display",this.pouch.isInputAccessControlValid()?"":"none"),dojo.query(".empInfo_table").forEach(function(e){if(e.rows)for(var t=0,a=0;a<e.rows.length;a++){var o=e.rows[a];"none"!=o.style.display&&(o.className=t++%2==0?"even":"odd")}})},
teasp.view.EmpConfig.prototype.displayValue1=function(){dojo.byId("configPrint").firstChild.innerHTML=teasp.message.getLabel("printOut_btn_title"),dojo.connect(dojo.byId("configPrint"),"onclick",function(){return window.print(),!1}),dojo.byId("configClose").firstChild.innerHTML=teasp.message.getLabel("close_btn_title"),dojo.connect(dojo.byId("configClose"),"onclick",function(){return(window.open("","_top").opener=top
).close(),!1});try{var e=document.getElementsByTagName("title");e&&0<e.length&&(e[0].innerHTML=teasp.message.getLabel("tm10010010",this.pouch.getName()))}catch(e){}},teasp.view.EmpConfig.prototype.displayValue2=function(){dojo.byId("empViewEmpSect").innerHTML=teasp.message.getLabel("tm10010640"),dojo.byId("empViewEmpCodeH").innerHTML=teasp.message.getLabel("tk10000068"),dojo.byId("empViewEmpNameH"
).innerHTML=teasp.message.getLabel("empName_label"),dojo.byId("empViewDeptCodeH").innerHTML=teasp.message.getLabel("tk10000069"),dojo.byId("empViewDeptNameH").innerHTML=teasp.message.getLabel("dept_label"),dojo.byId("empViewEmpTypeH").innerHTML=teasp.message.getLabel("empType_label"),dojo.byId("empViewAccFlagH").innerHTML=teasp.message.getLabel("ac00000580"),dojo.byId("empViewTitleH"
).innerHTML=teasp.message.getLabel("title_label"),dojo.byId("empViewManagerH").innerHTML=teasp.message.getLabel("empManager_label"),dojo.byId("empViewUserNameH").innerHTML=teasp.message.getLabel("empUser_label"),dojo.byId("empViewEntryDateH").innerHTML=teasp.message.getLabel("empEntryDate_label"),dojo.byId("empViewInputFlagH").innerHTML=teasp.message.getLabel("empInputFlag_label"),dojo.byId("empViewEndDateH"
).innerHTML=teasp.message.getLabel("tk10000375"),dojo.byId("empViewEkitanH").innerHTML=teasp.message.getLabel("ekitanSetting_caption"),dojo.byId("empViewConfSect").innerHTML=teasp.message.getLabel("tm10010660"),dojo.byId("empViewConfGeneH").innerHTML=teasp.message.getLabel("confGene_label"),dojo.byId("empViewConfWorkSysH").innerHTML=teasp.message.getLabel("confStyle_label"),dojo.byId("empViewConfHolyH"
).innerHTML=teasp.message.getLabel("confHoliday_label"),dojo.byId("empViewFlexTimeH").innerHTML=teasp.message.getLabel("tm10010690"),dojo.byId("empViewConfStdPatternH").innerHTML=teasp.message.getLabel("confStartEnd_label"),dojo.byId("empViewConfStartH").innerHTML=teasp.message.getLabel("confStartDate_label"),dojo.byId("empViewConfLegalH").innerHTML=teasp.message.getLabel("confLegalTime_label"),dojo.byId(
"empViewConfLegalRestH").innerHTML=teasp.message.getLabel("tm10010740"),dojo.byId("empViewConfHolidayWorkH").innerHTML=teasp.message.getLabel("applyHolidayWork_label"),dojo.byId("empViewConfZangyoH").innerHTML=teasp.message.getLabel("applyZangyo_label"),dojo.byId("empViewConfEarlyWorkH").innerHTML=teasp.message.getLabel("applyEarlyWork_label"),dojo.byId("empViewConfLateStartH").innerHTML=teasp.message.getLabel(
"applyLateStart_label"),dojo.byId("empViewConfEarlyEndH").innerHTML=teasp.message.getLabel("applyEarlyEnd_label"),dojo.byId("empViewConfExchangeH").innerHTML=teasp.message.getLabel("applyExchange_label"),dojo.byId("empViewConfPatternH").innerHTML=teasp.message.getLabel("applyPatternS_label"),dojo.byId("empViewConfDirectH").innerHTML=teasp.message.getLabel("tk10004650"),dojo.byId("empViewConfReviseH"
).innerHTML=teasp.message.getLabel("applyReviseTime_label"),dojo.byId("empViewConfDailyH").innerHTML=teasp.message.getLabel("applyDailys_label"),dojo.byId("empViewConfWorkFlowH").innerHTML=teasp.message.getLabel("confWorkFlow_label"),dojo.byId("empViewConfFormH").innerHTML=teasp.message.getLabel("confAssistFormat_label"),dojo.byId("empViewPermitUpdateH").innerHTML=teasp.message.getLabel("tk10004420"),dojo.byId(
"empViewConfDaiqSect").innerHTML=teasp.message.getLabel("tm10010661"),dojo.byId("empViewConfDaiqManageH").innerHTML=teasp.message.getLabel("tm10010910"),dojo.byId("empViewConfDaiqHalfH").innerHTML=teasp.message.getLabel("tm10010920"),dojo.byId("empViewConfDaiqableH").innerHTML=teasp.message.getLabel("tm10010930"),dojo.byId("empViewConfDaiqLimitH").innerHTML=teasp.message.getLabel("tm10010940"),dojo.byId(
"empViewConfHolyWorkH").innerHTML=teasp.message.getLabel("tm10010950"),dojo.byId("empViewPatternSect").innerHTML=teasp.message.getLabel("tm10010670"),dojo.byId("empViewHolidaySect").innerHTML=teasp.message.getLabel("tm10010680")},teasp.view.EmpConfig.prototype.displayValue3=function(){dojo.byId("empViewEmpCode").innerHTML=this.pouch.getEmpCode(),dojo.byId("empViewEmpName").innerHTML=this.pouch.getName(),dojo.byId(
"empViewDeptCode").innerHTML=this.pouch.getDeptCode(),dojo.byId("empViewDeptName").innerHTML=this.pouch.getDeptName(),dojo.byId("empViewEmpType").innerHTML=this.pouch.getEmpTypeName(),dojo.byId("empViewTitle").innerHTML=this.pouch.getTitle(),dojo.byId("empViewManager").innerHTML=this.pouch.getManagerName(),dojo.byId("empViewUserName").innerHTML=this.pouch.getUserName(),dojo.byId("empViewEntryDate"
).innerHTML=teasp.util.date.formatDate(this.pouch.getEntryDate(),"SLA"),dojo.byId("empViewInputFlag").innerHTML=teasp.constant.getInputFlagName(this.pouch.getInputFlag()),dojo.byId("empViewAccFlag").innerHTML=this.pouch.getInputAccessControlStr();var e,t=this.pouch.getEndDate();dojo.byId("empViewEndDate").innerHTML=teasp.util.date.formatDate(t,"SLA"),dojo.query(".end_date").forEach(function(e){dojo.style(e,"display",
t?"":"none")},this),dojo.query(".ekitan_setting").forEach(function(e){dojo.style(e,"display",!this.pouch.isDisabledEmpExp()&&this.pouch.isUseEkitan()?"":"none")},this),!this.pouch.isDisabledEmpExp()&&this.pouch.isUseEkitan()&&(e=this.pouch.getExpConfig(),dojo.byId("empViewEkitan").innerHTML=teasp.message.getLabel("tm10010970",teasp.message.getLabel("area_label"),teasp.constant.getEkitanAreas(this.pouch.getEkitanArea(
)).name,teasp.message.getLabel("paidExpress_label"),teasp.message.getLabel(e&&e.usePaidExpress?"paidExpressYes_label":"paidExpressNo_label"),teasp.message.getLabel("reservedSheet_label"),teasp.message.getLabel(e&&e.useReservedSheet?"reservedSheetYes_label":"reservedSheetNo_label"),teasp.message.getLabel("preferredAirLine_label"),teasp.constant.getPreferredAirLine(e&&e.preferredAirLine||0).name,teasp.message.getLabel(
"routePreference_label"),teasp.constant.getRoutePreference(e&&e.routePreference||0).name,teasp.message.getLabel("excludeCommuter_label"),teasp.constant.getExcludeCommuterRoute(e&&e.excludeCommuterRoute||!1).name,teasp.message.getLabel("commuterRoute_label"),this.pouch.getCommuterRouteNote()))},teasp.view.EmpConfig.prototype.displayValue4=function(){for(var e=this.pouch.getConfigObj(),t=this.pouch.getCommonObj(),a=(
c=e.validStartMonth&&e.validEndMonth?teasp.message.getLabel("tm10010020",teasp.util.date.formatMonth("zv00000020",Math.floor(e.validStartMonth/100),e.validStartMonth%100),teasp.util.date.formatMonth("zv00000020",Math.floor(e.validEndMonth/100),e.validEndMonth%100)):e.validStartMonth?teasp.message.getLabel("tm10010030",teasp.util.date.formatMonth("zv00000020",Math.floor(e.validStartMonth/100),e.validStartMonth%100)
):e.validEndMonth?teasp.message.getLabel("tm10010040",teasp.util.date.formatMonth("zv00000020",Math.floor(e.validEndMonth/100),e.validEndMonth%100)):teasp.message.getLabel("tm10010050"),dojo.byId("empViewConfGene").innerHTML=e.generation+"("+c+")",c=e.workSystem==teasp.constant.WORK_SYSTEM_FLEX?teasp.message.getLabel("tm10010061",teasp.message.getLabel("tm10010100",1<e.variablePeriod?e.variablePeriod:1)
):e.workSystem==teasp.constant.WORK_SYSTEM_MUTATE?(m=0==e.variablePeriod?teasp.message.getLabel("tm10009020"):12==e.variablePeriod?teasp.message.getLabel("tm10009030"):teasp.message.getLabel("tm10010100",e.variablePeriod),teasp.message.getLabel("tm10010070",m)):e.workSystem==teasp.constant.WORK_SYSTEM_MANAGER?teasp.message.getLabel("tm10010080"):teasp.message.getLabel("tm10010090"),dojo.byId("empViewConfWorkSys"
).innerHTML=c,(e.holidays||"")+"0000000"),o=[],s=[],i=0;i<a.length;i++){var n=a.substring(i,i+1);"0"!=n&&o.push(i),"2"==n&&s.push(i)}0<o.length?(a=teasp.util.date.getWeekJpByNumArray(o),0<s.length?a+=teasp.message.getLabel("tm10010631",teasp.util.date.getWeekJpByNumArray(s)):"number"==typeof e.defaultLegalHoliday&&(a+=teasp.message.getLabel("tk10004900",teasp.util.date.getWeekJpByNumArray([e.defaultLegalHoliday])))
):a=teasp.message.getLabel("tm10010150"),dojo.byId("empViewConfHoly").innerHTML=a,dojo.byId("empViewConfHoly2").innerHTML=teasp.message.getLabel("tm20009140",teasp.message.getLabel("tk10000529"),teasp.message.getLabel(this.pouch.isAutoLegalHoliday()?"tm10010590":"tm10010600")),dojo.byId("empViewConfHoly3").innerHTML=teasp.message.getLabel("tm20009140",teasp.message.getLabel("tk10000265"),teasp.message.getLabel(
this.pouch.isNonPublicHoliday()?"tk10001147":"tk10001146")),e.workSystem==teasp.constant.WORK_SYSTEM_FLEX?(dojo.style("empInfoRowFlex","display",""),c='<table border="0" cellpadding="0" cellspacing="0">',c=(c=(c+='<tr><td class="empInfo_scol1"><div>'+teasp.message.getLabel("tm10010120")+"</div></td>")+"<td><div>"+this.displayTimeRange(e.flexStartTime,e.flexEndTime)+"</div></td></tr>"
)+'<tr><td class="empInfo_scol1"><div>'+teasp.message.getLabel("tm10010130")+"</div></td>",e.useCoreTime?c+="<td><div>"+this.displayTimeRange(e.coreStartTime,e.coreEndTime)+"</div></td></tr>":c+="<td><div>"+teasp.message.getLabel("tm10010150")+"</div></td></tr>",c=(c+='<tr><td class="empInfo_scol1"><div>'+teasp.message.getLabel("tm10010160")+"</div></td>")+"<td><div>"+this.pouch.getMonthSubTimeByKey("workFixedTime"
)+"</div></td></tr></table>",dojo.byId("empViewFlexTime").innerHTML=c):dojo.style("empInfoRowFlex","display","none");var r,l,p,d,c,m=e.defaultPattern;c='<table border="0" cellpadding="0" cellspacing="0">',c=(c=(c+='<tr><td class="empInfo_scol1"><div>'+teasp.message.getLabel("tm10010170")+"</div></td>")+"<td><div>"+teasp.message.getLabel("tm10010460",teasp.util.time.timeValue(m.stdStartTime),teasp.util.time.timeValue(
m.stdEndTime))+"</div></td></tr>")+'<tr><td class="empInfo_scol1"><div>'+teasp.message.getLabel("restTime_label")+"</div></td><td><div>",m.restTimes&&(c+=teasp.view.EmpConfig.getRestTimes(m.restTimes)),c=(c=(c=(c=(c+="</div></td></tr>")+'<tr><td class="empInfo_scol1"><div>'+teasp.message.getLabel("fixTimeOfDay_label")+"</div></td>")+"<td><div>"+teasp.util.time.timeValue(e.standardFixTime)+"</div></td></tr>"
)+'<tr><td class="empInfo_scol1"><div>'+teasp.message.getLabel("tm10010190")+"</div></td>")+"<td><div>"+teasp.message.getLabel(m.useHalfHoliday?"tm10010200":"tm10010210")+"</div></td></tr>",m.useHalfHoliday&&(c=(c=(c=(c+='<tr><td class="empInfo_scol1"><div>'+teasp.message.getLabel("tm10010220")+"</div></td>")+"<td><div>"+teasp.message.getLabel("tm10010230",teasp.util.time.timeValue(m.amHolidayStartTime),
teasp.util.time.timeValue(m.amHolidayEndTime),teasp.util.time.timeValue(m.pmHolidayStartTime),teasp.util.time.timeValue(m.pmHolidayEndTime))+"</div></td></tr>")+'<tr><td class="empInfo_scol1"><div>'+teasp.message.getLabel("tf10009700")+"</div></td>")+"<td><div>"+teasp.message.getLabel(m.useHalfHolidayRestTime?"tf10009710":"tf10009711")+"</div></td></tr>",m.useHalfHolidayRestTime&&(
c+='<tr><td class="empInfo_scol1"><div>'+teasp.message.getLabel("tf10009720")+"</div></td><td><div>",m.amHolidayRestTimes&&(c+=teasp.view.EmpConfig.getRestTimes(m.amHolidayRestTimes)),c=(c+="</div></td></tr>")+'<tr><td class="empInfo_scol1"><div>'+teasp.message.getLabel("tf10009730")+"</div></td><td><div>",m.pmHolidayRestTimes&&(c+=teasp.view.EmpConfig.getRestTimes(m.pmHolidayRestTimes)),c+="</div></td></tr>")),c=(
c=(c=(c=(c=(c=(c=(c+='<tr><td class="empInfo_scol1"><div>'+teasp.message.getLabel("tm10011110")+"</div></td>")+"<td><div>"+teasp.util.time.timeValue(e.baseTime)+"</div></td></tr>")+'<tr><td class="empInfo_scol1"><div>'+teasp.message.getLabel("tm10011120")+"</div></td>")+"<td><div>"+teasp.util.time.timeValue(e.baseTimeForStock)+"</div></td></tr>")+'<tr><td class="empInfo_scol1"><div>'+teasp.message.getLabel(
"nightWorkEx_label")+"</div></td>")+"<td><div>"+teasp.message.getLabel(m.igonreNightWork?"tm10010150":"tm10010140")+"</div></td></tr>")+'<tr><td class="empInfo_scol1"><div>'+teasp.message.getLabel("tm10011020")+"</div></td>")+"<td><div>"+teasp.message.getLabel(e.deductWithFixedTime?"tm10010600":"tm10010590")+"</div></td></tr>",!e.extendDayType&&"0"==e.leavingAcrossNextDay||(c+='<tr><td class="empInfo_scol1"',(
p=e.extendDayType&&"0"!=e.leavingAcrossNextDay)&&(c+=' rowSpan="2"'),c+="><div>"+teasp.message.getLabel("tk10000539")+"</div></td>",e.extendDayType&&(c+="<td><div>"+teasp.message.getLabel("tk10000540")+"</div></td>"),p&&(c+="</tr><tr>"),"0"!=e.leavingAcrossNextDay&&(c+="<td><div>"+teasp.message.getLabel("tk10003520")+"</div></td>"),c+="</tr>"),e.halfDaiqReckontoWorked&&(c=(
c+='<tr><td class="empInfo_scol1"><div>'+teasp.message.getLabel("tm10010920")+"</div></td>")+"<td><div>"+teasp.message.getLabel("tk10001148")+"</div></td></tr>"),c=(c+='<tr><td class="empInfo_scol1"><div>'+teasp.message.getLabel("tk10000541")+"</div></td>")+"<td><div>"+teasp.message.getLabel(e.pastTimeOnly?"tk10000542":"tk10001149")+"</div></td></tr>",e.highlightLateEarly&&(c=(
c+='<tr><td class="empInfo_scol1"><div>'+teasp.message.getLabel("tk10004510")+"</div></td>")+"<td><div>"+teasp.message.getLabel("tm10010590")+"</div></td></tr>"),e.prohibitInputTimeUntilApproved&&(c=(c+='<tr><td class="empInfo_scol1"><div>'+teasp.message.getLabel("tk10003490")+"</div></td>")+"<td><div>"+teasp.message.getLabel("tk10003500")+"</div></td></tr>"),e.workSystem!=teasp.constant.WORK_SYSTEM_MANAGER&&(c=(
c+='<tr><td class="empInfo_scol1"><div>'+teasp.message.getLabel("tm10010240")+"</div></td>")+"<td><div>"+teasp.message.getLabel(m.useDiscretionary?"tm10010250":"tm10010260")+"</div></td></tr>"),c+="</table>",dojo.byId("empViewConfStdPattern").innerHTML=c,dojo.byId("empViewConfStart").innerHTML='<table border="0" cellpadding="0" cellspacing="0"><tr><td class="empInfo_scol1"><div>'+teasp.message.getLabel("tm10010270"
)+"</div></td><td><div>"+teasp.message.getLabel("tm10010470",this.pouch.getInitialDateOfYear())+"</div></td><td><div>"+teasp.message.getLabel("tm10010300",teasp.message.getLabel(1==this.pouch.getMarkOfYear()?"tm10010320":"tm10010330"))+'</div></td></tr><tr><td class="empInfo_scol1"><div>'+teasp.message.getLabel("tm10010280")+"</td><td><div>"+teasp.message.getLabel("tm10010480",this.pouch.getInitialDateOfMonth()
)+"</div></td><td><div>"+teasp.message.getLabel("tm10010310",teasp.message.getLabel(1==this.pouch.getMarkOfMonth()?"tm10010340":"tm10010350"))+'</div></td></tr><tr><td class="empInfo_scol1"><div>'+teasp.message.getLabel("tm10010290")+"</div></td><td><div>"+teasp.message.getLabel("tm10010490",teasp.util.date.getWeekJp(this.pouch.getInitialDayOfWeek()))+"</div></td><td><div></div></td></tr></table>",
c='<table border="0" cellpadding="0" cellspacing="0">',c=(c+='<tr><td class="empInfo_scol1"><div>'+teasp.message.getLabel("tm10010360")+"</div></td>")+"<td><div>"+teasp.util.time.timeValue(e.legalTimeOfDay)+"</div></td></tr>",e.workSystem==teasp.constant.WORK_SYSTEM_FIX?c=(c+='<tr><td class="empInfo_scol1"><div>'+teasp.message.getLabel("tm10010370")+"</div></td>")+"<td><div>"+teasp.util.time.timeValue(
e.legalTimeOfWeek)+"</div></td></tr>":e.workSystem==teasp.constant.WORK_SYSTEM_FLEX?(l=teasp.util.searchYearMonthDate(this.pouch.getInitialDateOfMonth(),this.pouch.getMarkOfMonth(),null,this.today),r=teasp.util.date.daysInRange(l.startDate,l.endDate),d=Math.floor(r/7*e.legalTimeOfWeek),c=(c=(c+='<tr><td class="empInfo_scol1"><div>')+teasp.message.getLabel("tm10010380",teasp.util.date.formatDate(l.startDate,"M/d"),
teasp.util.date.formatDate(l.endDate,"M/d"))+"</div></td>")+"<td><div>"+teasp.util.time.timeValue(d)+"</div></td></tr>"):e.workSystem==teasp.constant.WORK_SYSTEM_MUTATE&&(l=teasp.util.searchYearMonthDate(this.pouch.getInitialDateOfMonth(),this.pouch.getMarkOfMonth(),null,this.today),c=0<e.variablePeriod?(p=teasp.util.getStartMonthOfPeriod(this.pouch.getInitialDateOfYear(),this.pouch.getMarkOfYear(),e.variablePeriod,
l.yearMonth),m=teasp.util.date.addYearMonth(p,e.variablePeriod-1),l=teasp.util.searchYearMonthDate(this.pouch.getInitialDateOfMonth(),this.pouch.getMarkOfMonth(),p,null),p=teasp.util.searchYearMonthDate(this.pouch.getInitialDateOfMonth(),this.pouch.getMarkOfMonth(),m,null),r=teasp.util.date.daysInRange(l.startDate,p.endDate),d=Math.floor(r/7*(1<e.variablePeriod?2400:e.legalTimeOfWeek)),
c+='<tr><td class="empInfo_scol1"><div>',0==e.variablePeriod?c+=teasp.message.getLabel("tm10009020"):12==e.variablePeriod?c+=teasp.message.getLabel("tm10009030"):c+=teasp.message.getLabel("tm10010100",e.variablePeriod),(c=c+teasp.message.getLabel("tm10010390",teasp.util.date.formatDate(l.startDate,"SLA"),teasp.util.date.formatDate(p.endDate,"M/d"))+"</div></td>")+"<td><div>"+teasp.util.time.timeValue(d
)+"</div></td></tr>"):(c=c+('<tr><td class="empInfo_scol1"><div>'+teasp.message.getLabel("tm10010370"))+"</div></td>")+"<td><div>"+teasp.util.time.timeValue(e.legalTimeOfWeek)+"</div></td></tr>"),c=(c+='<tr><td class="empInfo_scol1"><div>'+teasp.message.getLabel("tm10010400")+"</div></td>")+"<td><div>"+this.displayTimeRange(t.nightStartTime,t.nightEndTime)+"</div></td></tr></table>",dojo.byId("empViewConfLegal"
).innerHTML=c,dojo.byId("empViewConfLegalRest").innerHTML=function(e){var t=[];if(e)for(var a=0;a<e.length;a++)e[a].check&&(t.push(teasp.message.getLabel("tm10010750",teasp.util.time.timeValue(e[a].workTime),teasp.util.time.timeValue(e[a].restTime))),e[a].push&&t.push(teasp.message.getLabel("tm10010751",teasp.util.time.timeValue(e[a].offset))));return t.length<=0?teasp.message.getLabel("tm10010600"):t.join("<br/>")}(
e.restTimeCheck),dojo.byId("empViewConfHolidayWork").innerHTML=e.useHolidayWorkFlag?teasp.message.getLabel("tm10010510")+(4&e.useHolidayWorkFlag?teasp.message.getLabel("tm10010762"):""):teasp.message.getLabel("tm10010500"),dojo.byId("empViewConfZangyo").innerHTML=e.useOverTimeFlag?teasp.message.getLabel("tm10010510")+(2&e.useOverTimeFlag?teasp.message.getLabel("tm10010760"):"")+(
8&e.useOverTimeFlag?teasp.message.getLabel("tm10010761"):"")+(0<e.overTimeBorderTime?teasp.message.getLabel("tk10004860",teasp.message.getLabel("tk10004400",teasp.util.time.timeValue(e.overTimeBorderTime))):"")+(4&e.useOverTimeFlag?teasp.message.getLabel("tm10010762"):""):teasp.message.getLabel("tm10010500"),dojo.byId("empViewConfEarlyWork").innerHTML=e.useEarlyWorkFlag?teasp.message.getLabel("tm10010510")+(
2&e.useEarlyWorkFlag?teasp.message.getLabel("tm10010760"):"")+(8&e.useEarlyWorkFlag?teasp.message.getLabel("tm10010761"):"")+(0<e.earlyWorkBorderTime?teasp.message.getLabel("tk10004860",teasp.message.getLabel("tk10004410",teasp.util.time.timeValue(e.earlyWorkBorderTime))):"")+(4&e.useEarlyWorkFlag?teasp.message.getLabel("tm10010762"):""):teasp.message.getLabel("tm10010500"),dojo.byId("empViewConfLateStart"
).innerHTML=teasp.message.getLabel(e.useLateStartApply?"tm10010510":"tm10010500"),dojo.byId("empViewConfEarlyEnd").innerHTML=teasp.message.getLabel(e.useEarlyEndApply?"tm10010510":"tm10010500"),dojo.byId("empViewConfExchange").innerHTML=teasp.message.getLabel(e.useMakeupHoliday?"tm10010510":"tm10010500")+(e.useMakeupHoliday?function(e,t){if(null===e&&null===t)return"";var a="",o="",s="";return a+="&nbsp;&nbsp;",o=(
o=(o+=teasp.message.getLabel("tk10003580"))+teasp.message.getLabel("tk10004140"))+(1==t?teasp.message.getLabel("tm10010810"):1<t?teasp.message.getLabel("tm10010820",t):teasp.message.getLabel("tm10010800")),a=a+teasp.message.getLabel("tm10001680",o)+"&nbsp;&nbsp;",s=(s=(s+=teasp.message.getLabel("tk10003590"))+teasp.message.getLabel("tk10004140"))+(1==e?teasp.message.getLabel("tm10010810"):1<e?teasp.message.getLabel(
"tm10010820",e):teasp.message.getLabel("tm10010800")),a+=teasp.message.getLabel("tm10001680",s)}(e.exchangeLimit,e.exchangeLimit2):""),dojo.byId("empViewConfPattern").innerHTML=e.changePattern?teasp.message.getLabel("tm10010510")+(e.changeShift?teasp.message.getLabel("tm10010770"):"")+(e.changeDayType?teasp.message.getLabel("tm10010771"):"")+(
e.config&&e.config.empApply&&e.config.empApply.allowSelectionOfLegalHoliday?teasp.message.getLabel("tm10010772"):"")+(e.config&&e.config.empApply&&e.config.empApply.prohibitWorkShiftChange?teasp.message.getLabel("tm10010773"):""):teasp.message.getLabel("tm10010500"),dojo.byId("empViewConfDirect").innerHTML=teasp.message.getLabel(e.useDirectApply?"tm10010510":"tm10010500"),dojo.byId("empViewConfRevise"
).innerHTML=teasp.message.getLabel(e.useReviseTimeApply?"tm10010510":"tm10010500"),dojo.byId("empViewConfDaily").innerHTML=(m=e.useDailyApply,r=e.checkWorkingTime,l=e.dailyApprover,p=e.useWorkFlow,d=e.checkDailyFixLeak,t=m?teasp.message.getLabel("tm10010510"):teasp.message.getLabel("tm10010500"),c=[],m&&(c.push(teasp.message.getLabel("tm10010980",teasp.message.getLabel(r?"tm10010590":"tm10010600"))),p&&c.push(
teasp.message.getLabel("tm10010990",teasp.message.getLabel(0==l?"tm10011000":"tm10011010"))),d&&c.push(teasp.message.getLabel("tk10001150"))),t+(0<c.length?" "+teasp.message.getLabel("tm10001680",c.join(teasp.message.getLabel("tm10001540"))):"")),dojo.byId("empViewConfWorkFlow").innerHTML=teasp.message.getLabel(e.useWorkFlow?"tm10010510":"tm10010500"),dojo.byId("empViewConfForm"
).innerHTML='<table border="0" cellpadding="0" cellspacing="0"><tr><td><div>'+teasp.message.getLabel("tm10010410")+"</div></td><td><div>"+e.timeFormat+'</div></td><td style="padding-left:20px;"><div>'+teasp.message.getLabel("tm10010420")+"</div></td><td><div>"+teasp.message.getLabel("tm10010430",e.timeRound)+"</div></td></tr></table>",dojo.byId("empViewPermitUpdate").innerHTML=function(){switch(
e.permitUpdateTimeLevel){case 1:return teasp.message.getLabel("tk10004440");case 2:return teasp.message.getLabel("tk10004450");default:return teasp.message.getLabel("tk10004430")}}()},teasp.view.EmpConfig.prototype.displayValue5=function(){var e,t,a=this.pouch.getTargetEmpObj().daiqManage;dojo.byId("empViewConfDaiqManage").innerHTML=teasp.message.getLabel(a.useDaiqManage?"tm10010890":"tm10010900"),dojo.query(
".daiq_manage_config").forEach(function(e){dojo.style(e,"display",a.useDaiqManage?"":"none")},this),a.useDaiqManage&&(dojo.byId("empViewConfDaiqHalf").innerHTML=teasp.message.getLabel(a.useHalfDaiq?"tm10010440":"tm10010450"),dojo.byId("empViewConfDaiqable").innerHTML=(e=a,(t=[]).push(teasp.message.getLabel("tm10010780",teasp.util.time.timeValue(e.daiqAllBorderTime))),e.useHalfDaiq&&t.push(teasp.message.getLabel(
"tm10010790",teasp.util.time.timeValue(e.daiqHalfBorderTime))),t.join("<br/>")),dojo.byId("empViewConfDaiqLimit").innerHTML=0==(e=a).daiqLimit?teasp.message.getLabel("tm10010800"):1==e.daiqLimit?teasp.message.getLabel("tm10010810"):teasp.message.getLabel("tm10010820",e.daiqLimit),dojo.byId("empViewConfHolyWork").innerHTML=(t=a,(e=[]).push(teasp.message.getLabel(t.useDaiqReserve?"tm10010830":"tm10010840")),e.push(
teasp.message.getLabel(t.useDaiqLegalHoliday?"tm10010850":"tm10010860")),e.push(teasp.message.getLabel(t.useRegulateHoliday?"tm10010870":"tm10010880")),t.noDaiqExchanged&&e.push(teasp.message.getLabel("tk10000592")),e.join("<br/>")))},teasp.view.EmpConfig.prototype.getVariablePeriodJp=function(e){e=0==e?teasp.message.getLabel("tm10009020"):12==e?teasp.message.getLabel("tm10009030"):teasp.message.getLabel("tm10010100"
,e);return teasp.message.getLabel("tm10010070",e)},teasp.view.EmpConfig.prototype.displayTimeRange=function(e,t){return"number"==typeof e&&"number"==typeof t?teasp.message.getLabel("tm10010460",teasp.util.time.timeValue(e),teasp.util.time.timeValue(t)):""},teasp.view.EmpConfig.prototype.createPatternTable=function(e,t){for(var a,o,s,i,n=document.createElement("table"),r=(n.setAttribute("cellspacing","0"),
n.setAttribute("cellpadding","0"),n.setAttribute("border","0"),n.className="pattern_table",a=document.createElement("tbody"),n.appendChild(a),this.pouch.isUseChangePattern()&&this.pouch.isUseChangeShift()),l=0;l<e.length;l++){i=e[l],(o=a.insertRow(-1)).className="atk_r_row_"+(l%2==0?"even":"odd")+(0<l?" pattern_border":"");var p=[],d=(r&&(i.prohibitChangeWorkTime&&p.push(teasp.message.getLabel("tk10003850")),
i.prohibitChangeHolidayWorkTime&&p.push(teasp.message.getLabel("tk10003860")),i.prohibitChangeExchangedWorkTime&&p.push(teasp.message.getLabel("tk10003870"))),(s=o.insertCell(-1)).className="pattern_col1",s.rowSpan=(i.useHalfHoliday?i.useHalfHolidayRestTime?10:8:6)+(r?3!=p.length?3:2:0),s.innerHTML="<div>"+i.name+"</div>",(s=o.insertCell(-1)).className="pattern_col2",s.innerHTML="<div>"+teasp.message.getLabel(
"tm10010170")+"</div>",(s=o.insertCell(-1)).className="pattern_col3",s.innerHTML="<div>"+teasp.message.getLabel("tm10010460",teasp.util.time.timeValue(i.stdStartTime),teasp.util.time.timeValue(i.stdEndTime))+"</div>","");i.restTimes&&(d+=teasp.view.EmpConfig.getRestTimes(i.restTimes)),(o=a.insertRow(-1)).className="atk_r_row_"+(l%2==0?"even":"odd"),(s=o.insertCell(-1)).className="pattern_col2",
s.innerHTML="<div>"+teasp.message.getLabel("restTime_label")+"</div>",(s=o.insertCell(-1)).className="pattern_col3",s.innerHTML="<div>"+(0<d.length?d:teasp.message.getLabel("tm10010520"))+"</div>",(o=a.insertRow(-1)).className="atk_r_row_"+(l%2==0?"even":"odd"),(s=o.insertCell(-1)).className="pattern_col2",s.innerHTML="<div>"+teasp.message.getLabel("fixTimeOfDay_label")+"</div>",(s=o.insertCell(-1)
).className="pattern_col3",s.innerHTML="<div>"+teasp.util.time.timeValue(i.standardFixTime)+"</div>",(o=a.insertRow(-1)).className="atk_r_row_"+(l%2==0?"even":"odd"),(s=o.insertCell(-1)).className="pattern_col2",s.innerHTML="<div>"+teasp.message.getLabel("tm10010190")+"</div>",(s=o.insertCell(-1)).className="pattern_col3",s.innerHTML="<div>"+teasp.message.getLabel(i.useHalfHoliday?"tm10010200":"tm10010210")+"</div>",
i.useHalfHoliday&&(d=teasp.message.getLabel("tm10010230",teasp.util.time.timeValue(i.amHolidayStartTime),teasp.util.time.timeValue(i.amHolidayEndTime),teasp.util.time.timeValue(i.pmHolidayStartTime),teasp.util.time.timeValue(i.pmHolidayEndTime)),(o=a.insertRow(-1)).className="atk_r_row_"+(l%2==0?"even":"odd"),(s=o.insertCell(-1)).className="pattern_col2",s.innerHTML="<div>"+teasp.message.getLabel("tm10010220"
)+"</div>",(s=o.insertCell(-1)).className="pattern_col3",s.innerHTML="<div>"+d+"</div>",(o=a.insertRow(-1)).className="atk_r_row_"+(l%2==0?"even":"odd"),(s=o.insertCell(-1)).className="pattern_col2",s.innerHTML="<div>"+teasp.message.getLabel("tf10009700")+"</div>",(s=o.insertCell(-1)).className="pattern_col3",s.innerHTML="<div>"+teasp.message.getLabel(i.useHalfHolidayRestTime?"tf10009710":"tf10009711")+"</div>",
i.useHalfHolidayRestTime&&((o=a.insertRow(-1)).className="atk_r_row_"+(l%2==0?"even":"odd"),(s=o.insertCell(-1)).className="pattern_col2",s.innerHTML="<div>"+teasp.message.getLabel("tf10009720")+"</div>",(s=o.insertCell(-1)).className="pattern_col3",s.innerHTML="<div>"+teasp.view.EmpConfig.getRestTimes(i.amHolidayRestTimes)+"</div>",(o=a.insertRow(-1)).className="atk_r_row_"+(l%2==0?"even":"odd"),(s=o.insertCell(-1)
).className="pattern_col2",s.innerHTML="<div>"+teasp.message.getLabel("tf10009730")+"</div>",(s=o.insertCell(-1)).className="pattern_col3",s.innerHTML="<div>"+teasp.view.EmpConfig.getRestTimes(i.pmHolidayRestTimes)+"</div>")),(o=a.insertRow(-1)).className="atk_r_row_"+(l%2==0?"even":"odd"),(s=o.insertCell(-1)).className="pattern_col2",s.innerHTML="<div>"+teasp.message.getLabel("tm10010240")+"</div>",(s=o.insertCell(
-1)).className="pattern_col3",s.innerHTML="<div>"+teasp.message.getLabel(i.useDiscretionary?"tm10010250":"tm10010260")+"</div>",(o=a.insertRow(-1)).className="atk_r_row_"+(l%2==0?"even":"odd"),(s=o.insertCell(-1)).className="pattern_col2",s.innerHTML="<div>"+teasp.message.getLabel("nightWorkEx_label")+"</div>",(s=o.insertCell(-1)).className="pattern_col3",s.innerHTML="<div>"+teasp.message.getLabel(
i.igonreNightWork?"tm10010150":"tm10010140")+"</div>",r&&(o=dojo.create("tr",{className:"atk_r_row_"+(l%2==0?"even":"odd")},a),dojo.create("div",{innerHTML:teasp.message.getLabel("tk10004870")},dojo.create("td",{className:"pattern_col2"},o)),s=dojo.create("td",{className:"pattern_col3"},o),3==p.length?dojo.create("div",{innerHTML:teasp.message.getLabel("tk10004890")},s):0<p.length?dojo.create("div",{
innerHTML:teasp.message.getLabel("tk10004880",p.join(teasp.message.getLabel("tm10001540")))},s):dojo.create("div",{innerHTML:teasp.message.getLabel("tm10010440")},s),3!=p.length&&(o=dojo.create("tr",{className:"atk_r_row_"+(l%2==0?"even":"odd")},a),dojo.create("div",{innerHTML:teasp.message.getLabel(i.useDiscretionary?"tk10004877":"tk10004871")},dojo.create("td",{className:"pattern_col2"},o)),dojo.create("div",{
innerHTML:teasp.message.getLabel(i.workTimeChangesWithShift?i.useDiscretionary?"tk10004878":"tk10004872":"tk10004873")},dojo.create("td",{className:"pattern_col3"},o))),o=dojo.create("tr",{className:"atk_r_row_"+(l%2==0?"even":"odd")},a),dojo.create("div",{innerHTML:teasp.message.getLabel("tk10004874")},dojo.create("td",{className:"pattern_col2"},o)),dojo.create("div",{innerHTML:teasp.message.getLabel(
i.enableRestTimeShift?"tk10004875":"tk10004876")},dojo.create("td",{className:"pattern_col3"},o)))}dojo.byId(t).appendChild(n)},teasp.view.EmpConfig.prototype.createHolidayTable=function(e,t){var a,o,s=document.createElement("table");for(s.setAttribute("cellspacing","0"),s.setAttribute("cellpadding","0"),s.setAttribute("border","0"),s.className="holiday_table",a=document.createElement("tbody"),s.appendChild(a),
o=0;o<e.length;o++){var i,n,r=e[o],l=((i=a.insertRow(-1)).className="even"+(0<o?" holiday_border":""),(n=i.insertCell(-1)).className="holiday_col1",n.style.borderTop="1px dashed #8F8F8F",n.innerHTML="<div>"+r.name+"</div>",n),p=((n=i.insertCell(-1)).className="holiday_col2",n.style.borderTop="1px dashed #8F8F8F",""),p=r.type==teasp.constant.HOLIDAY_TYPE_PAID?teasp.message.getLabel("tm10010530"
):r.type==teasp.constant.HOLIDAY_TYPE_FREE?teasp.message.getLabel("tm10010540"):teasp.message.getLabel("tm10010550"),p=(n.innerHTML="<div>"+p+"</div>",(n=i.insertCell(-1)).className="holiday_col2",n.style.borderTop="1px dashed #8F8F8F","");r.range==teasp.constant.RANGE_AM?p+=teasp.message.getLabel("holidayAm_label"):r.range==teasp.constant.RANGE_PM?p+=teasp.message.getLabel("holidayPm_label"
):r.range==teasp.constant.RANGE_TIME?p+=teasp.message.getLabel("tm10010560"):p+=teasp.message.getLabel("holidayDay_label"),n.innerHTML="<div>"+p+"</div>",(n=i.insertCell(-1)).className="holiday_col2",n.style.borderTop="1px dashed #8F8F8F",n.innerHTML="<div>"+teasp.message.getLabel("tm10010570",teasp.message.getLabel(r.yuqSpend?"tm10010590":"tm10010600"))+"</div>",(n=i.insertCell(-1)).className="holiday_col2",
n.style.borderTop="1px dashed #8F8F8F",n.innerHTML="<div>"+teasp.message.getLabel("tm10010580",teasp.message.getLabel(r.isWorking?"tm10010610":"tm10010620"))+"</div>",(n=i.insertCell(-1)).className="holiday_col3",n.style.borderTop="1px dashed #8F8F8F",n.innerHTML="<div>"+teasp.message.getLabel("tm10010581",teasp.message.getLabel(r.managed?"tm10010590":"tm10010600"))+"</div>",r.description&&(l.rowSpan="2",(
i=a.insertRow(-1)).className="even",(n=i.insertCell(-1)).colSpan="5",n.className="holiday_col4",n.innerHTML="<div>"+(r.description||"").replace(/\n/g,"<br/>").replace(/ /g,"&nbsp;")+"</div>")}dojo.byId(t).appendChild(s)},teasp.view.EmpConfig.getRestTimes=function(e){var t=[];return dojo.forEach(e||[],function(e){t.push(teasp.message.getLabel("tm10010460",teasp.util.time.timeValue(e.from),teasp.util.time.timeValue(
e.to)))}),t.length?t.join(", "):teasp.message.getLabel("tm10010150")},teasp.provide("teasp.view.EMEmpConfig"),teasp.view.EMEmpConfig=function(){},teasp.view.EMEmpConfig.prototype=new teasp.view.Base,teasp.view.EMEmpConfig.prototype.init=function(e,t,a){teasp.message.mergeLabels(globalMessages||{}),teasp.message.mergeLabels(e&&e[teasp.message.getLanguageLocaleKey()]||{}),this.employeeFieldList=[{
id:"employeeInformation",label:teasp.message.getLabel("em10000240"),fields:[{fieldName:"EmpCode__c",label:teasp.message.getLabel("tk10000068")},{fieldName:"Name",label:teasp.message.getLabel("empName_label")},{fieldName:"EmpName_Kana__c",label:teasp.message.getLabel("em10000260")},{fieldName:"EmpName_Document__c",label:teasp.message.getLabel("em10000270")},{fieldName:"EmpName_Document_Kana__c",
label:teasp.message.getLabel("em10001920")},{fieldName:"DepartmentId__r.DeptCode__c",label:teasp.message.getLabel("tk10000069")},{fieldName:"DepartmentId__r.Name",label:teasp.message.getLabel("dept_label")},{fieldName:"Title__c",label:teasp.message.getLabel("title_label")},{fieldName:"Manager__r.Name",label:teasp.message.getLabel("empManager_label")},{fieldName:"Phone__c",label:teasp.message.getLabel("em10000280")},{
fieldName:"ExtentionNumber__c",label:teasp.message.getLabel("em10000290")},{fieldName:"MobilePhone__c",label:teasp.message.getLabel("em10000300")},{fieldName:"Email__c",label:teasp.message.getLabel("em10000310")},{fieldName:"SalesforceUserName__c",label:teasp.message.getLabel("empUser_label")},{fieldName:"EnteringDate__c",label:teasp.message.getLabel("empEntryDate_label"),format:"date"}]},{id:"selfInformation",
label:teasp.message.getLabel("em10000320"),fields:[{fieldName:"Gender__c",label:teasp.message.getLabel("em10000330"),convertList:!0},{fieldName:"Birth__c",label:teasp.message.getLabel("em10000340"),format:"date"},{fieldName:"SelfPhone__c",label:teasp.message.getLabel("em10000350")},{fieldName:"SelfMobilePhone__c",label:teasp.message.getLabel("em10000360")},{fieldName:"SelfEmail__c",label:teasp.message.getLabel(
"em10000370")},{fieldName:"EmergencyContact__c",label:teasp.message.getLabel("em10000380")},{fieldName:"DisabilityGrade__c",label:teasp.message.getLabel("em10000390")},{fieldName:"TsDisplayMyNumber__c",label:teasp.message.getLabel("em10000400"),convertList:!0}]},{id:"addressInformation",label:teasp.message.getLabel("em10000410"),fields:[{fieldName:"PostalCode__c",label:teasp.message.getLabel("em10000420")},{
fieldName:"State__c",label:teasp.message.getLabel("em10000430")},{fieldName:"City__c",label:teasp.message.getLabel("em10000440")},{fieldName:"Street__c",label:teasp.message.getLabel("em10000450")},{fieldName:"State_Kana__c",label:teasp.message.getLabel("em10000460")},{fieldName:"City_Kana__c",label:teasp.message.getLabel("em10000470")},{fieldName:"Street_Kana__c",label:teasp.message.getLabel("em10000480")},{
fieldName:"EqualResident__c",label:teasp.message.getLabel("em10000490"),format:"checkbox",convert:{true:teasp.message.getLabel("em10000500"),default:teasp.message.getLabel("em10000510")}},{fieldName:"PostalCode_Resident__c",label:teasp.message.getLabel("em10000520")},{fieldName:"State_Resident__c",label:teasp.message.getLabel("em10000530")},{fieldName:"City_Resident__c",label:teasp.message.getLabel("em10000540")},{
fieldName:"Street_Resident__c",label:teasp.message.getLabel("em10000550")}]},{id:"nationalityInformation",label:teasp.message.getLabel("em10000560"),fields:[{fieldName:"Nationality__c",label:teasp.message.getLabel("em10000570")},{fieldName:"ResidencePeriod__c",label:teasp.message.getLabel("em10000580"),format:"date"},{fieldName:"ResidenceStatus__c",label:teasp.message.getLabel("em10000590")},{
fieldName:"IsPermissionEngage__c",label:teasp.message.getLabel("em10000600"),format:"checkbox",convert:{true:teasp.message.getLabel("em10000610"),default:teasp.message.getLabel("em10000620")}},{fieldName:"PermissionEngageDetail__c",label:teasp.message.getLabel("em10000630")}]},{id:"dependentInformation",label:teasp.message.getLabel("em10000640"),relationName:"Dependents__r",fields:[{fieldName:"Name",
label:teasp.message.getLabel("em10000650")},{fieldName:"Name_Kana__c",label:teasp.message.getLabel("em10000660")},{fieldName:"Relation__c",label:teasp.message.getLabel("em10000670"),convertList:!0},{fieldName:"OtherRelation__c",label:teasp.message.getLabel("em10000680")},{fieldName:"Gender__c",label:teasp.message.getLabel("em10000330"),convertList:!0},{fieldName:"Birth__c",label:teasp.message.getLabel("em10000340"),
format:"date"},{fieldName:"Job__c",label:teasp.message.getLabel("em10000690")},{fieldName:"EqualAddress__c",label:teasp.message.getLabel("em10000700"),format:"checkbox",convert:{true:teasp.message.getLabel("em10000710"),default:teasp.message.getLabel("em10000720")}},{fieldName:"PostalCode__c",label:teasp.message.getLabel("em10000420")},{fieldName:"State__c",label:teasp.message.getLabel("em10000430")},{
fieldName:"City__c",label:teasp.message.getLabel("em10000440")},{fieldName:"Street__c",label:teasp.message.getLabel("em10000450")},{fieldName:"IsNationalPensionNo3__c",label:teasp.message.getLabel("em10000730"),format:"checkbox",convert:{true:teasp.message.getLabel("em10001150"),default:teasp.message.getLabel("em10001160")}},{fieldName:"DisabilityGrade__c",label:teasp.message.getLabel("em10000740"),convertList:!0},{
fieldName:"HealthInsuranceSubscription__c",label:teasp.message.getLabel("em10001900"),convert:{"対象":teasp.message.getLabel("em10001150"),"対象外":teasp.message.getLabel("em10001160")}},{fieldName:"SocialInsuranceDivision__c",label:teasp.message.getLabel("em10000970"),convertList:!0},{fieldName:"TsDisplayMyNumber__c",label:teasp.message.getLabel("em10000400"),convertList:!0}]}],this.readParams(),dojo.connect(window,
"resize",this.resizeEmployeeContents),teasp.manager.request("loadEMEmployee",this.viewParams,this.pouch,{hideBusy:!0},this,function(){this.displayValue(),t()},function(e){a(e)})},teasp.view.EMEmpConfig.prototype.resizeEmployeeContents=function(){require(["dojo/window"],function(e){var t=dojo.byId("employeeContents"),e=e.getBox(),a=dojo.position(t);dojo.style(t,"height",e.h-a.y-30+"px")})},
teasp.view.EMEmpConfig.prototype.displayValue=function(){var e=dojo.query("#expTopView td.ts-top-empinfo table"),t=[teasp.message.getLabel("dept_label"),null,teasp.message.getLabel("empType_label"),teasp.message.getLabel("empName_label")],a=(dojo.query("td.ts-top-title > div.main-title").forEach(function(e){e.innerHTML=teasp.message.getLabel("em10000240")},this),dojo.query("td.ts-top-title > div.sub-title").forEach(
function(e){e.innerHTML=teasp.message.getLabel("em10000250")},this),0),e=(dojo.query("td.ts-top-info-l > div",e[0]).forEach(function(e){e.innerHTML=t[a++]||""}),dojo.query("#expTopView td.ts-top-photo > div")[0]),o=this.pouch.getSmallPhotoUrl(),o=(o?dojo.create("img",{src:o,className:"smallPhoto"},e):dojo.create("img",{className:"pp_base pp_default_photo"},e),dojo.query("td.ts-top-button3 > a",dojo.byId("expTopView")
));0<o.length&&(o[0].href=this.pouch.getHelpLink()),dojo.byId("empTypeName").innerHTML=this.pouch.getEmpTypeName(),dojo.byId("department").innerHTML=this.pouch.getDeptName(),dojo.byId("empName").innerHTML=this.pouch.getName(),this.settingButton(),this.settingEmployee()},teasp.view.EMEmpConfig.prototype.settingButton=function(){dojo.byId("changeRequest").firstChild.innerHTML=teasp.message.getLabel("em10000020"),
dojo.connect(dojo.byId("changeRequest"),"onclick",this,function(){this.openChangeRequest()}),dojo.byId("submitRequest").firstChild.innerHTML=teasp.message.getLabel("applyList_btn_title"),dojo.connect(dojo.byId("submitRequest"),"onclick",this,function(){this.openRequestList()}),dojo.byId("configPrint").firstChild.innerHTML=teasp.message.getLabel("printOut_btn_title"),dojo.connect(dojo.byId("configPrint"),"onclick",
function(){return jPrintArea(dojo.byId("employeeContents")),!1})},teasp.view.EMEmpConfig.prototype.settingEmployee=function(){for(var e=this.pouch.getKeyObj("EMEmployee"),t=dojo.byId("employeeContents"),a=dojo.byId("employeeNavigation"),o=0;o<this.employeeFieldList.length;o++){var s=this.employeeFieldList[o],i=s.fields,n=e,r=dojo.create("div",{innerHTML:s.label,className:"CategoryNavi",navigateId:s.id},a),r=(
dojo.connect(r,"onclick",function(e){return selectNavigation(e.target,!0),event.preventDefault(),!1}),dojo.create("div",{id:"employeeInformation_"+s.id,className:" closeInfo"},t)),r=(dojo.create("div",{innerHTML:s.label,className:"CategoryLabel"},r),dojo.create("table",null,dojo.create("div",{className:"FieldList"},r))),l=dojo.create("tr",{className:"FieldHead"},r);if(dojo.create("th",{className:"FieldLabel",
innerHTML:teasp.message.getLabel("em10001170")},l),s.relationName){var p=4;n[s.relationName]&&(p=n[s.relationName].records.length)<4&&(p=4);for(var d=0;d<p;d++)dojo.create("th",{className:"FieldValue"},l);this.settingFieldList(s,r,n,i,p)}else dojo.create("th",{className:"FieldValue"},l),this.settingField(r,n,i)}dojo.create("div",{id:"navigationCursor",innerHTML:"▶",style:"display: none;"},a)},
teasp.view.EMEmpConfig.prototype.settingField=function(e,t,a){for(var o=0;o<a.length;o++){var s=a[o],i=this.settingFieldValue(t,s),n=o%2==1?"odd":"even",n=(n=(n+=0==o?" firstRow":"")+(o+1==a.length?" lastRow":""),dojo.create("tr",{className:n},e)),r=dojo.create("div",null,dojo.create("td",{className:"FieldLabel"},n)),n=dojo.create("div",null,dojo.create("td",{className:"FieldValue"},n));r.innerHTML=s.label,
n.innerHTML=i}},teasp.view.EMEmpConfig.prototype.settingFieldList=function(e,t,a,o,s){for(var i=0;i<o.length;i++){var n=o[i],r=i%2==1?"odd":"even",l=(r=(r+=0==i?" firstRow":"")+(i+1==o.length?" lastRow":""),dojo.create("tr",{className:r},t));dojo.create("div",null,dojo.create("td",{className:"FieldLabel"},l)).innerHTML=n.label;for(var p=0;p<s;p++){var d,c="";!a[e.relationName]||(d=a[e.relationName]
).records.length>p&&(d=d.records[p],c=this.settingFieldValue(d,n)),dojo.create("div",null,dojo.create("td",{className:"FieldValue"},l)).innerHTML=c}}},teasp.view.EMEmpConfig.prototype.settingFieldValue=function(e,t){for(var a="",o=t.fieldName.split("."),s=0;s<o.length;s++){var i=o[s];0==s?e[i]&&(a=e[i]):a[i]&&(a=a[i])}return t.format&&"date"===t.format&&(a=teasp.util.date.formatDate(a,"SLA")),t.convert&&(
t.convert[a]?a=t.convert[a]:t.convert.default&&(a=t.convert.default)),t.empty&&(a=null==a||0==a.length?t.empty.true:t.empty.false),a=t.convertList?teasp.dialog.ChangeEmp.prototype.getDispListValue(t.fieldName,a):a},teasp.view.EMEmpConfig.prototype.openChangeRequest=function(){var t={client:teasp.constant.APPLY_CLIENT_CHANGE_EMP};dojo.hitch(this,function(e){e&&(e.preventDefault(),e.stopPropagation()),dojo.hitch(this,
function(){teasp.manager.dialogOpen("ChangeEmp",t,this.pouch,this,function(e,t){})})()})()},teasp.view.EMEmpConfig.prototype.openRequestList=function(){var t={client:teasp.constant.APPLY_CLIENT_REQUEST_LIST};dojo.hitch(this,function(e){e&&(e.preventDefault(),e.stopPropagation()),dojo.hitch(this,function(){teasp.manager.dialogOpen("RequestList",t,this.pouch,this,function(e,t){})})()})()},teasp.provide(
"teasp.view.HRMEmpConfig"),teasp.view.HRMEmpConfig=function(){},teasp.view.HRMEmpConfig.prototype=new teasp.view.Base,teasp.view.HRMEmpConfig.prototype.init=function(e,t,a){teasp.message.mergeLabels(globalMessages||{}),teasp.message.mergeLabels(e&&e[teasp.message.getLanguageLocaleKey()]||{}),this.employeeFieldList=[{id:"employeeInformation",label:teasp.message.getLabel("em10000240"),fields:[{fieldName:"EmpCode__c",
label:teasp.message.getLabel("tk10000068")},{fieldName:"Name",label:teasp.message.getLabel("empName_label")},{fieldName:"EmpName_Kana__c",label:teasp.message.getLabel("em10000260")},{fieldName:"EmpName_Document__c",label:teasp.message.getLabel("em10000270")},{fieldName:"EmpName_Document_Kana__c",label:teasp.message.getLabel("em10001920")},{fieldName:"BusinessName__c",label:teasp.message.getLabel("em10003160")},{
fieldName:"BusinessNameKana__c",label:teasp.message.getLabel("em10003170")},{fieldName:"EmpName_English__c",label:teasp.message.getLabel("em10004320")},{fieldName:"DepartmentId__r.DeptCode__c",label:teasp.message.getLabel("tk10000069")},{fieldName:"DepartmentId__r.Name",label:teasp.message.getLabel("dept_label")},{fieldName:"Title__c",label:teasp.message.getLabel("title_label")},{fieldName:"Manager__r.Name",
label:teasp.message.getLabel("empManager_label")},{fieldName:"Phone__c",label:teasp.message.getLabel("em10000280")},{fieldName:"ExtentionNumber__c",label:teasp.message.getLabel("em10000290")},{fieldName:"MobilePhone__c",label:teasp.message.getLabel("em10000300")},{fieldName:"CellularPhone__c",label:teasp.message.getLabel("em10003190")},{fieldName:"Email__c",label:teasp.message.getLabel("em10000310")},{
fieldName:"SalesforceUserName__c",label:teasp.message.getLabel("empUser_label")},{fieldName:"EnteringDate__c",label:teasp.message.getLabel("empEntryDate_label"),format:"date"}]},{id:"selfContactInformation",label:teasp.message.getLabel("em10004590"),fields:[{fieldName:"SelfPhone__c",label:teasp.message.getLabel("em10000350")},{fieldName:"SelfMobilePhone__c",label:teasp.message.getLabel("em10000360")},{
fieldName:"SelfEmail__c",label:teasp.message.getLabel("em10000370")}]},{id:"selfInformation",label:teasp.message.getLabel("em10000320"),fields:[{fieldName:"Gender__c",label:teasp.message.getLabel("em10000330"),convertList:!0},{fieldName:"Birth__c",label:teasp.message.getLabel("em10000340"),format:"date"},{fieldName:"SpouseFlg__c",label:teasp.message.getLabel("em10004450"),convert:{true:teasp.message.getLabel(
"em10000610"),default:teasp.message.getLabel("em10000620")}},{fieldName:"DeductionSpouse__c",label:teasp.message.getLabel("em10004460"),convert:{true:teasp.message.getLabel("em10001150"),default:teasp.message.getLabel("em10001160")}},{fieldName:"WidowKbn__c",label:teasp.message.getLabel("em10004470"),convert:{"寡婦・寡夫":teasp.message.getLabel("em10004510"),"特別の寡婦":teasp.message.getLabel("em10004520")}},{
fieldName:"DisabilityGrade__c",label:teasp.message.getLabel("em10000390"),convert:{"第1級":teasp.message.getLabel("em10001450"),"第2級":teasp.message.getLabel("em10001440"),"第3級":teasp.message.getLabel("em10001430"),"第4級":teasp.message.getLabel("em10001420"),"第5級":teasp.message.getLabel("em10001410"),"第6級":teasp.message.getLabel("em10001400"),"第7級":teasp.message.getLabel("em10001390"),"第8級":teasp.message.getLabel(
"em10001380"),"第9級":teasp.message.getLabel("em10001370"),"第10級":teasp.message.getLabel("em10001360"),"第11級":teasp.message.getLabel("em10001350"),"第12級":teasp.message.getLabel("em10001340"),"第13級":teasp.message.getLabel("em10001330"),"第14級":teasp.message.getLabel("em10001320")}},{fieldName:"DisabilityKbn__c",label:teasp.message.getLabel("em10004350"),convert:{"一般":teasp.message.getLabel("em10001460"),
"特別":teasp.message.getLabel("em10004360")}},{fieldName:"HandicappedKbn__c",label:teasp.message.getLabel("em10004480"),convert:{"区分1":teasp.message.getLabel("em10004530"),"区分2":teasp.message.getLabel("em10004540"),"区分3":teasp.message.getLabel("em10004550"),"区分4":teasp.message.getLabel("em10004560"),"区分5":teasp.message.getLabel("em10004570"),"区分6":teasp.message.getLabel("em10004580")}},{fieldName:"WorkingStudent__c",
label:teasp.message.getLabel("em10004490"),format:"checkbox",convert:{true:teasp.message.getLabel("em10004280"),default:teasp.message.getLabel("em10004290")}},{fieldName:"TsDisplayMyNumber__c",label:teasp.message.getLabel("em10000400"),convertList:!0}]},{id:"addressInformation",label:teasp.message.getLabel("em10000410"),fields:[{fieldName:"PostalCode__c",label:teasp.message.getLabel("em10000420")},{
fieldName:"State__c",label:teasp.message.getLabel("em10000430")},{fieldName:"City__c",label:teasp.message.getLabel("em10000440")},{fieldName:"Street__c",label:teasp.message.getLabel("em10000450")},{fieldName:"State_Kana__c",label:teasp.message.getLabel("em10000460")},{fieldName:"City_Kana__c",label:teasp.message.getLabel("em10000470")},{fieldName:"Street_Kana__c",label:teasp.message.getLabel("em10000480")},{
fieldName:"CompanyHouse__c",label:teasp.message.getLabel("em10003200")},{fieldName:"EqualResident__c",label:teasp.message.getLabel("em10000490"),format:"checkbox",convert:{true:teasp.message.getLabel("em10000500"),default:teasp.message.getLabel("em10000510")}},{fieldName:"PostalCode_Resident__c",label:teasp.message.getLabel("em10000520")},{fieldName:"State_Resident__c",label:teasp.message.getLabel("em10000530")},{
fieldName:"City_Resident__c",label:teasp.message.getLabel("em10000540")},{fieldName:"Street_Resident__c",label:teasp.message.getLabel("em10000550")},{fieldName:"State_Resident_Kana__c",label:teasp.message.getLabel("em10004390")},{fieldName:"City_Resident_Kana__c",label:teasp.message.getLabel("em10004400")},{fieldName:"Street_Resident_Kana__c",label:teasp.message.getLabel("em10004410")},{
fieldName:"HeadOfFamilyName__c",label:teasp.message.getLabel("em10003210")},{fieldName:"HeadOfFamilyNameKana__c",label:teasp.message.getLabel("em10003220")},{fieldName:"Rel_HeadOfFamily__c",label:teasp.message.getLabel("em10003230")},{fieldName:"HometownFlg__c",label:teasp.message.getLabel("em10003240"),format:"checkbox",convert:{true:teasp.message.getLabel("em10000500"),default:teasp.message.getLabel("em10000510")}}
,{fieldName:"PostalCode_Hometown__c",label:teasp.message.getLabel("em10003250")},{fieldName:"State_Hometown__c",label:teasp.message.getLabel("em10003260")},{fieldName:"City_Hometown__c",label:teasp.message.getLabel("em10003270")},{fieldName:"Street_Hometown__c",label:teasp.message.getLabel("em10003280")}]},{id:"emergencyInformation",label:teasp.message.getLabel("em10003290"),fields:[{fieldName:"Name_Emergency__c",
label:teasp.message.getLabel("em10003300")},{fieldName:"NameKana_Emergency__c",label:teasp.message.getLabel("em10003310")},{fieldName:"Rel_Emergency__c",label:teasp.message.getLabel("em10003320")},{fieldName:"EmergencyContact__c",label:teasp.message.getLabel("em10003330")},{fieldName:"Tel_Emergency__c",label:teasp.message.getLabel("em10004220")},{fieldName:"PostalCode_Emergency__c",label:teasp.message.getLabel(
"em10003340")},{fieldName:"State_Emergency__c",label:teasp.message.getLabel("em10003350")},{fieldName:"City_Emergency__c",label:teasp.message.getLabel("em10003360")},{fieldName:"Street_Emergency__c",label:teasp.message.getLabel("em10003370")},{fieldName:"State_Emergency_Kana__c",label:teasp.message.getLabel("em10004420")},{fieldName:"City_Emergency_Kana__c",label:teasp.message.getLabel("em10004430")},{
fieldName:"Street_Emergency_Kana__c",label:teasp.message.getLabel("em10004440")}]},{id:"businessTripInformation",label:teasp.message.getLabel("em10003380"),fields:[{fieldName:"DestinationPostalCode__c",label:teasp.message.getLabel("em10003390")},{fieldName:"DestinationState__c",label:teasp.message.getLabel("em10003400")},{fieldName:"DestinationCity__c",label:teasp.message.getLabel("em10003410")},{
fieldName:"DestinationStreet__c",label:teasp.message.getLabel("em10003420")},{fieldName:"DestinationPhone__c",label:teasp.message.getLabel("em10003430")}]},{id:"passportInformation",label:teasp.message.getLabel("em10003440"),fields:[{fieldName:"PassportName__c",label:teasp.message.getLabel("em10003450")},{fieldName:"PassportPublishCountry__c",label:teasp.message.getLabel("em10003460")},{fieldName:"PassportNo__c",
label:teasp.message.getLabel("em10003470")},{fieldName:"PermanentResidence__c",label:teasp.message.getLabel("em10003480")},{fieldName:"Nationality__c",label:teasp.message.getLabel("em10003490")},{fieldName:"PassportPublishDate__c",label:teasp.message.getLabel("em10003500"),format:"date"},{fieldName:"PassportAvailable__c",label:teasp.message.getLabel("em10003510"),format:"date"}]},{id:"nationalityInformation",
label:teasp.message.getLabel("em10000560"),fields:[{fieldName:"ResidencePeriod__c",label:teasp.message.getLabel("em10000580"),format:"date"},{fieldName:"ResidenceStatus__c",label:teasp.message.getLabel("em10000590")},{fieldName:"IsPermissionEngage__c",label:teasp.message.getLabel("em10000600"),format:"checkbox",convert:{true:teasp.message.getLabel("em10000610"),default:teasp.message.getLabel("em10000620")}},{
fieldName:"PermissionEngageDetail__c",label:teasp.message.getLabel("em10000630")}]},{id:"dependentInformation",label:teasp.message.getLabel("em10003670"),relationName:"Dependents__r",fields:[{fieldName:"Name",label:teasp.message.getLabel("em10003680")},{fieldName:"Name_Kana__c",label:teasp.message.getLabel("em10003690")},{fieldName:"Relation__c",label:teasp.message.getLabel("em10000670"),convertList:!0},{
fieldName:"OtherRelation__c",label:teasp.message.getLabel("em10000680")},{fieldName:"NotificationDate__c",label:teasp.message.getLabel("em10003520"),format:"date"},{fieldName:"DivorceBereavementKbn__c",label:teasp.message.getLabel("em10003530")},{fieldName:"Gender__c",label:teasp.message.getLabel("em10000330"),convertList:!0},{fieldName:"Birth__c",label:teasp.message.getLabel("em10000340"),format:"date"},{
fieldName:"Job__c",label:teasp.message.getLabel("em10000690")},{fieldName:"EqualAddress__c",label:teasp.message.getLabel("em10000700"),format:"checkbox",convert:{true:teasp.message.getLabel("em10000710"),default:teasp.message.getLabel("em10000720")}},{fieldName:"PostalCode__c",label:teasp.message.getLabel("em10000420")},{fieldName:"State__c",label:teasp.message.getLabel("em10000430")},{fieldName:"City__c",
label:teasp.message.getLabel("em10000440")},{fieldName:"Street__c",label:teasp.message.getLabel("em10000450")},{fieldName:"State_Kana__c",label:teasp.message.getLabel("em10000460")},{fieldName:"City_Kana__c",label:teasp.message.getLabel("em10000470")},{fieldName:"Street_Kana__c",label:teasp.message.getLabel("em10000480")},{fieldName:"IsNonresident__c",label:teasp.message.getLabel("em10004740"),format:"checkbox",
convert:{true:teasp.message.getLabel("em10004750"),default:teasp.message.getLabel("em10004760")}},{fieldName:"DependentsPhone__c",label:teasp.message.getLabel("em10003540")},{fieldName:"Income__c",label:teasp.message.getLabel("em10004230")},{fieldName:"FamilyAllowance__c",label:teasp.message.getLabel("em10004240"),convert:{"対象":teasp.message.getLabel("em10001150"),"対象外":teasp.message.getLabel("em10001160")}},{
fieldName:"IsNationalPensionNo3__c",label:teasp.message.getLabel("em10000730"),format:"checkbox",convert:{true:teasp.message.getLabel("em10001150"),default:teasp.message.getLabel("em10001160")}},{fieldName:"HealthInsuranceSubscription__c",label:teasp.message.getLabel("em10001900"),convert:{"対象":teasp.message.getLabel("em10001150"),"対象外":teasp.message.getLabel("em10001160")}},{fieldName:"SocialInsuranceDivision__c",
label:teasp.message.getLabel("em10000970"),convertList:!0},{fieldName:"DisabilityGrade__c",label:teasp.message.getLabel("em10000740"),convertList:!0},{fieldName:"DisabilityKbn__c",label:teasp.message.getLabel("em10004350"),convert:{"一般":teasp.message.getLabel("em10001460"),"特別":teasp.message.getLabel("em10004360"),"同居特別":teasp.message.getLabel("em10004370")}},{fieldName:"TsDisplayMyNumber__c",
label:teasp.message.getLabel("em10000400"),convertList:!0}]},{id:"accountsInformation",label:teasp.message.getLabel("em10003550"),relationName:"Bank__r",fields:[{fieldName:"Kbn__c",label:teasp.message.getLabel("em10003560")},{fieldName:"Name",label:teasp.message.getLabel("em10003570")},{fieldName:"BankCode__c",label:teasp.message.getLabel("em10003580")},{fieldName:"BranchName__c",label:teasp.message.getLabel(
"em10003590")},{fieldName:"BranchCode__c",label:teasp.message.getLabel("em10003600")},{fieldName:"AccountType__c",label:teasp.message.getLabel("em10003610")},{fieldName:"AccountNo__c",label:teasp.message.getLabel("em10003620")},{fieldName:"AccountHolder__c",label:teasp.message.getLabel("em10003630")},{fieldName:"BankAccountMemo__c",label:teasp.message.getLabel("em10003650")},{fieldName:"MaximumAmount__c",
label:teasp.message.getLabel("em10003660")},{fieldName:"ValidFlag__c",label:teasp.message.getLabel("em10004270"),format:"checkbox",convert:{true:teasp.message.getLabel("em10004280"),default:teasp.message.getLabel("em10004290")}}]}],this.readParams(),dojo.connect(window,"resize",this.resizeEmployeeContents),teasp.manager.request("loadHRMEmployee",this.viewParams,this.pouch,{hideBusy:!0},this,function(){
this.displayValue(),t()},function(e){a(e)})},teasp.view.HRMEmpConfig.prototype.resizeEmployeeContents=function(){require(["dojo/window"],function(e){var t=dojo.byId("employeeContents"),e=e.getBox(),a=dojo.position(t);dojo.style(t,"height",e.h-a.y-30+"px")})},teasp.view.HRMEmpConfig.prototype.displayValue=function(){var e=dojo.query("#expTopView td.ts-top-empinfo table"),t=[teasp.message.getLabel("dept_label"),null,
teasp.message.getLabel("empType_label"),teasp.message.getLabel("empName_label")],a=(dojo.query("td.ts-top-title > div.main-title").forEach(function(e){e.innerHTML=teasp.message.getLabel("em10000240")},this),dojo.query("td.ts-top-title > div.sub-title").forEach(function(e){e.innerHTML=teasp.message.getLabel("em10000250")},this),0),e=(dojo.query("td.ts-top-info-l > div",e[0]).forEach(function(e){e.innerHTML=t[a++]||""}
),dojo.query("#expTopView td.ts-top-photo > div")[0]),o=this.pouch.getSmallPhotoUrl(),o=(o?dojo.create("img",{src:o,className:"smallPhoto"},e):dojo.create("img",{className:"pp_base pp_default_photo"},e),dojo.query("td.ts-top-button3 > a",dojo.byId("expTopView")));0<o.length&&(o[0].href=this.pouch.getHelpLink()),dojo.byId("empTypeName").innerHTML=this.pouch.getEmpTypeName(),dojo.byId("department"
).innerHTML=this.pouch.getDeptName(),dojo.byId("empName").innerHTML=this.pouch.getName(),this.settingButton(),this.settingEmployee()},teasp.view.HRMEmpConfig.prototype.settingButton=function(){dojo.byId("changeRequest").firstChild.innerHTML=teasp.message.getLabel("em10000020"),dojo.connect(dojo.byId("changeRequest"),"onclick",this,function(){this.openChangeRequest()}),dojo.byId("submitRequest"
).firstChild.innerHTML=teasp.message.getLabel("applyList_btn_title"),dojo.connect(dojo.byId("submitRequest"),"onclick",this,function(){this.openRequestList()}),dojo.byId("configPrint").firstChild.innerHTML=teasp.message.getLabel("printOut_btn_title"),dojo.connect(dojo.byId("configPrint"),"onclick",function(){return jPrintArea(dojo.byId("employeeContents")),!1})},
teasp.view.HRMEmpConfig.prototype.settingEmployee=function(){for(var e=this.pouch.getKeyObj("HRMEmployee"),t=dojo.byId("employeeContents"),a=dojo.byId("employeeNavigation"),o=0;o<this.employeeFieldList.length;o++){var s=this.employeeFieldList[o],i=s.fields,n=e,r=dojo.create("div",{innerHTML:s.label,className:"CategoryNavi",navigateId:s.id},a),r=(dojo.connect(r,"onclick",function(e){return selectNavigation(e.target,!0
),event.preventDefault(),!1}),dojo.create("div",{id:"employeeInformation_"+s.id,className:" closeInfo"},t)),r=(dojo.create("div",{innerHTML:s.label,className:"CategoryLabel"},r),dojo.create("table",null,dojo.create("div",{className:"FieldList"},r))),l=dojo.create("tr",{className:"FieldHead"},r);if(dojo.create("th",{className:"FieldLabel",innerHTML:teasp.message.getLabel("em10001170")},l),s.relationName){var p=4;
n[s.relationName]&&(p=n[s.relationName].records.length)<4&&(p=4);for(var d=0;d<p;d++)dojo.create("th",{className:"FieldValue"},l);this.settingFieldList(s,r,n,i,p)}else dojo.create("th",{className:"FieldValue"},l),this.settingField(r,n,i)}dojo.create("div",{id:"navigationCursor",innerHTML:"▶",style:"display: none;"},a)},teasp.view.HRMEmpConfig.prototype.settingField=function(e,t,a){for(var o=0;o<a.length;o++){
var s=a[o],i=this.settingFieldValue(t,s),n=o%2==1?"odd":"even",n=(n=(n+=0==o?" firstRow":"")+(o+1==a.length?" lastRow":""),dojo.create("tr",{className:n},e)),r=dojo.create("div",null,dojo.create("td",{className:"FieldLabel"},n)),n=dojo.create("div",null,dojo.create("td",{className:"FieldValue"},n));r.innerHTML=s.label,n.innerHTML=i}},teasp.view.HRMEmpConfig.prototype.settingFieldList=function(e,t,a,o,s){for(
var i=0;i<o.length;i++){var n=o[i],r=i%2==1?"odd":"even",l=(r=(r+=0==i?" firstRow":"")+(i+1==o.length?" lastRow":""),dojo.create("tr",{className:r},t));dojo.create("div",null,dojo.create("td",{className:"FieldLabel"},l)).innerHTML=n.label;for(var p=0;p<s;p++){var d,c="";!a[e.relationName]||(d=a[e.relationName]).records.length>p&&(d=d.records[p],c=this.settingFieldValue(d,n)),dojo.create("div",null,dojo.create("td",{
className:"FieldValue"},l)).innerHTML=c}}},teasp.view.HRMEmpConfig.prototype.settingFieldValue=function(e,t){for(var a="",o=t.fieldName.split("."),s=0;s<o.length;s++){var i=o[s];0==s?e.hasOwnProperty(i)&&(a=e[i]):a[i]&&(a=a[i])}return t.format&&"date"===t.format&&(a=teasp.util.date.formatDate(a,"SLA")),t.convert&&(t.convert[a]?a=t.convert[a]:t.convert.default&&(a=t.convert.default)),t.empty&&(
a=null==a||0==a.length?t.empty.true:t.empty.false),a=t.convertList?teasp.dialog.ChangeEmp.prototype.getDispListValue(t.fieldName,a):a},teasp.view.HRMEmpConfig.prototype.openChangeRequest=function(){var t={client:teasp.constant.APPLY_CLIENT_CHANGE_HRM_EMP};dojo.hitch(this,function(e){e&&(e.preventDefault(),e.stopPropagation()),dojo.hitch(this,function(){teasp.manager.dialogOpen("ChangeHRMEmp",t,this.pouch,this,
function(e,t){})})()})()},teasp.view.HRMEmpConfig.prototype.openRequestList=function(){var t={client:teasp.constant.APPLY_CLIENT_REQUEST_HRM_LIST};dojo.hitch(this,function(e){e&&(e.preventDefault(),e.stopPropagation()),dojo.hitch(this,function(){teasp.manager.dialogOpen("RequestHRMList",t,this.pouch,this,function(e,t){})})()})()},teasp.provide("teasp.view.HRMGuide"),teasp.view.HRMGuide=function(){
this.isEmpInfoLoaded=!1},teasp.view.HRMGuide.prototype=new teasp.view.Base,teasp.view.HRMGuide.prototype.init=function(e,t,a){teasp.message.mergeLabels(globalMessages||{}),teasp.message.mergeLabels(e&&e[teasp.message.getLanguageLocaleKey()]||{}),this.readParams(),this.languageKey="ja"===teasp.message.getLanguageLocaleKey()||"ja_JP"===teasp.message.getLanguageLocaleKey()?"ja_JP":"en_US",
this.printView?this.buildResultPrint():this.buildNaviList(t,a)},teasp.view.HRMGuide.prototype.printInit=function(e,t,a){this.printView=!0,this.init(e,t,a)},teasp.view.HRMGuide.prototype.buildNaviList=function(t,a){teasp.util.fadeInOut(!1,{node:"hrmGuideSubmission"}),dojo.connect(dojo.byId("hrmGuideBackMenu"),"onclick",this,function(){this.changeView("EVENTS")}),teasp.manager.request("loadHRMGuide",this.viewParams,
this.pouch,{hideBusy:!1},this,function(e){this.initMenuBar(),this.initNaviGroup(e.naviGroups),t()},function(e){a(e)})},teasp.view.HRMGuide.prototype.initMenuBar=function(){var e=dojo.query("#expTopView td.ts-top-empinfo table"),t=[teasp.message.getLabel("dept_label"),null,teasp.message.getLabel("empType_label"),teasp.message.getLabel("empName_label")],a=(dojo.query("td.ts-top-title > div.main-title").forEach(
function(e){e.innerHTML=teasp.message.getLabel("hr10010000")},this),dojo.query("td.ts-top-title > div.sub-title").forEach(function(e){e.innerHTML="HR Process Navigator"},this),0),e=(dojo.query("td.ts-top-info-l > div",e[0]).forEach(function(e){e.innerHTML=t[a++]||""}),dojo.query("#expTopView td.ts-top-photo > div")[0]),o=this.pouch.getSmallPhotoUrl(),o=(o?dojo.create("img",{src:o,className:"smallPhoto"},e
):dojo.create("img",{className:"pp_base pp_default_photo"},e),dojo.query("td.ts-top-button3 > a",dojo.byId("expTopView")));0<o.length&&(o[0].href=this.pouch.getHelpLink()),dojo.byId("empTypeName").innerHTML=this.pouch.getEmpTypeName(),dojo.byId("department").innerHTML=this.pouch.getDeptName(),dojo.byId("empName").innerHTML=this.pouch.getName()},teasp.view.HRMGuide.prototype.initNaviGroup=function(e){if(e&&e.length){
if(this.naviManager=new teasp.hrm.HrmNaviManager(e),this.naviManager.isSingleGroup())return e=this.naviManager.getGroups()[0],void this.fetchNaviEvents(e).then(function(e){this.initNavi(e)}.bind(this));var e=dojo.byId("hrmGuideGroups"),a=(dojo.create("p",{innerHTML:teasp.message.getLabel("hr10012000")},e),dojo.create("ol",null,e));dojo.forEach(this.naviManager.getGroups(),function(e,t){dojo.create("button",{
textContent:e.getName(),title:e.getName(),groupId:e.getId()||"noGroup"},dojo.create("li",null,a))},this),dojo.query("button",a).forEach(function(e){dojo.connect(e,"onclick",this,function(e){var e=dojo.attr(e.target,"groupId"),e=this.naviManager.getGroupById(e="noGroup"===e?null:e),t=e.getEvents();t&&t.length?this.initNavi(e):this.fetchNaviEvents(e).then(function(e){this.initNavi(e)}.bind(this))})},this)
}else teasp.tsAlert(teasp.message.getLabel("hr10010005"))},teasp.view.HRMGuide.prototype.fetchNaviEvents=function(t){var a=new dojo.Deferred;return teasp.manager.request("loadHRMNaviEvents",t.getId(),this.pouch,{hideBusy:!1},this,function(e){t.setEvents(e.naviEvents),a.resolve(t)}.bind(this),function(e){teasp.message.alertError(e),a.reject()}),a.promise},teasp.view.HRMGuide.prototype.initNavi=function(t){var e,
a=dojo.byId("hrmGuideEvents"),o=(dojo.empty(a),this.naviManager.isSingleGroup()||(e=dojo.create("button",{innerHTML:teasp.message.getLabel("hr10012010")},a),dojo.connect(e,"onclick",this,function(e){this.changeView("GROUPS")},this)),null!==t.getId()&&dojo.create("h2",{innerHTML:t.getName()},a),dojo.create("p",{innerHTML:teasp.message.getLabel("hr10010001")},a),dojo.create("ol",null,a));dojo.forEach(t.getEvents(),
function(e,t){dojo.create("button",{className:"white-button",innerHTML:t+1+". "+teasp.util.entitize(e.getName()),naviEventId:e.getId()},dojo.create("li",null,o))},this),dojo.query("button",o).forEach(function(e){dojo.connect(e,"onclick",this,function(e){e=dojo.attr(e.target,"naviEventId"),e=t.getEventById(e);this.selectedEvent=e,teasp.manager.dialogOpen("HRMGuide",{navi:e},this.pouch,this,function(e,t){
this.sendAnswers(e,t)})})},this),this.changeView("EVENTS")},teasp.view.HRMGuide.prototype.changeView=function(e){var t=!1,a=!1,o=!1;switch(e){case"EVENTS":a=!0;break;case"SUBMISSIONS":o=!0;break;default:t=!0}dojo.style("hrmGuideGroups","display",t?"":"none"),dojo.style("hrmGuideEvents","display",a?"":"none"),dojo.style("hrmGuideSubmission","display",o?"":"none"),teasp.util.fadeInOut(t,{node:"hrmGuideGroups"}),
teasp.util.fadeInOut(a,{node:"hrmGuideEvents"}),teasp.util.fadeInOut(o,{node:"hrmGuideSubmission"})},teasp.view.HRMGuide.prototype.sendAnswers=function(e,t){this.questionList=t;var a=[];this.questionList.forEach(function(e){a.push(e.selected.getId())}),teasp.manager.request("saveAnswersHRMGuide",{naviId:e,answerIdList:a},this.pouch,{hideBusy:!1},this,function(e){this.submissions=e.submissions,
this.buildSubmissionForm(this.submissions),this.changeView("SUBMISSIONS")}.bind(this),function(e){teasp.message.alertError(e)})},teasp.view.HRMGuide.prototype.buildResultPrint=function(){var e=this.getResultData();if(!e)return teasp.message.alertError(teasp.message.getLabel("hr10011100")),window.close(),!1;dojo.byId("naviPrint").firstChild.innerHTML=teasp.message.getLabel("printOut_btn_title"),dojo.style(dojo.byId(
"naviPrint"),"display",""),dojo.connect(dojo.byId("naviPrint"),"onclick",function(){return window.print(),!1}),dojo.byId("naviClose").firstChild.innerHTML=teasp.message.getLabel("close_btn_title"),dojo.style(dojo.byId("naviClose"),"display",""),dojo.connect(dojo.byId("naviClose"),"onclick",function(){return(window.open("","_top").opener=top).close(),!1}),this.initEmpInfo(e.empInfo),dojo.byId("hrmGuideProcedures"
).innerHTML=teasp.message.getLabel("hr10011110")+":"+e.selectedEvent.getName(),this.buildSubmissionForm(e.submissionList),this.buildQuestionSelect(e.questionList),dojo.style(dojo.byId("hrmGuidePrint"),"display","")},teasp.view.HRMGuide.prototype.getResultData=function(){try{e=window.opener&&window.opener.teasp}catch(e){return console.log("security error",e),null}if(e&&e.viewPoint&&e.viewPoint.generateResultData){
var e=e.viewPoint.generateResultData();if(e.submissionList&&e.submissionList.length)return e}return null},teasp.view.HRMGuide.prototype.generateResultData=function(){var e={empInfo:{}};return e.empInfo.department=this.pouch.getDeptName(),e.empInfo.empTypeName=this.pouch.getEmpTypeName(),e.empInfo.empCode=this.pouch.getEmpCode(),e.empInfo.empName=this.pouch.getName(),e.selectedEvent=this.selectedEvent,
e.submissionList=this.submissions,e.questionList=this.questionList,e},teasp.view.HRMGuide.prototype.initEmpInfo=function(e){var t=dojo.query("#tsfArea #emp #empInfo"),a=[teasp.message.getLabel("dept_label"),teasp.message.getLabel("empType_label"),teasp.message.getLabel("empCode_label"),teasp.message.getLabel("empName_label")],o=0;dojo.query("thead th > div",t[0]).forEach(function(e){e.innerHTML=a[o++]||""}),
dojo.byId("department").innerHTML=e.department,dojo.byId("empTypeName").innerHTML=e.empTypeName,dojo.byId("empCode").innerHTML=e.empCode,dojo.byId("empName").innerHTML=e.empName},teasp.view.HRMGuide.prototype.buildSubmissionForm=function(e){dojo.query("#hrmGuideBackMenu").forEach(function(e){e.value=teasp.message.getLabel("hr10010030")}),dojo.query("#hrmGuideSubmission .hrm-guide-preview input").forEach(function(e){
e.value=teasp.message.getLabel("hr10010020")});var l=dojo.query("#hrmGuideSubmissionTable tbody")[0],t=(dojo.empty(l),0);if(dojo.query("#hrmGuideSubmissionTable thead th")[t++].innerHTML=teasp.message.getLabel("hr10010080"),this.printView&&t++,dojo.query("#hrmGuideSubmissionTable thead th")[t++].innerHTML=teasp.message.getLabel("hr10010090"),dojo.query("#hrmGuideSubmissionTable thead th"
)[t++].innerHTML=teasp.message.getLabel("hr10010100"),!e||!e.length)return dojo.byId("hrmGuideInstruction").innerHTML=teasp.message.getLabel("hr10010015"),dojo.style(dojo.byId("hrmGuideSubmissionTable"),"display","none"),void dojo.style(dojo.query("#hrmGuideSubmission .hrm-guide-preview input")[0],"display","none");dojo.byId("hrmGuideInstruction").innerHTML=teasp.message.getLabel("hr10010010"),dojo.style(dojo.byId(
"hrmGuideSubmissionTable"),"display",""),dojo.query("#hrmGuideSubmission .hrm-guide-preview input").forEach(function(e){dojo.style(e,"display",""),dojo.connect(e,"onclick",this,this.openPrint)}.bind(this));var a={"社員情報変更申請":[],"ファイルダウンロード":[],"稟議":[],"その他":[]},p=(e.forEach(function(e){var t=e.type||"その他";a[t].push(e)}),this.languageKey);["社員情報変更申請","ファイルダウンロード","稟議","その他"].forEach(function(n){if(0<a[n].length){
var r=dojo.create("tr",null,l),e="";switch(n){case"社員情報変更申請":e=teasp.message.getLabel("hr10011010");break;case"ファイルダウンロード":e=teasp.message.getLabel("hr10011020");break;case"稟議":e=teasp.message.getLabel("hr10011030");break;default:e=teasp.message.getLabel("hr10011040")}dojo.create("td",{rowSpan:a[n].length,className:"hrm-guide-category",innerHTML:e},r);a[n].forEach(function(e,t){var a,o,t=0===t?r:dojo.create("tr",null
,l),s=(this.printView&&(a=dojo.create("td",{className:"hrm-guide-check"},t),a=dojo.create("label",null,a),dojo.create("input",{type:"checkbox"},a),dojo.create("span",null,a)),dojo.create("td",{className:"hrm-guide-item"},t)),i=e.name[p]||e.name.ja_JP;if(this.printView)s.innerHTML=i;else switch(n){case"社員情報変更申請":e.foreignKey?(o=dojo.create("a",{href:"javascript:void(0)",innerHTML:i,changeEmpForeignKey:e.foreignKey},s)
,dojo.connect(o,"onclick",this,function(e){e=dojo.attr(e.target,"changeEmpForeignKey");this.showChangeEmployeeDialog(e)})):s.innerHTML=i;break;case"ファイルダウンロード":case"稟議":e.url?dojo.create("a",{href:e.url,target:"_blank",innerHTML:i},s):s.innerHTML=i;break;default:s.innerHTML=i}dojo.create("td",{className:"hrm-guide-remarks",innerHTML:e.remarks[p]||e.remarks.ja_JP||""},t)}.bind(this))}}.bind(this))},
teasp.view.HRMGuide.prototype.showChangeEmployeeDialog=function(e){!function(){var t=new dojo.Deferred;return this.isEmpInfoLoaded?t.resolve():teasp.manager.request("loadHRMEmployee",this.viewParams,this.pouch,{hideBusy:!1},this,function(){this.isEmpInfoLoaded=!0,t.resolve()}.bind(this),function(e){teasp.message.alertError(e),t.reject()}.bind(this)),t.promise}.bind(this)().then(function(){teasp.manager.dialogOpen(
"ChangeHRMEmp",{client:teasp.constant.APPLY_CLIENT_CHANGE_HRM_EMP,firstForeignKey:e},this.pouch,this,function(){})}.bind(this))},teasp.view.HRMGuide.prototype.openPrint=function(){var e=screen.availHeight||800,t=(800<e&&(e=800),window.open(teasp.getPageUrl("guidePrintView"),"print","width=700,height="+e+",resizable=yes,scrollbars=yes"));setTimeout(function(){t.resizeTo(710,e)},100)},
teasp.view.HRMGuide.prototype.buildQuestionSelect=function(e){if(0<e.length){dojo.byId("hrmGuideSelectedInstruction").innerHTML=teasp.message.getLabel("hr10011090");for(var t=dojo.create("table",null,dojo.byId("hrmGuideSelectedTable")),a=dojo.create("thead",null,t),o=(dojo.create("th",{innerHTML:teasp.message.getLabel("hr10010110")},a),dojo.create("th",{innerHTML:teasp.message.getLabel("hr10010120")},a),dojo.create(
"tbody",null,t)),s=0;s<e.length;s++){var i=e[s];tr=dojo.create("tr",null,o),dojo.create("div",{innerHTML:"("+(s+1)+") "+i.getName()},dojo.create("td",null,tr));dojo.create("td",{innerHTML:i.getAnswer()||""},tr)}}},teasp.provide("teasp.view.EmpWorks"),teasp.view.EmpWorks=function(e){this.printFlag=e,this.imageMap={},this.eventHandles={}},teasp.view.EmpWorks.prototype=new teasp.view.Base,
teasp.view.EmpWorks.prototype.init=function(e,t,a){teasp.message.mergeLabels(globalMessages||{}),teasp.message.mergeLabels(e&&e[teasp.message.getLanguageLocaleKey()]||{}),this.readParams(),teasp.isSforce1()&&dojo.query("#areaBody tr.control_bar").forEach(function(e){dojo.style(e,"display","none")}),teasp.manager.request("loadJobMonth",this.viewParams,this.pouch,{hideBusy:!0},this,function(){
this.printFlag?this.initShow():this.pouch.isOldRevision()?teasp.locationHref(teasp.getPageUrl("convertView")+"?forwardURL="+encodeURIComponent(teasp.getPageUrl("empJobView"))):this.pouch.getEmpId()?this.initShow():teasp.locationHref(teasp.getPageUrl("empRegistView")+"?forwardURL="+encodeURIComponent(teasp.getPageUrl("empJobView"))),t()},function(e){a(e)})},teasp.view.EmpWorks.prototype.initShow=function(){var e,t,a;
this.printFlag?(teasp.message.setLabelHtml("empWork_label"),teasp.message.setLabelHtml("status_label"),teasp.message.setLabelHtml("section_label"),teasp.message.setLabelHtml("empCode_label"),teasp.message.setLabelHtml("empName_label"),teasp.message.setLabelHtml("date_head"),teasp.message.setLabelHtml("task_head"),teasp.message.setLabelHtml("jobName_head"),teasp.message.setLabelHtml("taskPercent_head"),
teasp.message.setLabelHtml("taskTime_head"),teasp.message.setLabelHtml("jobSTitle","taskSummary_label"),teasp.message.setLabelHtml("task_head2","task_head"),teasp.message.setLabelHtml("jobName_head2","jobName_head"),teasp.message.setLabelHtml("taskPercent_head2","taskPercent_head"),teasp.message.setLabelHtml("taskTime_head2","taskTime_head"),teasp.message.setLabelHtml("taskTimeTotal_label"),dojo.byId(
"printOut_btn_title").firstChild.innerHTML=teasp.message.getLabel("printOut_btn_title"),dojo.byId("close_btn_title").firstChild.innerHTML=teasp.message.getLabel("close_btn_title"),dojo.byId("jobApplyApprove").firstChild.innerHTML=teasp.message.getLabel("tf10000270"),this.pouch.isDontFixJobMonthly()&&dojo.style(dojo.byId("status_label").parentNode.parentNode,"display","none")):(teasp.message.setLabelHtml(
"section_label"),teasp.message.setLabelHtml("empName_label"),teasp.message.setLabelHtml("status_label"),teasp.message.setLabelHtml("date_head"),teasp.message.setLabelHtml("task_head"),teasp.message.setLabelHtml("taskPercent_head"),teasp.message.setLabelHtml("taskTime_head"),teasp.message.setLabelHtml("jobSTitle","taskSummary_label"),teasp.message.setLabelHtml("task_head2","task_head"),teasp.message.setLabelHtml(
"taskPercent_head2","taskPercent_head"),teasp.message.setLabelHtml("taskTime_head2","taskTime_head"),teasp.message.setLabelHtml("taskTimeTotal_label"),teasp.message.setLabelEx("spanInputToHoliday","tk10004580"),dojo.query("td.ts-top-title > div.main-title").forEach(function(e){e.innerHTML=teasp.message.getLabel("tk10000430")},this),dojo.query("td.ts-top-title > div.sub-title").forEach(function(e){
e.innerHTML=teasp.message.getLabel("tf10004570")},this),teasp.message.setLabelTitle("help_link_title"),teasp.message.setLabelTitle("prevMonth_btn_title"),teasp.message.setLabelTitle("nextMonth_btn_title"),teasp.message.setLabelTitle("currMonth_btn_title"),dojo.byId("empTypeTitle").innerHTML=teasp.message.getLabel("empType_label"),dojo.byId("print_btn_title").firstChild.innerHTML=teasp.message.getLabel(
"print_btn_title"),dojo.byId("applyButton1").firstChild.innerHTML=teasp.message.getLabel("applyx_btn_title")),this.printFlag?this.pouch.isEmpJobApprover()&&(dojo.style("jobApplyApproveArea","display",""),e=this,dojo.connect(dojo.byId("jobApplyApprove"),"onclick",function(){teasp.manager.dialogOpen("Approval",{apply:{id:e.pouch.getJobApplyId()},objKey:"jobApply",refresh:!1},e.pouch,e,function(){location.reload()})})
):(dojo.query(".pb_btn_prevm").forEach(function(e){e.firstChild.innerHTML=teasp.message.getLabel("tf10000300"),dojo.connect(e,"onclick",this,this.changePrevMonth)},this),dojo.query(".pb_btn_currm").forEach(function(e){e.firstChild.innerHTML=teasp.message.getLabel("currMonth_btn_title"),dojo.connect(e,"onclick",this,this.changeCurrMonth)},this),dojo.query(".pb_btn_nextm").forEach(function(e){
e.firstChild.innerHTML=teasp.message.getLabel("tf10000310"),dojo.connect(e,"onclick",this,this.changeNextMonth)},this),dojo.query(".pb_btn_print").forEach(function(e){dojo.connect(e,"onclick",this,this.openPrintView)},this),t=dojo.query("#expTopView td.ts-top-photo > div")[0],(a=this.pouch.getSmallPhotoUrl())?dojo.create("img",{src:a,className:"smallPhoto"},t):dojo.create("img",{className:"pp_base pp_default_photo"},
t),a=dojo.byId("monthlyStatus"),dojo.empty(a),dojo.create("div",{className:"png-"+this.pouch.getJobApplyStatusIconClass()},a),dojo.create("div",{innerHTML:teasp.constant.getDisplayStatus(this.pouch.getJobApplyStatus(!0))},a),dojo.connect(dojo.byId("monthlyStatus"),"onclick",this,this.openStatusView),dojo.connect(dojo.byId("yearMonthList"),"onchange",this,this.changedMonthSelect),dojo.connect(dojo.byId(
"inputToHoliday"),"onclick",this,this.refreshMonthly),dojo.connect(dojo.byId("empListButton"),"onclick",this,this.openEmpList),this.viewPlus()),this.refreshMonthly(),this.resizeArea()},teasp.view.EmpWorks.prototype.resizeArea=function(){try{var e=dojo.window.getBox().w,t=dojo.byId("bodyCell");t&&(e-=t.offsetLeft),e<800&&(e=800)}catch(e){}},teasp.view.EmpWorks.prototype.refreshMonthly=function(){if(
this.pouch.clearClassifyJobWorks(),this.printFlag)try{var e=document.getElementsByTagName("title");e&&0<e.length&&(a=this.pouch.getJobYearMonth()+teasp.util.date.dispSubNo(this.pouch.getJobSubNo()),e[0].innerHTML=teasp.message.getLabel("tm40001020",a,this.pouch.getName()))}catch(e){}var H=this.printFlag?72:92,P=!1;for(l in this.eventHandles)this.eventHandles.hasOwnProperty(l)&&(dojo.disconnect(this.eventHandles[l]),
delete this.eventHandles[l]);this.printFlag?(dojo.byId("yearMonth").innerHTML=this.pouch.getJobYearMonthJp(),dojo.byId("monthlyStatus").innerHTML=teasp.constant.getDisplayStatus(this.pouch.getJobApplyStatus()),dojo.byId("empCode").innerHTML=this.pouch.getEmpCode()):(0<(e=dojo.query("td.ts-top-button3 > a",dojo.byId("expTopView"))).length&&(e[0].href=this.pouch.getHelpLink()),this.createMonthList(),
this.pouch.isEmpJobApprover()?(dojo.style("applyButton1","display",""),dojo.byId("applyButton1").className="std-button3",dojo.byId("applyButton1").firstChild.innerHTML=teasp.message.getLabel("tf10000270"),this.eventHandles.applyButton1=dojo.connect(dojo.byId("applyButton1"),"onclick",this,this.approveMonthly)):this.pouch.isDontFixJobMonthly()?(dojo.style("applyButton1","display","none"),dojo.style(dojo.byId(
"status_label").parentNode,"display","none"),dojo.style(dojo.byId("monthlyStatus").parentNode,"display","none")):this.pouch.isJobApplyable()&&!this.pouch.isReadOnly()?(dojo.style("applyButton1","display",""),dojo.byId("applyButton1").className="std-button1",dojo.byId("applyButton1").firstChild.innerHTML=teasp.message.getLabel(this.pouch.isUseJobWorkFlow()?"applyx_btn_title":"fix_btn_title"),
this.eventHandles.applyButton1=dojo.connect(dojo.byId("applyButton1"),"onclick",this,this.openExpApply)):(dojo.style("applyButton1","display",""),dojo.byId("applyButton1").className="std-button1-disabled",dojo.byId("applyButton1").firstChild.innerHTML=teasp.message.getLabel(this.pouch.isUseJobWorkFlow()?"applyx_btn_title":"fix_btn_title")),a=dojo.byId("monthlyStatus"),dojo.empty(a),dojo.create("div",{
className:"png-"+this.pouch.getJobApplyStatusIconClass()},a),dojo.create("div",{innerHTML:teasp.constant.getDisplayStatus(this.pouch.getJobApplyStatus(!0))},a),dojo.byId("empTypeName").innerHTML=this.pouch.getEmpTypeName(),P=this.pouch.isUseDailyApply()&&this.pouch.getObj().checkWorkingTime?(dojo.style("inputToHolidayDiv","display","none"),!1):(dojo.style("inputToHolidayDiv","display",""),dojo.byId("inputToHoliday"
).checked)),dojo.byId("department").innerHTML=this.pouch.getDeptName(),dojo.byId("empName").innerHTML=this.pouch.getName();for(var e=dojo.byId("jobTable"),t=e.getElementsByTagName("tbody")[0],a=(dojo.empty(t),this.pouch.getJobApply()),o=teasp.util.date.getDateList(a.startDate,a.endDate),C=this.pouch.getWorks(),W={},s={},i=0;i<o.length;i++){W[h=o[i]]={time:0,works:[],timeFixTime:0};for(var n=W[h],F=0;F<C.length;F++){
var Y,r=C[F];r.date==h&&(0<r.time||0<r.volume||""!=(r.taskNote||"")||""!=(r.progress||"")||""!=(r.extraItem1||"")||""!=(r.extraItem2||""))&&(n.works.push(r),n.time+=r.time,r.timeFix&&(n.timeFixTime+=r.time),L=r.process||"",(s[Y=r.jobId+":"+L]||(s[Y]={jobName:r.job.name,time:0,process:r.process,jobLeaderId:r.job.jobLeaderId})).time+=r.time)}}var l,p=this.pouch.isJobLeaderFilter()&&this.pouch.isOnlyJL(),d=[],q=0,B={},
V="ABCDEFGHIJKLMNO";for(l in s)!s.hasOwnProperty(l)||p&&s[l].jobLeaderId!=this.pouch.getSessionUserId()||(q+=s[l].time,d.push({jobId:l,jobName:s[l].jobName,time:s[l].time,process:s[l].process}));d.sort(function(e,t){return t.time-e.time});for(var c=0,i=0;i<d.length;i++)(M=d[i]).percent=Math.round(100*M.time/q),B[d[i].jobId]=V.substring(c,c+1),V.length<=++c&&(c=0);var m=0,K=!1,U=null;for(i=0;i<o.length;i++){var h,
n=W[h=o[i]],u=this.pouch.isDailyFixByDate(h),g=this.pouch.getObj().days[h],y=this.pouch.getJobWorkNote(h),J=P||g&&g.rack&&g.rack.inputable||0<n.works.length||y,f="number"==typeof g.startTime&&"number"==typeof g.endTime;if(p)for(var b=[],_=0;_<n.works.length;_++)n.works[_].job.jobLeaderId==this.pouch.getSessionUserId()&&b.push(n.works[_]);else b=n.works;var v=m%2==0?"even":"odd",T=((w=t.insertRow(-1)
).className=v+" day_border",w.insertCell(-1)),g=(T.className="date"+(this.printFlag?"":" date_label"+(u?"_lock":"")),teasp.util.date.parseDate(h)),u=g.getDate(),j=(null!==U&&g.getMonth()+1==U||(u=(U=g.getMonth()+1)+"/"+g.getDate()),dojo.create("div",{style:{margin:"0px 4px",width:"43px"},innerHTML:u},T));if(this.printFlag||this.pouch.isDisabledTimeReport()||(j.style.cursor="pointer",
j.title=teasp.util.date.formatDate(h,"M/d")+":"+teasp.message.getLabel("tm30001040"),this.eventHandles["d-"+h]=dojo.connect(j,"onclick",this,this.jumpToDaily(h))),T.rowSpan=2*b.length+(p?0:1)||1,(T=w.insertCell(-1)).className="yobi",T.innerHTML='<div style="margin:0px 4px;width:15px;">'+teasp.util.date.formatDate(h,"JPW")+"</div>",T.rowSpan=2*b.length+(p?0:1)||1,this.printFlag||(T=w.insertCell(-1),J&&(
T.className="edit",g=dojo.create("div",{style:"position:relative;"},T),u=this.setWarningMarker(g,h,n,f),J=dojo.create("input",{type:"button",id:"empJobEdit"+h,className:"png-add",style:{margin:"1px 8px"},title:u&&u.diff?u.msg:teasp.message.getLabel("empWorkEdit_btn_title")},g),this.eventHandles["empJobEdit"+h]=dojo.connect(J,"onclick",this,function(){var e=h;return function(){this.clickedEmpJob("empJobEdit"+e)}}()),
T.rowSpan=2*b.length+(p?0:1)||1)),b.length<=0)""==y||p?((T=w.insertCell(-1)).className="sharp",(T=w.insertCell(-1)).className="name",T.innerHTML="<div></div>",(T=w.insertCell(-1)).className="volume",(T=w.insertCell(-1)).className="time",(T=w.insertCell(-1)).className="worknote"+(this.printFlag?"p":""),T.innerHTML="<div></div>",T.style.textAlign="left"):((T=w.insertCell(-1)).colSpan=5,T.className="worknote",
T.innerHTML='<div class="worknote"> '+y+"</div>");else{for(var G=!1,c=0;c<b.length;c++)if(b[c].timeFix&&b[c].time){G=!0;break}var E=0;for(c=0;c<b.length+1;c++)if(c==b.length)p||(0<E&&((w=t.insertRow(-1)).className=v),(T=w.insertCell(-1)).colSpan=5,T.className="worknote",k=f?n.time:n.timeFixTime,T.innerHTML='<div class="worknote">'+teasp.message.getLabel("tm40001100",teasp.util.time.timeValue(k))+" "+y+"</div>",E++
);else{var L,k=this.pouch.getEmpWork(b[c]),D=k.getExtraItems(),I=(0<E&&((w=t.insertRow(-1)).className=v),(T=w.insertCell(-1)).className="sharp",T.rowSpan=2,T.innerHTML='<div class="sharp">'+(c+1)+"</div>",(T=w.insertCell(-1)).className="name",T.rowSpan=2,k.getProcessName()),A=(T.innerHTML='<div class="name">'+k.getJobName()+(""!=I?teasp.message.getLabel("tm10001470")+I:"")+"</div>",(T=w.insertCell(-1)
).className="volume",k.getTime()?k.getPercent(n.time):b[c].percent),A=(0<k.getTime()||!f&&!G?((j=document.createElement("div")).className="div_volume",L=k.getProcess()?k.getProcess():"",M=B[k.getJobId()+":"+L],O=this.getBarWidth(1,H,A/10),R=this.getBarWidth(2,H,A/10),N=this.getBarWidth(3,H,A/10),
j.innerHTML='<table class="pane_table" style="margin-left:2px;margin-right:2px;"><tr><td class="marker_'+M+'_L" style="width:'+O+'px;height:15px;"><img src="" class="volume_barL" style="width:'+O+'px;height:15px;" /></td><td class="marker_'+M+'_M" style="width:'+R+'px;height:15px;"><img src="" class="volume_barM" style="width:'+R+'px;height:15px;" /></td><td class="marker_'+M+'_R" style="width:'+N+'px;height:15px;"><img src="" class="volume_barR" style="width:'+N+'px;height:15px;" /></td></tr></table>'
,T.appendChild(j)):0<k.getVolume()&&(T.style.whiteSpace="nowrap",T.innerHTML='<span style="font-size:13px;">'+teasp.message.getLabel("tm20002060")+"</span>"),(T=w.insertCell(-1)).className="time",0),A=(!b[c].timeFix&&!f&&0<k.getVolume()&&(A=G?1:2),T.innerHTML=0==A?'<div class="time">'+teasp.util.time.timeValue(k.getTime())+"</div>":1==A?'<div class="time">'+teasp.message.getLabel("tm20002050"
)+"</div>":'<div class="percent">'+Math.round(b[c].percent/10)+"%</div>",k.getProgress());if(!K&&A&&(K=!0),(T=w.insertCell(-1)).className="progress",T.innerHTML='<div class="progress">'+A+"</div>",E++,(w=t.insertRow(-1)).className=v,(T=w.insertCell(-1)).className="tasknote",T.colSpan=3,0<D.length){for(var S=0;S<D.length;S++){var z,x=D[S];x&&(dojo.create("div",{className:"extraItem",style:{float:"left"},
innerHTML:x.name?x.name+" : ":""},T),z={float:"left"},0==S&&D[1]&&(z.marginRight="10px"),dojo.create("div",{className:"extraItem",style:z,innerHTML:teasp.util.entitize(x.value||"","")},T))}dojo.create("div",{style:{clear:"both"}},T)}dojo.create("div",{className:"tasknote",innerHTML:this.pouch.convNoteString(teasp.util.entitize(k.getTaskNote(),""))},T)}}m++}if(0<t.rows.length){var w=t.rows[0];for(dojo.style(w,
"border-top","none"),i=0;i<w.cells.length;i++)T=w.cells[i],dojo.style(T,"border-top","none")}for(dojo.byId("workReport_label").innerHTML=K||0<this.pouch.getProgressList().length?teasp.message.getLabel("progress_head"):"",t=(e=dojo.byId("jobSumTable")).getElementsByTagName("tbody")[0],dojo.empty(t),m=0;m<d.length;m++){var M,O,R,N,X,w=dojo.create("tr",{className:m%2==0?"even":"odd"},t),I=d[m].jobName;d[m].process&&(
I+=teasp.message.getLabel("tm10001470")+d[m].process),dojo.create("div",{style:{margin:"2px 4px",wordBreak:"break-all",textAlign:"left"},innerHTML:I},dojo.create("td",{className:"name"},w)),T=dojo.create("td",{className:"volume"},w),0<d[m].percent&&(M=B[d[m].jobId],O=this.getBarWidth(1,212,d[m].percent),R=this.getBarWidth(2,212,d[m].percent),N=this.getBarWidth(3,212,d[m].percent),X=dojo.create("tr",null,dojo.create(
"tbody",null,dojo.create("table",{style:{margin:"2px"},className:"pane_table"},dojo.create("div",null,T)))),dojo.create("img",{src:"",className:"volume_barL",style:{width:O+"px",height:"15px"}},dojo.create("td",{className:"marker_"+M+"_L",style:{width:O+"px",height:"17px"}},X)),dojo.create("img",{src:"",className:"volume_barM",style:{width:R+"px",height:"15px"}},dojo.create("td",{className:"marker_"+M+"_M",style:{
width:R+"px",height:"17px"}},X)),dojo.create("img",{src:"",className:"volume_barR",style:{width:N+"px",height:"15px"}},dojo.create("td",{className:"marker_"+M+"_R",style:{width:N+"px",height:"17px"}},X))),dojo.create("div",{style:{margin:"2px 4px"},innerHTML:teasp.util.time.timeValue(d[m].time)},dojo.create("td",{className:"time"},w))}if(0<t.rows.length){w=t.rows[0];for(dojo.style(w,"border-top","none"),
i=0;i<w.cells.length;i++)T=w.cells[i],dojo.style(T,"border-top","none")}(t=(e=dojo.byId("jobSFoot")).getElementsByTagName("tbody")[0]).rows[0].cells[1].innerHTML='<div style="margin:2px 4px;">'+teasp.util.time.timeValue(q)+"</div>"},teasp.view.EmpWorks.prototype.setWarningMarker=function(e,t,a,o){if(!this.pouch.isWarningOnMAPHW())return null;var t=this.pouch.getJobWorkRealTime(t),s=!1;return o?s=a.time!=t:a.time&&(
s=!0),s&&(e.title=teasp.message.getLabel("tf10008580"),dojo.create("div",{className:"pp_base pp_exclamatio2",style:"position:absolute;left:2px;top:3px;"},e)),{diff:s,msg:s?teasp.message.getLabel("tf10008580"):null}},teasp.view.EmpWorks.prototype.getBarWidth=function(e,t,a){t=Math.round(t*a/100);return 1==e||3==e?14<t?7:t/2:t<=14?0:t-14},teasp.view.EmpWorks.prototype.jumpToDaily=function(e){var t=e;return function(){
var e=teasp.util.date.formatDate(t,"yyyyMMdd");teasp.locationHref(teasp.getPageUrl("timeReportView")+"?empId="+this.pouch.getEmpId()+"&date="+e+"&mode="+this.pouch.getMode())}},teasp.view.EmpWorks.prototype.createMonthList=function(){for(var e=teasp.util.date.formatDate(this.pouch.getJobStartDate(),"yyyyMMdd"),t=this.pouch.getJobMonthList(teasp.util.date.getToday(),1,-12),a=-1,o=0;o<t.length;o++)if((i=t[o]
).yearMonthEx==e){a=o;break}a<0&&t.push(this.pouch.getJobMonth(this.pouch.getJobYearMonth(),null,null));var t=t.sort(function(e,t){return e.startDate<t.startDate?1:-1}),s=dojo.byId("yearMonthList");dojo.empty(s);for(o=0;o<t.length;o++){var i=t[o],n=Math.floor(i.yearMonth/100),r=i.yearMonth%100,n=teasp.util.date.formatMonth("zv00000021",n,r,i.subNo);dojo.create("option",{value:i.yearMonthEx,innerHTML:n},s)}s.value=e},
teasp.view.EmpWorks.prototype.openExpApply=function(){for(var e,t=this.pouch.getJobApply(),a=teasp.util.date.getDateList(t.startDate,t.endDate),o=[],s={},i=0;i<a.length;i++){var n,r,l=a[i],l=this.pouch.getEmpMonthByDate(l);s[l.yearMonth]||(s[l.yearMonth]=1,(l.config.useDailyApply&&l.config.checkWorkingTime||l.config.checkWorkingTimeMonthly)&&!teasp.constant.STATUS_FIX.contains(l.apply.status)&&(n=Math.floor(
l.yearMonth/100),r=l.yearMonth%100,l=l.subNo,o.push(teasp.util.date.formatMonth("zv00000020",n,r,l))))}0<o.length?teasp.tsAlert(teasp.message.getLabel("tk10005000",o.join(teasp.message.getLabel("tm10001540"))),this):(e=dojo.hitch(this,function(){var e={title:teasp.message.getLabel("tm40001060"),buttonType:this.pouch.isUseJobWorkFlow()?0:1,descript:"",applyKey:teasp.constant.APPLY_KEY_JOBAPPLY,warning:null};
this.pouch.isUseJobWorkFlow()?e.descript=teasp.message.getLabel("tm40001070",this.pouch.getJobYearMonthJp()):e.descript=teasp.message.getLabel("tm40001080",this.pouch.getJobYearMonthJp()),teasp.manager.dialogOpen("ApplyComment",e,this.pouch,this,function(e){teasp.manager.request("submitJobApply",{empId:this.pouch.getEmpId(),month:this.pouch.getJobYearMonth(),startDate:this.pouch.getJobStartDate(),comment:e.comment},
this.pouch,{hideBusy:!1},this,function(){this.refreshMonthly()},function(e){teasp.message.alertError(e)})})}),(this.pouch.getWorks()||[]).length?e():teasp.tsConfirmA(teasp.message.getLabel("tf10008160",this.pouch.isUseJobWorkFlow()?teasp.message.getLabel("applyx_btn_title"):teasp.message.getLabel("fix_btn_title")),this,function(){e()}))},teasp.view.EmpWorks.prototype.approveMonthly=function(){
var e=this.pouch.getJobApply();teasp.manager.dialogOpen("Approval",{apply:{id:e.id},objKey:"jobApply",refresh:!0},this.pouch,this,function(){this.refreshMonthly()})},teasp.view.EmpWorks.prototype.openStatusView=function(){var t=this.pouch.getJobApply();t&&t.id&&(!t.steps||t.steps.length<=0)?teasp.manager.request("getJobApplySteps",{empId:this.pouch.getEmpId(),month:this.pouch.getJobYearMonth(),
subNo:this.pouch.getJobSubNo()},this.pouch,{hideBusy:!1},this,function(e){t.steps=("object"==typeof e?e.steps:e)||[],this.openStatusDialog(t)},function(e){teasp.message.alertError(e)}):this.openStatusDialog(t)},teasp.view.EmpWorks.prototype.changedMonthSelect=function(){var e=dojo.byId("yearMonthList"),e=teasp.util.date.formatDate(teasp.util.date.parseDate(e.value));return this.changeMonth(this.pouch.getJobMonth(null
,e))},teasp.view.EmpWorks.prototype.changePrevMonth=function(){return this.changeMonth(this.pouch.getJobMonth(null,this.pouch.getJobStartDate(),-1))},teasp.view.EmpWorks.prototype.changeCurrMonth=function(){return this.changeMonth(this.pouch.getJobMonth(null,teasp.util.date.getToday()))},teasp.view.EmpWorks.prototype.changeNextMonth=function(){return this.changeMonth(this.pouch.getJobMonth(null,
this.pouch.getJobStartDate(),1))},teasp.view.EmpWorks.prototype.changeMonth=function(e){return document.body.style.cursor="wait",teasp.manager.request("transJobMonth",{empId:this.pouch.getEmpId(),month:e.yearMonth,startDate:teasp.util.date.formatDate(e.startDate,"yyyyMMdd")},this.pouch,{hideBusy:!1},this,function(){this.refreshMonthly(),document.body.style.cursor="default"},function(e){
document.body.style.cursor="default",teasp.message.alertError(e)}),!1},teasp.view.EmpWorks.prototype.openStatusDialog=function(e){var t=!(!e||!e.status||!teasp.constant.STATUS_FIX.contains(e.status)&&!teasp.constant.STATUS_REJECTS.contains(e.status)),a=0;this.pouch.isUseJobWorkFlow()&&(a=teasp.constant.STATUS_APPROVES.contains(e.status)?2:teasp.constant.STATUS_REJECTS.contains(e.status)?3:1),teasp.manager.dialogOpen(
"Status",{apply:e,removable:t&&!this.pouch.isReadOnly(),removeButtonType:a,cancelApply:this.requestCancelJobApply},this.pouch,this,function(e){this.refreshMonthly()})},teasp.view.EmpWorks.prototype.requestCancelJobApply=function(e,t,a){e=teasp.constant.STATUS_REJECTS.contains(e.status)?"tm40001091":"tm40001090";teasp.tsConfirmA(teasp.message.getLabel(e,this.pouch.getJobYearMonthJp()),this,function(){
teasp.manager.request("cancelJobApply",{empId:this.pouch.getEmpId(),month:this.pouch.getJobYearMonth(),startDate:this.pouch.getJobStartDate(),date:this.pouch.getJobStartDate()},this.pouch,{hideBusy:!1},this,t,a)})},teasp.view.EmpWorks.prototype.openPrintView=function(){var e,t=screen.availHeight||800,a=(800<t&&(t=800),teasp.getPageUrl("empJobPrintView")+"?empId="+this.pouch.getEmpId(
)+"&date="+teasp.util.date.formatDate(this.pouch.getJobStartDate(),"yyyyMMdd")+"&mode=read");teasp.isSforce1()?sforce.one.navigateToURL(a):(e=window.open(a,"print","width=700,height="+t+",resizable=yes,scrollbars=yes"),setTimeout(function(){e.resizeTo(710,t)},100))},teasp.view.EmpWorks.prototype.clickedEmpJob=function(e){var t,e=/^empJobEdit(.+)$/.exec(e);e&&(e=e[1],t=this.pouch.getClassifyJobWorks(e),
teasp.manager.dialogOpen("WorkBalance",{date:e,jobMonth:this.pouch.getJobYearMonth(),workRealTime:this.pouch.getJobWorkRealTime(e),worked:this.pouch.isWorked(e),workNote:this.pouch.getJobWorkNote(e,!0),zanteiFlag:!1,classifyJobWorks:dojo.clone(t),reflectWorkOption:null,monthFix:this.pouch.isMonthFixByDate(e),dayFix:this.pouch.isDailyFixByDate(e),client:teasp.constant.APPLY_CLIENT_EMP_WORK},this.pouch,this,function(e,
t,a){a||this.refreshMonthly()}))},teasp.view.EmpWorks.prototype.setImagePath=function(e,t,a){this.imageMap[e+t]=a},teasp.view.EmpWorks.prototype.setImageSrc=function(e,o){dojo.query(e).forEach(function(e){var t,a=/marker_(.)_([LMR])/.exec(e.parentNode.className);a&&(t=a[1],a=a[2],o==a&&(e.src=this.imageMap[a+t]))},this)},teasp.view.EmpWorks.prototype.openEmpList=function(){this.pouch.getDeptCode();
var e=this.pouch.getParamByKey("mode")||"",t=(screen.availHeight,this.pouch.getObj().sessionInfo),t=teasp.getPageUrl("deptRefView")+"?type=Job&empId="+(t&&t.emp&&t.emp.id||this.pouch.getEmpId())+"&deptId="+this.pouch.getDeptId()+"&month="+this.pouch.getJobYearMonth()+"&subNo="+(this.pouch.getJobSubNo()||"")+(e?"&mode="+e:"");teasp.isSforce1()?sforce.one.navigateToURL(t):(e=window.open(t,"empTable",
"width=690,height=340,resizable=yes,scrollbars=yes"))&&e.focus()},teasp.provide("teasp.view.Monthly"),teasp.view.Monthly=function(){this.rangeYear=null,this.viewPos=null,this.eventHandles=[],this.empWorkIn=!0,this.graph=null,this.workLocIn=!1,this.empAccsIn=!1,this.empWorkIn=!1,this.workLocWidth=87,this.empAccsWidth=45,this.empWorkWidth=45,this.gw1off=0,this.gw2off=0,this.gw3off=0},
teasp.view.Monthly.prototype=new teasp.view.Base,teasp.view.Monthly.prototype.init=function(e,t,a){teasp.message.mergeLabels(globalMessages||{}),teasp.message.mergeLabels(e&&e[teasp.message.getLanguageLocaleKey()]||{}),this.readParams({target:"empMonth",noDelay:!0}),this.viewParams.debug&&teasp.manager.testInit("tsfArea"),teasp.manager.request("loadEmpMonth",this.viewParams,this.pouch,{hideBusy:!0},this,function(){
this.pouch.isOldRevision()?teasp.locationHref(teasp.getPageUrl("convertView")+"?forwardURL="+encodeURIComponent(teasp.getPageUrl("workTimeView"))):this.pouch.getEmpId()?this.initMonthly():teasp.locationHref(teasp.getPageUrl("empRegistView")+"?forwardURL="+encodeURIComponent(teasp.getPageUrl("workTimeView"))),t()},function(e){a(e)})},teasp.view.Monthly.prototype.initMonthly=function(){teasp.setDeviceWidth(),
this.empWorkIn=this.pouch.isInputWorkingTimeOnWorkTImeView(),this.empAccsIn=this.pouch.isInputAccessControl(!0),this.workLocIn=this.pouch.isUseWorkLocation(!0);var e=this.buildMainTable(),e=(dojo.place(e,dojo.byId("mainTableArea")),teasp.isNarrow()?(dojo.style(dojo.body(),{overflow:"visible"}),dojo.query(".normal-width").forEach(function(e){dojo.style(e,"display","none")}),dojo.toggleClass("largeTableTop",
"ts-top-desktop",!1),dojo.toggleClass("largeTableTop","ts-top-mobile",!0),dojo.style("mainTableArea","padding","0px"),dojo.style("mainTableBottom","padding","0px"),dojo.style("bottomSummaryTable","width","100%"),dojo.style("ts1TopView","display",""),dojo.query("div.main-title").forEach(function(e){e.innerHTML=teasp.message.getLabel("workTable_label")},this)):(dojo.style("expTopView","display",""),dojo.toggleClass(
"largeTableTop","ts-top-desktop",!0),dojo.toggleClass("largeTableTop","ts-top-mobile",!1),dojo.query("td.ts-top-title > div.main-title").forEach(function(e){e.innerHTML=teasp.message.getLabel("workTable_label")},this),dojo.query("td.ts-top-title > div.sub-title").forEach(function(e){e.innerHTML=teasp.message.getLabel("tf10004550")},this)),dojo.query("td.ts-top-empinfo td.ts-top-info-l > div.dept-name").forEach(
function(e){e.innerHTML=teasp.message.getLabel("dept_label")}),dojo.query("td.ts-top-empinfo td.ts-top-info-l > div.emptype-name").forEach(function(e){e.innerHTML=teasp.message.getLabel("empType_label")}),dojo.query("td.ts-top-empinfo td.ts-top-info-l > div.emp-name").forEach(function(e){e.innerHTML=teasp.message.getLabel("empName_label")}),dojo.byId("prevMonthButton").innerHTML=teasp.message.getLabel(teasp.isNarrow(
)&&teasp.isEnglish()?"tf10000301":"tf10000300"),dojo.byId("currMonthButton").innerHTML=teasp.message.getLabel("currMonth_btn_title"),dojo.byId("nextMonthButton").innerHTML=teasp.message.getLabel(teasp.isNarrow()&&teasp.isEnglish()?"tf10000311":"tf10000310"),dojo.byId("monthlyApplyButtonLabel").innerHTML=teasp.message.getLabel(teasp.isNarrow()?"mo00000009":"mo00000001"),dojo.query("div.info-cn").forEach(function(e){
e.innerHTML=teasp.message.getLabel("info_btn_title")}),dojo.query("button.monthlySum > div").forEach(function(e){e.innerHTML=teasp.message.getLabel(teasp.isNarrow()&&teasp.isEnglish()?"monthSummary_btn_omit":"monthSummary_btn_title")}),dojo.query(".pb_btn_prevm").forEach(function(e){dojo.connect(e,"onclick",this,this.changePrevMonth),e.title=teasp.message.getLabel("prevMonth_button_title")},this),dojo.query(
".pb_btn_currm").forEach(function(e){dojo.connect(e,"onclick",this,this.changeCurrMonth),e.title=teasp.message.getLabel("currMonth_button_title")},this),dojo.query(".pb_btn_nextm").forEach(function(e){dojo.connect(e,"onclick",this,this.changeNextMonth),e.title=teasp.message.getLabel("nextMonth_button_title")},this),dojo.query("button.apply-button").forEach(function(e){e.style.display="none"},this),dojo.query(
".infoButton").forEach(function(e){dojo.connect(e,"onclick",this,this.openInfoView),e.title=teasp.message.getLabel("info_button_title")},this),dojo.query("button.monthlySum").forEach(function(e){dojo.style(e,"display",this.pouch.isHideMonthlySummary()?"none":""),this.pouch.isHideMonthlySummary()||(dojo.connect(e,"onclick",this,this.openPrintView),e.title=teasp.message.getLabel("monthSummary_button_title"))},this),
dojo.connect(dojo.byId("monthlyStatus"),"onclick",this,this.openStatusView),dojo.byId("monthlyStatusH").innerHTML=teasp.isNarrow()?"":teasp.message.getLabel("status_label"),dojo.byId("monthlyStatus").title=teasp.message.getLabel("status_button_title"),dojo.style("bottomSummaryTable","display",this.pouch.isHideBottomSummary()?"none":""),dojo.query(teasp.isNarrow()?"#ts1TopPhoto":"#expTopView td.ts-top-photo > div")[0]
),t=this.pouch.getSmallPhotoUrl(),a=null,a=t?dojo.create("img",{src:t,className:"smallPhoto"},e):dojo.create("img",{className:"pp_base pp_default_photo"},e),e=(teasp.isNarrow()?(this.toolTipOn=!1,dijit.Tooltip.showDelay=0,dijit.Tooltip.hideDelay=0,dojo.connect(a,"onclick",this,function(){var e;this.toolTipOn?dijit.Tooltip.hide(dojo.byId("ts1TopPhoto")):(e="",this.pouch.isHidePersonalInfo()||(
e+='<div id="ts1TopPersonalInfo"><a href="#" onclick="teasp.viewPoint.openEmpView();return false;">'+teasp.message.getLabel("personal_link_title")+"</a></div>"),e+='<div id="ts1TopHolidayInfo"><a href="#" onclick="teasp.viewPoint.openHolidayView();return false;">'+teasp.message.getLabel("tk10003220")+'</a></div><div id="ts1TopHelp"><a href="'+this.pouch.getHelpLink()+'">HELP</a></div>',dijit.Tooltip.show(e,dojo.byId(
"ts1TopPhoto"))),this.toolTipOn=!this.toolTipOn}),dojo.connect(dojo.byId("ts1TopPhoto"),"onmouseleave",this,function(){this.toolTipOn&&(dijit.Tooltip.hide(dojo.byId("ts1TopPhoto")),this.toolTipOn=!this.toolTipOn)}),dojo.connect(dojo.byId("empListButton2"),"onclick",this,this.openEmpList)):(this.pouch.isHidePersonalInfo()||(dojo.style(a,"cursor","pointer"),dojo.connect(a,"onclick",this,this.openEmpView),
a.title=teasp.message.getLabel("personal_link_title")),(t=dojo.query("#holyLink > div"))&&(t[0].innerHTML=teasp.message.getLabel("tf10003620")),dojo.connect(dojo.byId("holyLink"),"onclick",this,this.openHolidayView),dojo.connect(dojo.byId("empListButton"),"onclick",this,this.openEmpList)),dojo.query("td.ts-top-button3 > a",dojo.byId("expTopView"))),o=(0<e.length&&(e[0].href=this.pouch.getHelpLink()),dojo.connect(
dojo.byId("yearMonthList"),"onchange",this,this.changedMonthSelect),this.pouch.isBulkInputOn()&&(dojo.byId("startTimeColumn").style.cursor="pointer",dojo.byId("endTimeColumn").style.cursor="pointer",dojo.connect(dojo.byId("startTimeColumn"),"onclick",this,this.openBulkInput),dojo.connect(dojo.byId("endTimeColumn"),"onclick",this,this.openBulkInput)),this.viewParams.verify&&this.pouch.setAutoVerify(!0),
this.pouch.isAutoVerify()&&dojo.query("#expTopView .ts-top-logo div.work-list").forEach(function(e){dojo.style(e,"cursor","pointer"),dojo.connect(e,"click",this,this.openVerify)},this),dojo.byId("dateColumn").innerHTML=teasp.message.getLabel("date_head"),dojo.byId("stateColumn").innerHTML=teasp.message.getLabel("state_head"),dojo.byId("applyColumn").innerHTML=teasp.message.getLabel("apply_head"),dojo.byId(
"startTimeColumn").innerHTML=teasp.message.getLabel("startTime_head"),dojo.byId("endTimeColumn").innerHTML=teasp.message.getLabel("endTime_head"),dojo.byId("teleworkColumn").innerHTML=teasp.message.getLabel("tw00000010"),dojo.byId("accColumn").innerHTML=teasp.message.getLabel("ac00000280"),dojo.byId("jobColumn").innerHTML=teasp.message.getLabel("jobTime_head"),dojo.byId("noteColumn").innerHTML=teasp.message.getLabel(
"note_head"),this.gw1off=this.empWorkIn?this.empWorkWidth:0,this.gw2off=this.empAccsIn?this.empAccsWidth:0,this.gw3off=this.workLocIn?this.workLocWidth:0,dojo.byId("graphDiv")),a=(o&&(dojo.connect(o,"onmousedown",this,function(e){e=e||window.event;this.viewPos={x:e.clientX}}),dojo.connect(o,"onmousemove",this,function(e){this.viewPos&&(e=e||window.event,o.scrollLeft-=e.clientX-this.viewPos.x,this.viewPos.x=e.clientX)
}),dojo.connect(o,"onmouseup",this,function(e){this.viewPos=null})),this.refreshMonthly(),dojo.query(".inputime").forEach(function(e){dojo.connect(e,"blur",this,teasp.util.time.onblurTime),dojo.connect(e,"onkeypress",this,teasp.util.time.onkeypressTime)},this),this.disposeInit(dojo.hitch(this,function(e){e?0<this.pouch.getAllInfoCount()?(function(){this.pouch.isNonDialogMode()||teasp.isSforce1(
)||this.pouch.isNotInfoAutoView()?dojo.query("div.info-icon").forEach(function(e){dojo.toggleClass(e,"info-an",!0),dojo.toggleClass(e,"info-bl",!1)}):this.openInfoView()}.apply(this),teasp.manager.dialogClose("BusyWait")):dojo.isIE<=7?(teasp.manager.dialogOpen("BusyWait",null,null),setTimeout(function(){teasp.manager.dialogClose("BusyWait")},500)):teasp.manager.dialogClose("BusyWait"):teasp.manager.dialogClose(
"BusyWait")})),setTimeout(dojo.hitch(this,this.resizeArea),50),dojo.byId("handlebarContainer"));a&&dojo.connect(a,"onclick",this,function(){setTimeout(dojo.hitch(this,this.resizeArea),50)}),dojo.style("largeTable","display",""),this.viewPlus(),this.viewPostProcess()},teasp.view.Monthly.prototype.resizeArea=function(){if(dojo.byId("graphDiv"))try{var e,t=window.innerWidth;if(this.prevWidth&&Math.abs(this.prevWidth-t
)<10)return;teasp.isSforce1()||((e=dojo.byId("bodyCell"))&&(t-=e.offsetLeft),t<768&&(t=768));var a=t-(508+(teasp.isSforce1()?0:8)+this.gw1off+this.gw2off+this.gw3off);976<a&&(a=976),this.prevWidth=t,dojo.query(".graph_area").forEach(function(e){e.style.width=a+"px",dojo.byId("graphDiv").style.width=a+"px"},this)}catch(e){}},teasp.view.Monthly.prototype.adjustGraphAreaScroll=function(){var e,t=dojo.byId("graphDiv");
t&&(e=t.offsetWidth,e=Math.max(0,140-(!e||e<=380?0:e-380)),t.scrollLeft=e)},teasp.view.Monthly.prototype.cleanupEmpReject=function(e,t,a){teasp.manager.request("cleanupEmpReject",{empId:this.pouch.getEmpId(),month:e.month,currMonth:this.pouch.getYearMonth(),currSubNo:this.pouch.getSubNo(),accLog:this.pouch.isInputAccessControl()},this.pouch,{hideBusy:!0},this,t,a)},
teasp.view.Monthly.prototype.cleanupDirectApply=function(e,t,a){for(var o,s,i=[],n={},r=0;r<e.length;r++){var l=e[r];if(l.directFlag&&!l.entered)for(var p=teasp.util.date.getDateList(l.startDate,l.endDate),d=l.directFlag,c=0;c<p.length;c++){var m=p[c];(h=this.pouch.getEmpDay(m)).isValid()&&(""===(u=h.getStartTime(!0,null,teasp.constant.C_REAL))&&(u=null),""===(g=h.getEndTime(!0,null,teasp.constant.C_REAL))&&(g=null),
b=2&d?null:g,u==(f=1&d?null:u)&&g==b||(y=h.createTimeTable(f,b),i.push({date:m,timeTable:y,empApplyId:l.id,clearWorkLocation:!(l.applyType!=teasp.constant.APPLY_TYPE_KYUSHTU||!h.getWorkLocationId()||f||b)}),n[m]=1))}}for(r=0;r<e.length;r++){var h,l=e[r];if(!l.directFlag&&!n[l.startDate])if((h=this.pouch.getEmpDay(l.startDate)).isValid()){""===(u=h.getStartTime(!0,null,teasp.constant.C_REAL))&&(u=null),""===(
g=h.getEndTime(!0,null,teasp.constant.C_REAL))&&(g=null);for(var u,g,d=h.getInputLimit().flag,y=h.createTimeTableFix(d),f=null,b=null,c=0;c<y.length;c++)if(1==y[c].type){f=y[c].from,b=y[c].to;break}u==f&&g==b||(i.push({date:l.startDate,timeTable:y,clearWorkLocation:!(l.applyType!=teasp.constant.APPLY_TYPE_KYUSHTU||!h.getWorkLocationId()||f||b)}),n[l.startDate]=1)}}i.length<=0?t.apply(this):(o=0,s=null,(s=dojo.hitch(
this,function(){var e={empId:this.pouch.getEmpId(),month:this.pouch.getYearMonth(),startDate:this.pouch.getStartDate(),lastModifiedDate:this.pouch.getLastModifiedDate(),mode:this.pouch.getMode(),date:i[o].date,dayFix:!1,client:teasp.constant.APPLY_CLIENT_MONTHLY,timeTable:i[o].timeTable,refreshWork:!0,clearWork:!1,empApplyId:i[o].empApplyId||null,useInputAccessControl:this.pouch.isInputAccessControl()};
i[o].clearWorkLocation&&(e.workLocationId=null),teasp.manager.request("inputTimeTable",e,this.pouch,{hideBusy:!0},this,function(){++o<i.length?setTimeout(s,100):t.apply(this)},a)}))())},teasp.view.Monthly.prototype.reviseApplyEnter=function(e,t,a){for(var o=this.pouch.getEmpDay(e.startDate).getReviseTimeTable(e),s=!1,i=0;i<o.length;i++){var n=o[i];if(
1==n.type&&"number"==typeof n.from&&"number"==typeof n.to&&n.from>=n.to){s=!0;break}}teasp.manager.request("inputTimeTable",{empId:this.pouch.getEmpId(),month:this.pouch.getYearMonth(),startDate:this.pouch.getStartDate(),lastModifiedDate:this.pouch.getLastModifiedDate(),mode:this.pouch.getMode(),date:e.startDate,dayFix:!1,client:teasp.constant.APPLY_CLIENT_MONTHLY,timeTable:o,empApplyId:e.id,ngFlag:s,
refreshWork:this.pouch.isInputWorkingTimeOnWorkTImeView(),useInputAccessControl:this.pouch.isInputAccessControl()},this.pouch,{hideBusy:!0},this,t,a)},teasp.view.Monthly.prototype.disposeInit=function(t){var e=[],a=0,o=!1,s=dojo.hitch(this,function(){a>=e.length?(0<a&&(o?this.changeMonth(this.pouch.dataObj.month):(this.refreshMonthly2(),setTimeout(function(){teasp.manager.dialogClose("BusyWait")},500))),t(!0)):(
0==a&&teasp.manager.dialogOpen("BusyWait",null,null),e[a++]())}),i=this.pouch.getDirtyApplys(),o=i.reload;0<i.directs.length&&e.push(dojo.hitch(this,function(){var e=i.directs;return dojo.hitch(this,function(){this.cleanupDirectApply(e,function(){setTimeout(dojo.hitch(this,s),100)},function(e){teasp.message.alertError(e),t(!1)})})})()),0<i.lst.length&&e.push(dojo.hitch(this,function(){var e=i;return dojo.hitch(this,
function(){this.cleanupEmpReject(e,function(){setTimeout(dojo.hitch(this,s),100)},function(e){teasp.message.alertError(e),t(!1)})})})());for(var n=this.pouch.getReviseTimeApplys(),r=0;r<n.length;r++)e.push(dojo.hitch(this,function(){var e=n[r];return dojo.hitch(this,function(){this.reviseApplyEnter(e,function(){e.entered=!0,setTimeout(dojo.hitch(this,s),100)},function(e){teasp.message.alertError(e),t(!1)})})})());s()
},teasp.view.Monthly.prototype.refreshMonthly=function(e){this.pouch.clearClassifyJobWorks(),dojo.query(".atk_link_help").forEach(function(e){e.href=this.pouch.getHelpLink()},this),this.rangeYear=this.pouch.getDateRangeOfMonth(teasp.util.date.getToday(),13,-12),this.createMonthList(),this.refreshContents(),this.viewPostProcess(),this.resizeArea(),e?this.disposeInit(function(){teasp.manager.dialogClose("BusyWait"),
teasp.manager.testSignal()}):teasp.manager.testSignal()},teasp.view.Monthly.prototype.refreshMonthly2=function(){this.pouch.clearClassifyJobWorks(),this.refreshContents(),this.viewPostProcess(),teasp.manager.testSignal()},teasp.view.Monthly.prototype.refreshContents=function(){for(var e,t=0,a=(this.empWorkIn=this.pouch.isInputWorkingTimeOnWorkTImeView(),this.empAccsIn=this.pouch.isInputAccessControl(!0),
this.workLocIn=this.pouch.isUseWorkLocation(!0),dojo.byId("mainTableBody")),o=this.pouch.getMonthDateList(),s=this.pouch.isDiscretionaryOption()?teasp.constant.C_REAL:teasp.constant.C_DISC,i=dojo.byId("graphTable"),n=(dojo.byId("ruler2"),this.pouch.isEmpMonthFixed()||this.pouch.isReadOnly()),r=this.pouch.isHighlightLateEarly(),l=this.pouch.isCheckWorkingTime()||this.pouch.isCheckWorkingTimeMonthly(),p=(dojo.query(
"td.hacc,td.vacc,#accColumnProp",dojo.byId("mainTable")).forEach(function(e){dojo.style(e,"display",this.empAccsIn?"":"none")},this),dojo.query("td.htelework,td.vtelework,#telColumnProp",dojo.byId("mainTable")).forEach(function(e){dojo.style(e,"display",this.workLocIn?"":"none")},this),dojo.query("td.hjob,td.vjob,#jobColumnProp",dojo.byId("mainTable")).forEach(function(e){dojo.style(e,"display",
this.empWorkIn?"":"none")},this),this.gw1off=this.empWorkIn?this.empWorkWidth:0,this.gw2off=this.empAccsIn?this.empAccsWidth:0,this.gw3off=this.workLocIn?this.workLocWidth:0,a.rows[0]),d=0;d<this.eventHandles.length;d++)dojo.disconnect(this.eventHandles[d]),delete this.eventHandles[d];for(this.eventHandles=[],teasp.manager.testReset(),e=0;e<o.length;e++){var c=o[e],m=this.pouch.getEmpDay(c),h=m.isExistApply(
teasp.constant.APPLY_KEY_DAILY),u=this.pouch.isAlive(c),g={dkey:c},y=teasp.util.date.parseDate(c),f=""+y.getDate(),b=(t!=y.getMonth()+1&&(f=y.getMonth()+1+"/"+f,t=y.getMonth()+1),m.getStartTimeJudge()),_=m.getEndTimeJudge();(p=a.rows[e+1]).id="dateRow"+c;var v,T,j,E=m.getDayType(),f=(0==(E=3!=m.getHolidayFlag()&&!m.isPlannedHoliday()?E:4)?(p.className="days "+(e%2==0?"even":"odd"),i&&(
i.rows[e+1].className="dayLine  "+(e%2==0?"dl_even":"dl_odd"))):(p.className="days rowcl"+E,i&&(i.rows[e+1].className="dayLine rowcl"+E)),dojo.style(p,"display",""),dojo.forEach(p.cells,function(e){dojo.removeClass(e,"bot-border")}),i&&(dojo.style(i.rows[e+1],"display",""),dojo.forEach(i.rows[e+1].cells,function(e){dojo.removeClass(e,"bot-border")})),j=dojo.query("td.vdate",p)[0],dojo.empty(j),E=dojo.create("div",{
style:{width:"51px",margin:"0px",padding:"0px",position:"relative"}},j),dojo.create("div",{innerHTML:f,style:{marginTop:"auto"}},E),m.getEmpApplyByKey(teasp.constant.APPLY_KEY_DAILY,!0)),f=(h?(v=dojo.create("div",{id:"ttvDayFix"+c,className:"dayFix ts-status-img ts-ap_day"+teasp.constant.getStatusStyleSuffix(m.getApplyStatus(teasp.constant.APPLY_KEY_DAILY)),style:{cursor:"pointer"},title:teasp.message.getLabel(
"tm10001690")+teasp.message.getLabel("tm10001680",teasp.constant.getDisplayStatus(m.getApplyStatus(teasp.constant.APPLY_KEY_DAILY)))},E),f&&(this.eventHandles.push(dojo.connect(v,"onclick",this,this.openEmpApply(c,f.id))),g.dayFixed=!0)):!n&&u&&m.isInputable()&&(E.style.height="20px",this.pouch.isUseDailyApply()&&this.pouch.isSeparateDailyFixButton()&&(v=dojo.create("div",{id:"ttvDayFix"+c,className:"dayFix png-add",
style:{cursor:"pointer"},title:teasp.message.getLabel("tm10001690")},E),this.eventHandles.push(dojo.connect(v,"onclick",this,this.applyDailyFix(c,f?f.id:null))),g.dayFixable=!0)),this.pouch.isDisabledTimeReport()||teasp.isNarrow()||teasp.isDisplayingPcVersionOnTs1()||(this.eventHandles.push(dojo.connect(j,"onclick",this,this.openTimeReport(teasp.util.date.formatDate(y,"yyyyMMdd")))),j.style.cursor="pointer",
j.title=teasp.message.getLabel("timeReport_link_title")),j.style.fontWeight=m.isToday()?"bold":"normal",(j=dojo.query("td.vweek",p)[0]).innerHTML=teasp.util.date.formatDate(c,"JPW"),this.pouch.isDisabledTimeReport()||teasp.isNarrow()||teasp.isDisplayingPcVersionOnTs1()||(this.eventHandles.push(dojo.connect(j,"onclick",this,this.openTimeReport(teasp.util.date.formatDate(y,"yyyyMMdd")))),j.style.cursor="pointer",
j.title=teasp.message.getLabel("timeReport_link_title")),j.style.fontWeight=m.isToday()?"bold":"normal",y.getDay()),f=(j.style.color=0==f?"red":6==f?"blue":"#222222",(j=dojo.query("td.vstatus",p)[0]).title=m.getDayTitle(),(E=j.firstChild).className=u?m.getDayIconClass():"",dojo.empty(E),m.isRestLack()&&(E.style.position="relative",dojo.create("div",{className:"statex pp_base pp_exclamation",
title:teasp.message.getLabel("tm10002130")},E)),(j=dojo.query("td.vapply",p)[0]).className="dval vapply",m.getTypicalEmpApply()),y=(!f||f.close||f.decree&&f.applyType!=teasp.constant.APPLY_TYPE_HOLIDAY?(j.firstChild.className="png-add",j.title=teasp.message.getLabel("dayApply_caption")):teasp.constant.STATUS_APPROVES.contains(f.status)?(j.firstChild.className="ts-status-img ts-s-approve",
j.title=teasp.constant.getDisplayStatus(f.status)):teasp.constant.STATUS_REJECTS.contains(f.status)?(j.firstChild.className="ts-status-img ts-s-reject",j.title=teasp.constant.getDisplayStatus(f.status)):teasp.constant.STATUS_WAIT==f.status?(j.firstChild.className="ts-status-img ts-s-wait",j.title=teasp.constant.getDisplayStatus(f.status)):(j.firstChild.className="png-add",j.title=teasp.message.getLabel(
"dayApply_caption")),!u||!f&&n?j.style.cursor="default":(j.style.cursor="pointer",teasp.util.date.compareDate(this.rangeYear.from,y)<=0&&0<=teasp.util.date.compareDate(this.rangeYear.to,y)||this.pouch.isApplyLimitOff()?(this.eventHandles.push(dojo.connect(j,"onclick",this,this.openEmpApply(c))),j.id="ttvApply"+c,g.applyable=!0):this.eventHandles.push(dojo.connect(j,"onclick",this,function(){teasp.tsAlert(
teasp.message.getLabel("tm10001050"),this)}))),(j=dojo.query("td.vst",p)[0]).style.color=u&&r&&1==m.getLateFlag()?"#cc0000":"#222222",u?n||h?m.isInputTime()?(j.style.cursor="pointer",this.eventHandles.push(dojo.connect(j,"onclick",this,this.openInputTime(c))),j.innerHTML=m.getStartTime(!1,null,s),j.className="dval vst"+((T=b<0?5:2==b?7:0)?" day_time"+T:"")):(j.className="dval vst",j.style.cursor="",j.innerHTML=""
):m.isInputable()?(j.className="dval vst day_time"+(T=b<0?4:2==b?6:0),j.style.cursor="pointer",this.eventHandles.push(dojo.connect(j,"onclick",this,this.openInputTime(c))),j.innerHTML=m.getStartTime(!1,null,s),j.id="ttvTimeSt"+c,g.inputable=!0):(j.className="dval vst",j.style.cursor="",j.innerHTML=""):(j.className="dval vst",j.style.cursor="",j.innerHTML=""),(j=dojo.query("td.vet",p)[0]
).style.color=u&&r&&1==m.getEarlyFlag()?"#cc0000":"#222222",u?n||h?m.isInputTime()?(j.style.cursor="pointer",this.eventHandles.push(dojo.connect(j,"onclick",this,this.openInputTime(c))),j.innerHTML=m.getEndTime(!1,null,s),j.className="dval vet"+((T=_<0?5:2==_?7:0)?" day_time"+T:"")):(j.className="dval vet",j.style.cursor="",j.innerHTML=""):m.isInputable()?(j.className="dval vet day_time"+(T=_<0?4:2==_?6:0),
j.style.cursor="pointer",this.eventHandles.push(dojo.connect(j,"onclick",this,this.openInputTime(c))),j.innerHTML=m.getEndTime(!1,null,s)):(j.className="dval vet",j.style.cursor="",j.innerHTML=""):(j.className="dval vet",j.style.cursor="",j.innerHTML=""),this.workLocIn&&(j=dojo.query("td.vtelework",p)[0],f=!1,u&&(m.isInputTime()||m.isInputable())&&(j.style.cursor="pointer",j.className="dval vtelework"+(
n||h?"":" day_tele0"),this.eventHandles.push(dojo.connect(j,"onclick",this,this.openInputTime(c))),dojo.empty(j),dojo.create("div",{innerHTML:m.getWorkLocationName(),title:m.getWorkLocationName()},dojo.create("div",{className:"tele"},j)),f=!0),f||(j.className="dval vtelework",j.style.cursor="",j.innerHTML="")),this.empAccsIn&&((j=dojo.query("td.vacc",p)[0]).id="dailyAccsCell"+c,j.className="dval vacc",dojo.empty(j),
E=dojo.create("div",{style:"margin:auto;"},dojo.create("div",null,j)),y=m.getDivergenceJudge(),dojo.style(j,"cursor",y.css?"pointer":"default"),y.css&&(dojo.addClass(E,y.css),u&&this.eventHandles.push(dojo.connect(j,"onclick",this,this.openDivergenceReason(c)))),dojo.attr(j,"title",y.title||"")),this.empWorkIn&&((j=dojo.query("td.vjob",p)[0]).id="dailyWorkCell"+c,b=this.pouch.getObj(
).works?this.pouch.getClassifyJobWorks(c):null,_=u&&m.isInputable()||b&&(0<b.sumTime||0<b.sumVolume),j.className="dval vjob",dojo.empty(j),_?(f=(0<(h=m.getDaySubTimeByKey("workRealTime",!0,0,null,teasp.constant.C_REAL))||0<b.sumTime)&&h!=b.sumTime,E=dojo.create("div",{style:{position:"relative",paddingLeft:"0px"}},j),l&&f&&(dojo.create("div",{className:"workng pp_base pp_exclamatio2"},E),
E.title=teasp.message.getLabel("tf10007310")),b&&0<b.sumTime?dojo.create("div",{style:{margin:"auto",fontSize:"11px"},className:"work-job-time",id:"dailyWorkButton"+c,innerHTML:teasp.util.time.timeValue(b.sumTime)},E):b&&0<b.sumVolume?dojo.create("div",{style:{margin:"auto",fontSize:"11px",paddingTop:"4px"},className:"work-job-time",id:"dailyWorkButton"+c,innerHTML:"* *"},E):dojo.create("div",{style:{margin:"auto",
paddingTop:"4px"},className:"png-add"},E),this.eventHandles.push(dojo.connect(j,"onclick",this,this.openWorkBalance(c))),j.style.cursor="pointer"):j.style.cursor="default"),(j=dojo.query("td.vbttn",p)[0]).title=teasp.message.getLabel("note_btn_title"),j.id="dailyNoteIcon"+c,dojo.empty(j),u&&this.eventHandles.push(dojo.connect(j,"onclick",this,this.openNote(c))),m.getDayNote(!this.pouch.isSeparateDailyNote())),_=((
E=dojo.create("div",{style:{marginLeft:"auto",marginRight:"auto"}},j)).className="png-add",this.noteWidth<2&&y&&dojo.create("div",{style:"position:absolute;bottom:1px;right:1px;",innerHTML:"..."},j),(j=dojo.query("td.vnote",p)[0]).id="dailyNote"+c,dojo.empty(j),0),b=(m.isExistApply(teasp.constant.APPLY_KEY_SHIFT)&&(E=dojo.create("div",{className:"pp_base pp_shift_done",style:{float:"left",cursor:"pointer",
marginRight:"2px",marginTop:"2px"}},j),h=this.openEmpApply(c,m.getEmpApplyByKey(teasp.constant.APPLY_KEY_SHIFT).id),this.eventHandles.push(dojo.connect(E,"onclick",this,h)),_+=17,(f=m.getWorkPlaceSymbol())&&(E=dojo.create("div",{innerHTML:f,className:"workPlace",style:{float:"left",cursor:"pointer"}},j),this.eventHandles.push(dojo.connect(E,"onclick",this,h)),_+=40)),j.title=y,teasp.util.entitize(y.replace(
/\r\n|\r|\n/g," "),"")),u=Math.max(this.noteWidth-_-16,0);u&&(c=dojo.create("div",{style:"overflow-x:hidden;max-width:"+u+"px;",className:"note-area"},j),dojo.create("div",{innerHTML:b,style:"white-space:nowrap;display:table;"},c),dojo.create("div",{style:"position:absolute;bottom:2px;right:2px;display:none;",innerHTML:"...",className:"note-cont"},j)),teasp.manager.testSeed(g)}for(var L=e;e<31;)(p=a.rows[e+1]
).className="days "+(e%2==0?"even":"odd"),dojo.style(p,"display","none"),i&&(i.rows[e+1].className="dayLine  "+(e%2==0?"dl_even":"dl_odd"),dojo.style(i.rows[e+1],"display","none")),(j=dojo.query("td.vdate",p)[0]).innerHTML="",j.style.cursor="default",j.style.fontWeight="normal",j.title="",(j=dojo.query("td.vweek",p)[0]).innerHTML="",j.style.cursor="default",j.style.fontWeight="normal",j.title="",(j=dojo.query(
"td.vstatus",p)[0]).title="",j.firstChild.className="",(j=dojo.query("td.vapply",p)[0]).className="dval vapply",j.firstChild.className="",j.title="",j.style.cursor="default",(j=dojo.query("td.vst",p)[0]).className="dval vst",j.style.cursor="default",j.innerHTML="",(j=dojo.query("td.vet",p)[0]).className="dval vet",j.style.cursor="default",j.innerHTML="",this.empAccsIn&&((j=dojo.query("td.vacc",p)[0]
).className="dval vacc",j.firstChild&&(j.firstChild.className=""),j.title="",j.innerHTML="",j.style.cursor="default"),this.empWorkIn&&((j=dojo.query("td.vjob",p)[0]).className="dval vjob",j.firstChild&&(j.firstChild.className=""),j.title="",j.innerHTML="",j.style.cursor="default"),(j=dojo.query("td.vbttn",p)[0]).className="dval vbttn",j.firstChild&&(j.firstChild.className=""),(j=dojo.query("td.vnote",p)[0]).title="",
j.innerHTML="",e++;dojo.forEach(a.rows[L].cells,function(e){dojo.addClass(e,"bot-border")}),i&&dojo.forEach(i.rows[L].cells,function(e){dojo.addClass(e,"bot-border")}),dojo.style("mainTable","height",24*L+42+42+"px"),dojo.query("td.ts-top-empinfo td.ts-top-info-r > div.dept-name").forEach(function(e){e.innerHTML=this.pouch.getDeptName()},this),dojo.query("td.ts-top-empinfo td.ts-top-info-r > div.emptype-name"
).forEach(function(e){e.innerHTML=this.pouch.getEmpTypeName()},this),dojo.query("td.ts-top-empinfo td.ts-top-info-r > div.emp-name").forEach(function(e){e.innerHTML=this.pouch.getName()},this);var k=this.pouch.isPermitDeptFixWoMonthFix(),L=(this.pouch.isEmpMonthApprover()?(dojo.query("button.apply-button").forEach(function(e){e.style.display="",dojo.toggleClass(e,"std-button1",!1),dojo.toggleClass(e,
"std-button1-disabled",!1),dojo.toggleClass(e,"std-button3",!0),e.firstChild.innerHTML=teasp.message.getLabel("tf10000270")},this),this.eventHandles.push(dojo.connect(dojo.byId("applyButton1"),"onclick",this,this.approveMonthly)),this.eventHandles.push(dojo.connect(dojo.byId("applyButton2"),"onclick",this,this.approveMonthly))):(L=(this.pouch.isSysAdmin()||this.pouch.isAdmin())&&!n&&this.pouch.isDeptMonthFixed(),
!k||L&&this.pouch.getInputFlag()==teasp.constant.INPUT_FLAG_NORMAL?n?dojo.query("button.apply-button").forEach(function(e){e.style.display="",dojo.toggleClass(e,"std-button1",!1),dojo.toggleClass(e,"std-button1-disabled",!0),dojo.toggleClass(e,"std-button3",!1),e.firstChild.innerHTML=teasp.message.getLabel(this.pouch.isUseWorkFlow()&&!k?"applyx_btn_title":"fix_btn_title")},this):(dojo.query("button.apply-button"
).forEach(function(e){e.style.display="",dojo.toggleClass(e,"std-button1",!0),dojo.toggleClass(e,"std-button1-disabled",!1),dojo.toggleClass(e,"std-button3",!1),e.firstChild.innerHTML=teasp.message.getLabel(this.pouch.isUseWorkFlow()&&!k?"applyx_btn_title":"fix_btn_title")},this),this.eventHandles.push(dojo.connect(dojo.byId("applyButton1"),"onclick",this,this.applyMonthly)),this.eventHandles.push(dojo.connect(
dojo.byId("applyButton2"),"onclick",this,this.applyMonthly))):dojo.query("button.apply-button").forEach(function(e){e.style.display="none"},this)),dojo.byId("applyButton1").title=teasp.message.getLabel(this.pouch.isUseWorkFlow()&&!k?"applyx_button_title":"fix_button_title"),dojo.byId("applyButton2").title=teasp.message.getLabel(this.pouch.isUseWorkFlow()&&!k?"applyx_button_title":"fix_button_title"),dojo.byId(
"monthlyStatus"));dojo.empty(L),dojo.create("div",{className:"png-"+this.pouch.getEmpMonthStatusIconClass()},L),teasp.isNarrow(343)&&teasp.isEnglish()||dojo.create("div",{innerHTML:teasp.constant.getDisplayStatus(this.pouch.getEmpMonthApplyStatus(0,!0))||teasp.message.getLabel("notFix_label")},L),this.showTimeViewBottom(),this.showMonthlyApplyButton(),this.createGraphArea(),this.pouch.isAutoVerify(
)&&this.verifyMonth()},teasp.view.Monthly.prototype.showTimeViewBottom=function(){this.helperSummary=new teasp.helper.Summary(this.pouch);var e=this.helperSummary.getTimeViewBottomContents(),t=dojo.byId("bottomSummaryTable"),a=(dojo.empty(t),e.numberOfColumns||0);if(a){for(var o=[],s=[],i=0;i<a;i++){var n=dojo.create("div",{style:"vertical-align:top;min-width:260px;max-width:300px;"},t);s.push(n),o.push(dojo.create(
"tbody",null,dojo.create("table",{className:"param"},n)))}for(cx=1;cx<=a;){for(var r=o[cx-1],l=e["column"+cx]||[],p=0,d=!1,i=0;i<l.length;i++){var c,m=l[i];m.skip||(m.separator?(m.label?dojo.create("div",{style:"padding:1px 4px;text-align:left;",innerHTML:m.label},s[cx-1]):dojo.create("div",{style:"height:4px;"},s[cx-1]),d=!(p=0)):(!p&&d&&(r=o[cx-1]=dojo.create("tbody",null,dojo.create("table",{className:"param"},
s[cx-1]))),c=dojo.create("tr",null,r),m.labelOnly?dojo.create("div",{innerHTML:m.label||"&nbsp;",className:"left",style:"margin-bottom:4px;"},dojo.create("td",{className:"left",colSpan:"2"},c)):(dojo.create("div",{innerHTML:m.label||"&nbsp;",className:"left"},dojo.create("td",{className:"left"},c)),dojo.create("div",{innerHTML:teasp.util.dspVal(m.value,"&nbsp;"),className:"right"},dojo.create("td",{className:"right"}
,c))),m.lines&&!m.noDetail&&(c=dojo.create("td",{colSpan:"2",className:"tb_detail_area"},dojo.create("tr",null,r)),this.displayHolidayItems(c,m.lines)),p++))}cx++}}},teasp.view.Monthly.prototype.displayHolidayItems=function(e,t){for(var a=dojo.create("tbody",null,dojo.create("table",{className:"tb_holy_item_table"},e)),o=0;o<t.length;o++){var s=t[o],i=dojo.create("tr",null,a);dojo.create("td",{innerHTML:s.head,
className:"holy_item_col1"},i),dojo.create("td",{innerHTML:s.label,className:"holy_item_col2"},i),dojo.create("td",{innerHTML:s.value,className:"holy_item_col3"},i)}},teasp.view.Monthly.prototype.verifyMonth=function(){var t=dojo.query(".ts-top-logo div.work-list")[0];this.pouch.verifyMonth(dojo.hitch(this,function(e){}),dojo.hitch(this,function(e){e?t.firstChild||dojo.create("div",{className:"redmask"},t
):dojo.empty(t)}),dojo.hitch(this,function(e){console.log(teasp.message.getErrorMessage(e)),dojo.empty(t)}))},teasp.view.Monthly.prototype.createGraphArea=function(){dojo.byId("graphDiv")&&(this.graph||(this.graph=new teasp.helper.Graph({widthPerH:20,startY:48,sizeType:"small",movable:!1,clickedEvent:this.openEditTime,clickedApply:this.openEmpApply,hideTimeGraphPopup:this.pouch.isHideTimeGraphPopup(),that:this})),
this.graph.clear(),this.graph.draw(this.pouch,"graphDiv",this.pouch.getMonthDateList()),setTimeout(dojo.hitch(this,this.adjustGraphAreaScroll),100))},teasp.view.Monthly.prototype.createMonthList=function(){for(var e=teasp.util.date.formatDate(this.pouch.getStartDate(),"yyyyMMdd"),t=this.pouch.getEmpMonthList(teasp.util.date.getToday(),1,-12),a=-1,o=0;o<t.length;o++)if((i=t[o]).yearMonthEx==e){a=o;break}a<0&&t.push(
this.pouch.getEmpMonth(null,this.pouch.getStartDate()));var t=t.sort(function(e,t){return e.startDate<t.startDate?1:-1}),s=dojo.byId("yearMonthList");dojo.empty(s);for(o=0;o<t.length;o++){var i=t[o],n=Math.floor(i.yearMonth/100),r=i.yearMonth%100,n=teasp.util.date.formatMonth("zv00000021",n,r,i.subNo);dojo.create("option",{value:i.yearMonthEx,innerHTML:n},s)}s.value=e},
teasp.view.Monthly.prototype.openTimeReport=function(e){var t=e;return dojo.hitch(this,function(){teasp.locationHref(teasp.getPageUrl("timeReportView")+"?empId="+this.pouch.getEmpId()+"&date="+t+"&mode="+this.pouch.getMode())})},teasp.view.Monthly.prototype.openWorkBalance=function(e){var n=e;return dojo.hitch(this,function(e){e.preventDefault(),e.stopPropagation();var t,e=this.pouch.getClassifyJobWorks(n),
a=this.pouch.getEmpDay(n),o=this.pouch.getJobMonthByDate(n),s=!1,i=a.getDaySubTimeByKey("workRealTime",!0,0,0,teasp.constant.C_REAL);i||(t=a.getZanteiRealTime(teasp.util.date.getToday()))&&(s=!0,i=t),teasp.manager.dialogOpen("WorkBalance",{date:n,jobMonth:o,workRealTime:i,worked:a.isWorked(),workNote:a.getWorkNote(),zanteiFlag:s,classifyJobWorks:dojo.clone(e),reflectWorkOption:null,
monthFix:this.pouch.isEmpMonthFixed(),dayFix:a.isDailyFix(),client:teasp.constant.APPLY_CLIENT_MONTHLY},this.pouch,this,function(e,t,a){a||this.refreshMonthly()})})},teasp.view.Monthly.prototype.openPrintView=function(){var e,t=Math.min(screen.availHeight||800,800),a=["empId="+this.pouch.getEmpId(),"date="+teasp.util.date.formatDate(this.pouch.getStartDate(),"yyyyMMdd"),"mode=read"],o=["width=810","height="+t],a=(
teasp.isNarrow()?a.push("narrow=1"):(o.push("resizable=yes"),o.push("scrollbars=yes")),teasp.getPageUrl("workTimePrintView")+"?"+a.join("&")),o=o.join(",");teasp.isSforce1()?sforce.one.navigateToURL(a):(e=window.open(a,"print",o),setTimeout(function(){e.resizeTo(820,t)},100))},teasp.view.Monthly.prototype.openEmpView=function(){var e,t=Math.min(screen.availHeight||800,800),a=["empId="+this.pouch.getEmpId(),
"mode=read"],o=["width=700","height="+t],a=(teasp.isNarrow()?a.push("narrow=1"):(o.push("resizable=yes"),o.push("scrollbars=yes")),teasp.getPageUrl("workEmpView")+"?"+a.join("&")),o=o.join(",");teasp.isSforce1()?sforce.one.navigateToURL(a):(e=window.open(a,"empInfo",o),setTimeout(function(){e.resizeTo(710,t)},100))},teasp.view.Monthly.prototype.openHolidayView=function(){var e,t=Math.min(screen.availHeight||800,800),
a=["empId="+this.pouch.getEmpId(),"date="+teasp.util.date.formatDate(this.pouch.getStartDate(),"yyyyMMdd")],o=["width=800","height="+t],a=(teasp.isNarrow()?a.push("narrow=1"):(o.push("resizable=yes"),o.push("scrollbars=yes")),teasp.getPageUrl("holidayView")+"?"+a.join("&")),o=o.join(",");teasp.isSforce1()?sforce.one.navigateToURL(a):(e=window.open(a,"empInfo",o),setTimeout(function(){e.resizeTo(810,t)},100))},
teasp.view.Monthly.prototype.openEmpList=function(){this.pouch.getDeptCode();var e=this.pouch.getParamByKey("mode")||"",t=(screen.availHeight,this.pouch.getObj().sessionInfo),t=teasp.getPageUrl("deptRefView")+"?type=Time&empId="+(t&&t.emp&&t.emp.id||this.pouch.getEmpId())+"&deptId="+this.pouch.getDeptId()+"&month="+this.pouch.getYearMonth()+"&subNo="+(this.pouch.getSubNo()||"")+(e?"&mode="+e:"");teasp.isSforce1()&&(
t+="&narrow=1"),teasp.isSforce1()?sforce.one.navigateToURL(t):(e=window.open(t,"empTable","width=690,height=340,resizable=yes,scrollbars=yes"))&&e.focus()},teasp.view.Monthly.prototype.openInfoView=function(){dojo.query("div.info-icon").forEach(function(e){dojo.toggleClass(e,"info-an",!1),dojo.toggleClass(e,"info-bl",!0)}),teasp.manager.dialogOpen("Info",{},this.pouch)},
teasp.view.Monthly.prototype.openStatusView=function(){var t=this.pouch.getEmpMonthApplyObj();t.id&&(!t.steps||t.steps.length<=0)?teasp.manager.request("getEmpMonthApplySteps",{applyId:this.pouch.getEmpMonthApplyId(),empId:this.pouch.getEmpId(),month:this.pouch.getYearMonth(),startDate:this.pouch.getStartDate()},this.pouch,{hideBusy:!0},this,function(e){t.steps="object"==typeof e?e.steps:e,this.openStatusDialog(t)},
function(e){teasp.message.alertError(e)}):this.openStatusDialog()},teasp.view.Monthly.prototype.openStatusDialog=function(){var e=this.pouch.getEmpMonthApplyObj(),t=!(!e.status||teasp.constant.STATUS_NOTADMITS.contains(e.status)||teasp.constant.STATUS_CANCELS.contains(e.status)||teasp.constant.STATUS_APPROVES.contains(e.status)&&!this.pouch.canCancelMonthApply()),a=(t&&!this.pouch.isAdmin(!0
)&&this.pouch.isDeptMonthFixed()&&(t=!1),0),a=teasp.constant.STATUS_APPROVES.contains(e.status)?this.pouch.getEmpMonthApplyStatus()==teasp.constant.STATUS_ADMIT?4:2:teasp.constant.STATUS_REJECTS.contains(e.status)?3:this.pouch.isPermitDeptFixWoMonthFix()||!this.pouch.isUseWorkFlow()?4:1;teasp.manager.dialogOpen("Status",{apply:e,removable:t&&!this.pouch.isReadOnly(),removeButtonType:a,
cancelApply:this.requestCancelEmpMonthApply},this.pouch,this,function(){this.pouch.clearEmpMonthApprover(),this.refreshMonthly()})},teasp.view.Monthly.prototype.requestCancelEmpMonthApply=function(e,t,a){var o,s=this.pouch.getEmpMonthApplyObj(),e=e&&teasp.constant.STATUS_REJECTS.contains(e.status)?(o="tm10001041",teasp.message.getLabel("apply_head")):(o="tm10001040",teasp.message.getLabel("fixMonth_caption"));
teasp.tsConfirmA(teasp.message.getLabel(o,this.pouch.getYearMonthJp(),e),this,function(){var e=teasp.constant.STATUS_REJECTS.contains(s.status)&&!s.close?"closeApplyEmpMonth":"cancelApplyEmpMonth";teasp.manager.request(e,{empId:this.pouch.getEmpId(),month:this.pouch.getYearMonth(),startDate:this.pouch.getStartDate(),lastModifiedDate:this.pouch.getLastModifiedDate()},this.pouch,{hideBusy:!1},this,t,a)})},
teasp.view.Monthly.prototype.checkPreApplyMonthly=function(e){var t=this.pouch.getMonthDateList(),a=teasp.message.getLabel("tm10001060"),o=[],s=this.pouch.getInvalidApplys(!0),i=a;if(0<s.length){for(var n=0;n<s.length;n++){if(2<=n){i+="\n...";break}i+="\n"+teasp.message.getLabel("tm10001070",teasp.util.date.formatDate(s[n].date,"M/d"),s[n].text)}return teasp.tsAlert(i,this),!1}if(this.pouch.getReviseTimeApplys(
).length)return i+="\n"+teasp.message.getLabel("tf10008480"),teasp.tsAlert(i,this),!1;for(var r=0,l=[],p=[],d=[],c=[],m={st:[],et:[],both:[],ng:[],workLocations:[]},h={ew:[],ot:[]},u={ls:[],ee:[]},g=-1,y=0,f=0,b=null,_=null,v=0;v<t.length;v++){var T=this.pouch.getEmpDay(t[v]),j=this.pouch.isAlive(t[v]),E=this.pouch.getObj().works?this.pouch.getClassifyJobWorks(t[v]):null,E=E?E.sumTime:0,L=T.getDaySubTimeByKey(
"workRealTime",!0,0,null,teasp.constant.C_REAL);E!=L&&c.push({dkey:t[v],job:E,net:L}),j&&(1==(E=T.getDeficit()).empty?m.st.push(t[v]):2==E.empty?m.et.push(t[v]):E.ng?m.ng.push(t[v]):3==E.empty&&m.both.push(t[v]),!this.pouch.isRequireWorkLocation()||!E.entered&&1!=E.empty&&2!=E.empty||T.getWorkLocationId()||m.workLocations.push(t[v]),this.pouch.isUseWorkLocation()&&!E.entered&&T.getWorkLocationId()&&f++,
T.isExistApply(teasp.constant.APPLY_KEY_KYUSHTU)&&!T.isWorked()&&this.pouch.isUseDaiqManage()&&o.push(teasp.message.getLabel("tm10001700",teasp.util.date.formatDate(t[v],"M/d"))),this.pouch.isUseDailyApply()&&this.pouch.getObj().config.checkWorkingTime&&!T.isInputable()&&(L=this.pouch.getObj().works?this.pouch.getClassifyJobWorks(t[v]):null)&&0<L.sumTime&&o.push(teasp.message.getLabel("tk10004590",
teasp.util.date.formatDate(t[v],"M/d"))),T.isInputable()&&!T.isExistApply(teasp.constant.APPLY_KEY_DAILY)&&(E=(j=teasp.util.date.parseDate(t[v])).getMonth()+1,p.push(E==g?j.getDate():E+"/"+j.getDate()),g=E),(L=T.getDayNoteWarning())&&o.push(L),this.pouch.isEmptyDay(t[v])&&0<T.getTimeHolidayApply().length&&l.push(teasp.util.date.formatDate(t[v],"M/d")),this.pouch.isInputAccessControl()&&(j=T.getDivergeNg())&&d.push(j)
,E=T.getDiscretionaryLevel(),L=this.pouch.getOverTimeRequireTime(E),j=this.pouch.getEarlyWorkRequireTime(E),E=T.getMissingOverTime(L),L=T.getMissingEarlyWork(j),0<E&&(h.ot.push(t[v]),T.isExistApply(teasp.constant.APPLY_KEY_ZANGYO)&&y++),0<L&&(h.ew.push(t[v]),T.isExistApply(teasp.constant.APPLY_KEY_EARLYSTART)&&y++),this.pouch.isRequiredLateStartApply()&&T.isMissingLateStartApply()&&u.ls.push(t[v]),
this.pouch.isRequiredEarlyEndApply()&&T.isMissingEarlyEndApply()&&u.ee.push(t[v]),r+=T.getEmpApplyList("ALL_WAIT").length)}if(0<r||0<this.pouch.getPendingMonthlyOverTimeApplys().length)return teasp.tsAlert(a+teasp.message.getLabel("tm10001080"),this),!1;if((m.st.length||m.et.length||m.both.length||m.ng.length||m.workLocations.length)&&(x=[],m.ng.length&&x.push(teasp.message.getLabel("tf10008770",
teasp.util.date.joinEx(m.ng),teasp.message.getLabel("startEndTime_label"))),m.both.length&&x.push(teasp.message.getLabel("tk10005420",teasp.util.date.joinEx(m.both),teasp.message.getLabel("startEndTime_label"))),m.st.length&&x.push(teasp.message.getLabel("tk10005420",teasp.util.date.joinEx(m.st),teasp.message.getLabel("startTime_label"))),m.et.length&&x.push(teasp.message.getLabel("tk10005420",teasp.util.date.joinEx(
m.et),teasp.message.getLabel("endTime_label"))),m.workLocations.length&&x.push(teasp.message.getLabel("tk10005420",teasp.util.date.joinEx(m.workLocations),teasp.message.getLabel("tw00000010"))),o=x.concat(o)),(h.ot.length||h.ew.length)&&(h.ot.length&&o.push(teasp.message.getLabel("tf10008730",teasp.util.date.joinEx(h.ot),teasp.message.getLabel("tm10001293"))),h.ew.length&&o.push(teasp.message.getLabel("tf10008730",
teasp.util.date.joinEx(h.ew),teasp.message.getLabel("tm10001294"))),0<y&&o.push(teasp.message.getLabel("tf10008760"))),(u.ls.length||u.ee.length)&&(u.ls.length&&o.push(teasp.message.getLabel("tf10008730",teasp.util.date.joinEx(u.ls),teasp.message.getLabel("applyLateStart_label"))),u.ee.length&&o.push(teasp.message.getLabel("tf10008730",teasp.util.date.joinEx(u.ee),teasp.message.getLabel("applyEarlyEnd_label")))),
0<o.length)return x=o.slice(0,10),10<o.length&&x.push("..."),teasp.tsAlert(a+"\n"+x.join("\n"),this),!1;if(0<d.length){if(!this.pouch.isPermitMonthlyApply())return teasp.tsAlert(a+"\n"+d.join("\n"),this),!1;b=teasp.message.getLabel("ac00000500")+"\n"+d.join("\n")+"\n\n"+teasp.message.getLabel("ac00000510")+"\n"}if(this.pouch.isProhibitApplicantEliminatingLegalHoliday()){for(var H=t[t.length-1],
k=teasp.logic.EmpTime.createWeekObjs(t[0],teasp.util.date.addDays(H,6),this.pouch.getInitialDayOfWeek(),dojo.hitch(this.pouch,this.pouch.isAlive)),t=teasp.logic.EmpTime.getDateListByWeekObjs(k),v=0;v<t.length;v++){var D=this.pouch.getObj().days[t[v]],I=teasp.logic.EmpTime.getWeekObj(k,t[v]);D.dayType==teasp.constant.DAY_TYPE_LEGAL_HOLIDAY?I.legalHolidays++:D.dayType!=teasp.constant.DAY_TYPE_NORMAL&&(
I.lastHoliday=D.rack.key)}var A=[];for(v=0;v<k.length;v++){if(H<(I=k[v]).dkeys[0])break;if(!I.legalHolidays&&!I.lastHoliday&&I.liveWeekAll){for(var P=!1,n=0;n<I.dkeys.length;n++){var S=this.pouch.getEmpDay(I.dkeys[n]),C=S.isExistApply(teasp.constant.APPLY_KEY_EXCHANGES),S=S.isExistApply(teasp.constant.APPLY_KEY_EXCHANGEE);if(C||S){P=!0;break}}P&&A.push(teasp.message.getLabel("tk10001178",teasp.util.date.formatDate(
I.dkeys[0],"M/d+"),teasp.util.date.formatDate(I.dkeys[I.dkeys.length-1],"M/d+")))}}if(0<A.length)return A.push(teasp.message.getLabel("tk10001179")),teasp.tsAlert(A.join("\n"),this),!1}if(this.pouch.isUseDaiqManage()){var x=teasp.data.Pouch.getDaiqZan(this.pouch.getStocks(),this.pouch.getEmpMonthLastDate(),this.pouch.getEmpMonthStartDate(),this.pouch.getEmpMonthLastDate(),this.pouch.isOldDate());if(x.overSpend<0
)return teasp.tsAlert(a+"\n"+teasp.message.getLabel("tm10001650",Math.abs(x.overSpend)),this),!1}var w,M,O=this.pouch.getStockLack();for(w in O){if(4<o.length)break;O.hasOwnProperty(w)&&(M=O[w],4<=o.length?o.push("..."):o.push(teasp.message.getLabel("tm10003782",teasp.util.date.formatDate(M.info.date,"M/d"),M.info.name)))}if(0<o.length)return teasp.tsAlert(a+"\n"+o.join("\n"),this),!1;if(
this.pouch.isCheckDailyFixLeak()&&0<p.length)return teasp.tsAlert(a+"\n"+teasp.message.getLabel("tm10001710",p.join(",")),this),!1;x=this.pouch.getEmptyDayCount();if(0<x&&(i=teasp.message.getLabel("tm10001090",x),0<f&&(i+="\n"+teasp.message.getLabel("tw00000320")),_=i),0<l.length){for(var R="",n=0;n<l.length;n++){if(3<=n){R+=teasp.message.getLabel("tm10001100");break}R+=(0<n?", ":"")+l[n]}return teasp.tsAlert(
a+teasp.message.getLabel("tm10001110",R+=""),this),!1}x=this.pouch.checkMonthlyOverTimeApplys();if(x.errmsg)return teasp.tsAlert(a+"\n"+x.errmsg,this),!1;if(this.pouch.isCheckWorkingTimeMonthly()&&0<c.length){i=teasp.message.getLabel("tk10004920");i=(i=(i=(i=(i=(i+="<br/><br/>")+'<table class="pane_table" style="margin-left:auto;margin-right:auto;">'+'<tr style="border-bottom:1px solid gray;">')+(
'<td style="width:70px;text-align:center;">'+teasp.message.getLabel("date_head")))+('</td><td style="width:90px;text-align:center;">'+teasp.message.getLabel("workRealTime_label")))+('</td><td style="width:90px;text-align:center;">'+teasp.message.getLabel("tk10004930")))+('</td><td style="width:90px;text-align:center;">'+teasp.message.getLabel("tk10004940"))+"</td></tr>";for(n=0;n<c.length;n++){var N=c[n];i=(i=(i=(i=(
i+="<tr>")+('<td style="text-align:center;">'+teasp.util.date.formatDate(N.dkey,"M/d")+"</td>"))+('<td style="text-align:center;">'+teasp.util.time.timeValue(N.net)+"</td>"))+('<td style="text-align:center;">'+teasp.util.time.timeValue(N.job)+"</td>"))+('<td style="text-align:center;">'+teasp.util.time.timeValue(N.net-N.job)+"</td>")+"</tr>"}
return i=i+'<tr style="border-top:1px solid gray;"><td colSpan="4"></td></tr>'+"</table>",teasp.manager.dialogOpen("MessageBox",{title:teasp.message.getLabel("tk10004910"),message:i,closeOnly:!0,titleBgColor:"#f5b2b2"},this.pouch,this,function(){}),!1}var W=dojo.hitch(this,function(){_?teasp.tsConfirmA(_,this,function(){e()}):e()});b?teasp.tsConfirmA(b,this,function(){W()}):W()},
teasp.view.Monthly.prototype.applyMonthly=function(){this.checkPreApplyMonthly(dojo.hitch(this,function(){this.pouch.isUseApproverSet()&&!this.pouch.getObj().approverSet?teasp.manager.request("getAtkApproverSet",{action:"getAtkApproverSet",empId:this.pouch.getEmpId(),type:teasp.constant.APPROVER_TYPE_MONTH},this.pouch,{hideBusy:!1},this,function(){this.doApplyMonthly()},function(e){teasp.message.alertError(e)}
):this.doApplyMonthly()}))},teasp.view.Monthly.prototype.doApplyMonthly=function(){var e=this.pouch.isPermitDeptFixWoMonthFix(),t={title:teasp.message.getLabel("fixMonth_caption"),buttonType:this.pouch.isUseWorkFlow()&&!e?0:1,descript:"",applyKey:teasp.constant.APPLY_KEY_MONTHLY,deptFixMode:e};this.pouch.isUseWorkFlow()&&!e?t.descript=teasp.message.getLabel("tm10001120",this.pouch.getYearMonthJp()
):t.descript=teasp.message.getLabel("tm10001130",this.pouch.getYearMonthJp()),teasp.manager.dialogOpen("ApplyComment",t,this.pouch,this,function(e){teasp.manager.request("applyEmpMonth",{empId:this.pouch.getEmpId(),month:this.pouch.getYearMonth(),startDate:this.pouch.getStartDate(),lastModifiedDate:this.pouch.getLastModifiedDate(),note:e.comment,attributeAtConfirm:this.pouch.getPeriodInfo(!0),
legalWorkTimeOfPeriod:this.pouch.getLegalWorkTimeOfPeriod()},this.pouch,{hideBusy:!1},this,function(e){this.refreshMonthly()},function(e){teasp.message.alertError(e)})})},teasp.view.Monthly.prototype.approveMonthly=function(){teasp.manager.dialogOpen("Approval",{apply:{id:this.pouch.getEmpMonthApplyId()},objKey:"empApply",refresh:!0},this.pouch,this,function(){this.refreshMonthly(!0)})},
teasp.view.Monthly.prototype.changePrevMonth=function(){return this.changeMonth(this.pouch.getEmpMonth(null,this.pouch.getStartDate(),-1))},teasp.view.Monthly.prototype.changeCurrMonth=function(){return this.changeMonth(this.pouch.getEmpMonth(null,teasp.util.date.getToday()))},teasp.view.Monthly.prototype.changeNextMonth=function(){return this.changeMonth(this.pouch.getEmpMonth(null,this.pouch.getStartDate(),1))},
teasp.view.Monthly.prototype.changeMonth=function(e){return this.pouch.getObj().params={target:"empMonth",empId:this.pouch.getEmpId(),empTypeId:this.pouch.getEmpTypeId(),month:e.yearMonth,subNo:e.subNo,startDate:e.startDate,endDate:e.endDate,mode:this.pouch.getMode()},document.body.style.cursor="wait",teasp.manager.request("transEmpMonth",{empId:this.pouch.getEmpId(),month:e.yearMonth,startDate:e.startDate,noDelay:!0
},this.pouch,{hideBusy:!0,shim:!0},this,function(e){this.refreshMonthly(!0),document.body.style.cursor="default"},function(e){dojo.byId("yearMonthList").value=""+this.pouch.getYearMonth(),document.body.style.cursor="default",teasp.message.alertError(e)}),!1},teasp.view.Monthly.prototype.changedMonthSelect=function(){var e=dojo.byId("yearMonthList"),e=teasp.util.date.formatDate(teasp.util.date.parseDate(e.value));
return this.changeMonth(this.pouch.getEmpMonth(null,e))},teasp.view.Monthly.prototype.openInputTime=function(e){var a={date:e,client:teasp.constant.APPLY_CLIENT_MONTHLY};return function(e){this.pouch.checkEmpMonthHook(dojo.hitch(this,function(e,t){e?teasp.manager.dialogOpen("InputTime",a,this.pouch,this,this.refreshMonthly2):teasp.tsAlert(teasp.message.getErrorMessage(t),this)}))}},
teasp.view.Monthly.prototype.openEditTime=function(e){var t={date:e};return function(){teasp.manager.dialogOpen("EditTime",t,this.pouch,this,this.refreshMonthly2)}},teasp.view.Monthly.prototype.openNote=function(e){var t={date:e};return function(){teasp.manager.dialogOpen("Note",t,this.pouch,this,this.refreshMonthly2)}},teasp.view.Monthly.prototype.openDivergenceReason=function(e){var a={date:e};return function(){
this.pouch.checkEmpMonthHook(dojo.hitch(this,function(e,t){e?teasp.manager.dialogOpen("DivergenceReason",a,this.pouch,this,this.refreshMonthly2):teasp.tsAlert(teasp.message.getErrorMessage(t),this)}))}},teasp.view.Monthly.prototype.applyDailyFix=function(e,t){var a=e,o=t;return dojo.hitch(this,function(e){e.preventDefault(),e.stopPropagation(),this.applyDailyFixReal.apply(this,[a,o])})},
teasp.view.Monthly.prototype.applyDailyFixReal=function(e,t){var a,o=this.pouch.getEmpDay(e).canSelectDailyEx(1);o.flag?(a={empId:this.pouch.getEmpId(),month:this.pouch.getYearMonth(),startDate:this.pouch.getStartDate(),lastModifiedDate:this.pouch.getLastModifiedDate(),date:e,client:teasp.constant.APPLY_CLIENT_MONTHLY,apply:{id:t||null,applyType:teasp.constant.APPLY_TYPE_DAILY,patternId:null,holidayId:null,
status:null,startDate:e,endDate:e,exchangeDate:null,startTime:null,endTime:null,note:null,contact:null}},this.pouch.isRequireNote(teasp.constant.APPLY_KEY_DAILY)?this.openEmpApply(e,t,!0)():teasp.manager.request("applyEmpDay",a,this.pouch,{},this,this.refreshMonthly2,function(e){teasp.tsAlert(teasp.message.getErrorMessage(e),this)})):teasp.tsAlert(o.reason.replace(/<br\/>/g,"\n"),this)},
teasp.view.Monthly.prototype.openEmpApply=function(s,e,t){var i={date:s,applyId:e||null,client:teasp.constant.APPLY_CLIENT_MONTHLY,dailyFix:t||!1};return dojo.hitch(this,function(e){e&&(e.preventDefault(),e.stopPropagation()),this.pouch.checkEmpMonthHook(dojo.hitch(this,function(e,t){var a,o;e?(a=dojo.hitch(this,function(){teasp.manager.dialogOpen("EmpApply",i,this.pouch,this,function(e,t){t?this.openBulkZangyo(
t.date,t.applyType):e?this.refreshMonthly(!0):this.refreshMonthly2()})}),o=this.pouch.getEmpDay(s),this.pouch.getObj().dayMap?0<o.getEmpApplyList("ALL").length?teasp.manager.request("getEmpDayApplySteps",{empId:this.pouch.getEmpId(),date:s},this.pouch,{hideBusy:!1},this,function(e){o.setEmpApplySteps(e.steps,e.items),a()},function(e){teasp.message.alertError(e)}):a():teasp.manager.request("loadEmpMonthDelay",{
empId:this.pouch.getEmpId(),date:s},this.pouch,{hideBusy:!1},this,function(e){o.setEmpApplySteps(e.steps,e.items),a()},function(e){teasp.message.alertError(e)})):teasp.tsAlert(teasp.message.getErrorMessage(t),this)}))})},teasp.view.Monthly.prototype.openBulkInput=function(){teasp.manager.dialogOpen("BulkInput",{},this.pouch,this,this.refreshMonthly2)},teasp.view.Monthly.prototype.openBulkZangyo=function(e,t){
teasp.manager.dialogOpen("BulkOverTime",{date:e,applyType:t},this.pouch,this,this.refreshMonthly2)},teasp.view.Monthly.prototype.openVerify=function(){var e=window.open(teasp.getPageUrl("configRefView"),"tsscan","width=420,height=900,resizable=yes,scrollbars=yes");e&&e.focus()},teasp.view.Monthly.prototype.buildMainTable=function(){this.noteWidth=teasp.isTs1Optimize()?Math.max(Math.min(window.innerWidth-303-16,160),0
):160;var e=dojo.create("table",{className:"main_table",id:"mainTable"}),t=(teasp.isNarrow()&&dojo.style("tsfArea","margin","0px"),dojo.create("tbody",{id:"mainTableBody"},e)),a=dojo.create("tr",null,t);dojo.create("td",{className:"head hdate",colSpan:"2",id:"dateColumn"},a),dojo.create("div",{id:"stateColumn"},dojo.create("td",{className:"head hstatus"},a)),dojo.create("td",{className:"head happly",id:"applyColumn"}
,a),dojo.create("td",{className:"head hst",id:"startTimeColumn"},a),dojo.create("td",{className:"head het",id:"endTimeColumn"},a),dojo.create("td",{className:"head htelework",id:"teleworkColumn"},a),dojo.create("td",{className:"head hacc",id:"accColumn"},a),dojo.create("td",{className:"head hjob",id:"jobColumn"},a),teasp.isShowGraph()&&this.buildGraphArea(a),dojo.create("td",{className:"head hnote",colSpan:"2",
id:"noteColumn",style:"width:"+(this.noteWidth+38)+"px"},a);for(var o=0;o<31;o++)a=dojo.create("tr",{className:"days "+(o%2==0?"odd":"even"),id:"empDay"+o},t),dojo.create("td",{className:"dval vdate"},a),dojo.create("td",{className:"dval vweek"},a),dojo.create("div",null,dojo.create("td",{className:"dval vstatus"},a)),dojo.create("div",null,dojo.create("td",{className:"dval vapply"},a)),dojo.create("td",{
className:"dval vst"},a),dojo.create("td",{className:"dval vet"},a),dojo.create("div",null,dojo.create("td",{className:"dval vtelework"},a)),dojo.create("div",null,dojo.create("td",{className:"dval vacc"},a)),dojo.create("div",null,dojo.create("td",{className:"dval vjob"},a)),dojo.create("div",null,dojo.create("td",{className:"dval vbttn",style:"position:relative;"},a)),dojo.create("td",{className:"dval vnote",
style:"width:"+this.noteWidth+"px;position:relative;"},a);var a=dojo.create("tr",null,t),s=(dojo.create("td",{className:"foot",colSpan:8},a),dojo.create("td",{className:"foot"},a),dojo.create("td",{className:"foot"},a),dojo.create("tfoot",null,e));return a=dojo.create("tr",{id:"mainTableFoot"},s),dojo.create("div",{className:"fdate"},dojo.create("td",null,a)),dojo.create("div",{className:"fweek"},dojo.create("td",
null,a)),dojo.create("div",{className:"fstatus"},dojo.create("td",null,a)),dojo.create("div",{className:"fapply"},dojo.create("td",null,a)),dojo.create("div",{className:"fst"},dojo.create("td",null,a)),dojo.create("div",{className:"fet"},dojo.create("td",null,a)),dojo.create("div",{className:"ftelework"},dojo.create("td",{id:"telColumnProp"},a)),dojo.create("div",{className:"facc"},dojo.create("td",{
id:"accColumnProp"},a)),dojo.create("div",{className:"fjob"},dojo.create("td",{id:"jobColumnProp"},a)),teasp.isShowGraph()&&dojo.create("div",{className:"graph_foot"},dojo.create("td",null,a)),dojo.create("div",{className:"fbttn"},dojo.create("td",null,a)),dojo.create("div",{style:"width:"+this.noteWidth+"px;",className:"fnote"},dojo.create("td",{className:"vnote"},a)),e},
teasp.view.Monthly.prototype.buildGraphArea=function(e){for(var t=dojo.create("td",{className:"head graph_area",rowSpan:"33",style:"background-color:transparent;width:100px;"},e),a=dojo.create("div",{className:"graph_over rel_div",id:"graphDiv",style:"width:100px;margin:0px;padding:0px;"},t),a=dojo.create("table",{frame:"box",id:"graphTable",className:"graphTable",style:"width:500px;display:none;"},a),o=dojo.create(
"tbody",null,a),e=dojo.create("tr",{style:"height:42px;border-bottom:1px solid #ACC2E9;height:42px;"},o),s=0;s<=48;s++)dojo.create("div",{innerHTML:s},dojo.create("td",{className:"meter"},e));for(s=0;s<31;s++){var i=dojo.create("td",{colSpan:"49",className:"dayLine"},dojo.create("tr",{className:s%2==0?"dl_odd":"dl_even"},o));30==s&&(i.style.borderBottom="1px solid #ACC2E9;")}for(e=dojo.create("tr",{
style:"height:42px;"},o),s=0;s<=48;s++)dojo.create("div",{innerHTML:s},dojo.create("td",{className:"meter"},e));return t},teasp.view.Monthly.prototype.viewPostProcess=function(){dojo.query("td.vnote",dojo.byId("mainTableBody")).forEach(function(e){dojo.query("div.note-area",e).forEach(function(e){e.nextSibling&&e.firstChild&&e.firstChild.offsetWidth>e.offsetWidth&&dojo.style(e.nextSibling,"display","")})})},
teasp.view.Monthly.prototype.showMonthlyApplyButton=function(){dojo.byId("monthlyApplyButtonLabel");var e=this.pouch.isShowMonthlyOverTimeApplyButton();dojo.query("#monthlyApplyButton > div:first-child")[0].className=this.pouch.getStatusClassOfApplysIcon(this.pouch.getMonthlyOverTimeApplys()),dojo.style(monthlyApplyButton.parentNode,"display",e?"":"none"),e&&this.eventHandles.push(dojo.connect(dojo.byId(
"monthlyApplyButton"),"onclick",this,this.doOpenMonthlyApply))},teasp.view.Monthly.prototype.doOpenMonthlyApply=function(){var e=this.pouch.getMonthlyOverTimeApplyIds(!0);e.length?teasp.manager.request("getApplyStepsById",e,this.pouch,{hideBusy:!1},this,function(e){this.pouch.setMonthlyApplySteps(e),this.openMonthlyApply()},function(e){teasp.message.alertError(e)}):this.openMonthlyApply()},
teasp.view.Monthly.prototype.openMonthlyApply=function(){this.loadApproverSet(dojo.hitch(this,function(e){e&&teasp.manager.dialogOpen("EmpMonthlyApply",{},this.pouch,this,function(){this.refreshMonthly(!0)})}))},teasp.view.Monthly.prototype.loadApproverSet=function(t){!this.pouch.isUseApproverSet()||this.pouch.isLoadedApproverSet()?t(!0):teasp.manager.request("getAtkApproverSet",{action:"getAtkApproverSet",
empId:this.pouch.getEmpId()},this.pouch,{hideBusy:!1},this,function(){t(!0)},function(e){teasp.message.alertError(e),t(!1)})},teasp.provide("teasp.view.MonthlySummary"),teasp.view.MonthlySummary=function(){},teasp.view.MonthlySummary.prototype=new teasp.view.Base,teasp.view.MonthlySummary.prototype.init=function(e,a,o){teasp.message.mergeLabels(globalMessages||{}),teasp.message.mergeLabels(
e&&e[teasp.message.getLanguageLocaleKey()]||{}),this.readParams({target:"empMonth"}),dojo.byId("areaBody"
).innerHTML='<table class="colla_table" style="width:100%;"><tr class="buttons"><td style="padding-bottom:4px;" colspan="2"><table class="colla_table" style="margin-bottom:4px;"><tr><td style="width:110px;"><button class="std-button1" id="monthlyPrint" ><div></div></button></td><td style="width:80px;display:none;" id="monsumApprove"><button class="std-button3" id="monthlyApprove" ><div></div></button></td><td style="width:80px;"><button class="std-button2" id="monthlyClose" ><div></div></button></td><td></td></tr></table></td></tr><tr><td style="padding-bottom:4px;" colspan="2"><table id="headTable" class="colla_table" style="width:100%;"><tr><td style="width:140px;border-top:1px solid #222222;border-left:1px solid #222222;border-bottom:1px solid #222222;"><table class="colla_table" style="width:100%;"><tr><td style="white-space:nowrap;text-align:left;"><div style="margin:0px 4px 0px 8px;" id="monsumTitle"></div></td><td style="white-space:nowrap;text-align:left;"><div style="margin:0px 4px;" id="yearMonth"></div></td></tr><tr><td style="white-space:nowrap;text-align:left;vertical-align:middle;font-size:0.9em;"><div style="margin:0px 4px 0px 8px;" id="monsumStatus"></div></td><td style="white-space:nowrap;text-align:left;vertical-align:middle;font-size:0.9em;"><div style="margin:0px 4px;" id="monthlyStatus"></div></td></tr></table></td><td style="width:auto;border:1px solid #222222;"><table class="colla_table" style="width:100%;"><tr><td style="width:30%;white-space:nowrap;text-align:center;border-bottom:1px solid #222222;border-right:1px solid #222222;font-size:0.9em;"><div style="margin:0px;" id="monsumDept"></div></td><td style="width:25%;white-space:nowrap;text-align:center;border-bottom:1px solid #222222;border-right:1px solid #222222;font-size:0.9em;"><div style="margin:0px;" id="monsumEmpType"></div></td><td style="width:20%;white-space:nowrap;text-align:center;border-bottom:1px solid #222222;border-right:1px solid #222222;font-size:0.9em;"><div style="margin:0px;" id="monsumEmpCode"></div></td><td style="width:25%;white-space:nowrap;text-align:center;border-bottom:1px solid #222222;font-size:0.9em;"><div style="margin:0px;" id="monsumName"></div></td></tr><tr><td style="text-align:left;vertical-align:middle;border-right:1px solid #222222;"><div style="margin:0px 7px;word-break:break-all;" id="department">&nbsp;</div></td><td style="text-align:left;vertical-align:middle;border-right:1px solid #222222;"><div style="margin:0px 7px;word-break:break-all;" id="empTypeName">&nbsp;</div></td><td style="text-align:left;vertical-align:middle;border-right:1px solid #222222;"><div style="margin:0px 7px;word-break:break-all;" id="empCode">&nbsp;</div></td><td style="text-align:left;vertical-align:middle;"><div style="margin:0px 7px;word-break:break-all;" id="empName">&nbsp;</div></td></tr></table></td></tr></table></td></tr><tr><td style="padding-bottom:4px;" colspan="2"><table class="prtv_table" style="width:100%;" id="workTable"><tbody class="prtv_body" id="workTableBody"></tbody></table></td></tr><tr><td style="text-align:left;" colspan="2"><div id="monsumMean"></div><hr id="summaryTitleBorder" size="1" color="#888888" style="border-style:dashed;" /></td></tr><tr id="summaryTitleRow"><td style="text-align:left; width:175px"><a name="summary"></a><span id="yearMonth2"></span><span id="monsumSummary"></span></td><td style="text-align:left;" class="buttons"><button class="std-button2" id="helpURL" ><div></div></button></td></tr><tr><td id="summaryBottom" style="padding:0px;" colspan="2"></td></tr><tr><td colspan="2"><div style="width:780px;"></div></td></tr></table>'
,(this.viewParams.narrow||teasp.isMobile())&&dojo.query("tr.buttons").forEach(function(e){dojo.style(e,"display","none")}),teasp.isAndroid()&&(dojo.style("areaBody","padding-right","70px"),dojo.style("areaBody","padding-bottom","100px"));var t=dojo.byId("workTableBody"),s=(dojo.empty(t),dojo.create("tr",{id:"workTableHeadRow"},t));dojo.create("td",{id:"monsumHead1",className:"prtv_head prtv_head_date",colSpan:3},s),
dojo.create("td",{id:"monsumHead2",className:"prtv_head prtv_head_info"},s),dojo.create("td",{id:"monsumHead11",className:"prtv_head prtv_head_entr",style:"display:none;"},s),dojo.create("td",{id:"monsumHead3",className:"prtv_head prtv_head_begt"},s),dojo.create("td",{id:"monsumHead4",className:"prtv_head prtv_head_endt"},s),dojo.create("td",{id:"monsumHead12",className:"prtv_head prtv_head_exit",
style:"display:none;"},s),dojo.create("td",{id:"monsumHead13",className:"prtv_head prtv_head_dive",style:"display:none;"},s),dojo.create("td",{id:"monsumHead5",className:"prtv_head prtv_head_rest"},s),dojo.create("td",{id:"monsumHead6",className:"prtv_head prtv_head_work"},s),dojo.create("td",{id:"monsumHead7",className:"prtv_head prtv_head_over"},s),dojo.create("td",{id:"monsumHead8",
className:"prtv_head prtv_head_holy"},s),dojo.create("td",{id:"monsumHead9",className:"prtv_head prtv_head_nigh"},s),dojo.create("td",{id:"monsumHead10",className:"prtv_head prtv_head_note"},s);for(var i=0;i<31;i++){s=dojo.create("tr",{className:i%2==0?"prtv_row_even":"prtv_row_odd"},t);dojo.create("td",{className:"prtv prtv_date"},s),dojo.create("td",{className:"prtv prtv_week"},s),dojo.create("td",{
className:"prtv prtv_sign"},s),dojo.create("td",{className:"prtv prtv_info"},s),dojo.create("td",{className:"prtv prtv_entr",style:"display:none;"},s),dojo.create("td",{className:"prtv prtv_begt"},s),dojo.create("td",{className:"prtv prtv_endt"},s),dojo.create("td",{className:"prtv prtv_exit",style:"display:none;"},s),dojo.create("td",{className:"prtv prtv_dive",style:"display:none;"},s),dojo.create("td",{
className:"prtv prtv_rest"},s),dojo.create("td",{className:"prtv prtv_work"},s),dojo.create("td",{className:"prtv prtv_over"},s),dojo.create("td",{className:"prtv prtv_holy"},s),dojo.create("td",{className:"prtv prtv_nigh"},s),dojo.create("td",{className:"prtv prtv_note"},s)}s=dojo.create("tr",{id:"workTableFootRow",style:{height:"26px"}},t);dojo.create("td",{className:"prtv_foot prtv_foot_goke",colSpan:6,
innerHTML:teasp.message.getLabel("total_label")},s),dojo.create("td",{className:"prtv_foot prtv_foot_rest"},s),dojo.create("td",{className:"prtv_foot prtv_foot_work"},s),dojo.create("td",{className:"prtv_foot prtv_foot_over"},s),dojo.create("td",{className:"prtv_foot prtv_foot_holy"},s),dojo.create("td",{className:"prtv_foot prtv_foot_nigh"},s),dojo.create("td",{className:"prtv_foot prtv_foot_note"},s),
teasp.manager.request("loadEmpMonthPrint",this.viewParams,this.pouch,{hideBusy:!0},this,function(){this.pouch.checkEmpMonthHook(dojo.hitch(this,function(e,t){e?(this.show(),a()):o(t)}))},function(e){o(e)})},teasp.view.MonthlySummary.prototype.showMessage=function(e,t){e=dojo.byId(e);e&&(e.innerHTML=t)},teasp.view.MonthlySummary.prototype.styleDisplay=function(e,t){e=dojo.byId(e);e&&dojo.style(e,"display",t?"":"none")
},teasp.view.MonthlySummary.prototype.show=function(){this.helperSummary=new teasp.helper.Summary(this.pouch);var t=this.pouch.isMsAccessInfo(),e=dojo.byId("workTable");dojo.query("td.prtv_head_entr,td.prtv_head_exit,td.prtv_head_dive,td.prtv_entr,td.prtv_exit,td.prtv_dive",e).forEach(function(e){dojo.style(e,"display",t?"":"none")}),dojo.attr(dojo.query("td.prtv_foot_goke",e)[0],"colSpan",t?9:6),this.showMain()},
teasp.view.MonthlySummary.prototype.showMain=function(){this.showControl(),this.showLabel(),this.showHead(),this.showDayBody(),this.showDayFoot(),this.showSummaryBottom()},teasp.view.MonthlySummary.prototype.showControl=function(){var e,t;dojo.byId("monthlyPrint").firstChild.innerHTML=teasp.message.getLabel("printOut_btn_title"),dojo.connect(dojo.byId("monthlyPrint"),"onclick",function(){return window.print(),!1}),
dojo.byId("monthlyClose").firstChild.innerHTML=teasp.message.getLabel("close_btn_title"),dojo.connect(dojo.byId("monthlyClose"),"onclick",function(){return(window.open("","_top").opener=top).close(),!1}),this.pouch.isEmpMonthApprover()&&(this.styleDisplay("monsumApprove",!0),e=this,dojo.byId("monthlyApprove").firstChild.innerHTML=teasp.message.getLabel("tf10000270"),dojo.connect(dojo.byId("monthlyApprove"),"onclick",
function(){teasp.manager.dialogOpen("Approval",{apply:{id:e.pouch.getEmpMonthApplyId()}},e.pouch,e,function(){location.reload()})})),this.pouch.isHideMonthlySummaryHelpURL()||(dojo.byId("helpURL").firstChild.innerHTML=teasp.message.getLabel("tk10007426"),t=this.pouch.getHelpURL(),dojo.connect(dojo.byId("helpURL"),"onclick",function(){return window.open(t),!1}))},teasp.view.MonthlySummary.prototype.showLabel=function(
){this.showMessage("monsumTitle",teasp.message.getLabel("workTable_label")),this.showMessage("monsumStatus",teasp.message.getLabel("status_label")),this.showMessage("monsumDept",teasp.message.getLabel("dept_label")),this.showMessage("monsumEmpType",teasp.message.getLabel("empType_label")),this.showMessage("monsumEmpCode",teasp.message.getLabel("tk10000068")),this.showMessage("monsumName",teasp.message.getLabel(
"empName_label")),this.showMessage("monsumHead1",teasp.message.getLabel("date_head")),this.showMessage("monsumHead2",teasp.message.getLabel(this.pouch.isUseWorkLocation()?"tw00000170":"tm10009190")),this.showMessage("monsumHead11",teasp.message.getLabel("ac00000250")),this.showMessage("monsumHead3",teasp.message.getLabel("startTime_head")),this.showMessage("monsumHead4",teasp.message.getLabel("endTime_head")),
this.showMessage("monsumHead12",teasp.message.getLabel("ac00000260")),this.showMessage("monsumHead13",teasp.message.getLabel("ac00000270")),this.showMessage("monsumHead5",teasp.message.getLabel("rest_head")),this.showMessage("monsumHead6",teasp.message.getLabel(this.pouch.isMsDailyWorkTimeIsReal()?"tm10009201":"tm10009200")),this.showMessage("monsumHead7",teasp.message.getLabel("overTime_head")),this.showMessage(
"monsumHead8",teasp.message.getLabel("holidayWorkTime_head")),this.showMessage("monsumHead9",teasp.message.getLabel("nightWorkTime_head")),this.showMessage("monsumHead10",teasp.message.getLabel("note_head")),this.showMessage("monsumMean",teasp.message.getLabel("tm10009090")),this.showMessage("monsumSummary",teasp.message.getLabel("monthSummary_label"))},teasp.view.MonthlySummary.prototype.showHead=function(){
var e=this.pouch.getYearMonth(),e=teasp.util.date.formatMonth("zv00000021",Math.floor(e/100),e%100,this.pouch.getSubNo()),t=(teasp.util.setWindowTitle(teasp.message.getLabel("tm10009010",e,this.pouch.getName())),this.pouch.getEmpMonthApplyStatus());t&&!teasp.constant.STATUS_CANCELS.contains(t)&&!teasp.constant.STATUS_REJECTS.contains(t)||(t=teasp.constant.STATUS_NOTADMIT),dojo.byId("yearMonth").innerHTML=e,dojo.byId(
"monthlyStatus").innerHTML=teasp.constant.getDisplayStatus(t),dojo.byId("department").innerHTML=this.pouch.getDeptName(),dojo.byId("empTypeName").innerHTML=this.pouch.getEmpTypeName(),dojo.byId("empCode").innerHTML=this.pouch.getTargetEmpObj().code||"",dojo.byId("empName").innerHTML=this.pouch.getName(),dojo.byId("yearMonth2").innerHTML=e},teasp.view.MonthlySummary.prototype.showDayBody=function(){for(
var e=dojo.byId("workTableBody"),t=this.pouch.getMonthDateList(),a=0;a<t.length;a++){var o=this.pouch.getEmpDay(t[a]),i=teasp.util.date.parseDate(t[a]),n=e.rows[a+1],r=(n.className=a%2==0?"prtv_row_even":"prtv_row_odd",n.cells[0]);0==a||1==i.getDate()?r.innerHTML=i.getMonth()+1+"/"+i.getDate():r.innerHTML=i.getDate(),n.cells[1].innerHTML=teasp.util.date.formatDate(i,"JPW"),r=n.cells[2],o.getDayType(
)==teasp.constant.DAY_TYPE_NORMAL_HOLIDAY||o.getDayType()==teasp.constant.DAY_TYPE_PUBLIC_HOLIDAY?r.innerHTML=teasp.message.getLabel("tm10009100"):o.getDayType()==teasp.constant.DAY_TYPE_LEGAL_HOLIDAY?r.innerHTML=teasp.message.getLabel("tm10009110"):o.getDayType()==teasp.constant.DAY_TYPE_NORMAL&&o.isPlannedHoliday()&&(r.innerHTML=teasp.message.getLabel("tm10009120")),dojo.create("div",{innerHTML:o.getDayEvent(),
style:{fontSize:"0.9em",margin:"0px",padding:"0px"}},n.cells[3]),this.pouch.isAlive(t[a])&&(this.pouch.isIndicateNoPushTime()&&o.getStartTimeJudge()<0&&(n.cells[5].style.textDecoration="underline"),this.pouch.isIndicateNoPushTime()&&o.getEndTimeJudge()<0&&(n.cells[6].style.textDecoration="underline"),i=this.pouch.getCalcMode(),n.cells[4].innerHTML=o.getEnterTime(),n.cells[5].innerHTML=o.getStartTime(!1,null,i),
n.cells[6].innerHTML=o.getEndTime(!1,null,i),n.cells[7].innerHTML=o.getExitTime(),n.cells[8].innerHTML=o.getDivergenceJudge().summ||"",n.cells[9].innerHTML=o.getRestTime(!1,"","",i),this.pouch.getWorkSystem()==teasp.constant.WORK_SYSTEM_MANAGER&&i==teasp.constant.C_DISC?n.cells[10].innerHTML=o.getDaySubTimeByKey("minasiWorkWholeTime",!1,"","",i):n.cells[10].innerHTML=o.getDaySubTimeByKey(
this.pouch.isMsDailyWorkTimeIsReal()?"workRealTime":"workWholeTime",!1,"","",i),this.pouch.getWorkSystem()==teasp.constant.WORK_SYSTEM_MANAGER?(n.cells[11].innerHTML="",n.cells[12].innerHTML=""):(this.pouch.getWorkSystem()==teasp.constant.WORK_SYSTEM_FLEX&&1<this.pouch.getVariablePeriod()?n.cells[11].innerHTML="":n.cells[11].innerHTML=o.getDaySubTimeByKey("workOverTime",!1,"",""),
n.cells[12].innerHTML=o.getDaySubTimeByKey("workHolidayTime",!1,"","")),n.cells[13].innerHTML=o.getDaySubTimeByKey("workNightTime",!1,"","",teasp.constant.C_REAL)),s=this.pouch.isIndicateNoPushTime()&&0<(s=o.getTimeCaution()).length?'<span style="color:#3333CC;font-size:0.95em;">('+s+")</span> "+teasp.util.entitize(o.getDayNote(!this.pouch.isSeparateDailyNote()),""):teasp.util.entitize(o.getDayNote(
!this.pouch.isSeparateDailyNote()),""),n.cells[14].innerHTML=s,n.cells[14].style.borderRight="none"}for(;a<e.rows.length-2;)e.rows[a+1].style.display="none",a++},teasp.view.MonthlySummary.prototype.showDayFoot=function(){this.pouch.getWorkSystem()==teasp.constant.WORK_SYSTEM_FLEX?(this.styleDisplay("monthlyWeekWholeTimeRow",!0),this.styleDisplay("amountTime",!0),this.styleDisplay("monthlyLegalMax",!0),
this.styleDisplay("monthlyWeekRealTimeRow",!0),this.styleDisplay("monthlyRealTimeRow",!1)):(this.styleDisplay("monthlyWeekWholeTimeRow",!1),this.styleDisplay("amountTime",!1),this.styleDisplay("monthlyLegalMax",!1),this.styleDisplay("monthlyWeekRealTimeRow",!1),this.styleDisplay("monthlyRealTimeRow",!0));var e=document.getElementById("workTableFootRow"),t=this.pouch.getCalcMode(!0);
e.cells[1].innerHTML=this.pouch.getMonthSubTimeByKey("restTime",!1,null,t),this.pouch.getWorkSystem()==teasp.constant.WORK_SYSTEM_MANAGER&&t==teasp.constant.C_DISC?e.cells[2].innerHTML=this.pouch.getMonthSubTimeByKey("minasiWorkWholeTime",!1,"","",t):e.cells[2].innerHTML=this.pouch.getMonthSubTimeByKey(this.pouch.isMsDailyWorkTimeIsReal()?"workRealTime":"workWholeTime",!1,null,t),this.pouch.getWorkSystem(
)==teasp.constant.WORK_SYSTEM_MANAGER?(e.cells[3].innerHTML="",e.cells[4].innerHTML=""):(this.pouch.getWorkSystem()==teasp.constant.WORK_SYSTEM_FLEX&&1<this.pouch.getVariablePeriod()?e.cells[3].innerHTML="":e.cells[3].innerHTML=this.pouch.getMonthSubTimeByKey("workOverTime"),e.cells[4].innerHTML=this.pouch.getMonthSubTimeByKey("workHolidayTime")),e.cells[5].innerHTML=this.pouch.getMonthSubTimeByKey("workNightTime",!1
,null,teasp.constant.C_REAL),dojo.query(".total_table").forEach(function(e){for(var t=0,a=0;a<e.rows.length;a++){var o=e.rows[a];"none"!=o.style.display&&(dojo.toggleClass(o,"even",t%2==0),dojo.toggleClass(o,"odd",t%2!=0),t++)}})},teasp.view.MonthlySummary.prototype.showSummaryBottom=function(){var e=this.helperSummary.getSummaryBottomContents(),t=dojo.byId("summaryBottom"),a=e.numberOfColumns||0;if(!a
)return dojo.style("summaryTitleRow","display","none"),void dojo.style("summaryTitleBorder","display","none");for(var o=dojo.create("tbody",null,dojo.create("table",{className:"colla_table",style:"width:100%;"},t)),s=dojo.create("tr",{style:"vertical-align:top;"},o),i=[],n=[],r=0;r<a;r++){var l=dojo.create("td",{style:"width:"+100/a+"%;"},s);dojo.style(l,"paddingRight",r<a-1?"8px":"2px"),n.push(l),i.push(dojo.create(
"tbody",null,dojo.create("table",{className:"total_table"},l)))}for(var p=1;p<=a;){for(var o=i[p-1],d=e["column"+p]||[],c=0,m=!1,r=0;r<d.length;r++){var h=d[r];h.skip||(h.separator?(h.label?dojo.create("div",{style:"padding:1px 4px;text-align:left;",innerHTML:h.label},n[p-1]):dojo.create("div",{style:"height:4px;"},n[p-1]),m=!(c=0)):(!c&&m&&(o=i[p-1]=dojo.create("tbody",null,dojo.create("table",{
className:"total_table"},n[p-1]))),s=dojo.create("tr",{className:c++%2==0?"even":"odd"},o),h.labelOnly?dojo.create("div",{innerHTML:h.label||"&nbsp;"},dojo.create("td",{className:"column",colSpan:"2"},s)):(dojo.create("div",{innerHTML:h.label||"&nbsp;"},dojo.create("td",{className:"column"},s)),dojo.create("div",{innerHTML:teasp.util.dspVal(h.value,"&nbsp;")},dojo.create("td",{className:"value"},s))),
h.lines&&!h.noDetail&&(l=dojo.create("td",{colSpan:"2",className:"detail_area"},dojo.create("tr",{className:c++%2==0?"even":"odd"},o)),this.displayHolidayItems(l,h.lines))))}p++}},teasp.view.MonthlySummary.prototype.displayHolidayItems=function(e,t){for(var a=dojo.create("tbody",null,dojo.create("table",{className:"holy_item_table",style:"border-collapse:collapse;"},e)),o=0;o<t.length;o++){var s=t[o],i=dojo.create(
"tr",null,a);dojo.create("td",{className:"holy_item_col1",innerHTML:s.head},i),dojo.create("td",{className:"holy_item_col2",innerHTML:s.label},i),dojo.create("td",{className:"holy_item_col3",innerHTML:s.value},i)}},teasp.view.MonthlySummary.prototype.convertPdfWorkFields=function(e){for(var t=e||[],a=[],o=0;o<t.length;o++){var s=t[o],i={};s.skip||(s.separator?(i.separator=!0,i.label=s.label||""):(i.label=s.label||"",
i.value=teasp.util.dspVal(s.value,""),s.labelOnly&&(i.labelOnly=!0),s.hasOwnProperty("lines")&&!s.noDetail&&(i.lines=s.lines)),a.push(i))}return a},teasp.view.MonthlySummary.prototype.getPdfWorkData=function(e,t,a){this.pouch=e;for(var o={head:{},daysHead:{},days:[],daysFoot:{},bottomL:[],bottomC:[],bottomR:[],stepHead:{},steps:[]},i=this.pouch.getYearMonth(),n=this.pouch.getSubNo(),
r=this.pouch.getEmpMonthApplyStatus(),l=(r&&!teasp.constant.STATUS_CANCELS.contains(r)&&!teasp.constant.STATUS_REJECTS.contains(r)||(r=teasp.constant.STATUS_NOTADMIT),o.head.titleLabel=teasp.message.getLabel("workTable_label"),o.head.statusLabel=teasp.message.getLabel("status_label"),o.head.deptLabel=teasp.message.getLabel("dept_label"),o.head.empTypeLabel=teasp.message.getLabel("empType_label"),
o.head.empCodeLabel=teasp.message.getLabel("tk10000068"),o.head.empLabel=teasp.message.getLabel("empName_label"),o.head.month=teasp.util.date.formatMonth("zv00000021",Math.floor(i/100),i%100,n),o.head.status=teasp.constant.getDisplayStatus(r),o.head.deptName=this.pouch.getDeptName(),o.head.empTypeName=this.pouch.getEmpTypeName(),o.head.empCode=this.pouch.getTargetEmpObj().code||"",o.head.empName=this.pouch.getName(),
o.daysHead.date=teasp.message.getLabel("date_head"),o.daysHead.event=teasp.message.getLabel(this.pouch.isUseWorkLocation()?"tw00000171":"tm10009190"),o.daysHead.st=teasp.message.getLabel("startTime_head"),o.daysHead.et=teasp.message.getLabel("endTime_head"),o.daysHead.rest=teasp.message.getLabel("rest_head"),o.daysHead.work=teasp.message.getLabel(this.pouch.isMsDailyWorkTimeIsReal()?"tm10009201":"tm10009200"),
o.daysHead.over=teasp.message.getLabel("overTime_head"),o.daysHead.holiday=teasp.message.getLabel("holidayWorkTime_head"),o.daysHead.night=teasp.message.getLabel("nightWorkTime_head"),o.daysHead.note=teasp.message.getLabel("note_head"),o.explain=teasp.message.getLabel("tm10009090"),o.summaryTitle=teasp.message.getLabel("monthSummary_label"),this.pouch.getMonthDateList()),p=0;p<l.length;p++){
var d=this.pouch.getEmpDay(l[p]),c=teasp.util.date.parseDate(l[p]),m={};m.date=""+(0==p||1==c.getDate()?c.getMonth()+1+"/"+c.getDate():c.getDate()),m.week=teasp.util.date.formatDate(c,"JPW"),d.getDayType()==teasp.constant.DAY_TYPE_NORMAL_HOLIDAY||d.getDayType()==teasp.constant.DAY_TYPE_PUBLIC_HOLIDAY?m.mark=teasp.message.getLabel("tm10009100"):d.getDayType(
)==teasp.constant.DAY_TYPE_LEGAL_HOLIDAY?m.mark=teasp.message.getLabel("tm10009110"):d.getDayType()==teasp.constant.DAY_TYPE_NORMAL&&d.isPlannedHoliday()&&(m.mark=teasp.message.getLabel("tm10009120")),m.event=d.getDayEvent(),this.pouch.isAlive(l[p])&&(m.st_unsco=!1,m.et_unsco=!1,this.pouch.isIndicateNoPushTime()&&d.getStartTimeJudge()<0&&(m.st_unsco=!0),this.pouch.isIndicateNoPushTime()&&d.getEndTimeJudge()<0&&(
m.et_unsco=!0),h=this.pouch.getCalcMode(),m.st=d.getStartTime(!1,null,h),m.et=d.getEndTime(!1,null,h),m.rest=d.getRestTime(!1,"","",h),this.pouch.getWorkSystem()==teasp.constant.WORK_SYSTEM_MANAGER&&h==teasp.constant.C_DISC?m.work=d.getDaySubTimeByKey("minasiWorkWholeTime",!1,"","",h):m.work=d.getDaySubTimeByKey(this.pouch.isMsDailyWorkTimeIsReal()?"workRealTime":"workWholeTime",!1,"","",h),this.pouch.getWorkSystem(
)==teasp.constant.WORK_SYSTEM_MANAGER?(m.over="",m.holiday=""):(this.pouch.getWorkSystem()==teasp.constant.WORK_SYSTEM_FLEX&&1<this.pouch.getVariablePeriod()?m.over="":m.over=d.getDaySubTimeByKey("workOverTime",!1,"",""),m.holiday=d.getDaySubTimeByKey("workHolidayTime",!1,"","")),m.night=d.getDaySubTimeByKey("workNightTime",!1,"","",teasp.constant.C_REAL)),this.pouch.isIndicateNoPushTime()&&0<(s=d.getTimeCaution()
).length?m.note="("+s+") "+d.getDayNote(!this.pouch.isSeparateDailyNote()):m.note=d.getDayNote(!this.pouch.isSeparateDailyNote()),o.days.push(m)}for(var h=this.pouch.getCalcMode(!0),i=(o.daysFoot.title=teasp.message.getLabel("total_label"),o.daysFoot.rest=this.pouch.getMonthSubTimeByKey("restTime",!1,null,h),this.pouch.getWorkSystem(
)==teasp.constant.WORK_SYSTEM_MANAGER&&h==teasp.constant.C_DISC?o.daysFoot.work=this.pouch.getMonthSubTimeByKey("minasiWorkWholeTime",!1,"","",h):o.daysFoot.work=this.pouch.getMonthSubTimeByKey(this.pouch.isMsDailyWorkTimeIsReal()?"workRealTime":"workWholeTime",!1,null,h),this.pouch.getWorkSystem()==teasp.constant.WORK_SYSTEM_MANAGER?(o.daysFoot.over="",o.daysFoot.holiday=""):(this.pouch.getWorkSystem(
)==teasp.constant.WORK_SYSTEM_FLEX&&1<this.pouch.getVariablePeriod()?o.daysFoot.over="":o.daysFoot.over=this.pouch.getMonthSubTimeByKey("workOverTime"),o.daysFoot.holiday=this.pouch.getMonthSubTimeByKey("workHolidayTime")),o.daysFoot.night=this.pouch.getMonthSubTimeByKey("workNightTime",!1,null,teasp.constant.C_REAL),this.pouch.getWorkSystem(),teasp.constant.WORK_SYSTEM_FLEX,
this.helperSummary=new teasp.helper.Summary(this.pouch),this.helperSummary.getSummaryBottomContents()),u=(o.bottomL=this.convertPdfWorkFields(i.column1),o.bottomC=this.convertPdfWorkFields(i.column2),o.bottomR=this.convertPdfWorkFields(i.column3),o.bottomLShow=0<i.numberOfColumns,o.bottomCShow=1<i.numberOfColumns,o.bottomRShow=2<i.numberOfColumns,o.stepShow=a||!1,o.stepTitle=teasp.message.getLabel(
"approvalHistory_label"),o.stepHead.date=teasp.message.getLabel("tf10006980"),o.stepHead.applyType=teasp.message.getLabel("tf10006990"),o.stepHead.number=teasp.message.getLabel("number_head"),o.stepHead.createdDate=teasp.message.getLabel("dateTime_head"),o.stepHead.status=teasp.message.getLabel("statusj_head"),o.stepHead.actor=teasp.message.getLabel("actor_head"),o.stepHead.comment=teasp.message.getLabel(
"comment_head"),this.convertSteps(t,e)),p=0;p<u.length;p++)for(var g=u[p],y=0;y<g.steps.length;y++){var f=g.steps[y],b=0==y?1:0;y==g.steps.length-1&&(b|=2),o.steps.push({date:0==y?g.dispDate:"",applyType:0==y?g.applyType:"",createdDate:f.createdDate,status:f.stepStatus,actor:f.actorName,comment:f.comments,bobit:b})}return o.steps.length||o.steps.push({date:"",applyType:"",createdDate:"",status:"",actor:"",comment:"",
bobit:3}),{summary:o}},teasp.view.MonthlySummary.prototype.getApplyMap=function(e){for(var t={},a=e.dataObj.applys||[],o=0;o<a.length;o++){var s=a[o];t[s.id]=s}return t},teasp.view.MonthlySummary.prototype.convertSteps=function(e,t){for(var a=this.getApplyMap(t),o=t.dataObj.month.startDate,s=t.dataObj.month.endDate,i=t.dataObj.month.yearMonth,n={},r=0;r<e.length;r++){var l,p=e[r];
p.StepStatus&&"noresponse"==p.StepStatus.toLowerCase()||(c=a[p.ProcessInstance.TargetObjectId])&&(n[c.id]||((n[c.id]=c).steps=[],l=this.getTargetDate(c,o,s,i),c.sortDate=l.date,c.dispDate=l.disp,c.isTarget=l.range&&teasp.constant.STATUS_FIX.contains(c.status)),c.steps.push({actorName:p.OriginalActor&&p.OriginalActor.Name||p.Actor&&p.Actor.Name||"",createdDate:teasp.util.date.formatDateTime(p.CreatedDate),
createdDateN:p.CreatedDate,stepStatus:teasp.constant.getStepStatus(p.StepStatus),comments:p.Comments||p.Note__c||""}))}var d,c,m=[];for(d in n)n.hasOwnProperty(d)&&(c=n[d]).isTarget&&(c.steps=c.steps.sort(function(e,t){var a=teasp.constant.STATUS_REQUESTED;if(e.createdDateN==t.createdDateN){if(e.stepStatus==a)return-1;if(t.stepStatus==a)return 1}return e.createdDateN-t.createdDateN}),m.push(c));
var h=teasp.constant.APPLY_TYPE_MONTHLY;return m=m.sort(function(e,t){if(e.applyType!=t.applyType){if(e.applyType==h)return 1;if(t.applyType==h)return-1}return e.sortDate==t.sortDate?e.steps[0].createdDateN-t.steps[0].createdDateN:e.sortDate<t.sortDate?-1:1})},teasp.view.MonthlySummary.prototype.getTargetDate=function(e,t,a,o){var s=e.startDate,i=e.endDate,n=e.exchangeDate;
return e.applyType==teasp.constant.APPLY_TYPE_MONTHLY?{date:a,disp:teasp.message.getLabel("tm10010461",teasp.util.date.formatDate(t,"M/d"),teasp.util.date.formatDate(a,"M/d")),range:e.yearMonth==o}:e.applyType==teasp.constant.APPLY_TYPE_MONTHLYOVERTIME?{date:s,disp:teasp.message.getLabel("tm10010461",teasp.util.date.formatDate(s,"M/d"),teasp.util.date.formatDate(i,"M/d")),range:t<=s&&s<=a
}:e.applyType==teasp.constant.APPLY_TYPE_EXCHANGE?t<=s&&s<=a?{date:s,disp:teasp.util.date.formatDate(s,"M/d")+"->"+teasp.util.date.formatDate(n,"M/d"),range:!0}:{date:n,disp:teasp.util.date.formatDate(n,"M/d")+"<-"+teasp.util.date.formatDate(s,"M/d"),range:t<=n&&n<=a}:s!=i?{date:s,disp:teasp.message.getLabel("tm10010461",teasp.util.date.formatDate(s,"M/d"),teasp.util.date.formatDate(i,"M/d")),
range:t<=s&&s<=a||t<=i&&i<=a}:{date:s,disp:teasp.util.date.formatDate(s,"M/d"),range:t<=s&&s<=a}},teasp.provide("teasp.view.BulkTest"),teasp.view.BulkTest=function(){this.rangeYear=null,this.viewPos=null,this.eventHandles={},this.busy=!1,this.stopped=!1,this.currentMenuNo=null,this.dayWorks=null,this.jobMap=null,this.itemMap=null,this.execInit=!1,this.masterEmps=[],this.masterExpItem={},this.nameSpacePrefix=""},
teasp.view.BulkTest.prototype=new teasp.view.Base,teasp.view.BulkTest.prototype.init=function(e,t,a){teasp.message.mergeLabels(globalMessages||{}),teasp.message.mergeLabels(e&&e[teasp.message.getLanguageLocaleKey()]||{}),this.nameSpacePrefix=this.getNameSpacePrefix(),this.readParams({target:"empMonth",noDelay:!0}),teasp.manager.request("loadEmpMonth",this.viewParams,this.pouch,{hideBusy:!0},this,function(){
this.setBusy(!1),this.initView(),t()},function(e){this.setBusy(!1),a(e)})},teasp.view.BulkTest.prototype.initView=function(){dojo.connect(dojo.byId("testMenu1"),"onclick",this,function(){this.changeMenu(1)}),dojo.connect(dojo.byId("testMenu2"),"onclick",this,function(){this.changeMenu(2)}),dojo.connect(dojo.byId("testMenu3"),"onclick",this,function(){this.changeMenu(3)}),dojo.connect(dojo.byId("doExecTest1"),
"onclick",this,this.goImport),dojo.connect(dojo.byId("doExecTest2"),"onclick",this,this.execVacuum),dojo.connect(dojo.byId("doExecTest3"),"onclick",this,this.yuqInfoTest),dojo.connect(dojo.byId("stopExecTest1"),"onclick",this,this.stopTest),(this.pouch.isSysAdmin()||this.pouch.isAdmin())&&this.pouch.isBulkTestOn()?(j$("#testCaution").html('★テスト・デモデータ作成ツール★<span style="font-size:0.9em;">取り扱い注意</span>★'),
this.changeMenu(1),this.pouch.getEmpId()&&(j$("#testYm1").val(""+this.pouch.getYearMonth()),j$("#testYm2").val(""+this.pouch.getYearMonth())),this.fetchEmp()):j$("#testCaution").text("利用できません")},teasp.view.BulkTest.prototype.getNameSpacePrefix=function(){var e=null,t=Visualforce?Visualforce.remoting.RemotingProvider.actions:{};for(key in t)if(t.hasOwnProperty(key)&&/((.+)\.)?RtkPotalCtl/.test(key)){e=RegExp.$2;break}
return e?e+"__":""},teasp.view.BulkTest.prototype.setBusy=function(e){this.busy=e,this.busy?(j$("#doExecTest1").attr("disabled","disabled"),j$("#doExecTest2").attr("disabled","disabled"),j$("#testValueArea1").attr("disabled","disabled"),j$("#checkNoup").attr("disabled","disabled"),j$("#testEmpName").attr("disabled","disabled"),j$("#testYm1").attr("disabled","disabled"),j$("#testYm2").attr("disabled","disabled"),j$(
"#stopExecTest1").removeAttr("disabled"),j$("#testMessage1").text("実行中.."),j$("#testMessage2").text("実行中..")):(j$("#doExecTest1").removeAttr("disabled"),j$("#doExecTest2").removeAttr("disabled"),j$("#testValueArea1").removeAttr("disabled"),j$("#checkNoup").removeAttr("disabled"),j$("#testEmpName").removeAttr("disabled"),j$("#testYm1").removeAttr("disabled"),j$("#testYm2").removeAttr("disabled"),j$("#stopExecTest1"
).attr("disabled","disabled"),j$("#testMessage1").text(""),j$("#testMessage2").text(""))},teasp.view.BulkTest.prototype.changeMenu=function(e){if(!this.isBusy()){this.currentMenuNo=e;for(var t=1;t<=3;t++)j$("#testMenu"+t).toggleClass("noactive",t!=e).toggleClass("active",t==e),j$("#testMenu"+t+"Area").css("display",t==e?"":"none")}},teasp.view.BulkTest.prototype.isBusy=function(){return this.busy},
teasp.view.BulkTest.prototype.fetchEmp=function(){var e="select Id, Name from "+this.nameSpacePrefix+"AtkEmp__c order by Name, Id limit 101",i=this;sforce.connection.query(e,{onSuccess:function(e,t){var a=e.getArray("records");teasp.logic.convert.excludeNameSpace(a);for(var o=0;o<a.length;o++)i.masterEmps.push({id:a[o].Id,name:a[o].Name});for(o=0;o<i.masterEmps.length;o++){var s=i.masterEmps[o];j$("#testEmpName"
).append(j$("<option/>").val(s.id).text(s.name)),j$("#testEmpName2").append(j$("<option/>").val(s.id).text(s.name))}i.pouch.getEmpId()&&(j$("#testEmpName").val(i.pouch.getEmpId()),j$("#testEmpName2").val(i.pouch.getEmpId())),i.fetchExpItem()},onFailure:function(e,t){alert(e)},source:{startTime:(new Date).getTime()}})},teasp.view.BulkTest.prototype.fetchExpItem=function(){
var e="select Id, Name from "+this.nameSpacePrefix+"AtkExpItem__c",s=this;sforce.connection.query(e,{onSuccess:function(e,t){var a=e.getArray("records");teasp.logic.convert.excludeNameSpace(a);for(var o=0;o<a.length;o++)s.masterExpItem[a[o].Name]=a[o].Id},onFailure:function(e,t){alert(e)},source:{startTime:(new Date).getTime()}})},teasp.view.BulkTest.prototype.getEmpIdByName=function(e){for(
var t=0;t<this.masterEmps.length;t++)if(this.masterEmps[t].name==e)return this.masterEmps[t].id;return null},teasp.view.BulkTest.prototype.putLog=function(e,t){var a=j$("#testLog"+this.currentMenuNo).html();j$("#testLog"+this.currentMenuNo).html(a+(t?"":"<br/>")+e)},teasp.view.BulkTest.prototype.showError=function(e){var t=j$("#testLog"+this.currentMenuNo).html();j$("#testLog"+this.currentMenuNo).html(
t+'<br/><span style="color:red;">エラー：'+e+"</span>")},teasp.view.BulkTest.prototype.putSkipLog=function(e,t){var a=j$("#testLog"+this.currentMenuNo).html();j$("#testLog"+this.currentMenuNo).html(a+(t?"":"<br/>")+'<span style="color:blue;">'+e+"</span>")},teasp.view.BulkTest.prototype.stopTest=function(){this.stopped=!0,j$("#stopExecTest1").attr("disabled","disabled")},
teasp.view.BulkTest.prototype.getYearMonthByDate=function(e){return teasp.util.searchYearMonthDate(this.pouch.getInitialDateOfMonth(),this.pouch.getMarkOfMonth(),null,e).yearMonth},teasp.view.BulkTest.prototype.getJobYearMonthByDate=function(e){return teasp.util.searchYearMonthDate(this.pouch.getJobInitialDayOfMonth(),this.pouch.getJobMarkOfMonth(),null,e).yearMonth},
teasp.view.BulkTest.prototype.getCsvFromTextArea=function(e){e=j$.trim(j$(e).val());if(""==e)return this.showError("値がセットされていません"),null;for(var t=e.split(/\r?\n/),a=[],o=[],s=[],i=0;i<t.length;i++){var n=t[i].split(/\t/);"勤怠"==n[0]?(c=this.parseKintai(i,n),a.push(c)):"経費"==n[0]?(c=this.parseExp(i,n),o.push(c)):"工数"==n[0]&&(c=this.parseJob(i,n),s.push(c))}if(0<a.length){for(var r=[],l=null,p=null,d=0;d<a.length;d++){
var c=a[d];l&&(!c.en||c.en.length<=0)&&(c.en=l),p&&(!c.d||c.d.length<=0)&&(c.d=p),l=c.en,p=c.d,r.contains(c.en)||r.push(c.en)}var a=a.sort(function(e,t){return e.en==t.en?e.d==t.d?e.r-t.r:e.d<t.d?-1:1:r.indexOf(e.en)-r.indexOf(t.en)}),m=[];p=l=null;for(d=0;d<a.length;d++){var h,c=a[d];l&&p&&c.en==l&&c.d==p?(!(h=m[m.length-1]).st&&c.st&&(h.st=c.st),!h.et&&c.et&&(h.et=c.et),0<c.rt.length&&(h.rt=h.rt.concat(c.rt)),
0<c.at.length&&(h.at=h.at.concat(c.at)),0<c.unrt.length&&(h.unrt=h.unrt.concat(c.unrt)),0<c.ap.length&&(h.ap=h.ap.concat(c.ap))):(m.push(c),l=c.en,p=c.d)}a=m}if(0<o.length){for(r=[],l=null,p=null,d=0;d<o.length;d++){c=o[d];l&&(!c.en||c.en.length<=0)&&(c.en=l),p&&(!c.d||c.d.length<=0)&&(c.d=p),l=c.en,p=c.d,r.contains(c.en)||r.push(c.en)}for(var o=o.sort(function(e,t){
return e.en==t.en?e.d==t.d?e.r-t.r:e.d<t.d?-1:1:r.indexOf(e.en)-r.indexOf(t.en)}),u=[],g=0,d=0;d<o.length;d++){c=o[d];if(u.length<=0)c.en?u.push({en:c.en,eps:[c]}):u.push({eps:[c]}),g=0;else if(!c.en||c.en&&u[g].en==c.en)u[g].eps.push(c);else{for(var y=-1,f=0;f<u.length;f++)if(u[f].en==c.en){y=f;break}0<=y?u[g=y].eps.push(c):(u.push({en:c.en,eps:[c]}),g=u.length-1)}}for(m=[],d=0;d<u.length;d++){(T=u[d]
).eps=T.eps.sort(function(e,t){return e.d&&t.d?e.d<t.d?-1:e.d>t.d?1:0:e.d?1:-1});for(var b=[],_={},d=0;d<T.eps.length;d++)(c=T.eps[d]).d&&((j=_[c.d])?j.push(c):(b.push(c.d),_[c.d]=[c]));for(d=0;d<b.length;d++){c={d:p=b[d],exps:_[p]};0==d&&(c.en=T.en),m.push(c)}}o=m}if(0<s.length){for(r=[],l=null,p=null,d=0;d<s.length;d++){c=s[d];l&&(!c.en||c.en.length<=0)&&(c.en=l),p&&(!c.d||c.d.length<=0)&&(c.d=p),l=c.en,p=c.d,
r.contains(c.en)||r.push(c.en)}for(s=s.sort(function(e,t){return e.en==t.en?e.d==t.d?e.r-t.r:e.d<t.d?-1:1:r.indexOf(e.en)-r.indexOf(t.en)}),u=[],g=0,d=0;d<s.length;d++){c=s[d];if(u.length<=0)c.en?u.push({en:c.en,jsons:[c]}):u.push({jsons:[c]}),g=0;else if(!c.en||c.en&&u[g].en==c.en)u[g].jsons.push(c);else{for(y=-1,f=0;f<u.length;f++)if(u[f].en==c.en){y=f;break}0<=y?u[g=y].jsons.push(c):(u.push({en:c.en,jsons:[c]}),
g=u.length-1)}}for(var m=[],v={},d=0;d<u.length;d++){(T=u[d]).jsons=T.jsons.sort(function(e,t){return e.d&&t.d?e.d<t.d?-1:e.d>t.d?1:0:e.d?1:-1});for(var T,j,b=[],_={},d=0;d<T.jsons.length;d++)(c=T.jsons[d]).d&&c.jn&&(v[c.jn]=1,(j=_[c.d])?j.push(c):(b.push(c.d),_[c.d]=[c]));for(d=0;d<b.length;d++){c={d:b[d],works:_[b[d]]};0==d&&(c.en=T.en),m.push(c)}}s=m}return{kts:a,eps:o,jbs:s}},
teasp.view.BulkTest.prototype.parseKintai=function(e,t){var e={r:e,en:t[1]||null,d:teasp.util.date.formatDate(t[2]),st:t[3]||null,et:t[4]||null,rt:[],at:[],unrt:[],ap:[]},a=t[5]||null,o=t[6]||null,a=(a&&o&&0<a.length&&0<o.length&&e.rt.push({st:a,et:o}),a=t[7]||null,o=t[8]||null,a&&o&&0<a.length&&0<o.length&&e.at.push({st:a,et:o}),a=t[9]||null,o=t[10]||null,a&&o&&0<a.length&&0<o.length&&e.unrt.push({st:a,et:o}),
t[11]||null);return a&&0<a.length&&e.ap.push({sn:a,hn:t[12]||null,pn:t[13]||null,ed:teasp.util.date.formatDate(t[14]),st:t[15]||null,et:t[16]||null,ex:teasp.util.date.formatDate(t[17]),nt:t[18]||null,ct:t[19]||null}),e},teasp.view.BulkTest.prototype.parseExp=function(e,t){e={r:e,en:t[1]||null,d:teasp.util.date.formatDate(t[2]),jn:t[3]||null,it:t[4]||null,ss:t[5]||null,es:t[6]||null,rd:t[7]||!1,mn:t[8]||"0",
nt:t[9]||null,tt:t[10]||null,wt:t[11]||"0",tx:t[12]||"0",ta:t[13]||!1,cn:t[14]||null,rt:t[15]||"0",fa:t[16]||"0"};return e.rd="string"==typeof e.rd&&"true"==e.rd.toLowerCase(),e.ta="string"==typeof e.ta&&"true"==e.ta.toLowerCase(),e},teasp.view.BulkTest.prototype.parseJob=function(e,t){e={r:e,en:t[1]||null,d:teasp.util.date.formatDate(t[2]),jn:t[3]||null,sb:t[4]||null,vl:t[5]||null,tm:t[6]||null,tx:t[7]||!1,
tn:t[8]||null};return e.vl=e.vl&&/^(\d+)$/.test(e.vl)?parseInt(e.vl,10):null,e.tx="string"==typeof e.tx&&"true"==e.tx.toLowerCase(),e},teasp.view.BulkTest.prototype.goImport=function(){if(!this.isBusy()){j$("#testLog1").text("");var e=this.getCsvFromTextArea("#testValueArea1");if(e){if(this.execInit=!1,this.stopped=!1,this.setBusy(!0),this.putLog("オブジェクト数"),this.putLog("勤怠 ... "+e.kts.length),this.putLog(
"経費 ... "+e.eps.length),this.putLog("工数 ... "+e.jbs.length),0<e.eps.length){for(var t={},a=0;a<e.eps.length;a++)for(var o=e.eps[a],s=0;s<o.exps.length;s++){var i=o.exps[s];this.masterExpItem[i.it]||(t[i.it]=1)}var n,r="";for(n in this.putLog("費目チェック"),t)r=r+"\n\t"+n,this.putLog("「"+n+"」は登録されていません");if(r){if(!confirm("以下の費目は登録されていないため、この費目の経費はインポートされませんが、よろしいですか？\n"+r+"\n\nよろしければ［ＯＫ］をクリックして続行してください")
)return this.putSkipLog("******************** 中止しました"),void this.setBusy(!1)}else this.putLog("...ok",!0)}this.importKintai(e,0,0)}}},teasp.view.BulkTest.prototype.importKintai=function(t,a,o){if(t.kts.length<=a)return this.putLog("**** 勤怠インポート終了 ****"),void this.importExpStep1(t);if(this.stopped)return this.putSkipLog("**** 中止しました ****"),void this.setBusy(!1);var s=t.kts[a];if(!s.d)return this.putSkipLog("日付なし"),
void this.importKintai(t,++a);if(s.empId=this.getEmpIdByName(s.en),!this.execInit||s.empId&&this.pouch.getEmpId()&&s.empId!=this.pouch.getEmpId())return this.execInit=!0,e=this.pouch.getEmpId()?this.getYearMonthByDate(s.d):0,this.putLog("勤怠 - "+e),void teasp.manager.request("loadEmpMonth",{empId:s.empId||"",month:e||""},this.pouch,{hideBusy:!0},this,function(){if(this.putLog(" .. ok",!0),!this.pouch.getEmpId()
)return this.showError("ログインユーザに紐づく社員は設定されていません。社員名(en)をデータにセットしてください"),void this.setBusy(!1);s.empId=this.pouch.getEmpId();var e=this;teasp.manager.completeCheck(function(){e.importKintai(t,a,o)})},function(e){this.putLog(" .. failed",!0),this.showError(e.message),this.setBusy(!1)});var e=this.getYearMonthByDate(s.d);if(this.pouch.getYearMonth()!=e)return this.putLog("勤怠 - "+e),void teasp.manager.request(
"transEmpMonth",{empId:this.pouch.getEmpId(),month:e},this.pouch,{hideBusy:!0},this,function(){this.pouch.getYearMonth()!=e?(this.showError("*** SYSTEM ERROR ***"),this.setBusy(!1)):(this.putLog(" .. ok",!0),this.importKintai(t,a,o))},function(e){this.putLog(" .. failed",!0),this.showError(e.message),this.setBusy(!1)});this.putLog("("+a+") "+s.en+" "+(s.d||"")+" 出社="+(s.st||"")+" 退社="+(s.et||"")+" 申請="+(
s.ap?s.ap.length:0));var i=this.pouch.getEmpDay(s.d),n=i.getObj();if(j$("#checkNoup").is(":checked")&&(i.isInputTime()||!o&&0<i.getEmpApplyList().length))return this.putSkipLog("スキップ (入力済み)"),void this.importKintai(t,++a,0);var r=this.pouch.getPatternObjs(),l=this.pouch.getHolidayObjs();if(s.ap&&0<s.ap.length&&o<s.ap.length){var p=s.ap[o],d={empId:this.pouch.getEmpId(),month:this.pouch.getYearMonth(),
lastModifiedDate:this.pouch.getLastModifiedDate(),date:n.date,apply:{id:null,applyType:null,holidayId:null,patternId:null,startDate:null,endDate:null,startTime:null,endTime:null,exchangeDate:null,note:p.nt||null,contact:p.ct||null}};if(p.st&&"string"==typeof p.st&&(p.st=teasp.util.time.clock2minutes(p.st)),p.et&&"string"==typeof p.et&&(p.et=teasp.util.time.clock2minutes(p.et)),p.sn==teasp.constant.APPLY_TYPE_HOLIDAY
){for(var c=null,m=0;m<l.length;m++)if(l[m].name==p.hn){c=l[m];break}if(!c)return this.putSkipLog("休暇名「"+(p.hn||"(null)")+"」は存在しないため、休暇申請は無効"),void this.importKintai(t,a,++o);d.apply.applyType=p.sn,d.apply.holidayId=c.id,d.apply.startDate=n.date,d.apply.endDate=p.ed||n.date,d.apply.startTime=p.st||null,d.apply.endTime=p.et||null,this.putLog("("+a+") "+p.sn+" "+c.name+" "+d.apply.startDate+" - "+d.apply.endDate)
}else if(p.sn==teasp.constant.APPLY_TYPE_KYUSHTU){if(i.getDayType()==teasp.constant.DAY_TYPE_NORMAL&&!i.isPlannedHoliday())return this.putSkipLog(n.date+"は平日のため、休日出勤申請は無効"),void this.importKintai(t,a,++o);var h=i.getDefaultZangyoRange();d.apply.applyType=p.sn,d.apply.startDate=n.date,d.apply.endDate=n.date,d.apply.startTime=p.st||h.from,d.apply.endTime=p.et||h.to,d.apply.daiqReserve=this.pouch.isUseDaiqManage(),
this.putLog("("+a+") "+p.sn+" "+d.apply.startDate+" - "+d.apply.endDate)}else if(p.sn==teasp.constant.APPLY_TYPE_ZANGYO){h=i.getDefaultZangyoRange();d.apply.applyType=p.sn,d.apply.startDate=n.date,d.apply.endDate=n.date,d.apply.startTime=p.st||h.from,d.apply.endTime=p.et||h.to,this.putLog("("+a+") "+p.sn+" "+teasp.util.time.timeValue(d.apply.startTime)+" - "+teasp.util.time.timeValue(d.apply.endTime))}else if(
p.sn==teasp.constant.APPLY_TYPE_EARLYSTART){h=i.getDefaultEarlyStartRange();d.apply.applyType=p.sn,d.apply.startDate=n.date,d.apply.endDate=n.date,d.apply.startTime=p.st||h.from,d.apply.endTime=p.et||h.to,this.putLog("("+a+") "+p.sn+" "+teasp.util.time.timeValue(d.apply.startTime)+" - "+teasp.util.time.timeValue(d.apply.endTime))}else if(p.sn==teasp.constant.APPLY_TYPE_LATESTART)d.apply.applyType=p.sn,
d.apply.startDate=n.date,d.apply.endDate=n.date,d.apply.startTime=p.st,d.apply.endTime=p.et,this.putLog("("+a+") "+p.sn+" "+teasp.util.time.timeValue(d.apply.startTime)+" - "+teasp.util.time.timeValue(d.apply.endTime));else if(p.sn==teasp.constant.APPLY_TYPE_EARLYEND)d.apply.applyType=p.sn,d.apply.startDate=n.date,d.apply.endDate=n.date,d.apply.startTime=p.st,d.apply.endTime=p.et,this.putLog(
"("+a+") "+p.sn+" "+teasp.util.time.timeValue(d.apply.startTime)+" - "+teasp.util.time.timeValue(d.apply.endTime));else if(p.sn==teasp.constant.APPLY_TYPE_EXCHANGE){h=this.pouch.createExchangeEnableMap();if(!(h[n.date]?h[n.date][p.exd]:null))return this.putSkipLog(n.date+"と"+p.exd+"の振替申請は無効"),void this.importKintai(t,a,++o);d.apply.applyType=p.sn,d.apply.startDate=n.date,d.apply.endDate=n.date,
d.apply.exchangeDate=p.exd,this.putLog("("+a+") "+p.sn+" "+d.apply.startDate+" - "+d.apply.endDate)}else if(p.sn==teasp.constant.APPLY_TYPE_PATTERNS||p.sn==teasp.constant.APPLY_TYPE_PATTERNL){for(var u=null,g=0;g<r.length;g++)if(r[g].name==p.pn&&("1"==r[g].range&&p.sn==teasp.constant.APPLY_TYPE_PATTERNS||"2"==r[g].range&&p.sn==teasp.constant.APPLY_TYPE_PATTERNL)){u=r[g];break}if(!u)return this.putSkipLog("勤務パターン名「"+(
p.pn||"(null)")+"」は存在しないため、"+p.sn+"は無効"),void this.importKintai(t,a,++o);d.apply.applyType=p.sn,d.apply.patternId=u.id,d.apply.startDate=n.date,d.apply.endDate=p.ed||n.date,d.apply.startTime=p.st||null,d.apply.endTime=p.et||null,this.putLog("("+a+") "+p.sn+" "+u.name+" "+d.apply.startDate+" - "+d.apply.endDate)}teasp.manager.request("applyEmpDay",d,this.pouch,{hideBusy:!0},this,function(){this.putLog(" .. ok",!0),
this.importKintai(t,a,++o)},function(e){this.putLog(" .. failed",!0),this.showError(e.message),this.importKintai(t,a,++o)})}else{h={from:teasp.util.time.clock2minutes(s.st),to:teasp.util.time.clock2minutes(s.et),type:1};if("number"!=typeof h.from&&(h.from=null),"number"!=typeof h.to&&(h.to=null),null===h.from&&null===h.to)return this.putSkipLog("inputTimeTable スキップ (出退時刻なし)"),void this.importKintai(t,++a,0);if((
i.getDayType()!=teasp.constant.DAY_TYPE_NORMAL||i.isPlannedHoliday())&&!i.isExistApply(teasp.constant.APPLY_KEY_KYUSHTU))return s.ap||(s.ap=[]),s.ap.push({sn:teasp.constant.APPLY_TYPE_KYUSHTU}),this.putLog("("+a+") 休日出勤申請を追加"),void this.importKintai(t,a,s.ap.length-1);var y=[],f=(y.push(h),[]);if(s.unrt&&0<s.unrt.length)for(var b=0;b<s.unrt.length;b++){var p=s.unrt[b];f.push({
from:"string"==typeof p.st?teasp.util.time.clock2minutes(p.st):p.st,to:"string"==typeof p.et?teasp.util.time.clock2minutes(p.et):p.et})}if((u=n.pattern)&&u.restTimes)for(b=0;b<u.restTimes.length;b++){var _=u.restTimes[b];if(0<(L=teasp.util.time.rangeTime(_,f))&&L<_.to-_.from){for(var v=[dojo.clone(_)],T=0;T<f.length;)v=teasp.util.time.sliceTimes(v,f[T]),T++;for(var j=0;j<v.length;j++)y.push({from:v[j].from,
to:v[j].to,type:teasp.constant.REST_FREE})}else L<=0&&y.push({from:_.from,to:_.to,type:teasp.constant.REST_FIX})}if(s.rt&&0<s.rt.length){for(var E=[],b=0;b<y.length;b++)(p=y[b]).type!=teasp.constant.REST_FIX&&p.type!=teasp.constant.REST_FREE||E.push(p);for(b=0;b<s.rt.length;b++){var L,k={from:"string"==typeof(p=s.rt[b]).st?teasp.util.time.clock2minutes(p.st):p.st,
to:"string"==typeof p.et?teasp.util.time.clock2minutes(p.et):p.et};if(0<(L=teasp.util.time.rangeTime(k,E))&&L<k.to-k.from){for(v=[dojo.clone(k)],T=0;T<E.length;)v=teasp.util.time.sliceTimes(v,E[T]),T++;for(j=0;j<v.length;j++)y.push({from:v[j].from,to:v[j].to,type:teasp.constant.REST_FREE})}else y.push({from:k.from,to:k.to,type:teasp.constant.REST_FREE})}}if(s.at&&0<s.at.length)for(b=0;b<s.at.length;b++
)"string"==typeof(p=s.at[b]).st&&(p.st=teasp.util.time.clock2minutes(p.st)),"string"==typeof p.et&&(p.et=teasp.util.time.clock2minutes(p.et)),y.push({from:p.st,to:p.et,type:teasp.constant.AWAY});d={empId:this.pouch.getEmpId(),month:this.pouch.getYearMonth(),lastModifiedDate:this.pouch.getLastModifiedDate(),date:n.date,timeTable:y};this.putLog("("+a+") 勤怠登録"),teasp.manager.request("inputTimeTable",d,this.pouch,{
hideBusy:!0},this,function(){this.putLog(" .. ok",!0),this.importKintai(t,++a,0)},function(e){this.putLog(" .. failed",!0),this.showError(e.message),this.setBusy(!1)})}},teasp.view.BulkTest.prototype.importExpStep1=function(a){this.putLog("費目検索"),teasp.manager.request("getAtkExpItems","",this.pouch,{hideBusy:!0},this,function(){this.putLog(" .. ok",!0);var e=this.pouch.getExpItems();this.itemMap={};for(
var t=0;t<e.length;t++)this.itemMap[e[t].name]=e[t];this.importExpStep2(a)},function(e){this.putLog(" .. failed",!0),this.showError(e.message),this.setBusy(!1)})},teasp.view.BulkTest.prototype.importExpStep2=function(t){for(var e={},a=0;a<t.eps.length;a++)for(var o=t.eps[a],s=0;s<o.exps.length;s++){var i=o.exps[s];i.jn&&(e[i.jn]=1)}var n,r=[];for(n in e)e.hasOwnProperty(n)&&r.push(n);r.length<=0?this.importExpStep3(t
,0):(this.putLog("ジョブID検索 - "+r.join(",")),teasp.manager.request("getJobIdByNames",r.join("\t"),this.pouch,{hideBusy:!0},this,function(e){this.putLog(" .. ok",!0),console.debug(dojo.toJson(e)),this.jobMap=e,this.importExpStep3(t,0)},function(e){this.putLog(" .. failed",!0),this.showError(e.message),this.setBusy(!1)}))},teasp.view.BulkTest.prototype.importExpStep3=function(r,l){if(r.eps.length<=l)return this.putLog(
"**** 経費インポート終了 ****"),void this.importJobStep1(r);if(this.stopped)return this.putSkipLog("**** 中止しました ****"),void this.setBusy(!1);var p=r.eps[l];if(p.empId=this.getEmpIdByName(p.en),!this.execInit||p.empId&&this.pouch.getEmpId()&&p.empId!=this.pouch.getEmpId())return this.execInit=!0,this.putLog("("+l+") 経費"),void teasp.manager.request("loadEmpExp",{empId:p.empId,expApplyId:null},this.pouch,{hideBusy:!0},this,
function(){if(this.putLog(" .. ok",!0),!this.pouch.getEmpId())return this.showError("ログインユーザに紐づく社員は設定されていません。社員名(en)をデータにセットしてください"),void this.setBusy(!1);p.empId=this.pouch.getEmpId();var e=this;teasp.manager.completeCheck(function(){e.importExpStep3(r,l)})},function(e){this.putLog(" .. failed",!0),this.showError(e.message),this.setBusy(!1)});for(var e={empId:this.pouch.getEmpId(),expApplyId:null,date:p.d,expLogs:[
],expHistory:p.eh||null},d=p.eh?dojo.fromJson(p.eh):{routeHist:this.pouch.getRouteHist(),stationHist:this.pouch.getStationHist()},t=0;t<p.exps.length;t++){var a,c=p.exps[t],o=this.itemMap[c.it];if(!o)return this.putSkipLog("費目 "+c.it+" は登録されていません"),void this.importExpStep3(r,++l);if(!(1!=o.transportType||c.route||c.transportType&&1!=c.transportType))return a={empId:this.pouch.getEmpId(),expDate:p.d,mode:0,
stationFrom:{name:c.ss,code:c.sc||null},stationTo:{name:c.es,code:c.ec||null},stationVia:[]},this.putLog("("+l+") 経路検索 - "+a.stationFrom.name+"-"+a.stationTo.name),void teasp.manager.request("searchRoute",a,this.pouch,{hideBusy:!0},this,function(e){if(this.putLog(" .. ok",!0),e.routes&&0<e.routes.length){var t=e.stationFromList[0],a=e.stationToList[0],o=e.routes.sort(function(e,t){return e.fare-t.fare}),s=0;if(
c.mn&&"number"==typeof c.mn)for(var i=0;i<o.length;i++)if(o[i].fare==c.mn){s=i;break}c.route=dojo.toJson({searchKey:{stationFrom:t,stationTo:a,stationVia:e.stationVia},route:o[s]});for(var t=e.stationFromList[0],a=e.stationToList[0],n=(t&&(c.ss=t.name),a&&(c.es=a.name),c.sc=t?t.code:null,c.ec=a?a.code:null,c.mn=o[s].fare*(c.rd?2:1),!1),i=0;i<d.routeHist.length;i++)if(d.routeHist[i]==c.route){n=!0;break}
n||d.routeHist.unshift(c.route);for(n=!1,i=0;i<d.stationHist.length;i++)if(d.stationHist[i].name==t.name){n=!0;break}n||d.stationHist.unshift(t),n=!1;for(i=0;i<d.stationHist.length;i++)if(d.stationHist[i].name==a.name){n=!0;break}n||d.stationHist.unshift(a),p.eh=dojo.toJson(d)}else this.putSkipLog("searchRoute not-found. transportType <- 2"),c.transportType=2;this.importExpStep3(r,l)},function(e){this.putSkipLog(
"searchRoute failed. transportType <- 2"),c.transportType=2,this.importExpStep3(r,l)});e.expLogs.push({expApplyId:null,id:null,jobId:c.jn?this.jobMap[c.jn].Id:null,expItemId:o.id,cost:"number"==typeof c.mn?c.mn:/^(\d+)/.test(c.mn)?parseInt(RegExp.$1,10):0,detail:c.nt||null,startName:c.ss||null,startCode:c.sc||null,endName:c.es||null,endCode:c.ec||null,roundTrip:c.rd||!1,route:c.route||null,receipt:o.receipt,
transportType:""+(c.transportType||o.transportType),taxType:{"無税":"1","内税":"1","外税":"2"}[c.tt]||c.tt||null,taxAuto:c.ta,withoutTax:"number"==typeof c.wt?c.wt:/^(\d+)/.test(c.wt)?parseInt(RegExp.$1,10):0,tax:"number"==typeof c.tx?c.tx:/^(\d+)/.test(c.tx)?parseInt(RegExp.$1,10):0,currencyName:c.cn,currencyRate:"number"==typeof c.rt?c.rt:/^(\d+)/.test(c.rt)?parseInt(RegExp.$1,10):0,
foreignAmount:"number"==typeof c.fa?c.fa:/^(\d+)/.test(c.fa)?parseInt(RegExp.$1,10):0,order:t+1})}this.putLog("("+l+") 経費登録 - 明細数="+e.expLogs.length),teasp.manager.request("saveEmpExp",e,this.pouch,{hideBusy:!0},this,function(){this.putLog(" .. ok",!0);var e=this;teasp.manager.completeCheck(function(){e.importExpStep3(r,++l)})},function(e){this.putLog(" .. failed",!0),this.showError(e.message),this.setBusy(!1)})},
teasp.view.BulkTest.prototype.importJobStep1=function(t){for(var e={},a=0;a<t.jbs.length;a++)for(var o=t.jbs[a],s=0;s<o.works.length;s++){var i=o.works[s];i.jn&&(e[i.jn]=1)}var n,r=[];for(n in e)e.hasOwnProperty(n)&&r.push(n);this.putLog("ジョブID検索 - "+r.join(",")),teasp.manager.request("getJobIdByNames",r.join("\t"),this.pouch,{hideBusy:!0},this,function(e){this.putLog(" .. ok",!0),console.debug(dojo.toJson(e)),
this.jobMap=e,this.importJobStep2(t,0)},function(e){this.putLog(" .. failed",!0),this.showError(e.message),this.setBusy(!1)})},teasp.view.BulkTest.prototype.importJobStep2=function(e,t){if(e.jbs.length<=t)return this.putLog("**** 工数インポート終了 ****"),void this.setBusy(!1);if(this.stopped)return this.putSkipLog("**** 中止しました ****"),void this.setBusy(!1);var a=e.jbs[t];if(a.empId=this.getEmpIdByName(a.en),
!this.dayWorks||a.empId&&this.pouch.getEmpId()&&a.empId!=this.pouch.getEmpId())return o=this.dayWorks?this.getJobYearMonthByDate(a.d):0,this.putLog("("+t+") 工数 - "+o),void teasp.manager.request("loadJobMonth",{empId:a.empId||"",month:o||""},this.pouch,{hideBusy:!0},this,function(){if(this.putLog(" .. ok",!0),!this.pouch.getEmpId())return this.showError("ログインユーザに紐づく社員は設定されていません。社員名(en)をデータにセットしてください"),
void this.setBusy(!1);a.empId=this.pouch.getEmpId(),this.dayWorks=this.getWorkDays(this.pouch.getJobYearMonth()),this.importJobStep2(e,t)},function(e){this.putLog(" .. failed",!0),this.showError(e.message),this.setBusy(!1)});var o=this.getJobYearMonthByDate(a.d);if(this.pouch.getJobYearMonth()!=o)return this.putLog("("+t+") 工数 - "+o),void teasp.manager.request("transJobMonth",{empId:this.pouch.getEmpId(),month:o},
this.pouch,{hideBusy:!0},this,function(){this.pouch.getJobYearMonth()!=o?(this.showError("*** SYSTEM ERROR ***"),this.setBusy(!1)):(this.putLog(" .. ok",!0),this.dayWorks=this.getWorkDays(o),this.importJobStep2(e,t))},function(e){this.putLog(" .. failed",!0),this.showError(e.message),this.setBusy(!1)});this.putLog("("+t+") "+(a.d||""));for(var s=this.dayWorks[a.d].works||[],i=this.pouch.getClassifyJobWorks(a.d),n={
empId:this.pouch.getEmpId(),month:o,date:a.d,jobs:[],works:[]},r=0,l=0;l<a.works.length;l++){var p=a.works[l],p={id:null,jobId:this.jobMap[p.jn].Id,process:p.sb||null,time:teasp.util.time.clock2minutes(p.tm)||0,timeFix:p.tx||!1,volume:p.vl||0,percent:0,progress:null,taskNote:p.tn?p.tn.replace(/\\n/g,"\n"):null,order:l+1};p.timeFix||(r+=p.volume),n.works.push(p)}for(l=0;l<n.works.length;l++){var d=n.works[l];
d.timeFix?d.volume=Math.round(100*d.time/60):d.percent=Math.round(d.volume/r*1e3);for(var c=0;c<s.length;c++)if(d.jobId==s[c].jobId){d.id=s[c].id;break}}for(var m=this.pouch.getAssignWorks(i),l=0;l<m.length;l++){var h=m[l];h.jobAssign&&n.jobs.push({id:h.jobAssign.id,jobId:h.jobId})}this.putLog("("+t+") 工数登録 - 明細数="+n.works.length),teasp.manager.request("saveEmpWork",n,this.pouch,{hideBusy:!0},this,function(){
this.putLog(" .. ok",!0),this.importJobStep2(e,++t)},function(e){this.putLog(" .. failed",!0),this.showError(e.message),this.setBusy(!1)})},teasp.view.BulkTest.prototype.getWorkDays=function(e){for(var e=teasp.util.searchYearMonthDate(this.pouch.getJobInitialDayOfMonth(),this.pouch.getJobMarkOfMonth(),e,null),t=teasp.util.date.getDateList(e.startDate,e.endDate),a=this.pouch.getWorks(),o={},s={},i=0;i<t.length;i++
)for(var n=t[i],r=o[n]={time:0,works:[]},l=0;l<a.length;l++){var p=a[l];p.date==n&&0<p.time&&(r.works.push(p),r.time+=p.time,(s[p.jobId]||(s[p.jobId]={jobName:p.job.name,time:0})).time+=p.time)}return o},teasp.view.BulkTest.prototype.execVacuum=function(){if(!this.isBusy()){j$("#testLog2").text(""),j$("#empVacuumArea").val("");for(var e=j$("#testEmpName").val(),t=j$("#testYm1").val(),a=j$("#testYm2").val(),o={kt:{},
jb:{},ep:{},empIdMap:{},empIds:e},s=0;s<e.length;s++)for(var i=e[s],n=0;n<this.masterEmps.length;n++)if(this.masterEmps[n].id==i){o.empIdMap[i]=this.masterEmps[n].name;break}this.setBusy(!0),this.vacuum(o,0,t,a,0)}},teasp.view.BulkTest.prototype.vacuum=function(t,a,o,s,i){"string"==typeof o&&(o=parseInt(o,10)),"string"==typeof s&&(s=parseInt(s,10));var e=t.empIds[a],n=teasp.util.date.addYearMonth(o,i);if(s<n){if(!(
++a<t.empIds.length))return this.vacuumEnd(t),void this.setBusy(!1);e=t.empIds[a],i=0,n=o}t.kt.hasOwnProperty(e+":"+n)?t.ep.hasOwnProperty(e+":"+n)?t.jb.hasOwnProperty(e+":"+n)?this.vacuum(t,a,o,s,++i):(t.jb[e+":"+n]=[],this.putLog("工数 - "+t.empIdMap[e]+" - "+n),teasp.manager.request("loadJobMonth",{empId:e,month:n},this.pouch,{hideBusy:!0},this,function(){this.putLog(" .. ok",!0);var e=this;
teasp.manager.completeCheck(function(){e.vacuumJobMonth(t,a,o,s,i)})},function(e){this.putLog(" .. failed",!0),this.showError(e.message),this.setBusy(!1)})):(t.ep[e+":"+n]=[],this.putLog("経費 - "+t.empIdMap[e]+" - "+n),teasp.manager.request("getExpByDate",{empId:e,month:n},this.pouch,{hideBusy:!0},this,function(){this.putLog(" .. ok",!0),this.vacuumExpMonth(t,a,o,s,i)},function(e){this.putLog(" .. failed",!0),
this.showError(e.message),this.setBusy(!1)})):(t.kt[e+":"+n]=[],this.putLog("勤怠 - "+t.empIdMap[e]+" - "+n),teasp.manager.request("loadEmpMonth",{empId:e,month:n},this.pouch,{hideBusy:!0},this,function(){this.putLog(" .. ok",!0);var e=this;teasp.manager.completeCheck(function(){e.vacuumEmpMonth(t,a,o,s,i)})},function(e){this.putLog(" .. failed",!0),this.showError(e.message),this.setBusy(!1)}))},
teasp.view.BulkTest.prototype.vacuumEnd=function(e){var t,a=[],o=[],s=[];for(h in e.kt)e.kt.hasOwnProperty(h)&&0<e.kt[h].length&&((t=e.kt[h])[0].en=e.empIdMap[h.substring(0,h.indexOf(":"))],a=a.concat(t));for(h in e.ep)e.ep.hasOwnProperty(h)&&0<e.ep[h].length&&((t=e.ep[h])[0].en=e.empIdMap[h.substring(0,h.indexOf(":"))],o=o.concat(t));for(h in e.jb)e.jb.hasOwnProperty(h)&&0<e.jb[h].length&&((t=e.jb[h]
)[0].en=e.empIdMap[h.substring(0,h.indexOf(":"))],s=s.concat(t));for(var i="",n=null,r=["rt","at","unrt","ap"],l=0;l<a.length;l++){for(var p=a[l],d=(p.en||(p.en=n.en),i+="勤怠\t"+(p.en||"")+"\t"+(p.d||"")+"\t"+(p.st||"")+"\t"+(p.et||"")+"\t",0),c=0;c<r.length;c++)p[h=r[c]]=p[h]||[],d<p[h].length&&(d=p[h].length);for(var m=0;m<d;m++){0<m&&(i+="\n勤怠\t"+(p.en||"")+"\t"+(p.d||"")+"\t\t\t");for(var h,u,c=0;c<r.length;c++
)"ap"!=(h=r[c])?m<p[h].length?i+=((u=p[h][m]).st||"")+"\t"+(u.et||"")+"\t":i+="\t\t":m<p[h].length?i+=((u=p[h][m]).sn||"")+"\t"+(u.hn||"")+"\t"+(u.pn||"")+"\t"+(u.ed||"")+"\t"+(u.st||"")+"\t"+(u.et||"")+"\t"+(u.ex||"")+"\t"+(u.nt||"")+"\t"+(u.ct||""):i+="\t\t\t\t\t\t\t\t"}i+="\n",n=p}for(n=null,l=0;l<o.length;l++){var g=o[l];g.en||(g.en=n.en),i=i+("経費\t"+(g.en||"")+"\t"+(g.d||"")+"\t"+(g.jn||"")+"\t"+(g.it||""
)+"\t"+(g.ss||"")+"\t"+(g.es||"")+"\t"+(g.rd||"")+"\t"+(g.mn||"")+"\t"+(g.nt||""))+"\n",n=g}n=null;for(l=0;l<s.length;l++){var y=s[l];y.en||(y.en=n.en),i=i+("工数\t"+(y.en||"")+"\t"+(y.d||"")+"\t"+(y.jn||"")+"\t"+(y.sb||"")+"\t"+(y.vl||"")+"\t"+(y.tm||"")+"\t"+(y.tx||"")+"\t"+(y.tn||""))+"\n",n=y}j$("#empVacuumArea").val(i),this.putLog("**** エクスポート終了 ****")},teasp.view.BulkTest.prototype.vacuumEmpMonth=function(e,t,a,o
,s){e.empIdMap[this.pouch.getEmpId()]=this.pouch.getName();for(var i=this.pouch.getEmpId()+":"+this.pouch.getYearMonth(),n=this.pouch.getMonthDateList(),r=0;r<n.length;r++){var l=this.pouch.getEmpDay(n[r]),p=l.getObj(),d="number"==typeof p.startTime?p.startTime:null,c="number"==typeof p.endTime?p.endTime:null;if(l.getDayType()==teasp.constant.DAY_TYPE_NORMAL||null!==d||null!==c){for(var m=l.getPattern(),
h=l.getEmpApplyList(),u=[],g=[],y=[],f=[],b=[],_=l.getTimeTable(),v=0;v<h.length;v++){var T=h[v];T.startDate==n[r]&&(j={sn:T.applyType},T.applyType==teasp.constant.APPLY_TYPE_HOLIDAY&&(j.hn=T.holiday.name),T.applyType!=teasp.constant.APPLY_TYPE_PATTERNS&&T.applyType!=teasp.constant.APPLY_TYPE_PATTERNL||(j.pn=T.pattern.name),T.startDate!=T.endDate&&(j.ed=T.endDate),"number"==typeof T.startTime&&(
j.st=teasp.util.time.timeValue(T.startTime)),"number"==typeof T.endTime&&(j.et=teasp.util.time.timeValue(T.endTime)),T.exchangeDate&&(j.ex=T.exchangeDate),T.note&&(j.nt=T.note),T.contact&&(j.ct=T.contact),u.push(j))}if(null!==d||null!==c)for(v=0;v<m.restTimes.length;v++){var j=m.restTimes[v];0<teasp.util.time.rangeTime({from:d,to:c},[j])&&b.push(j)}for(v=0;v<_.length;v++){var E=_[v];if(
E.type==teasp.constant.REST_FREE)g.push({st:teasp.util.time.timeValue(E.from),et:teasp.util.time.timeValue(E.to)});else if(E.type==teasp.constant.AWAY)y.push({st:teasp.util.time.timeValue(E.from),et:teasp.util.time.timeValue(E.to)});else if(E.type==teasp.constant.REST_FIX)for(var L=0;L<b.length;L++){var k=b[L];(E.from==k.from&&E.to==k.to||c&&E.from==k.from&&c<k.to||d&&E.to==k.to&&k.from<d)&&(k.flag=1)}}for(
v=0;v<b.length;v++)(k=b[v]).flag||f.push({st:teasp.util.time.timeValue(k.from),et:teasp.util.time.timeValue(k.to)});j={d:n[r]};null!==d&&(j.st=teasp.util.time.timeValue(d)),null!==c&&(j.et=teasp.util.time.timeValue(c)),0<g.length&&(j.rt=g),0<y.length&&(j.at=y),0<f.length&&(j.unrt=f),0<u.length&&(j.ap=u),e.kt[i].push(j)}}this.vacuum(e,t,a,o,s)},teasp.view.BulkTest.prototype.vacuumExpMonth=function(e,t,a,o,s){
e.empIdMap[this.pouch.getEmpId()]=this.pouch.getName();for(var i=this.pouch.getEmpId()+":"+this.pouch.getJobYearMonth(),n=(n=this.pouch.getExpLogs()).sort(function(e,t){return e.date==t.date?e.expApplyId&&!t.expApplyId?-1:!e.expApplyId&&t.expApplyId?1:e.order-t.order:e.date<t.date?-1:e.date>t.date?1:0}),r=0;r<n.length;r++){var l=n[r],p={d:l.date};p.jn=l.job?l.job.name:null,p.it=l.expItem.name,p.ss=l.startName||null,
p.sc=l.startCode||null,p.es=l.endName||null,p.ec=l.endCode||null,p.rd=l.roundTrip||!1,p.mn=l.cost||0,p.nt=l.detail||null,e.ep[i].push(p)}this.vacuum(e,t,a,o,s)},teasp.view.BulkTest.prototype.vacuumJobMonth=function(e,t,a,o,s){e.empIdMap[this.pouch.getEmpId()]=this.pouch.getName();for(var i=teasp.util.date.addYearMonth(a,s),n=teasp.util.searchYearMonthDate(this.pouch.getJobInitialDayOfMonth(),
this.pouch.getJobMarkOfMonth(),i,null),r=teasp.util.date.getDateList(n.startDate,n.endDate),l=this.pouch.getEmpId()+":"+this.pouch.getJobYearMonth(),p=this.getWorkDays(i),d=0;d<r.length;d++)for(var c=p[r[d]],m=0;m<c.works.length;m++){var h=c.works[m],u={d:r[d]};u.jn=h.job?h.job.name:null,u.sb=h.process,u.vl=h.volume||0,u.tm=teasp.util.time.timeValue(h.time||0),u.tx=h.timeFix,u.tn=h.taskNote?h.taskNote.replace(/\n/g,
"\\n"):"",e.jb[l].push(u)}this.vacuum(e,t,a,o,s)},teasp.view.BulkTest.prototype.yuqInfoTest=function(){var e=j$("#testEmpName2").val();document.body.style.cursor="wait",teasp.manager.request("getAllEmpYuqs",{empId:e},this.pouch,{hideBusy:!0},this,function(e){document.body.style.cursor="default",console.log(dojo.toJson(e)),this.showYuqInfo(e)},function(e){document.body.style.cursor="default",console.log(
teasp.message.getErrorMessage(e))})},teasp.view.BulkTest.prototype.showYuqInfo=function(e){for(var t=[],a=0;a<e.empYuqs.length;a++){var o=e.empYuqs[a];if(!(o.totalTime<=0)){o.children=[],o.group=[];for(var s=0;s<e.empYuqDetails.length;s++){var i=e.empYuqDetails[s];o.id==i.empYuqId&&o.children.push(i),o.id==i.groupId&&o.id!=i.empYuqId&&o.group.push(i)}t.push(o)}}for(t=t.sort(function(e,t){
return e.limitDate==t.limitDate?e.startDate<t.startDate?-1:e.startDate>t.startDate?1:0:e.limitDate<t.limitDate?-1:1}),a=0;a<t.length;a++)(o=t[a]).group=o.group.sort(function(e,t){return e.parent||t.parent?e.parent&&t.parent?e.parent.date==t.parent.date?e.parent.date<t.parent.date?-1:e.parent.date>t.parent.date?1:0:e.parent.date<t.parent.date?-1:1:e.parent?1:-1:0});for(var n=dojo.byId("yuqInfoHead"),r=dojo.byId(
"yuqInfoBody");n.firstChild;)dojo.destroy(n.firstChild);for(;r.firstChild;)dojo.destroy(r.firstChild);h=dojo.create("tr",null,n),dojo.create("div",{innerHTML:"subject"},dojo.create("th",null,h)),dojo.create("div",{innerHTML:"id"},dojo.create("th",null,h)),dojo.create("div",{innerHTML:"date"},dojo.create("th",null,h)),dojo.create("div",{innerHTML:"startDate"},dojo.create("th",null,h)),dojo.create("div",{
innerHTML:"limitDate"},dojo.create("th",null,h)),dojo.create("div",{innerHTML:"baseTime"},dojo.create("th",null,h)),dojo.create("div",{innerHTML:"autoFlag"},dojo.create("th",null,h)),dojo.create("div",{innerHTML:"batchId"},dojo.create("th",null,h)),dojo.create("div",{innerHTML:"empApplyId"},dojo.create("th",null,h)),dojo.create("div",{innerHTML:"lostFlag"},dojo.create("th",null,h)),dojo.create("div",{
innerHTML:"oldNextYuqProvideDate"},dojo.create("th",null,h)),dojo.create("div",{innerHTML:"provideDay"},dojo.create("th",null,h)),dojo.create("div",{innerHTML:"spendDay"},dojo.create("th",null,h)),dojo.create("div",{innerHTML:"totalTime"},dojo.create("th",null,h)),dojo.create("div",{innerHTML:"tempFlag"},dojo.create("th",null,h)),dojo.create("div",{innerHTML:"timeUnit"},dojo.create("th",null,h));for(
a=0;a<t.length;a++){o=t[a],h=dojo.create("tr",null,r);if(dojo.create("div",{innerHTML:o.subject},dojo.create("td",null,h)),dojo.create("div",{innerHTML:o.id},dojo.create("td",null,h)),dojo.create("div",{innerHTML:o.date},dojo.create("td",null,h)),dojo.create("div",{innerHTML:o.startDate},dojo.create("td",null,h)),dojo.create("div",{innerHTML:o.limitDate},dojo.create("td",null,h)),dojo.create("div",{
innerHTML:o.baseTime},dojo.create("td",null,h)),dojo.create("div",{innerHTML:o.autoFlag},dojo.create("td",null,h)),dojo.create("div",{innerHTML:o.batchId},dojo.create("td",null,h)),dojo.create("div",{innerHTML:o.empApplyId},dojo.create("td",null,h)),dojo.create("div",{innerHTML:o.lostFlag},dojo.create("td",null,h)),dojo.create("div",{innerHTML:o.oldNextYuqProvideDate},dojo.create("td",null,h)),dojo.create("div",{
innerHTML:o.provideDay},dojo.create("td",null,h)),dojo.create("div",{innerHTML:o.spendDay},dojo.create("td",null,h)),dojo.create("div",{innerHTML:o.totalTime},dojo.create("td",null,h)),dojo.create("div",{innerHTML:o.tempFlag},dojo.create("td",null,h)),dojo.create("div",{innerHTML:o.timeUnit},dojo.create("td",null,h)),0<o.group.length){h=dojo.create("tr",null,r);for(var l=dojo.create("td",{colSpan:16},h),
p=dojo.create("table",{className:"yuqgrp",style:"margin:2px 2px 2px 120px;"},l),d=dojo.create("thead",null,p),c=(h=dojo.create("tr",null,d),dojo.create("div",{innerHTML:"subject"},dojo.create("th",null,h)),dojo.create("div",{innerHTML:"id"},dojo.create("th",null,h)),dojo.create("div",{innerHTML:"empApplyId"},dojo.create("th",null,h)),dojo.create("div",{innerHTML:"date"},dojo.create("th",null,h)),dojo.create("div",{
innerHTML:"startDate"},dojo.create("th",null,h)),dojo.create("div",{innerHTML:"limitDate"},dojo.create("th",null,h)),dojo.create("div",{innerHTML:"baseTime"},dojo.create("th",null,h)),dojo.create("div",{innerHTML:"lostFlag"},dojo.create("th",null,h)),dojo.create("div",{innerHTML:"id"},dojo.create("th",null,h)),dojo.create("div",{innerHTML:"empYuqId"},dojo.create("th",null,h)),dojo.create("div",{innerHTML:"groupId"},
dojo.create("th",null,h)),dojo.create("div",{innerHTML:"time"},dojo.create("th",null,h)),dojo.create("div",{innerHTML:"days"},dojo.create("th",null,h)),dojo.create("div",{innerHTML:"provideDays"},dojo.create("th",null,h)),dojo.create("div",{innerHTML:"spendDays"},dojo.create("th",null,h)),dojo.create("tbody",null,p)),s=0;s<o.group.length;s++){var m=(i=o.group[s]).parent,h=dojo.create("tr",null,c);dojo.create("div",{
innerHTML:m.subject},dojo.create("td",null,h)),dojo.create("div",{innerHTML:m.id},dojo.create("td",null,h)),dojo.create("div",{innerHTML:m.empApplyId},dojo.create("td",null,h)),dojo.create("div",{innerHTML:m.date},dojo.create("td",null,h)),dojo.create("div",{innerHTML:m.startDate},dojo.create("td",null,h)),dojo.create("div",{innerHTML:m.limitDate},dojo.create("td",null,h)),dojo.create("div",{innerHTML:m.baseTime},
dojo.create("td",null,h)),dojo.create("div",{innerHTML:m.lostFlag},dojo.create("td",null,h)),dojo.create("div",{innerHTML:i.id},dojo.create("td",null,h)),dojo.create("div",{innerHTML:i.empYuqId},dojo.create("td",null,h)),dojo.create("div",{innerHTML:i.groupId},dojo.create("td",null,h)),dojo.create("div",{innerHTML:i.time},dojo.create("td",null,h)),dojo.create("div",{innerHTML:i.days},dojo.create("td",null,h)),
dojo.create("div",{innerHTML:i.provideDays},dojo.create("td",null,h)),dojo.create("div",{innerHTML:i.spendDays},dojo.create("td",null,h))}dojo.create("div",null,l)}}},teasp.provide("teasp.view.Widget"),teasp.view.Widget=function(){this.timerID=null,this.eventHandles={},this.token=0},teasp.view.Widget.prototype=new teasp.view.Base,teasp.view.Widget.prototype.init=function(e,t,a){teasp.message.mergeLabels(
globalMessages||{}),teasp.message.mergeLabels(e&&e[teasp.message.getLanguageLocaleKey()]||{}),this.pushTimeWithLocationWeb=teasp.commonConfig&&teasp.commonConfig.pushTimeWithLocationWeb||!1,dojo.byId("jumpMonthly").title=teasp.message.getLabel("empTimeView_btn_title"),dojo.byId("jumpDaily").title=teasp.message.getLabel("timeReport_link_title"),dojo.byId("jumpExp").title=teasp.message.getLabel("tf10000480"),dojo.byId(
"btnTstInput").title=teasp.message.getLabel("tm50001160"),dojo.byId("btnTetInput").title=teasp.message.getLabel("tm50001170"),dojo.byId("btnTweet").title=teasp.message.getLabel("tm50001180"),dojo.byId("btnStInput").value=teasp.message.getLabel("tw00000270"),dojo.byId("btnEtInput").value=teasp.message.getLabel("tw00000280"),dojo.byId("btnTstInput").value=teasp.message.getLabel("tw00000290"),dojo.byId("btnTetInput"
).value=teasp.message.getLabel("tw00000300"),dojo.toggleClass("btnTstInput","pw_btn_english",teasp.isEnglish()),dojo.toggleClass("btnTetInput","pw_btn_english",teasp.isEnglish()),teasp.permitPushTime?(dojo.byId("btnStInput").title=teasp.message.getLabel("tm50001140"),dojo.byId("btnEtInput").title=teasp.message.getLabel("tm50001150")):(dojo.byId("btnStInput").title=teasp.message.getLabel("tk10005330"),dojo.byId(
"btnEtInput").title=teasp.message.getLabel("tk10005330")),this.clockStart(),teasp.manager.request("loadWidget",{},this.pouch,{hideBusy:!0},this,function(){this.receiveDashboard()},function(e){dojo.style("infoError","display","block"),/Unable to connect to the server/.test(e.message)||(dojo.byId("errorMessage").innerHTML=teasp.message.getErrorMessage(e))})},teasp.view.Widget.prototype.clockStart=function(){
var e=dojo.hitch(this,function(){var e=teasp.util.date.getToday();this.showClock(e),0==e.getSeconds()&&this.pouch&&this.pouch.getEmpId()&&this.setPushButtons()});this.timerID=setInterval(e,1e3)},teasp.view.Widget.prototype.showClock=function(e){dojo.byId("clock_date").innerHTML=teasp.util.date.formatDate(e,"SLA"),dojo.byId("clock_time").innerHTML=e.getHours()+":"+(e.getMinutes()<10?"0":"")+e.getMinutes(),dojo.byId(
"clock_week").innerHTML=["(SUN)","(MON)","(TUE)","(WED)","(THU)","(FRI)","(SAT)"][e.getDay()]},teasp.view.Widget.prototype.receiveDashboard=function(){dojo.connect(dojo.byId("jumpMonthly"),"onclick",this,this.jumpToMonthly),dojo.byId("jumpMonthly").className="pw_base pw_jumpmo",this.pouch.isDisabledTimeReport()?(dojo.byId("jumpDaily").className="pw_base pw_jumpda_dis",dojo.byId("jumpDaily").title=""):(dojo.connect(
dojo.byId("jumpDaily"),"onclick",this,this.jumpToDaily),dojo.byId("jumpDaily").className="pw_base pw_jumpda"),this.pouch.isDisabledEmpExp()?(dojo.byId("jumpExp").className="pw_base pw_jumpex_dis",dojo.byId("jumpExp").title=""):(dojo.connect(dojo.byId("jumpExp"),"onclick",this,this.jumpToExp),dojo.byId("jumpExp").className="pw_base pw_jumpex"),this.pouch.getEmpId()&&(dojo.toggleClass("bgComment","pw_bgcomment1",
!this.pouch.isUseWorkLocation()),dojo.toggleClass("bgComment","pw_bgcomment2",this.pouch.isUseWorkLocation()),dojo.byId("btnTweet").className="pw_base pw_btntwe",dojo.connect(dojo.byId("btnTweet"),"onclick",this,function(){this.pushTimeStep1({type:0})}),this.setPushButtons(),this.pouch.isUseWorkLocation()&&this.buildWorkLocationArea(),this.showInfoRedIcon())},
teasp.view.Widget.prototype.initWorkLocationParameters=function(){this.scrollTimerID=null,this.SCROLL_AMOUNT1=dojo.isFF?5:1,this.SCROLL_AMOUNT2=dojo.isFF?10:4,this.SCROLL_INTERVAL1=500,this.SCROLL_INTERVAL2=200,this.POSITION_XMARGIN=20},teasp.view.Widget.prototype.createWorkLocationArea=function(){this.initWorkLocationParameters();var e=dojo.byId("big_area"),e=(dojo.create("div",{id:"workLocationAreaTitle",
innerHTML:teasp.message.getLabel("tw00000260")},e),dojo.create("div",{id:"workLocationArea"},e));dojo.create("input",{type:"button",id:"workLocationScrollL",className:"pw_base workLocation_scrollL",style:"display:none;"},e),dojo.create("div",{id:"workLocationButtons"},dojo.create("div",{id:"workLocationButtonArea"},e)),dojo.create("input",{type:"button",id:"workLocationScrollR",
className:"pw_base workLocation_scrollR",style:"display:none;"},e),dojo.isChrome||dojo.style("workLocationButtonArea","overflow-x","hidden")},teasp.view.Widget.prototype.buildWorkLocationArea=function(){this.createWorkLocationArea();for(var e=dojo.byId("workLocationButtons"),t=this.pouch.getWorkLocations(),a=this.getDefaultWorkLocationId(),o=0;o<t.length;o++){const n=t[o];var s=dojo.create("input",{type:"radio",
className:"workLocation_radio",name:"workLocation",id:"workLocationButton"+(o+1),checked:!(!a||n.getId()!=a)},e);dojo.create("div",{className:"workLocation_radio",innerHTML:n.getName().substring(0,20),title:n.getName()},dojo.create("label",{for:"workLocationButton"+(o+1),className:"workLocation_radio"},e)),dojo.setAttr(s,"data",n.getId()),dojo.connect(s,"click",this,this.scrollWorkLocationAutoPos)}var i=0;dojo.query(
"label.workLocation_radio",e).forEach(function(e){i+=e.offsetWidth+1}),this.workLocationButtonsWidth=i,dojo.style("workLocationButtons","width",this.workLocationButtonsWidth+"px"),dojo.connect(dojo.byId("workLocationScrollL"),"mousedown",this,function(e){e.button||this.scrollWorkLocationLRPress(-1*this.SCROLL_AMOUNT1)}),dojo.connect(dojo.byId("workLocationScrollL"),"mouseup",this,this.clearScrollWorkLocationInterval)
,dojo.connect(dojo.byId("workLocationScrollL"),"dblclick",this,function(e){e.button||this.scrollWorkLocationAutoPos(e,!0)}),dojo.connect(dojo.byId("workLocationScrollR"),"mousedown",this,function(e){e.button||this.scrollWorkLocationLRPress(this.SCROLL_AMOUNT1)}),dojo.connect(dojo.byId("workLocationScrollR"),"mouseup",this,this.clearScrollWorkLocationInterval),dojo.connect(dojo.byId("workLocationScrollR"),"dblclick",
this,function(e){e.button||this.scrollWorkLocationAutoPos(e,!0)}),dojo.connect(dojo.byId("workLocationButtonArea"),"scroll",this,function(e){this.scrollWorkLocationButtons()}),this.scrollWorkLocationAutoPos(null,!0)},teasp.view.Widget.prototype.getDefaultWorkLocationId=function(){var e=this.getTimeInfo();const t=this.pouch.getEmpDay(0<e.pTime?e.pkey:e.tkey);e=t.getWorkLocationId();
const a=e?this.pouch.getWorkLocationById(e):null;if(a&&!a.isRemoved())return a.getId();const o=this.pouch.getDefaultWorkLocation();return o?o.getId():null},teasp.view.Widget.prototype.getCheckedWorkLocation=function(){var t=-1,a=0,o=null;return dojo.query("input.workLocation_radio",dojo.byId("workLocationButtons")).some(function(e){if(e.checked)return t=a,o=dojo.getAttr(e,"data"),!0;a++}),null!==o?{
workLocation:this.pouch.getWorkLocationById(o),index:t}:null},teasp.view.Widget.prototype.getWorkLocationButtonXPos=function(){var t=0;const a=[];return dojo.query("label.workLocation_radio",dojo.byId("workLocationButtons")).forEach(function(e){a.push({x1:t,x2:t+e.offsetWidth}),t+=e.offsetWidth}),a},teasp.view.Widget.prototype.scrollWorkLocationAutoPos=function(e,t){var a,o,s,i,n=this.getCheckedWorkLocation();n?(
i=this.getWorkLocationButtonXPos(),o=(a=dojo.byId("workLocationButtonArea")).scrollLeft,s=i[n.index].x1-this.POSITION_XMARGIN,i=Math.max(i[n.index].x2+this.POSITION_XMARGIN-a.clientWidth,0),s<o?t?this.scrollWorkLocationButtons(s-o):this.setScrollWorkLocationInterval(-1*this.SCROLL_AMOUNT2,s):o<i?t?this.scrollWorkLocationButtons(i-o):this.setScrollWorkLocationInterval(this.SCROLL_AMOUNT2,i
):this.scrollWorkLocationButtons(null)):this.scrollWorkLocationButtons(null)},teasp.view.Widget.prototype.scrollWorkLocationLRPress=function(e){this.clearScrollWorkLocationInterval(),this.scrollTimerID=setInterval(dojo.hitch(this,function(){this.scrollWorkLocationButtons(e)},this.SCROLL_INTERVAL1))},teasp.view.Widget.prototype.setScrollWorkLocationInterval=function(t,a){this.clearScrollWorkLocationInterval(),
this.scrollTimerID=setInterval(dojo.hitch(this,function(){var e=dojo.byId("workLocationButtonArea").scrollLeft;t<0&&e<=a||0<t&&a<=e?this.clearScrollWorkLocationInterval():this.scrollWorkLocationButtons(t)},this.SCROLL_INTERVAL2))},teasp.view.Widget.prototype.clearScrollWorkLocationInterval=function(){null!==this.scrollTimerID&&clearInterval(this.scrollTimerID),this.scrollTimerID=null},
teasp.view.Widget.prototype.scrollWorkLocationButtons=function(e){e="number"==typeof e?e:null;const t=dojo.byId("workLocationButtonArea");var a=Math.max(this.workLocationButtonsWidth-t.clientWidth,0),o=Math.min(Math.max(t.scrollLeft+(e||0),0),a);o&&o!=a||this.clearScrollWorkLocationInterval(),null!==e&&(t.scrollLeft=o),dojo.style("workLocationScrollL","display",o?"":"none"),dojo.style("workLocationScrollR","display",
o==a?"none":"")},teasp.view.Widget.prototype.showInfoRedIcon=function(){if(this.pouch.getEmpId()){var e,t=this.pouch.getAllInfoCount();const a=dojo.query("div.info_red_icon",dojo.byId("big_area"));0<t&&!a.length&&(e=dojo.create("div",{innerHTML:t,title:teasp.message.getLabel("tm50001010",t),className:"pw_base info_red_icon"},dojo.byId("big_area")),dojo.connect(e,"click",this,this.openInfoView)),a.length&&(
a[0].innerHTML=t,a[0].title=teasp.message.getLabel("tm50001010",t),t||dojo.style(a[0],"display","none"))}},teasp.view.Widget.prototype.getTimeInfo=function(){var e=teasp.util.date.getToday(),t=teasp.util.date.formatDate(e),a=teasp.util.date.addDays(t,-1),o=this.pouch.getEmpDay(t),s=this.pouch.getEmpDay(a),i=o.getObj(),n=s.getObj(),e=60*e.getHours()+e.getMinutes(),r=i&&"number"==typeof i.startTime?i.startTime:-1,
l=i&&"number"==typeof i.endTime?i.endTime:-1,p=n&&"number"==typeof n.startTime?n.startTime:-1,d=n&&"number"==typeof n.endTime?n.endTime:-1,c=i&&"number"==typeof i.rack.fixStartTime?i.rack.fixStartTime:-1,m=i&&"number"==typeof i.rack.fixEndTime?i.rack.fixEndTime:-1,h=i&&"number"==typeof n.rack.fixStartTime?n.rack.fixStartTime:-1,u=n&&"number"==typeof n.rack.fixEndTime?n.rack.fixEndTime:-1,g=(0===l&&(l=r=-1),0===d&&(
d=p=-1),this.pouch.getEmpMonthByDate(t)),y=this.pouch.getEmpMonthByDate(a),g=this.pouch.isEmpMonthFixed(g,!0)||o.isDailyFix(),y=this.pouch.isEmpMonthFixed(y,!0)||s.isDailyFix(),s=this.pouch.isProhibitInputTimeUntilApproved(),g=teasp.view.Widget.isWorkDay(i,s)&&i&&!g,s=teasp.view.Widget.isWorkDay(n,s)&&n&&!y,y=(g&&!this.pouch.isAlive(t)&&(g=!1),s&&!this.pouch.isAlive(a)&&(s=!1),this.pouch.isPermitStartBtnDateChange())
,o=o.getInputLimit().flag,o=this.pouch.isUseRestartable()&&!(2&o),f=this.pouch.isLeavingAcrossNextDay(),b=this.pouch.getLimitedTimeDistance(),_=!1;return f&&i&&n&&(f=n.dayType==teasp.constant.DAY_TYPE_LEGAL_HOLIDAY&&(n.workFlag||n.autoLH)?teasp.constant.DAY_TYPE_NORMAL:n.dayType,n=i.dayType==teasp.constant.DAY_TYPE_LEGAL_HOLIDAY&&(i.workFlag||i.autoLH)?teasp.constant.DAY_TYPE_NORMAL:i.dayType,(
f=f==teasp.constant.DAY_TYPE_PUBLIC_HOLIDAY?teasp.constant.DAY_TYPE_NORMAL_HOLIDAY:f)!=(n=n==teasp.constant.DAY_TYPE_PUBLIC_HOLIDAY?teasp.constant.DAY_TYPE_NORMAL_HOLIDAY:n)&&(_=!0)),teasp.view.Widget.judgePushTime(t,a,g,s,e,p,d,r,l,c,m,h,u,this.pouch.isPermitLeavingPush24hours(),y,o,b,_)},teasp.view.Widget.judgePushTime=function(e,t,a,o,s,i,n,r,l,p,d,c,m,h,u,g,y,f){var b=300,h=(h&&0<=i&&b<i&&(b=i),!1),_=!1,v=!1,T=!1
,j=!1,E=!1,L=!1,n=o&&n<0&&s<=b&&!f;return n&&0<=i&&y<2880&&y<s+1440-i&&(n=!1),teasp.permitPushTime?(a?(g&&0<=l&&l<s?j=h=!0:(!n||u)&&r<0&&(l<0||s<l)&&(h=!0),v=h&&0<=p&&s<=p&&(m<0||m<=s+1440),n&&(r<0||s<=r)&&(l<0||s<l)&&(L=(E=!0)&&0<=m&&m<=s+1440&&(i<0||i<m)),l<0&&(r<0||r<s)&&(T=(_=!0)&&0<=d&&d<=s&&(r<0||r<d))):o&&n&&(r<0||s<=r)&&(l<0||s<l)&&(L=(E=!0)&&0<=m&&m<=s+1440&&(i<0||i<m)),{borderEt:b+1440,pkey:t,tkey:e,
pTime:n?s+1440:-1,tTime:s,restartable:j,stFlag:h,etFlag:_,tstFlag:v,tetFlag:T,petFlag:E,ptetFlag:L,stdStartTime:p,stdEndTime:d,pstdStartTime:c,pstdEndTime:m}):{borderEt:b+1440,pkey:t,tkey:e,pTime:n?s+1440:-1,tTime:s,restartable:!1,stFlag:!1,etFlag:!1,tstFlag:!1,tetFlag:!1,petFlag:!1,ptetFlag:!1,stdStartTime:p,stdEndTime:d,pstdStartTime:c,pstdEndTime:m}},teasp.view.Widget.isWorkDay=function(e,t){return e&&((
e.dayType==teasp.constant.DAY_TYPE_NORMAL||e.workFlag||e.autoLH)&&!e.plannedHoliday||0<e.rack.validApplys.kyushtu.length&&(!t||teasp.constant.STATUS_APPROVES.contains(e.rack.validApplys.kyushtu[0].status)))&&(!e.rack.holidayJoin||3!=e.rack.holidayJoin.flag)&&!e.interim},teasp.view.Widget.prototype.setPushButtons=function(){var e=this.getTimeInfo();e.stFlag?(dojo.setAttr("btnStInput","disabled",!1),
this.eventHandles.btnStInput||(this.eventHandles.btnStInput=dojo.connect(dojo.byId("btnStInput"),"onclick",this,function(){this.pushTimeStep1({type:10,face:0,fix:!1})}))):(dojo.setAttr("btnStInput","disabled",!0),this.eventHandles.btnStInput&&(dojo.disconnect(this.eventHandles.btnStInput),delete this.eventHandles.btnStInput)),e.etFlag||e.petFlag?(dojo.setAttr("btnEtInput","disabled",!1),
this.eventHandles.btnEtInput||(this.eventHandles.btnEtInput=dojo.connect(dojo.byId("btnEtInput"),"onclick",this,function(){this.pushTimeStep1({type:10,face:1,fix:!1})}))):(dojo.setAttr("btnEtInput","disabled",!0),this.eventHandles.btnEtInput&&(dojo.disconnect(this.eventHandles.btnEtInput),delete this.eventHandles.btnEtInput)),this.pouch.isUseFixedButton()?(dojo.style("btnTstInput","display",""),dojo.style(
"btnTetInput","display",""),dojo.style("btnBoard","display","none"),e.tstFlag?(dojo.setAttr("btnTstInput","disabled",!1),this.eventHandles.btnTstInput||(this.eventHandles.btnTstInput=dojo.connect(dojo.byId("btnTstInput"),"onclick",this,function(){this.pushTimeStep1({type:10,face:0,fix:!0})}))):(dojo.setAttr("btnTstInput","disabled",!0),this.eventHandles.btnTstInput&&(dojo.disconnect(this.eventHandles.btnTstInput),
delete this.eventHandles.btnTstInput)),e.tetFlag||e.ptetFlag?(dojo.setAttr("btnTetInput","disabled",!1),this.eventHandles.btnTetInput||(this.eventHandles.btnTetInput=dojo.connect(dojo.byId("btnTetInput"),"onclick",this,function(){this.pushTimeStep1({type:10,face:1,fix:!0})}))):(dojo.setAttr("btnTetInput","disabled",!0),this.eventHandles.btnTetInput&&(dojo.disconnect(this.eventHandles.btnTetInput),
delete this.eventHandles.btnTetInput))):(dojo.style("btnTstInput","display","none"),dojo.style("btnTetInput","display","none"),dojo.style("btnBoard","display","block"))},teasp.view.Widget.prototype.openInfoView=function(){teasp.manager.dialogOpen("Info",{small:!0},this.pouch,this,function(){this.showInfoRedIcon()})},teasp.view.Widget.prototype.isLeaveMsg=function(){return!(
"object"==typeof sforce&&sforce.one||dojo.isSafari)},teasp.view.Widget.prototype.jumpToMonthly=function(){teasp.manager.dialogOpen("BusyWait2",{message:teasp.message.getLabel("tm50001020")}),this.isLeaveMsg()?teasp.locationHref(teasp.getPageUrl("workTimeView"),parent.location):setTimeout(function(){teasp.manager.dialogClose("BusyWait2"),teasp.locationHref(teasp.getPageUrl("workTimeView"),parent.location)},200)},
teasp.view.Widget.prototype.jumpToDaily=function(){teasp.manager.dialogOpen("BusyWait2",{message:teasp.message.getLabel("tm50001030")}),this.isLeaveMsg()?teasp.locationHref(teasp.getPageUrl("timeReportView"),parent.location):setTimeout(function(){teasp.manager.dialogClose("BusyWait2"),teasp.locationHref(teasp.getPageUrl("timeReportView"),parent.location)},200)},teasp.view.Widget.prototype.jumpToExp=function(){
teasp.manager.dialogOpen("BusyWait2",{message:teasp.message.getLabel("tf10000470")}),this.isLeaveMsg()?teasp.locationHref(teasp.getPageUrl("empExpView"),parent.location):setTimeout(function(){teasp.manager.dialogClose("BusyWait2"),teasp.locationHref(teasp.getPageUrl("empExpView"),parent.location)},200)},teasp.view.Widget.prototype.showBusyWait=function(e){teasp.manager.dialogOpen("BusyWait2",{message:e},this.pouch,
null,function(){})},teasp.view.Widget.prototype.showMessage=function(e,t){e.msg&&teasp.manager.dialogOpen("Message",e,this.pouch,null,t)},teasp.view.Widget.getGetLocationError=function(e){var t={msg:"",sub1:"",sub2:""};return e&&(t.msg=teasp.message.getLabel("tf10008620"),t.sub1=teasp.message.getLabel("tf10008630"),t.sub2=e.message),t},teasp.view.Widget.prototype.showLocationError=function(e,t){
e=teasp.view.Widget.getGetLocationError(e);this.showMessage(e,t)},teasp.view.Widget.prototype.pushTimeStep1=function(e){if(e.comment=dojo.byId("comment").value.trim(),e.type||e.comment)if(990<e.comment.length)teasp.tsAlert(teasp.message.getLabel("tm50001120",990));else{var t=this.getTimeInfo(),a=this.pouch.getEmpDay(e.face&&0<t.pTime?t.pkey:t.tkey),o=a.getObj(),s=this.pouch.isUseRestartable(),
i=e.face&&0<t.pTime?t.pTime:t.tTime,n=o&&"number"==typeof o.startTime?o.startTime:-1,r=o&&"number"==typeof o.endTime?o.endTime:-1,l=(e.fix&&(i=0==e.face?t.stdStartTime:0<t.pTime?t.pstdEndTime:t.stdEndTime),"");if(e.waitmsg=teasp.message.getLabel("tm50001040"),10==e.type){if((!(s&&0===e.face&&0<=r)||e.fix)&&(0===e.face&&0<=r&&r<=i||0!==e.face&&0<=n&&i<=n))return void teasp.tsAlert(teasp.message.getLabel("tm50001130"))
if(0!==e.face&&1440<i){s=this.pouch.getEmpDay(teasp.util.date.addDays(a.getKey(),1)).getProhibitOverNightWorkHoliday();if(s)return void teasp.tsAlert(teasp.message.getLabel("tf10008360",s.name))}e.waitmsg=teasp.message.getLabel("tm50001050"),l=e.fix?teasp.message.getLabel(0===e.face?"tm50001060":"tm50001070"):teasp.message.getLabel(0===e.face?"tm50001080":"tm50001090")}else e.prefix&&(l="("+e.prefix+") ");
var p=dojo.hitch(this,function(){e.comment=l+e.comment,this.showBusyWait(e.waitmsg),this.pushTimeStep2(e,t)});10==e.type&&0===e.face&&"number"==typeof(r=o.endTime)&&r<=i?teasp.tsConfirm(teasp.message.getLabel("tm50001200"),this,function(e){e&&p()}):p()}},teasp.view.Widget.prototype.pushTimeStep2=function(t,a){var o=this.token;
0!=t.type&&this.pushTimeWithLocationWeb&&navigator.geolocation?navigator.geolocation.getCurrentPosition(dojo.hitch(this,function(e){o==this.token&&(this.token++,this.pushTimeStep3(t,a,e.coords))}),dojo.hitch(this,function(e){o==this.token&&(this.token++,this.pushTimeStep3(t,a,null,e))}),{enableHighAccuracy:!0,timeout:3e4,maximumAge:0}):this.pushTimeStep3(t,a)},teasp.view.Widget.prototype.pushTimeStep3=function(e,t,a,
o){var s=t.tkey,i=this.pouch.getYearMonth(),n=this.pouch.getStartDate(),r=this.pouch.getLastModifiedDate(),l=!1,p=(e.face&&0<t.pTime&&(s=t.pkey,l=!0,n!=(p=this.pouch.getEmpMonth(null,s)).startDate&&(i=p.yearMonth,r=this.pouch.getPrevMonthLastModifiedDate())),{empId:this.pouch.getEmpId(),month:i,startDate:n,lastModifiedDate:r,date:s,prevFlag:l,stdStartTime:l?t.stdStartTime:t.pstdStartTime,
stdEndTime:l?t.stdEndTime:t.pstdEndTime,input:{comment:e.comment},device:"TSW",latitude:a?a.latitude:null,longitude:a?a.longitude:null});if(e.type&&(p.input.time=e.face&&0<=t.pTime?t.pTime:t.tTime,p.input.face=e.face,p.input.fix=e.fix,p.input.type=e.type),this.pouch.isUseWorkLocation()){const d=this.getCheckedWorkLocation();p.input.workLocationId=d&&d.workLocation.getId()||null}return teasp.manager.request(
"inputTime",p,this.pouch,{hideBusy:!0},this,function(){this.pushTimeStep4(o,function(){l&&location.reload()})},function(e){teasp.manager.dialogClose("BusyWait2"),teasp.message.alertError(e)}),!1},teasp.view.Widget.prototype.pushTimeStep4=function(e,t){teasp.manager.request("loadWidget",{},this.pouch,{hideBusy:!0},this,function(){teasp.manager.dialogClose("BusyWait2"),dojo.byId("comment").value="",this.setPushButtons(
),e?this.showLocationError(e,t):t()},function(e){dojo.style("infoError","display","block"),/Unable to connect to the server/.test(e.message)||(dojo.byId("errorMessage").innerHTML=teasp.message.getErrorMessage(e))})},teasp.provide("teasp.view.Shift"),teasp.view.Shift=function(){this.startCell=null,this.localObj={},this.pMenu=null,this.empSelectDialog=null,this.empDayDialog=null,this.cacheEmps={},this.printFlag=!1,
this.eventDayCells={},this.temporaryShiftId=[],this.deptKeys=[],this.importResultFlag=!1,this.currentRangeType=0,this.sumColumnsFix=[{name:"勤務日",headId:"workDays",headClassName:"sumHoriz1Cell"},{name:"休日",headId:"holiDays",headClassName:"sumHoriz1Cell"},{name:"有休計画付与日",headId:"offDays",headClassName:"sumHoriz1Cell"}],this.sumColumns=[],this.shiftImport=null},teasp.view.Shift.prototype=new teasp.view.Base,
teasp.view.Shift.prototype.contact=function(e,t,a){teasp.action.contact.remoteMethods(is_array(e)?e:[e],{errorAreaId:e.errorAreaId||this.errorAreaId,nowait:a||!1},t,null,this)},teasp.view.Shift.prototype.contactForUpdate=function(e,t,a,o){teasp.action.contact.remoteMethods(is_array(e)?e:[e],{errorAreaId:e.errorAreaId||this.errorAreaId,nowait:o||!1},t,a,this)},teasp.view.Shift.prototype.getPermission=function(){
var e=globalLoadRes.user,t=globalLoadRes.emp||null,a=0,o=(e.Profile.PermissionsModifyAllData&&(a|=teasp.constant.P_SS),t&&(t.IsAdmin__c&&(a|=teasp.constant.P_AD),t.IsAllEditor__c&&(a|=teasp.constant.P_AE),t.IsAllReader__c&&(a|=teasp.constant.P_AR),t.IsExpAdmin__c&&(a|=teasp.constant.P_AX)),0),s=0;return{user:e,emp:t,flag:a,allReader:((o|=a&teasp.constant.P_SS
)|a&teasp.constant.P_AD|a&teasp.constant.P_AE|a&teasp.constant.P_AR)&~teasp.constant.P_E,allEditor:(s|=a&teasp.constant.P_SS)|a&teasp.constant.P_AD|a&teasp.constant.P_AE}},teasp.view.Shift.prototype.init=function(e,t){teasp.isSforce()&&dojo.style("big_area","margin","0px"),dojo.style("shiftDummy","display","");var a=dojo.query("#shiftDummy tbody")[0];this.scrollW=a.offsetWidth-a.clientWidth,dojo.style("shiftDummy",
"display","none"),dojo.style("shiftCsvImport1","display",globalLoadRes.enableShiftCsvImport?"":"none"),dojo.style("shiftCsvImport2","display",globalLoadRes.enableShiftCsvImport?"":"none"),dojo.style("shiftImportToolDL","display",globalLoadRes.enableShiftImportToolDownload?"":"none"),globalLoadRes.enableShiftImportToolDownload&&(globalLoadRes.shiftImportToolCustomURL?dojo.byId("shiftImportToolDL"
).value="シフト登録ツールをダウンロードする":dojo.byId("shiftImportToolDL").value="最新のシフト登録ツール(v"+globalLoadRes.shiftImportToolVersion+")をダウンロードする"),this.localObj.depts=globalLoadRes.depts,this.localObj.titles=[];for(var o=0;o<globalLoadRes.titles.length;o++){var s=globalLoadRes.titles[o];this.localObj.titles.push(s.Title__c)}this.localObj.titles=this.localObj.titles.sort(function(e,t){return e==t?0:e<t?-1:1});var i,
a=globalLoadRes.emp,n=new Date,r=(dijit.byId("monYear").setValue(n.getFullYear()),dijit.byId("monMonth").setValue(n.getMonth()+1),100*n.getFullYear()+(n.getMonth()+1)),l=(r=a?(a=teasp.util.searchYearMonthDate(a.EmpTypeId__r.ConfigBaseId__r.InitialDateOfMonth__c,a.EmpTypeId__r.ConfigBaseId__r.MarkOfMonth__c,r),i=teasp.util.date.parseDate(a.startDate),teasp.util.date.parseDate(a.endDate)):(i=new Date(n.getFullYear(),
n.getMonth(),1),new Date(n.getFullYear(),n.getMonth(),teasp.util.date.getMonthEndDay(n.getFullYear(),n.getMonth()+1))),dijit.byId("startYear").setValue(i.getFullYear()),dijit.byId("startMonth").setValue(i.getMonth()+1),dijit.byId("startDate").setValue(i.getDate()),dijit.byId("endYear").setValue(r.getFullYear()),dijit.byId("endMonth").setValue(r.getMonth()+1),dijit.byId("endDate").setValue(r.getDate()),
this.showRangeOfYearMonth(),dojo.connect(dijit.byId("startYear"),"onChange",this,this.setDeptPulldown),dojo.connect(dijit.byId("startMonth"),"onChange",this,this.setDeptPulldown),dojo.connect(dijit.byId("startDate"),"onChange",this,this.setDeptPulldown),dojo.connect(dijit.byId("endYear"),"onChange",this,this.setDeptPulldown),dojo.connect(dijit.byId("endMonth"),"onChange",this,this.setDeptPulldown),dojo.connect(
dijit.byId("endDate"),"onChange",this,this.setDeptPulldown),dojo.connect(dojo.byId("changeRangeType1"),"onclick",this,function(){this.getRangeValue()&&(dojo.style("inputRangeType1","display","none"),dojo.style("inputRangeType2","display",""),this.currentRangeType=1)}),dojo.connect(dojo.byId("changeRangeType2"),"onclick",this,function(){dojo.style("inputRangeType1","display",""),dojo.style("inputRangeType2","display",
"none"),this.currentRangeType=0,this.showRangeOfYearMonth()}),dojo.connect(dijit.byId("monYear"),"onChange",this,this.showRangeOfYearMonth),dojo.connect(dijit.byId("monMonth"),"onChange",this,this.showRangeOfYearMonth),dojo.connect(dojo.byId("searchDo"),"onclick",this,this.search),dojo.connect(dojo.byId("searchCancel"),"onclick",this,function(){this.showError(null),dojo.style("inputCondition","display","none"),
dojo.style("searchCondition","display","")}),dojo.connect(dojo.byId("changeSearch"),"onclick",this,function(){var e,t;this.localObj.param&&(dojo.style("inputRangeType1","display",this.currentRangeType?"none":""),dojo.style("inputRangeType2","display",this.currentRangeType?"":"none"),this.currentRangeType?(e=new Date,dijit.byId("monYear").setValue(e.getFullYear()),dijit.byId("monMonth").setValue(e.getMonth()+1)):(
dijit.byId("monYear").setValue(Math.floor(this.localObj.param.month/100)),dijit.byId("monMonth").setValue(this.localObj.param.month%100)),e=teasp.util.date.parseDate(this.localObj.param.startDate),t=teasp.util.date.parseDate(this.localObj.param.endDate),dijit.byId("startYear").setValue(e.getFullYear()),dijit.byId("startMonth").setValue(e.getMonth()+1),dijit.byId("startDate").setValue(e.getDate()),dijit.byId("endYear"
).setValue(t.getFullYear()),dijit.byId("endMonth").setValue(t.getMonth()+1),dijit.byId("endDate").setValue(t.getDate()),dojo.byId("selectDepts").value=this.localObj.param.deptId),this.localObj.param.empIdList;dojo.style("inputCondition","display",""),dojo.style("searchCondition","display","none")}),this.empSelectDialog=new teasp.dialog.EmpSelect(this,this.localObj.depts,this.localObj.titles,this.getRangeValue,
this.searchEmp,this.setCahceEmps(),this.getEmpSelected()),this);this.empSelectDialog.ready([],function(e,t){var a=l.cacheEmps;a.select||(a.select={}),a.select[e]=t?1:0,dojo.byId("entriedEmp").value=l.getSearchEmpName()},function(e,t){for(var a=l.cacheEmps,o=(a.select||(a.select={}),t?1:0),s=0;s<e.length;s++)a.select[e[s]]=o;dojo.byId("entriedEmp").value=l.getSearchEmpName()},function(){var e=l.cacheEmps;e.select&&(
e.select={}),dojo.byId("entriedEmp").value=""}),this.empDayDialog=new teasp.dialog.EmpDay(this.localObj),this.empDayDialog.ready(),dojo.connect(dojo.byId("entriedEmp"),"onmouseenter",this,function(){dijit.popup.open({popup:this.empSelectDialog.getDialog(),around:dojo.byId("entriedEmp")})}),dojo.connect(dojo.byId("big_area"),"onclick",this,function(){dijit.popup.close(this.empSelectDialog.getDialog())}),dojo.connect(
dojo.byId("browseDept"),"onclick",this,this.openSelectDept),dojo.connect(dojo.byId("shiftCsvOut"),"onclick",this,this.openShiftOutput),dojo.connect(dojo.byId("shiftCsvImport1"),"onclick",this,this.openShiftCsvImport),dojo.connect(dojo.byId("shiftCsvImport2"),"onclick",this,this.openShiftCsvImport),dojo.connect(dojo.byId("displayTime"),"onclick",this,function(){var t=dojo.byId("displayTime").checked;dojo.query(
".dayTime").forEach(function(e){dojo.style(e,"display",t?"":"none")}),this.resizeArea()}),dojo.byId("displayEvent").checked=!0,dojo.connect(dojo.byId("displayEvent"),"onclick",this,this.createTable),dojo.style(dojo.byId("displayEvent").parentNode,"display",""),dojo.connect(dojo.byId("displayLegend"),"onclick",this,this.checkedLegend),dojo.connect(dojo.byId("changeRealSave"),"onclick",this,this.saveToReal),
this.createMenu()},teasp.view.Shift.prototype.initForPrint=function(e,t){this.printFlag=!0,this.readParams({}),this.localObj.depts=teasp.view.Shift.processingDepts(globalLoadRes.depts,this.viewParams.startDate,this.viewParams.endDate);var a={month:0<this.viewParams.month.length?parseInt(this.viewParams.month,10):null,startDate:this.viewParams.startDate,endDate:this.viewParams.endDate,
rangeType:0<this.viewParams.month.length?0:1,deptId:this.viewParams.deptId,deptOpt:3,empIdList:0<this.viewParams.empIdList.length?this.viewParams.empIdList.split(/,/):[]};this.currentRangeType=a.rangeType,this.changeImportResultMode(!!this.viewParams.importResult),dojo.connect(dojo.byId("displayTime"),"onclick",this,function(){var t=dojo.byId("displayTime").checked;dojo.query(".dayTime").forEach(function(e){
dojo.style(e,"display",t?"":"none")}),this.resizeArea()}),dojo.connect(dojo.byId("displayLegend"),"onclick",this,this.checkedLegend),dojo.byId("displayEvent").checked=!0,dojo.style(dojo.byId("displayEvent").parentNode,"display","none"),this.searchShiftData(a)},teasp.view.Shift.prototype.getSearchEmpName=function(e,t){if(t&&e){for(var a=[],o=0;o<e.length;o++){var s=this.getEmpById(e[o]);s&&a.push(s.Name)}
return a.join(", ")}var i=this.cacheEmps;if(i.select||(i.select={}),e)for(var n in i.select)i.select.hasOwnProperty(n)&&(i.select[n]=e.contains(n)?1:0);var r=i.map||{},a=[];for(n in r)i.select[n]&&r.hasOwnProperty(n)&&a.push(r[n].Name);return a.join(", ")},teasp.view.Shift.prototype.getSearchEmpId=function(){var e,t=this.cacheEmps,a=(t.select||(t.select={}),[]);for(e in t.select)t.select.hasOwnProperty(e
)&&t.select[e]&&a.push(e);return a},teasp.view.Shift.prototype.openPrintView=function(){var e=screen.availHeight||800,t=(800<e&&(e=800),this.localObj.param),a="?startDate="+t.startDate,o=(a=(a=(a=(a+="&endDate="+t.endDate)+("&month="+(t.month||"")))+("&deptId="+(t.deptId||"")))+("&empIdList="+t.empIdList.join(",")),this.importResultFlag&&(a+="&importResult=1"),window.open(teasp.getPageUrl("shiftPrintView")+a,"print",
"width=900,height="+e+",resizable=yes,scrollbars=yes"));setTimeout(function(){o.resizeTo(910,e)},100)},teasp.view.Shift.prototype.showRangeOfYearMonth=function(){if(dijit.byId("monYear").isValid()&&dijit.byId("monMonth").isValid()){var e,t=globalLoadRes.emp,a=100*parseInt(dojo.byId("monYear").value,10)+parseInt(dojo.byId("monMonth").value,10),t=t?teasp.util.searchYearMonthDate(
t.EmpTypeId__r.ConfigBaseId__r.InitialDateOfMonth__c,t.EmpTypeId__r.ConfigBaseId__r.MarkOfMonth__c,a):null;if(!t)return o=new Date(Math.floor(a/100),a%100,1),e=teasp.util.date.addDays(teasp.util.date.addMonths(o,1),-1),{yearMonth:a,startDate:teasp.util.date.formatDate(o),endDate:teasp.util.date.formatDate(e)};var a=teasp.util.date.parseDate(t.startDate),o=teasp.util.date.parseDate(t.endDate);dojo.byId("monYearMonth"
).innerHTML="（ "+teasp.util.date.formatDate(a,"SLA")+"～"+teasp.util.date.formatDate(o,"SLA")+" ）",dijit.byId("startYear").setValue(a.getFullYear()),dijit.byId("startMonth").setValue(a.getMonth()+1),dijit.byId("startDate").setValue(a.getDate()),dijit.byId("endYear").setValue(o.getFullYear()),dijit.byId("endMonth").setValue(o.getMonth()+1),dijit.byId("endDate").setValue(o.getDate()),this.setDeptPulldown()}},
teasp.view.Shift.prototype.showError=function(e){teasp.util.showErrorArea(e,"error_area")},teasp.view.Shift.prototype.showMessage=function(e){dojo.byId("message").innerHTML=e||""},teasp.view.Shift.prototype.search=function(){var e=this.getRangeValue();e&&(e.startDate>e.endDate?this.showError("期間の設定が正しくありません"):32<teasp.util.date.daysInRange(e.startDate,e.endDate)?this.showError("期間の日数が最大32日間を超えないように範囲を指定してください"):(
e.deptId=dojo.byId("selectDepts").value,"-"==e.deptId&&(e.deptId=null),e.deptOpt=3,e.empIdList=this.getSearchEmpId(),!e.deptId&&e.empIdList.length<=0?this.showError("部署を指定してください"):(this.resetScrollTop(),this.changeImportResultMode(!1),this.searchShiftData(e))))},teasp.view.Shift.prototype.getRangeValue=function(){var e=dijit.byId("monYear").isValid()&&dijit.byId("monMonth").isValid(),t=dijit.byId("startYear"
).isValid()&&dijit.byId("startMonth").isValid()&&dijit.byId("startDate").isValid()&&dijit.byId("endYear").isValid()&&dijit.byId("endMonth").isValid()&&dijit.byId("endDate").isValid();if(this.currentRangeType){if(!t)return null}else if(!e)return null;var t=e?100*parseInt(dojo.byId("monYear").value,10)+parseInt(dojo.byId("monMonth").value,10):null,e=teasp.util.date.formatDate(new Date(parseInt(dojo.byId("startYear"
).value,10),parseInt(dojo.byId("startMonth").value,10)-1,parseInt(dojo.byId("startDate").value,10))),a=teasp.util.date.formatDate(new Date(parseInt(dojo.byId("endYear").value,10),parseInt(dojo.byId("endMonth").value,10)-1,parseInt(dojo.byId("endDate").value,10)));return{month:this.currentRangeType?null:t,_month:t,startDate:e,endDate:a,rangeType:this.currentRangeType}},
teasp.view.Shift.prototype.setDeptPulldown=function(){var e=this.getRangeValue();if(e){dojo.style(document.body,"cursor","wait");var t=dojo.byId("selectDepts"),e=(dojo.attr(t,"disabled",!0),this.levelDepts=teasp.view.Shift.processingDepts(globalLoadRes.depts,e.startDate,e.endDate),t.value);!e&&globalLoadRes.emp&&(e=globalLoadRes.emp.DeptId__c),dojo.empty(t),dojo.create("option",{innerHTML:"（選択してください）",value:"-"},t);
for(var a=0;a<this.levelDepts.length;a++){var o=this.levelDepts[a];o.past||o.future||dojo.create("option",{innerHTML:o.displayName,value:o.Id},t)}t.value=e||"-",this.empSelectDialog&&this.empSelectDialog.setDeptPulldown(),setTimeout(function(){dojo.attr("selectDepts","disabled",!1),dojo.style(document.body,"cursor","default")},1e3)}},teasp.view.Shift.prototype.searchShiftData=function(e){this.contact({
funcName:"collectShift",params:e},function(e){this.collectData(e),this.createTable()})},teasp.view.Shift.prototype.collectData=function(e){this.localObj.param=e.param,this.localObj.emps=[],this.localObj.dateList=[],this.localObj.patterns=[],this.localObj.holidays=[],this.localObj.allPatterns=[],this.localObj.empIdIndex={},this.localObj.deptMap={},this.localObj.events={},this.localObj.pubEvents={},
this.localObj.deptEvents={},this.localObj.notes={},this.localObj.countDays={},this.localObj.attSummary={},this.startCell=null,this.temporaryShiftId=[],this.sumColumns=dojo.clone(this.sumColumnsFix);for(var t=teasp.util.date.getDateList(e.param.startDate,e.param.endDate),a={},o={},s={},i={},n={common:{}},r={},H={},l={},p={},d={},c=0;c<e.empApplys.length;c++){var m=e.empApplys[c];
m.startDate=teasp.logic.convert.valDate(m.StartDate__c),m.endDate=teasp.logic.convert.valDate(m.EndDate__c),m.exchangeDate=teasp.logic.convert.valDate(m.ExchangeDate__c),m.originalStartDate=teasp.logic.convert.valDate(m.OriginalStartDate__c),l[m.EmpId__c]||(l[m.EmpId__c]=[]),l[m.EmpId__c].push(m),t.contains(m.startDate)||(d[m.startDate]=1),t.contains(m.endDate)||(d[m.endDate]=1),m.exchangeDate&&!t.contains(
m.exchangeDate)&&(d[m.exchangeDate]=1),m.originalStartDate&&!t.contains(m.originalStartDate)&&(d[m.originalStartDate]=1),m.HolidayId__r&&(s[m.HolidayId__r.Id]=m.HolidayId__r)}var h=[].concat(t);for(D in d)d.hasOwnProperty(D)&&h.push(D);var u,P=(h=h.sort(function(e,t){return e<t?-1:t<e?1:0}))[0],C=h[h.length-1],W=this.getPermission();for(c=0;c<e.configs.length;c++){a[(E=e.configs[c]).ConfigBaseId__c]||(
a[E.ConfigBaseId__c]=[]),E.validStartDate=E.ValidStartDate__c?teasp.logic.convert.valDate(E.ValidStartDate__c):null,E.validEndDate=E.ValidEndDate__c?teasp.logic.convert.valDate(E.ValidEndDate__c):null;for(var g,F=E.Holidays__c||"0000000",Y=[],q=[],y=0;y<F.length;y++)"0"!=(R=F.substring(y,y+1))&&Y.push(y),"2"==R&&q.push(y);for(b in E.fixHolys=getHolidays(teasp.util.date.parseDate(
!E.validStartDate||E.validStartDate<=P?P:E.validStartDate),teasp.util.date.parseDate(!E.validEndDate||E.validEndDate>=C?C:E.validEndDate),Y,!1),E.fixHolys)E.fixHolys.hasOwnProperty(b)&&(g=E.fixHolys[b],q.contains(g.dayOfWeek)?g.dayType=teasp.constant.DAY_TYPE_LEGAL_HOLIDAY:Y.contains(g.dayOfWeek
)?g.dayType=teasp.constant.DAY_TYPE_NORMAL_HOLIDAY:E.NonPublicHoliday__c?g.dayType=teasp.constant.DAY_TYPE_NORMAL:g.dayType=teasp.constant.DAY_TYPE_PUBLIC_HOLIDAY);a[E.ConfigBaseId__c].push(E)}for(c=0;c<e.calendars.length;c++){var f=e.calendars[c],b=teasp.logic.convert.valDate(f.Date__c);f.DeptId__c?(r[D=f.DeptId__c]||(r[D]={}),r[D][b]=f):(n[D=f.EmpTypeId__c||"common"]||(n[D]={}),n[D][b]=f)}for(
c=0;c<e.patterns.length;c++){var B=e.patterns[c];o[B.Id]=B}for(c=0;c<e.empTypePatterns.length;c++){var _=e.empTypePatterns[c];_.pattern=o[_.PatternId__c],i[_.EmpTypeId__c]||(i[_.EmpTypeId__c]=[]),i[_.EmpTypeId__c].push(_)}for(c=0;c<e.empMonths.length;c++){var v=e.empMonths[c];v.startDate=teasp.logic.convert.valDate(v.StartDate__c),v.endDate=teasp.logic.convert.valDate(v.EndDate__c),p[v.EmpId__c]||(p[v.EmpId__c]=[]),
p[v.EmpId__c].push(v)}for(c=0;c<e.empTypes.length;c++){var T=e.empTypes[c],j=((H[T.Id]=T).patterns=(i[T.Id]||[]).sort(function(e,t){return e.Order__c-t.Order__c}),T.days={},a[T.ConfigBaseId__c]);for(y=0;y<h.length;y++){var E,b=h[y],L=T.days[b]={date:teasp.util.date.parseDate(b)};if(1==j.length)L.config=j[0];else for(S=0;S<j.length;S++)if((!(E=j[S]).validStartDate||E.validStartDate<=b)&&(
!E.validEndDate||E.validEndDate>=b)){L.config=E;break}L.layer1=(k=u=void 0,u={},k=L.config.fixHolys[b],u.dayType=k?k.dayType:teasp.constant.DAY_TYPE_NORMAL,u.event=k&&k.title||null,k=teasp.view.Shift.getPatternByDate(T.patterns,L.date),u.pattern=k&&k.pattern||null,u),L.layer2=function(e,t){if(!e&&!t)return{};function a(e){switch(e){case"1":return teasp.constant.DAY_TYPE_NORMAL_HOLIDAY;case"2":
return teasp.constant.DAY_TYPE_LEGAL_HOLIDAY;case"3":return teasp.constant.DAY_TYPE_PUBLIC_HOLIDAY;default:return teasp.constant.DAY_TYPE_NORMAL}}var o={};return e&&(e.Type__c&&(o.dayType=a(e.Type__c),o.plannedHoliday=e.PlannedHoliday__c||!1,o.commonPriority="1"==e.Priority__c),e.Event__c&&0<e.Event__c.length&&(o.commonEvent=e.Event__c),e.Note__c&&0<e.Note__c.length&&(o.commonNote=e.Note__c)),t&&(
t.Type__c&&!o.commonPriority&&(o.dayType=a(t.Type__c),o.plannedHoliday=t.PlannedHoliday__c||!1),t.Event__c&&0<t.Event__c.length&&(o.event=t.Event__c),t.Note__c&&0<t.Note__c.length&&(o.note=t.Note__c),o.pattern=t.PatternId__r||null),o}(n.common[b]||null,(n[T.Id]||{})[b]||null),L.dayType=("number"==typeof L.layer2.dayType?L.layer2:L.layer1).dayType,
L.plannedHoliday=L.dayType==teasp.constant.DAY_TYPE_NORMAL&&L.layer2.plannedHoliday||!1,L.pattern=L.layer2.pattern||L.layer1.pattern;var k=[];L.layer1.event&&k.push(L.layer1.event),L.layer2.commonEvent&&k.push(L.layer2.commonEvent),L.layer2.event&&k.push(L.layer2.event),L.event=0<k.length?k.join(teasp.message.getLabel("tm10001470")):null,L.note=L.layer2.note,this.localObj.pubEvents[b]=L.layer1.event,
this.localObj.events[b]=L.layer2.commonEvent}}for(c=0;c<this.localObj.depts.length;c++){var V=this.localObj.depts[c];for(this.localObj.deptEvents[V.Id]={days:{}},y=0;y<h.length;y++){var b=h[y],L=this.localObj.deptEvents[V.Id].days[b]={},K=(r[V.Id]||{})[b];K&&(L.event=K.Event__c,L.note=K.Note__c)}}var D,o={},s={},U=0;for(e.emps=e.emps.sort(function(e,t){
return e.Title__c==t.Title__c?e.EmpCode__c==t.EmpCode__c?e.Name<t.Name?-1:1:(e.EmpCode__c||!t.EmpCode__c)&&(e.EmpCode__c&&!t.EmpCode__c||e.EmpCode__c<t.EmpCode__c)?-1:1:(e.Title__c||!t.Title__c)&&(e.Title__c&&!t.Title__c||e.Title__c<t.Title__c)?-1:1}),c=0;c<e.emps.length;c++){var I=e.emps[c],J=(I.empType=H[I.EmpTypeId__c],I.DeptId__c||"(null)"),G=(this.localObj.deptMap[J]||(this.localObj.deptMap[J]=[]),
this.localObj.deptMap[J].push(I),I.days={},I.countDays={workDays:0,holiDays:0,offDays:0},this.isEditable(I,W));for(y=0;y<t.length;y++){b=t[y],L=I.days[b]={};if(p[I.Id])for(var A=p[I.Id],S=0;S<A.length;S++){var z=A[S];if(z.startDate<=b&&b<=z.endDate){L.monthStatus=z.EmpApplyId__r?z.EmpApplyId__r.Status__c:null;break}}var X=[];if(l[I.Id]){A=l[I.Id];for(S=0;S<A.length;S++)((x=A[S]
).startDate<=b&&b<=x.endDate||x.ApplyType__c==teasp.constant.APPLY_TYPE_EXCHANGE&&b==x.exchangeDate)&&X.push(x)}var Z={},Q={};for(S=0;S<X.length;S++){var x=X[S];teasp.view.Shift.setApplyToDayObj(x.Decree__c&&x.ApplyType__c!=teasp.constant.APPLY_TYPE_HOLIDAY?Q:Z,teasp.view.Shift.getApplyKey(x,b),x)}L.applys=teasp.view.Shift.getValidApplys(Z),L.decrees=teasp.view.Shift.getValidApplys(Q),
L.dayType=I.empType.days[b].dayType,L.plannedHoliday=I.empType.days[b].plannedHoliday,L.pattern=I.empType.days[b].pattern,L.orgDayType=L.dayType;var w=L.decrees.patternS||L.decrees.patternL;if(w&&(w.Removed__c||("string"==typeof w.DayType__c&&(L.dayType=parseInt(w.DayType__c,10)),L.pattern=w.PatternId__r||null,L.workPlace=w.WorkPlaceId__r||null,L.workPlace||(L.workPlaceNoChange=!0)),L.temporary=w.TempFlag__c,
L.memo=w.Content__c||null,L.temporary&&(this.temporaryShiftId.push(w.Id),L.decrees.patternS.orgs&&0<L.decrees.patternS.orgs.length)))for(S=0;S<L.decrees.patternS.orgs.length;S++)this.temporaryShiftId.push(L.decrees.patternS.orgs[S].Id);var M,O,w=L.applys.patternS||L.applys.patternL;w&&("string"==typeof w.DayType__c&&(L.dayType=parseInt(w.DayType__c,10)),L.pattern=w.PatternId__r||null),
L.applys.exchangeS?L.dayType=I.empType.days[L.applys.exchangeS.exchangeDate].dayType:!L.applys.exchangeS&&L.applys.exchangeE&&(L.dayType=I.empType.days[L.applys.exchangeE.originalStartDate].dayType),L.pattern&&((w=o[L.pattern.Id])?w.cnt++:o[L.pattern.Id]={cnt:1,pattern:L.pattern}),L.applys.holidayAll&&((M=s[L.applys.holidayAll.HolidayId__r.Id])?M.cnt++:s[L.applys.holidayAll.HolidayId__r.Id]={cnt:1,
holiday:L.applys.holidayAll.HolidayId__r}),L.applys.holidayAm&&((M=s[L.applys.holidayAm.HolidayId__r.Id])?M.cnt++:s[L.applys.holidayAm.HolidayId__r.Id]={cnt:1,holiday:L.applys.holidayAm.HolidayId__r}),L.applys.holidayPm&&((M=s[L.applys.holidayPm.HolidayId__r.Id])?M.cnt++:s[L.applys.holidayPm.HolidayId__r.Id]={cnt:1,holiday:L.applys.holidayPm.HolidayId__r}),L.fix=teasp.constant.STATUS_FIX.contains(L.monthStatus
)||L.applys.dailyFix,L.editable=G,L.dayType==teasp.constant.DAY_TYPE_NORMAL?(L.plannedHoliday&&!L.applys.kyushtu&&(I.countDays.offDays++,U++),L.applys.holidayAll&&(I.countDays[L.applys.holidayAll.HolidayId__r.Id]?I.countDays[L.applys.holidayAll.HolidayId__r.Id]++:I.countDays[L.applys.holidayAll.HolidayId__r.Id]=1),L.applys.holidayAm&&(
I.countDays[L.applys.holidayAm.HolidayId__r.Id]?I.countDays[L.applys.holidayAm.HolidayId__r.Id]++:I.countDays[L.applys.holidayAm.HolidayId__r.Id]=1),L.applys.holidayPm&&(I.countDays[L.applys.holidayPm.HolidayId__r.Id]?I.countDays[L.applys.holidayPm.HolidayId__r.Id]++:I.countDays[L.applys.holidayPm.HolidayId__r.Id]=1),L.applys.holidayAll||L.applys.holidayAm&&L.applys.holidayPm||(I.countDays.workDays++,
w=L.pattern?L.pattern.Id:"(null)",O=L.workPlace?L.workPlace.Id:I.DeptId__c||"(null)",I.countDays[w]?I.countDays[w]++:I.countDays[w]=1,this.localObj.countDays[O]||(this.localObj.countDays[O]={}),this.localObj.countDays[O][b]||(this.localObj.countDays[O][b]={}),this.localObj.countDays[O][b][w]?this.localObj.countDays[O][b][w]++:this.localObj.countDays[O][b][w]=1)):I.countDays.holiDays++}}for(
D in this.localObj.emps=e.emps,this.localObj.dateList=t,o)o.hasOwnProperty(D)&&this.localObj.patterns.push(o[D]);for(D in this.localObj.patterns=this.localObj.patterns.sort(function(e,t){return t.cnt-e.cnt}),this.localObj.patterns.unshift({}),this.localObj.allPatterns=e.patterns,s)s.hasOwnProperty(D)&&this.localObj.holidays.push(s[D]);for(this.localObj.holidays=this.localObj.holidays.sort(function(e,t){
return t.cnt-e.cnt}),U<=0&&this.sumColumns.splice(2,1),c=0;c<this.localObj.holidays.length;c++){var R=this.localObj.holidays[c].holiday;this.sumColumns.push({name:R.Name,headId:R.Id,headClassName:"sumHoriz1Cell",holiday:R})}for(D in this.deptKeys=[],this.localObj.deptMap)this.localObj.deptMap.hasOwnProperty(D)&&this.deptKeys.push(D);var $=this.localObj.param.deptId;for(this.deptKeys=this.deptKeys.sort(function(e,t){
return"-1"==$?"(null)"==e?-1:"(null)"==t?1:0:e==$?-1:t==$?1:0}),c=0;c<e.attSummaries.length;c++){var N=e.attSummaries[c];this.localObj.attSummary[N.EmployeeHistoryId__r.BaseId__c]||(this.localObj.attSummary[N.EmployeeHistoryId__r.BaseId__c]=[]),this.localObj.attSummary[N.EmployeeHistoryId__r.BaseId__c].push({Id:N.Id,startDate:teasp.logic.convert.valDate(N.StartDate__c),endDate:teasp.logic.convert.valDate(N.EndDate__c
)})}},teasp.view.Shift.prototype.isEditable=function(e,t){return!(!t.allEditor&&e.UserId__c!=t.user.Id&&e.Manager__c!=t.user.Id)||!!e.DeptId__r&&(e.DeptId__r.ManagerId__c==t.user.Id||e.DeptId__r.Manager1Id__c==t.user.Id||e.DeptId__r.Manager2Id__c==t.user.Id||!!e.DeptId__r.ParentId__r&&(
e.DeptId__r.ParentId__r.ManagerId__c==t.user.Id||e.DeptId__r.ParentId__r.Manager1Id__c==t.user.Id||e.DeptId__r.ParentId__r.Manager2Id__c==t.user.Id||!!e.DeptId__r.ParentId__r.ParentId__r&&(
e.DeptId__r.ParentId__r.ParentId__r.ManagerId__c==t.user.Id||e.DeptId__r.ParentId__r.ParentId__r.Manager1Id__c==t.user.Id||e.DeptId__r.ParentId__r.ParentId__r.Manager2Id__c==t.user.Id||!!e.DeptId__r.ParentId__r.ParentId__r.ParentId__r&&(
e.DeptId__r.ParentId__r.ParentId__r.ParentId__r.ManagerId__c==t.user.Id||e.DeptId__r.ParentId__r.ParentId__r.ParentId__r.Manager1Id__c==t.user.Id||e.DeptId__r.ParentId__r.ParentId__r.ParentId__r.Manager2Id__c==t.user.Id))))},teasp.view.Shift.prototype.createTable=function(){var e,t={},o=this,a=(this.normalPatternSymbol=null,!!dojo.byId("displayTime")&&dojo.byId("displayTime").checked),s=(this.scrollHandle&&(
dojo.disconnect(this.scrollHandle),this.scrollHandle=null),this.currentRangeType?(dojo.byId("searchCondRangeLabel").innerHTML="期間",dojo.byId("searchCondRange").innerHTML=teasp.util.date.formatDate(this.localObj.param.startDate,"SLA")+"～"+teasp.util.date.formatDate(this.localObj.param.endDate,"SLA")):(dojo.byId("searchCondRangeLabel").innerHTML="月度",dojo.byId("searchCondRange").innerHTML=Math.floor(
this.localObj.param.month/100)+"年"+this.localObj.param.month%100+"月度 （ "+teasp.util.date.formatDate(this.localObj.param.startDate,"SLA")+"～"+teasp.util.date.formatDate(this.localObj.param.endDate,"SLA")+" ）"),"");for(S in"-1"==this.localObj.param.deptId?dojo.byId("searchCondDept").innerHTML=s="（部署未設定）":dojo.byId("searchCondDept").innerHTML=s=this.localObj.param.deptName||"",0<this.localObj.param.empIdList.length?(
dojo.style("searchCondEmpRow","display",""),dojo.byId("searchCondEmp").innerHTML=this.getSearchEmpName(this.localObj.param.empIdList,this.printFlag).truncateTailInWidth(300,dojo.byId("ruler1"))):dojo.style("searchCondEmpRow","display","none"),this.printFlag||(dojo.style("searchCancel","display",""),dojo.style("shiftCsvImport2","display","none"),dojo.style("inputCondition","display","none"),dojo.style(
"searchCondition","display",""),dojo.style("shiftImportToolDL","display","none")),this.eventDayCells)this.eventDayCells.hasOwnProperty(S)&&(dojo.disconnect(this.eventDayCells[S]),delete this.eventDayCells[S]);var i=dojo.byId("baseDiv");dojo.empty(i);var n=(L=0<this.deptKeys.length?this.deptKeys[0]:null)&&0<this.localObj.deptMap[L].length?this.localObj.deptMap[L][0]:null,r=this.localObj.param.deptId||"(null)",H=0,
l=this.localObj.param.deptId,p=(l&&"-"!=l&&"-1"!=l||(l=this.deptKeys[0]),dojo.create("table",{className:"shiftTable",id:"shiftTable",style:"width:100%;"},i)),d=dojo.create("thead",null,p),c=dojo.create("tbody",null,p),p=(this.printFlag||(dojo.style(d,"display","block"),dojo.style(c,"display","block"),dojo.style(c,"overflow-y","scroll"),dojo.style(c,"overflow-x","hidden")),this.scrollHandle=dojo.connect(c,"onscroll",
this,function(e){dojo.style(dojo.query("#shiftTable span.first-dept-name")[0],"display",this.firstDeptHeight&&e.target.scrollTop>this.firstDeptHeight?"none":"")}),R=dojo.create("tr",null,d),(n&&n.DeptId__r&&n.DeptId__r.Name||"")==s?s:""),m=(this.localObj.param.deptId&&"-1"!=this.localObj.param.deptId||!n||!n.DeptId__r||(p=n.DeptId__r.Name),dojo.create("span",{innerHTML:p,className:"first-dept-name"},dojo.create("div"
,{style:{width:"100px",fontSize:"0.9em"}},dojo.create("td",{rowSpan:3,className:"whiteCell",style:"vertical-align:bottom;text-align:left;border-bottom:1px solid #6393B7;word-break:break-all;"},R))),null);for(N=0;N<this.localObj.dateList.length;N++){var h=this.localObj.dateList[N],u=teasp.util.date.parseDate(h),P=m&&m.getMonth()==u.getMonth()?u.getDate():u.getMonth()+1+"/"+u.getDate(),m=u,g=dojo.create("td",{
id:"dd"+h,className:"dayCell "+(N%2==0?"even":"odd"),style:{height:"15px"}},R);dojo.create("div",{innerHTML:P},g)}for(N=0;N<this.sumColumns.length;N++){var y=this.sumColumns[N];g=dojo.create("td",{id:y.headId,rowSpan:3,className:y.headClassName+" sumCell",style:"text-align:center;vertical-align:top;min-width:30px;"},R),y.holiday&&(O=y.holiday.Symbol__c||y.holiday.Name.substring(0,1),dojo.create("div",{
className:"holyIcon dayDiv",style:{marginLeft:"auto",marginRight:"auto"},innerHTML:O},g)),dojo.create("div",{innerHTML:y.name,style:"width:20px;margin:2px auto;word-break:break-all;max-height:160px;overflow:hidden;"},g)}for(N=0;N<this.localObj.patterns.length;N++)(A=this.localObj.patterns[N].pattern)?(g=dojo.create("td",{rowSpan:3,className:"sumHoriz2Cell sumCell",
style:"text-align:center;vertical-align:top;min-width:30px;"},R),O=A.Symbol__c||A.Name.substring(0,1),dojo.create("div",{className:"pattern dayDiv",style:{marginLeft:"auto",marginRight:"auto"},innerHTML:O},g),dojo.create("div",{innerHTML:A.Name,style:"width:20px;margin:2px auto;word-break:break-all;max-height:160px;overflow:hidden;"},g)):(g=dojo.create("td",{rowSpan:3,className:"sumHoriz2Cell sumCell",style:{
textAlign:"center",verticalAlign:"top"}},R),this.normalPatternSymbol&&dojo.create("div",{className:"pattern dayDiv",style:{marginLeft:"auto",marginRight:"auto"},innerHTML:this.normalPatternSymbol},g),dojo.create("div",{innerHTML:"通常勤務",style:{width:"20px",margin:"2px auto"}},g));for(dojo.create("div",{style:"width:"+this.scrollW+"px"},dojo.create("td",{rowSpan:3,style:"width:"+this.scrollW+"px"},R)),R=dojo.create(
"tr",null,d),N=0;N<this.localObj.dateList.length;N++){var h=this.localObj.dateList[N],f=(g=dojo.create("td",{id:"wd"+h,className:"dayCell "+(N%2==0?"even":"odd"),style:{height:"15px"}},R),teasp.util.date.parseDate(h)),b={};0==f.getDay()?b.color="red":6==f.getDay()&&(b.color="blue"),dojo.create("div",{innerHTML:teasp.util.date.formatDate(h,"JPW"),style:b},g)}for(R=dojo.create("tr",null,d),
N=0;N<this.localObj.dateList.length;N++){var _,v,h=this.localObj.dateList[N],T=[],j=[];this.localObj.events[h]&&(T.push('<span style="color:#8b0000;">'+this.localObj.events[h]+"</span>"),j.push(this.localObj.events[h])),this.localObj.deptEvents[r]&&this.localObj.deptEvents[r].days[h]&&this.localObj.deptEvents[r].days[h].event&&(T.push('<span style="color:#2e8b57;">'+this.localObj.deptEvents[r].days[h].event+"</span>"
),j.push(this.localObj.deptEvents[r].days[h].event)),this.localObj.deptEvents[r]&&this.localObj.deptEvents[r].days[h]&&this.localObj.deptEvents[r].days[h].note&&(T.push('<span style="color:#00008b;">'+this.localObj.deptEvents[r].days[h].note+"</span>"),j.push(this.localObj.deptEvents[r].days[h].note)),g=dojo.create("td",{id:"vd"+h,className:"dayCell "+(N%2==0?"even":"odd"),
style:"font-size:0.9em;vertical-align:top;padding:0px;"},R),dojo.byId("displayEvent").checked?(this.localObj.pubEvents[h]&&T.unshift(this.localObj.pubEvents[h]),_=T.join(teasp.message.getLabel("tm10001470")),v=j.join(teasp.message.getLabel("tm10001470")+"\n"),dojo.create("div",{style:"min-height:10px;max-height:150px;vertical-align:top;display:block;word-break:break-all;overflow:hidden;",className:"event-text",
innerHTML:_,title:v},g)):(_=T.join(teasp.message.getLabel("tm10001470")),v=j.join(teasp.message.getLabel("tm10001470")+"\n"),this.localObj.pubEvents[h]&&dojo.create("div",{className:"pp_base pp_btn_naholy",style:{margin:"1px auto"},title:this.localObj.pubEvents[h]},g),_&&dojo.create("div",{className:"pp_base pp_shift_event",style:{margin:"1px auto"},title:v},g))}for(var E=0;E<this.deptKeys.length;E++){
var L=this.deptKeys[E],k=this.localObj.deptMap[L];if(L!=l){for(R=dojo.create("tr",null,c),dojo.create("div",{innerHTML:k[0].DeptId__r&&k[0].DeptId__r.Name||"",style:"width:100px;font-size:0.9em;word-break:break-all;"},dojo.create("td",{style:"vertical-align:bottom;text-align:left;",className:"whiteCell"},R)),N=0;N<this.localObj.dateList.length;N++){h=this.localObj.dateList[N];g=dojo.create("td",{id:"xd"+h,
className:"dayCell "+(N%2==0?"even":"odd"),style:{borderLeft:"1px dashed #6393B7",borderRight:"1px dashed #6393B7"}},R),dojo.create("div",{style:{width:"24px",height:"40px"}},g)}for(N=0;N<this.sumColumns.length;N++)dojo.create("div",{style:{width:"24px",height:"40px"}},dojo.create("td",{className:"cell sumCell",style:{borderLeft:"1px dashed #6393B7",borderRight:"1px dashed #6393B7"}},R));for(
N=0;N<this.localObj.patterns.length;N++)dojo.create("div",{style:{width:"24px",height:"40px"}},dojo.create("td",{className:"cell sumCell",style:{borderLeft:"1px dashed #6393B7",borderRight:"1px dashed #6393B7"}},R))}for(e=0;e<k.length;e++){for(n=k[e],this.localObj.empIdIndex[n.Id]=H++,R=dojo.create("tr",null,c),g=dojo.create("td",{id:"emp"+n.Id,className:"name empCell"},R),
n.UserId__r&&n.UserId__r.SmallPhotoUrl&&dojo.create("img",{src:n.UserId__r.SmallPhotoUrl,style:{float:"left",margin:"1px"},className:"dayDiv",width:"30px",height:"30px"},g),dojo.create("div",{innerHTML:n.Title__c||"",className:"dayDiv empTitle",style:"margin:1px;font-size:0.8em;white-space:normal;word-break:break-all;"},g),dojo.create("div",{innerHTML:n.EmpCode__c||"",className:"dayDiv",
style:"margin:1px;font-size:0.8em;white-space:normal;word-break:break-all;"},g),dojo.create("div",{innerHTML:n.Name,className:"dayDiv",style:"margin:2px 4px;word-break:break-all;"},g),N=0;N<this.localObj.dateList.length;N++){var D,I,h=this.localObj.dateList[N],u=n.days[h],A=null;if(g=dojo.create("td",{id:(u.fix||!u.editable?"xd":"ed")+h+n.Id,className:"dayCell "+(!u.fix&&u.editable||this.printFlag?"":"disableCell "
)+(N%2==0?"even":"odd"),style:"min-width:30px;height:30px;vertical-align:top;"},R),this.eventDayCells[h+n.Id]=dojo.connect(g,"ondblclick",this,function(){var e=g,t=n,a=h;return function(){o.empDayDialog.setEmpDay(t,a,this.normalPatternSymbol),dijit.popup.open({popup:o.empDayDialog.getDialog(),around:e})}}()),u.decrees.patternS&&!this.printFlag&&(g.style.textAlign="center",I=dojo.create("div",{style:{
marginLeft:"auto",marginRight:"auto",display:"table"}},g),u.decrees.patternS.Removed__c||dojo.create("div",{className:"pp_base pp_shift_done",style:{margin:"1px auto",float:u.temporary?"left":"none"}},I),u.temporary&&dojo.create("div",{className:"pp_base pp_shift_temp_pin",style:{margin:"1px",float:"left"},title:u.Removed__c?"仮削除状態":"仮登録状態"},I)),!this.printFlag)for(var S in u.applys)if(u.applys.hasOwnProperty(S)){
var x=u.applys[S];if(dojo.isArray(x))for(var w=0;w<x.length;w++)dojo.create("div",{className:"pp_base pp_ap_"+teasp.view.Shift.getApplyStyleKey(S)+teasp.constant.getStatusStyleSuffix(x[w].Status__c),style:{float:"left"}},g);else x.Decree__c&&x.ApplyType__c!=teasp.constant.APPLY_TYPE_HOLIDAY||dojo.create("div",{className:"pp_base pp_ap_"+teasp.view.Shift.getApplyStyleKey(S)+teasp.constant.getStatusStyleSuffix(
x.Status__c),style:{float:"left"}},g)}u.dayType==teasp.constant.DAY_TYPE_NORMAL_HOLIDAY||u.dayType==teasp.constant.DAY_TYPE_PUBLIC_HOLIDAY?(g.style.backgroundColor=teasp.constant.NORMAL_HOLIDAY_COLOR,this.printFlag&&dojo.create("div",{className:"printDayType",style:{float:"left",color:"blue"},innerHTML:u.dayType==teasp.constant.DAY_TYPE_PUBLIC_HOLIDAY?"(祝日)":"(所休)"},g)
):u.dayType==teasp.constant.DAY_TYPE_LEGAL_HOLIDAY?(g.style.backgroundColor=teasp.constant.LEGAL_HOLIDAY_COLOR,this.printFlag&&dojo.create("div",{className:"printDayType",style:{float:"left",color:"red"},innerHTML:"(法休)"},g)):(D=u.applys.holidayAll||u.applys.holidayAm&&u.applys.holidayPm,u.plannedHoliday&&!u.applys.kyushtu?(g.style.backgroundColor=teasp.constant.PRIVATE_HOLIDAY_COLOR,this.printFlag&&dojo.create("div"
,{className:"printDayType",style:{float:"left"},innerHTML:"[休暇]"},g)):D?(g.style.backgroundColor=teasp.constant.PRIVATE_HOLIDAY_COLOR,this.printFlag&&dojo.create("div",{className:"printDayType",style:{float:"left"},innerHTML:"[休暇]"},g),O=u.applys.holidayAll?u.applys.holidayAll.HolidayId__r.Symbol__c||u.applys.holidayAll.HolidayId__r.Name.substring(0,1):(
O=u.applys.holidayAm.HolidayId__r.Symbol__c||u.applys.holidayAm.HolidayId__r.Name.substring(0,1),dojo.create("div",{className:"holyIcon dayDiv",style:{float:"left"},innerHTML:O},g),u.applys.holidayPm.HolidayId__r.Symbol__c||u.applys.holidayPm.HolidayId__r.Name.substring(0,1)),dojo.create("div",{className:"holyIcon dayDiv",style:{float:"left"},innerHTML:O},g)):(this.printFlag&&(u.applys.holidayAm?dojo.create("div",{
className:"printDayType",style:{float:"left"},innerHTML:"[午前休]"},g):u.applys.holidayPm&&dojo.create("div",{className:"printDayType",style:{float:"left"},innerHTML:"[午後休]"},g)),u.applys.holidayAm?(O=u.applys.holidayAm.HolidayId__r.Symbol__c||u.applys.holidayAm.HolidayId__r.Name.substring(0,1),dojo.create("div",{className:"holyIcon dayDiv",style:{float:"left"},innerHTML:O},g)):u.applys.holidayPm&&(
O=u.applys.holidayPm.HolidayId__r.Symbol__c||u.applys.holidayPm.HolidayId__r.Name.substring(0,1),dojo.create("div",{className:"holyIcon dayDiv",style:{float:"left"},innerHTML:O},g)),u.pattern?(A=u.pattern,O=u.pattern.Symbol__c||u.pattern.Name.substring(0,1),dojo.create("div",{className:"pattern dayDiv",style:{float:"left"},innerHTML:O},g)):(A=n.empType.days[h].config,this.normalPatternSymbol&&dojo.create("div",{
className:"pattern dayDiv",style:{float:"left"},innerHTML:this.normalPatternSymbol},g)),u.workPlace&&u.workPlace.Id!=n.DeptId__c&&(O=u.workPlace.Symbol__c||u.workPlace.Name.substring(0,1),dojo.create("div",{className:"workPlace dayDiv",style:{float:"left"},innerHTML:O},g),t[u.workPlace.Id]=u.workPlace))),A&&(dojo.create("div",{style:{clear:"left"}},g),D=teasp.util.time.timeValue(A.StdStartTime__c
)+" -<br/>"+teasp.util.time.timeValue(A.StdEndTime__c),I=dojo.create("div",{innerHTML:D,className:"dayTime",style:{whiteSpace:"nowrap",fontSize:"10px",fontFamily:"sans-serif",margin:"0px"}},g),dojo.style(I,"display",a?"":"none"))}for(N=0;N<this.sumColumns.length;N++){y=this.sumColumns[N];dojo.create("div",{innerHTML:n.countDays[y.headId]||"",style:"white-space:nowrap;margin-right:2px;word-break:break-all;"},
dojo.create("td",{className:"cell sumCell",style:"min-width:30px;text-align:center;vertical-align:middle"},R))}for(N=0;N<this.localObj.patterns.length;N++){var A=this.localObj.patterns[N].pattern,M=(g=dojo.create("td",{className:"cell sumCell",style:"min-width:30px;text-align:center;vertical-align:middle"},R),n.countDays[A?A.Id:"(null)"]);dojo.create("div",{innerHTML:""+(M||""),
style:"white-space:nowrap;margin-right:2px;word-break:break-all;"},g)}}}if(this.localObj.param.deptId){for(R=dojo.create("tr",null,c),dojo.create("div",{innerHTML:("-1"==this.localObj.param.deptId?"（部署未設定）":this.localObj.param.deptName||"")+"集計",style:"width:100px;font-size:0.9em;word-break:break-all;"},dojo.create("td",{style:"vertical-align:bottom;text-align:left;",className:"whiteCell"},R)),
N=0;N<this.localObj.dateList.length;N++)g=dojo.create("td",{style:"border-left:1px dashed #6393B7;border-right:1px dashed #6393B7;height:50px;",className:"dayCell"},R);for(N=0;N<this.sumColumns.length;N++)dojo.create("td",{className:"sumCell"},R);for(N=0;N<this.localObj.patterns.length;N++)dojo.create("td",{className:"sumCell"},R);for(e=0;e<this.localObj.patterns.length;e++){for(var O,
A=this.localObj.patterns[e].pattern,R=dojo.create("tr",null,c),C=(g=dojo.create("td",{className:"sumHoriz2Cell whiteCell",style:{textAlign:"left",verticalAlign:"middle"}},R),A?(O=A.Symbol__c||A.Name.substring(0,1),dojo.create("div",{className:"pattern",style:{float:"left"},innerHTML:O},g),dojo.create("div",{innerHTML:A.Name,style:"float:left;margin:2px;word-break:break-all;"},g)):(
this.normalPatternSymbol&&dojo.create("div",{className:"pattern",style:{float:"left"},innerHTML:this.normalPatternSymbol},g),dojo.create("div",{innerHTML:"通常勤務",style:{float:"left",margin:"2px"}},g)),this.localObj.countDays[this.localObj.param.deptId||"(null)"]||{}),N=0;N<this.localObj.dateList.length;N++){h=this.localObj.dateList[N],M=(g=dojo.create("td",{id:"bd"+h,className:"dayCell "+(N%2==0?"even":"odd"),
style:"border:1px solid #6393B7;min-width:30px;height:16px;text-align:center;vertical-align:middle;"},R),(C[h]||{})[A?A.Id:"(null)"]);dojo.create("div",{innerHTML:""+(M||""),style:{whiteSpace:"nowrap",marginRight:"2px"}},g)}for(N=0;N<this.sumColumns.length;N++)dojo.create("td",{className:"sumCell",style:"min-width:30px;"},R);for(N=0;N<this.localObj.patterns.length;N++)dojo.create("td",{className:"sumCell",
style:"min-width:30px;"},R)}}this.createExplanation(i,t),this.printFlag||(dojo.byId("shiftTable").onmouseup=function(e){return o.mouseUp(this,e),!1},dojo.query(".dayCell").forEach(function(e){e.onmousedown=function(e){return o.mouseDown(this,e),!1},e.onmousemove=function(e){return o.mouseMoveCell(this,e),!1}}),dojo.query("tbody .empCell").forEach(function(e){e.onmousedown=function(e){return o.mouseDown(this,e),!1},
e.onmousemove=function(e){return o.mouseMoveCell(this,e),!1}}),dojo.query(".dayDiv").forEach(function(e){e.onmousedown=function(e){return o.mouseDown(this,e),!1},e.onmousemove=function(e){return o.mouseMoveCell(this,e),!1}}),dijit.popup.close(this.empSelectDialog.getDialog()),dojo.style("changeRealSave","display",0<this.temporaryShiftId.length?"":"none")),this.resizeArea(),setTimeout(dojo.hitch(this,function(){
this.resizeWidth()}),100),this.returnScrollTop(),this.closeBusyWait(),this.initMenuEnable()},teasp.view.Shift.prototype.createExplanation=function(e,t){this.largeSymbolFlag=!1;var e=dojo.create("div",{id:"shiftLegend",style:"border:1px solid #6393B7;padding:5px 10px;margin-top:5px;text-align:left;vertical-align:top;display:none;"},e),a=dojo.create("tbody",null,dojo.create("table",{className:"pane_table"},e)),
o=dojo.create("td",null,dojo.create("tr",null,a)),s=(dojo.create("div",{innerHTML:"<<凡例>>",style:{float:"left",margin:"2px 12px 2px 0px"}},o),a=dojo.create("tbody",null,dojo.create("table",{className:"explana"},o)),dojo.create("tr",null,a)),i=dojo.create("div",{style:{height:"16px",border:"1px solid #6393B7"}},dojo.create("td",null,s));i.style.backgroundColor=teasp.constant.NORMAL_HOLIDAY_COLOR,
this.printFlag?dojo.create("div",{className:"printDayType",style:{color:"blue"},innerHTML:"(所休)"},i):i.style.width="18px",i=dojo.create("div",{innerHTML:"所定休日"},dojo.create("td",null,s)),this.printFlag||(i.innerHTML+="(含祝日)"),a=dojo.create("tbody",null,dojo.create("table",{className:"explana"},o)),s=dojo.create("tr",null,a),(i=dojo.create("div",{style:{height:"16px",border:"1px solid #6393B7"}},dojo.create("td",null,
s))).style.backgroundColor=teasp.constant.LEGAL_HOLIDAY_COLOR,this.printFlag?dojo.create("div",{className:"printDayType",style:{color:"red"},innerHTML:"(法休)"},i):i.style.width="18px",i=dojo.create("div",{innerHTML:"法定休日"},dojo.create("td",null,s)),a=dojo.create("tbody",null,dojo.create("table",{className:"explana"},o)),s=dojo.create("tr",null,a),(i=dojo.create("div",{style:{height:"16px",border:"1px solid #6393B7"}},
dojo.create("td",null,s))).style.backgroundColor=teasp.constant.PRIVATE_HOLIDAY_COLOR,this.printFlag?dojo.create("div",{className:"printDayType",style:{color:"black"},innerHTML:"[休暇]"},i):i.style.width="18px",i=dojo.create("div",{innerHTML:"終日の休暇"},dojo.create("td",null,s)),this.printFlag||(a=dojo.create("tbody",null,dojo.create("table",{className:"explana"},o)),s=dojo.create("tr",null,a),dojo.create("div",{
className:"pp_base pp_shift_done",style:{margin:"1px"}},dojo.create("td",null,s)),dojo.create("div",{innerHTML:"シフト設定済み"},dojo.create("td",null,s)),a=dojo.create("tbody",null,dojo.create("table",{className:"explana"},o)),s=dojo.create("tr",null,a),dojo.create("div",{className:"pp_base pp_shift_temp_pin",style:{margin:"1px"}},dojo.create("td",null,s)),dojo.create("div",{innerHTML:"仮登録"},dojo.create("td",null,s)),
a=dojo.create("tbody",null,dojo.create("table",{className:"explana",style:{float:"none"}},o)),s=dojo.create("tr",null,a),dojo.create("div",{className:"disableCell",style:{width:"20px",height:"16px",border:"1px solid #6393B7"}},dojo.create("td",null,s)),dojo.create("div",{innerHTML:"勤務確定済みまたは編集不可"},dojo.create("td",null,s))),dojo.create("div",{style:{clear:"left"}},o),this.normalPatternSymbol&&(a=dojo.create("tbody",
null,dojo.create("table",{className:"explana"},o)),s=dojo.create("tr",null,a),dojo.create("div",{className:"pattern",innerHTML:this.normalPatternSymbol},dojo.create("td",null,s)),dojo.create("div",{innerHTML:"通常勤務(始業・終業時刻は勤務体系毎に異なります)"},dojo.create("td",null,s)));for(var n,r,l=0;l<this.localObj.patterns.length;l++){var p=this.localObj.patterns[l].pattern;if(p){for(var a=dojo.create("tbody",null,dojo.create("table",{
className:"explana"},o)),s=dojo.create("tr",null,a),d=p.Symbol__c||p.Name.substring(0,1),c=(!this.largeSymbolFlag&&2<d.length&&(this.largeSymbolFlag=!0),dojo.create("div",{className:"pattern",innerHTML:d},dojo.create("td",null,s)),dojo.create("div",{innerHTML:p.Name,style:"white-space:normal;word-break:break-all;"},dojo.create("td",null,s)),teasp.util.time.timeValue(p.StdStartTime__c)+"～"+teasp.util.time.timeValue(
p.StdEndTime__c)),m=(dojo.create("div",{innerHTML:c},dojo.create("td",null,s)),p.RestTimes__c&&0<p.RestTimes__c.length?p.RestTimes__c.split(/,/):[]),h=[],u=0;u<m.length;u++){var g=/(\d+)\-(\d+)/.exec(m[u]);g&&h.push(teasp.util.time.timeValue(g[1])+"～"+teasp.util.time.timeValue(g[2]))}dojo.create("div",{innerHTML:"(休憩："+(0<h.length?h.join(", "):"なし")+")",style:"white-space:normal;"},dojo.create("td",null,s)),
p.UseDiscretionary__c&&dojo.create("div",{innerHTML:" (裁量)"},dojo.create("td",null,s))}}for(0<l&&dojo.create("div",{style:{clear:"left"}},o),l=0;l<this.localObj.holidays.length;l++){var y=this.localObj.holidays[l].holiday;y&&(a=dojo.create("tbody",null,dojo.create("table",{className:"explana"},o)),s=dojo.create("tr",null,a),d=y.Symbol__c||y.Name.substring(0,1),!this.largeSymbolFlag&&2<d.length&&(
this.largeSymbolFlag=!0),dojo.create("div",{className:"holyIcon",innerHTML:d},dojo.create("td",null,s)),dojo.create("div",{innerHTML:y.Name},dojo.create("td",null,s)))}for(n in 0<l&&dojo.create("div",{style:{clear:"left"}},o),l=0,t)t.hasOwnProperty(n)&&(r=t[n],a=dojo.create("tbody",null,dojo.create("table",{className:"explana"},o)),s=dojo.create("tr",null,a),d=r.Symbol__c||r.Name.substring(0,1),
!this.largeSymbolFlag&&2<d.length&&(this.largeSymbolFlag=!0),dojo.create("div",{className:"workPlace",innerHTML:d},dojo.create("td",null,s)),dojo.create("div",{innerHTML:(r.DeptCode__c?r.DeptCode__c+"-":"")+r.Name},dojo.create("td",null,s)),l++);if(0<l&&dojo.create("div",{style:{clear:"left"}},o),!this.printFlag){for(var f=[{name:"休暇申請",style:"kyun"},{name:"休暇申請(時間単位)",style:"kyut"},{name:"勤務時間変更申請(短期)",style:"pats"}
,{name:"直行・直帰申請",style:"patl"},{name:"休日出勤申請",style:"hwrk"},{name:"振替申請",style:"exch"}],l=0;l<f.length;l++){var b=f[l];a=dojo.create("tbody",null,dojo.create("table",{className:"explana"},o)),s=dojo.create("tr",null,a),dojo.create("div",{className:"pp_base pp_ap_"+b.style+"_up",style:{marginTop:"2px"}},dojo.create("td",{style:{padding:"1px"}},s)),dojo.create("div",{className:"pp_base pp_ap_"+b.style+"_ok",style:{
marginTop:"2px"}},dojo.create("td",{style:{padding:"1px"}},s)),dojo.create("div",{innerHTML:b.name},dojo.create("td",null,s))}a=dojo.create("tbody",null,dojo.create("table",{className:"explana"},o)),s=dojo.create("tr",null,a),dojo.create("div",{innerHTML:"(",style:{fontSize:"0.9em"}},dojo.create("td",null,s)),dojo.create("div",{className:"pp_base pp_ap_revt_up",style:{marginTop:"2px"}},dojo.create("td",{style:{
padding:"0px"}},s)),dojo.create("div",{innerHTML:"=承認待ち ",style:{fontSize:"0.9em"}},dojo.create("td",null,s)),dojo.create("div",{className:"pp_base pp_ap_revt_ok",style:{marginTop:"2px"}},dojo.create("td",{style:{padding:"0px"}},s)),dojo.create("div",{innerHTML:"=承認済み )",style:{fontSize:"0.9em"}},dojo.create("td",null,s)),dojo.create("div",{style:{clear:"left"}},o)}dojo.style(e,"display",dojo.byId("displayLegend"
).checked?"":"none")},teasp.view.Shift.prototype.mouseDown=function(e,t){2!=(t=t||window.event).button&&(this.startCell=t.srcElement||t.target,"DIV"!=this.startCell.tagName&&"IMG"!=this.startCell.tagName||(this.startCell=this.startCell.parentNode),"TD"!=this.startCell.tagName?this.startCell=null:this.mouseMoveCell(e,t))},teasp.view.Shift.prototype.mouseUp=function(e,t){t=(t=t||window.event).srcElement||t.target;if(
"TD"!=(t="DIV"!=t.tagName&&"IMG"!=t.tagName?t:t.parentNode).tagName||!this.startCell)return!1;this.startCell=null},teasp.view.Shift.prototype.mouseMoveCell=function(e,t){if(t=t||window.event,this.startCell){var o=t.ctrlKey&&!t.metaKey||!t.ctrlKey&&t.metaKey,t=t.srcElement||t.target;if("TD"!=(t="DIV"!=t.tagName&&"IMG"!=t.tagName?t:t.parentNode).tagName||!this.startCell)return!1;var a,s,i,n,r,l,p,d,c,m,
h=this.startCell.id.substring(0,3),u=t.id.substring(0,3);"ed2"==h&&"ed2"==u?(n=this.startCell.id.substring(2,12),r=t.id.substring(2,12),s=this.localObj.empIdIndex[this.startCell.id.substring(12)],i=this.localObj.empIdIndex[t.id.substring(12)],r<n&&(l=n,n=r,r=l),i<s&&(a=s,s=i,i=a),dojo.query(".dayCell").forEach(function(e){var t,a;/^[dwveb]d2/.test(e.id.substring(0,3))&&(t=e.id.substring(2,12),
a=this.localObj.empIdIndex[e.id.substring(12)],n<=t&&t<=r&&s<=a&&a<=i?dojo.addClass(e,"selCell"):o||dojo.removeClass(e,"selCell"))},this),dojo.query("tbody .empCell").forEach(function(e){dojo.removeClass(e,"selCell")},this),this.setMenuEnable(0,!0)):/^[dwveb]d2/.test(h)&&/^[dwveb]d2/.test(u)?(n=this.startCell.id.substring(2,12),(r=t.id.substring(2,12))<n&&(l=n,n=r,r=l),dojo.query(".dayCell").forEach(function(e){var t
;/^[dwveb]d2/.test(e.id.substring(0,3))&&(t=e.id.substring(2,12),n<=t&&t<=r?dojo.addClass(e,"selCell"):o||dojo.removeClass(e,"selCell"))},this),dojo.query("tbody .empCell").forEach(function(e){dojo.removeClass(e,"selCell")},this),this.setMenuEnable(0,!0)):"emp"==h&&"emp"==u&&(p=0,o&&(dojo.query(".dayCell").forEach(function(e){dojo.hasClass(e,"selCell")&&p++},this),0<p)||(d=0,
c=this.localObj.empIdIndex[this.startCell.id.substring(3)],m=this.localObj.empIdIndex[t.id.substring(3)],dojo.query("tbody .empCell").forEach(function(e){var t=this.localObj.empIdIndex[e.id.substring(3)];c<=t&&t<=m?(dojo.addClass(e,"selCell"),d++):o||dojo.removeClass(e,"selCell")},this),dojo.query(".dayCell").forEach(function(e){dojo.removeClass(e,"selCell")},this),this.setMenuEnable(d,!1)))}},
teasp.view.Shift.prototype.initMenuEnable=function(){this.pMenu.getChildren()[0].setDisabled(!0)},teasp.view.Shift.prototype.setMenuEnable=function(e,t){this.pMenu.getChildren()[0].setDisabled(!(t&&0<(this.localObj.emps||[]).length))},teasp.view.Shift.prototype.openShiftSetting=function(){var a={};dojo.query(".dayCell").forEach(function(e){var t;dojo.hasClass(e,"selCell")&&(
e=/^[dwve]d(\d{4}\-\d{2}\-\d{2})(.+)$/.exec(e.id))&&(t=e[1],e=e[2],a[e]||(a[e]={dateList:[]}),a[e].dateList.push(t))},this),teasp.manager.dialogOpen("ShiftSetting",{target:a,importResultFlag:this.importResultFlag||!1},this.localObj,this,this.updateShift)},teasp.view.Shift.prototype.openSelectDept=function(){dojo.byId("selectDepts").value;teasp.manager.dialogOpen("SelectDept",null,{depts:this.levelDepts,
localObj:this.localObj},this,function(e,t,a,o){e.targetId&&(dojo.byId("selectDepts").value=e.targetId),a&&a.apply(o)})},teasp.view.Shift.prototype.openShiftOutput=function(){teasp.manager.dialogOpen("ShiftOutput",null,this.localObj,this,this.outputShiftCsv)},teasp.view.Shift.prototype.openShiftCsvImport=function(){var e=this.getRangeValue();e&&(this.shiftImport||(this.shiftImport=new teasp.dialog.ShiftCsvImport),
this.shiftImport.open(globalLoadRes.emp,e,dojo.hitch(this,this.showImportResult)))},teasp.view.Shift.prototype.changeImportResultMode=function(e){this.importResultFlag=e;e=dojo.byId(this.printFlag?"shiftPrintMain":"searchCondition");dojo.query(".searchcond_normal",e).forEach(function(e){dojo.style(e,"display",this.importResultFlag?"none":"")},this),dojo.query(".import_result_title",e).forEach(function(e){dojo.style(e
,"display",this.importResultFlag?"":"none")},this)},teasp.view.Shift.prototype.showImportResult=function(e,t){this.changeImportResultMode(!0);e={month:e.month,startDate:e.startDate,endDate:e.endDate,rangeType:e.rangeType,deptId:null,deptOpt:3,empIdList:t};this.reflectRange(e),this.resetScrollTop(),this.searchShiftData(e)},teasp.view.Shift.prototype.reflectRange=function(e){var t,a;this.currentRangeType=e.rangeType,
this.currentRangeType?(t=new Date,dijit.byId("monYear").setValue(t.getFullYear()),dijit.byId("monMonth").setValue(t.getMonth()+1),t=teasp.util.date.parseDate(e.startDate),a=teasp.util.date.parseDate(e.endDate),dijit.byId("startYear").setValue(t.getFullYear()),dijit.byId("startMonth").setValue(t.getMonth()+1),dijit.byId("startDate").setValue(t.getDate()),dijit.byId("endYear").setValue(a.getFullYear()),dijit.byId(
"endMonth").setValue(a.getMonth()+1),dijit.byId("endDate").setValue(a.getDate())):(t=Math.floor(e.month/100),a=e.month%100,dijit.byId("monYear").setValue(t),dijit.byId("monMonth").setValue(a),this.showRangeOfYearMonth())},teasp.view.Shift.prototype.updateShift=function(e,t,a,o){var n="SUMMARY_UNKNOWN",r=[],l={},p=[];this.localObj.updateErrors=[],Object.keys(e.target).forEach(function(t){p.push(t);var o=e.target[t],
s=[],i=(this.localObj.attSummary[t]&&(s=this.localObj.attSummary[t]),{});Object.keys(o).forEach(function(e){for(var t=0;t<s.length;t++){var a=s[t];if(i[a.Id]||(i[a.Id]={}),a.startDate<=e&&e<=a.endDate)return void(i[a.Id][e]=o[e])}i[n]||(i[n]={}),i[n][e]=o[e]}),Object.keys(i).forEach(function(e){e!=n?(l[t]=i[e],r.push(l),l={}):Object.keys(i[n]).forEach(function(e){l[t]={[e]:i[n][e]},r.push(l),l={}})})},this),
Object.keys(l).length&&r.push(l),teasp.manager.dialogOpen("BusyWait"),this.remenberScrollTop(),this.updateShiftLoop(r,0,t,a,o)},teasp.view.Shift.prototype.updateShiftLoop=function(t,a,o,s,i){var e;if(a>=t.length)return console.log("update finish"),console.log(this.localObj.updateErrors),this.searchShiftData(this.localObj.param),this.localObj.updateErrors.length&&(e=this.buildUpdateErrorMessage(
this.localObj.updateErrors),this.showError(e)),void s.apply(i,[]);console.log("update shift "+(a+1)+"/"+t.length),this.contactForUpdate({funcName:"updateShift",params:{target:t[a]},errorAreaId:o},function(e){this.updateShiftLoop(t,++a,o,s,i)},function(e){this.localObj.updateErrors.push(e),this.updateShiftLoop(t,++a,o,s,i)},this)},teasp.view.Shift.prototype.deleteShift=function(){var n="SUMMARY_UNKNOWN",a={},r=[],l={}
this.localObj.updateErrors=[],dojo.query(".dayCell").forEach(function(e){var t;dojo.hasClass(e,"selCell")&&(e=/^[dwve]d(\d{4}\-\d{2}\-\d{2})(.+)$/.exec(e.id))&&(t=e[1],e=e[2],a[e]||(a[e]={}),a[e][t]={patternId:"-",dayType:null})},this),Object.keys(a).forEach(function(t){var o=a[t],s=[],i=(this.localObj.attSummary[t]&&(s=this.localObj.attSummary[t]),{});Object.keys(o).forEach(function(e){for(var t=0;t<s.length;t++){
var a=s[t];if(i[a.Id]||(i[a.Id]={}),a.startDate<=e&&e<=a.endDate)return void(i[a.Id][e]=o[e])}i[n]||(i[n]={}),i[n][e]=o[e]}),Object.keys(i).forEach(function(e){e!=n?(l[t]=i[e],r.push(l),l={}):Object.keys(i[n]).forEach(function(e){l[t]={[e]:i[n][e]},r.push(l),l={}})})},this),Object.keys(l).length&&r.push(l),teasp.tsConfirmA("シフト設定の削除をします。よろしいですか？",this,function(){this.remenberScrollTop(),teasp.manager.dialogOpen(
"BusyWait"),this.deleteShiftLoop(r,0)})},teasp.view.Shift.prototype.deleteShiftLoop=function(t,a){var e;if(a>=t.length)return console.log("delete finished"),console.log(this.localObj.updateErrors),this.searchShiftData(this.localObj.param),void(this.localObj.updateErrors.length&&(e=this.buildUpdateErrorMessage(this.localObj.updateErrors),this.showError(e)));this.contactForUpdate({funcName:"updateShift",params:{
target:t[a]}},function(e){this.deleteShiftLoop(t,++a)},function(e){this.localObj.updateErrors.push(e),this.deleteShiftLoop(t,++a)},!0)},teasp.view.Shift.prototype.buildUpdateErrorMessage=function(t){var a=[];for(let e=0;e<t.length;e++){var o=t[e];Array.prototype.push.apply(a,o.error.message.split("\r\n"))}return a.join("<br/>")},teasp.view.Shift.prototype.updateShiftEvent=function(e,t,a,o){this.contact({
funcName:"updateShiftEvent",params:e,errorAreaId:t},function(e){this.searchShiftData(this.localObj.param),a.apply(o,[e])})},teasp.view.Shift.prototype.saveToReal=function(){teasp.tsConfirmA("仮登録を本登録に変更します。よろしいですか？",this,function(){this.remenberScrollTop();for(var e=[],t=dojo.clone(this.temporaryShiftId);t.length;)e.push(t.splice(0,1e3));teasp.manager.dialogOpen("BusyWait"),this.saveToRealLoop(e,0)})},
teasp.view.Shift.prototype.saveToRealLoop=function(t,a){a>=t.length?this.searchShiftData(this.localObj.param):this.contact({funcName:"updateToReal",params:{applyIds:t[a]}},function(e){this.saveToRealLoop(t,++a)},!0)},teasp.view.Shift.prototype.getEmpIdList=function(){for(var e=[],t=this.localObj.emps||[],a=0;a<t.length;a++)e.push(t[a].Id);return e},teasp.view.Shift.prototype.getEmpById=function(e){for(
var t=this.localObj.emps||[],a=0;a<t.length;a++)if(t[a].Id==e)return t[a];return null},teasp.view.Shift.prototype.getDeptById=function(e){for(var t=this.localObj.depts||[],a=0;a<t.length;a++)if(t[a].Id==e)return t[a];return null},teasp.view.Shift.prototype.searchEmp=function(e,t,a,o){this.contact({funcName:"searchEmp",params:e,errorAreaId:t},function(e){a.apply(o,[e])},!0)},
teasp.view.Shift.prototype.setCahceEmps=function(){var o=this;return function(e){var t=o.cacheEmps;t.map||(t.map={}),e=e||[];for(var a=0;a<e.length;a++)t.map[e[a].Id]=e[a]}},teasp.view.Shift.prototype.getEmpSelected=function(){var a=this;return function(e){var t=a.cacheEmps;return t.select||(t.select={}),!!t.select[e]}},teasp.view.Shift.prototype.createMenu=function(){var e,t=this;this.pMenu=new dijit.Menu({
targetNodeIds:["baseDiv"],style:{fontSize:"12px",zIndex:1e3},refocus:!1}),(e=new dijit.Menu).addChild(new dijit.MenuItem({label:"設定",onClick:function(e){t.openShiftSetting()}})),e.addChild(new dijit.MenuItem({label:"設定の削除",onClick:function(e){t.deleteShift()}})),this.pMenu.addChild(new dijit.PopupMenuItem({label:"シフト",popup:e})),this.pMenu.addChild(new dijit.MenuSeparator),this.pMenu.addChild(new dijit.MenuItem({
label:"キャンセル",onClick:function(e){}})),this.pMenu.startup(),this.initMenuEnable()},teasp.view.Shift.getApplyKey=function(e,t){
return e.ApplyType__c==teasp.constant.APPLY_TYPE_HOLIDAY?e.HolidayId__r.Range__c==teasp.constant.RANGE_ALL?teasp.constant.APPLY_KEY_HOLIDAY_ALL:e.HolidayId__r.Range__c==teasp.constant.RANGE_AM?teasp.constant.APPLY_KEY_HOLIDAY_AM:e.HolidayId__r.Range__c==teasp.constant.RANGE_PM?teasp.constant.APPLY_KEY_HOLIDAY_PM:e.HolidayId__r.Range__c==teasp.constant.RANGE_TIME?teasp.constant.APPLY_KEY_HOLIDAY_TIME:void 0:e.ApplyType__c==teasp.constant.APPLY_TYPE_ZANGYO?teasp.constant.APPLY_KEY_ZANGYO:e.ApplyType__c==teasp.constant.APPLY_TYPE_DIRECT?teasp.constant.APPLY_KEY_DIRECT:e.ApplyType__c==teasp.constant.APPLY_TYPE_EARLYSTART?teasp.constant.APPLY_KEY_EARLYSTART:e.ApplyType__c==teasp.constant.APPLY_TYPE_KYUSHTU?teasp.constant.APPLY_KEY_KYUSHTU:e.ApplyType__c==teasp.constant.APPLY_TYPE_PATTERNS?teasp.constant.APPLY_KEY_PATTERNS:e.ApplyType__c==teasp.constant.APPLY_TYPE_PATTERNL?teasp.constant.APPLY_KEY_PATTERNL:e.ApplyType__c==teasp.constant.APPLY_TYPE_LATESTART?teasp.constant.APPLY_KEY_LATESTART:e.ApplyType__c==teasp.constant.APPLY_TYPE_EARLYEND?teasp.constant.APPLY_KEY_EARLYEND:e.ApplyType__c==teasp.constant.APPLY_TYPE_DAILY?teasp.constant.APPLY_KEY_DAILY:e.ApplyType__c==teasp.constant.APPLY_TYPE_EXCHANGE?e.startDate==t?teasp.constant.APPLY_KEY_EXCHANGES:teasp.constant.APPLY_KEY_EXCHANGEE:void 0
},teasp.view.Shift.setApplyToDayObj=function(e,t,a){var o;t==teasp.constant.APPLY_KEY_HOLIDAY||t==teasp.constant.APPLY_KEY_HOLIDAY_TIME||t==teasp.constant.APPLY_KEY_ZANGYO||t==teasp.constant.APPLY_KEY_EARLYSTART||t==teasp.constant.APPLY_KEY_KYUSHTU?(e[t]||(e[t]=[]),e[t].push(a),1<e[t].length&&(e[t]=e[t].sort(function(e,t){return e.ApplyTime__c<t.ApplyTime__c?1:e.ApplyTime__c>t.ApplyTime__c?-1:0}))
):t==teasp.constant.APPLY_KEY_PATTERNS&&e[t]?((o=[]).push(e[t]),(o=o.concat(e[t].orgs||[])).push(a),o=o.sort(function(e,t){return e.TempFlag__c!=t.TempFlag__c?e.TempFlag__c&&!t.TempFlag__c?-1:1:e.Removed__c!=t.Removed__c?!e.Removed__c&&t.Removed__c?-1:1:0}),e[t]=o.shift(),e[t].orgs=o):e[t]=a},teasp.view.Shift.getApplyStyleKey=function(e){switch(e){case teasp.constant.APPLY_KEY_DIRECT:return"patl";
case teasp.constant.APPLY_KEY_PATTERNS:return"pats";case teasp.constant.APPLY_KEY_EXCHANGES:case teasp.constant.APPLY_KEY_EXCHANGEE:return"exch";case teasp.constant.APPLY_KEY_HOLIDAY_ALL:case teasp.constant.APPLY_KEY_HOLIDAY_AM:case teasp.constant.APPLY_KEY_HOLIDAY_PM:return"kyun";case teasp.constant.APPLY_KEY_HOLIDAY_TIME:return"kyut";case teasp.constant.APPLY_KEY_KYUSHTU:return"hwrk";
case teasp.constant.APPLY_KEY_ZANGYO:return"zanw";case teasp.constant.APPLY_KEY_EARLYSTART:return"east";case teasp.constant.APPLY_KEY_LATESTART:return"late";case teasp.constant.APPLY_KEY_EARLYEND:return"earl";case teasp.constant.APPLY_KEY_DAILY:return"day"}return""},teasp.view.Shift.getValidApplys=function(e){var t,a,o={};for(t in e)e.hasOwnProperty(t)&&(a=e[t],is_array(a
)&&0<a.length?t==teasp.constant.APPLY_KEY_HOLIDAY_TIME?o[t]=a:o[t]=a[0]:a&&(o[t]=a));return o},teasp.view.Shift.getPatternByDate=function(e,t){for(var a=0;a<e.length;a++){var o=e[a];if("1"==o.SchedOption__c){var s=""+t.getDay();if(0<=o.SchedWeekly__c.indexOf(s))return o}else if("2"==o.SchedOption__c){var i=parseInt(o.SchedMonthlyDate__c,10);if((i=32==i?teasp.util.date.getMonthEndDay(t.getFullYear(),t.getMonth()+1):i
)==t.getDate())return o}else if("3"==o.SchedOption__c){var i=parseInt(o.SchedMonthlyLine__c,10),n=Math.floor((t.getDate()+6)/7),s=(5==i&&(i=(teasp.util.date.getMonthEndDay(t.getFullYear(),t.getMonth()+1)+6)/7),""+t.getDay());if(n==i&&o.SchedMonthlyWeek__c==s)return o}}return null},teasp.view.Shift.processingDepts=function(e,t,a){for(var o,s,i={},n=(e=e.filter(
e=>e.ParentChild_ValidFrom__c<=t&&t<e.ParentChild_ValidTo__c)).length-1;0<=n;n--)(o=e[n]).past=o.EndDate__c&&o.EndDate__c<=t,o.future=o.StartDate__c&&a<o.StartDate__c,(i[o.Id]=o).DeptCode__c=o.DeptCode__c||o.Code__c||"";for(n=0;n<e.length;n++)(o=e[n]).ParentId__c&&((s=i[o.ParentId__c])&&!s.past&&!s.future||(s?(o.past=s.past,o.future=s.future):o.past=!0));return e=e.sort(function(e,t){
return e.DeptCode__c<t.DeptCode__c?-1:e.DeptCode__c>t.DeptCode__c?1:0}),teasp.view.Shift.setDeptLevel(e,null,{order:1}),e.sort(function(e,t){return e.order-t.order})},teasp.view.Shift.setDeptLevel=function(e,t,a){for(var o=t?t.Id:null,s=0;s<e.length;s++){var i=e[s];if(i.ParentId__c==o){t&&(t.past||t.future)&&(i.past=t.past,i.future=t.future),i.level=t?t.level+1:0;for(var n="",r=0;r<i.level;r++)n+="&nbsp;&nbsp;";
i.displayName=n+i.DeptCode__c+"-"+i.Name,i.order=a.order++,teasp.view.Shift.setDeptLevel(e,i,a)}}},teasp.view.Shift.prototype.outputShiftCsv=function(e,t,a,o){for(var s=e.type?this.getCsvValue2(e):this.getCsvValue1(e),i=""+(new Date).getTime(),n=teasp.util.splitByLength(s.value,3e4),r=[],l=Math.ceil(n.length/9),p=0,d=0;d<l;d++){r[d]=[];for(var c=0;c<9;c++){var m=9*p+c;m<n.length&&r[d].push(n[m])}p++}for(var h=[],
d=0;h.push({funcName:"inputData",params:{key:i,head:0==d?s.head:null,values:r[d],order:d+1}}),++d<r.length;);h.errorAreaId=t;var u="shift"+teasp.util.date.formatDateTime(new Date,"N14",!0)+".csv";this.contact(h,function(e,t){h.length<=t+1&&(teasp.downloadHref(teasp.getPageUrl("extCsvView")+"?key="+i+(u?"&fname="+u:"")),setTimeout(function(){a.apply(o)},100))},!0)},teasp.view.Shift.prototype.downloadDone=function(){},
teasp.view.Shift.prototype.getHolidayName=function(e,t){return e?t?e.Name:e.Symbol__c||e.Name.substring(0,1):""},teasp.view.Shift.prototype.getCsvValue1=function(e){for(var t='"部署コード","部署名","役職","社員コード","社員名"',a=teasp.util.date.getDateList(this.localObj.param.startDate,this.localObj.param.endDate),o=(this.localObj.param.deptId,0);o<a.length;o++)t+=',"'+teasp.util.date.formatDate(a[o],"SLA")+'"';for(
var s='"","","","",""',o=0;o<a.length;o++){var i=a[o],n=[];this.localObj.pubEvents[i]&&n.push(this.localObj.pubEvents[i]),this.localObj.events[i]&&n.push(this.localObj.events[i]),s+=',"'+n.join(teasp.message.getLabel("tm10001470"))+'"'}for(var r=0;r<this.deptKeys.length;r++)for(var l=this.deptKeys[r],p=this.localObj.deptMap[l],d=0;d<p.length;d++){var c=p[d];s+='\n"'+(c.DeptId__r&&c.DeptId__r.DeptCode__c||"")+'","'+(
c.DeptId__r&&c.DeptId__r.Name||"")+'","'+(c.Title__c||"")+'","'+(c.EmpCode__c||"")+'","'+c.Name+'"';for(o=0;o<a.length;o++){var m,i=a[o],h=c.days[i],u=null,g="";h.dayType==teasp.constant.DAY_TYPE_NORMAL_HOLIDAY?g="(所定休日)":h.dayType==teasp.constant.DAY_TYPE_PUBLIC_HOLIDAY?g="(祝日)":h.dayType==teasp.constant.DAY_TYPE_LEGAL_HOLIDAY?g="(法定休日)":(m=h.applys.holidayAll||h.applys.holidayAm&&h.applys.holidayPm,
h.plannedHoliday&&!h.applys.kyushtu?g="[休暇](計画)":m?g=h.applys.holidayAll?"[休暇]("+this.getHolidayName(h.applys.holidayAll.HolidayId__r,e.holidayFull)+")":"[休暇]("+this.getHolidayName(h.applys.holidayAm.HolidayId__r,e.holidayFull)+","+this.getHolidayName(h.applys.holidayPm.HolidayId__r,e.holidayFull)+")":(h.applys.holidayAm?g="[午前休]("+this.getHolidayName(h.applys.holidayAm.HolidayId__r,e.holidayFull
)+")":h.applys.holidayPm&&(g="[午後休]("+this.getHolidayName(h.applys.holidayPm.HolidayId__r,e.holidayFull)+")"),h.pattern?(u=h.pattern,e.patternFull?g+=(g?"\n":"")+h.pattern.Name:g+=(g?"\n":"")+(h.pattern.Symbol__c||h.pattern.Name.substring(0,1))):(u=c.empType.days[i].config,e.patternFull&&(g+=(g?"\n":"")+"(通常勤務)")),h.workPlace&&h.workPlace.Id!=c.DeptId__c&&(g+=(g?"\n":"")+"主管部署:"+h.workPlace.Name))),u&&e.timeIn&&(g+=(
g?"\n":"")+teasp.util.time.timeValue(u.StdStartTime__c)+" -"+teasp.util.time.timeValue(u.StdEndTime__c)),h.temporary&&(g+=(g?"\n":"")+"(仮)"),s+=',"'+g+'"'}}return{head:t,value:s}},teasp.view.Shift.prototype.getCsvValue2=function(e){for(var t='"部署コード","部署名","役職","社員コード","社員名","日付","曜日","設定","勤務パターン"',a=(e.timeIn&&(t+=',"始業時刻","終業時刻"'),t+=',"共通のイベント"',teasp.util.date.getDateList(this.localObj.param.startDate,
this.localObj.param.endDate)),o=this.localObj.param.deptId||"(null)",s="",i={},n=0;n<a.length;n++){i[h=a[n]]={},i[h].date=teasp.util.date.formatDate(h,"SLA"),i[h].week=teasp.util.date.formatDate(h,"JPW");var r=[];this.localObj.pubEvents[h]&&r.push(this.localObj.pubEvents[h]),this.localObj.events[h]&&r.push(this.localObj.events[h]),i[h].pubEvent=r.join(teasp.message.getLabel("tm10001470")),
i[h].event=this.localObj.deptEvents[o]&&this.localObj.deptEvents[o].days[h]&&this.localObj.deptEvents[o].days[h].event||"",i[h].note=this.localObj.deptEvents[o]&&this.localObj.deptEvents[o].days[h]&&this.localObj.deptEvents[o].days[h].note||""}for(var l=0;l<this.deptKeys.length;l++)for(var p=this.deptKeys[l],d=this.localObj.deptMap[p],c=0;c<d.length;c++)for(var m=d[c],n=0;n<a.length;n++){var h,u,g=i[h=a[n]],
y=m.days[h],f=null,b="",_="",v="",T="";y.dayType==teasp.constant.DAY_TYPE_NORMAL_HOLIDAY?b="(所定休日)":y.dayType==teasp.constant.DAY_TYPE_PUBLIC_HOLIDAY?b="(祝日)":y.dayType==teasp.constant.DAY_TYPE_LEGAL_HOLIDAY?b="(法定休日)":(u=y.applys.holidayAll||y.applys.holidayAm&&y.applys.holidayPm,y.plannedHoliday&&!y.applys.kyushtu?b="[休暇](計画)":u?b=y.applys.holidayAll?"[休暇]("+this.getHolidayName(y.applys.holidayAll.HolidayId__r,
e.holidayFull)+")":"[休暇]("+this.getHolidayName(y.applys.holidayAm.HolidayId__r,e.holidayFull)+","+this.getHolidayName(y.applys.holidayPm.HolidayId__r,e.holidayFull)+")":(y.applys.holidayAm?b="[午前休]("+this.getHolidayName(y.applys.holidayAm.HolidayId__r,e.holidayFull)+")":y.applys.holidayPm&&(b="[午後休]("+this.getHolidayName(y.applys.holidayPm.HolidayId__r,e.holidayFull)+")"),_=y.pattern?(f=y.pattern,
e.patternFull?y.pattern.Name:y.pattern.Symbol__c||y.pattern.Name.substring(0,1)):(f=m.empType.days[h].config,e.patternFull?"(通常勤務)":""),y.workPlace&&y.workPlace.Id!=m.DeptId__c&&y.workPlace.Name)),f&&(v=teasp.util.time.timeValue(f.StdStartTime__c),T=teasp.util.time.timeValue(f.StdEndTime__c)),s=(s=(s=(s=(s=(s=(s=(s+='"'+(m.DeptId__r&&m.DeptId__r.DeptCode__c||""))+('","'+(m.DeptId__r&&m.DeptId__r.Name||"")))+('","'+(
m.Title__c||"")))+('","'+(m.EmpCode__c||"")))+('","'+m.Name))+('","'+g.date))+('","'+g.week))+('","'+b+(y.temporary?"(仮)":""))+('","'+_),s=(s=e.timeIn?s+'","'+v+'","'+T:s)+('","'+g.pubEvent)+'"\n'}return{head:t,value:s}},teasp.view.Shift.prototype.resizeWidth=function(){var e=dojo.byId("workArea").parentNode.offsetWidth,t=dojo.byId("shiftTable"),a=dojo.query("tr",t)[0],o=0,s=(dojo.query("td.dayCell,td.sumCell",a
).forEach(function(e){o++}),dojo.byId("displayTime").checked||this.largeSymbolFlag),i=Math.max((e-(150+this.scrollW))/o,s?40:29);dojo.query("td.whiteCell,td.whiteCell > div",t).forEach(function(e){"DIV"==e.tagName&&dojo.hasClass(e.parentNode,"sumHoriz2Cell")||dojo.style(e,"width","150px")}),dojo.query("td.empCell",t).forEach(function(e){dojo.style(e,"width","150px")}),dojo.query("td.empCell > div",t).forEach(
function(e){dojo.style(e,"width","140px")}),dojo.query("td.dayCell,td.sumCell",t).forEach(function(e){dojo.style(e,"width",i+"px"),dojo.style(e,"min-width",s?"40px":"29px")}),dojo.query("thead td.dayCell > div.event-text",t).forEach(function(e){dojo.style(e,"width",i-10+"px")})},teasp.view.Shift.prototype.resizeArea=function(){this.resizeWidth();var e=dojo.query("#shiftTable thead");if(e.length){for(var t=dojo.byId(
"shiftLegend"),a=t&&dojo.byId("displayLegend").checked,e=e[0],o=dojo.byId("baseDiv"),s=teasp.isSforce()?5:10;"BODY"!=o.tagName;){var i=dojo.style(o,"display");/^table-row/.test(i)||(s+=o.offsetTop),o=o.parentNode}for(var o=dojo.byId("big_area"),n=0;"BODY"!=o.tagName;){i=dojo.style(o,"display");/^table-row/.test(i)||(n+=o.offsetTop),o=o.parentNode}var r=0,l=(dojo.query("#shiftTable tr").forEach(function(e){
r+=e.offsetHeight}),dojo.window.getBox()),p=Math.max(l.h-s-e.offsetHeight-(a?t.offsetHeight:0),100),l=(p<r&&(dojo.query("#shiftTable tbody").forEach(function(e){dojo.style(e,"height",p+n+"px")}),window.scrollTo(0,n)),dojo.query("#shiftTable tbody tr > td.whiteCell"));this.firstDeptHeight=l.length?l[0].offsetTop-dojo.query("#shiftTable thead")[0].offsetHeight:0}},teasp.view.Shift.prototype.checkedLegend=function(){
var e=dojo.byId("shiftLegend");e&&(dojo.style(e,"display",dojo.byId("displayLegend").checked?"":"none"),this.resizeArea())},teasp.view.Shift.prototype.resetScrollTop=function(){this.shiftTableScrollTop=0},teasp.view.Shift.prototype.remenberScrollTop=function(){this.shiftTableScrollTop=dojo.query("#shiftTable tbody")[0].scrollTop},teasp.view.Shift.prototype.returnScrollTop=function(){var e;this.shiftTableScrollTop&&((
e=dojo.query("#shiftTable tbody")[0]).scrollTo?e.scrollTo(0,this.shiftTableScrollTop):e.scrollTop=this.shiftTableScrollTop)},teasp.view.Shift.prototype.closeBusyWait=function(){var e=dijit.byId("BusyWait");e&&e.open&&e.hide()},teasp.provide("teasp.view.Ext"),teasp.view.Ext=function(){this.queryObj=null},teasp.view.Ext.prototype=new teasp.view.Base,teasp.view.Ext.prototype.contact=function(e,t,a){
teasp.action.contact.remoteMethods(is_array(e)?e:[e],{errorAreaId:e.errorAreaId||this.errorAreaId,nowait:a||!1},t,null,this)},teasp.view.Ext.prototype.init=function(e,t){globalLoadRes.today=new Date,globalLoadRes.todayYm=100*globalLoadRes.today.getFullYear()+(globalLoadRes.today.getMonth()+1);var a=globalLoadRes.user[0].Profile.PermissionsModifyAllData||globalLoadRes.emp.length&&globalLoadRes.emp[0].IsAdmin__c;if(
!a||tsq.initialContents(this.errorAreaId,function(){location.reload()})){for(var o=dojo.byId("querySelect"),s=(dojo.create("option",{innerHTML:"",value:"-"},o),[]),i=null,n=0;n<globalLoadRes.querys.length;n++){var r=globalLoadRes.querys[n];!a&&!r.Permit__c||r.Removed__c||(s.push(r.Id),i=i||r,dojo.create("option",{innerHTML:r.Name,value:r.Id},o))}1!=s.length&&(i=null),this.readParams({}),
this.viewParams.debug&&dojo.create("option",{innerHTML:"*",value:"*"},o),i&&(o.value=i.Id,dojo.byId("queryDescription").innerHTML=i.Description__c||""),dojo.connect(o,"onchange",this,function(){this.clearForm();var e=dojo.byId("querySelect").value;if("-"==e||"*"==e)dojo.byId("queryDescription").innerHTML="";else for(var t=0;t<globalLoadRes.querys.length;t++){var a=globalLoadRes.querys[t];a.Id==e&&(dojo.byId(
"queryDescription").innerHTML=a.Description__c||"")}}),dojo.connect(dojo.byId("queryStart"),"onclick",this,this.queryStep1)}},teasp.view.Ext.prototype.queryStep1=function(){var e=dojo.byId("querySelect").value;"-"!=e&&("*"!=e?(document.body.style.cursor="wait",this.contact({funcName:"getExtById",params:{id:e}},this.queryStep2)):(tsq.QueryObj.prototype.buildForm=tsq.QueryObj.prototype.buildForm0,
tsq.QueryObj.prototype.buildData=tsq.QueryObj.prototype.buildData0,this.initQuery()))},teasp.view.Ext.prototype.queryStep2=function(e){document.body.style.cursor="default",console.log(e),this.initQuery(e.ext[0])},teasp.view.Ext.prototype.initQuery=function(e){this.clearForm(),this.queryObj&&this.queryObj.destroy(),this.queryObj=new tsq.QueryObj(e),this.queryObj.buildForm()},
teasp.view.Ext.prototype.clearForm=function(){for(var e=dojo.byId("queryForm");e.firstChild;)dojo.destroy(e.firstChild)};var tsq={initialContents:function(e,t){var a="日次データ出力",o=[],s=[{name:a,revision:4,permit:0}],i=[],n={},r={},l=globalLoadRes.querys.length+1;if(globalLoadRes.querys.length<=0)i=s;else{for(var p=0;p<globalLoadRes.querys.length;p++){r[globalLoadRes.querys[p].Name]=1,
globalLoadRes.querys[p].Removed__c&&(n[globalLoadRes.querys[p].Name]=1);for(var d=0;d<s.length;d++)globalLoadRes.querys[p].Name==s[d].name&&!globalLoadRes.querys[p].Removed__c&&(globalLoadRes.querys[p].Revision__c||0)<s[d].revision&&(s[d].permit=globalLoadRes.querys[p].Permit__c,s[d].order=globalLoadRes.querys[p].Order__c,i.push(s[d]))}for(d=0;d<s.length;d++)r[s[d].name]||n[s[d].name]||i.push(s[d])}for(
p=0;p<i.length;p++)i[p].name==a&&o.push({funcName:"inputContent",params:{name:a,
script1:'tsq.QueryObj.prototype.buildForm=function(){this.destroy();var that=this;this.contact({funcName:"getExtResult",params:{soql:"select Id, DeptCode__c, Name, ParentId__c from AtkDept__c",limit:1E3,offset:0}},function(result){that.depts=result.records;tsq.QueryObj.levelingDepts(that.depts);this.step();that.buildForm2()},true)};tsq.QueryObj.prototype.buildForm2=function(){var today=new Date;var lastDate=new Date(today.getFullYear(),today.getMonth()+1,0);var qform=dojo.byId("queryForm");var tbody=dojo.create("tbody",null,dojo.create("table",{className:"pane_table"},qform));var row=dojo.create("tr",null,tbody);var table=dojo.create("table",{className:"pane_table"},qform);tbody=dojo.create("tbody",null,table);tbody.style.marginTop="8px";row=dojo.create("tr",null,tbody);var div=dojo.create("div",{innerHTML:"期間"},dojo.create("td",{width:"96px"},row));div.style.marginRight="20px";new dijit.form.NumberSpinner({value:today.getFullYear(),constraints:{min:1900,max:2100,pattern:"####"},id:"queryStartYear",style:"width:60px;margin-right:2px;"},dojo.create("div",null,dojo.create("td",null,row)));new dijit.form.NumberSpinner({value:today.getMonth()+1,constraints:{min:1,max:12,pattern:"00"},id:"queryStartMonth",style:"width:42px;margin-right:2px;"},dojo.create("div",null,dojo.create("td",null,row)));new dijit.form.NumberSpinner({value:1,constraints:{min:1,max:31,pattern:"00"},id:"queryStartDate",style:"width:42px;margin-right:2px;"},dojo.create("div",null,dojo.create("td",null,row)));div=dojo.create("div",{innerHTML:"～",style:"margin-left:4px;margin-right:4px;"},dojo.create("td",null,row));div.style.marginLeft="4px";div.style.marginRight="4px";new dijit.form.NumberSpinner({value:lastDate.getFullYear(),constraints:{min:1900,max:2100,pattern:"####"},id:"queryEndYear",style:"width:60px;margin-right:2px;"},dojo.create("div",null,dojo.create("td",null,row)));new dijit.form.NumberSpinner({value:lastDate.getMonth()+1,constraints:{min:1,max:12,pattern:"00"},id:"queryEndMonth",style:"width:42px;margin-right:2px;"},dojo.create("div",null,dojo.create("td",null,row)));new dijit.form.NumberSpinner({value:lastDate.getDate(),constraints:{min:1,max:31,pattern:"00"},id:"queryEndDate",style:"width:42px;margin-right:2px;"},dojo.create("div",null,dojo.create("td",null,row)));this.dijitParts["queryStartYear"]=1;this.dijitParts["queryStartMonth"]=1;this.dijitParts["queryStartDate"]=1;this.dijitParts["queryEndYear"]=1;this.dijitParts["queryEndMonth"]=1;this.dijitParts["queryEndDate"]=1;table=dojo.create("table",{className:"pane_table"},qform);table.style.marginTop="8px";tbody=dojo.create("tbody",null,table);row=dojo.create("tr",null,tbody);div=dojo.create("div",{innerHTML:"部署"},dojo.create("td",{width:"96px"},row));div.style.marginRight="20px";var select=dojo.create("select",{id:"queryDept"},dojo.create("td",null,row));dojo.create("option",{innerHTML:"(すべて)",value:"-"},select);for(var i=0;i<this.depts.length;i++){var dept=this.depts[i];dojo.create("option",{innerHTML:dept.displayName,value:dept.Id},select)}row=dojo.create("tr",null,tbody);dojo.create("td",null,row);var label=dojo.create("label",null,dojo.create("td",null,row));label.style.paddingTop="4px";dojo.create("input",{type:"checkbox",id:"queryDeptBelow"},label);dojo.create("span",{innerHTML:" 下位層を含める（3階層分まで）"},label);table=dojo.create("table",{className:"pane_table"},qform);table.style.marginTop="8px";tbody=dojo.create("tbody",null,table);row=dojo.create("tr",null,tbody);div=dojo.create("div",{innerHTML:"社員コード<br/>(前方一致検索)"},dojo.create("td",{width:"96px",rowSpan:4,style:"vertical-align:top;"},row));dojo.create("input",{type:"text",id:"queryEmpCode1",style:"width:90px;",maxLength:20,className:"inputran"},dojo.create("td",null,row));row=dojo.create("tr",null,tbody);dojo.create("input",{type:"text",id:"queryEmpCode2",style:"width:90px;",maxLength:20,className:"inputran"},dojo.create("td",null,row));row=dojo.create("tr",null,tbody);dojo.create("input",{type:"text",id:"queryEmpCode3",style:"width:90px;",maxLength:20,className:"inputran"},dojo.create("td",null,row));row=dojo.create("tr",null,tbody);label=dojo.create("label",null,dojo.create("td",null,row));dojo.create("input",{type:"checkbox",id:"queryEmpExclude"},label);dojo.create("span",{innerHTML:" これらの社員を除く"},label);var inp=dojo.create("input",{type:"button",value:"ダウンロード",style:"margin-top:20px;"},qform);dojo.connect(inp,"onclick",this,function(){this.folder={};var sm=new Date(parseInt(dijit.byId("queryStartYear").value,10),parseInt(dijit.byId("queryStartMonth").value,10)-1,parseInt(dijit.byId("queryStartDate").value,10));var em=new Date(parseInt(dijit.byId("queryEndYear").value,10),parseInt(dijit.byId("queryEndMonth").value,10)-1,parseInt(dijit.byId("queryEndDate").value,10));this.folder.param={sm:teasp.util.date.formatDate(sm),em:teasp.util.date.formatDate(em),deptId:dojo.byId("queryDept").value=="-"?null:dojo.byId("queryDept").value,deep:dojo.byId("queryDeptBelow").checked,empCode1:dojo.byId("queryEmpCode1").value.trim(),empCode2:dojo.byId("queryEmpCode2").value.trim(),empCode3:dojo.byId("queryEmpCode3").value.trim(),empExclude:dojo.byId("queryEmpExclude").checked};if(this.folder.param.sm>this.folder.param.em){teasp.util.showErrorArea("期間が正しくありません","error_area");return}teasp.manager.dialogOpen("BusyWait");var soql="select StartDate__c, ExchangeDate__c, OriginalStartDate__c from AtkEmpApply__c"+" where ApplyType__c = \'振替申請\'"+" and ((StartDate__c <= {1} and EndDate__c >= {0}) or (ExchangeDate__c >= {0} and ExchangeDate__c <= {1}) or (OriginalStartDate__c >= {0} and OriginalStartDate__c <= {1}))"+" and (Status__c = null or Status__c = \'承認待ち\' or Status__c = \'承認済み\' or Status__c = \'確定済み\')"+" and Removed__c = false";if(this.folder.param.deptId){soql+=" and (EmpId__r.DeptId__c = \'{2}\'";if(this.folder.param.deep){soql+=" or EmpId__r.DeptId__r.ParentId__c = \'{2}\'";soql+=" or EmpId__r.DeptId__r.ParentId__r.ParentId__c = \'{2}\'"}soql+=")"}var emlst=[];if(this.folder.param.empCode1)emlst.push((this.folder.param.empExclude?"(not ":"(")+"EmpId__r.EmpCode__c like \'{3}%\')");if(this.folder.param.empCode2)emlst.push((this.folder.param.empExclude?"(not ":"(")+"EmpId__r.EmpCode__c like \'{4}%\')");if(this.folder.param.empCode3)emlst.push((this.folder.param.empExclude?"(not ":"(")+"EmpId__r.EmpCode__c like \'{5}%\')");if(emlst.length>0)soql+=" and ("+emlst.join(this.folder.param.empExclude?" and ":" or ")+")";soql=tsq.getString(soql,this.folder.param.sm,this.folder.param.em,this.folder.param.deptId,this.folder.param.empCode1,this.folder.param.empCode2,this.folder.param.empCode3);this.search(soql,true)})};tsq.QueryObj.levelingDepts=function(depts){depts=depts.sort(function(a,b){return a.DeptCode__c<b.DeptCode__c?-1:a.DeptCode__c>b.DeptCode__c?1:0});var setDeptLevel=function(depts,parent,oo){var parentId=parent?parent.Id:null;for(var i=0;i<depts.length;i++){var dept=depts[i];if(dept.ParentId__c==parentId){if(parent){parent.parentFlag=true;dept.parentMap=parent.parentMap?dojo.clone(parent.parentMap):{};dept.parentMap[parent.id]=parent.level}dept.level=parent?parent.level+1:1;var spc="";for(var j=0;j<dept.level;j++)spc+="&nbsp;&nbsp;";dept.displayName=spc+dept.DeptCode__c+"-"+dept.Name;dept.order=oo.order++;setDeptLevel(depts,dept,oo)}}};setDeptLevel(depts,null,{order:1});return depts.sort(function(a,b){return a.order-b.order})};tsq.QueryObj.prototype.buildData=function(records){if(!this.folder.range){var minDt=this.folder.param.sm;var maxDt=this.folder.param.em;var alst=records||[];for(var i=0;i<alst.length;i++){var a=alst[i];if(a.StartDate__c<minDt)minDt=a.StartDate__c;if(a.OriginalStartDate__c<minDt)minDt=a.OriginalStartDate__c;if(a.ExchangeDate__c<minDt)minDt=a.ExchangeDate__c;if(a.StartDate__c>maxDt)maxDt=a.StartDate__c;if(a.OriginalStartDate__c>maxDt)maxDt=a.OriginalStartDate__c;if(a.ExchangeDate__c>maxDt)maxDt=a.ExchangeDate__c}this.folder.range={minDt:minDt,maxDt:maxDt};var soql="select Id, ConfigBaseId__c, ValidStartDate__c, ValidEndDate__c, StdStartTime__c, StdEndTime__c, RestTimes__c, UseDiscretionary__c, Holidays__c, NonPublicHoliday__c"+" from AtkConfig__c where Removed__c = false and OriginalId__c = null"+" and (ValidStartDate__c = null or ValidStartDate__c <= {1}) and (ValidEndDate__c   = null or ValidEndDate__c   >= {0})";soql=tsq.getString(soql,this.folder.range.minDt,this.folder.range.maxDt);this.search(soql,true)}else if(!this.folder.configs){this.folder.configs=records;var soql="select Count() from AtkEmpDay__c"+" where Date__c >= {0} and Date__c <= {1}";if(this.folder.param.deptId){soql+=" and (EmpMonthId__r.EmpId__r.DeptId__c = \'{2}\'";if(this.folder.param.deep){soql+=" or EmpMonthId__r.EmpId__r.DeptId__r.ParentId__c = \'{2}\'";soql+=" or EmpMonthId__r.EmpId__r.DeptId__r.ParentId__r.ParentId__c = \'{2}\'"}soql+=")"}var emlst=[];if(this.folder.param.empCode1)emlst.push((this.folder.param.empExclude?"(not ":"(")+"EmpMonthId__r.EmpId__r.EmpCode__c like \'{3}%\')");if(this.folder.param.empCode2)emlst.push((this.folder.param.empExclude?"(not ":"(")+"EmpMonthId__r.EmpId__r.EmpCode__c like \'{4}%\')");if(this.folder.param.empCode3)emlst.push((this.folder.param.empExclude?"(not ":"(")+"EmpMonthId__r.EmpId__r.EmpCode__c like \'{5}%\')");if(emlst.length>0)soql+=" and ("+emlst.join(this.folder.param.empExclude?" and ":" or ")+")";soql=tsq.getString(soql,this.folder.param.sm,this.folder.param.em,this.folder.param.deptId,this.folder.param.empCode1,this.folder.param.empCode2,this.folder.param.empCode3);this.getCount(soql,true)}else if(typeof this.folder.empDayCount!="number"){this.folder.empDayCount=records.count;if(this.folder.empDayCount>2E4){teasp.manager.dialogClose("BusyWait");teasp.util.showErrorArea("対象レコード数が多すぎます。条件を絞り込んでください。","error_area");return}this.search("select Id, Name, ConfigBaseId__c from AtkEmpType__c",true)}else if(!this.folder.empTypes){this.folder.empTypes=records;this.search("select Id, Name, StdStartTime__c, StdEndTime__c, Range__c, RestTimes__c, UseDiscretionary__c from AtkPattern__c",true)}else if(!this.folder.patterns){this.folder.patterns=records;this.search("select EmpTypeId__c, SchedMonthlyDate__c, SchedMonthlyLine__c, SchedMonthlyWeek__c, SchedOption__c, SchedWeekly__c, Order__c, PatternId__c from AtkEmpTypePattern__c",true)}else if(!this.folder.empTypePatterns){this.folder.empTypePatterns=records;var soql="select Id, Date__c, EmpTypeId__c, Event__c, PlannedHoliday__c, Priority__c, Type__c, DeptId__c, Note__c, ShiftPlan__c"+", PatternId__r.Id, PatternId__r.Name, PatternId__r.StdStartTime__c, PatternId__r.StdEndTime__c"+", PatternId__r.Range__c, PatternId__r.RestTimes__c, PatternId__r.UseDiscretionary__c, PatternId__r.Symbol__c"+" from AtkCalendar__c"+" where Date__c >= {0} and Date__c <= {1}";soql=tsq.getString(soql,this.folder.range.minDt,this.folder.range.maxDt);this.search(soql,true)}else if(!this.folder.cals){this.folder.cals=records;var soql="select  Id, EmpId__c, ApplyType__c, ApplyTime__c, DayType__c, Status__c, StartDate__c, EndDate__c, StartTime__c, EndTime__c"+", Decree__c, ExchangeDate__c, OriginalStartDate__c, TempFlag__c, Removed__c"+", WorkPlaceId__r.Id, WorkPlaceId__r.Name, WorkPlaceId__r.Symbol__c, WorkPlaceId__r.DeptCode__c"+", PatternId__r.Id, PatternId__r.Name, PatternId__r.StdStartTime__c, PatternId__r.StdEndTime__c"+", PatternId__r.Range__c, PatternId__r.RestTimes__c, PatternId__r.UseDiscretionary__c, PatternId__r.Symbol__c"+", HolidayId__r.Id, HolidayId__r.Name, HolidayId__r.Range__c, HolidayId__r.Removed__c"+", HolidayId__r.Type__c, HolidayId__r.YuqSpend__c"+" from AtkEmpApply__c"+" where ((StartDate__c <= {1} and EndDate__c >= {0})"+" or (ApplyType__c = \'振替申請\' and ((ExchangeDate__c >= {0} and ExchangeDate__c <= {1}) or (OriginalStartDate__c >= {0} and OriginalStartDate__c <= {1}))))"+" and (Status__c = null or Status__c = \'承認待ち\' or Status__c = \'承認済み\' or Status__c = \'確定済み\')"+" and Removed__c = false and TempFlag__c = false";if(this.folder.param.deptId){soql+=" and (EmpId__r.DeptId__c = \'{2}\'";if(this.folder.param.deep){soql+=" or EmpId__r.DeptId__r.ParentId__c = \'{2}\'";soql+=" or EmpId__r.DeptId__r.ParentId__r.ParentId__c = \'{2}\'"}soql+=")"}var emlst=[];if(this.folder.param.empCode1)emlst.push((this.folder.param.empExclude?"(not ":"(")+"EmpId__r.EmpCode__c like \'{3}%\')");if(this.folder.param.empCode2)emlst.push((this.folder.param.empExclude?"(not ":"(")+"EmpId__r.EmpCode__c like \'{4}%\')");if(this.folder.param.empCode3)emlst.push((this.folder.param.empExclude?"(not ":"(")+"EmpId__r.EmpCode__c like \'{5}%\')");if(emlst.length>0)soql+=" and ("+emlst.join(this.folder.param.empExclude?" and ":" or ")+")";soql=tsq.getString(soql,this.folder.param.sm,this.folder.param.em,this.folder.param.deptId,this.folder.param.empCode1,this.folder.param.empCode2,this.folder.param.empCode3);this.search(soql,true)}else if(!this.folder.applys){this.folder.applys=records;var soql="select Id, Name, EmpMonthId__r.YearMonth__c, EmpMonthId__r.SubNo__c, EmpMonthId__r.EmpId__r.Name, EmpMonthId__r.EmpId__r.EmpCode__c"+", EmpMonthId__r.EmpId__r.DeptId__r.DeptCode__c, EmpMonthId__r.EmpId__r.DeptId__r.Name"+", EmpMonthId__r.EmpId__r.EmpTypeId__c, EmpMonthId__r.EmpId__r.EmpTypeId__r.Name"+", EmpMonthId__r.EmpApplyId__r.Status__c, Date__c, DayType__c, StartTime__c, EndTime__c, RealStartTime__c, RealEndTime__c, Note__c, AbsentTime__c"+", WorkNetTime__c, WorkWholeTime__c, WorkRealTime__c, WorkOffTime__c, WorkOverTime__c, WorkHolidayTime__c, WorkNightTime__c"+", HolidayId1__r.PlannedHoliday__c, PatternId__r.Id, PatternId__r.Name, PatternId__r.StdStartTime__c, PatternId__r.StdEndTime__c"+", PatternId__r.Range__c, PatternId__r.RestTimes__c, PatternId__r.UseDiscretionary__c, OrgDayType__c"+" from AtkEmpDay__c"+" where Date__c >= {0} and Date__c <= {1}";if(this.folder.param.deptId){soql+=" and (EmpMonthId__r.EmpId__r.DeptId__c = \'{2}\'";if(this.folder.param.deep){soql+=" or EmpMonthId__r.EmpId__r.DeptId__r.ParentId__c = \'{2}\'";soql+=" or EmpMonthId__r.EmpId__r.DeptId__r.ParentId__r.ParentId__c = \'{2}\'"}soql+=")"}var emlst=[];if(this.folder.param.empCode1)emlst.push((this.folder.param.empExclude?"(not ":"(")+"EmpMonthId__r.EmpId__r.EmpCode__c like \'{3}%\')");if(this.folder.param.empCode2)emlst.push((this.folder.param.empExclude?"(not ":"(")+"EmpMonthId__r.EmpId__r.EmpCode__c like \'{4}%\')");if(this.folder.param.empCode3)emlst.push((this.folder.param.empExclude?"(not ":"(")+"EmpMonthId__r.EmpId__r.EmpCode__c like \'{5}%\')");if(emlst.length>0)soql+=" and ("+emlst.join(this.folder.param.empExclude?" and ":" or ")+")";soql+=" order by EmpMonthId__r.EmpId__r.EmpCode__c, EmpMonthId__r.EmpId__r.Name, Date__c";soql=tsq.getString(soql,this.folder.param.sm,this.folder.param.em,this.folder.param.deptId,this.folder.param.empCode1,this.folder.param.empCode2,this.folder.param.empCode3);this.search(soql,true)}else if(!this.folder.days){this.folder.days=records;var soql="select Id, Name, EmpId__c, CalcTime__c, WorkDate__c"+" from AtkEmpWork__c"+" where EmpDayId__r.Date__c >= {0} and EmpDayId__r.Date__c <= {1}";if(this.folder.param.deptId){soql+=" and (EmpDayId__r.EmpMonthId__r.EmpId__r.DeptId__c = \'{2}\'";if(this.folder.param.deep){soql+=" or EmpDayId__r.EmpMonthId__r.EmpId__r.DeptId__r.ParentId__c = \'{2}\'";soql+=" or EmpDayId__r.EmpMonthId__r.EmpId__r.DeptId__r.ParentId__r.ParentId__c = \'{2}\'"}soql+=")"}var emlst=[];if(this.folder.param.empCode1)emlst.push((this.folder.param.empExclude?"(not ":"(")+"EmpDayId__r.EmpMonthId__r.EmpId__r.EmpCode__c like \'{3}%\')");if(this.folder.param.empCode2)emlst.push((this.folder.param.empExclude?"(not ":"(")+"EmpDayId__r.EmpMonthId__r.EmpId__r.EmpCode__c like \'{4}%\')");if(this.folder.param.empCode3)emlst.push((this.folder.param.empExclude?"(not ":"(")+"EmpDayId__r.EmpMonthId__r.EmpId__r.EmpCode__c like \'{5}%\')");if(emlst.length>0)soql+=" and ("+emlst.join(this.folder.param.empExclude?" and ":" or ")+")";soql+=" order by WorkDate__c, Order__c";soql=tsq.getString(soql,this.folder.param.sm,this.folder.param.em,this.folder.param.deptId,this.folder.param.empCode1,this.folder.param.empCode2,this.folder.param.empCode3);this.search(soql,true)}else{this.folder.works=records;this.buildData2()}};tsq.QueryObj.prototype.getWorkTime=function(empId,dt){if(!this.folder.workmap){this.folder.workmap={};for(var i=0;i<this.folder.works.length;i++){var w=this.folder.works[i];var key=w.EmpId__c+teasp.util.date.formatDate(w.WorkDate__c);var n=this.folder.workmap[key];if(!n)this.folder.workmap[key]=w.CalcTime__c||0;else this.folder.workmap[key]=n+(w.CalcTime__c||0)}}return this.folder.workmap[empId+dt]||null};tsq.QueryObj.prototype.buildData2=function(){this.step();var dkeys=teasp.util.date.getDateList(this.folder.param.sm,this.folder.param.em);var i,j,k;this.folder.events={};this.folder.pubEvents={};this.folder.emps={};var tempCbmap={};var tempPmap={};var tempEpmap={};var tempCalmap={common:{}};var tempEtmap={};var tempEamap={};var tempDkeys={};for(i=0;i<this.folder.applys.length;i++){var empApply=this.folder.applys[i];empApply.startDate=teasp.logic.convert.valDate(empApply.StartDate__c);empApply.endDate=teasp.logic.convert.valDate(empApply.EndDate__c);empApply.exchangeDate=teasp.logic.convert.valDate(empApply.ExchangeDate__c);empApply.originalStartDate=teasp.logic.convert.valDate(empApply.OriginalStartDate__c);if(!tempEamap[empApply.EmpId__c])tempEamap[empApply.EmpId__c]=[];tempEamap[empApply.EmpId__c].push(empApply);if(!dkeys.contains(empApply.startDate))tempDkeys[empApply.startDate]=1;if(!dkeys.contains(empApply.endDate))tempDkeys[empApply.endDate]=1;if(empApply.exchangeDate&&!dkeys.contains(empApply.exchangeDate))tempDkeys[empApply.exchangeDate]=1;if(empApply.originalStartDate&&!dkeys.contains(empApply.originalStartDate))tempDkeys[empApply.originalStartDate]=1}var allDkeys=[].concat(dkeys);for(var key in tempDkeys){if(!tempDkeys.hasOwnProperty(key))continue;allDkeys.push(key)}allDkeys=allDkeys.sort(function(a,b){return a<b?-1:a>b?1:0});var sd=allDkeys[0];var ed=allDkeys[allDkeys.length-1];for(i=0;i<this.folder.configs.length;i++){var c=this.folder.configs[i];if(!tempCbmap[c.ConfigBaseId__c])tempCbmap[c.ConfigBaseId__c]=[];c.validStartDate=c.ValidStartDate__c?teasp.logic.convert.valDate(c.ValidStartDate__c):null;c.validEndDate=c.ValidEndDate__c?teasp.logic.convert.valDate(c.ValidEndDate__c):null;var holidays=c.Holidays__c||"0000000";var weekHolys=[];var legalHolys=[];for(j=0;j<holidays.length;j++){var h=holidays.substring(j,j+1);if(h!="0")weekHolys.push(j);if(h=="2")legalHolys.push(j)}c.fixHolys=getHolidays(teasp.util.date.parseDate(c.validStartDate?c.validStartDate<=sd?sd:c.validStartDate:sd),teasp.util.date.parseDate(c.validEndDate?c.validEndDate>=ed?ed:c.validEndDate:ed),weekHolys,false);for(var dkey in c.fixHolys)if(c.fixHolys.hasOwnProperty(dkey)){var fh=c.fixHolys[dkey];if(legalHolys.contains(fh.dayOfWeek))fh.dayType=teasp.constant.DAY_TYPE_LEGAL_HOLIDAY;else if(weekHolys.contains(fh.dayOfWeek))fh.dayType=teasp.constant.DAY_TYPE_NORMAL_HOLIDAY;else if(c.NonPublicHoliday__c)fh.dayType=teasp.constant.DAY_TYPE_NORMAL;else fh.dayType=teasp.constant.DAY_TYPE_PUBLIC_HOLIDAY}tempCbmap[c.ConfigBaseId__c].push(c)}for(i=0;i<this.folder.cals.length;i++){var cal=this.folder.cals[i];var dkey=teasp.logic.convert.valDate(cal.Date__c);var key=cal.EmpTypeId__c?cal.EmpTypeId__c:"common";if(!tempCalmap[key])tempCalmap[key]={};tempCalmap[key][dkey]=cal}for(i=0;i<this.folder.patterns.length;i++){var p=this.folder.patterns[i];tempPmap[p.Id]=p}for(i=0;i<this.folder.empTypePatterns.length;i++){var ep=this.folder.empTypePatterns[i];ep.pattern=tempPmap[ep.PatternId__c];if(!tempEpmap[ep.EmpTypeId__c])tempEpmap[ep.EmpTypeId__c]=[];tempEpmap[ep.EmpTypeId__c].push(ep)}this.step();for(i=0;i<this.folder.empTypes.length;i++){var empType=this.folder.empTypes[i];tempEtmap[empType.Id]=empType;empType.patterns=(tempEpmap[empType.Id]||[]).sort(function(a,b){return a.Order__c-b.Order__c});empType.days={};var configs=tempCbmap[empType.ConfigBaseId__c];for(j=0;j<allDkeys.length;j++){var dkey=allDkeys[j];var d=empType.days[dkey]={date:teasp.util.date.parseDate(dkey)};if(configs.length==1)d.config=configs[0];else for(k=0;k<configs.length;k++){var c=configs[k];if((!c.validStartDate||c.validStartDate<=dkey)&&(!c.validEndDate||c.validEndDate>=dkey)){d.config=c;break}}d.layer1=function(){var o={};var fh=d.config.fixHolys[dkey];o.dayType=fh?fh.dayType:teasp.constant.DAY_TYPE_NORMAL;o.event=fh&&fh.title||null;var ep=tsq.getPatternByDate(empType.patterns,d.date);o.pattern=ep&&ep.pattern||null;return o}();d.layer2=function(co,et){if(!co&&!et)return{};var o={};var type2DayType=function(type){switch(type){case "1":return teasp.constant.DAY_TYPE_NORMAL_HOLIDAY;case "2":return teasp.constant.DAY_TYPE_LEGAL_HOLIDAY;case "3":return teasp.constant.DAY_TYPE_PUBLIC_HOLIDAY;default:return teasp.constant.DAY_TYPE_NORMAL}};if(co){if(co.Type__c){o.dayType=type2DayType(co.Type__c);o.plannedHoliday=co.PlannedHoliday__c||false;o.commonPriority=co.Priority__c=="1"}if(co.Event__c&&co.Event__c.length>0)o.commonEvent=co.Event__c;if(co.Note__c&&co.Note__c.length>0)o.commonNote=co.Note__c}if(et){if(et.Type__c&&!o.commonPriority){o.dayType=type2DayType(et.Type__c);o.plannedHoliday=et.PlannedHoliday__c||false}if(et.Event__c&&et.Event__c.length>0)o.event=et.Event__c;if(et.Note__c&&et.Note__c.length>0)o.note=et.Note__c;o.pattern=et.PatternId__r||null}return o}(tempCalmap["common"][dkey]||null,(tempCalmap[empType.Id]||{})[dkey]||null);d.dayType=d.layer2.dayType?d.layer2.dayType:d.layer1.dayType;d.plannedHoliday=d.dayType==teasp.constant.DAY_TYPE_NORMAL&&d.layer2.plannedHoliday||false;d.pattern=d.layer2.pattern?d.layer2.pattern:d.layer1.pattern;var evts=[];if(d.layer1.event)evts.push(d.layer1.event);if(d.layer2.commonEvent)evts.push(d.layer2.commonEvent);if(d.layer2.event)evts.push(d.layer2.event);d.event=evts.length>0?evts.join(teasp.message.getLabel("tm10001470")):null;d.note=d.layer2.note;this.folder.pubEvents[dkey]=d.layer1.event;this.folder.events[dkey]=d.layer2.commonEvent}}var value="";for(i=0;i<this.folder.days.length;i++){var d=this.folder.days[i];var dkey=teasp.util.date.formatDate(d.Date__c);var empId=d.EmpMonthId__r.EmpId__c;if(!this.folder.emps[empId])this.folder.emps[empId]={days:{},empType:tempEtmap[d.EmpMonthId__r.EmpId__r.EmpTypeId__c]};var emp=this.folder.emps[empId];emp.days[dkey]=d;d.date=teasp.util.date.formatDate(dkey,"SLA");d.dayOfWeek=teasp.util.date.formatDate(dkey,"JPW");d.wt=this.getWorkTime(d.EmpMonthId__r.EmpId__c,dkey);d.sa=typeof d.WorkNetTime__c=="number"&&d.wt!==null?d.WorkNetTime__c-d.wt:typeof d.WorkNetTime__c=="number"?"工数入力なし":null;var applys=[];if(tempEamap[empId]){var l=tempEamap[empId];for(k=0;k<l.length;k++){var a=l[k];if(a.startDate<=dkey&&dkey<=a.endDate||a.ApplyType__c==teasp.constant.APPLY_TYPE_EXCHANGE&&dkey==a.exchangeDate||a.ApplyType__c==teasp.constant.APPLY_TYPE_EXCHANGE&&dkey==a.originalStartDate)applys.push(a)}}var amap={};var dmap={};for(k=0;k<applys.length;k++){var a=applys[k];tsq.setApplyToDayObj(a.Decree__c?dmap:amap,tsq.getApplyKey(a,dkey),a)}d.applys=tsq.getValidApplys(amap);d.decrees=tsq.getValidApplys(dmap);d.fix=d.EmpMonthId__r.EmpApplyId__r&&teasp.constant.STATUS_FIX.contains(d.EmpMonthId__r.EmpApplyId__r.Status__c)||d.applys.dailyFix&&teasp.constant.STATUS_FIX.contains(d.applys.dailyFix.Status__c);var dp=d.decrees.patternS||d.decrees.patternL;var shiftp=dp&&dp.PatternId__r||null;var ap=d.applys.patternS||d.applys.patternL;if(!d.fix){d.dayType=emp.empType.days[dkey].dayType;d.plannedHoliday=emp.empType.days[dkey].plannedHoliday;d.pattern=emp.empType.days[dkey].pattern;if(dp){if(typeof dp.DayType__c=="string")d.dayType=parseInt(dp.DayType__c,10);d.pattern=dp.PatternId__r||null;d.workPlace=dp.WorkPlaceId__r||null}if(ap){if(typeof ap.DayType__c=="string")d.dayType=parseInt(ap.DayType__c,10);d.pattern=ap.PatternId__r||null;d.workPlace=ap.WorkPlaceId__r||null}if(d.applys.exchangeS)d.dayType=emp.empType.days[d.applys.exchangeS.exchangeDate].dayType;else if(!d.applys.exchangeS&&d.applys.exchangeE)d.dayType=emp.empType.days[d.applys.exchangeE.originalStartDate].dayType}else{d.dayType=parseInt(d.DayType__c,10);d.plannedHoliday=d.HolidayId1__r&&d.HolidayId1__r.PlannedHoliday__c||false;d.pattern=d.PatternId__r}var ktm={dayType:d.dayType,hlys:"",excs:"",pats:"",hwks:"",zans:"",ezas:"",lats:"",ends:"",dfxs:"",mfxs:"",shft:"",stst:"",stet:"",st:"",et:"",rst:"",ret:"",whole:"",realt:"",overt:"",holyt:"",night:"",absnt:"",wofft:"",netwt:"",workt:""};var p=d.applys.patternS||d.applys.patternL;var ex=d.applys.exchangeS||d.applys.exchangeE;var kp=d.pattern||emp.empType.days[dkey].config;ktm.pats=function(_p){if(!_p)return"";if(_p.PatternId__r)return _p.PatternId__r.Name+" ("+p.Status__c+")";else if(_p.DayType__c=="0"){ktm.dayType=0;return"(勤務日)"+" ("+p.Status__c+")"}else if(_p.DayType__c=="1"){ktm.dayType=1;return"(非勤務日)"+" ("+p.Status__c+")"}return""}(p);ktm.excs=function(_ex){if(!_ex)return"";var sd=teasp.util.date.formatDate(_ex.StartDate__c);if(sd==dkey)return"振替["+teasp.util.date.formatDate(_ex.ExchangeDate__c,"M/d")+"] ("+ex.Status__c+")";else return"振替["+teasp.util.date.formatDate(_ex.StartDate__c,"M/d")+"] ("+ex.Status__c+")"}(ex);ktm.dfxs=d.applys.dailyFix&&d.applys.dailyFix.Status__c||"";ktm.mfxs=d.EmpMonthId__r.EmpApplyId__r&&d.EmpMonthId__r.EmpApplyId__r.Status__c||"未確定";ktm.shft=shiftp&&shiftp.Name||"";if((d.dayType==teasp.constant.DAY_TYPE_NORMAL_HOLIDAY||d.dayType==teasp.constant.DAY_TYPE_PUBLIC_HOLIDAY)&&!d.applys.kyushtu);else if(d.dayType==teasp.constant.DAY_TYPE_LEGAL_HOLIDAY&&d.OrgDayType__c!="0"&&!d.applys.kyushtu);else{var hsta=[];if(d.applys.holidayAll)hsta.push(d.applys.holidayAll.HolidayId__r.Name+" ("+d.applys.holidayAll.Status__c+")");if(d.applys.holidayAm)hsta.push(d.applys.holidayAm.HolidayId__r.Name+" ("+d.applys.holidayAm.Status__c+")");if(d.applys.holidayPm)hsta.push(d.applys.holidayPm.HolidayId__r.Name+" ("+d.applys.holidayPm.Status__c+")");if(d.applys.holidayTime&&d.applys.holidayTime.length>0)for(j=0;j<d.applys.holidayTime.length;j++){var h=d.applys.holidayTime[j];hsta.push(h.HolidayId__r.Name+"["+teasp.util.time.timeValue(h.StartTime__c)+"～"+teasp.util.time.timeValue(h.EndTime__c)+"] ("+h.Status__c+")")}ktm.hlys=hsta.length>0?hsta.join(", "):"";ktm.zans=d.applys.zangyo?"["+teasp.util.time.timeValue(d.applys.zangyo.StartTime__c)+"～"+teasp.util.time.timeValue(d.applys.zangyo.EndTime__c)+"] ("+d.applys.zangyo.Status__c+")":"";ktm.ezas=d.applys.earlyStart?"["+teasp.util.time.timeValue(d.applys.earlyStart.StartTime__c)+"～"+teasp.util.time.timeValue(d.applys.earlyStart.EndTime__c)+"] ("+d.applys.earlyStart.Status__c+")":"";ktm.hwks=d.applys.kyushtu?"["+teasp.util.time.timeValue(d.applys.kyushtu.StartTime__c)+"～"+teasp.util.time.timeValue(d.applys.kyushtu.EndTime__c)+"] ("+d.applys.kyushtu.Status__c+")":"";ktm.lats=d.applys.lateStart?"["+teasp.util.time.timeValue(d.applys.lateStart.EndTime__c)+"] ("+d.applys.lateStart.Status__c+")":"";ktm.ends=d.applys.earlyEnd?"["+teasp.util.time.timeValue(d.applys.earlyEnd.StartTime__c)+"] ("+d.applys.earlyEnd.Status__c+")":"";ktm.stst=teasp.util.time.timeValue(kp.StdStartTime__c);ktm.stet=teasp.util.time.timeValue(kp.StdEndTime__c);ktm.st=teasp.util.time.timeValue(d.StartTime__c);ktm.et=teasp.util.time.timeValue(d.EndTime__c);ktm.rst=teasp.util.time.timeValue(d.RealStartTime__c);ktm.ret=teasp.util.time.timeValue(d.RealEndTime__c);ktm.whole=teasp.util.time.timeValue(d.WorkWholeTime__c);ktm.realt=teasp.util.time.timeValue(d.WorkRealTime__c);ktm.overt=teasp.util.time.timeValue(d.WorkOverTime__c);ktm.holyt=teasp.util.time.timeValue(d.WorkHolidayTime__c);ktm.night=teasp.util.time.timeValue(d.WorkNightTime__c);ktm.absnt=teasp.util.time.timeValue(d.AbsentTime__c);ktm.wofft=teasp.util.time.timeValue(d.WorkOffTime__c);ktm.netwt=teasp.util.time.timeValue(d.WorkNetTime__c);ktm.workt=teasp.util.time.timeValue(d.wt)}value+=\'"\'+(d.EmpMonthId__r.EmpId__r.DeptId__r&&d.EmpMonthId__r.EmpId__r.DeptId__r.DeptCode__c||"")+\'","\'+(d.EmpMonthId__r.EmpId__r.DeptId__r&&d.EmpMonthId__r.EmpId__r.DeptId__r.Name||"")+\'","\'+d.EmpMonthId__r.EmpId__r.EmpTypeId__r.Name+\'","\'+(d.EmpMonthId__r.EmpId__r.EmpCode__c||"")+\'","\'+d.EmpMonthId__r.EmpId__r.Name+\'","\'+d.EmpMonthId__r.YearMonth__c+(d.EmpMonthId__r.SubNo__c?"("+(d.EmpMonthId__r.SubNo__c+1)+")":"")+\'","\'+d.date+\'","\'+d.dayOfWeek+\'","\'+function(dayType,plan){switch(dayType){case 0:if(plan)return"有休計画付与日";return"平日";case 1:return"所定休日";case 2:return"法定休日";case 3:return"祝日"}}(ktm.dayType,d.plannedHoliday)+\'","\'+ktm.hlys+\'","\'+ktm.excs+\'","\'+ktm.pats+\'","\'+ktm.hwks+\'","\'+ktm.zans+\'","\'+ktm.ezas+\'","\'+ktm.lats+\'","\'+ktm.ends+\'","\'+ktm.dfxs+\'","\'+ktm.mfxs+\'","\'+ktm.shft+\'","\'+ktm.stst+\'","\'+ktm.stet+\'","\'+ktm.st+\'","\'+ktm.et+\'","\'+ktm.rst+\'","\'+ktm.ret+\'","\'+ktm.whole+\'","\'+ktm.realt+\'","\'+ktm.overt+\'","\'+ktm.holyt+\'","\'+ktm.night+\'","\'+ktm.absnt+\'","\'+ktm.wofft+\'","\'+ktm.netwt+\'","\'+ktm.workt+\'","\'+tsq.escapeStr(d.Note__c)+\'"\\r\\n\'}var heads=\'"部署コード","部署名","勤務体系","社員コード","社員名","月度","日付","曜日","種別"\'+\',"休暇申請","振替申請","勤務時間変更申請","休日出勤申請","残業申請","早朝勤務申請","遅刻申請","早退申請","日次確定","月次確定","シフト"\'+\',"始業","終業","出社","退社","出社(丸めなし)","退社(丸めなし)","総労働時間","実労働時間","残業時間","法定休日労働時間","深夜労働時間","欠勤時間","休憩時間","実時間","工数合計時間","備考"\';this.inputDownload(heads,value,"daily_"+this.folder.param.sm+"_"+this.folder.param.em+".csv")};',
description:"日次データを出力します",customized:!1,revision:i[p].revision,permit:i[p].permit,order:"number"==typeof i[p].order?i[p].order:l++}});return o.length<=0||(teasp.action.contact.remoteMethods(o,{errorAreaId:e,nowait:!1},t,null,this),!1)},getString:function(){for(var e=arguments,t=dojo.clone(e[0]),a=1;a<e.length;a++)t=t.replace(RegExp("\\{"+(a-1)+"\\}","g"),e[a]);return t},escapeStr:function(e){return e?e.replace(/"/g,
'""'):""},getPatternByDate:function(e,t){for(var a=0;a<e.length;a++){var o=e[a];if("1"==o.SchedOption__c){var s=""+t.getDay();if(0<=o.SchedWeekly__c.indexOf(s))return o}else if("2"==o.SchedOption__c){var i=parseInt(o.SchedMonthlyDate__c,10);if((i=32==i?teasp.util.date.getMonthEndDay(t.getFullYear(),t.getMonth()+1):i)==t.getDate())return o}else if("3"==o.SchedOption__c){var i=parseInt(o.SchedMonthlyLine__c,10),
n=Math.floor((t.getDate()+6)/7),s=(5==i&&(i=(teasp.util.date.getMonthEndDay(t.getFullYear(),t.getMonth()+1)+6)/7),""+t.getDay());if(n==i&&o.SchedMonthlyWeek__c==s)return o}}return null},setApplyToDayObj:function(e,t,a){e[t]||(e[t]=[]),e[t].push(a),1<e[t].length&&(e[t]=e[t].sort(function(e,t){return e.ApplyTime__c<t.ApplyTime__c?1:e.ApplyTime__c>t.ApplyTime__c?-1:0}))},getValidApplys:function(e){var t,a,o={};for(
t in e)e.hasOwnProperty(t)&&(a=e[t],is_array(a)&&0<a.length?t==teasp.constant.APPLY_KEY_HOLIDAY_TIME?o[t]=a:o[t]=a[0]:a&&(o[t]=a));return o},getApplyKey:function(e,t){
return e.ApplyType__c==teasp.constant.APPLY_TYPE_HOLIDAY?e.HolidayId__r.Range__c==teasp.constant.RANGE_ALL?teasp.constant.APPLY_KEY_HOLIDAY_ALL:e.HolidayId__r.Range__c==teasp.constant.RANGE_AM?teasp.constant.APPLY_KEY_HOLIDAY_AM:e.HolidayId__r.Range__c==teasp.constant.RANGE_PM?teasp.constant.APPLY_KEY_HOLIDAY_PM:e.HolidayId__r.Range__c==teasp.constant.RANGE_TIME?teasp.constant.APPLY_KEY_HOLIDAY_TIME:void 0:e.ApplyType__c==teasp.constant.APPLY_TYPE_ZANGYO?teasp.constant.APPLY_KEY_ZANGYO:e.ApplyType__c==teasp.constant.APPLY_TYPE_EARLYSTART?teasp.constant.APPLY_KEY_EARLYSTART:e.ApplyType__c==teasp.constant.APPLY_TYPE_KYUSHTU?teasp.constant.APPLY_KEY_KYUSHTU:e.ApplyType__c==teasp.constant.APPLY_TYPE_PATTERNS?teasp.constant.APPLY_KEY_PATTERNS:e.ApplyType__c==teasp.constant.APPLY_TYPE_PATTERNL?teasp.constant.APPLY_KEY_PATTERNL:e.ApplyType__c==teasp.constant.APPLY_TYPE_LATESTART?teasp.constant.APPLY_KEY_LATESTART:e.ApplyType__c==teasp.constant.APPLY_TYPE_EARLYEND?teasp.constant.APPLY_KEY_EARLYEND:e.ApplyType__c==teasp.constant.APPLY_TYPE_DAILY?teasp.constant.APPLY_KEY_DAILY:e.ApplyType__c==teasp.constant.APPLY_TYPE_EXCHANGE?e.startDate==t?teasp.constant.APPLY_KEY_EXCHANGES:teasp.constant.APPLY_KEY_EXCHANGEE:void 0
},QueryObj:function(e){this.obj=e,this.loadScript(),this.dijitParts={}}};tsq.QueryObj.prototype.destroy=function(){for(var e in this.dijitParts)dijit.byId(e).destroyRecursive(),delete this.dijitParts[e]},tsq.QueryObj.prototype.contact=function(e,t,a){teasp.action.contact.remoteMethods(is_array(e)?e:[e],{errorAreaId:e.errorAreaId||this.errorAreaId,nowait:a||!1},t,null,this)},tsq.QueryObj.prototype.loadScript=function(
){this.errorAreaId="error_area",this.obj&&dojo.eval(this.obj.Script1__c)},tsq.QueryObj.prototype.getSoql1=function(){return this.obj.Soql1__c},tsq.QueryObj.prototype.getSoql2=function(){return this.obj.Soql2__c},tsq.QueryObj.prototype.getSoql3=function(){return this.obj.Soql3__c},tsq.QueryObj.prototype.getScript1=function(){return this.obj.Script1__c},tsq.QueryObj.prototype.search=function(e,t){var a,o=[],s=0,i=this;
(a=function(){i.contact({funcName:"getExtResult",params:{soql:e,limit:200,offset:s}},function(e){o=o.concat(e.records),200<=e.records.length?(s+=200,setTimeout(a,100)):i.buildData(o)},t)})()},tsq.QueryObj.prototype.getCount=function(e,t){var a=this;a.contact({funcName:"getExtCount",params:{soql:e}},function(e){a.buildData(e)},t)},tsq.QueryObj.prototype.inputDownload=function(e,t,a){for(var o=""+(new Date).getTime(),
s=teasp.util.splitByLength(t,3e4),i=[],n=Math.ceil(s.length/9),r=0,l=0;l<n;l++){i[l]=[];for(var p=0;p<9;p++){var d=9*r+p;d<s.length&&i[l].push(s[d])}r++}for(var c=[],l=0;c.push({funcName:"inputData",params:{key:o,head:0==l?e:null,values:i[l],order:l+1}}),++l<i.length;);this.contact(c,function(e,t){c.length<=t+1&&(teasp.downloadHref(teasp.getPageUrl("extCsvView")+"?key="+o+(a?"&fname="+a:"")),setTimeout(dojo.hitch(
this,function(){this.downloadDone()}),100))},!0)},tsq.QueryObj.prototype.step=function(){console.log("step")},tsq.QueryObj.prototype.downloadDone=function(){teasp.manager.dialogClose("BusyWait")},tsq.QueryObj.prototype.buildForm0=function(){var e=dojo.byId("queryForm"),t=dojo.create("tbody",null,dojo.create("table",null,e)),t=dojo.create("tr",null,t),t=(dojo.create("div",{innerHTML:"Script"},dojo.create("td",null,t))
,dojo.create("textarea",{id:"queryScript",style:"width:500px;height:200px;"},dojo.create("td",null,t)),dojo.create("input",{type:"button",value:"実行"},e));dojo.connect(t,"onclick",this,function(){for(var e=dojo.byId("queryScript").value,t=dojo.byId("queryForm");t.firstChild;)dojo.destroy(t.firstChild);this.destroy(),dojo.eval(e),this.buildForm()})},tsq.QueryObj.prototype.buildData0=function(e){e=dojo.toJson(e);
this.inputDownload("",e)},teasp.provide("teasp.view.DataReader"),teasp.view.DataReader=function(e){this.errorAreaId="errorArea",this.ROW_MAX=40,this.valueCache={},this.stopped=!1,this.level=e,this.commonObj=null,this.handlesL1=[],this.hendlesL2=[],this.handlesL3=[],this.L1=1,this.L2=2,this.L3=4,this.bfld={id:1,name:2,createddate:3,createdbyid:4,lastmodifieddate:5,lastmodifiedbyid:6,systemmodstamp:7,isdeleted:8,
ownerid:9}},teasp.view.DataReader.prototype=new teasp.view.Base,teasp.view.DataReader.prototype.contact=function(e,t,a,o){teasp.action.contact.remoteMethods(is_array(e)?e:[e],{errorAreaId:e.errorAreaId||this.errorAreaId,nowait:o||!1},t,a,this)},teasp.view.DataReader.prototype.editable=function(){return"2"==this.level},teasp.view.DataReader.prototype.init=function(e,t){this.createTab(dojo.byId("baseArea")),
this.nameMap={},this.localNameMap={},this.contact({funcName:"getExtResult",params:{action:"SObjectList",keepNs:!0}},function(e){for(var t in this.sObjects=e.sObjects,this.sObjects){var a;this.sObjects.hasOwnProperty(t)&&((a=this.sObjects[t]).key=t,this.nameMap[a.name.toLowerCase()]=t,this.localNameMap[a.localName.toLowerCase()]=t)}this.createSelect(dojo.byId("dataReaderPane1")),this.createTsBaseArea(dojo.byId(
"dataReaderPane2")),this.getOrganization()},null,!1)},teasp.view.DataReader.prototype.getOrganization=function(){this.contact({funcName:"getExtResult",params:{action:"SObject",key:"organization"}},function(e,t){this.scanRefer(e,t,dojo.hitch(this,function(i){var n=this.getSoql(i);this.contact({funcName:"getExtResult",params:{soql:n,limit:null,offset:null}},function(e){this.organization=e.records[0];
var t=this.getSoqlFields(n),a=this.parseRecord(i,this.organization,t,!1);this.organizationValue="";for(var o=0;o<t.length;o++){var s=t[o];this.organizationValue+=("string"==typeof s?s:s.join("."))+"="+a[o]+"\n"}},null,!1)}))},null,!0)},teasp.view.DataReader.prototype.createTab=function(e){var t=dojo.create("div",{style:{width:"1800px",marginBottom:"8px"}},e),a=dojo.create("div",{id:"dataReaderTab1",
innerHTML:"Object",style:{border:"1px solid gray",display:"table",float:"left",padding:"2px 8px",marginRight:"10px",cursor:"pointer",fontWeight:"bold"}},t),o=dojo.create("div",{id:"dataReaderTab2",innerHTML:"TeamSpirit",style:{border:"1px solid gray",display:"table",float:"left",padding:"2px 8px",marginRight:"10px",cursor:"pointer"}},t),s=dojo.create("a",{innerHTML:"別ウィンドウを開く",style:{fontSize:"0.9em",cursor:"pointer"
}},dojo.create("div",{style:{display:"table",float:"left",padding:"2px 8px",marginLeft:"20px",marginRight:"10px"}},t));dojo.create("a",{innerHTML:"Download",id:"dataReaderDL",target:"_blank"},dojo.create("div",{style:{display:"none",float:"left",padding:"2px 8px",marginLeft:"20px",marginRight:"10px"}},t)),dojo.create("div",{style:{clear:"both"}},t),dojo.connect(s,"onclick",this,function(){window.open(location.href)})
,dojo.create("div",{id:"dataReaderPane1",style:{display:"table",position:"relative",zoom:1}},e),dojo.create("div",{id:"dataReaderPane2",style:{display:"none"}},e),dojo.connect(a,"onclick",this,function(e){dojo.style("dataReaderTab1","font-weight","bold"),dojo.style("dataReaderTab2","font-weight","normal"),dojo.style("dataReaderPane1","display","table"),dojo.style("dataReaderPane2","display","none"),
this.closeVertView()}),dojo.connect(o,"onclick",this,function(e){this.closeVertView(),dojo.style("dataReaderTab1","font-weight","normal"),dojo.style("dataReaderTab2","font-weight","bold"),dojo.style("dataReaderPane1","display","none"),dojo.style("dataReaderPane2","display","table"),this.onActiveTsAreaM()})},teasp.view.DataReader.prototype.switchBusy=function(e){e?teasp.manager.dialogOpen("BusyWait",null,null
):teasp.manager.dialogClose("BusyWait")},teasp.view.DataReader.prototype.getSObjectByKey=function(e){return this.sObjects[e]},teasp.view.DataReader.prototype.getFieldName=function(e){return e},teasp.view.DataReader.prototype.getFieldValue=function(e,t,a){for(var o=t.split("."),s=e,i=0;s&&i<o.length;i++)s=s[this.getFieldName(o[i])];return s||a},teasp.view.DataReader.prototype.getLocalName=function(e){var t=e.split(
"__");return 3==t.length?t[1]+"__"+t[2]:e},teasp.view.DataReader.prototype.getSObjectById=function(e){var t=e&&3<e.length?e.substring(0,3):null;if(!t)return null;var a,o=this.sObjects;for(a in o)if(o.hasOwnProperty(a)){var s=o[a];if(s.key=a,s.keyPrefix==t)return s}return null},teasp.view.DataReader.prototype.getSObjectKeyByName=function(e){var t,a=this.sObjects;for(t in a)if(a.hasOwnProperty(t))if(
a[t].name.toLowerCase()==e.toLowerCase())return t;return null},teasp.view.DataReader.prototype.isUnableSearchObject=function(e){var t,a=this.sObjects[e],o=this.sObjects;for(t in o)if(o.hasOwnProperty(t)){var s=o[t];if(s.localName.toLowerCase()==a.localName.toLowerCase())return s.name.length>a.name.length}return!1},teasp.view.DataReader.random62=function(e){for(var t="",a=1,o=0;o<e;o++)a*=10;for(var s=Math.floor(
Math.random()*a);0<s;)t="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ".charAt(s%62)+t,s=Math.floor(s/62);return t},teasp.view.DataReader.prototype.isReadOnlyField=function(e){if(!e||e.isCalculated||e.isAutoNumber)return!0;var t=e.name;return"ownerid"!=t.toLowerCase()&&(!e.isCustom&&"name"!=t.toLowerCase())},teasp.view.DataReader.prototype.getPickLabels=function(e,t,a){if(!e||e.length<=0)return"";
for(var o=[],s=0;s<e.length;s++)if(o.push(e[s][0]),a&&o.length>=a){o.push("※"+a+"件に達したため打ち切り※");break}return o.join(t)},teasp.view.DataReader.prototype.getTypeMap=function(e,t,a){for(var o={},s=this.excludeDuplicateField(e.fieldList||[]),i=0;i<s.length;i++){var n=s[i];a&&"REFERENCE"==n.typeName&&!n.isNillable||!t&&this.isReadOnlyField(n)||(o[n.name]=n.typeName)}return o},
teasp.view.DataReader.prototype.createSelect=function(e){var t,a=this.sObjects,n=[];for(t in a)a[t].key=t,n.push(a[t]);function o(){for(var e=dojo.byId("dataReaderCustomOnly").checked,t=dojo.byId("dataReaderSObject"),a=t.value,o=(dojo.empty(t),dojo.create("option",{innerHTML:"",value:"-"},t),null),s=0;s<n.length;s++){var i=n[s];e&&!i.isCustom||(dojo.create("option",{innerHTML:i.name+"("+i.label+")",value:i.key},t),
i.key==a&&(o=i.key))}o&&(t.value=o)}for(var n=n.sort(function(e,t){return e.name<t.name?-1:e.name>t.name?1:0}),s=dojo.create("div",{style:{padding:"1px"}},e),i=dojo.create("label",null,s),r=dojo.create("input",{type:"checkbox",id:"dataReaderCustomOnly"},i),r=(dojo.create("span",{innerHTML:" Custom Object Only"},i),r.checked=!0,dojo.connect(r,"onclick",this,o),dojo.create("select",{id:"dataReaderSObject",style:{
marginRight:"10px"}},e),o(),dojo.connect(dojo.byId("dataReaderSObject"),"onchange",this,function(){var e=dojo.byId("dataReaderSObject").value;"-"!=e&&(dojo.style("dataReaderOptionArea","display","table"),this.changeSelect(e))}),dojo.create("input",{type:"button",value:"Export",style:{padding:"1px 4px"}},e)),l=(dojo.connect(r,"onclick",this,function(){var s;this.dLdialog?this.dLdialog.show():(s=this,require([
"dijit/Dialog","dijit/ProgressBar"],function(e,t){s.dLdialog=new e({title:"Export",content:s.createDownloadPanel()});var a=new t({style:"width:340px;"}).placeAt(dojo.byId("dataReaderDLProgress")),o=dojo.hitch(this,function(t){dojo.query("input",dojo.byId("dataReaderDLArea")).forEach(function(e){e.disabled=t})}),e=(dojo.connect(dojo.byId("dataReaderDLCancel"),"onclick",s,function(){this.dLdialog.hide()}),dojo.connect(
dojo.byId("dataReaderDLGo"),"onclick",s,function(){dojo.style("dataReaderDLProgress","display",""),a.set({maximum:100,value:0}),o(!0);var t=dojo.byId("dataReaderDLDataDownload").checked;this.getBulkFields(a,t,function(e){t?this.buildDlRecord(e,a,function(){a.set({value:a.maximum})}):this.buildFieldListCsv(e,function(){o(!1),a.set({value:a.maximum}),dojo.style("dataReaderDLProgress","display","none")})},function(e){o(
!1),dojo.style("dataReaderDLProgress","display","none")})}),dojo.query('#dataReaderDLDataDone input[type="button"]')[0]);dojo.connect(e,"onclick",s,function(){o(!1),dojo.style("dataReaderDLDataDone","display","none"),dojo.style("dataReaderDLProgress","display","none")}),dojo.connect(dojo.byId("dataReaderDLDataDownload"),"onclick",s,function(e){dojo.byId("dataReaderDLDataWhere").disabled=!dojo.byId(
"dataReaderDLDataDownload").checked,dojo.byId("dataReaderDLDataAllRows").disabled=!dojo.byId("dataReaderDLDataDownload").checked}),s.dLdialog.show()}))}),s=dojo.create("div",{id:"dataReaderOptionArea",style:"display:none;margin-top:4px;"},e),[{toggle:"dataReaderAttrToggle",area:"dataReaderAttrArea",name:" Attribute"},{toggle:"dataReaderFieldToggle",area:"dataReaderFieldArea",name:" Fields"},{
toggle:"dataReaderRelationToggle",area:"dataReaderRelationArea",name:" RelationShip"},{toggle:"dataReaderRecordTextAreaToggle",area:"dataReaderRecordTextArea",name:" SOQL"}]),p=0;p<l.length;p++){var d=l[p],c=dojo.create("div",{style:{float:"left",marginRight:"10px"}},s),i=dojo.create("label",null,c),c=dojo.create("input",{type:"checkbox",id:d.toggle},i);dojo.create("span",{innerHTML:d.name},i),dojo.connect(c,
"onclick",this,function(){var t=d.toggle,a=d.area;return function(){var e=dojo.byId(t);e&&dojo.style(a,"display",e.checked?"table":"none")}}())}dojo.create("div",{style:{clear:"both"}},s),dojo.create("div",{id:"dataReaderDyna"},e)},teasp.view.DataReader.prototype.createTsBaseArea=function(e){e=dojo.create("div",{id:"dataReaderTsAreaM",style:{display:"table"}},e);this.createTsAreaM(e)},
teasp.view.DataReader.prototype.createTsAreaM=function(e){var e=dojo.create("div",{style:{margin:"8px 0px 8px 0px"}},e),t=(dojo.create("div",{innerHTML:"非標準オプション",style:{float:"left",marginRight:"4px",marginTop:"4px"}},e),dojo.create("input",{type:"text",value:"",id:"dataReaderDataLocalKey",style:{width:"200px",padding:"0px"},readonly:"readonly"},dojo.create("div",{style:{marginRight:"10px",marginBottom:"8px",
float:"left"}},e)),dojo.create("div",{style:{clear:"both"}},e),dojo.create("div",{style:{margin:"0px 0px 0px 20px"}},e)),a=dojo.create("div",{style:{margin:"4px 0px"}},t),o=dojo.create("label",null,a),t=(dojo.create("input",{type:"checkbox",id:"dataReaderDataLocalKeyOpt1"},o),dojo.create("span",{innerHTML:" Salesforceユーザに紐づかない社員を設定可"},o),a=dojo.create("div",{style:{margin:"4px 0px"}},t),o=dojo.create("label",null,a),
dojo.create("input",{type:"checkbox",id:"dataReaderDataLocalKeyOpt2"},o),dojo.create("span",{innerHTML:" （未使用）"},o),a=dojo.create("div",{style:{margin:"4px 0px"}},t),o=dojo.create("label",null,a),dojo.create("input",{type:"checkbox",id:"dataReaderDataLocalKeyOpt3"},o),dojo.create("span",{innerHTML:" 日次の申請を本日の前後１年以内にする制限を解除"},o),a=dojo.create("div",{style:{margin:"4px 0px"}},t),o=dojo.create("label",null,a),
dojo.create("input",{type:"checkbox",id:"dataReaderDataLocalKeyOpt4"},o),dojo.create("span",{innerHTML:" （未使用）"},o),a=dojo.create("div",{style:{margin:"4px 0px"}},t),o=dojo.create("label",null,a),dojo.create("input",{type:"checkbox",id:"dataReaderDataLocalKeyOpt5"},o),dojo.create("span",{innerHTML:" 勤怠設定の時刻の丸めに「30分刻み」を追加"},o),a=dojo.create("div",{style:{margin:"4px 0px"}},t),o=dojo.create("label",null,a),dojo.create(
"input",{type:"checkbox",id:"dataReaderDataLocalKeyOpt6"},o),dojo.create("span",{innerHTML:" 出退社時刻一括入力機能を追加"},o),a=dojo.create("div",{style:{margin:"4px 0px"}},t),o=dojo.create("label",null,a),dojo.create("input",{type:"checkbox",id:"dataReaderDataLocalKeyOpt7"},o),dojo.create("span",{innerHTML:" （未使用）"},o),a=dojo.create("div",{style:{margin:"4px 0px"}},t),o=dojo.create("label",null,a),dojo.create("input",{
type:"checkbox",id:"dataReaderDataLocalKeyOpt8"},o),dojo.create("span",{innerHTML:" 休暇申請の期間内の来月分を除いて有休残日数を計算"},o),a=dojo.create("div",{style:{margin:"4px 0px"}},t),o=dojo.create("label",null,a),dojo.create("input",{type:"checkbox",id:"dataReaderDataLocalKeyOpt10"},o),dojo.create("span",{innerHTML:" 振替申請と休日出勤申請の取消時に入力時間を強制クリア"},o),a=dojo.create("div",{style:{margin:"4px 0px"}},t),o=dojo.create("label",null,a),
dojo.create("input",{type:"checkbox",id:"dataReaderDataLocalKeyOpt11"},o),dojo.create("span",{innerHTML:" 出退社時刻が入力されていれば実労働時間が０時間でも実勤務日数にカウントする"},o),a=dojo.create("div",{style:{margin:"4px 0px"}},t),o=dojo.create("label",null,a),dojo.create("input",{type:"checkbox",id:"dataReaderDataLocalKeyOpt12"},o),dojo.create("span",{innerHTML:" 勤怠計算自動ベリファイをオンにする"},o),a=dojo.create("div",{style:{margin:"4px 0px"}},t),
o=dojo.create("label",null,a),dojo.create("input",{type:"checkbox",id:"dataReaderDataLocalKeyOpt13"},o),dojo.create("span",{innerHTML:" 事前申請の「申請なしで事後精算を開始できる」オプションを表示する"},o),a=dojo.create("div",{style:{margin:"4px 0px"}},t),o=dojo.create("label",null,a),dojo.create("input",{type:"checkbox",id:"dataReaderDataLocalKeyOpt14"},o),dojo.create("span",{
innerHTML:' 残業申請・早朝勤務申請の開始・終了時刻のデフォルト値をフレックス時間帯の境界とする<br/><span style="font-size:90%;">&nbsp;&nbsp;（フレックスタイム制で「申請の時間帯以外の勤務は認めない」オンの場合のみ有効）</span>'},o),a=dojo.create("div",{style:{margin:"4px 0px"}},t),o=dojo.create("label",null,a),dojo.create("input",{type:"checkbox",id:"dataReaderDataLocalKeyOpt15"},o),dojo.create("span",{innerHTML:" 経費精算のCSV読込機能を有効にする"},o),a=dojo.create("div",{style:{margin:"4px 0px"}},t),
o=dojo.create("label",null,a),dojo.create("input",{type:"checkbox",id:"dataReaderDataLocalKeyOpt16"},o),dojo.create("span",{innerHTML:' 勤怠日次レコードの備考に入力がなければ備考入力済みと判定しない<br/><span style="font-size:90%;">&nbsp;&nbsp;（システム設定の「ＸＸＸは備考必須にする」=オンかつ「申請の備考と日次の備考を保存時に結合しない」=オンの場合のみ有効）</span>'},o),a=dojo.create("div",{style:{margin:"4px 0px"}},t),o=dojo.create("label",null,a),dojo.create("input",{type:"checkbox",
id:"dataReaderDataLocalKeyOpt17"},o),dojo.create("span",{innerHTML:' 勤務表をモバイルブラウザで開く際にヘッダを表示する<br/><span style="font-size:90%;">&nbsp;&nbsp;（TS1勤務表モバイル専用画面をブラウザで作動させる時はオンにしないこと。<br/>&nbsp;&nbsp;&nbsp;Salesforce1で画面の左右に余白が追加され、Salesforce1を使う場合は見栄えの問題で非推奨）</span>'},o),dojo.create("hr",{style:"bordr:1px solid #eee;"},e),a=dojo.create("div",{style:{margin:"4px 0px"}},e),dojo.create("span",{innerHTML:"有休を何か月前の勤怠確定時に付与するか"
},a),dojo.create("input",{type:"text",id:"dataReaderDataYuqProvidePriorMonth",className:"inputran",maxLength:2,style:{width:"24px",marginLeft:"10px",textAlign:"right",padding:"1px 4px"}},a),dojo.create("span",{innerHTML:"（YuqProvidePriorMonth__c）"},a),a=dojo.create("div",{style:{margin:"4px 0px"}},e),dojo.create("span",{innerHTML:"事前申請及び経費精算の１申請あたりの明細数の上限"},a),dojo.create("input",{type:"text",
id:"dataReaderExpCountLimit",className:"inputran",maxLength:3,style:{width:"30px",marginLeft:"10px",textAlign:"right",padding:"1px 4px"}},a),dojo.create("span",{innerHTML:"（ExpPreApplyConfig__c.expCountLimit）"},a),a=dojo.create("div",{style:{margin:"4px 0px"}},e),o=dojo.create("label",null,a),dojo.create("input",{type:"checkbox",id:"dataReaderEnableShift"},o),dojo.create("span",{innerHTML:" シフト管理機能を有効にする"},o),
a=dojo.create("div",{style:{margin:"4px 0px"}},e),o=dojo.create("label",null,a),dojo.create("input",{type:"checkbox",id:"dataReaderEnableShiftCsvImport"},o),dojo.create("span",{innerHTML:" シフト管理のCSVインポート機能を有効にする"},o),a=dojo.create("div",{style:{margin:"4px 0px"}},e),o=dojo.create("label",null,a),dojo.create("input",{type:"checkbox",id:"dataReaderEnableShiftImportToolDownload"},o),dojo.create("span",{
innerHTML:" シフト登録ツールのダウンロードリンクを表示する",style:"margin-right:30px;"},o),dojo.create("span",{innerHTML:" ダウンロードリンクを差し替え"},a),dojo.create("input",{type:"text",id:"dataReaderShiftImportToolCustomURL",className:"inputran",maxLength:255,style:{width:"300px",marginLeft:"10px",marginRight:"10px",textAlign:"left",padding:"1px 4px"}},a),a=dojo.create("div",{style:{margin:"4px 0px"}},e),o=dojo.create("label",null,a),dojo.create(
"input",{type:"checkbox",id:"dataReaderUseShiftValidationSetting"},o),dojo.create("span",{innerHTML:" シフトバリデーションを設定する",style:"margin-right:30px;"},o),a=dojo.create("div",{style:{margin:"4px 0px"}},e),o=dojo.create("label",null,a),dojo.create("input",{type:"checkbox",id:"dataReaderEnableAccessControlSystem"},o),dojo.create("span",{innerHTML:" 入退館管理機能を有効にする"},o),a=dojo.create("div",{style:{margin:"4px 0px"}},e),
o=dojo.create("label",null,a),dojo.create("input",{type:"checkbox",id:"dataReaderDivergenceInnerCheck"},o),dojo.create("span",{innerHTML:" 入退館管理機能の内側の乖離判定を有効にする"},o),a=dojo.create("div",{style:{margin:"4px 0px"}},e),o=dojo.create("label",null,a),dojo.create("input",{type:"checkbox",id:"dataReaderSuppressDivergenceCheck"},o),dojo.create("span",{innerHTML:" 入退館管理機能：月次確定後は乖離判定しない"},o),a=dojo.create("div",{style:{
margin:"4px 0px 0px 0px"}},e),o=dojo.create("label",null,a),dojo.create("input",{type:"checkbox",id:"dataReaderAutoReJudgeDaysCheck"},o),dojo.create("span",{innerHTML:" 入退館管理機能：再判定期間"},o),dojo.create("input",{type:"text",id:"dataReaderAutoReJudgeDays",className:"inputran",maxLength:2,style:{width:"20px",marginLeft:"8px",marginRight:"8px",textAlign:"right",padding:"1px 4px"}},a)),t=(dojo.connect(t,"blur",this,
this.enterAutoReJudgeDays),dojo.connect(t,"keypress",this,function(e){13==e.keyCode&&this.enterAutoReJudgeDays(e)}),dojo.create("span",{innerHTML:"日"},a),(a=dojo.create("div",{style:"margin-left:20px;font-size:90%;"},e)).innerHTML="バッチ実行時間から上記日数以内に追加/更新/削除された入退館ログがある日付に対して、乖離判定フラグの状態によらず強制的に再判定を行う（その際、前日の判定も更新される場合がある）。",a=dojo.create("div",{style:{margin:"4px 0px"}},e),o=dojo.create("label",null,a),dojo.create(
"input",{type:"checkbox",id:"dataReaderTimeReportDedicatedToJob"},o),dojo.create("span",{innerHTML:" タイムレポートの勤怠情報と経費精算を非表示にする"},o),dojo.create("hr",{style:"bordr:1px solid #eee;"},e),a=dojo.create("div",{style:{margin:"4px 0px"}},e),o=dojo.create("label",null,a),dojo.create("input",{type:"checkbox",id:"dataReaderWarningOnMAPHW"},o),dojo.create("span",{innerHTML:" 工数実績画面に勤務時間と工数時間不一致の警告アイコンを表示する"},o),a=dojo.create(
"div",{style:{margin:"4px 0px"}},e),o=dojo.create("label",null,a),dojo.create("input",{type:"checkbox",id:"dataReaderRecalcTimeOnJobFix"},o),dojo.create("span",{innerHTML:" 工数確定申請時に工数の再計算を行う"},o),a=dojo.create("div",{style:{margin:"4px 0px"}},e),o=dojo.create("label",null,a),dojo.create("input",{type:"checkbox",id:"dataReaderCheckTimeOnJobFix"},o),dojo.create("span",{innerHTML:" 工数確定申請時に工数の再計算＋工数と勤務時間のチェックを行う"},o),
a=dojo.create("div",{style:{margin:"4px 0px"}},e),o=dojo.create("label",null,a),dojo.create("input",{type:"checkbox",id:"dataReaderCheckInputWorkHours"},o),dojo.create("span",{innerHTML:" 工数実績入力時に工数と勤務時間が合わなければ入力不可とする"},o),dojo.create("hr",{style:"bordr:1px solid #eee;"},e),a=dojo.create("div",{style:{margin:"4px 0px"}},e),o=dojo.create("label",null,a),dojo.create("input",{type:"checkbox",
id:"dataReaderTs1OptimizeOnBrowser"},o),dojo.create("span",{innerHTML:" TS1勤務表モバイル専用画面をエミュレータやモバイルブラウザで作動させる"},o),a=dojo.create("div",{style:{margin:"4px 0px"}},e),dojo.create("span",{innerHTML:"TS1勤務表モバイル専用化の境界幅 "},a),dojo.create("input",{type:"text",id:"dataReaderTs1OptimizeWidth",className:"inputran",maxLength:3,style:{width:"30px",marginLeft:"10px",marginRight:"10px",textAlign:"right",padding:"1px 4px"}},a),
dojo.create("span",{innerHTML:"未満 (Null時のデフォルトは768)"},a),a=dojo.create("div",{style:{margin:"4px 0px"}},e),o=dojo.create("label",null,a),dojo.create("input",{type:"checkbox",id:"dataReaderHidePersonalInfo"},o),dojo.create("span",{innerHTML:" 個人設定を非表示にする"},o),a=dojo.create("div",{style:{margin:"4px 0px"}},e),o=dojo.create("label",null,a),dojo.create("input",{type:"checkbox",id:"dataReaderUseJsNaviDummy"},o),
dojo.create("span",{innerHTML:" J'sNAVIダミーを使用する（本番環境では使用不可）"},o),a=dojo.create("div",{style:{margin:"4px 0px"}},e),o=dojo.create("label",null,a),dojo.create("input",{type:"checkbox",id:"dataReaderAdjustLateTimeEarlyTime"},o),dojo.create("span",{innerHTML:" 退社後または出社前に時間単位休や半休がある時、定時で所定勤務に達していれば遅刻・早退時間をカウントしない"},o),dojo.create("hr",{style:"bordr:1px solid #eee;"},e),a=dojo.create("div",{style:{margin:"4px 0px"}},e),
o=dojo.create("label",null,a),dojo.create("input",{type:"checkbox",id:"dataReaderUseExpPayPrint"},o),dojo.create("span",{innerHTML:" 経費精算の消込画面に印刷ボタンを表示する"},o),a=dojo.create("div",{style:{margin:"4px 0px"}},e),o=dojo.create("label",null,a),dojo.create("span",{innerHTML:" 経費精算：電帳法オプションがオンの場合でも精算取消が可能な期間"},o),dojo.create("input",{type:"date",id:"dataReaderExpCancelDeadline",className:"inputran",maxLength:3,style:{
width:"140px",marginLeft:"10px",marginRight:"10px",textAlign:"right",padding:"1px 4px"}},a),dojo.create("span",{innerHTML:" 23:59まで"},a),a=dojo.create("div",{style:{margin:"4px 0px"}},e),o=dojo.create("label",null,a),dojo.create("input",{type:"checkbox",id:"dataReaderUseExpEntryData"},o),dojo.create("span",{innerHTML:" 仕訳データCSV出力を使用する",style:"margin-right:30px;"},o),dojo.create("span",{innerHTML:"Visualforceページ "},a)
,dojo.create("input",{type:"text",id:"dataReaderExpEntryDataUrl",className:"inputran",maxLength:255,style:{width:"300px",marginLeft:"10px",marginRight:"10px",textAlign:"left",padding:"1px 4px"}},a),a=dojo.create("div",{style:{margin:"4px 0px"}},e),o=dojo.create("label",null,a),dojo.create("input",{type:"checkbox",id:"overwriteStampEndTime"},o),dojo.create("span",{innerHTML:" 勤怠連携バッチで反映されるデータで、退社打刻を常に上書きする"},o),
a=dojo.create("div",{style:{margin:"4px 0px"}},e),o=dojo.create("label",null,a),dojo.create("input",{type:"checkbox",id:"dataReaderUseShiftChange"},o),dojo.create("span",{innerHTML:" シフト振替申請を利用可能にする"},o),dojo.create("span",{innerHTML:"（同月度同週内の勤務日/非勤務日のシフト設定を入れ替える。振替申請との併用不可）",style:"font-size:90%;"},o),a=dojo.create("div",{style:{margin:"4px 0px"}},e),o=dojo.create("label",null,a),dojo.create("input",{
type:"checkbox",id:"dataReaderUse36AgreementCap"},o),dojo.create("span",{innerHTML:" 36協定上限設定を勤務体系設定画面に表示する"},o),dojo.create("hr",{style:"bordr:1px solid #eee;"},e),a=dojo.create("div",{style:{margin:"4px 0px"}},e),o=dojo.create("label",null,a),dojo.create("input",{type:"checkbox",id:"dataReaderTestEnvironment"},o),dojo.create("span",{innerHTML:" テスト環境である（テスト支援ツールでデータの削除・更新可）"},o),a=dojo.create("div",{style:{
margin:"12px 4px"}},e),dojo.create("input",{type:"button",value:"保存",id:"dataReaderDataLocalKeySave",style:{padding:"1px 2px"}},a)),o=(dojo.connect(t,"onclick",this,function(){dojo.byId("dataReaderDataLocalKeyResult").innerHTML="";var t=dojo.byId("dataReaderDataLocalKey").value,a=dojo.byId("dataReaderDataYuqProvidePriorMonth").value,e=dojo.byId("dataReaderExpCountLimit").value,o=dojo.byId("dataReaderEnableShift"
).checked,s=dojo.byId("dataReaderEnableShiftCsvImport").checked,i=dojo.byId("dataReaderEnableShiftImportToolDownload").checked,n=dojo.byId("dataReaderUseShiftValidationSetting").checked,r=dojo.byId("dataReaderShiftImportToolCustomURL").value,l=dojo.byId("dataReaderEnableAccessControlSystem").checked,p=dojo.byId("dataReaderDivergenceInnerCheck").checked,d=dojo.byId("dataReaderSuppressDivergenceCheck").checked,
c=dojo.byId("dataReaderAutoReJudgeDaysCheck").checked,m=dojo.byId("dataReaderAutoReJudgeDays").value,h=dojo.byId("dataReaderTimeReportDedicatedToJob").checked,u=dojo.byId("dataReaderWarningOnMAPHW").checked,g=dojo.byId("dataReaderRecalcTimeOnJobFix").checked,y=dojo.byId("dataReaderCheckTimeOnJobFix").checked,f=dojo.byId("dataReaderCheckInputWorkHours").checked,b=dojo.byId("dataReaderTs1OptimizeOnBrowser").checked,
_=dojo.byId("dataReaderTs1OptimizeWidth").value,v=dojo.byId("dataReaderHidePersonalInfo").checked,T=dojo.byId("dataReaderUseJsNaviDummy").checked,j=dojo.byId("dataReaderAdjustLateTimeEarlyTime").checked,E=dojo.byId("dataReaderUseExpPayPrint").checked,L=dojo.byId("dataReaderExpCancelDeadline").value,k=dojo.byId("dataReaderUseExpEntryData").checked,D=dojo.byId("dataReaderExpEntryDataUrl").value,I=dojo.byId(
"overwriteStampEndTime").checked,A=dojo.byId("dataReaderUseShiftChange").checked,S=dojo.byId("dataReaderUse36AgreementCap").checked,x=dojo.byId("dataReaderTestEnvironment").checked;if(""!=a){if(!/^\d+$/.test(a))return void teasp.tsAlert("有休を何か月前の勤怠確定時に付与するかの値は数値を入力してください");a=parseInt(a,10)}else dojo.byId("dataReaderDataYuqProvidePriorMonth").value="",a=null;if(e){if(!/^\d+$/.test(e))return void teasp.tsAlert(
"経費精算で申請あたりの明細数の上限の値は数値を入力してください");e=parseInt(e,10)}else e=null;if(c){if(!/^\d+$/.test(m))return dojo.byId("dataReaderAutoReJudgeDays").focus(),void teasp.tsAlert("入退館管理機能：再判定期間の値は数値を入力してください");m=parseInt(m,10)}else m=null,dojo.byId("dataReaderAutoReJudgeDays").value="";var c=teasp.prefixBar+"LocalKey__c",w=teasp.prefixBar+"YuqProvidePriorMonth__c",M=teasp.prefixBar+"ExpPreApplyConfig__c",
O=teasp.prefixBar+"Config__c",H=teasp.prefixBar+"UseAccessControlSystem__c",R={},N=(R[this.commonObj.Id]={},R[this.commonObj.Id][c]=t,R[this.commonObj.Id][w]=a,{});if(N[c]="STRING",N[w]="DOUBLE",N[M]="STRING",N[O]="STRING",e!=this.getExpCountLimit()&&(this.commonObj.ExpPreApplyConfig__c||(this.commonObj.ExpPreApplyConfig__c={}),e!=this.getExpCountLimit()&&(this.commonObj.ExpPreApplyConfig__c.expCountLimit=e),
R[this.commonObj.Id][M]=dojo.toJson(this.commonObj.ExpPreApplyConfig__c)),""!=_){if(!/^\d+$/.test(_))return void teasp.tsAlert("TS1勤務表モバイル化の作動境界幅の値は無効です");_=parseInt(_,10)}else dojo.byId("dataReaderTs1OptimizeWidth").value="",_=null;o==this.getEnableShift()&&s==this.getEnableShiftCsvImport()&&i==this.getEnableShiftImportToolDownload()&&n==this.getUseShiftValidationSetting()&&r==this.getShiftImportToolCustomURL(
)&&h==this.getTimeReportDedicatedToJob()&&u==this.getWarningOnMAPHW()&&g==this.getRecalcTimeOnJobFix()&&y==this.getCheckTimeOnJobFix()&&f==this.getCheckInputWorkHours()&&b==this.getTs1OptimizeOnBrowser()&&_==this.getTs1OptimizeWidth()&&v==this.getHidePersonalInfo()&&p==this.getDivergenceInnerCheck()&&d==this.getSuppressDivergenceCheck()&&m==this.getAutoReJudgeDays()&&T==this.getUseJsNaviDummy(
)&&j==this.getAdjustLateTimeEarlyTime()&&E==this.getUseExpPayPrint()&&L==this.getExpCancelDeadline()&&k==this.getUseExpEntryData()&&D==this.getExpEntryDataUrl()&&I==this.getOverwriteStampEndTime()&&A==this.getUseShiftChange()&&S==this.getUse36AgreementCap()&&x==this.getTestEnvironment()||(this.commonObj.Config__c||(this.commonObj.Config__c={}),this.commonObj.Config__c.enableShiftManagement=o,
this.commonObj.Config__c.enableShiftCsvImport=s,this.commonObj.Config__c.enableShiftImportToolDownload=i,this.commonObj.Config__c.useShiftValidationSetting=n,this.commonObj.Config__c.shiftImportToolCustomURL=r,this.commonObj.Config__c.timeReportDedicatedToJob=h,this.commonObj.Config__c.warningOnMAPHW=u,this.commonObj.Config__c.recalcTimeOnJobFix=g,this.commonObj.Config__c.checkTimeOnJobFix=y,
this.commonObj.Config__c.checkInputWorkHours=f,this.commonObj.Config__c.ts1OptimizeOnBrowser=b,this.commonObj.Config__c.ts1OptimizeWidth=_,this.commonObj.Config__c.hidePersonalInfo=v,this.commonObj.Config__c.DivergenceInnerCheck=p,this.commonObj.Config__c.SuppressDivergenceCheckOnFixedMonth=d,this.commonObj.Config__c.useJsNaviDummy=T,this.commonObj.Config__c.adjustLateTimeEarlyTime=j,
this.commonObj.Config__c.useExpPayPrint=E,this.commonObj.Config__c.expCancelDeadline=L,this.commonObj.Config__c.useExpEntryData=k,this.commonObj.Config__c.expEntryDataUrl=D,this.commonObj.Config__c.overwriteStampEndTime=I,this.commonObj.Config__c.useShiftChange=A,this.commonObj.Config__c.use36AgreementCap=S,this.commonObj.Config__c.testEnvironment=x,
null===m?void 0!==this.commonObj.Config__c.AutoReJudgeDays&&delete this.commonObj.Config__c.AutoReJudgeDays:this.commonObj.Config__c.AutoReJudgeDays=m,R[this.commonObj.Id][O]=dojo.toJson(this.commonObj.Config__c)),l!=this.getEnableAccessControlSystem()&&(N[H]="BOOLEAN",R[this.commonObj.Id][H]=l);c=[];c.push(this.commonObj.Id),this.contact({funcName:"getExtResult",params:{action:"updateSObject",
objName:teasp.prefixBar+"AtkCommon__c",idList:c,values:R,typeMap:N}},dojo.hitch(this,function(e){this.commonObj.LocalKey__c=t,this.commonObj.YuqProvidePriorMonth__c=a,dojo.byId("dataReaderDataLocalKeyResult").innerHTML="保存しました"}),function(e){teasp.message.alertError(e)},!0)}),a=dojo.create("div",{style:{margin:"12px 4px"}},e),dojo.create("div",{id:"dataReaderDataLocalKeyResult"},a),this.localKeyOpts=[{
id:"dataReaderDataLocalKeyOpt1",pos:0,value:"132DBE4"},{id:"dataReaderDataLocalKeyOpt2",pos:7,value:"1"},{id:"dataReaderDataLocalKeyOpt3",pos:8,value:"1"},{id:"dataReaderDataLocalKeyOpt4",pos:9,value:"1"},{id:"dataReaderDataLocalKeyOpt5",pos:10,value:"1"},{id:"dataReaderDataLocalKeyOpt6",pos:11,value:"1"},{id:"dataReaderDataLocalKeyOpt7",pos:12,value:"1"},{id:"dataReaderDataLocalKeyOpt8",pos:13,value:"1"},{
id:"dataReaderDataLocalKeyOpt10",pos:15,value:"1"},{id:"dataReaderDataLocalKeyOpt11",pos:16,value:"1"},{id:"dataReaderDataLocalKeyOpt12",pos:17,value:"1"},{id:"dataReaderDataLocalKeyOpt13",pos:18,value:"1"},{id:"dataReaderDataLocalKeyOpt14",pos:19,value:"1"},{id:"dataReaderDataLocalKeyOpt15",pos:20,value:"1"},{id:"dataReaderDataLocalKeyOpt16",pos:21,value:"1"},{id:"dataReaderDataLocalKeyOpt17",pos:22,value:"1"}],
this.localKeyOpts[this.localKeyOpts.length-1]),s=o.pos+o.value.length;this.offLocalKey="";for(var i=0;i<s;i++)this.offLocalKey+="0";for(i=0;i<this.localKeyOpts.length;i++){var n=this.localKeyOpts[i];dojo.connect(dojo.byId(n.id),"onclick",this,function(t){return function(){var e=(dojo.byId("dataReaderDataLocalKey").value+this.offLocalKey).substring(0,this.offLocalKey.length);dojo.byId("dataReaderDataLocalKey"
).value=e.substring(0,t.pos)+(dojo.byId(t.id).checked?t.value:this.offLocalKey.substring(0,t.value.length))+e.substring(t.pos+t.value.length)}}(n))}},teasp.view.DataReader.prototype.setLocalKey=function(){for(var e=this.commonObj&&this.commonObj.LocalKey__c||"",t=this.commonObj?this.commonObj.YuqProvidePriorMonth__c:"",a=(e+this.offLocalKey).substring(0,this.offLocalKey.length),o=0;o<this.localKeyOpts.length;o++){
var s=this.localKeyOpts[o];dojo.byId(s.id).checked=a.substring(s.pos,s.pos+s.value.length)==s.value}var e=this.commonObj&&this.commonObj.ExpPreApplyConfig__c||null,e=(e&&(this.commonObj.ExpPreApplyConfig__c=dojo.fromJson(e)),this.commonObj&&this.commonObj.Config__c||null),e=(e&&(this.commonObj.Config__c=dojo.fromJson(e)),this.getExpCountLimit()||100),i=this.getAutoReJudgeDays();dojo.byId("dataReaderDataLocalKey"
).value=a,dojo.byId("dataReaderDataYuqProvidePriorMonth").value="number"==typeof t?t:"",dojo.byId("dataReaderExpCountLimit").value=""+e,dojo.byId("dataReaderEnableShift").checked=this.getEnableShift(),dojo.byId("dataReaderEnableShiftCsvImport").checked=this.getEnableShiftCsvImport(),dojo.byId("dataReaderEnableShiftImportToolDownload").checked=this.getEnableShiftImportToolDownload(),dojo.byId(
"dataReaderUseShiftValidationSetting").checked=this.getUseShiftValidationSetting(),dojo.byId("dataReaderShiftImportToolCustomURL").value=this.getShiftImportToolCustomURL(),dojo.byId("dataReaderEnableAccessControlSystem").checked=this.getEnableAccessControlSystem(),dojo.byId("dataReaderTimeReportDedicatedToJob").checked=this.getTimeReportDedicatedToJob(),dojo.byId("dataReaderWarningOnMAPHW"
).checked=this.getWarningOnMAPHW(),dojo.byId("dataReaderRecalcTimeOnJobFix").checked=this.getRecalcTimeOnJobFix(),dojo.byId("dataReaderCheckTimeOnJobFix").checked=this.getCheckTimeOnJobFix(),dojo.byId("dataReaderCheckInputWorkHours").checked=this.getCheckInputWorkHours(),dojo.byId("dataReaderTs1OptimizeOnBrowser").checked=this.getTs1OptimizeOnBrowser(),dojo.byId("dataReaderTs1OptimizeWidth"
).value=this.getTs1OptimizeWidth(),dojo.byId("dataReaderHidePersonalInfo").checked=this.getHidePersonalInfo(),dojo.byId("dataReaderDivergenceInnerCheck").checked=this.getDivergenceInnerCheck(),dojo.byId("dataReaderSuppressDivergenceCheck").checked=this.getSuppressDivergenceCheck(),dojo.byId("dataReaderUseJsNaviDummy").checked=this.getUseJsNaviDummy(),dojo.byId("dataReaderAdjustLateTimeEarlyTime"
).checked=this.getAdjustLateTimeEarlyTime(),dojo.byId("dataReaderAutoReJudgeDaysCheck").checked=null!==i,dojo.byId("dataReaderAutoReJudgeDays").value=null===i?"":i,dojo.byId("dataReaderUseExpPayPrint").checked=this.getUseExpPayPrint(),dojo.byId("dataReaderExpCancelDeadline").value=this.getExpCancelDeadline(),dojo.byId("dataReaderUseExpEntryData").checked=this.getUseExpEntryData(),dojo.byId("dataReaderExpEntryDataUrl"
).value=this.getExpEntryDataUrl(),dojo.byId("overwriteStampEndTime").checked=this.getOverwriteStampEndTime(),dojo.byId("dataReaderUseShiftChange").checked=this.getUseShiftChange(),dojo.byId("dataReaderUse36AgreementCap").checked=this.getUse36AgreementCap(),dojo.byId("dataReaderTestEnvironment").checked=this.getTestEnvironment()},teasp.view.DataReader.prototype.getExpCountLimit=function(){
return this.commonObj&&this.commonObj.ExpPreApplyConfig__c&&this.commonObj.ExpPreApplyConfig__c.expCountLimit||null},teasp.view.DataReader.prototype.getEnableShift=function(){return this.commonObj&&this.commonObj.Config__c&&this.commonObj.Config__c.enableShiftManagement||!1},teasp.view.DataReader.prototype.getEnableShiftCsvImport=function(){
return this.commonObj&&this.commonObj.Config__c&&this.commonObj.Config__c.enableShiftCsvImport||!1},teasp.view.DataReader.prototype.getEnableShiftImportToolDownload=function(){return this.commonObj&&this.commonObj.Config__c&&this.commonObj.Config__c.enableShiftImportToolDownload||!1},teasp.view.DataReader.prototype.getUseShiftValidationSetting=function(){
return this.commonObj&&this.commonObj.Config__c&&this.commonObj.Config__c.useShiftValidationSetting||!1},teasp.view.DataReader.prototype.getShiftImportToolCustomURL=function(){return this.commonObj&&this.commonObj.Config__c&&this.commonObj.Config__c.shiftImportToolCustomURL||""},teasp.view.DataReader.prototype.getEnableAccessControlSystem=function(){return this.commonObj&&this.commonObj.UseAccessControlSystem__c||!1}
,teasp.view.DataReader.prototype.getTimeReportDedicatedToJob=function(){return this.commonObj&&this.commonObj.Config__c&&this.commonObj.Config__c.timeReportDedicatedToJob||!1},teasp.view.DataReader.prototype.getWarningOnMAPHW=function(){return this.commonObj&&this.commonObj.Config__c&&this.commonObj.Config__c.warningOnMAPHW||!1},teasp.view.DataReader.prototype.getRecalcTimeOnJobFix=function(){
return this.commonObj&&this.commonObj.Config__c&&this.commonObj.Config__c.recalcTimeOnJobFix||!1},teasp.view.DataReader.prototype.getCheckTimeOnJobFix=function(){return this.commonObj&&this.commonObj.Config__c&&this.commonObj.Config__c.checkTimeOnJobFix||!1},teasp.view.DataReader.prototype.getCheckInputWorkHours=function(){
return this.commonObj&&this.commonObj.Config__c&&this.commonObj.Config__c.checkInputWorkHours||!1},teasp.view.DataReader.prototype.getTs1OptimizeOnBrowser=function(){return this.commonObj&&this.commonObj.Config__c&&this.commonObj.Config__c.ts1OptimizeOnBrowser||!1},teasp.view.DataReader.prototype.getTs1OptimizeWidth=function(){
return this.commonObj&&this.commonObj.Config__c&&this.commonObj.Config__c.ts1OptimizeWidth||null},teasp.view.DataReader.prototype.getOverwriteStampEndTime=function(){return this.commonObj&&this.commonObj.Config__c&&this.commonObj.Config__c.overwriteStampEndTime||null},teasp.view.DataReader.prototype.getTestEnvironment=function(){
return this.commonObj&&this.commonObj.Config__c&&this.commonObj.Config__c.testEnvironment||!1},teasp.view.DataReader.prototype.onActiveTsAreaM=function(){var e,t;this.commonObj||(e=this.getSObjectByKey(this.nameMap[(teasp.prefixBar+"atkcommon__c").toLowerCase()]),t={soql:"select Id, LocalKey__c, YuqProvidePriorMonth__c, ExpPreApplyConfig__c, Config__c, UseAccessControlSystem__c from AtkCommon__c",cntAll:1,rowMax:1,
pageNo:1,callback:dojo.hitch(this,function(e,t){0<t.length&&(this.commonObj=t[0]),this.setLocalKey()})},this.search2(e,t,!1))},teasp.view.DataReader.prototype.getHidePersonalInfo=function(){return this.commonObj&&this.commonObj.Config__c&&this.commonObj.Config__c.hidePersonalInfo||!1},teasp.view.DataReader.prototype.getDivergenceInnerCheck=function(){
return this.commonObj&&this.commonObj.Config__c&&this.commonObj.Config__c.DivergenceInnerCheck||!1},teasp.view.DataReader.prototype.getSuppressDivergenceCheck=function(){return this.commonObj&&this.commonObj.Config__c&&this.commonObj.Config__c.SuppressDivergenceCheckOnFixedMonth||!1},teasp.view.DataReader.prototype.getAutoReJudgeDays=function(){
var e=this.commonObj&&this.commonObj.Config__c&&this.commonObj.Config__c.AutoReJudgeDays;return"number"==typeof e?e:null},teasp.view.DataReader.prototype.getUseJsNaviDummy=function(){return this.commonObj&&this.commonObj.Config__c&&this.commonObj.Config__c.useJsNaviDummy||!1},teasp.view.DataReader.prototype.getAdjustLateTimeEarlyTime=function(){
return this.commonObj&&this.commonObj.Config__c&&this.commonObj.Config__c.adjustLateTimeEarlyTime||!1},teasp.view.DataReader.prototype.getUseExpPayPrint=function(){return this.commonObj&&this.commonObj.Config__c&&this.commonObj.Config__c.useExpPayPrint||!1},teasp.view.DataReader.prototype.getExpCancelDeadline=function(){return this.commonObj&&this.commonObj.Config__c&&this.commonObj.Config__c.expCancelDeadline||""},
teasp.view.DataReader.prototype.getUseExpEntryData=function(){return this.commonObj&&this.commonObj.Config__c&&this.commonObj.Config__c.useExpEntryData||!1},teasp.view.DataReader.prototype.getExpEntryDataUrl=function(){return this.commonObj&&this.commonObj.Config__c&&this.commonObj.Config__c.expEntryDataUrl||""},teasp.view.DataReader.prototype.getUseShiftChange=function(){
return this.commonObj&&this.commonObj.Config__c&&this.commonObj.Config__c.useShiftChange||!1},teasp.view.DataReader.prototype.getUse36AgreementCap=function(){return this.commonObj&&this.commonObj.Config__c&&this.commonObj.Config__c.use36AgreementCap||!1},teasp.view.DataReader.prototype.createDownloadPanel=function(){
return'<div id="dataReaderDLArea">  <div style="padding:4px;">    <div style="float:left;padding-top:2px;padding-right:8px;">API参照名</div>    <div style="float:left;"><input type="text" id="dataReaderDLName" style="width:260px;" /></div>    <div style="clear:both;"></div>    <div style="float:left;margin-left:70px;"><label><input type="radio" name="dataReaderDLNameOpt" id="dataReaderDLNameOpt1" checked="checked" /><span> 前方一致</span></label></div>    <div style="float:left;"                 ><label><input type="radio" name="dataReaderDLNameOpt" id="dataReaderDLNameOpt2"                   /><span> 完全一致</span></label></div>    <div style="clear:both;"></div>    <div style="margin-left:70px;font-size:90%;">（カンマ区切りで複数指定可）</div>  </div>  <div><label><input type="checkbox" id="dataReaderDLCustomObjectOnly"   checked="checked" /><span> カスタムオブジェクトのみ                      </span></label></div>  <div><label><input type="checkbox" id="dataReaderDLExcludeRemoveObject"                  /><span> ラベル名に「削除予定」を含むオブジェクトを除く</span></label></div>  <div><label><input type="checkbox" id="dataReaderDLExcludeFeedObject"  checked="checked" /><span> フィードオブジェクトを除く                    </span></label></div>  <table>  <tr><td colSpan="2" style="border-top:1px dashed #e0e0e0;"></td></tr>  <tr><td>フィールド定義  </td><td>  <div><label><input type="checkbox" id="dataReaderDLCustomFieldOnly"                      /><span> カスタム項目のみ                              </span></label></div>  <div><label><input type="checkbox" id="dataReaderDLExcludeRemoveField"                   /><span> ラベル名に「削除予定」を含む項目を除く        </span></label></div>  <div><label><input type="checkbox" id="dataReaderDLExcludeCalcField"                     /><span> 数式項目を除く                                </span></label></div>  <div><label><input type="checkbox" id="dataReaderDLCutPickList"                          /><span> 選択リスト値の出力は最大100件                 </span></label></div>  <div><label><input type="checkbox" id="dataReaderDLLastReferencedDate"                   /><span> 「最終参照日」を含める                        </span></label></div>  </td></tr>  <tr><td colSpan="2" style="border-top:1px dashed #e0e0e0;"></td></tr>  <tr><td colSpan="2">    <div><label><input type="checkbox" id="dataReaderDLUseLocalNameField"  checked="checked" /><span> localName で出力                            </span></label></div>  </td></tr>  <tr><td colSpan="2" style="border-top:1px dashed #e0e0e0;"></td></tr>  <tr><td colSpan="2">    <div><label><input type="checkbox" id="dataReaderDLDataDownload"                       /><span> データを含める                                </span></label></div>  </td></tr>  <tr><td colSpan="2">    <div style="padding-left:10px;font-size:90%;">      <span style="margin-right:20px;">where</span>      <input type="text" id="dataReaderDLDataWhere" style="width:260px;font-size:90%;" disabled="disabled" />  </div>  </td></tr>  <tr><td colSpan="2">    <div style="padding-left:10px;">      <label><input type="checkbox" id="dataReaderDLDataAllRows" disabled="disabled" /><span style="font-size:90%;"> ゴミ箱のレコードも含める</span></label>    </div>  </td></tr>  <tr><td colSpan="2" style="font-size:90%;">※データを含める場合はZIP、それ以外はフィールド定義情報のみ<br/>CSVをダウンロードします。</td></tr>  </table>  <div>    <input type="button" value="ダウンロード" id="dataReaderDLGo"     style="margin:12px;" />    <input type="button" value="閉じる"       id="dataReaderDLCancel" style="margin:12px;" />  </div>  <div id="dataReaderDLProgress" style="padding:0px 8px 4px 8px;display:none;"></div>  <div id="dataReaderDLDataDone" style="padding:4px;display:none;position:relative;font-size:90%;color:#9C1717;">    <div></div><div style="position:absolute;top:0px;right:16px;"><input type="button" value="OK" /></div>  </div>  <a id="dataReaderDLUrl" /></div>'
},teasp.view.DataReader.prototype.changeSelect=function(e){var t=this.getSObjectByKey(e);t.fieldList?this.scanRefer(null,t,dojo.hitch(this,this.createInfo)):(this.switchBusy(!0),this.contact({funcName:"getExtResult",params:{action:"SObject",key:e}},function(e,t){this.scanRefer(e,t,dojo.hitch(this,this.createInfo))},null,!0))},teasp.view.DataReader.prototype.scanRefer=function(e,t,a){for(var o=t,s=(o||(console.log(e),
o=this.setObjectInfo(this.getSObjectByKey(e.key),e)),o.fieldList),i={},n=0;n<s.length;n++)for(var r=(c=s[n]).referenceTo||[],l=0;l<r.length;l++){var p=this.getSObjectKeyByName(r[l]);p&&(i[p]=1)}var d,c,m,h=[];for(d in i)(c=this.getSObjectByKey(d))&&!c.fieldList&&h.push(c);0<h.length?(t&&this.switchBusy(!0),m=0,(innerSearch=dojo.hitch(this,function(){this.contact({funcName:"getExtResult",params:{action:"SObject",
key:h[m++].key}},function(e){this.setObjectInfo(this.getSObjectByKey(e.key),e),m<h.length?setTimeout(innerSearch,100):(a(o),this.switchBusy(!1))},function(e){this.switchBusy(!1)},!0)}))()):(a&&a(o),this.switchBusy(!1))},teasp.view.DataReader.prototype.addHandle=function(e,t){e&this.L1&&this.handlesL1.push(t),e&this.L2&&this.hendlesL2.push(t),e&this.L3&&this.handlesL3.push(t)},
teasp.view.DataReader.prototype.clearHandle=function(e){if(e&this.L1){for(var t=0;t<this.handlesL1.length;t++)dojo.disconnect(this.handlesL1[t]);this.handlesL1=[]}if(e&this.L2){for(t=0;t<this.hendlesL2.length;t++)dojo.disconnect(this.hendlesL2[t]);this.hendlesL2=[]}if(e&this.L3){for(t=0;t<this.handlesL3.length;t++)dojo.disconnect(this.handlesL3[t]);this.handlesL3=[]}},
teasp.view.DataReader.prototype.createInfo=function(e){this.clearHandle(this.L1|this.L2|this.L3);var t=dojo.byId("dataReaderDyna"),a=(dojo.empty(t),dojo.create("div",{id:"dataReaderAttrArea",style:{marginTop:"10px",display:dojo.byId("dataReaderAttrToggle").checked?"table":"none"}},t)),o=["name","localName","label","labelPlural","keyPrefix","isAccessible","isCreateable","isCustom","isCustomSetting","isDeletable",
"isDeprecatedAndHidden","isFeedEnabled","isMergeable","isQueryable","isSearchable","isUndeletable","isUpdateable"];dojo.create("div",{innerHTML:"Attribute",style:{marginTop:"4px",fontWeight:"bold"}},a);for(var s=0;s<o.length;s++){var i=o[s],n=dojo.create("div",{style:{float:"left"}},a);dojo.create("div",{innerHTML:i+":",style:{float:"left",marginRight:"2px"}},n),dojo.create("div",{innerHTML:e[i],style:{float:"left",
marginRight:"10px"}},n),dojo.create("div",{style:{clear:"both"}},n)}dojo.create("div",{style:{clear:"both"}},a),a=dojo.create("div",{id:"dataReaderFieldArea",style:{marginTop:"4px",display:dojo.byId("dataReaderFieldToggle").checked?"table":"none"}},t),this.createFieldTable(e,a),a=dojo.create("div",{id:"dataReaderRelationArea",style:{marginTop:"4px",display:dojo.byId("dataReaderRelationToggle").checked?"table":"none"}
},t),this.createRelationTable(e,a),a=dojo.create("div",{id:"dataReaderRecordArea",style:{width:"100%",display:"table"}},t),this.createRecordTable(e,a)},teasp.view.DataReader.prototype.createFieldTable=function(e,t){dojo.create("div",{innerHTML:"Fields",style:{fontWeight:"bold"}},t);var a=dojo.create("label",{style:{marginLeft:"20px"}},dojo.create("div",{style:{float:"left"}},t)),o=dojo.create("input",{
type:"checkbox",id:"dataReaderFieldCalc"},a),a=(o.checked=!0,dojo.create("span",{innerHTML:" 数式項目を含む"},a),this.addHandle(this.L1,dojo.connect(o,"onclick",this,function(){this.buildFieldTable(e,dojo.byId("dataReaderFieldTbody"))})),a=dojo.create("label",{style:{marginLeft:"20px"}},dojo.create("div",{style:{float:"left"}},t)),o=dojo.create("input",{type:"checkbox",id:"dataReaderFieldColor"},a),dojo.create("span",{
innerHTML:" 参照項目を目立たせる"},a),this.addHandle(this.L1,dojo.connect(o,"onclick",this,function(){this.buildFieldTable(e,dojo.byId("dataReaderFieldTbody"))})),dojo.create("div",{style:{clear:"both"}},t),dojo.create("tbody",{id:"dataReaderFieldTbody"},dojo.create("table",{className:"defview",style:{marginTop:"4px"}},t)));this.buildFieldTable(e,a)},teasp.view.DataReader.prototype.buildFieldTable=function(e,t){
var a=e.fieldList,o=dojo.byId("dataReaderFieldCalc").checked,s=dojo.byId("dataReaderFieldColor").checked,i=(dojo.empty(t),dojo.create("tr",null,t));dojo.create("div",{innerHTML:"name"},dojo.create("th",null,i)),dojo.create("div",{innerHTML:"label"},dojo.create("th",null,i)),dojo.create("div",{innerHTML:"type"},dojo.create("th",null,i)),dojo.create("div",{innerHTML:"referenceTo"},dojo.create("th",null,i)),dojo.create(
"div",{innerHTML:"picklist"},dojo.create("th",null,i)),dojo.create("div",{innerHTML:"length"},dojo.create("th",null,i)),dojo.create("div",{innerHTML:"precision"},dojo.create("th",null,i)),dojo.create("div",{innerHTML:"scale"},dojo.create("th",null,i)),dojo.create("div",{innerHTML:"calculatedFormula"},dojo.create("th",null,i)),dojo.create("div",{innerHTML:"inlineHelpText"},dojo.create("th",null,i)),dojo.create("div",{
innerHTML:"defaultValue"},dojo.create("th",null,i)),dojo.create("div",{innerHTML:"isAutoNumber"},dojo.create("th",null,i)),dojo.create("div",{innerHTML:"isCalculated"},dojo.create("th",null,i)),dojo.create("div",{innerHTML:"isCustom"},dojo.create("th",null,i)),dojo.create("div",{innerHTML:"isIdLookup"},dojo.create("th",null,i)),dojo.create("div",{innerHTML:"isNillable"},dojo.create("th",null,i)),dojo.create("div",{
innerHTML:"isUnique"},dojo.create("th",null,i)),dojo.create("div",{innerHTML:"isAccessible"},dojo.create("th",null,i));for(var n=0;n<a.length;n++){var r,l=a[n];!o&&l.isCalculated||(i=dojo.create("tr",{className:n%2==0?"even":"odd"},t),"REFERENCE"==l.typeName&&s&&(this.isReadOnlyField(l
)||"OwnerId"==l.name?i.style.backgroundColor="#CFFEFF":l.isNillable?i.style.backgroundColor="#FFE0C9":i.style.backgroundColor="#FFCDA9"),dojo.create("div",{innerHTML:l.name},dojo.create("td",{className:"left"},i)),dojo.create("div",{innerHTML:l.label},dojo.create("td",{className:"left"},i)),r=dojo.create("td",{className:"left"},i),dojo.create("div",{innerHTML:l.typeName},r),r.title=l.relationshipName||"",dojo.create(
"div",{innerHTML:l.referenceTo&&0<l.referenceTo.length?l.referenceTo.join(","):"",style:{wordBreak:"break-all"}},dojo.create("td",{className:"left"},i)),dojo.create("div",{innerHTML:this.getPickLabels(l.picklistValues,"<br/>")},dojo.create("td",{className:"left",style:{width:"100px"}},i)),dojo.create("div",{innerHTML:l.length},dojo.create("td",{className:"right"},i)),dojo.create("div",{innerHTML:l.precision},
dojo.create("td",{className:"right"},i)),dojo.create("div",{innerHTML:l.scale},dojo.create("td",{className:"right"},i)),dojo.create("div",{style:{wordBreak:"break-all"}},dojo.create("td",{className:"left",style:{width:"200px"}},i)).textContent=l.calculatedFormula||"",dojo.create("div",{style:{wordBreak:"break-all"}},dojo.create("td",{className:"left",style:{width:"200px"}},i)).textContent=l.inlineHelpText||"",
dojo.create("div",{innerHTML:l.defaultValueFormula||""},dojo.create("td",{className:"left"},i)),dojo.create("div",{innerHTML:l.isAutoNumber?"○":""},dojo.create("td",{className:"center"},i)),dojo.create("div",{innerHTML:l.isCalculated?"○":""},dojo.create("td",{className:"center"},i)),dojo.create("div",{innerHTML:l.isCustom?"○":""},dojo.create("td",{className:"center"},i)),dojo.create("div",{
innerHTML:l.isIdLookup?"○":""},dojo.create("td",{className:"center"},i)),dojo.create("div",{innerHTML:l.isNillable?"○":""},dojo.create("td",{className:"center"},i)),dojo.create("div",{innerHTML:l.isUnique?"○":""},dojo.create("td",{className:"center"},i)),dojo.create("div",{innerHTML:l.isAccessible?"○":""},dojo.create("td",{className:"center"},i)))}},teasp.view.DataReader.prototype.createRelationTable=function(e,t){
dojo.create("div",{innerHTML:"RelationShip",style:{fontWeight:"bold"}},t);t=dojo.create("tbody",{id:"dataReaderRelationTbody"},dojo.create("table",{className:"defview",style:{marginTop:"4px"}},t));this.buildRelationTable(e,t)},teasp.view.DataReader.prototype.buildRelationTable=function(e,t){var a=e.childRelationships,o=(dojo.empty(t),dojo.create("tr",null,t));dojo.create("div",{innerHTML:"objectName"},dojo.create(
"th",null,o)),dojo.create("div",{innerHTML:"fieldName"},dojo.create("th",null,o)),dojo.create("div",{innerHTML:"relationshipName"},dojo.create("th",null,o)),dojo.create("div",{innerHTML:"isCascadeDelete"},dojo.create("th",null,o)),dojo.create("div",{innerHTML:"isDeprecatedAndHidden"},dojo.create("th",null,o)),dojo.create("div",{innerHTML:"isRestrictedDelete"},dojo.create("th",null,o));for(var s=0;s<a.length;s++){
var i=a[s],o=dojo.create("tr",{className:s%2==0?"even":"odd"},t);dojo.create("div",{innerHTML:i.objectName},dojo.create("td",{className:"left"},o)),dojo.create("div",{innerHTML:i.fieldName},dojo.create("td",{className:"left"},o)),dojo.create("div",{innerHTML:i.relationshipName||""},dojo.create("td",{className:"left"},o)),dojo.create("div",{innerHTML:i.isCascadeDelete?"○":""},dojo.create("td",{className:"center"},o)),
dojo.create("div",{innerHTML:i.isDeprecatedAndHidden?"○":""},dojo.create("td",{className:"center"},o)),dojo.create("div",{innerHTML:i.isRestrictedDelete?"○":""},dojo.create("td",{className:"center"},o))}},teasp.view.DataReader.prototype.createRecordTable=function(e,t){for(var a=dojo.create("div",{id:"dataReaderRecordTextArea",style:{display:"none"}},t),o=(dojo.create("div",{innerHTML:"SOQL",style:{fontWeight:"bold"}}
,a),dojo.create("textarea",{id:"dataReaderRecordSoql",style:{marginTop:"2px",marginLeft:"10px",width:"200px",height:"200px"},readOnly:"readOnly"},a)),s=(o.value=this.getSoql(e,!0),dojo.create("tbody",{id:"dataReaderRecordTbody"},dojo.create("table",{style:{marginTop:"4px",marginLeft:"10px"}},t))),i=(this.buildRecordTable(e,s),dojo.create("div",{id:"dataReaderValueArea",style:{marginTop:"2px",marginLeft:"10px"}},t),
a=dojo.create("div",{id:"dataReaderScriptArea",style:{display:"none"}},t),dojo.create("div",{innerHTML:"Script for Developer Console",style:{fontWeight:"bold"}},a),o=dojo.create("textarea",{style:{marginTop:"2px",marginLeft:"10px",width:"600px",height:"200px"},readOnly:"readOnly"},a),e.fieldList),n=[],s="System.debug(LoggingLevel.WARN, '\"",r=0;r<i.length;r++){var l=i[r];n.push(l.name),l.relationshipName&&n.push(
l.relationshipName+".Name")}for(s=(s=s+n.join("'\n+ '\",\"")+"\"');\n")+("for("+e.name+" a : ["+this.getSoql(e,!0)+"]){\nSystem.debug(LoggingLevel.WARN, '\"' + "),n=[],r=0;r<i.length;r++)"DATE"==(l=i[r]).typeName||"DATETIME"==l.typeName?n.push("String.valueOf(a."+l.name+")"):"STRING"==l.typeName||"TEXTAREA"==l.typeName?n.push(
"(a."+l.name+" != null ? a."+l.name+".replaceAll('\"', '\"\"').replaceAll('\\r\\n', '').replaceAll('\\r', '').replaceAll('\\n', '') : '')"):n.push("a."+l.name),l.relationshipName&&n.push("a."+l.relationshipName+".Name");s+=n.join("\n+ '\",\"' + "),o.value=s+="\n+ '\"');\n}"},teasp.view.DataReader.prototype.buildRecordTable=function(s,e){var t=dojo.create("tr",null,e),a=(dojo.create("div",{innerHTML:"where"},
dojo.create("td",null,t)),dojo.create("td",null,t)),o=(dojo.create("input",{type:"text",style:{width:"800px"},id:"dataReaderWhere"},a),t=dojo.create("tr",null,e),dojo.create("div",{innerHTML:"order by"},dojo.create("td",null,t)),a=dojo.create("td",null,t),dojo.create("input",{type:"text",style:{width:"800px"},id:"dataReaderSortKey"},a),t=dojo.create("tr",null,e),dojo.create("label",null,dojo.create("td",{colSpan:2},t
))),o=(dojo.create("input",{type:"checkbox",id:"dataReaderAllRows"},o),dojo.create("span",{innerHTML:" ゴミ箱のレコードも含める"},o),t=dojo.create("tr",null,e),a=dojo.create("td",{colSpan:2},t),dojo.create("div",{style:{padding:"4px",display:"table-cell"}},a)),e=dojo.create("input",{type:"button",value:"検索",style:{padding:"1px 4px",marginRight:"10px"},id:"dataReaderSearch"},o),t=(this.addHandle(this.L1,dojo.connect(e,"onclick",
this,function(){var e=(e=dojo.byId("dataReaderRecordSoql").value).replace(/\n/g,""),t=(t=dojo.byId("dataReaderWhere").value.trim())&&" where "+t,a=(a=dojo.byId("dataReaderSortKey").value.trim())&&" order by "+a,o=dojo.byId("dataReaderAllRows").checked;this.search(s,{soql:e,where:t,orderBy:a,allRows:o},this.showSearchResult)})),dojo.create("input",{type:"button",value:"ダウンロード",style:{padding:"1px 4px",
marginLeft:"20px"},id:"dataReaderDownload"},o)),o=(this.addHandle(this.L1,dojo.connect(t,"onclick",this,function(){var e=(e=dojo.byId("dataReaderRecordSoql").value).replace(/\n/g,""),t=dojo.byId("dataReaderWhere").value.trim(),t=(t&&(e+=" where ("+t+")"),dojo.byId("dataReaderAllRows").checked);this.fetch(s,e,t,!0,dojo.hitch(this,this.buildValueTable))})),this.isUnableSearchObject(s.key)),e=(dojo.attr(e,"disabled",o),
dojo.attr(t,"disabled",o),o?"API参照名重複のため検索不可":"※ダウンロードはID順固定");dojo.create("div",{innerHTML:e,style:{fontSize:"0.85em",marginLeft:"12px",display:"table-cell"}},a)},teasp.view.DataReader.prototype.search=function(t,a,o){this.contact({funcName:"getExtCount",params:{soql:"select count() from "+t.name+(a.where||"")+(a.allRows?" ALL ROWS":"")}},function(e){e={soql:a.soql+(a.where||"")+(a.orderBy||""),cntAll:e.count,
rowMax:a.max||this.ROW_MAX,pageNo:1,callback:dojo.hitch(this,o),allRows:a.allRows||!1};this.search2(t,e,!0)},null,!1)},teasp.view.DataReader.prototype.search2=function(t,a,e){this.contact({funcName:"getExtResult",params:{soql:a.soql,limit:a.rowMax,offset:(a.pageNo-1)*a.rowMax,allRows:a.allRows||!1,keepNs:e}},function(e){a.callback(t,e.records,a)},null,!1)},teasp.view.DataReader.prototype.searchLoop=function(e,t,a){
var o=[],s=0,i=function(){};(i=dojo.hitch(this,function(){this.contact({funcName:"getExtResult",params:{soql:e,limit:1e3,offset:s,keepNs:!0}},function(e){o=o.concat(e.records),1e3<=e.records.length?(s+=1e3,setTimeout(i,100)):t.apply(this,[o])},a,!0)}))()},teasp.view.DataReader.prototype.searchFunc=function(e,t,a){var o=t,s=a;return function(){s.pageNo=o,this.search2(e,s,!0)}},
teasp.view.DataReader.prototype.fetch=function(a,o,t,s,i,n){var r=0,l=(new Date).getTime(),p=[],d=null,c=function(){};s&&this.switchBusy(!0),(c=dojo.hitch(this,function(){var e;d?(e=0<o.indexOf(" where ")?o+" and ":o+" where ",e+="Id > '"+d+"' order by Id"):e=o+" order by Id",console.log("("+ ++r+") limit=100, time="+Math.round(((new Date).getTime()-l)/1e3)),this.contact({funcName:"getExtResult",params:{soql:e,
limit:100,offset:0,allRows:t,keepNs:!0}},function(e){var t=0<e.records.length?e.records[e.records.length-1]:null;p=p.concat(e.records),100<=e.records.length?(d=t.Id,setTimeout(c,100)):(s&&this.switchBusy(!1),i(a,p,o,!0))},n,!0)}))()},teasp.view.DataReader.prototype.excludeDuplicateField=function(e){for(var t=dojo.clone(e),a={},o=[],s=0;s<t.length;s++){var i=t[s].localName.toLowerCase();void 0!==(n=a[i]
)?t[n].name.length>t[s].name.length?o.push(s):o.push(n):a[i]=s}console.log(o.join(","));for(o=o.sort(function(e,t){return t-e}),s=0;s<o.length;s++){var n=o[s];t.splice(n,1)}return t},teasp.view.DataReader.prototype.getSoql=function(e,t,a){for(var o=this.excludeDuplicateField(e.fieldList||[]),s=[],i=0;i<o.length;i++){var n=o[i];if((!a||!n.isCalculated)&&(s.push(n.name),!a&&"REFERENCE"==n.typeName&&n.relationshipName)
){for(var r=!0,l=n.referenceTo||[],p=0;p<l.length;p++){var d=this.getSObjectKeyByName(l[p]),d=d?this.getSObjectByKey(d):null;if(!d||!this.existNameField(d)){r=!1;break}}r&&s.push(n.relationshipName+".Name")}}return"select "+s.join(t?"\n,":",")+(t?"\n":"")+" from "+e.name},teasp.view.DataReader.prototype.existNameField=function(e){for(var t=e.fieldList||[],a=0;a<t.length;a++)if("Name"==t[a].localName)return!0;return!1
},teasp.view.DataReader.prototype.getSoqlFields=function(e){for(var t=e.toLowerCase().indexOf("select"),t=(e=e.substring(t+"select".length+1)).toLowerCase().indexOf(" from "),a=(e=e.substring(0,t)).split(/,/),o=0;o<a.length;o++){a[o]=a[o].trim();var s=a[o].split(/\./);s&&1<s.length&&(a[o]=s)}return a},teasp.view.DataReader.prototype.parseRecord=function(e,t,a,o){for(var s=t,i=[],n=0;n<a.length;n++){var r,l=a[n],p="";
if("string"==typeof l)p=(r=e.fieldMap[l.toLowerCase()])&&"DATE"==r.typeName?teasp.util.date.formatDate(s[l]):r&&"DATETIME"==r.typeName?s[l]?teasp.util.date.formatDateTime(s[l]):"":r&&"BOOLEAN"==r.typeName?s[l]||!1:r&&"DOUBLE"==r.typeName?"number"==typeof s[l]?s[l]:"":r&&"ADDRESS"==r.typeName?s[l]?dojo.toJson(s[l]):"":"number"==typeof s[l]?s[l]:s[l]||"";else{for(var d=s,c=0;c<l.length&&(d=d[l[c]]);c++);p=d||""}
"string"==typeof p&&o?i.push('"'+p.replace(/"/g,'""')+'"'):i.push(p)}return i},teasp.view.DataReader.prototype.showSearchResult=function(e,t,a){this.clearHandle(this.L2|this.L3);var o=dojo.byId("dataReaderValueArea"),s=(dojo.empty(o),dojo.create("div",{id:"dataReaderValuePaging"},o),this.setPaging(a,e,"dataReaderValuePaging",this.searchFunc),dojo.create("table",{className:"defview",style:{marginTop:"4px"}},o)),
i=dojo.create("thead",null,s),n=this.getSoqlFields(a.soql),r=dojo.create("tr",null,i),a=dojo.create("input",{type:"checkbox"},dojo.create("th",{style:"width:20px;"},r));this.addHandle(this.L2,dojo.connect(a,"onclick",this,this.checkedHead));for(var l=0;l<n.length;l++){var p=(p="string"==typeof(h=n[l])?h:h.join(".")).replace(/teamspirit__/g,'<span style="font-size:80%;">teamspirit__</span><br/>');dojo.create("div",{
innerHTML:p,style:{wordBreak:"break-all"}},dojo.create("th",{style:"white-space:nowrap;"},r))}for(var d=dojo.create("tbody",{id:"dataReaderValueTbody",data:e.name},s),l=0;l<t.length;l++){this.valueCache[t[l].Id]=t[l],r=dojo.create("tr",{className:l%2==0?"even":"odd"},d),t[l].IsDeleted&&dojo.style(r,"backgroundColor","#D2D2D2");var c=this.parseRecord(e,t[l],n);dojo.create("input",{type:"checkbox",data:t[l].Id+(
t[l].IsDeleted?":DELETED":"")},dojo.create("td",{style:"text-align:center;"},r));for(var m=0;m<n.length;m++){var h,u="string"==typeof(h=n[m])?e.fieldMap[h.toLowerCase()]:null,g=m<c.length?c[m]:"",y=(50<g.length&&(g=g.substring(0,50)+"..."),dojo.create("td",null,r));dojo.create("div",{innerHTML:u&&u.plmap&&u.plmap[g]||g,style:dojo.mixin(this.getTextAlign(e,h),this.getWhiteSpace(e,h))},y),this.setEvent(e,y,h,g,this.L2)
}}i=dojo.create("div",{id:"dataReaderDeleteGate",style:"padding:10px;"},o),a=dojo.create("a",{innerHTML:"削除／復元",style:"cursor:pointer;color:#0d3daf;text-decoration:underline;"},i),this.addHandle(this.L2,dojo.connect(a,"onclick",this,function(){dojo.style("dataReaderDeleteGate","display","none"),dojo.style("dataReaderDeleteArea","display","")})),s=dojo.create("div",{id:"dataReaderDeleteArea",style:"display:none;"},o),
i=dojo.create("input",{type:"button",value:"削除",style:"margin:10px;"},s),this.addHandle(this.L2,dojo.connect(i,"onclick",this,this.deleteObjcts)),a=dojo.create("input",{type:"button",value:"復元",style:"margin:10px;"},s);this.addHandle(this.L2,dojo.connect(a,"onclick",this,this.undeleteObjcts))},teasp.view.DataReader.prototype.checkedHead=function(){var t=dojo.query(
'#dataReaderValueArea table th input[type="checkbox"]')[0];dojo.query('#dataReaderValueTbody td input[type="checkbox"]').forEach(function(e){e.checked=t.checked})},teasp.view.DataReader.prototype.delUndelTargets=function(){var t={key:dojo.attr("dataReaderValueTbody","data"),dels:[],undels:[]};return dojo.query('#dataReaderValueTbody td input[type="checkbox"]:checked').forEach(function(e){e=dojo.attr(e,"data");
e.endsWith(":DELETED")?t.undels.push(e.substring(0,e.indexOf(":"))):t.dels.push(e)}),t},teasp.view.DataReader.prototype.deleteObjcts=function(e){var t=this.delUndelTargets();if(t.dels.length){var a="選択された"+t.dels.length+"件のレコードを削除します。よろしいですか？";teasp.tsConfirmA(a,this,function(){teasp.tsConfirmA("【最終確認】削除を実行します。よろしいですか？",this,function(){this.switchBusy(!0),this.contact({funcName:"getExtResult",params:{
action:"deleteByIds",key:t.key,ids:t.dels}},function(e){this.switchBusy(!1),teasp.tsConfirmA("削除完了しました。OKクリックで検索画面に戻ってリフレッシュします",this,function(){this.closeVertView(),teasp.util.Test.pushEvent("dataReaderSearch","onclick")})},function(e){this.switchBusy(!1),teasp.message.alertError(e)},!0)})})}},teasp.view.DataReader.prototype.undeleteObjcts=function(e){var t=this.delUndelTargets();if(t.undels.length){
var a="選択された"+t.undels.length+"件のレコードを復元します。よろしいですか？";teasp.tsConfirmA(a,this,function(){this.switchBusy(!0),this.contact({funcName:"getExtResult",params:{action:"undeleteByIds",key:t.key,ids:t.undels}},function(e){this.switchBusy(!1),teasp.tsConfirmA("復元完了しました。OKクリックで検索画面に戻ってリフレッシュします",this,function(){this.closeVertView(),teasp.util.Test.pushEvent("dataReaderSearch","onclick")})},function(e){this.switchBusy(!1),
teasp.message.alertError(e)},!0)})}},teasp.view.DataReader.prototype.setPaging=function(e,t,a,o){for(var s=dojo.byId(a),a=(dojo.empty(s),Math.ceil(e.cntAll/e.rowMax)),i=dojo.create("div",{className:"pageDiv",innerHTML:"&lt;"},s),n=(1<e.pageNo?(dojo.style(i,"color","blue"),dojo.style(i,"cursor","pointer"),this.addHandle(this.L2,dojo.connect(i,"onclick",this,o(t,e.pageNo-1,e)))):dojo.style(i,"color","gray"),
teasp.util.getPageBox(a,e.pageNo,5,5,5)),r=0;r<n.length;r++){var l,p=n[r];null===p?dojo.create("div",{className:"pageDiv",innerHTML:"･･",style:{color:"gray"}},s):(l=dojo.create("div",{className:"pageDiv",innerHTML:p},s),e.pageNo==p?dojo.style(l,"color","gray"):(dojo.style(l,"color","blue"),dojo.style(l,"cursor","pointer"),this.addHandle(this.L2,dojo.connect(l,"onclick",this,o(t,p,e)))))}var i=dojo.create("div",{
className:"pageDiv",innerHTML:"&gt;"},s),a=(e.pageNo<a?(dojo.style(i,"color","blue"),dojo.style(i,"cursor","pointer"),this.addHandle(this.L2,dojo.connect(i,"onclick",this,o(t,e.pageNo+1,e)))):dojo.style(i,"color","gray"),(e.pageNo-1)*e.rowMax+1),i=a+e.rowMax-1,d=(i>e.cntAll&&(i=e.cntAll),"");0<e.cntAll&&(d=e.cntAll<=e.rowMax?teasp.message.getLabel("tk10003230",e.cntAll):teasp.message.getLabel("tk10003240",e.cntAll,
a||1,i||1)),dojo.create("div",{className:"pageDiv",style:{width:"10px",height:"2px"}},s),dojo.create("div",{innerHTML:d,style:{whiteSpace:"nowrap",display:"table"}},s)},teasp.view.DataReader.prototype.buildValueTable=function(e,t,a,o){for(var s=this.getSoqlFields(a),i="",n=0;n<t.length;n++)i+=this.parseRecord(e,t[n],s,!0).join(",")+"\n";for(var r=[],l=0;l<s.length;l++){var p=s[l];r.push('"'+(
"string"==typeof p?p:p.join("."))+'"')}a=r.join(",");this.inputDownload(a,i,e.name+".csv")},teasp.view.DataReader.prototype.getTextAlign=function(e,t){return"string"==typeof t?(e=e.fieldMap[t.toLowerCase()])&&"DATE"==e.typeName||e&&"DATETIME"==e.typeName||e&&"BOOLEAN"==e.typeName?{textAlign:"center"}:e&&"DOUBLE"==e.typeName?{textAlign:"right"}:{textAlign:"left"}:{textAlign:"left"}},
teasp.view.DataReader.prototype.getWhiteSpace=function(e,t){if("string"==typeof t){if((e=e.fieldMap[t.toLowerCase()])&&("DATE"==e.typeName||"DATETIME"==e.typeName||"ID"==e.typeName))return{whiteSpace:"nowrap"};if("name"==t.toLowerCase())return{whiteSpace:"nowrap"}}return{whiteSpace:"nowrap"}},teasp.view.DataReader.prototype.inputDownload=function(e,t,a,o,s){if(window.navigator.msSaveBlob||dojo.isChrome||dojo.isFF){
var i,n=new Uint8Array([239,187,191]),n=new Blob([n,e+"\n"+t],{type:"text/csv"});window.navigator.msSaveBlob?(window.navigator.msSaveBlob(n,a),s&&s()):((i=dojo.byId("dataReaderDL")).href=URL.createObjectURL(n),i.download=a,i.click(),setTimeout(function(){URL.revokeObjectURL(i.href),s&&s()},3e3))}else{for(var r=""+(new Date).getTime(),l=teasp.util.splitByLength(t,3e4),p=[],d=Math.ceil(l.length/9),c=0,m=0;m<d;m++){
p[m]=[];for(var h=0;h<9;h++){var u=9*c+h;u<l.length&&p[m].push(l[u])}c++}for(var g=[],m=0;g.push({funcName:"inputData",params:{key:r,head:0==m?e:null,values:p[m],order:m+1}}),++m<p.length;);this.contact(g,function(e,t){g.length<=t+1&&(teasp.downloadHref(teasp.getPageUrl("extCsvView")+"?key="+r+(a?"&fname="+a:"")),s&&s())},null,o||!1)}},teasp.view.DataReader.prototype.getBulkFields=function(l,e,p,d){var t,c=[],
m=function(){},h=[],u={},a=dojo.byId("dataReaderDLName").value.toLowerCase(),o=dojo.byId("dataReaderDLNameOpt1").checked,s=dojo.byId("dataReaderDLCustomObjectOnly").checked,i=dojo.byId("dataReaderDLExcludeRemoveObject").checked,n=dojo.byId("dataReaderDLExcludeFeedObject").checked,r=[];for(t in a&&dojo.forEach(a.split(/[, ]/),function(e){e=e.trim();e&&r.push(e)}),this.sObjects)if(this.sObjects.hasOwnProperty(t)){
var g=t.toLowerCase(),y=this.getLocalName(g);if(r.length){for(var f=!1,b=0;b<r.length;b++)if(o&&(!g.indexOf(r[b])||!y.indexOf(r[b]))||!o&&(g==r[b]||y==r[b])){f=!0;break}if(!f)continue}var _=this.sObjects[t];s&&!_.isCustom||i&&0<=_.label.indexOf("削除予定")||n&&0<=_.name.indexOf("__Feed")||(_.key=t,u[t]=1,h.push(_))}if(h.length<=0)return teasp.tsAlert("対象のオブジェクトはありません"),void d.apply(this);var h=h.sort(function(e,t){
return e.name<t.name?-1:e.name>t.name?1:0}),v=e?h.length+2:0,T=(l.set({maximum:h.length+1+v}),{}),j=0;(m=dojo.hitch(this,function(){this.contact({funcName:"getExtResult",params:{action:"SObject",key:h[j++].key}},function(e){T[e.key]?this.setObjectInfo(T[e.key],e):c.push(e);for(var t=e.fields||[],a=0;a<t.length;a++){var o=t[a];if("REFERENCE"==o.typeName)for(var s=o.referenceTo||[],i=0;i<s.length;i++){
var n=s[i].toLowerCase(),n=this.nameMap[n]||this.localNameMap[n],r=this.getSObjectByKey(n);!r||r.fieldList||T[n]||u[n]||(h.push({key:n}),T[n]=r,l.set({maximum:h.length+1+v}))}}this.stopped?d.apply(this):(l.set({value:l.value+1}),j<h.length?setTimeout(m,100):p.apply(this,[c]))},d,!0)}))()},teasp.view.DataReader.unicodeStringToTypedArray=function(e,a){var e=encodeURIComponent(e).replace(/%([0-9A-F]{2})/g,function(e,t){
return String.fromCharCode("0x"+t)}),o=new Uint8Array(e.length+(a?3:0));return a&&(o[0]=239,o[1]=187,o[2]=191),Array.prototype.forEach.call(e,function(e,t){o[t+(a?3:0)]=e.charCodeAt(0)}),o},teasp.view.DataReader.prototype.showDone=function(e){var t=dojo.query("#dataReaderDLDataDone div:first-child");t&&t.length&&(t[0].innerHTML=e),dojo.style("dataReaderDLDataDone","display",""),dojo.query(
'#dataReaderDLDataDone input[type="button"]')[0].disabled=!1},teasp.view.DataReader.prototype.buildDlRecord=function(d,c,o){var m=new JSZip,h=0;dojo.forEach(d,function(e){var t=this.getSObjectByKey(e.key);this.setObjectInfo(t,e)},this);for(var e=d.length-1;0<=e;e--){var t=d[e];this.isUnableSearchObject(t.key)&&d.splice(e,1)}var a=this.getSObjectListCsv(d),a=(m.file("object_list.csv",
teasp.view.DataReader.unicodeStringToTypedArray(a.heads+"\n"+a.value,!0),{binary:!0}),c.set({value:c.value+1}),this.getFieldListCsv(d)),s=(m.file("object_fields.csv",teasp.view.DataReader.unicodeStringToTypedArray(a.heads+"\n"+a.value,!0),{binary:!0}),c.set({value:c.value+1}),m.file("organization.txt",teasp.view.DataReader.unicodeStringToTypedArray(this.organizationValue)),c.set({value:c.value+1}),dojo.byId(
"dataReaderDLDataAllRows").checked),u="",i=0,g=dojo.hitch(this,function(){u&&m.file("error.log",teasp.view.DataReader.unicodeStringToTypedArray(u));var a=this.organization.Id.substring(0,15)+"_"+teasp.util.date.formatDateTime(new Date,"N14",!0)+".zip";m.generateAsync({type:"blob",compression:"DEFLATE"}).then(function(e){var t;window.navigator.msSaveBlob?(window.navigator.msSaveBlob(e,a),o()):((t=dojo.byId(
"dataReaderDLUrl")).href=URL.createObjectURL(e),t.download=a,t.target="_blank",t.click(),setTimeout(function(){URL.revokeObjectURL(t.href),o()},3e3))}),this.showDone(0<i?"読込エラー:"+i+"件 (詳細は error.log 参照)":"完了")});(innerSearch=dojo.hitch(this,function(){var e=d[h],t=this.getSObjectByKey(e.key),e=this.getSoql(t),a=dojo.byId("dataReaderDLDataWhere").value.trim();a&&(e+=" where ("+a+")"),console.log(e),this.fetch(t,e,s,!1
,dojo.hitch(this,function(e,t,a,o){if(0<t.length){for(var s=this.getSoqlFields(a),i=[],n=0;n<s.length;n++){var r=s[n];i.push('"'+("string"==typeof r?r:r.join("."))+'"')}for(var l=i.join(",")+"\n",p=0;p<t.length;p++)l+=this.parseRecord(e,t[p],s,!0).join(",")+"\n";m.file(e.name+".csv",teasp.view.DataReader.unicodeStringToTypedArray(l,!0),{binary:!0})}else u+=teasp.util.date.formatDateTime(new Date,"SLA-HMS",!0
)+" "+e.name+" : 該当なし\n";c.set({value:c.value+1}),++h<d.length?(console.log(t),setTimeout(innerSearch,100)):g()}),dojo.hitch(this,function(e){console.log(e),i++,u=(u=(u+=teasp.util.date.formatDateTime(new Date,"SLA-HMS",!0))+(" "+t.name)+" の読込でエラー: ")+teasp.message.getErrorMessage(e)+"\n",c.set({value:c.value+1}),++h<d.length?setTimeout(innerSearch,100):g()}))}))()},
teasp.view.DataReader.prototype.sortFields=function(e){return e=e.sort(dojo.hitch(this,function(e,t){var a=this.bfld[e.name.toLowerCase()],o=this.bfld[t.name.toLowerCase()];return a&&o?a-o:a?-1:o||e.isCustom&&!t.isCustom?1:!e.isCustom&&t.isCustom||e.name<t.name?-1:e.name>t.name?1:0}))},teasp.view.DataReader.prototype.buildFieldListCsv=function(e,t){e=this.getFieldListCsv(e);this.inputDownload(e.heads,e.value,
"fields_"+teasp.util.date.formatDate(new Date,"yyyyMMdd")+".csv",!0,t)},teasp.view.DataReader.prototype.getFieldListCsv=function(e){for(var t="",a=dojo.byId("dataReaderDLCustomFieldOnly").checked,o=dojo.byId("dataReaderDLExcludeRemoveField").checked,s=dojo.byId("dataReaderDLExcludeCalcField").checked,i=dojo.byId("dataReaderDLUseLocalNameField").checked,n=dojo.byId("dataReaderDLCutPickList").checked,r=dojo.byId(
"dataReaderDLLastReferencedDate").checked,l=0;l<e.length;l++){var p=e[l];if(p.key){p.fields=this.sortFields(p.fields);for(var d=this.getSObjectByKey(p.key),c=0;c<p.fields.length;c++){var m,h=p.fields[c];a&&!h.isCustom||o&&0<=h.label.indexOf("削除予定")||s&&h.isCalculated||!r&&/^(LastReferencedDate|LastViewedDate)$/i.test(h.name)||((m=[]).push(d.label),m.push(i?d.localName:d.name),m.push(h.label),m.push(
i?h.localName:h.name),m.push(h.typeName),m.push(""+h.length),m.push(""+h.precision),m.push(""+h.scale),m.push(this.getReferenceTo(h)),m.push(this.getPickLabels(h.picklistValues,"\n",n?100:0)),m.push(h.inlineHelpText?h.inlineHelpText.replace(/"/g,'""'):""),m.push(h.calculatedFormula?h.calculatedFormula.replace(/"/g,'""'):""),m.push(h.isAutoNumber?"○":""),m.push(h.isIdLookup?"○":""),m.push(h.isCalculated?"○":""),
m.push(h.isCustom?"○":""),m.push(h.isNillable?"○":""),m.push(h.isUnique?"○":""),m.push(h.isExternalID?"○":""),m.push(h.isGroupable?"○":""),m.push(h.isHtmlFormatted?"○":""),m.push(h.isRestrictedDelete?"○":""),m.push(this.getChildRelationshipName(e,d.name,h.name)||""),t+='"'+m.join('","')+'"\n')}}}return{heads:'"'+["objectLabel","objectName","label","name","type","length","precision","scale","referenceTo","pickList",
"helpText","calculatedFormula","isAutoNumber","isIdLookup","isCalculated","isCustom","isNilable","isUnique","isExternalID","isGroupable","isHtmlFormatted","isRestrictedDelete","childRelationshipName"].join('","')+'"',value:t}},teasp.view.DataReader.prototype.getSObjectListCsv=function(e){for(var t="",a=0;a<e.length;a++){var o,s=e[a];s.key&&(s=this.getSObjectByKey(s.key),(o=[]).push(s.name),o.push(s.localName),o.push(
s.label),o.push(s.labelPlural),o.push(s.keyPrefix),o.push(s.isAccessible?"○":""),o.push(s.isCreateable?"○":""),o.push(s.isCustom?"○":""),o.push(s.isCustomSetting?"○":""),o.push(s.isDeletable?"○":""),o.push(s.isDeprecatedAndHidden?"○":""),o.push(s.isFeedEnabled?"○":""),o.push(s.isMergeable?"○":""),o.push(s.isQueryable?"○":""),o.push(s.isSearchable?"○":""),o.push(s.isUndeletable?"○":""),o.push(s.isUpdateable?"○":""),
t+='"'+o.join('","')+'"\n')}return{heads:'"'+["name","localName","label","labelPlural","keyPrefix","isAccessible","isCreateable","isCustom","isCustomSetting","isDeletable","isDeprecatedAndHidden","isFeedEnabled","isMergeable","isQueryable","isSearchable","isUndeletable","isUpdateable"].join('","')+'"',value:t}},teasp.view.DataReader.prototype.getChildRelationshipName=function(e,t,a){for(var o=t.toLowerCase(),
s=a.toLowerCase(),i=0;i<e.length;i++)for(var n=e[i].childRelationships||[],r=0;r<n.length;r++){var l=n[r];if(l.objectName.toLowerCase()==o&&l.fieldName.toLowerCase()==s)return l.relationshipName}return null},teasp.view.DataReader.prototype.getReferenceTo=function(e){for(var t=[],a=e.referenceTo||[],o=0;o<a.length;o++){var s=a[o];teasp.prefixBar.length&&s.substring(0,teasp.prefixBar.length)==teasp.prefixBar?t.push(
s.substring(teasp.prefixBar.length)):t.push(s)}return t.length?t.join(","):""},teasp.view.DataReader.prototype.setEvent=function(e,t,a,o,s){"string"!=typeof a||!(e=e.fieldMap[a.toLowerCase()])||"ID"!=e.typeName&&"REFERENCE"!=e.typeName||(t.style.cursor="pointer",this.addHandle(s,dojo.connect(t,"onclick",this,this.clickId(o))))},teasp.view.DataReader.prototype.clickId=function(e,t){return function(){this.showVert(e,t)
}},teasp.view.DataReader.prototype.deleteId=function(a,o){return function(){var e="本当に削除してよろしいですか？\n\nオブジェクト:"+a+"\nID:"+o.Id+(o.Name?"\nName:"+o.Name:"");const t="【最終確認】削除を実行します。よろしいですか？\n\nオブジェクト:"+a+"\nID:"+o.Id+(o.Name?"\nName:"+o.Name:"");teasp.tsConfirmA(e,this,function(){teasp.tsConfirmA(t,this,function(){this.switchBusy(!0),this.contact({funcName:"getExtResult",params:{action:"deleteById",key:a,id:o.Id}},
function(e){this.switchBusy(!1),teasp.tsConfirmA("削除完了しました。OKクリックで検索画面に戻ってリフレッシュします",this,function(){this.closeVertView(),teasp.util.Test.pushEvent("dataReaderSearch","onclick")})},function(e){this.switchBusy(!1),teasp.message.alertError(e)},!0)})})}},teasp.view.DataReader.prototype.undeleteId=function(t,a){return function(){var e="本当に復元してよろしいですか？\n\nオブジェクト:"+t+"\nID:"+a.Id+(a.Name?"\nName:"+a.Name:"");
teasp.tsConfirmA(e,this,function(){this.switchBusy(!0),this.contact({funcName:"getExtResult",params:{action:"undeleteByIds",key:t,ids:[a.Id]}},function(e){this.switchBusy(!1),teasp.tsConfirmA("復元完了しました。OKクリックで検索画面に戻ってリフレッシュします",this,function(){this.closeVertView(),teasp.util.Test.pushEvent("dataReaderSearch","onclick")})},function(e){this.switchBusy(!1),teasp.message.alertError(e)},!0)})}},
teasp.view.DataReader.prototype.showVert=function(e,a){var t,o=this.getSObjectById(e);o&&(this.valueCache[e]?this.createVertView(o,this.valueCache[e],null,a):(this.switchBusy(!0),t=dojo.hitch(this,function(){var t=this.getSoql(o)+" where Id = '"+e+"'";this.searchLoop(t,function(e){this.createVertView(o,e[0],t,a),this.switchBusy(!1)},function(e){this.switchBusy(!1)})}),o.fieldList?t():this.contact({
funcName:"getExtResult",params:{action:"SObject",key:o.key}},function(e){this.setObjectInfo(o,e),t()},function(e){this.switchBusy(!1)},!0)))},teasp.view.DataReader.prototype.setObjectInfo=function(e,t){e.fieldList=this.sortFields(t.fields);for(var a=0;a<e.fieldList.length;a++)if((n=e.fieldList[a]).picklistValues&&0<n.picklistValues.length){n.plmap={};for(var o=0;o<n.picklistValues.length;o++){
var s=n.picklistValues[o][1],i=n.picklistValues[o][0];n.plmap[s]=i}}e.fieldMap={};for(a=0;a<e.fieldList.length;a++){var n=e.fieldList[a];e.fieldMap[n.name.toLowerCase()]=n}return e.childRelationships=t.childRelationships.sort(function(e,t){return e.objectName<t.objectName?-1:e.objectName>t.objectName?1:0}),e},teasp.view.DataReader.prototype.createVertView=function(e,t,a,o){this.valueCache[t.Id]=t;for(var s,
i=dojo.byId("baseArea"),i=(this.closeVertView(),dojo.style("dataReaderPane1","display","none"),window.scrollTo(0,0),dojo.create("div",{id:"dataReaderVertTable",style:{border:"none"}},i)),n=dojo.create("a",{innerHTML:"検索画面に戻る",style:{textDecoration:"underline",fontSize:"0.9em",cursor:"pointer"}},dojo.create("div",{style:{paddingTop:"2px",marginRight:"50px",float:"left"}},i)),r=(this.addHandle(this.L3,dojo.connect(n,
"onclick",this,this.closeVertView)),this.editable()&&(o?(s=dojo.create("input",{type:"button",value:"登録",style:{margin:"0px 8px"}},dojo.create("div",{style:{marginRight:"10px",float:"left"}},i)),this.addHandle(this.L3,dojo.connect(s,"onclick",this,this.saveValue(e,t))),s=dojo.create("input",{type:"button",value:"キャンセル",style:{margin:"0px 8px"}},dojo.create("div",{style:{marginRight:"10px",float:"left"}},i)),
this.addHandle(this.L3,dojo.connect(s,"onclick",this,this.clickId(t.Id,!1)))):t.IsDeleted?(s=dojo.create("input",{type:"button",value:"復元",style:{margin:"0px 8px"}},dojo.create("div",{style:{marginRight:"20px",float:"left"}},i)),this.addHandle(this.L3,dojo.connect(s,"onclick",this,this.undeleteId(e.name,t)))):(s=dojo.create("input",{type:"button",value:"編集",style:{margin:"0px 8px"}},dojo.create("div",{style:{
marginRight:"20px",float:"left"}},i)),this.addHandle(this.L3,dojo.connect(s,"onclick",this,this.clickId(t.Id,!0))),s=dojo.create("input",{type:"button",value:"削除",style:{margin:"0px 8px"}},dojo.create("div",{style:{marginRight:"20px",float:"left"}},i)),this.addHandle(this.L3,dojo.connect(s,"onclick",this,this.deleteId(e.name,t)))),dojo.create("div",{style:{clear:"both"}},i)),dojo.create("div",{style:{margin:"2px 8px"
}},i)),r=(dojo.create("div",{innerHTML:e.name,style:{marginRight:"8px",float:"left"}},r),dojo.create("div",{innerHTML:e.label,style:{float:"left"}},r),dojo.create("div",{style:{clear:"both"}},r),"margin:2px 8px;"),l=(t.IsDeleted&&(r+="background-color:#D2D2D2"),dojo.create("tbody",null,dojo.create("table",{className:"defview",style:r},i))),p=this.getSoqlFields(a||this.getSoql(e)),d=this.parseRecord(e,t,p),c=[],
m=0;m<p.length;m++){var h=p[m],u=dojo.create("tr",null,l),g="string"==typeof h?h:h.join("."),y="string"==typeof h?e.fieldMap[h.toLowerCase()]:null,f=typeof(b=d[m]),b="number"==f||"string"==f||"boolean"==f?d[m]:"undefined"!=f?"("+f+")":"",f=(dojo.create("div",{innerHTML:g},dojo.create("td",null,u)),dojo.create("td",null,u));if(dojo.create("div",{innerHTML:y&&y.label||"",title:y&&y.inlineHelpText||""},f),dojo.create(
"div",{innerHTML:y&&y.typeName||"",title:y?"length="+y.length+"\nprecision="+y.precision+"\nscale="+y.scale+"\ndefaultValue="+(y.defaultValue||"")+"\nisAutoNumber="+y.isAutoNumber+"\nisCalculated="+y.isCalculated+"\nisCustom="+y.isCustom+"\nisIdLookup="+y.isIdLookup+"\nisNillable="+y.isNillable+"\nisUnique="+y.isUnique+"\nisAccessible="+y.isAccessible:""},dojo.create("td",null,u)),f=dojo.create("td",null,u),
!o||"string"!=typeof h||this.isReadOnlyField(y)||y&&"LOCATION"==y.typeName)y&&"PICKLIST"==y.typeName?dojo.create("div",{innerHTML:y.plmap[b]||b},f):dojo.create("div",{innerHTML:b},f),this.setEvent(e,f,h,b,this.L3);else if(y&&"BOOLEAN"==y.typeName)dojo.create("input",{type:"checkbox",style:{margin:"2px"},id:h},f).checked=b,c.push(h);else if(y&&"TEXTAREA"==y.typeName)dojo.create("textarea",{value:b,style:{
width:"300px",height:"40px",padding:"1px",margin:"2px"},id:h},f),c.push(h);else if(y&&"PICKLIST"==y.typeName){var _=dojo.create("select",{style:{margin:"2px"},title:y&&y.inlineHelpText||"",id:h},f),v=(c.push(h),null);dojo.create("option",{innerHTML:"",value:""},_);for(var T=0;T<y.picklistValues.length;T++){var j=y.picklistValues[T];dojo.create("option",{innerHTML:j[0],value:j[1]},_),j[1]==b&&(v=b)}v||dojo.create(
"option",{innerHTML:b,value:b},_),_.value="string"!=typeof b?"":b}else y&&"DATE"==y.typeName?dojo.create("input",{type:"text",value:b,style:{width:"86px",padding:"1px",margin:"2px",border:"1px solid #2f5d50"},id:h},f):y&&"REFERENCE"==y.typeName?dojo.create("input",{type:"text",value:b,style:{width:"150px",padding:"1px",margin:"2px",border:"1px solid #2f5d50",backgroundColor:"#e0ffff"},id:h},f
):y&&"DOUBLE"==y.typeName?dojo.create("input",{type:"text",value:b,style:{width:"90px",padding:"1px",margin:"2px",border:"1px solid #2f5d50"},id:h},f):dojo.create("input",{type:"text",value:b,style:{width:50<y.length?"300px":"150px",padding:"1px",margin:"2px",border:"1px solid #2f5d50"},id:h},f),c.push(h)}n=dojo.create("a",{innerHTML:"検索画面に戻る",style:{textDecoration:"underline",fontSize:"0.9em",cursor:"pointer"}},
dojo.create("div",{style:{paddingTop:"2px",marginRight:"50px",float:"left"}},i)),this.addHandle(this.L3,dojo.connect(n,"onclick",this,this.closeVertView)),this.editable()&&(o?(s=dojo.create("input",{type:"button",value:"登録",style:{margin:"0px 8px"}},dojo.create("div",{style:{marginRight:"10px",float:"left"}},i)),this.addHandle(this.L3,dojo.connect(s,"onclick",this,this.saveValue(e,t))),s=dojo.create("input",{
type:"button",value:"キャンセル",style:{margin:"0px 8px"}},dojo.create("div",{style:{marginRight:"10px",float:"left"}},i)),this.addHandle(this.L3,dojo.connect(s,"onclick",this,this.clickId(t.Id,!1)))):(s=dojo.create("input",{type:"button",value:"編集",style:{margin:"0px 8px"}},dojo.create("div",{style:{marginRight:"20px",float:"left"}},i)),this.addHandle(this.L3,dojo.connect(s,"onclick",this,this.clickId(t.Id,!0))),
s=dojo.create("input",{type:"button",value:"削除",style:{margin:"0px 8px"}},dojo.create("div",{style:{marginRight:"20px",float:"left"}},i)),this.addHandle(this.L3,dojo.connect(s,"onclick",this,this.deleteId(e.name,t)))),dojo.create("div",{style:{clear:"both"}},i))},teasp.view.DataReader.prototype.saveValue=function(p,d){return function(){for(var e={},t=this.excludeDuplicateField(p.fieldList||[]),a=0;a<t.length;a++){
var o,s,i,n=t[a];this.isReadOnlyField(n)||"LOCATION"==n.typeName||(o=n.name,s=dojo.byId(o),"BOOLEAN"==n.typeName?e[o]=s.checked:"DATE"==n.typeName?(i=teasp.util.date.parseDate(s.value),e[o]=i?teasp.util.date.formatDate(i):null):"DATETIME"==n.typeName?(i=teasp.util.date.parseDate(s.value),e[o]=i?teasp.util.date.formatDateTime(i,null,!0):null):"DOUBLE"==n.typeName?""==s.value?e[o]=null:0<n.scale?e[o]=parseFloat(s.value
):e[o]=parseInt(s.value,10):e[o]=s.value)}var r=this.getTypeMap(p,!1,!0),l={};l[d.Id]=e,this.switchBusy(!0),this.contact({funcName:"getExtResult",params:{action:"updateSObject",objName:p.name,idList:[d.Id],values:l,typeMap:r}},function(e){this.switchBusy(!1),setTimeout(dojo.hitch(this,function(){this.closeVertView(),teasp.util.Test.pushEvent("dataReaderSearch","onclick")}),200)},function(e){this.switchBusy(!1),
teasp.message.alertError(e)},!0)}},teasp.view.DataReader.prototype.closeVertView=function(){this.clearHandle(this.L3);var e=dojo.byId("dataReaderVertTable");e&&dojo.destroy(e),dojo.style("dataReaderPane1","display","table")},teasp.view.DataReader.prototype.buildBulkTsData=function(e){var t="";if(dojo.byId("dataReaderExportForm1").checked){var a=dojo.toJson(e);this.inputDownload(t,a,"tsexport-json.txt")}else{for(
var a="",o=0;o<e.length;o++){for(var s=e[o],i=this.getSObjectByKey(s.key),n=(t?a+='\n"'+s.key+'"\n':t='"'+s.key+'"\n',this.getSoqlFields(s.soql)),r=[],l=0;l<n.length;l++){var p=n[l];r.push('"'+("string"==typeof p?p:p.join("."))+'"')}a=a+r.join(",")+"\n";for(var d=0;d<s.values.length;d++)a+=this.parseRecord(i,s.values[d],n,!0).join(",")+"\n"}this.inputDownload(t,a,"tsexport.csv")}},
teasp.view.DataReader.prototype.enterAutoReJudgeDays=function(e){var t=dojo.byId("dataReaderAutoReJudgeDays").value,a=(t&&(t=""+((t=teasp.util.time.zenNum2han(t))?parseInt(t,10):""),dojo.byId("dataReaderAutoReJudgeDays").value=t),dojo.byId("dataReaderAutoReJudgeDaysCheck"));t&&!a.checked&&(a.checked=!0)},teasp.provide("teasp.util.Test"),teasp.util.Test=function(){this.seeds=[],this.processList=[],this.processIndex=0,
this.que1=[],this.que2=[],this.active=!1,this.doneCnt=0,this.allCnt=0,this.infinity=!1,this.signalObj=null,this.map={click:this.click,input:this.input,cancelAllDayFix:this.cancelAllDayFix,empApplyMenu:this.empApplyMenu},this.contents={T:"勤怠入力",A:"申請開閉",D:"日次確定",M:"月めくり"}},teasp.util.Test.prototype.init=function(e){var t,e=dojo.create("div",{style:{position:"absolute",left:"960px",top:"0px",backgroundColor:"#1e50a2",
zIndex:"3000"}},dojo.byId(e)),a=dojo.create("select",{id:"ttvTestType",style:{margin:"2px",float:"left"}},e);for(t in this.contents)dojo.create("option",{innerHTML:this.contents[t],value:t},a);a=null,dojo.connect(dojo.create("input",{type:"button",value:"Start",id:"ttvTestStartButton",style:{padding:"2px 4px",margin:"2px"}},dojo.create("div",{style:{float:"left"}},e)),"onclick",this,function(){this.start(dojo.byId(
"ttvTestType").value)}),dojo.connect(dojo.create("input",{type:"button",value:"Stop",id:"ttvTestStopButton",style:{padding:"2px 4px",margin:"2px"}},dojo.create("div",{style:{float:"left"}},e)),"onclick",this,function(){this.stop()}),dojo.create("div",{style:{clear:"both"}},e),dojo.create("span",{innerHTML:" Repeat",style:{color:"white"}},dojo.create("input",{type:"checkbox",id:"ttvTestRepeat",style:{margin:"2px"}},
dojo.create("label",null,dojo.create("div",{style:null},e))),"after"),dojo.byId("ttvTestRepeat").checked=!0;e=dojo.create("div",{id:"ttvTestPanel",style:{margin:"4px",display:"none"}},e);dojo.create("div",{id:"ttvTestCnt",style:{color:"white",textAlign:"center"}},dojo.create("div",{innerHTML:"All",style:{color:"white",textAlign:"center"}},dojo.create("div",{style:{float:"left",marginRight:"12px",textAlign:"center"}},
e)),"after"),dojo.create("div",{id:"ttvTestDone",style:{color:"white",textAlign:"center"}},dojo.create("div",{innerHTML:"End",style:{color:"white",textAlign:"center"}},dojo.create("div",{style:{float:"left",marginRight:"16px",textAlign:"center"}},e)),"after"),dojo.create("div",{id:"ttvTestQ1",style:{color:"white",textAlign:"center"}},dojo.create("div",{innerHTML:"Q1",style:{color:"white",textAlign:"center"}},
dojo.create("div",{style:{float:"left",marginRight:"12px",textAlign:"center"}},e))),dojo.create("div",{id:"ttvTestQ2",style:{color:"white",textAlign:"center"}},dojo.create("div",{innerHTML:"Q2",style:{color:"white",textAlign:"center"}},dojo.create("div",{style:{float:"left",marginRight:"2px",textAlign:"center"}},e))),dojo.create("div",{style:{clear:"both"}},e),dojo.create("div",{id:"ttvTestStatus",style:{
color:"white",marginTop:"4px",marginBottom:"2px",border:"1px solid white",display:"table",padding:"0px"}},e),this.extent()},teasp.util.Test.prototype.extent=function(){},teasp.util.Test.pushEvent=function(e,t){var a,e=document.getElementById(e);e.fireEvent&&dojo.isIE<=8?e.fireEvent(t):(t={onclick:"click"}[t]||t,(a=document.createEvent("MouseEvents")).initEvent(t,!1,!0),e.dispatchEvent(a))},
teasp.util.Test.prototype.reset=function(){this.seeds=[]},teasp.util.Test.prototype.addSeed=function(e){this.seeds.push(e)},teasp.util.Test.prototype.createProcessList=function(e){var t=[];if("T"==e)for(var a=540,o=1080,s=0;s<10;s++){for(var i,n=0;n<this.seeds.length;n++)(r=this.seeds[n]).inputable&&((l=[]).push({methodKey:"click",evt:"onclick",wait:2e3,id:"ttvTimeSt"+r.dkey}),(i=[]).push({id:"startTime",
value:teasp.util.time.timeValue(a)}),i.push({id:"endTime",value:teasp.util.time.timeValue(o)}),l.push({methodKey:"input",wait:700,lst:i}),l.push({methodKey:"click",evt:"onclick",wait:700,id:"dlgInpTimeOk"}),t.push(l),(l=[]).push({methodKey:"click",evt:"onclick",wait:1500,id:"dailyWorkCell"+r.dkey}),(i=[]).push({id:"empWorkSlider0",value:72,type:"dijit"}),i.push({id:"empWorkSlider1",value:24,type:"dijit"}),l.push({
methodKey:"input",wait:700,lst:i}),l.push({methodKey:"click",evt:"onclick",wait:700,id:"empWorkOk"}),t.push(l),a++,o++);if(!dojo.byId("ttvTestRepeat").checked)break}else if("A"==e)for(n=0;n<this.seeds.length;n++)(r=this.seeds[n]).applyable&&((l=[]).push({methodKey:"click",evt:"onclick",wait:1e3,id:"ttvApply"+r.dkey}),l.push({methodKey:"empApplyMenu",evt:"onclick",wait:1e3,type:"apply",key:"patternS"}),l.push({
methodKey:"click",evt:"onclick",wait:1500,id:"dialogApplyClose"}),t.push(l));else if("D"==e){for(var r,n=0;n<this.seeds.length;n++)(r=this.seeds[n]).dayFixable&&((l=[]).push({methodKey:"click",evt:"onclick",wait:1e3,id:"ttvDayFix"+r.dkey}),t.push(l));dojo.byId("ttvTestRepeat").checked&&t.push([{methodKey:"cancelAllDayFix"}])}else if("M"==e){for(var l=[],p=0;p<1;p++){for(n=0;n<12;n++)l.push({methodKey:"click",
evt:"onclick",wait:5e3,id:"prevMonthButton"});for(n=0;n<12;n++)l.push({methodKey:"click",evt:"onclick",wait:5e3,id:"nextMonthButton"})}t.push(l)}return t},teasp.util.Test.prototype.getProcessList=function(e){return this.createProcessList(e)},teasp.util.Test.prototype.start=function(e){this.key=e,dojo.style("ttvTestPanel","display","table"),this.processList[this.key]=this.getProcessList(this.key),this.processIndex=0,
this.que1=[],this.que2=[],this.doneCnt=0,this.allCnt=0;for(var t=this.processList[e],a=0;a<t.length;a++){var o=t[a];this.allCnt+=o.length}dojo.byId("ttvTestDone").innerHTML=this.doneCnt,dojo.byId("ttvTestCnt").innerHTML=this.allCnt,this.showStatus("実行中"),this.showQueCnt(),this.active=!0,this.signal()},teasp.util.Test.prototype.stop=function(){this.active=!1,this.showStatus("中止しています")},
teasp.util.Test.prototype.stopDone=function(){this.showStatus("中止しました")},teasp.util.Test.prototype.end=function(){this.showStatus("終了")},teasp.util.Test.prototype.showStatus=function(e){dojo.byId("ttvTestStatus").innerHTML=e},teasp.util.Test.prototype.showQueCnt=function(){dojo.byId("ttvTestQ1").innerHTML=this.que1.length,dojo.byId("ttvTestQ2").innerHTML=this.que2.length},
teasp.util.Test.prototype.showDoneCnt=function(){dojo.byId("ttvTestDone").innerHTML=++this.doneCnt},teasp.util.Test.prototype.nextProcess=function(){if(!this.active||!this.key)return null;var e=this.processList[this.key];if(e.length<=0||this.processIndex>=e.length){if(!this.infinity)return null;this.processIndex=0}e=e[this.processIndex];return this.processIndex++,e},teasp.util.Test.prototype.signal=function(e){if(
this.signalObj=e,this.active){var t=this.nextProcess();if(t){for(var a=0;a<t.length;a++)this.que1.push(t[a]);this.showQueCnt(),this.raise()}else this.end()}else this.stopDone()},teasp.util.Test.prototype.raise=function(){var e;this.active?(this.que2.length<=0&&0<this.que1.length&&(e=this.que1.shift(),this.que2.push(e),this.showQueCnt(),setTimeout(dojo.hitch(this,this.map[e.methodKey]),e.wait||1e3)),
!this.infinity&&this.doneCnt>=this.allCnt&&this.end()):this.stopDone()},teasp.util.Test.prototype.click=function(){var e=this.que2.shift();e&&(this.showQueCnt(),teasp.util.Test.pushEvent(e.id,e.evt),this.showDoneCnt(),this.raise())},teasp.util.Test.prototype.input=function(){var e=this.que2.shift();if(e){this.showQueCnt();for(var t=e.lst,a=0;a<t.length;a++){var o=t[a];"dijit"==o.type?dijit.byId(o.id).setValue(o.value
):dojo.byId(o.id).value=o.value}this.showDoneCnt(),this.raise()}},teasp.util.Test.prototype.cancelAllDayFix=function(){if(this.infinity=dojo.byId("ttvTestRepeat").checked,this.que2.shift()){this.showQueCnt();for(var a,o=teasp.viewPoint.pouch,e=o.getMonthDateList(),s=[],t=0;t<e.length;t++){var i=e[t],n=o.getEmpDay(i).getEmpApplyByKey(teasp.constant.APPLY_KEY_DAILY);n&&s.push({funcName:"cancelApplyEmpDay",params:{
empId:o.getEmpId(),month:o.getYearMonth(),lastModifiedDate:o.getLastModifiedDate(),appId:n.id,date:i,clearTime:!1,client:"monthly",noDelay:!0,remove:!1}})}s.length<=0?this.raise():(a=dojo.hitch(this,function(){teasp.manager.request("transEmpMonth",{empId:o.getEmpId(),month:o.getYearMonth()},o,{hideBusy:!0},this,function(e){teasp.manager.dialogClose("BusyWait"),teasp.viewPoint.refreshMonthly2(),this.showDoneCnt(),
this.raise()},function(e){teasp.manager.dialogClose("BusyWait"),teasp.util.showErrorArea(e,null),teasp.viewPoint.refreshMonthly2(),this.showDoneCnt()})}),teasp.manager.dialogOpen("BusyWait"),teasp.action.contact.remoteMethods(s,{nowait:!0,errorAreaId:null},function(e,t){o.setLastModifiedDate(e.lastModifiedDate),t<s.length-1?s[t+1].params.lastModifiedDate=o.getLastModifiedDate():a()},function(e,t){
teasp.manager.dialogClose("BusyWait"),teasp.util.showErrorArea(e,null),this.showDoneCnt()},this))}},teasp.util.Test.prototype.empApplyMenu=function(){this.infinity=dojo.byId("ttvTestRepeat").checked;var e=this.que2.shift();e&&(this.showQueCnt(),dijit.byId("empApplyTab").selectChild(dijit.byId("empApplyContent0")),"apply"==e.type?(teasp.util.Test.pushEvent("applyNew_"+e.key,e.evt),this.showDoneCnt()):(
this.showDoneCnt(),this.raise()))},teasp.provide("teasp.verify.VerDef"),teasp.verify.VerDef=function(){},teasp.verify.VerDef.getNames=function(e){for(var t=[],a=0;a<e.length;a++)!e[a].name||e[a].viewOnly||e[a].viewVal||t.push(e[a].name);return t.join(",")},teasp.verify.VerDef.parse=function(e,t,a){a=teasp.verify.VerDef.parseSimple(e,a||t.name);return a.orgValue=a.value,a.value=t.method?t.method(a.value,e):a.value,
a.dispValue=a.value,a.align="left",a.spec&&("DATETIME"==t.dataType?a.dispValue=teasp.util.date.formatDateTime(a.value):"DATE"==t.dataType&&(a.dispValue=teasp.util.date.formatDate(a.value)),"t"==t.type&&(a.dispValue=teasp.util.time.timeValue(a.value))),"t"!=t.type&&"n"!=t.type&&"np"!=t.type||(a.align="right"),a},teasp.verify.VerDef.parseSimple=function(e,t){for(var a=!1,o=t.split("."),s=e,i=0;i<o.length;i++){
var n=o[i];if(!s||void 0===s[n]){s=null;break}i==o.length-1&&(a=!0),s=s[n]}return{value:s,spec:a}},teasp.verify.VerDef.getWorkSystem=function(e){return{0:"固定時間制",1:"フレックスタイム制",2:"変形労働時間制",3:"管理監督"}[e]||""},teasp.verify.VerDef.getAmountTime=function(e,t){return t.config&&"1"==t.config.workSystem||t.ConfigId__r?e:null},teasp.verify.VerDef.getCarryforwardTime=function(e,t){
return t.config&&"1"==t.config.workSystem||t.ConfigId__r?e:null},teasp.verify.VerDef.getSettlementTime=function(e,t){return t.config&&"1"==t.config.workSystem||t.ConfigId__r?e:null},teasp.verify.VerDef.getAvg50week=function(e,t){return t.config&&"1"==t.config.workSystem?e:null},teasp.verify.VerDef.getAdditionalWorkChargeTime=function(e,t){return t.config&&"2"==t.config.workSystem?e||"":t.ConfigId__r?e:null},
teasp.verify.VerDef.getYesNo=function(e){return e?"Yes":"No"},teasp.verify.VerDef.EmpMonthFields=[{label:"社員ID",name:"EmpId__c",dataType:"REFERENCE",type:"s"},{label:"社員名",name:"EmpId__r.Name",dataType:"STRING",type:"s"},{label:"勤務体系",name:"EmpTypeId__r.Name",dataType:"REFERENCE",type:"s"},{label:"労働時間制",name:"ConfigId__r.WorkSystem__c",dataType:"STRING",type:"p",method:teasp.verify.VerDef.getWorkSystem},{
label:"適用期間",name:"ConfigId__r.VariablePeriod__c",dataType:"STRING",type:"n"},{label:"裁量労働制の採用",name:"ConfigId__r.UseDiscretionary__c",dataType:"BOOLEAN",type:"p",method:teasp.verify.VerDef.getYesNo},{label:"残業と控除の相殺をしない",name:"ConfigId__r.DeductWithFixedTime__c",dataType:"BOOLEAN",type:"p",method:teasp.verify.VerDef.getYesNo},{label:"月度",name:"YearMonth__c",dataType:"DOUBLE",type:"n"},{label:"サブナンバー",
name:"SubNo__c",dataType:"DOUBLE",type:"n"},{label:"起算日",name:"StartDate__c",dataType:"DATE",type:"s"},{label:"締め日",name:"EndDate__c",dataType:"DATE",type:"s"},{label:"起算情報変更日",name:"InitialDate__c",dataType:"DATE",type:"s"},{label:"申請ID",name:"EmpApplyId__c",dataType:"REFERENCE",type:"s"},{label:"ステータス",name:"EmpApplyId__r.Status__c",dataType:"STRING",type:"s"},{},{label:"所定出勤日数",name:"WorkFixedDay__c",
dataType:"DOUBLE",type:"np"},{label:"実出勤日数",name:"WorkRealDay__c",dataType:"DOUBLE",type:"np"},{label:"法定休日出勤日数",name:"WorkLegalHolidayCount__c",dataType:"DOUBLE",type:"np"},{label:"休日出勤日数",name:"WorkHolidayCount__c",dataType:"DOUBLE",type:"np"},{label:"祝日出勤日数",name:"WorkPublicHolidayCount__c",dataType:"DOUBLE",type:"np"},{},{label:"所定労働時間",name:"WorkFixedTime__c",dataType:"DOUBLE",type:"t"},{label:"総労働時間",
name:"WorkWholeTime__c",dataType:"DOUBLE",type:"t"},{label:"総労働・法休(含有休)",name:"WholeWorkTimeWoLH__c",dataType:"DOUBLE",type:"t"},{label:"実労働時間",name:"WorkRealTime__c",dataType:"DOUBLE",type:"t"},{label:"ネット労働時間",name:"WorkNetTime__c",dataType:"DOUBLE",type:"t"},{},{label:"過不足時間",name:"AmountTime__c",dataType:"DOUBLE",type:"t",method:teasp.verify.VerDef.getAmountTime},{label:"当月清算時間",name:"SettlementTime__c",
dataType:"DOUBLE",type:"t",method:teasp.verify.VerDef.getSettlementTime},{label:"繰越時間",name:"CarryforwardTime__c",dataType:"DOUBLE",type:"t",method:teasp.verify.VerDef.getCarryforwardTime},{label:"経過月",name:"ElapsedMonth__c",dataType:"DOUBLE",type:"n"},{label:"前月からの繰越時間",name:"carryforwardFromPrev",dataType:"DOUBLE",type:"t",viewVal:!0,method:teasp.verify.VerDef.getCarryforwardTime},{label:"週平均50H基準時間",
name:"avg50week",dataType:"DOUBLE",type:"t",viewVal:!0,method:teasp.verify.VerDef.getAvg50week},{label:"実適用期間",name:"numberOfMonths",dataType:"DOUBLE",type:"n",viewVal:!0},{},{label:"月の法定労働時間",name:"LegalWorkTime__c",dataType:"DOUBLE",type:"t"},{label:"実労働・法休(除有休)",name:"RealWorkTimeWoLH__c",dataType:"DOUBLE",type:"t"},{label:"法定時間内残業",name:"WorkLegalOverTime__c",dataType:"DOUBLE",type:"t"},{label:"法定時間外残業",
name:"WorkLegalOutOverTime__c",dataType:"DOUBLE",type:"t"},{label:"残業時間",name:"WorkOverTime__c",dataType:"DOUBLE",type:"t"},{label:"法定休日労働時間",name:"HolidayWorkTime__c",dataType:"DOUBLE",type:"t"},{},{label:"深夜労働時間",name:"WorkNightTime__c",dataType:"DOUBLE",type:"t"},{label:"割増労働時間",name:"WorkChargeTime__c",dataType:"DOUBLE",type:"t"},{label:"追加割増労働時間",name:"AdditionalWorkChargeTime__c",dataType:"DOUBLE",type:"t",
method:teasp.verify.VerDef.getAdditionalWorkChargeTime},{label:"４５時間超残業",name:"WorkOver45Time__c",dataType:"DOUBLE",type:"t"},{label:"６０時間超残業",name:"WorkOver60Time__c",dataType:"DOUBLE",type:"t"},{},{label:"遅刻回数",name:"LateCount__c",dataType:"DOUBLE",type:"n"},{label:"遅刻時間",name:"LateTime__c",dataType:"DOUBLE",type:"t"},{label:"控除遅刻時間",name:"LateLostTime__c",dataType:"DOUBLE",type:"t"},{label:"早退回数",
name:"EarlyCount__c",dataType:"DOUBLE",type:"n"},{label:"早退時間",name:"EarlyTime__c",dataType:"DOUBLE",type:"t"},{label:"控除早退時間",name:"EarlyLostTime__c",dataType:"DOUBLE",type:"t"},{label:"勤務時間内私用外出回数",name:"PrivateInnerCount__c",dataType:"DOUBLE",type:"n"},{label:"勤務時間内私用外出時間",name:"PrivateInnerTime__c",dataType:"DOUBLE",type:"t"},{label:"控除私用外出時間",name:"PrivateInnerLostTime__c",dataType:"DOUBLE",type:"t"},{
label:"控除時間",name:"LostTime__c",dataType:"DOUBLE",type:"t"},{label:"休暇控除時間",name:"HolidayDeductionTime__c",dataType:"DOUBLE",type:"t"},{},{label:"36協定対象残業時間",name:"WorkOverTime36__c",dataType:"DOUBLE",type:"t"},{label:"4半期36協定対象残業時間",name:"PeriodWorkOverTime36__c",dataType:"DOUBLE",type:"t"},{label:"累計３６協定対象残業時間",name:"TotalWorkOverTime36__c",dataType:"DOUBLE",type:"t"},{label:"累計３６協定超過回数",
name:"TotalWorkOverCount36__c",dataType:"DOUBLE",type:"n"},{label:"週４０時間超労働時間",name:"WorkOver40perWeek__c",dataType:"DOUBLE",type:"t"},{},{label:"有休取得日数",name:"PaidHolidayCount__c",dataType:"DOUBLE",type:"np"},{label:"時間単位有休取得時間",name:"PaidRestTime__c",dataType:"DOUBLE",type:"t"},{label:"有休残日数",name:"YuqRemainDays__c",dataType:"DOUBLE",type:"np"},{label:"有休残時間",name:"YuqRemainHour__c",dataType:"DOUBLE",type:"n"},{
label:"無給休暇日数",name:"AbsentCount__c",dataType:"DOUBLE",type:"np"},{},{label:"平日日中法内所定",name:"WeekDayDayLegalFixTime__c",dataType:"DOUBLE",type:"t"},{label:"平日日中法内残業",name:"WeekDayDayLegalExtTime__c",dataType:"DOUBLE",type:"t"},{label:"平日日中法外",name:"WeekDayDayLegalOutTime__c",dataType:"DOUBLE",type:"t"},{label:"平日深夜法内所定",name:"WeekDayNightLegalFixTime__c",dataType:"DOUBLE",type:"t"},{label:"平日深夜法内残業",
name:"WeekDayNightLegalExtTime__c",dataType:"DOUBLE",type:"t"},{label:"平日深夜法外",name:"WeekDayNightLegalOutTime__c",dataType:"DOUBLE",type:"t"},{label:"休日日中法内",name:"WeekEndDayLegalTime__c",dataType:"DOUBLE",type:"t"},{label:"休日日中法外",name:"WeekEndDayLegalOutTime__c",dataType:"DOUBLE",type:"t"},{label:"休日深夜法内",name:"WeekEndNightLegalTime__c",dataType:"DOUBLE",type:"t"},{label:"休日深夜法外",name:"WeekEndNightLegalOutTime__c",
dataType:"DOUBLE",type:"t"},{label:"法定休日日中",name:"HolidayDayTime__c",dataType:"DOUBLE",type:"t"},{label:"法定休日深夜",name:"HolidayNightTime__c",dataType:"DOUBLE",type:"t"},{},{label:"休日日中所定",name:"WeekEndDayLegalFixTime__c",dataType:"DOUBLE",type:"t"},{label:"休日深夜所定",name:"WeekEndNightLegalFixTime__c",dataType:"DOUBLE",type:"t"},{label:"法定休日日中所定",name:"HolidayDayFixTime__c",dataType:"DOUBLE",type:"t"},{label:"法定休日深夜所定",
name:"HolidayNightFixTime__c",dataType:"DOUBLE",type:"t"},{label:"割増労働時間・所定休日",name:"HolidayWorkChargeTime__c",dataType:"DOUBLE",type:"t"},{},{label:"所定休日労働時間",name:"WeekEndWorkTime__c",dataType:"DOUBLE",type:"t"},{label:"深夜勤務割増",name:"NightChargeTime__c",dataType:"DOUBLE",type:"t"},{label:"深夜労働時間・集計",name:"WorkNightTimeS__c",dataType:"DOUBLE",type:"t"},{label:"休憩時間",name:"WorkOffTime__c",dataType:"DOUBLE",type:"t"},
{label:"公用外出時間",name:"WorkAwayTime__c",dataType:"DOUBLE",type:"t"},{label:"私用外出回数",name:"PrivateCount__c",dataType:"DOUBLE",type:"n"},{label:"勤務時間外私用外出時間",name:"PrivateOuterTime__c",dataType:"DOUBLE",type:"t"},{label:"4半期36協定超過回数",name:"PeriodWorkOverCount36__c",dataType:"DOUBLE",type:"t"},{label:"法定休日勤務日数1",name:"LegalWorkHolidayCountBelow4__c",dataType:"DOUBLE",type:"n"},{label:"法定休日勤務日数2",
name:"LegalWorkHolidayCountOver4__c",dataType:"DOUBLE",type:"n"},{label:"計画付与有休取得日数",name:"PlannedHolidayCount__c",dataType:"DOUBLE",type:"np"},{label:"無給休暇日数(暦日)",name:"AbsentCount2__c",dataType:"DOUBLE",type:"np"},{label:"慶弔休暇",name:"SUMH_YYYY__c",dataType:"DOUBLE",type:"np"},{label:"有休失効日数",name:"YuqExpiredDays__c",dataType:"DOUBLE",type:"np"},{label:"有休付与日数",name:"YuqProvideDays__c",dataType:"DOUBLE",type:"np"},{
label:"有休付与ログ",name:"YuqLog__c",dataType:"TEXTAREA",type:"s"},{},{label:"所定休日代休発生",name:"AddedHolidayDaiq__c",dataType:"DOUBLE",type:"np"},{label:"法定休日代休発生",name:"AddedLegalHolidayDaiq__c",dataType:"DOUBLE",type:"np"},{label:"代休発生日数",name:"DaiqAllocated__c",dataType:"DOUBLE",type:"np"},{label:"代休発生日数(法)",name:"DaiqAllocatedLegalHoliday__c",dataType:"DOUBLE",type:"np"},{label:"代休消化日数",name:"DaiqConsumed__c",
dataType:"DOUBLE",type:"np"},{label:"代休消化日数(法)",name:"DaiqConsumedLegalHoliday__c",dataType:"DOUBLE",type:"np"},{label:"代休取得日数",name:"DaiqHolidayCount__c",dataType:"DOUBLE",type:"np"},{label:"代休残日数",name:"DaiqRemain__c",dataType:"DOUBLE",type:"np"},{label:"代休残日数(法)",name:"DaiqRemainLegalHoliday__c",dataType:"DOUBLE",type:"np"},{label:"代休失効日数",name:"DaiqExpired__c",dataType:"DOUBLE",type:"np"},{label:"代休失効日数(法)",
name:"DaiqExpiredLegalHoliday__c",dataType:"DOUBLE",type:"np"},{label:"期限切れ代休日数",name:"ExpiredDaiqCount__c",dataType:"DOUBLE",type:"np"},{label:"所定休日代休消化",name:"UsedHolidayDaiq__c",dataType:"DOUBLE",type:"np"},{label:"法定休日代休消化",name:"UsedLegalHolidayDaiq__c",dataType:"DOUBLE",type:"np"},{label:"所定休日勤務日数(振休あり1)",name:"WorkHolidayCountWithCHBelow4__c",dataType:"DOUBLE",type:"n"},{label:"所定休日勤務日数(振休あり2)",
name:"WorkHolidayCountWithCHOver4__c",dataType:"DOUBLE",type:"n"},{label:"所定休日勤務日数(振休なし1)",name:"WorkHolidayCountWoCHBelow4__c",dataType:"DOUBLE",type:"n"},{label:"所定休日勤務日数(振休なし2)",name:"WorkHolidayCountWoCHOver4__c",dataType:"DOUBLE",type:"n"},{label:"休日出勤日数(振替休日あり)",name:"WorkHolidayCountWithCH__c",dataType:"DOUBLE",type:"n"},{label:"休日出勤日数(振替休日なし)",name:"WorkHolidayCountWoCH__c",dataType:"DOUBLE",type:"n"},{
label:"前月からの振替日数",name:"ExchangeFromPrev__c",dataType:"DOUBLE",type:"np"},{label:"前月からの振替休日日数",name:"ExchangeHolidayFromPrev__c",dataType:"DOUBLE",type:"np"},{label:"前月からの振替勤務日数",name:"ExchangeWorkdayFromPrev__c",dataType:"DOUBLE",type:"np"},{label:"来月への振替日数",name:"ExchangeToNext__c",dataType:"DOUBLE",type:"np"},{label:"来月への振替休日日数",name:"ExchangeHolidayToNext__c",dataType:"DOUBLE",type:"np"},{label:"来月への振替勤務日数",
name:"ExchangeWorkdayToNext__c",dataType:"DOUBLE",type:"np"},{label:"振替前の所定勤務日数",name:"OrgWorkFixedDay__c",dataType:"DOUBLE",type:"n"},{label:"フレックス所定休日",name:"FlexWeekend__c",dataType:"DOUBLE",type:"t"},{label:"フレックス所定休日夜間",name:"FlexWeekendNight__c",dataType:"DOUBLE",type:"t"},{},{label:"変形期間法定労働時間",name:"LegalWorkTimeOfPeriod__c",dataType:"DOUBLE",type:"t"},{label:"変形期間内法定時間内労働時間",name:"WorkLegalTimePeriod__c",
dataType:"DOUBLE",type:"t"},{label:"変形期間内超過時間",name:"WorkLegalOutOverTimePeriod__c",dataType:"DOUBLE",type:"t"},{},{label:"平均出社時刻",name:"AverageStartTime__c",dataType:"DOUBLE",type:"t"},{label:"平均退社時刻",name:"AverageEndTime__c",dataType:"DOUBLE",type:"t"},{},{label:"勤怠月次ID",name:"Id",dataType:"ID",type:"s"},{label:"勤怠月次名",name:"Name",dataType:"STRING",type:"s"},{label:"作成日",name:"CreatedDate",dataType:"DATETIME",
type:"s"},{label:"作成者 ID",name:"CreatedBy.Name",dataType:"REFERENCE",type:"s"},{label:"最終更新日",name:"LastModifiedDate",dataType:"DATETIME",type:"s"},{label:"最終更新者 ID",name:"LastModifiedBy.Name",dataType:"REFERENCE",type:"s"},{label:"System Modstamp",name:"SystemModstamp",dataType:"DATETIME",type:"s"},{label:"勤怠部署月次",name:"DeptMonthId__r.Name",dataType:"REFERENCE",type:"s"}],teasp.verify.VerDef.EmpDayFields=[{
label:"日付",name:"Date__c",dataType:"DATE",type:"s"},{type:"y"},{label:"未申請早朝勤務",name:"svEst",dataType:"DOUBLE",type:"t",viewOnly:!0},{label:"未申請残業",name:"svZan",dataType:"DOUBLE",type:"t",viewOnly:!0},{label:"日タイプ",name:"DayType__c",dataType:"STRING",type:"s"},{label:"日タイプ(変更前)",name:"OrgDayType__c",dataType:"DOUBLE",type:"n"},{label:"有給計画付与日",name:"PlannedHoliday__c",dataType:"BOOLEAN",type:"s"},{label:"振替日",
name:"ExchangeDate__c",dataType:"DATE",type:"s"},{label:"所定労働時間",name:"WorkFixedTime__c",dataType:"DOUBLE",type:"t"},{label:"総労働時間",name:"WorkWholeTime__c",dataType:"DOUBLE",type:"t"},{label:"実労働時間",name:"WorkRealTime__c",dataType:"DOUBLE",type:"t"},{label:"ネット労働時間",name:"WorkNetTime__c",dataType:"DOUBLE",type:"t"},{label:"法定時間内残業",name:"WorkLegalOverTime__c",dataType:"DOUBLE",type:"t"},{label:"法定時間外残業",
name:"WorkLegalOutOverTime__c",dataType:"DOUBLE",type:"t"},{label:"残業時間",name:"WorkOverTime__c",dataType:"DOUBLE",type:"t"},{label:"法定休日労働時間",name:"WorkHolidayTime__c",dataType:"DOUBLE",type:"t"},{label:"深夜労働時間",name:"WorkNightTime__c",dataType:"DOUBLE",type:"t"},{label:"割増労働時間",name:"WorkChargeTime__c",dataType:"DOUBLE",type:"t"},{label:"遅刻時間",name:"LateTime__c",dataType:"DOUBLE",type:"t"},{label:"遅刻控除時間",
name:"LateLostTime__c",dataType:"DOUBLE",type:"t"},{label:"早退時間",name:"EarlyTime__c",dataType:"DOUBLE",type:"t"},{label:"早退控除時間",name:"EarlyLostTime__c",dataType:"DOUBLE",type:"t"},{label:"勤務時間内私用外出回数",name:"PrivateInnerCount__c",dataType:"DOUBLE",type:"n"},{label:"勤務時間内私用外出",name:"PrivateInnerTime__c",dataType:"DOUBLE",type:"t"},{label:"控除私用外出時間",name:"PrivateInnerLostTime__c",dataType:"DOUBLE",type:"t"},{
label:"欠勤時間",name:"AbsentTime__c",dataType:"DOUBLE",type:"t"},{label:"休暇控除時間",name:"HolidayDeductionTime__c",dataType:"DOUBLE",type:"t"},{label:"出社時刻",name:"StartTime__c",dataType:"DOUBLE",type:"t"},{label:"退社時刻",name:"EndTime__c",dataType:"DOUBLE",type:"t"},{label:"勤務場所",name:"WorkLocationId__r.Name",dataType:"STRING",type:"s"},{label:"出社時刻（ボタン）",name:"PushStartTime__c",dataType:"DOUBLE",type:"t"},{
label:"退社時刻（ボタン）",name:"PushEndTime__c",dataType:"DOUBLE",type:"t"},{label:"出社時刻(ボタン丸めなし)",name:"RealStartTime__c",dataType:"DOUBLE",type:"t"},{label:"退社時刻(ボタン丸めなし)",name:"RealEndTime__c",dataType:"DOUBLE",type:"t"},{label:"時間配分",name:"TimeTable__c",dataType:"TEXTAREA",type:"s"},{label:"シフト始業時刻",name:"ShiftStartTime__c",dataType:"DOUBLE",type:"t"},{label:"シフト終業時刻",name:"ShiftEndTime__c",dataType:"DOUBLE",type:"t"},{
label:"法定内労働時間",name:"WorkLegalTime__c",dataType:"DOUBLE",type:"t"},{label:"深夜勤務割増",name:"NightChargeTime__c",dataType:"DOUBLE",type:"t"},{label:"法定時間外割増",name:"ChargeTime__c",dataType:"DOUBLE",type:"t"},{label:"休憩時間",name:"WorkOffTime__c",dataType:"DOUBLE",type:"t"},{label:"所定休憩時間",name:"restTime__c",dataType:"DOUBLE",type:"t"},{label:"無給休憩時間",name:"unpaidRestTime__c",dataType:"DOUBLE",type:"t"},{label:"公用外出時間",
name:"WorkAwayTime__c",dataType:"DOUBLE",type:"t"},{label:"時間単位有休取得時間",name:"PaidRestTime__c",dataType:"DOUBLE",type:"t"},{label:"平日日中法内所定",name:"WeekDayDayLegalFixTime__c",dataType:"DOUBLE",type:"t"},{label:"平日日中法内残業",name:"WeekDayDayLegalExtTime__c",dataType:"DOUBLE",type:"t"},{label:"平日日中法外",name:"WeekDayDayLegalOutTime__c",dataType:"DOUBLE",type:"t"},{label:"平日深夜法内所定",name:"WeekDayNightLegalFixTime__c",
dataType:"DOUBLE",type:"t"},{label:"平日深夜法内残業",name:"WeekDayNightLegalExtTime__c",dataType:"DOUBLE",type:"t"},{label:"平日深夜法外",name:"WeekDayNightLegalOutTime__c",dataType:"DOUBLE",type:"t"},{label:"休日日中法内",name:"WeekEndDayLegalTime__c",dataType:"DOUBLE",type:"t"},{label:"休日日中法外",name:"WeekEndDayLegalOutTime__c",dataType:"DOUBLE",type:"t"},{label:"休日深夜法内",name:"WeekEndNightLegalTime__c",dataType:"DOUBLE",type:"t"},{
label:"休日深夜法外",name:"WeekEndNightLegalOutTime__c",dataType:"DOUBLE",type:"t"},{label:"法定休日日中",name:"HolidayDayTime__c",dataType:"DOUBLE",type:"t"},{label:"法定休日深夜",name:"HolidayNightTime__c",dataType:"DOUBLE",type:"t"},{label:"休日日中所定",name:"WeekEndDayLegalFixTime__c",dataType:"DOUBLE",type:"t"},{label:"休日深夜所定",name:"WeekEndNightLegalFixTime__c",dataType:"DOUBLE",type:"t"},{label:"法定休日日中所定",name:"HolidayDayFixTime__c",
dataType:"DOUBLE",type:"t"},{label:"法定休日深夜所定",name:"HolidayNightFixTime__c",dataType:"DOUBLE",type:"t"},{label:"割増労働時間・所定休日",name:"HolidayWorkChargeTime__c",dataType:"DOUBLE",type:"t"},{label:"前月からの振替日数",name:"ExchangeFromPrev__c",dataType:"DOUBLE",type:"n"},{label:"来月への振替日数",name:"ExchangeToNext__c",dataType:"DOUBLE",type:"n"},{label:"法定休日勤務日数1",name:"LegalWorkHolidayCountBelow4__c",dataType:"DOUBLE",type:"n"},{
label:"法定休日勤務日数2",name:"LegalWorkHolidayCountOver4__c",dataType:"DOUBLE",type:"n"},{label:"勤務換算休暇時間",name:"PaidAbsentTime__c",dataType:"DOUBLE",type:"t"},{label:"勤務時間外私用外出",name:"PrivateOuterTime__c",dataType:"DOUBLE",type:"t"},{label:"時間入力分差引",name:"SubtractTime__c",dataType:"DOUBLE",type:"t"},{label:"所定休日勤務日数(振休あり1)",name:"WorkHolidayCountWithCHBelow4__c",dataType:"DOUBLE",type:"n"},{label:"所定休日勤務日数(振休あり2)",
name:"WorkHolidayCountWithCHOver4__c",dataType:"DOUBLE",type:"n"},{label:"所定休日勤務日数(振休なし1)",name:"WorkHolidayCountWoCHBelow4__c",dataType:"DOUBLE",type:"n"},{label:"所定休日勤務日数(振休なし2)",name:"WorkHolidayCountWoCHOver4__c",dataType:"DOUBLE",type:"n"},{label:"日次申請ID",name:"DailyApplyId__c",dataType:"REFERENCE",type:"s"},{label:"勤務時間変更申請ID",name:"PatternSApplyId__c",dataType:"REFERENCE",type:"s"},{label:"長期時間変更申請ID",
name:"PatternLApplyId__c",dataType:"REFERENCE",type:"s"},{label:"勤務パターンID",name:"PatternId__c",dataType:"REFERENCE",type:"s"},{label:"休暇申請ID1",name:"HolidayApplyId1__c",dataType:"REFERENCE",type:"s"},{label:"休暇申請ID2",name:"HolidayApplyId2__c",dataType:"REFERENCE",type:"s"},{label:"休暇ID1",name:"HolidayId1__c",dataType:"REFERENCE",type:"s"},{label:"休暇ID2",name:"HolidayId2__c",dataType:"REFERENCE",type:"s"},{
label:"休日出勤申請ID",name:"HolidayWorkApplyId__c",dataType:"REFERENCE",type:"s"},{label:"振替申請ID(元)",name:"ExchangeSApplyId__c",dataType:"REFERENCE",type:"s"},{label:"振替申請ID(先)",name:"ExchangeEApplyId__c",dataType:"REFERENCE",type:"s"},{label:"早朝勤務申請ID",name:"EarlyStartApplyId__c",dataType:"REFERENCE",type:"s"},{label:"残業申請ID",name:"ZangyoApplyId__c",dataType:"REFERENCE",type:"s"},{label:"遅刻申請ID",
name:"LateStartApplyId__c",dataType:"REFERENCE",type:"s"},{label:"早退申請ID",name:"EarlyEndApplyId__c",dataType:"REFERENCE",type:"s"},{label:"勤怠月次",name:"EmpMonthId__c",dataType:"REFERENCE",type:"s"},{label:"勤務体系",name:"EmpTypeId__c",dataType:"REFERENCE",type:"s"},{label:"部署ID",name:"DeptId__c",dataType:"REFERENCE",type:"s"},{label:"イベントタイプ",name:"EventType__c",dataType:"STRING",type:"s"},{label:"イベント",name:"Event__c",
dataType:"STRING",type:"s"},{label:"エラー有り",name:"HasError__c",dataType:"BOOLEAN",type:"s"},{label:"備考",name:"Note__c",dataType:"TEXTAREA",type:"s"},{label:"日次一意キー",name:"UniqKey__c",dataType:"STRING",type:"s"},{label:"作業報告",name:"WorkNote__c",dataType:"TEXTAREA",type:"s"},{label:"確定",name:"Lock__c",dataType:"BOOLEAN",type:"s"},{label:"勤怠日次ID",name:"Id",dataType:"ID",type:"s"},{label:"勤怠日次名",name:"Name",
dataType:"STRING",type:"s"},{label:"作成日",name:"CreatedDate",dataType:"DATETIME",type:"s"},{label:"作成者 ID",name:"CreatedById",dataType:"REFERENCE",type:"s"},{label:"最終更新日",name:"LastModifiedDate",dataType:"DATETIME",type:"s"},{label:"最終更新者 ID",name:"LastModifiedById",dataType:"REFERENCE",type:"s"},{label:"System Modstamp",name:"SystemModstamp",dataType:"DATETIME",type:"s"}],teasp.verify.VerDef.EmpStockFields=[{
label:"種類",name:"Type__c",dataType:"STRING",type:"s"},{label:"日数",name:"Days__c",dataType:"DOUBLE",type:"n"},{label:"発生日",name:"Date__c",dataType:"DATE",type:"s"},{label:"開始日",name:"StartDate__c",dataType:"DATE",type:"s"},{label:"失効日",name:"LimitDate__c",dataType:"DATE",type:"s"},{label:"申請名",name:"EmpApplyId__r.Name",dataType:"STRING",type:"s"},{label:"日タイプ",name:"DayType__c",dataType:"STRING",type:"s"},{
label:"実労働時間",name:"WorkRealTime__c",dataType:"DOUBLE",type:"t"},{label:"代終日休可能な休日労働時間",name:"DaiqAllBorderTime__c",dataType:"DOUBLE",type:"t"},{label:"代半日休可能な休日労働時間",name:"DaiqHalfBorderTime__c",dataType:"DOUBLE",type:"t"},{label:"バッチキー",name:"BatchKey__c",dataType:"STRING",type:"s"}],teasp.provide("teasp.verify.VerData"),teasp.verify.VerData=function(e,t){this.empId=e.params.empId,this.month=e.params.month,
this.subNo=e.params.subNo,this.date=e.params.date,this.pouch=new teasp.data.Pouch,t&&(this.pouch.dataObj=e)},teasp.verify.VerData.prototype.setErrorId=function(e){this.errorId=e},teasp.verify.VerData.prototype.loadEmpMonth=function(e,t){teasp.manager.request("loadEmpMonthPrint",{target:"empMonth",empId:this.empId,month:this.month,subNo:this.subNo,date:this.date,mode:"read"},this.pouch,{hideBusy:!0},this,e,t)},
teasp.verify.VerData.prototype.downloadSample=function(a,e){var t=[],o=this.getMonthId(),s=(o&&(t.push(teasp.verify.VerEmpMonth.getRequest({monthId:o})),t.push(teasp.verify.VerEmpDays.getRequest({monthId:o}))),t.push({funcName:"loadEmpMonthPrint",params:[this.empId||"",this.month||"","read",null,this.subNo||""]}),{empMonth:[],empDays:[]});teasp.action.contact.remoteMethods(t,{errorAreaId:this.errorId,nowait:!0},
function(e,t){o&&0==t?s.empMonth=e.records||[]:o&&1==t?s.empDays=e.records||[]:(s.loadData=e,t=dojo.toJson(s)+"\r\n;",e=teasp.util.date.formatDateTime(new Date,"N14",!0),teasp.verify.VerData.inputDownload("var sampleData = ",t,"file"+e+".txt"),a())},e,this)},teasp.verify.VerData.prototype.getDataObj=function(){return this.pouch.dataObj},teasp.verify.VerData.prototype.getEmpId=function(){return this.getDataObj(
).targetEmp.id},teasp.verify.VerData.prototype.getMonthId=function(){return this.getDataObj().month.id},teasp.verify.VerData.prototype.getMonthSummary=function(){var e=this.pouch.getMonthSummary(),t=this.pouch.getEmpMonthLastDate();return{monSum:e,yuqRemain:this.pouch.getDspYuqRemain(t,!0)}},teasp.verify.VerData.inputDownload=function(e,t,a,o){for(var s=""+(new Date).getTime(),i=teasp.util.splitByLength(t,3e4),n=[],
r=Math.ceil(i.length/9),l=0,p=0;p<r;p++){n[p]=[];for(var d=0;d<9;d++){var c=9*l+d;c<i.length&&n[p].push(i[c])}l++}for(var m=[],p=0;m.push({funcName:"inputData",params:{key:s,head:0==p?e:null,values:n[p],order:p+1}}),++p<n.length;);teasp.verify.VerData.contact(m,function(e,t){m.length<=t+1&&teasp.downloadHref(teasp.getPageUrl("extCsvView")+"?key="+s+(a?"&fname="+a:""))},null,o||!1)},
teasp.verify.VerData.contact=function(e,t,a,o){teasp.action.contact.remoteMethods(is_array(e)?e:[e],{errorAreaId:null,nowait:o||!1},t,a,this)},teasp.provide("teasp.verify.VerEmpMonth"),teasp.verify.VerEmpMonth=function(){this.record=null,this.errorId=null},teasp.verify.VerEmpMonth.prototype.setErrorId=function(e){this.errorId=e},teasp.verify.VerEmpMonth.prototype.getRecord=function(){return this.record},
teasp.verify.VerEmpMonth.getRequest=function(e){return e.monthId?{funcName:"getExtResult",params:{soql:teasp.message.format("select {0} from AtkEmpMonth__c where Id = '{1}'",teasp.verify.VerDef.getNames(teasp.verify.VerDef.EmpMonthFields),e.monthId),limit:1,offset:0}}:null},teasp.verify.VerEmpMonth.prototype.getEmpMonth=function(e,t,a){this.record?t():e.monthId?teasp.action.contact.remoteMethods([
teasp.verify.VerEmpMonth.getRequest(e)],{errorAreaId:this.errorId,nowait:!0},function(e){"NG"==e.result?a(e):(this.record=e.records&&0<e.records.length?e.records[0]:null,t())},null,this):a("勤怠月次ID がありません")},teasp.provide("teasp.verify.VerEmpDays"),teasp.verify.VerEmpDays=function(){this.records=null,this.errorId=null},teasp.verify.VerEmpDays.prototype.setErrorId=function(e){this.errorId=e},
teasp.verify.VerEmpDays.prototype.getRecords=function(){return this.records},teasp.verify.VerEmpDays.getRequest=function(e){return e.monthId?{funcName:"getExtResult",params:{soql:teasp.message.format("select {0} from AtkEmpDay__c where EmpMonthId__c = '{1}'",teasp.verify.VerDef.getNames(teasp.verify.VerDef.EmpDayFields),e.monthId),limit:60,offset:0}}:null},teasp.verify.VerEmpDays.prototype.getEmpDays=function(e,t,a){
this.records?t():e.monthId?teasp.action.contact.remoteMethods([teasp.verify.VerEmpDays.getRequest(e)],{errorAreaId:this.errorId,nowait:!0},function(e){"NG"==e.result?a(e):(this.records=(e.records||[]).sort(function(e,t){return e.Date__c<t.Date__c?-1:1}),t())},null,this):a("勤怠月次ID がありません")},teasp.provide("teasp.verify.VerEmpStock"),teasp.verify.VerEmpStock=function(){this.stocks=null,this.stockDetails=null,
this.stockMap=null,this.errorId=null},teasp.verify.VerEmpStock.prototype.setErrorId=function(e){this.errorId=e},teasp.verify.VerEmpStock.getStockRequest=function(e){return e.empId?{funcName:"getExtResult",params:{soql:teasp.message.format(
"select Id, Name, Type__c, Days__c, Date__c, StartDate__c, LimitDate__c, EmpApplyId__c, EmpApplyId__r.Name, DayType__c, WorkRealTime__c, DaiqAllBorderTime__c, DaiqHalfBorderTime__c, BatchKey__c, LostFlag__c from AtkEmpStock__c where EmpId__c = '{0}'",e.empId),limit:null,offset:0}}:null},teasp.verify.VerEmpStock.getStockDetailRequest=function(e){return e.empId?{funcName:"getExtResult",params:{
soql:teasp.message.format("select Id, Name, Days__c, ConsumesStockId__c, ConsumesStockId__r.StartDate__c, ConsumesStockId__r.Days__c, ConsumedByStockId__c from AtkEmpStockDetail__c where ConsumesStockId__r.EmpId__c = '{0}'",e.empId),limit:null,offset:0}}:null},teasp.verify.VerEmpStock.prototype.getStockMap=function(){if(this.stockMap)return this.stockMap;for(var e={},t=0;t<this.stockDetails.length;t++){
var a=this.stockDetails[t];(u=(u=e[a.ConsumedByStockId__c])||(e[a.ConsumedByStockId__c]=[])).push({pId:a.ConsumesStockId__c,days:(a.ConsumesStockId__r&&"number"==typeof a.ConsumesStockId__r.Days__c&&a.ConsumesStockId__r.Days__c<a.Days__c?a.ConsumesStockId__r:a).Days__c,startDate:a.ConsumesStockId__r&&a.ConsumesStockId__r.StartDate__c?teasp.util.date.formatDate(a.ConsumesStockId__r.StartDate__c):null})}for(var o,s,
i={},n=0,r={},t=0;t<this.stocks.length;t++)l=(l=i[(o=this.stocks[t]).Type__c])||(i[o.Type__c]={plus:[],minus:[],mix:[]}),o.Date__c=teasp.util.date.formatDate(o.Date__c),o.StartDate__c=teasp.util.date.formatDate(o.StartDate__c),o.LimitDate__c=teasp.util.date.formatDate(o.LimitDate__c),o.WorkRealTime__c="number"==typeof o.WorkRealTime__c?teasp.util.time.timeValue(o.WorkRealTime__c):"",
o.DaiqAllBorderTime__c="number"==typeof o.DaiqAllBorderTime__c?teasp.util.time.timeValue(o.DaiqAllBorderTime__c):"",o.DaiqHalfBorderTime__c="number"==typeof o.DaiqHalfBorderTime__c?teasp.util.time.timeValue(o.DaiqHalfBorderTime__c):"",o._empApplyName=o.EmpApplyId__r?o.EmpApplyId__r.Name:"",0<=o.Days__c&&(o._date=o.StartDate__c,o._days=o.Days__c,o.EmpApplyId__r||(o.Name+="(付与日："+o.Date__c+")"),l.plus.push(o),
l.mix.push(o),(c={Id:""+ ++n,Name:"(失効)",Days__c:-1,Type__c:o.Type__c,Date__c:o.LimitDate__c,WorkRealTime__c:"",DaiqAllBorderTime__c:"",DaiqHalfBorderTime__c:"",_date:o.LimitDate__c,_empApplyName:"",_limit:!0})._days=c.Days__c,c._index=0,e[c.Id]=[{pId:o.Id,days:c.Days__c}],l.minus.push(c),l.mix.push(c));for(s in i)if(i.hasOwnProperty(s)){(l=i[s]).plus=l.plus.sort(function(e,t){
return e.LimitDate__c==t.LimitDate__c?e.StartDate__c==t.StartDate__c?e.Date__c<t.Date__c?-1:1:e.StartDate__c<t.StartDate__c?-1:1:e.LimitDate__c<t.LimitDate__c?-1:1});for(t=0;t<l.plus.length;t++)l.plus[t]._tag="#"+(t+1),l.plus[t]._no=t+1,r[l.plus[t].Id]=l.plus[t]}for(t=0;t<this.stocks.length;t++)if((o=this.stocks[t]).Days__c<0)for(var l=i[o.Type__c],p=(u=(u=e[o.Id])||(e[o.Id]=[{pId:null,days:o.Days__c,startDate:null}]
),o.LostFlag__c?u[0].startDate:null),d=0;d<u.length;d++){var c,m=u[d];(c=0==d?o:dojo.clone(o))._date=p||c.Date__c,o.LostFlag__c?c._days=Math.min(u[0].days,Math.abs(m.days)):c._days=Math.abs(m.days),c._index=d,(y=m.pId?r[m.pId]:null)&&(c.parent={LimitDate__c:y.LimitDate__c,StartDate__c:y.StartDate__c,Date__c:y.Date__c}),l.minus.push(c),l.mix.push(c)}for(s in i)if(i.hasOwnProperty(s)){(l=i[s]).minus=l.minus.sort(
function(e,t){return e.Date__c==t.Date__c?e.parent&&t.parent?e.parent.LimitDate__c==t.parent.LimitDate__c?e.parent.StartDate__c==t.parent.StartDate__c?e.parent.Date__c<t.parent.Date__c?-1:1:e.parent.StartDate__c<t.parent.StartDate__c?-1:1:e.parent.LimitDate__c<t.parent.LimitDate__c?-1:1:!e.parent&&t.parent?1:-1:e.Date__c<t.Date__c?-1:1});for(t=0;t<l.minus.length;t++)0<=l.minus[t]._index&&(y=(u=e[l.minus[t].Id]
)[d=l.minus[t]._index].pId?r[u[d].pId]:null,l.minus[t]._tag=y?y._tag:null,l.minus[t]._no=10*(t+1),l.minus[t]._folk=1<u.length);l.mix=l.mix.sort(function(e,t){return e._date==t._date?e._no-t._no:e._date<t._date?-1:1});for(t=0;t<l.mix.length;t++)0<=(h=l.mix[t]).Days__c&&(h._plus=h.Days__c,0==h.Days__c&&(h._ng=!0));for(var h,u,g,y,f=0,t=0;t<l.mix.length;t++)(h=l.mix[t])._name=h.Name,h.Days__c<0&&((y=(g=(u=e[h.Id]
)&&h._index<u.length?u[h._index]:null)&&g.pId?r[g.pId]:null)&&(h._limit&&(y._plus<=0?h._none=!0:h._days=y._plus),h._none||(h.LostFlag__c?y._plus-=Math.min(y._plus,h._days):y._plus-=h._days,y._plus<0&&(h._ng=!0))),h.LostFlag__c&&(h._name+="("+h.Days__c+"日)")),h._none||(h.Days__c<0?f-=h._days:f+=h._days,h._zan=f);for(t=l.mix.length-1;0<=t;t--)l.mix[t]._none&&l.mix.splice(t,1)}return this.stockMap=i,this.stockMap},
teasp.verify.VerEmpStock.prototype.getEmpStock=function(e,a,o){this.stocks?a():teasp.action.contact.remoteMethods([teasp.verify.VerEmpStock.getStockRequest(e),teasp.verify.VerEmpStock.getStockDetailRequest(e)],{errorAreaId:this.errorId,nowait:!0},function(e,t){"NG"==e.result?o(e):0==t?this.stocks=e.records:1==t&&(this.stockDetails=e.records,a())},null,this)},teasp.provide("teasp.verify.VerEmpYuq"),
teasp.verify.VerEmpYuq=function(){this.yuqs=null,this.yuqDetails=null,this.yuqMap=null,this.errorId=null},teasp.verify.VerEmpYuq.prototype.setErrorId=function(e){this.errorId=e},teasp.verify.VerEmpYuq.getYuqRequest=function(e){return e.empId?{funcName:"getExtResult",params:{soql:teasp.message.format(
"select Id, Name, EmpId__c, Date__c, StartDate__c, LimitDate__c, EmpApplyId__c, EmpApplyId__r.Name, BaseTime__c, TotalTime__c, Subject__c, TimeUnit__c, LostFlag__c, AutoFlag__c, BatchId__c, TempFlag__c, StockProvideBatchId__c, oldNextYuqProvideDate__c from AtkEmpYuq__c where EmpId__c = '{0}'",e.empId),limit:null,offset:0}}:null},teasp.verify.VerEmpYuq.getYuqDetailRequest=function(e){return e.empId?{
funcName:"getExtResult",params:{soql:teasp.message.format("select Id, Name, EmpYuqId__c, GroupId__c, Time__c from AtkEmpYuqDetail__c where EmpYuqId__r.EmpId__c = '{0}'",e.empId),limit:null,offset:0}}:null},teasp.verify.VerEmpYuq.prototype.getYuqMap=function(){if(this.yuqMap)return this.yuqMap;for(var e={},t=0;t<this.yuqDetails.length;t++){var a=this.yuqDetails[t];(c=(c=e[a.EmpYuqId__c])||(e[a.EmpYuqId__c]=[])).push({
pId:a.GroupId__c,time:a.Time__c})}for(var o={plus:[],minus:[],mix:[]},s=0,i={},t=0;t<this.yuqs.length;t++)(n=this.yuqs[t]).Date__c=teasp.util.date.formatDate(n.Date__c),n.StartDate__c=teasp.util.date.formatDate(n.StartDate__c),n.LimitDate__c=teasp.util.date.formatDate(n.LimitDate__c),n._empApplyName=n.EmpApplyId__r?n.EmpApplyId__r.Name:"",n._bt=teasp.util.time.timeValue(n.BaseTime__c),0<=n.TotalTime__c&&(
n._obj=new teasp.logic.YuqDays(n.BaseTime__c,n.TotalTime__c),n._date=n.StartDate__c,n.EmpApplyId__r||(n.Name+="(付与日："+n.Date__c+")"),o.plus.push(n),o.mix.push(n),(l={Id:""+ ++s,Name:"(失効)",TotalTime__c:-1*n.BaseTime__c,Date__c:n.LimitDate__c,BaseTime__c:n.BaseTime__c,_date:n.LimitDate__c,_empApplyName:"",_bt:teasp.util.time.timeValue(n.BaseTime__c),_limit:!0})._obj=new teasp.logic.YuqDays(l.BaseTime__c,l.TotalTime__c
),l._index=0,e[l.Id]=[{pId:n.Id,time:l.TotalTime__c}],o.minus.push(l),o.mix.push(l));o.plus=o.plus.sort(function(e,t){return e.LimitDate__c==t.LimitDate__c?e.StartDate__c==t.StartDate__c?e.Date__c<t.Date__c?-1:1:e.StartDate__c<t.StartDate__c?-1:1:e.LimitDate__c<t.LimitDate__c?-1:1});for(var n,t=0;t<o.plus.length;t++)o.plus[t]._tag="#"+(t+1),o.plus[t]._no=t+1,i[o.plus[t].Id]=o.plus[t];for(t=0;t<this.yuqs.length;t++
)if((n=this.yuqs[t]).TotalTime__c<0){c=(c=e[n.Id])||(e[n.Id]=[{pId:null,time:n.TotalTime__c}]);for(var r=0;r<c.length;r++){var l,p=c[r];(l=0==r?n:dojo.clone(n))._obj=new teasp.logic.YuqDays(l.BaseTime__c,Math.abs(p.time)),l._date=l.Date__c,l._index=r,(h=p.pId?i[p.pId]:null)&&(l.parent={LimitDate__c:h.LimitDate__c,StartDate__c:h.StartDate__c,Date__c:h.Date__c}),o.minus.push(l),o.mix.push(l)}}o.minus=o.minus.sort(
function(e,t){return e.Date__c==t.Date__c?e.parent&&t.parent?e.parent.LimitDate__c==t.parent.LimitDate__c?e.parent.StartDate__c==t.parent.StartDate__c?e.parent.Date__c<t.parent.Date__c?-1:1:e.parent.StartDate__c<t.parent.StartDate__c?-1:1:e.parent.LimitDate__c<t.parent.LimitDate__c?-1:1:!e.parent&&t.parent?1:-1:e.Date__c<t.Date__c?-1:1});for(t=0;t<o.minus.length;t++)0<=o.minus[t]._index&&(h=(c=e[o.minus[t].Id]
)[r=o.minus[t]._index].pId?i[c[r].pId]:null,o.minus[t]._tag=h?h._tag:null,o.minus[t]._no=10*(t+1),o.minus[t]._folk=1<c.length);o.mix=o.mix.sort(function(e,t){return e._date==t._date?e._no-t._no:e._date<t._date?-1:1});for(t=0;t<o.mix.length;t++)0<=(d=o.mix[t]).TotalTime__c&&(d._plus=new teasp.logic.YuqDays(d.BaseTime__c,d.TotalTime__c));for(var d,c,m,h,u=null,t=0;t<o.mix.length;t++)(d=o.mix[t]).TotalTime__c<0&&((h=(
m=(c=e[d.Id])&&d._index<c.length?c[d._index]:null)&&m.pId?i[m.pId]:null)&&(d._limit&&(h._plus.getAllMinutes()<=0?d._none=!0:d._obj=new teasp.logic.YuqDays(d.BaseTime__c,h._plus.getAllMinutes())),d._none||(h._plus.subtract(d._obj),h._plus.getAllMinutes()<0&&(d._ng=!0)))),d._none||(u?0<=d.TotalTime__c?u.append(d._obj):u.subtract(d._obj):u=new teasp.logic.YuqDays(d.BaseTime__c,d._obj.getAllMinutes()),
d._zan=new teasp.logic.YuqDays(u.getBaseTime(),u.getAllMinutes()));for(t=o.mix.length-1;0<=t;t--)o.mix[t]._none&&o.mix.splice(t,1);return this.yuqMap=o,this.yuqMap},teasp.verify.VerEmpYuq.prototype.getEmpYuq=function(e,a,o){this.yuqs?a():teasp.action.contact.remoteMethods([teasp.verify.VerEmpYuq.getYuqRequest(e),teasp.verify.VerEmpYuq.getYuqDetailRequest(e)],{errorAreaId:this.errorId,nowait:!0},function(e,t){
"NG"==e.result?o(e):0==t?this.yuqs=e.records:1==t&&(this.yuqDetails=e.records,a())},null,this)},teasp.provide("teasp.verify.VerCheck"),teasp.verify.VerCheck=function(e,t){this.verData=new teasp.verify.VerData(e,t),this.verMonth=new teasp.verify.VerEmpMonth,this.verDays=new teasp.verify.VerEmpDays,this.verYuq=new teasp.verify.VerEmpYuq,this.verStock=new teasp.verify.VerEmpStock},teasp.verify.VerCheck.NG_MARK="Ｘ",
teasp.verify.VerCheck.prototype.getVerData=function(){return this.verData},teasp.verify.VerCheck.prototype.loadEmpMonth=function(e,t){this.verData.loadEmpMonth(e,t)},teasp.verify.VerCheck.prototype.downloadSample=function(e,t){this.verData.downloadSample(e,t)},teasp.verify.VerCheck.prototype.getDbEmpMonth=function(e,t){this.verMonth.getEmpMonth({monthId:this.verData.getMonthId()},e,t)},
teasp.verify.VerCheck.prototype.getDbEmpDays=function(e,t){this.verDays.getEmpDays({monthId:this.verData.getMonthId()},e,t)},teasp.verify.VerCheck.prototype.getDbEmpYuq=function(e,t){this.verYuq.getEmpYuq({empId:this.verData.getEmpId()},e,t)},teasp.verify.VerCheck.prototype.getDbEmpStock=function(e,t){this.verStock.getEmpStock({empId:this.verData.getEmpId()},e,t)},teasp.verify.VerCheck.prototype.setErrorId=function(e
){this.verMonth.setErrorId(e),this.verDays.setErrorId(e),this.verYuq.setErrorId(e),this.verStock.setErrorId(e)},teasp.verify.VerCheck.displayValue=function(e){return null==e?"":teasp.util.entitize(e,"")},teasp.verify.VerCheck.prototype.verifyMonth=function(e,t,a){this.getDbEmpMonth(dojo.hitch(this,function(){t(this.getVerifyMonthNg(e))}),a)},teasp.verify.VerCheck.prototype.getVerifyMonthNg=function(e){for(
var t=this.compareMonthResults(),a=0,o=0;o<t.length;o++)"ng"==t[o].check&&(e&&e(t[o]),a++);return a},teasp.verify.VerCheck.prototype.compareMonthResults=function(){for(var e=this.verData.getMonthSummary(),t=this.monthViewValues(e),a=this.verMonth.getRecord(),o=[],s=teasp.verify.VerDef.EmpMonthFields,i=0;i<s.length;i++){var n,r,l,p,d,c=s[i];c.label?(n=teasp.verify.VerDef.parse(a,c),
r=teasp.verify.VerCheck.displayValue(n.dispValue),l=t[c.name],p="",d="ok",c.viewVal?r+=l.obj.dispValue||"":l&&l.obj&&((n.value||l.obj.value)&&n.value!=l.obj.value?(r+="<span>("+l.obj.dispValue+")</span>",p=teasp.verify.VerCheck.NG_MARK,d=1==l.w?"wa":"ng"):p="&#10003;"),o.push({label:c.label,title:c.name,align:n.align,value:r,check:d,mark:p})):o.push({})}return o},
teasp.verify.VerCheck.prototype.compareDaysResults=function(){for(var e=this.verDays.getRecords(),p=this.dayViewValues(),d=teasp.verify.VerDef.EmpDayFields,c={},t=[],m=[],h=0;h<d.length;h++){var a=d[h];t.push(a)}var u=this.verData.getDataObj();return c.f=t,dojo.forEach(e,function(e){var t=teasp.util.date.formatDate(e.Date__c),a=(m.push(t),{});for(h=0;h<d.length;h++){var o,s,i,n,r,l=d[h];l.label&&(
o=teasp.verify.VerDef.parse(e,l),s=teasp.verify.VerCheck.displayValue(o.dispValue),n="",r="ok",(i=p[l.name])&&(t<u.targetEmp.entryDate||u.targetEmp.endDate<t)&&(i.w=1),l.viewOnly?s=i.obj[t].dispValue||"":i&&i.obj&&i.obj[t]&&((o.value||0)!=(i.obj[t].value||0)?(s+=" <span>("+i.obj[t].dispValue+")</span>",n=teasp.verify.VerCheck.NG_MARK,r=1==i.w?"wa":"ng"):n="&#10003;"),a[l.name]={label:l.label,title:l.name,
align:o.align,value:s,check:r,mark:n})}c[t]=a},this),c.d=m,c},teasp.verify.VerCheck.prototype.monthViewValues=function(s){var e=teasp.verify.VerDef.EmpMonthFields,i={},n=(dojo.forEach(e,function(e){e.name&&(i[e.name]=e)}),this.verData.getDataObj()),r={};return dojo.forEach([{name:"WorkFixedDay__c",key:"disc.workFixedDay"},{name:"WorkRealDay__c",key:"disc.workRealDay"},{name:"WorkLegalHolidayCount__c",
key:"disc.workLegalHolidayCount"},{name:"WorkHolidayCount__c",key:"disc.workHolidayCount"},{name:"WorkPublicHolidayCount__c",key:"disc.workPublicHolidayCount"},{name:"WorkFixedTime__c",key:"disc.workFixedTime"},{name:"WorkWholeTime__c",key:"disc.workWholeTime"},{name:"WholeWorkTimeWoLH__c"},{name:"WorkRealTime__c",key:"disc.workRealTime"},{name:"WorkNetTime__c",key:"real.workRealTime"},{name:"AmountTime__c",
key:"disc.amountTime"},{name:"SettlementTime__c",key:"disc.settlementTime"},{name:"CarryforwardTime__c",key:"carryforwardToNext"},{name:"ElapsedMonth__c",key:"periodInfo.elapsedMonth"},{name:"carryforwardFromPrev",key:"carryforwardFromPrev"},{name:"avg50week",key:"avg50week"},{name:"numberOfMonths",key:"periodInfo.numberOfMonths"},{name:"WorkOverTime36__c",key:"disc.workOverTime36"},{name:"PeriodWorkOverTime36__c",
key:"disc.quartWorkOverTime36"},{name:"TotalWorkOverTime36__c",key:"disc.totalWorkOverTime36"},{name:"TotalWorkOverCount36__c",key:"disc.totalWorkOverCount36"},{name:"WorkOver40perWeek__c",key:"real.workOver40perWeek"},{name:"LegalWorkTime__c",key:"legalTime"},{name:"RealWorkTimeWoLH__c"},{name:"WorkLegalOverTime__c",key:"disc.workLegalOverTime"},{name:"WorkLegalOutOverTime__c",key:"disc.workLegalOutOverTime"},{
name:"WorkOverTime__c",key:"disc.workOverTime"},{name:"HolidayWorkTime__c",key:"disc.workHolidayTime"},{name:"WorkNightTime__c",key:"real.workNightTime"},{name:"WorkChargeTime__c",key:"disc.workChargeTime"},{name:"AdditionalWorkChargeTime__c",key:"overTimeInPeriod"},{name:"WorkOver45Time__c",key:"disc.workOver45Time"},{name:"WorkOver60Time__c",key:"disc.workOver60Time"},{name:"LateCount__c",key:"disc.lateCount"},{
name:"LateTime__c",key:"disc.lateTime"},{name:"LateLostTime__c",key:"disc.lateLostTime"},{name:"EarlyCount__c",key:"disc.earlyCount"},{name:"EarlyTime__c",key:"disc.earlyTime"},{name:"EarlyLostTime__c",key:"disc.earlyLostTime"},{name:"PrivateInnerCount__c",key:"disc.privateInnerCount"},{name:"PrivateInnerTime__c",key:"disc.privateInnerTime"},{name:"PrivateInnerLostTime__c",key:"disc.privateInnerLostTime"},{
name:"LostTime__c",key:"disc.lostTime"},{name:"HolidayDeductionTime__c",key:"disc.holidayDeductionTime"},{name:"WorkOffTime__c",key:"real.restTime",w:1},{name:"WorkAwayTime__c",key:"real.workAwayTime"},{name:"PaidHolidayCount__c",w:1},{name:"PaidRestTime__c",key:"disc.paidRestTime",w:1},{name:"YuqRemainDays__c",w:1},{name:"YuqRemainHour__c",w:1},{name:"AbsentCount__c",w:1},{name:"WeekDayDayLegalFixTime__c",
key:"disc.weekDayDayLegalFixTime",w:1},{name:"WeekDayDayLegalExtTime__c",key:"disc.weekDayDayLegalExtTime",w:1},{name:"WeekDayDayLegalOutTime__c",key:"disc.weekDayDayLegalOutTime",w:1},{name:"WeekDayNightLegalFixTime__c",key:"disc.weekDayNightLegalFixTime",w:1},{name:"WeekDayNightLegalExtTime__c",key:"disc.weekDayNightLegalExtTime",w:1},{name:"WeekDayNightLegalOutTime__c",key:"disc.weekDayNightLegalOutTime",w:1},{
name:"WeekEndDayLegalTime__c",key:"disc.weekEndDayLegalTime",w:1},{name:"WeekEndDayLegalOutTime__c",key:"disc.weekEndDayLegalOutTime",w:1},{name:"WeekEndNightLegalTime__c",key:"disc.weekEndNightLegalTime",w:1},{name:"WeekEndNightLegalOutTime__c",key:"disc.weekEndNightLegalOutTime",w:1},{name:"HolidayDayTime__c",key:"disc.holidayDayTime",w:1},{name:"HolidayNightTime__c",key:"disc.holidayNightTime",w:1}],function(e){
var t,a,o=i[e.name];o&&(e.key?e.obj=teasp.verify.VerDef.parse(n.month,o,e.key):(n.yuqRemains&&("PaidHolidayCount__c"==e.name?(a=s.monSum.o.holidaySummary.sums[teasp.constant.HOLIDAY_TYPE_PAID],e.obj=teasp.verify.VerDef.parse({v:a},o,"v")):"YuqRemainDays__c"==e.name?e.obj=teasp.verify.VerDef.parse(s.yuqRemain,o,"days"):"YuqRemainHour__c"==e.name?((t=teasp.verify.VerDef.parse(s.yuqRemain,o,"time"))&&t.value&&(
t.value=t.value/60),e.obj=t):"AbsentCount__c"==e.name&&(a=s.monSum.o.holidaySummary.sums[teasp.constant.HOLIDAY_TYPE_FREE],e.obj=teasp.verify.VerDef.parse({v:a},o,"v"))),"WholeWorkTimeWoLH__c"==e.name?(a=n.month.disc.workWholeTime-n.month.disc.workHolidayTime,e.obj=teasp.verify.VerDef.parse({v:a},o,"v")):"RealWorkTimeWoLH__c"==e.name&&(a=n.month.disc.workRealTime-n.month.disc.workHolidayTime,
e.obj=teasp.verify.VerDef.parse({v:a},o,"v")))),r[e.name]=e},this),"1"==n.config.workSystem&&1==n.config.variablePeriod||r.LegalWorkTime__c&&(r.LegalWorkTime__c.w=1),("1"!=n.config.workSystem||n.config.variablePeriod<=1)&&r.ElapsedMonth__c&&(r.ElapsedMonth__c.w=1),"2"!=n.config.workSystem&&r.AdditionalWorkChargeTime__c&&(r.AdditionalWorkChargeTime__c.w=1),r},teasp.verify.VerCheck.prototype.dayViewValues=function(){
var e=[{name:"WorkFixedTime__c",key:"rack.fixTime"},{name:"WorkWholeTime__c",key:"disc.workWholeTime"},{name:"WorkRealTime__c",key:"disc.workRealTime"},{name:"WorkNetTime__c",key:"real.workRealTime"},{name:"WorkLegalOverTime__c",key:"disc.workLegalOverTime"},{name:"WorkLegalOutOverTime__c",key:"disc.workLegalOutOverTime"},{name:"WorkOverTime__c",key:"disc.workOverTime"},{name:"WorkHolidayTime__c",
key:"disc.workHolidayTime"},{name:"WorkNightTime__c",key:"real.workNightTime"},{name:"WorkChargeTime__c",key:"disc.workChargeTime"},{name:"LateTime__c",key:"disc.lateTime"},{name:"LateLostTime__c",key:"disc.lateLostTime"},{name:"EarlyTime__c",key:"disc.earlyTime"},{name:"EarlyLostTime__c",key:"disc.earlyLostTime"},{name:"PrivateInnerTime__c",key:"disc.privateInnerTime"},{name:"PrivateInnerLostTime__c",
key:"disc.privateInnerLostTime"},{name:"HolidayDeductionTime__c",key:"rack.holidayDeductionTime"},{name:"WorkOffTime__c",key:"real.restTime",w:1},{name:"WorkAwayTime__c",key:"real.awayTime"},{name:"WeekDayDayLegalFixTime__c",key:"disc.weekDayDayLegalFixTime",w:1},{name:"WeekDayDayLegalExtTime__c",key:"disc.weekDayDayLegalExtTime",w:1},{name:"WeekDayDayLegalOutTime__c",key:"disc.weekDayDayLegalOutTime",w:1},{
name:"WeekDayNightLegalFixTime__c",key:"disc.weekDayNightLegalFixTime",w:1},{name:"WeekDayNightLegalExtTime__c",key:"disc.weekDayNightLegalExtTime",w:1},{name:"WeekDayNightLegalOutTime__c",key:"disc.weekDayNightLegalOutTime",w:1},{name:"WeekEndDayLegalTime__c",key:"disc.weekEndDayLegalTime",w:1},{name:"WeekEndDayLegalOutTime__c",key:"disc.weekEndDayLegalOutTime",w:1},{name:"WeekEndNightLegalTime__c",
key:"disc.weekEndNightLegalTime",w:1},{name:"WeekEndNightLegalOutTime__c",key:"disc.weekEndNightLegalOutTime",w:1},{name:"HolidayDayTime__c",key:"disc.holidayDayTime",w:1},{name:"HolidayNightTime__c",key:"disc.holidayNightTime",w:1},{name:"svEst",key:"disc.svEst",w:1},{name:"svZan",key:"disc.svZan",w:1}],t=teasp.verify.VerDef.EmpDayFields,o={};if(dojo.forEach(t,function(e){e.name&&(o[e.name]=e)}),
"2"==this.verData.getDataObj().config.workSystem)for(var a=0;a<e.length;a++)if("WorkChargeTime__c"==e[a].name){e[a].key="disc.workChargeTime40H";break}var s=this.verData.getDataObj().days,i={};return dojo.forEach(e,function(e){e.obj={};var t=o[e.name];if(t&&e.key)for(var a in s)e.obj[a]=teasp.verify.VerDef.parse(s[a],t,e.key);i[e.name]=e},this),"1"==this.verData.getDataObj(
).config.workSystem&&1<this.verData.getDataObj().config.variablePeriod&&(i.WorkLegalOverTime__c&&(i.WorkLegalOverTime__c.w=1),i.WorkLegalOutOverTime__c&&(i.WorkLegalOutOverTime__c.w=1),i.WorkOverTime__c&&(i.WorkOverTime__c.w=1),i.WorkChargeTime__c&&(i.WorkChargeTime__c.w=1)),i},teasp.provide("teasp.verify.VerView"),teasp.verify.VerView=function(){this.scanTabs=[{title:"勤怠月次",num:1,onclick:this.openEmpMonth,defa:!0},{
title:"勤怠日次",num:2,onclick:this.openEmpDay},{title:"有休",num:3,onclick:this.openEmpYuq},{title:"代休／日数管理休暇",num:4,onclick:this.openEmpStock},{title:"オプション",num:5,onclick:this.openOption}],this.errorNo=0;var e=null,e=window.opener?window.opener.teasp.viewPoint.pouch.dataObj:{params:{empId:null,month:null}};this.verCheck=new teasp.verify.VerCheck(e),this.empId=e&&e.targetEmp&&e.targetEmp.id,this.events=[]},
teasp.verify.VerView.MONTH_TITLE="勤怠月次データ DB保存値",teasp.verify.VerView.DAYS_TITLE="勤怠日次データ DB保存値",teasp.verify.VerView.YUQ_TITLE="有給休暇 付与・消化状況",teasp.verify.VerView.STOCK_TITLE="代休／日数管理休暇 付与・消化状況",
teasp.verify.VerView.MONTH_DESCRIPTION='<span>&#10003; : 一致</span><span style="margin-left:10px;color:red;font-weight:bold;">{0}</span> : 不一致（括弧内の値は画面表示値）<span style="margin-left:10px;">無印 : 比較対象外</span><br/><span>（※注）設定変更等により、正常系でも不一致になることはあります。</span>',
teasp.verify.VerView.DAYS_DESCRIPTION='<span>&#10003; : 一致</span><span style="margin-left:10px;color:red;font-weight:bold;">{0}</span> : 不一致（括弧内の値は画面表示値）<span style="margin-left:10px;">無印 : 比較対象外</span><br/><span>（※注）設定変更等により、正常系でも不一致になることはあります。</span>',teasp.verify.VerView.NOTHING="データはありません",
teasp.verify.VerView.LEAVE_DESCRIPTION="<span>・時系列順に付与・消化・失効状況を並べています。付与の日付は有効開始日を表示します。</span><br/><span>・付与日数・消化日数の右側の#{番号}は、付与と消化の紐づけを示すタグです。同じタグは紐づけ関係にあることを示します。</span><br/><span>・消化を複数の付与から行うものは、タグを太字で表示します（消化レコードの名前・申請名・IDが同一かどうかでも識別可）。</span><br/><span>・残日数は時系列順に付与・消化した場合の値です。そのため、TS本体で表示される残日数と一致しないことがあります。</span>",teasp.verify.VerView.YUQ_DESCRIPTION=teasp.verify.VerView.LEAVE_DESCRIPTION,
teasp.verify.VerView.STOCK_DESCRIPTION=teasp.verify.VerView.LEAVE_DESCRIPTION+"<br/><span>・代休の場合、付与日数＝０や付与日数＜消化日数になる場合があります。その場合は、タグを赤色で表示します。</span><br/><span>　（正常系でも、休日出勤労働時間が代休取得条件を満たさない・申請取消等の要因で、この状態になることがあります）</span>",teasp.verify.VerView.prototype.init=function(e){this.res=e},teasp.verify.VerView.prototype.initView=function(){this.createErrorArea(),this.verCheck.loadEmpMonth(dojo.hitch(this,this.initArea),
dojo.hitch(this,function(e){}))},teasp.verify.VerView.prototype.initArea=function(){this.createScanTabsArea();for(var e=0;e<this.scanTabs.length;e++){var t=this.scanTabs[e];if(t.defa&&t.onclick){t.onclick.apply(this);break}}},teasp.verify.VerView.prototype.createScanTabsArea=function(){dojo.empty(dojo.byId("tsfArea"));var a=dojo.create("div",{className:"verify-tabs"},dojo.byId("tsfArea"));dojo.create("div",{
className:"main-area"},dojo.byId("tsfArea")),dojo.forEach(this.scanTabs,function(e){var t=dojo.create("div",{innerHTML:e.title,className:"verify-tab"+e.num+" "+(e.defa?"focus":"blur")},a);e.onclick&&dojo.connect(t,"click",this,e.onclick)},this),dojo.connect(a,"click",this,this.clickTab)},teasp.verify.VerView.prototype.clickTab=function(e){for(var t=e.target,a=-1,o=1;o<=this.scanTabs.length;o++)if(dojo.hasClass(t,
"verify-tab"+o)){a=o;break}a<0||dojo.query(".verify-tabs > div").forEach(function(e){dojo.toggleClass(e,"focus",dojo.hasClass(e,"verify-tab"+a)),dojo.toggleClass(e,"blur",!dojo.hasClass(e,"verify-tab"+a))})},teasp.verify.VerView.prototype.getMainArea=function(){var e=dojo.query("#tsfArea > .main-area");return e?e[0]:null},teasp.verify.VerView.prototype.createErrorArea=function(){var e=this.getMainArea(),t=dojo.byId(
"tsfArea"),a=dojo.create("div",{className:"error-area",id:"verifyError"+ ++this.errorNo});e?e.firstChild?dojo.place(a,e.firstChild,"before"):dojo.place(a,e,"first"):dojo.place(a,t,"first"),this.verCheck.setErrorId("verifyError"+this.errorNo)},teasp.verify.VerView.prototype.clearView=function(){for(var e=0;e<this.events.length;e++)dojo.disconnect(this.events[e]);this.events=[];var t=this.getMainArea();t&&dojo.empty(t)
,this.createErrorArea()},teasp.verify.VerView.prototype.showError=function(t){dojo.query(".error-area").forEach(function(e){e.innerHTML=teasp.message.getErrorMessage(t)})},teasp.verify.VerView.prototype.openEmpMonth=function(){this.clearView(),this.verCheck.getDbEmpMonth(dojo.hitch(this,this.showEmpMonth),dojo.hitch(this,this.showError))},teasp.verify.VerView.prototype.showEmpMonth=function(){for(var e=dojo.create(
"table",{className:"verify-table"}),t=dojo.create("thead",null,e),a=dojo.create("tr",null,t),o=(dojo.create("th",{innerHTML:"項目名"},a),dojo.create("th",{innerHTML:"DB値"},a),dojo.create("tbody",null,e)),s=this.verCheck.compareMonthResults(),i=0,n=0;n<s.length;n++){var r,l=s[n];l.label?(a=dojo.create("tr",{className:"verify-"+(i++%2==0?"even":"odd")},o),dojo.create("td",{className:"field-label",innerHTML:l.label,
title:l.title},a),r=l.mark?'<span class="check-result">'+l.mark+"</span>":"",dojo.create("td",{className:"field-value align-"+l.align+" span-"+l.check,innerHTML:l.value+r},a)):(a=dojo.create("tr",{className:"empty-row"},o),dojo.create("td",{colSpan:t.rows[0].cells.length},a))}this.getMainArea().appendChild(dojo.create("div",{className:"verify-description",innerHTML:teasp.message.format(
teasp.verify.VerView.MONTH_TITLE,teasp.verify.VerCheck.NG_MARK)})),this.getMainArea().appendChild(e),this.getMainArea().appendChild(dojo.create("div",{className:"verify-description",innerHTML:teasp.message.format(teasp.verify.VerView.MONTH_DESCRIPTION,teasp.verify.VerCheck.NG_MARK)}))},teasp.verify.VerView.prototype.openEmpDay=function(){this.clearView(),this.verCheck.getDbEmpDays(dojo.hitch(this,this.showEmpDays),
dojo.hitch(this,this.showError))},teasp.verify.VerView.prototype.showEmpDays=function(){for(var e=dojo.create("table",{className:"verify-table"}),t=dojo.create("thead",null,e),a=this.verCheck.compareDaysResults(),o=a.d,s=a.f,i=dojo.create("tr",null,t),n=0;n<s.length;n++)(d=s[n]).name?dojo.create("th",{innerHTML:d.label,title:d.name},i):"y"==d.type&&dojo.create("th",{innerHTML:"曜日"},i);for(var r=dojo.create("tbody",
null,e),l=0,p=0;p<o.length;p++)for(var d,c,m,h=o[p],i=dojo.create("tr",{className:"verify-"+(l++%2==0?"even":"odd")},r),n=0;n<s.length;n++)(d=s[n]).name?(m=(c=a[h][d.name]).mark?'<span class="check-result">'+c.mark+"</span>":"",dojo.create("td",{className:"day-value align-"+c.align+" span-"+c.check,innerHTML:c.value+m},i)):"y"==d.type&&dojo.create("td",{innerHTML:teasp.util.date.formatDate(h,"JPW"),
className:"day-value align-center"},i);this.getMainArea().appendChild(dojo.create("div",{className:"verify-description",innerHTML:teasp.message.format(teasp.verify.VerView.DAYS_TITLE,teasp.verify.VerCheck.NG_MARK)})),this.getMainArea().appendChild(e),this.getMainArea().appendChild(dojo.create("div",{className:"verify-description",innerHTML:teasp.message.format(teasp.verify.VerView.DAYS_DESCRIPTION,
teasp.verify.VerCheck.NG_MARK)}))},teasp.verify.VerView.prototype.openEmpYuq=function(){this.clearView(),this.verCheck.getDbEmpYuq(dojo.hitch(this,this.showEmpYuq),dojo.hitch(this,this.showError))},teasp.verify.VerView.prototype.showEmpYuq=function(){var e=this.verCheck.verYuq.getYuqMap();if(this.getMainArea().appendChild(dojo.create("div",{className:"verify-description",innerHTML:teasp.message.format(
teasp.verify.VerView.YUQ_TITLE)})),0<e.mix.length){for(var t=dojo.create("table",{className:"verify-stock"}),a=dojo.create("thead",null,t),o=dojo.create("tr",null,a),s=(dojo.create("th",{innerHTML:""},o),dojo.create("th",{innerHTML:"日付"},o),dojo.create("th",{innerHTML:"付与日数",colSpan:2},o),dojo.create("th",{innerHTML:"消化日数",colSpan:2},o),dojo.create("th",{innerHTML:"残日数"},o),dojo.create("th",{innerHTML:"基準時間"},o),
dojo.create("th",{innerHTML:"失効日"},o),dojo.create("th",{innerHTML:"事柄"},o),dojo.create("th",{innerHTML:"名前"},o),dojo.create("th",{innerHTML:"申請名"},o),dojo.create("th",{innerHTML:"勤怠有休ID"},o),dojo.create("tbody",null,t)),i=0;i<e.mix.length;i++){var n=e.mix[i],o=dojo.create("tr",{className:"stock-"+(i%2==0?"even":"odd")+(n._limit?" stock-limit":"")},s),r=(dojo.create("td",{className:"align-right",innerHTML:i+1},o),
n._ng?"align-tag-ng":"align-tag");n._folk&&(r+=" tag-folk"),0<=n.TotalTime__c?(dojo.create("td",{className:"align-center",innerHTML:n.StartDate__c},o),dojo.create("td",{className:"align-right",innerHTML:n._obj.format()},o),dojo.create("td",{className:r,innerHTML:n._tag},o),dojo.create("td",{className:"align-right",innerHTML:""},o),dojo.create("td",{className:"align-tag",innerHTML:""},o),dojo.create("td",{
className:"align-right",innerHTML:n._zan.format()},o),dojo.create("td",{className:"align-right",innerHTML:n._bt},o),dojo.create("td",{className:"align-center",innerHTML:n.LimitDate__c},o)):(dojo.create("td",{className:"align-center",innerHTML:n.Date__c},o),dojo.create("td",{className:"align-right",innerHTML:""},o),dojo.create("td",{className:"align-tag",innerHTML:""},o),dojo.create("td",{className:"align-right",
innerHTML:n._obj.format()},o),dojo.create("td",{className:r,innerHTML:n._tag},o),dojo.create("td",{className:"align-right",innerHTML:n._zan.format()},o),dojo.create("td",{className:"align-right",innerHTML:n._bt},o),dojo.create("td",{className:"align-center",innerHTML:"-"},o)),dojo.create("td",{className:"align-left",innerHTML:n.Subject__c||""},o),dojo.create("td",{className:"align-left",innerHTML:n.Name},o),
dojo.create("td",{className:"align-left",innerHTML:n._empApplyName},o),n._limit?dojo.create("td",null,o):dojo.create("a",{href:"/"+n.Id,target:"verifyView",innerHTML:n.Id},dojo.create("td",{className:"align-left"},o))}this.getMainArea().appendChild(t),dojo.create("div",{className:"verify-description",innerHTML:teasp.verify.VerView.YUQ_DESCRIPTION},this.getMainArea())}else dojo.create("div",{
className:"verify-description",innerHTML:teasp.verify.VerView.NOTHING},this.getMainArea())},teasp.verify.VerView.prototype.openEmpStock=function(){this.clearView(),teasp.LeaveMain&&(teasp.LeaveMain.destroyRecursive(),teasp.LeaveMain=null),teasp.LeaveMain=new tsext.leave.LeaveMainView(1,this.empId),teasp.LeaveMain.placeAt(this.getMainArea())},teasp.verify.VerView.prototype.showEmpStock=function(){
var e=this.verCheck.verStock.getStockMap(),t=[];for(i in e)e.hasOwnProperty(i)&&t.push(i);var a={"代休":1},t=t.sort(function(e,t){return a[e]&&a[t]?a[e]-a[t]:a[e]||a[t]?a[e]?-1:1:e<t?-1:1});this.getMainArea().appendChild(dojo.create("div",{className:"verify-description",innerHTML:teasp.message.format(teasp.verify.VerView.STOCK_TITLE)}));for(var o=0,s=0;s<t.length;s++){var i=t[s],n=this.createEmpStockTable(i,e[i]);
o+=n.length,dojo.forEach(n,function(e){this.getMainArea().appendChild(e)},this)}o?dojo.create("div",{className:"verify-description",innerHTML:teasp.verify.VerView.STOCK_DESCRIPTION},this.getMainArea()):dojo.create("div",{className:"verify-description",innerHTML:teasp.verify.VerView.NOTHING},this.getMainArea())},teasp.verify.VerView.prototype.createEmpStockTable=function(e,t){if(!t)return[];for(var a=dojo.create("div"
,{innerHTML:e,className:"verify-bold"}),o=dojo.create("table",{className:"verify-stock"}),s=dojo.create("thead",null,o),i=dojo.create("tr",null,s),n=(dojo.create("th",{innerHTML:""},i),dojo.create("th",{innerHTML:"日付"},i),dojo.create("th",{innerHTML:"付与日数",colSpan:2},i),dojo.create("th",{innerHTML:"消化日数",colSpan:2},i),dojo.create("th",{innerHTML:"残日数"},i),dojo.create("th",{innerHTML:"失効日"},i),dojo.create("th",{
innerHTML:"名前"},i),dojo.create("th",{innerHTML:"申請名"},i),"代休"==e&&(dojo.create("th",{innerHTML:"実労働時間"},i),dojo.create("th",{innerHTML:"代終日休条件"},i),dojo.create("th",{innerHTML:"代半日休条件"},i)),dojo.create("th",{innerHTML:"勤怠積休ID"},i),dojo.create("th",{innerHTML:"剥奪フラグ"},i),dojo.create("tbody",null,o)),r=0;r<t.mix.length;r++){var l=t.mix[r],i=dojo.create("tr",{className:"stock-"+(r%2==0?"even":"odd")+(
l._limit?" stock-limit":"")},n),p=(dojo.create("td",{className:"align-right",innerHTML:r+1},i),l._ng?"align-tag-ng":"align-tag");l._folk&&(p+=" tag-folk"),0<=l.Days__c?(dojo.create("td",{className:"align-center",innerHTML:l.StartDate__c},i),dojo.create("td",{className:"align-right",innerHTML:l._days},i),dojo.create("td",{className:p,innerHTML:l._tag},i),dojo.create("td",{className:"align-right",innerHTML:""},i),
dojo.create("td",{className:"align-tag",innerHTML:""},i),dojo.create("td",{className:"align-right",innerHTML:l._zan},i),dojo.create("td",{className:"align-center",innerHTML:l.LimitDate__c},i)):(dojo.create("td",{className:"align-center",innerHTML:l.Date__c},i),dojo.create("td",{className:"align-right",innerHTML:""},i),dojo.create("td",{className:"align-tag",innerHTML:""},i),dojo.create("td",{className:"align-right",
innerHTML:Math.abs(l._days)},i),dojo.create("td",{className:p,innerHTML:l._tag},i),dojo.create("td",{className:"align-right",innerHTML:l._zan},i),dojo.create("td",{className:"align-center",innerHTML:"-"},i)),dojo.create("td",{className:"align-left",innerHTML:l._name||l.Name},i),dojo.create("td",{className:"align-left",innerHTML:l._empApplyName},i),"代休"==e&&(dojo.create("td",{className:"align-right",
innerHTML:l.WorkRealTime__c},i),dojo.create("td",{className:"align-right",innerHTML:l.DaiqAllBorderTime__c},i),dojo.create("td",{className:"align-right",innerHTML:l.DaiqHalfBorderTime__c},i)),l._limit?(dojo.create("td",null,i),dojo.create("td",null,i)):(dojo.create("a",{href:"/"+l.Id,target:"verifyView",innerHTML:l.Id},dojo.create("td",{className:"align-left"},i)),dojo.create("td",{className:"align-center",
innerHTML:""+(l.LostFlag__c||!1)},i))}return[a,o]},teasp.verify.VerView.prototype.openOption=function(){this.clearView(),teasp.TestAssistExportView&&(teasp.TestAssistExportView.destroyRecursive(),teasp.TestAssistExportView=null),teasp.TestAssistExportView=new tsext.testAssist.TestAssistExportView(1,this.empId,this.verCheck.getVerData().getDataObj()),teasp.TestAssistExportView.placeAt(this.getMainArea())},
teasp.verify.VerView.prototype.downloadSample=function(){dojo.query('input[type="button"]').forEach(function(e){e.disabled=!0}),document.body.style.cursor="wait",this.verCheck.downloadSample(function(){dojo.query('input[type="button"]').forEach(function(e){e.disabled=!1}),document.body.style.cursor="default"},dojo.hitch(this,this.showError))};